{"version":3,"sources":["../../../../../src/.internal/core/utils/Utils.ts","../../../../../src/.internal/core/utils/List.ts","../../../../../src/.internal/core/utils/InterfaceColorSet.ts","../../../../../src/.internal/core/utils/Color.ts","../../../../../src/.internal/core/Container.ts","../../../../../src/.internal/core/Sprite.ts","../../../../../src/.internal/core/Base.ts","../../../../../src/.internal/core/utils/DOM.ts","../../../../../src/.internal/core/rendering/Path.ts","../../../../../src/.internal/core/utils/Adapter.ts","../../../../../src/.internal/core/utils/Strings.ts","../../../../../src/.internal/core/Options.ts","../../../../../src/.internal/core/interaction/Interaction.ts","../../../../../src/.internal/core/utils/Responsive.ts","../../../../../src/.internal/core/utils/Ease.ts","../../../../../src/.internal/core/utils/Animation.ts","../../../../../src/.internal/core/elements/Label.ts","../../../../../src/.internal/core/System.ts","../../../../../src/.internal/core/utils/Keyboard.ts","../../../../../src/.internal/core/elements/Button.ts","../../../../../src/.internal/core/utils/SortedList.ts","../../../../../src/.internal/core/utils/Colors.ts","../../../../../src/.internal/core/rendering/Paper.ts","../../../../../src/.internal/core/rendering/fills/LinearGradient.ts","../../../../src/lang/en.ts","../../../../../src/.internal/core/utils/Language.ts","../../../../../src/.internal/core/formatters/TextFormatter.ts","../../../../../src/.internal/core/elements/RoundedRectangle.ts","../../../../../src/.internal/core/rendering/filters/Filter.ts","../../../../../src/.internal/core/rendering/fills/RadialGradient.ts","../../../../../src/.internal/core/interaction/Mouse.ts","../../../../../src/.internal/core/Component.ts","../../../../../src/.internal/core/DataItem.ts","../../../../../src/.internal/core/rendering/fills/Pattern.ts","../../../../../src/.internal/core/formatters/DateFormatter.ts","../../../../../src/.internal/core/elements/Circle.ts","../../../../../src/.internal/core/rendering/Smoothing.ts","../../../../../src/.internal/core/rendering/AMElement.ts","../../../../../src/.internal/core/elements/Rectangle.ts","../../../../../src/.internal/core/elements/Polyline.ts","../../../../../src/.internal/core/elements/Tooltip.ts","../../../../../src/.internal/core/elements/WavedLine.ts","../../../../../src/.internal/core/SpriteState.ts","../../../../../src/.internal/core/utils/Number.ts","../../../../../src/.internal/core/utils/Order.ts","../../../../../src/.internal/core/SpriteEvents.ts","../../../../../src/.internal/core/interaction/InteractionObjectEvents.ts","../../../../../src/.internal/core/utils/Time.ts","../../../../../src/.internal/core/elements/Modal.ts","../../../../../src/.internal/core/utils/Log.ts","../../../../../src/.internal/core/formatters/NumberFormatter.ts","../../../../../src/.internal/core/formatters/DurationFormatter.ts","../../../../../src/.internal/core/utils/Validatable.ts","../../../../../src/.internal/core/utils/Net.ts","../../../../../src/.internal/core/data/DataLoader.ts","../../../../../src/.internal/core/data/CSVParser.ts","../../../../../src/.internal/core/data/DataParser.ts","../../../../../src/.internal/core/data/JSONParser.ts","../../../../../src/.internal/core/elements/Polyspline.ts","../../../../../src/.internal/core/elements/Scrollbar.ts","../../../../../src/.internal/core/elements/Triangle.ts","../../../../../src/.internal/core/elements/WavedRectangle.ts","../../../../../src/.internal/core/utils/ResizeSensor.ts","../../../../../src/.internal/core/rendering/SVGContainer.ts","../../../../../src/.internal/core/elements/PopupCSS.ts","../../../../../src/.internal/core/elements/Popup.ts","../../../../../src/.internal/core/defs/SVGDefaults.ts","../../../../../src/.internal/core/rendering/Group.ts","../../../../../src/.internal/core/interaction/InteractionObject.ts","../../../../../src/.internal/core/interaction/InteractionKeyboardObject.ts","../../../../../src/.internal/core/interaction/Inertia.ts","../../../../../src/.internal/core/export/Export.ts","../../../../../src/.internal/core/data/DataSource.ts","../../../../../src/.internal/core/elements/Line.ts","../../../../../src/.internal/core/elements/PointedRectangle.ts","../../../../../src/.internal/core/elements/PointedShape.ts","../../../../../src/.internal/core/elements/Polyarc.ts","../../../../../src/.internal/core/elements/Polygon.ts","../../../../../src/.internal/core/utils/Morpher.ts","../../../../../src/.internal/core/elements/ResizeButton.ts","../../../../../src/.internal/core/rendering/filters/DropShadowFilter.ts","../../../../../src/.internal/core/utils/ColorSet.ts","../../../../../src/.internal/core/export/ExportCSS.ts","../../../../../src/.internal/core/export/ExportMenu.ts","../../../../../src/.internal/core/utils/Browser.ts"],"names":["used","value","copyProperties","source","target","key","stripHash","url","exec","getBaseURI","baseURI","document","loc","location","href","softCopyProperties","copy","isNotEmpty","toString","relativeToValue","percent","full","relativeRadiusToValue","subtractIfNegative","valueToRelative","getPixelRatio","window","devicePixelRatio","camelToDashed","str","replace","toLowerCase","capitalize","arr","split","toUpperCase","join","stringify","JSON","escapeForRgex","splitTextByCharCount","text","maxChars","fullWords","rtl","fullWordFallback","length","res","currentIndex","words","i","word","match","wordLength","reverseString","parts","RegExp","x","concat","push","truncateWithEllipsis","ellipsis","trim","rtrim","ltrim","reverse","unquote","padString","len","char","Array","getFormat","format","hints","cleanFormat","stripTags","plainText","numberToString","Infinity","negative","Math","abs","parsed","digits","decimals","exponent","zeros","slice","anyToDate","date","Date","setMilliseconds","getMilliseconds","num","Number","anyToNumber","getTime","getYearDay","utc","start","getFullYear","diff","getTimezoneOffset","floor","getWeek","day","week","getDay","getMonthWeek","firstWeek","getMonth","currentWeek","getDayFromWeek","year","weekday","setUTCFullYear","get12Hours","hours","base","getTimeZone","long","savings","wotz","toLocaleString","wtz","timeZoneName","substr","random","from","to","fitNumber","min","max","fitNumberRelative","gap","svgPointToSprite","point","sprite","y","sprites","parent","angle","rotation","relativeX","pixelX","ex","relativeY","pixelY","ey","dx","dy","scale","group","pixelPaddingLeft","pixelPaddingTop","spritePointToSvg","spritePointToSprite","toSprite","svgRectToSprite","rect","p1","p2","width","height","spriteRectToSvg","documentPointToSvg","svgContainer","cssScale","bbox","getBoundingClientRect","left","top","e","svgPointToDocument","documentPointToSprite","htmlContainer","spritePointToDocument","element","cs","getComputedStyle","paddingX","parseFloat","paddingLeft","paddingRight","borderX","borderLeftWidth","borderRightWidth","clientWidth","paddingY","paddingTop","paddingBottom","borderY","borderTopWidth","borderBottomWidth","clientHeight","decimalPlaces","number","urlRegexp","parseUrl","protocol","separator","authority","domain","port","path","query","hash","serializeUrl","isRelativeUrl","joinUrl","right","parsedLeft","parsedRight","Error","leftPath","rightPath","pop","isIE","MSInputMethodContext","documentMode","array","end","this","_array","_start","_end","iterator","backwards","IndexedIterable","range","list","getKey","sort","events","on","newValue","_getKey","index","_insert","undefined","_remove","oldValue","_keys","_groups","_sort","found","values","disposeOnRemove","dispose","checkBounds","initial","_values","contains","indexOf","removeValue","removeIndex","hasIndex","getIndex","setIndex","isEnabled","dispatchImmediately","type","insertIndex","_sortQuicksort","low","high","order","p","_sortPartition","pivot","j","swap","a","b","value_a","value_b","moveValue","toIndex","unshift","pushAll","copyFrom","shift","setAll","newArray","oldArray","clear","Symbol","each","f","t","template","_template","v","isTemplate","clone","create","make","out","ListTemplate","List","_purposes","stroke","fill","primaryButton","primaryButtonHover","primaryButtonDown","primaryButtonActive","primaryButtonText","primaryButtonStroke","secondaryButton","secondaryButtonHover","brighten","secondaryButtonDown","secondaryButtonActive","secondaryButtonText","secondaryButtonStroke","grid","background","alternativeBackground","alternativeText","disabledBackground","positive","className","applyTheme","debug","getFor","purpose","setFor","color","registeredClasses","InterfaceColorSet","_value","_lightColor","Color","r","g","_darkColor","alpha","rgba","hex","lighten","rgb","saturate","saturation","darkColor","lightColor","cacheId","cached","getCache","setCache","isColor","castColor","toColor","_childrenByLayout","_childrenDisposers","hasFocused","setStateOnSprites","layoutInvalid","_absoluteWidth","_absoluteHeight","_shouldBeReady","_tapToActivate","tapTimeout","_element","paper","addGroup","add","setPropertyValue","_positionPrecision","_disposers","children","handleChildAdded","handleChildRemoved","event","processChild","child","insertKey","uid","handleChildTransform","sortAndAdd","err","invalidate","sortChildren","addChildren","removeKey","removeElement","isMeasured","invalidateLayout","disabled","layout","__disabled","addToInvalidLayouts","requestFrame","deepInvalidate","Container","_children","getPropertyValue","percentWidth","percentHeight","calculateRelativeSize","totalRelativeWidth","totalRelativeHeight","relativeWidth","relativeHeight","zindexed","sortArray","map","data","idx","ai","zIndex","bi","val","isCorrect","node","childNodes","_background","addToBack","createChild","classType","removeChildren","disposeChildren","createBackground","processBackground","removeDispose","handleGlobalScale","validateLayout","removeFromInvalidLayouts","_availableWidth","innerWidth","_availableHeight","innerHeight","measuredWidth","measuredHeight","allValid","maxWidth","maxHeight","pixelMarginRight","pixelMarginLeft","invalid","validate","pixelMarginTop","pixelMarginBottom","childMeasuredWidth","childMeasuredHeight","align","valign","arrange","bottom","maxCellWidth","minCellWidth","columnCount","contentLeft","contentRight","contentTop","contentBottom","pixelPaddingRight","pixelPaddingBottom","nextX","nextY","row","column","columnWidth","rowHeight","minWidth","minHeight","childrenCopy","reverseOrder","fixedWidthGrid","maxColumns","getColumnWidth","validatePosition","childMarginLeft","childMarginRight","childMarginTop","childMarginBottom","childWidth","childHeight","childLeft","childRight","childTop","childBottom","maxLeft","maxRight","maxTop","maxBottom","nextColumnWidth","moveTo","noneBBox","_pixelWidth","_pixelHeight","measuredContentWidth","measuredContentHeight","contentAlign","contentValign","mwa","mha","ddx","ddy","oldBBox","contentWidth","contentHeight","_bbox","prevLeft","prevTop","prevBotttom","prevRight","measure","dummyData","updateCenter","updateBackground","fitsToBounds","pixelWidth","pixelHeight","setStateOnChildren","shouldClone","preloader","_preloader","tooltipContainer","setPaper","changed","topParent","removeFromInvalids","setDataItem","dataItem","_dataItem","measureElement","setSVGAttribute","invalidateLabels","once","handleValidate","setState","transitionDuration","easing","stateName","name","isActive","item","setActive","dispatchReady","isReady","isDisposed","_systemUpdate","skippedSprites","_systemCheckIfValidate","component","dataInvalid","_systemValidatePositions","positionInvalid","_systemValidateLayouts","setTapToActivate","interactions","isTouchProtected","setEventDisposer","handleTapToActivate","initTapTimeout","body","ev","isLocalElement","pointer","svg","handleTapToActivateDeactivation","_tapToActivateTimeout","tapToActivate","setTimeout","moveHtmlContainer","htmlElement","newContainer","svgDiv","appendChild","SVGContainer","initSensor","log","hasLicense","commercialLicense","licenses","visualProperties","properties","_eventDispatcher","_bindings","_isTemplate","_isPath","_inited","_ready","isHiding","_isHidden","isShowing","isStandaloneInstance","_isActive","_mask","_language","_exporting","_exportable","propertyFields","applyOnClones","_measuredWidthSelf","_measuredHeightSelf","maxLeftSelf","maxRightSelf","maxTopSelf","maxBottomSelf","_isDragged","_isResized","_disabled","_internalDisabled","_updateDisabled","_internalDefaultsApplied","rollOutDelay","isBaseSprite","appeared","dragWhileResize","measureFailed","preventShow","cloneTooltip","_prevMeasuredWidth","_prevMeasuredHeight","_measuredWidth","_measuredHeight","_isMeasured","_adapterO","autoSetClassName","setClassName","getCurrentThemes","themes","_themes","_parent","applyInternalDefaults","addToInvalidSprites","beforeDraw","draw","removeFromInvalidSprites","afterDraw","invalidatePosition","addToInvalidPositions","attr","removeSVGAttribute","sizeChanged","prevGroupTransform","transformString","nonScaling","globalScale","dispatch","showTooltipOn","updateTooltipPosition","removeFromInvalidPositions","maskRectangle","_maskRectangle","_clipElement","horizontalCenter","verticalCenter","keys","applyFilters","visible","interactionsEnabled","showOnInit","hidden","hide","applyMask","hideTooltip","showTooltip","reinit","defaultState","nonScalingStroke","strokeWidth","updateFilterScale","filters","filter","states","adapter","plugins","configField","virtualParent","exportable","_tooltip","tooltip","_showSystemTooltip","showSystemTooltip","fillModifier","strokeModifier","removeChild","firstChild","_clones","_svgContainer","_interactionDisposer","_urlDisposer","_numberFormatter","_focusFilter","clonedFrom","id","_filters","_alwaysShowDisposers","applyAccessibility","_topParent","oldParent","baseId","_tooltipContainer","handleAlwaysShowTooltip","handleAlwaysShow","oldDisposers","oldDisposer","disposer","addDisposer","_virtualParent","appendDefs","filterElement","appendDef","modify","_clipPath","_map","delayedMap","_delayedMap","_id","hasKey","setKey","_paper","_htmlContainer","_titleElement","_descriptionElement","onAll","setSVGAttributes","opacity","fillOpacity","strokeOpacity","shapeRendering","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","focusable","tabindex","role","attribute","removeAttr","classNamePrefix","addClass","userClassName","uidAttr","updateClipPath","mask","createClipPath","getUniqueId","removeChildNodes","filterUnits","appendPrimitives","w","h","removeClipPath","setElement","SVGPathElement","definedBBox","svgBBox","getBBox","prevElementTransform","elementX","elementY","elementWidth","elementHeigth","pixelPerfect","pixelPerfectPrecision","positionPrecision","matrix","createSVGMatrix","c","d","createSVGPoint","p3","p4","pt1","matrixTransform","pt2","pt3","pt4","isHover","tooltipText","tooltipHTML","insertBefore","insertAfter","getRelativeX","getRelativeY","getPixelX","pixel","relative","getPixelY","isDragged","apply","get","set","inited","reset","hitTest","ax1","ay1","ax2","ay2","bx1","by1","bx2","by2","_states","state","processState","hiddenState","hoverable","clickable","clones","_animations","getSvgPoint","animate","animationOptions","duration","isHidden","setVisibility","transitionEasing","transitTo","applyCurrentState","animation","isDown","downPointers","isFocused","transition","options","propValues","allValues","propertyName","finalValue","currentValue","option","property","isFinished","stateFilter","newFilter","currentFilter","isInTransition","animations","isInteractive","handleOver","isRealHover","handleOut","handleDown","handleUp","handleFocus","handleBlur","current","setDisabled","hasChild","numberFormatter","language","_dateFormatter","dateFormatter","_durationFormatter","durationFormatter","exporting","populateString","string","tags","escape","tag","getTagValue","unescape","tagName","matches","reg","prop","params","reg2","matches2","method","getTagValueFromObject","dataContext","populateStringFrom","object","formatApplied","part","numberValue","dateValue","parse","durationValue","encodeURIComponent","formatParts","formatterType","config","fieldValue","propValue","applyAll","setColorProperty","setPercentProperty","transform","precision","bind","bindToProperty","modifier","observe","listener","context","call","title","readerTitle","description","readerDescription","readerHidden","checked","readerChecked","controls","readerControls","live","readerLive","orientation","readerOrientation","valueNow","readerValueNow","valueText","readerValueText","labelledByIds","describedByIds","labelledBy","readerLabelledBy","describedBy","readerDescribedBy","titleElement","titleId","textContent","descriptionElement","descriptionId","keyboardOptions","mouseOptions","_interaction","interaction","getInteraction","dom","trackable","draggable","swipeable","resizable","wheelable","contextMenuDisabled","inert","_tabindex","focusedElement","focusFilter","hoverOnFocus","inertiaOptions","applyCursorStyle","handleDragStart","handleDragMove","handleDragStop","touch","originalPosition","dragStart","dragStop","cancelled","hoverOptions","_outTimeout","targetSprite","keepTargetHover","handleOutReal","hitOptions","originalAngle","originalScale","handleToggle","urlHandler","cursorOverStyle","_baseId","setBaseId","baseSprite","urlTarget","open","swipeOptions","handleResize","svgPoint1","point1","svgPoint2","point2","svgMidPoint","parentPoint1","startPoint1","parentPoint2","startPoint2","spritePoint1","spritePoint2","spriteMidPoint","parentPoint","cursorOptions","style","overStyle","defaultStyle","applyCursorOverStyle","downStyle","pointerEvents","getExporting","exp","_export","nonExportableSprites","modalPrefix","modal","has","openModal","closeModal","popups","openPopup","closeAllPopups","minX","maxX","minY","maxY","parentWidth","setMaxWidth","prevWidth","prevHeight","previousWidth","previousHeight","parentHeight","setMaxHeight","_relativeHeight","_relativeWidth","margin","marginTop","marginRight","marginBottom","marginLeft","padding","setPath","setFill","realFill","setStroke","realStroke","_rtl","show","showReal","_hideAnimation","kill","_showHideDisposer","hideReal","currentSprite","getVisibility","toFront","toBack","removeClass","tooltipDataItem","_tooltipDataItem","_tooltipColorSource","tooltipPosition","lastPointer","tooltipColorSource","getStrokeFromObject","getFillFromObject","animationDuration","label","autoTextColor","alternative","html","currentText","globalPoint","getTooltipX","getTooltipY","pointTooltipTo","instantly","showInViewport","pointTo","raiseCriticalError","closable","content","message","suppressErrors","verbose","console","processConfig","getCursorStyle","cursorDowntyle","processDelayedMap","grab","grabbing","horizontalResize","verticalResize","default","configOrder","setShowOnInit","_showOnInitDisposer","hideInitially","appear","_plugins","init","Sprite","_disposed","_uid","addDelayedMap","theme","clearCache","splice","cloneId","newObject","constructor","_className","ttl","fn","delay","clearTimeout","setInterval","configKey","configValue","hasProperty","asIs","createClassInstance","processAdapters","processEvents","asFunction","BaseObject","processListTemplate","processOrderedTemplate","templateValue","entryKey","entryValue","listItem","processDictionaryTemplate","processList","maybeColorOrPercent","processDictionary","isReserved","processingErrors","errors","_processingErrors","entry","callback","priority","getConfigEntryType","insert","itemCount","extraCount","createEntryInstance","field","eventType","rootStylesheet","SVGNS","XMLNS","XLINK","addEventListener","removeEventListener","getElement","el","getElementById","getElementsByClassName","HTMLElement","classList","classes","currentClassName","getAttribute","setAttribute","remove","setStyle","currentStyle","defaultView","blur","activeElement","input","createElement","position","focus","fo","createElementNS","outerHTML","twrap","tnode","cloneNode","innerHTML","isElement","Object","nodeType","cursor","parentNode","host","getShadowRoot","getRoot","owner","ownerDocument","eventTarget","composedPath","copyAttributes","attributes","fixPixelPerfect","round","selector","styles","root","nonce","head","sheet","getStylesheet","cssRules","_rule","deleteRule","insertRule","appendStylesheet","selectorText","_setVendorPrefixName","setProperty","styleId","StyleRule","ready","readyState","findFont","font","parentElement","findFontSize","isElementInViewport","viewportTarget","targets","viewportRect","documentElement","polyline","points","lineTo","prevPoint","minStep","minPolylineStep","quadraticCurveTo","controlPoint","cubicCurveTo","controlPointA","controlPointB","closePath","arcTo","startAngle","arc","radius","radiusY","segments","ceil","l","pax","pay","cx","cy","endAngle","ax","ay","innerRadius","cornerRadius","innerCornerRadius","temp","crSin","innerRadiusY","cornerRadiusY","innerCornerRadiusY","crAngle","asin","crAngleY","crInnerAngle","crInnerAngleY","middleAngle","mPoint","a0","b0","c0","d0","b1","d1","arcToPoint","sweepFlag","largeArcFlag","xAxisRotation","Boolean","rectangle","rectToPath","ccw","L","pathToPoints","pointCount","svgPath","getPointAtLength","getTotalLength","toPoints","spiralPoints","step","radiusStep","stepSize","degrees","cos","sin","pointsToPath","_callbackId","_callbacks","addAll","scope","callbacks","globalAdapter","GlobalAdapter","enableKey","disableKey","amount","_hasListenersByType","_shouldDispatch","count","PX","STRING","NUMBER","DATE","DURATION","PLACEHOLDER","PLACEHOLDER2","onlyShowOnViewport","queue","autoDispose","suppressWarnings","animationsEnabled","deferredDelay","disableHoverOnTransform","_globalEventsAdded","_pointerEvents","_usePointerEventsOnly","_useTouchEventsOnly","_addHoverEvents","_passiveSupported","_delayedEvents","overObjects","downObjects","trackedObjects","transformedObjects","pointers","hasOwnProperty","pointerdown","pointerup","pointermove","pointercancel","pointerover","pointerout","matchMedia","navigator","userAgent","fullFF","wheel","onmousewheel","Interaction","passiveSupported","addGlobalEvents","handleGlobalPointerDown","handleGlobalPointerMove","handleGlobalPointerUp","relatedTarget","buttons","which","handleDocumentLeave","handleGlobalTouchStart","handleGlobalTouchMove","handleGlobalTouchEnd","handleGlobalKeyDown","handleGlobalKeyUp","processClickable","io","processTouchable","processContextMenu","eventDisposers","preventDefault","processHoverable","handlePointerOut","handlePointerOver","processMovable","isGlobalElement","prepElement","processTrackable","processDraggable","processSwipeable","processResizable","processWheelable","handleMouseWheel","passive","unlockWheel","lockWheel","processFocusable","handleFocusBlur","handleTouchDown","handlePointerDown","isPaused","imev","getHitOption","disableType","enableType","focusedObject","isKey","ko","getEventKey","directionY","directionX","getPointer","getPointerPoint","addBreadCrumb","handleGlobalMove","processDelayed","preventTouchAction","defaultPrevented","handleGlobalUp","changedTouches","button","resetPointer","deltaX","deltaY","mod","deltaMode","getMouseOption","WheelEvent","wheelDeltaX","wheelDeltaY","handleWheel","maybePreventDefault","handleHit","now","lastHit","lastHitPointer","soft","hoversPaused","shouldCancelHovers","areTransformed","moved","cancelAllHovers","overPointers","handleTrack","force","hasDelayedOut","old","behavior","getHoverOption","keepUntil","timeout","delayedEvent","stopInertia","applyCursorDownStyle","processDragStart","processResizeStart","sorted","pos","compareDocumentPosition","Node","DOCUMENT_POSITION_CONTAINED_BY","DOCUMENT_POSITION_CONTAINS","restoreCursorDownStyle","swiped","handleSwipe","handleInertia","processDragStop","processResizeStop","cancelable","lastEvent","swiping","handleTransform","skipCheck","startPoint","handleMoveInertia","handleResizeInertia","inertia","ref","getTrailPoint","getInertiaOption","factor","done","inertias","lastUpEvent","pointer2","pointer1","singlePoint","nextPointer","pointer1Moved","dragStartEvents","handleTransformMove","pointer2Moved","handleTransformResize","ctrlKey","pointerMoved","dragTarget","getDragPointer","lastDownEvent","getPointerId","identifier","pointerId","clientX","clientY","isPointerTouch","Touch","PointerEvent","pointerType","MouseEvent","startTime","track","swipeCanceled","lockDocument","unlockDocument","restoreAllStyles","lockElement","unlockElement","wheelLockEvent","doc","elementFromPoint","local","props","setTemporaryStyle","unprepElement","restoreStyle","getSwipeOption","getKeyboardOption","setGlobalStyle","restoreGlobalStyle","tolerance","minTime","getShift","timestamp","pointerExists","exists","replacedStyles","logTouch","TouchEvent","except","defineProperty","_rules","_appliedRules","_appliedTargets","_useDefault","_enabled","_responsiveDisposers","_noStates","rules","checkRules","_component","disposeResponsiveHandlers","enabled","applyRules","defaultRules","useDefault","isApplied","ruleId","rule","allRules","rulesChanged","relevant","newTarget","defaultStateApplied","getState","getDefaultState","setTargetState","stateId","tmpId","getValue","widthXXS","container","ResponsiveBreakpoints","XXS","widthXS","XS","widthS","S","widthM","M","widthL","widthXL","XL","widthXXL","XXL","heightXXS","heightXS","heightS","heightM","heightL","heightXL","heightXXL","isXXS","isXS","isS","isM","isL","isXL","isXXL","maybeXXS","maybeXS","maybeS","maybeM","maybeL","maybeXL","maybeXXL","linear","quadIn","quadOut","quadInOut","polyIn","pow","polyOut","polyInOut","polyIn3","polyOut3","polyInOut3","expIn","expOut","expInOut","sinIn","sinOut","sinInOut","cubicIn","cubicOut","cubicInOut","circleIn","sqrt","circleOut","circleInOut","bounceIn","bounceOut","bounceInOut","tau","PI","period","s","elasticIn","elasticOut","elasticInOut","disposed","loop","getProgressNumber","progress","getProgressPercent","getProgressColor","getHybridProperty","charAt","_disposer","_loop","_pause","_delayTimeout","_time","_isFinished","pause","stopSameAnimations","_startTime","staticOptions","childObject","updateMethod","convertedFrom","isNaN","applyStaticOptions","update","resume","setProgress","stop","skipEvent","timeProgress","delayed","newOptions","oldOptions","isOversized","wrap","truncate","textAlign","textValign","baseLineRatio","handleMaxSize","hardInvalidate","availableWidth","availableHeight","alignSVGText","updateCurrentText","output","supportsForeignObject","_currentFormat","_prevStatus","getLineBBox","lineInfo","oldW","oldH","status","lines","display","getAttr","textPathElement","resetBBox","currentHeight","currentFormat","line","chunks","chunk","ignoreFormatting","currentLineHeight","firstChunk","skipTextChunks","getLineInfo","getSVGLineElement","complex","translateStyleShortcuts","getSvgElement","lineText","avgCharWidth","excessChars","addEllipsis","elementText","lastNode","lastChild","splitLines","cleanUp","restOfLine","addLineInfo","tempElement","offset","maybeHideOversized","hideUnused","foreignObject","lineElement","getHTMLLineElement","overflow","setStyles","pathElement","hideOversized","removeAttribute","div","wordWrap","whiteSpace","direction","selectable","addStyle","removeStyle","initLineCache","attrNS","_sourceDataItemEvents","classid","btoa","defs","Label","_isPaused","dummyCounter","_frameRequested","updateStepDuration","time","reportTime","msg","invalidDatas","invalidData","dataProvider","validateData","dataValidationProgress","invalidRawDatas","validateRawData","invalidDataItems","validateDataItems","invalidDataRange","validateDataRange","skipRangeEvent","invalidLayouts","validateLayouts","invalidPositions","validatePositions","hasSkipped","invalidSprites","checkIfValidate2","softInvalidate","VERSION","system","System","keyCode","eventKey","shiftKey","altKey","metaKey","keyboard","Keyboard","tooltipY","iconPosition","interfaceColors","hoverState","downState","_icon","icon","currentIcon","_label","Button","OrderedList","findClosestIndex","closestValue","closestDifference","closestIndex","difference","_ordering","last","OrderedListTemplate","SortedList","namedColors","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgrey","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","hexToRgb","rgbaToRgb","m","result","parseInt","hexToRgbWithAlpha","rgbToHex","pad2","rgbToRGBA","interpolate","rgb1","rgb2","getLightnessStep","getBrightnessStep","hsl","rgbToHsl","hslToRgb","hue2rgb","q","rgbToHsv","hsvToRgb","isLight","setAttributeNS","elementName","groupName","append","implementation","hasFeature","ghostPaper","getGhostPaper","ghostDiv","ghostSvgContainer","Paper","_stops","_rotation","x1","y1","x2","y2","gradientElement","gradientStop","addColor","stops","gradientUnits","LinearGradient","Adapter","_locale","en","_defaultLocale","defaultLocale","locale","getLocale","translate","prompt","translation","translations","getTranslations","rest","translateAny","setTranslationAny","translateEmpty","translateFunc","translateAll","isDefault","Base","formatter","formatted","texts","getPlaceholder","wrapHtml","wrapSvg","styleSvgToHtml","getHtmlElement","quotedBlocks","noFormatting","chunks2","i2","chunk2","isImage","getTextFormatter","TextFormatter","minSide","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomRight","cornerRadiusBottomLeft","maxcr","crtl","crtr","crbr","crbl","tl","tr","bl","br","RoundedRectangle","_scale","_nonScaling","filterPrimitives","filterPrimitive","updateScale","setSprite","_sprite","fx","fy","_cx","_cy","_fx","_fy","RadialGradient","notAllowed","dataFields","_dataSources","_parseDataFrom","_dataDisposers","_currentDataSetId","rangeChangeDuration","rangeChangeEasing","parsingStepDuration","rawDataInvalid","dataRangeInvalid","dataItemsInvalid","interpolationDuration","interpolationEasing","sequencedInterpolation","sequencedInterpolationDelay","_addAllDataItems","_usesData","minZoomCount","maxZoomCount","_dataItems","createDataItem","handleDataItemAdded","handleDataItemRemoved","invalidateData","dataUsers","handleDataUserAdded","maxZoomDeclination","handleDataItemValueChange","invalidateDataItems","handleDataItemWorkingValueChange","handleDataItemWorkingLocationChange","handleDataItemCalculatedValueChange","handleDataItemPropertyChange","processDataItem","fieldName","hasChildren","mainDataSet","rawDataItem","childDataItem","updateDataItem","validateDataElements","endIndex","startIndex","dataItems","validateDataElement","addData","removeCount","skipRaw","removeData","dataUser","addToInvalidComponents","invalidateDataUsers","invalidateDataRange","_prevStartIndex","_prevEndIndex","rangeChangeUpdate","appendDataItems","sliceData","_workingStartIndex","_workingEndIndex","invalidateRawData","disposeData","_startIndex","_endIndex","_dataSets","getDataItem","removeFromInvalidComponents","_data","counter","n","dataUserDataItem","setData","getDataSource","setDataSourceEvents","dataSourceDateFields","dataSourceNumberFields","loadData","load","populateDataSourceFields","targetList","ds","incremental","keepCount","updateCurrentData","_responsive","zoom","declination","maxZoomFactor","_finalStart","_finalEnd","minZoomFactor","rangeChangeAnimation","zoomToIndexes","indexToPosition","dataSets","setDataSet","_updateDataItemIndexes","_index","bindDataField","invalidateProcessedData","resetProcessedRange","_dataUsers","_exportData","handleDataUpdated","arg","_showOnInitDisposer2","Component","hasProperties","categories","dates","locations","workingLocations","_visible","_hidden","_ignoreMinMax","_valueAnimations","_locationAnimations","noChangeValues","fields","_hideDisposer","setWorkingValue","toValue","anim","getDuration","calculated","getWorkingValue","realName","workingValue","getActualWorkingValue","setValue","newDuration","setCalculatedValue","handleInterpolationProgress","valueAnimation","setLocation","setWorkingLocation","workingLocation","locationAnimation","setDate","getDate","setCategory","hasValue","depth","_dataContext","addSprite","_elements","patternUnits","backgroundFill","backgroundOpacity","patternElement","rotationX","rotationY","addElement","elements","Pattern","_dateFormat","_inputDateFormat","_utc","timezoneMinutes","_firstDayOfWeek","months","monthsShort","weekdays","weekdaysShort","_outputFormat","dateFormat","applyTimezone","intlLocales","Intl","DateTimeFormat","info","parseFormat","timezoneOffset","setMinutes","getMinutes","timezone","applyFormat","fullYear","month","minutes","seconds","milliseconds","getUTCFullYear","getUTCMonth","getUTCDay","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","getHours","getSeconds","firstDayOfWeek","tz","tzh","tzm","toISOString","toUTCString","inputDateFormat","parsedIndexes","resValues","indexAdjust","year3","year2","year1","getStringList","monthLong","monthShort","yearDay","weekdayLong","weekdayShort","am","hour12Base1","hourBase0","hour12Base0","hourBase1","minute","second","millisecond","millisecondDigits","zone","iso","regex","resolveMonth","resolveShortMonth","hour","isAm","ts","resolveTimezoneOffset","UTC","dir","invalidateSprite","_intlLocales","_timezoneOffset","_timezone","DateFormatter","pixelRadius","Circle","tensionX","tensionY","_tensionX","_tensionY","smooth","p0","first","closed","wavedLine","waveLength","waveHeight","tension","adjustWaveLength","distance","atan2","waveLengthX","waveLengthY","halfWaveCount","Tension","reversed","_reversed","_closed","_curve","x0","y0","t0","t1","NaN","slope2","slope3","sign","h0","h1","s0","s1","Monotone","x3","x4","y3","y4","pushCurve","pushPoint","_isDisposed","_x","_y","_rotationY","_rotationX","removeNode","_transformString","transfromString","rotateString","svgbbox","attributeName","attributeValue","ns","getAttrNS","getAttributeNS","getStyle","setClass","Rectangle","_distance","makePath","_realSegments","positionToPoint","deltaAngle","totalDistance","currentDistance","positionA","positionB","pointA","pointB","positionAB","midPoint","Polyline","_boundingRect","_pointTo","fitPointerToBounds","_verticalOrientation","fixDoc","pointerLength","pointerBaseWidth","dropShadow","drawBackground","pointerOrientation","animationEasing","handleVisibility","textX","textY","boundingRect","textW","textH","ignoreBounds","documentWidth","offsetWidth","offsetHeight","textWidth","textHeight","bgWidth","bgX","bgHeight","bgY","boundX1","boundX2","boundY1","boundY2","pointerX","pointerY","delayedPointTo","_pointToDisposer","_animation","setBounds","oldRect","_boundingContainer","updateBounds","boundingContainer","Tooltip","spriteValue","SpriteState","or","_interactionEvents","_dispatchSpriteEvent","_dispatchSpritePointEvent","spritePoint","svgPoint","_addInteractionObjectEvent","insertKeyIfEmpty","increment","_on","disposers","togglable","_domEvents","_addDOMEvent","_dispatchKeyboardEvent","timeUnitDurations","getNextUnit","unit","checkChange","dateOne","dateTwo","timeZoneOffset1","timeZoneOffset2","setUTCMinutes","nextUnit","timeZoneOffset","setUTCDate","setUTCSeconds","setUTCMilliseconds","setUTCHours","setUTCMonth","wday","newTimeZoneOffset","firstDateOfWeek","firstDate","roundMinutes","setTimezone","unitCount","setTime","weekDay","timeZone","getTimezoneMinutes","setHours","showCurtain","messages","warn","_negativeBase","_numberFormat","_smallNumberThreshold","NumberFormat","details","zero","active","partFormat","mods","modSpacing","thousands","interval","prefix","suffix","applyPrefix","bytePrefixes","smallNumberThreshold","smallNumberPrefixes","bigNumberPrefixes","ol","toPrecision","toExponential","ints","ip","intsr","decs","prefixes","newvalue","applied","k","_bigNumberPrefixes","_smallNumberPrefixes","_bytePrefixes","outputFormat","NumberFormatter","_baseUnit","_unitValues","_unitAliases","baseUnit","durationFormat","dirs","absolute","tstamp","toTimeStamp","toTimeUnit","code","maxValue","maxUnit","getValueUnit","durationFormats","currentUnit","ms","_durationFormat","_durationFormats","DurationFormatter","_validateDisposer","Promise","success","error","isBlob","responseType","xhr","XMLHttpRequest","onload","response","readBlob","then","blob","getResponseHeader","responseText","onerror","withCredentials","requestHeaders","header","setRequestHeader","send","reader","FileReader","readAsText","sources","isArray","promises","requestOptions","all","processData","catch","getParserByType","contentType","parser","getParserByData","isJSON","isCSV","dataLoader","DataLoader","separators","delimiter","skipRows","skipEmpty","useColumnNames","CSVParser","getDelimiterFromData","sep","columns","lineColums","csv","col","CSVToArray","empty","emptyAs","numbers","parsableNumbers","parsableDates","cols","dataPoint","maybeToEmpty","maybeToNumber","maybeToDate","objPattern","arrData","arrMatches","strMatchedDelimiter","strMatchedValue","numberFields","dateFields","allPoints","realPoints","stepCount","getClosestPointIndex","closest","extend","f0","f1","Polyspline","_previousStart","_previousEnd","_prevStart","_prevEnd","_isBusy","_skipRangeEvents","updateWhileMoving","startGrip","endGrip","updateThumb","thumb","dispatchRangeChange","hideGrips","updateSize","updateExtremes","handleBgHit","makeBusy","thumbX","_thumbAnimation","thumbY","makeUnbusy","_thumb","_unbusyTimeout","stopAnimations","_zoomAnimation","makeUnbusyReal","_usingGrip","getPosition","__start","__end","skipRangeEvents","fixRange","updateByOrientation","_startGrip","processGrip","_endGrip","handleGripDrag","cursorDownStyle","handleThumbPosition","handleDoubleClick","newStart","newEnd","zoomAnimation","_hideGrips","_overDisposer","_outDisposer","Scrollbar","Triangle","waveLengthH","waveHeightH","waveLengthV","waveHeightV","td","rd","bd","ld","wavedTop","wavedRight","wavedBottom","wavedLeft","setWavedSides","_targets","_observer","ResizeObserver","entries","addTarget","box","removeTarget","unobserve","_timer","requestAnimationFrame","currentTime","Raf","newSize","size","cancelAnimationFrame","observer","_sensor","svgContainers","ghost","autoResize","_printing","resizeSensor","checkTransform","_container","_modal","Modal","close","_popups","popupTemplate","Popup","popup","_readerAlertElement","readerAlert","readerAlertElement","Dictionary","_IOs","_content","_title","_classPrefix","_defaultStyles","_showCurtain","_draggable","_align","_dynamicResize","_verticalAlign","_shift","_tempShift","_readerTitle","_closable","_cssLoaded","_fitTo","_sized","wrapper","curtain","positionElement","releasePointers","forceResize","dynamicResize","images","getElementsByTagName","image","complete","toStyle","verticalAlign","setupDragging","off","createContentElement","getClassNames","wrapperClass","classPrefix","headerClass","titleClass","contentClass","insideClass","curtainClass","closeClass","classNames","disablePointers","visibility","defaultStyles","loadDefaultCSS","createCurtainElement","applyEvents","applyReaderSettings","_left","_right","_top","_bottom","fg","bg","abg","_spriteInteractionsEnabled","classPrefixRaw","childNode","_clickable","_contextMenuDisabled","_hoverable","_trackable","_swipeable","_resizable","_wheelable","_inert","_isHover","_isHoverByTouch","_isDown","_isFocused","_isTouchProtected","_inertiaOptions","_hitOptions","_hoverOptions","_swipeOptions","_keyboardOptions","_mouseOptions","_cursorOptions","isHoverByTouch","_overPointers","_downPointers","_focusable","_originalPosition","_originalScale","_originalAngle","keyboardEvent","_startedOn","speed","accelleration","accellerationDelay","accelleratedMs","accellerationFactor","handleMove","pdfmakePromise","fontFamilySrcRegexp","getCssRules","loadStylesheet","eachStylesheet","topUrl","CSSRule","IMPORT_RULE","eachStylesheets","iframe","src","contentDocument","styleSheets","_formatOptions","_extraSprites","_validateSprites","dataFieldsOrder","_dynamicDataFields","_removedObjects","_hiddenObjects","_objectsAlreadyHidden","_filePrefix","useWebFonts","useRetina","useSimplifiedExport","timeoutDelay","_exportRunning","_prevHasData","quality","fontSize","imageFormat","addURL","addColumnNames","indent","useLocale","addBOM","printMethod","formatOptions","_menu","menu","branch","unsupported","typeSupported","export","_disablePointers","_releasePointers","obj","supported","getFormatOptions","_hasData","print","_getFunction","getImage","getSVG","getPDF","getExcel","getCSV","getJSON","getHTML","getPrint","handleCustom","showPreloader","hideTimeout","_timeoutTimeout","showTimeout","hideNonExportableSprites","func","restoreNonExportableSprites","hidePreloader","download","filePrefix","callbackTarget","getFontFamilies","DOMURL","getDOMURL","blobs","FONT_FACE_RULE","cssText","urls","after","fullUrl","webFontFilter","msSaveOrOpenBlob","createObjectURL","resolve","reject","readAsDataURL","includeExtras","prehidden","awaitValidSprites","simplifiedImageExport","canvas","getCanvas","addExtras","uri","toDataURL","getContentType","disposeCanvas","stack","getImageAdvanced","advanced","extraSprites","extraSprite","extra","getCanvasAdvanced","extraCanvas","extraWidth","extraHeight","crop","extras","newCanvas","getDisposableCanvas","getContext","backgroundColor","findBackgroundColor","fillStyle","fillRect","drawImage","pixelRatio","getAdjustedScale","ctx","fonts","imagesToDataURI","prepForeignObjects","normalizeSVG","serializeElement","Blob","loadNewImage","img","revokeObjectURL","restoreRemovedObjects","canvg","useCORS","ignoreDimensions","scaleWidth","scaleHeight","fromString","render","widthScale","heightScale","adjWidth","adjHeight","querySelectorAll","Export","svgToDataURI","imageToDataURI","objects","temporarilyRemoveObject","keepTainted","charset","placeholder","cache","crossOrigin","currentHref","Image","onabort","self","URL","webkitURL","encodeURI","dimParams","styleParams","fos","XMLSerializer","serializeToString","addFont","paths","normal","vfs","bytes","bold","italics","bolditalics","pdfmake","defaultMargins","pageSize","pageOrientation","pageMargins","extraMargin","alignment","fit","getPageSizeFit","getPDFData","table","extraFonts","createPdf","getDataUrl","dataRow","dataValue","convertToSpecialFormat","getPDFDataRow","headerRows","items","convertEmptyValue","margins","newMargins","fitSize","A0","A1","A2","A3","A4","A5","A6","A7","A8","A9","A10","B0","B1","B2","B3","B4","B5","B6","B7","B8","B9","B10","C0","C1","C2","C3","C4","C5","C6","C7","C8","C9","C10","RA0","RA1","RA2","RA3","RA4","SRA0","SRA1","SRA2","SRA3","SRA4","EXECUTIVE","FOLIO","LEGAL","LETTER","TABLOID","xlsx","XLSX","wbOptions","bookType","bookSST","sheetName","normalizeExcelSheetName","wb","SheetNames","Sheets","getExcelRow","utils","aoa_to_sheet","workbook","write","getCSVRow","forceQuotes","search","tableClass","getHTMLRow","headerRow","rowClass","charCodeAt","useTag","cellClass","sourceData","json","keepOriginal","isDateField","isDurationField","isNumberField","numberFormat","useTimestamps","fileName","msBlobDownloadSupport","decodeURIComponent","msSaveBlob","decoded","atob","chars","charCode","Uint8Array","blobDownloadSupport","click","linkDownloadSupport","link","legacyIE","showModal","idoc","execCommand","downloadSupport","printViaCSS","printViaIframe","scroll","scrollTop","originalTitle","clipPath","test","MSStream","contentWindow","currentColor","validateSprites","_dataFields","generateDataFields","hasData","_dateFields","_numberFields","_durationFields","durationFields","_backgroundColor","hideModal","_canvg","vfs_fonts","global","pdfMake","_pdfmake","_xlsx","setFormatOptions","_requestOptions","_incremental","_incrementalParams","_keepCount","_updateCurrentData","lastLoad","disableCache","timestampUrl","_url","addUrlParams","incrementalParams","_parser","_reloadFrequency","_reloadDisposer","_reloadTimeout","reloadFrequency","delta","Line","cr","stemX","stemY","bwh","lineT","lineR","lineB","lineL","d2","arcTR","arcBR","arcBL","arcTL","controlPointDistance","controlPointPosition","distanceAB","cpDistance","controlPoint1","controlPoint2","Polyarc","_currentPoints","segment","areaHole","areaArr","holeArr","pointsArr","area","areaAndHole","coords","hole","surface","hlen","_morpher","Polygon","morphable","_bboxes","morphDuration","morphEasing","morphToSingle","scaleRatio","morphToPolygon","currentPoints","sortPoints","_morphFromPointsReal","_morphToPointsReal","normalizePoints","pointsA","pointsB","surfaceA","holeA","bboxA","middleX","middleY","addPoints","splitAt","newDistance","partA","partB","bbox1","bbox2","bboxes","morphToCircle","commonBBox","fromPoints","realRadius","realAngle","pointOnCircle","mustHaveCount","addToSegmentCount","newPoints","point0","extraPoint","lastPoint","morphToRectangle","realWidth","realHeight","_morphProgress","currentArea","surfaceFrom","holeFrom","surfaceTo","holeTo","currentSurface","slen","currentPoint","currentHole","morphBack","ResizeButton","feGaussianBlur","feOffset","feFlood","feComposite","operator","feMerge","DropShadowFilter","_list","_currentStep","_currentPass","baseColor","stepOptions","passOptions","minColors","minLightness","maxLightness","shuffle","reuse","generate","getReusableColor","tmpstep","next","curColor","hueStep","hue","lightness","hues","applyStepOptions","pass","ColorSet","closeDelay","closeOnClick","_menuTag","_itemTag","_labelTag","_iconTag","_ignoreNextClose","_items","getMenuItemClass","createMenuElement","drawBranch","menuElement","_currentSelection","moveSelection","level","ascendants","createItemElement","createIconElement","createSvgElement","createLabelElement","readerLabel","getReaderLabel","typeClickable","getSubMenu","selectBranch","setFocus","delayUnselectBranch","local_level","submenu","submenuElement","hideBranch","menuTag","itemTag","labelTag","iconTag","DOMParser","parseFromString","hasSubMenu","newPrefix","colorSet","Language","setBlur","closeTimeout","ascendant","unselectBranch","simple","newSelection","getPrevSibling","getNextSibling","getParentItem","getSiblings","siblings","prev","showBranch","Validatable","isSafari","vendor","isInternetExplorer"],"mappings":"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","file":"static/js/1.469deff1.chunk.js","sourcesContent":["/**\r\n * A collection of universal utility functions.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite } from \"../Sprite\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { IRectangle } from \"../defs/IRectangle\";\r\nimport { Percent } from \"./Percent\";\r\nimport { isSafari } from \"./Browser\";\r\nimport * as $math from \"../utils/Math\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $string from \"./String\";\r\nimport * as $strings from \"./Strings\";\r\nimport * as $object from \"./Object\";\r\nimport * as $array from \"./Array\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MISC FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n\r\n/**\r\n * Marks a value as being used (e.g. because the value has side effects).\r\n */\r\nexport function used<A>(value: A) { }\r\n\r\n/**\r\n * Copies all properties of one object to the other, omitting undefined.\r\n *\r\n * @param fromObject  Source object\r\n * @param toObject    Target object\r\n * @return Updated target object\r\n * @todo Maybe consolidate with utils.copy?\r\n */\r\nexport function copyProperties(source: Object, target: Object): Object {\r\n\t$object.each(source, (key, value) => {\r\n\t\t// only if value is set\r\n\t\tif ($type.hasValue(value)) {\r\n\t\t\t(<any>target)[key] = value;\r\n\t\t}\r\n\t});\r\n\r\n\treturn target;\r\n}\r\n\r\n/**\r\n * Removes target from url\r\n */\r\nexport function stripHash(url: string): string {\r\n\treturn /^[^#]*/.exec(url)[0];\r\n}\r\n\r\nexport function getBaseURI() {\r\n\tlet url = \"#\";\r\n\r\n\t// Needed until https://bugs.webkit.org/show_bug.cgi?id=189499 is fixed\r\n\tif (isSafari()) {\r\n\t\tlet baseURI = document.baseURI;\r\n\t\tif (baseURI) {\r\n\t\t\tbaseURI = stripHash(baseURI);\r\n\t\t\tlet loc = stripHash(location.href);\r\n\t\t\tif (baseURI !== loc) {\r\n\t\t\t\turl = loc + url;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn url;\r\n}\r\n\r\n/**\r\n * Copies all properties of one object to the other, omitting undefined, but only if property in target object doesn't have a value set.\r\n *\r\n * @param fromObject  Source object\r\n * @param toObject    Target object\r\n * @return Updated target object\r\n * @todo Maybe consolidate with utils.copy?\r\n */\r\nexport function softCopyProperties(source: Object, target: Object): Object {\r\n\t$object.each(source, (key, value) => {\r\n\t\t// only if value is set\r\n\t\tif ($type.hasValue(value) && !($type.hasValue((<any>target)[key]))) {\r\n\t\t\t(<any>target)[key] = value;\r\n\t\t}\r\n\t});\r\n\treturn target;\r\n}\r\n\r\n/**\r\n * Copies all properties of one object to the other.\r\n *\r\n * @param source     Source object\r\n * @param recipient  Target object\r\n * @return Updated target object\r\n */\r\nexport function copy(source: Object, target: Object): Object {\r\n\t$object.each(source, (key, value) => {\r\n\t\t(<any>target)[key] = value;\r\n\t});\r\n\treturn target;\r\n}\r\n\r\n/**\r\n * Checks if value is not empty (undefined or zero-length string).\r\n *\r\n * @param value  Value to check\r\n * @return `true` if value is not \"empty\"\r\n */\r\nexport function isNotEmpty(value: $type.Optional<string>): value is string {\r\n\treturn $type.hasValue(value) && (value.toString() !== \"\");\r\n}\r\n\r\n/**\r\n * [relativeToValue description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param percent  [description]\r\n * @param full     [description]\r\n * @return [description]\r\n */\r\nexport function relativeToValue(percent: $type.Optional<number | Percent>, full: number): number {\r\n\tif ($type.isNumber(percent)) {\r\n\t\treturn percent;\r\n\t} else if (percent != null && $type.isNumber(percent.value) && $type.isNumber(full)) {\r\n\t\treturn full * percent.value;\r\n\r\n\t} else {\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\n/**\r\n * [relativeRadiusToValue description]\r\n *\r\n * Differs from relativeToValue so that if a value is negative, it subtracts\r\n * it from full value.\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param percent             [description]\r\n * @param full                [description]\r\n * @param subtractIfNegative  [description]\r\n * @return [description]\r\n */\r\nexport function relativeRadiusToValue(percent: $type.Optional<number | Percent>, full: number, subtractIfNegative?: boolean): $type.Optional<number> {\r\n\tlet value: $type.Optional<number>;\r\n\r\n\tif ($type.isNumber(percent)) {\r\n\t\tvalue = percent;\r\n\r\n\t\tif (value < 0) {\r\n\t\t\tif (subtractIfNegative) {\r\n\t\t\t\tvalue = full + value;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvalue = full - value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t} else if (percent != null && $type.isNumber(percent.value)) {\r\n\t\tvalue = full * percent.value;\r\n\t}\r\n\r\n\treturn value;\r\n}\r\n\r\n/**\r\n * [valueToRelative description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param value  [description]\r\n * @param full   [description]\r\n * @return [description]\r\n */\r\nexport function valueToRelative(value: number | Percent, full: number): number {\r\n\tif (value instanceof Percent) {\r\n\t\treturn value.value;\r\n\t}\r\n\telse {\r\n\t\treturn value / full;\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns pixel ratio of the current screen (used on retina displays).\r\n *\r\n * @return Pixel ratio\r\n */\r\nexport function getPixelRatio(): number {\r\n\tlet ratio = window.devicePixelRatio || 1;\r\n\treturn ratio;\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * STRING FORMATTING FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Converts camelCased text to dashed version:\r\n * (\"thisIsString\" > \"this-is-string\")\r\n *\r\n * @param str  Input\r\n * @return Output\r\n */\r\nexport function camelToDashed(str: string): string {\r\n\treturn str.replace(/\\W+/g, '-').replace(/([a-z\\d])([A-Z])/g, '$1-$2').toLowerCase();\r\n}\r\n\r\n/**\r\n * Converts tring to uppercase.\r\n *\r\n * @param str  String to convert\r\n * @return uppercased string\r\n * @todo Maybe make it better\r\n */\r\nexport function capitalize(str: string): string {\r\n\tlet arr: string[] = str.split(\"\");\r\n\tarr[0] = arr[0].toUpperCase();\r\n\treturn arr.join(\"\");\r\n}\r\n\r\n/**\r\n * Converts any value into its string representation.\r\n *\r\n * @param value  Value\r\n * @return String represantation of the value\r\n */\r\nexport function stringify(value: any): string {\r\n\treturn JSON.stringify(value);\r\n}\r\n\r\n/**\r\n * Escapes string so it can safely be used in a Regex.\r\n *\r\n * @param value  Unsescaped string\r\n * @return Escaped string\r\n */\r\nexport function escapeForRgex(value: string): string {\r\n\treturn value.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, '\\\\$&');\r\n}\r\n\r\n/**\r\n * Splits the text into multiple lines, respecting maximum character count.\r\n * Prioretizes splitting on spaces and punctuation. Falls back on splitting\r\n * mid-word if there's no other option.\r\n *\r\n * @param text      Text\r\n * @param maxChars  Maximum number of characters per line\r\n * @return An array of split text\r\n */\r\nexport function splitTextByCharCount(text: string, maxChars: number, fullWords?: boolean, rtl?: boolean, fullWordFallback?: boolean): string[] {\r\n\r\n\t// Maybe the text fits?\r\n\tif (text.length <= maxChars) {\r\n\t\treturn [text];\r\n\t}\r\n\r\n\t// Init result\r\n\tlet res: string[] = [];\r\n\r\n\r\n\t// Split by words or by charts\r\n\tif (fullWords) {\r\n\r\n\t\t// Split by words first\r\n\r\n\t\t// Split by spacing\r\n\t\tlet currentIndex: number = -1;\r\n\t\t//let tmpText = text.replace(/([,;:!?\\\\\\/\\.]+[\\s]+|[\\s])/g, $strings.PLACEHOLDER + \"$1\" + $strings.PLACEHOLDER);\r\n\t\tlet tmpText = text.replace(/([,;:!?\\\\\\/\\.]+|[\\s])/g, $strings.PLACEHOLDER + \"$1\" + $strings.PLACEHOLDER);\r\n\t\tlet words = tmpText.split($strings.PLACEHOLDER);\r\n\r\n\t\t// Glue end-of-word punctuation to the word itself\r\n\t\tfor (let i = 1; i < words.length; i++) {\r\n\t\t\tlet word = words[i];\r\n\t\t\tif ((word == \".\" || word == \",\") && words[i - 1].match(/[\\w]+$/)) {\r\n\t\t\t\twords[i - 1] += word;\r\n\t\t\t\twords[i] = \"\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\t// Process each word\r\n\t\tfor (let i = 0; i < words.length; i++) {\r\n\r\n\t\t\t// Get word and symbol count\r\n\t\t\tlet word: string = words[i];\r\n\t\t\tlet wordLength: number = word.length;\r\n\r\n\t\t\t// Ignore empty words\r\n\t\t\tif (wordLength === 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// Check word length\r\n\t\t\tif ((wordLength > maxChars) && (fullWords !== true || fullWordFallback != false)) {\r\n\t\t\t//if (wordLength > maxChars) {\r\n\t\t\t\t// A single word is longer than allowed symbol count\r\n\t\t\t\t// Break it up\r\n\t\t\t\tif (rtl) {\r\n\t\t\t\t\tword = reverseString(word);\r\n\t\t\t\t}\r\n\t\t\t\tlet parts: RegExpMatchArray | null = word.match(new RegExp(\".{1,\" + maxChars + \"}\", \"g\"));\r\n\r\n\t\t\t\t// TODO is this correct ?\r\n\t\t\t\tif (parts) {\r\n\t\t\t\t\tif (rtl) {\r\n\t\t\t\t\t\tfor (let x = 0; x < parts.length; x++) {\r\n\t\t\t\t\t\t\tparts[x] = reverseString(parts[x]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//parts.reverse();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tres = res.concat(parts);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\r\n\t\t\t\t// Init current line\r\n\t\t\t\tif (currentIndex === -1) {\r\n\t\t\t\t\tres.push(\"\");\r\n\t\t\t\t\tcurrentIndex = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Check if we need to break into another line\r\n\t\t\t\tif (((res[currentIndex].length + wordLength + 1) > maxChars) && res[currentIndex] !== \"\") {\r\n\t\t\t\t\tres.push(\"\");\r\n\t\t\t\t\tcurrentIndex++;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Add word\r\n\t\t\t\tres[currentIndex] += word;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Update index\r\n\t\t\tcurrentIndex = res.length - 1;\r\n\t\t}\r\n\t}\r\n\telse {\r\n\r\n\t\t// Splitting by anywhere (living la vida facil)\r\n\t\tlet parts: RegExpMatchArray | null = text.match(new RegExp(\".{1,\" + maxChars + \"}\", \"g\"));\r\n\r\n\t\tif (parts) {\r\n\t\t\tif (rtl) {\r\n\t\t\t\tfor (let x = 0; x < parts.length; x++) {\r\n\t\t\t\t\tparts[x] = reverseString(parts[x]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tres = parts;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Do we have only one word that does not fit?\r\n\t// Since fullWords is set and we can't split the word, we end up with empty\r\n\t// set.\r\n\tif (res.length == 1 && fullWords && fullWordFallback && (res[0].length > maxChars)) {\r\n\t\tres = [];\r\n\t}\r\n\r\n\treturn res;\r\n}\r\n\r\n/**\r\n * Truncates the text to certain character count.\r\n *\r\n * Will add ellipsis if the string is truncated. Optionally, can truncate on\r\n * full words only.\r\n *\r\n * For RTL support, pass in the fifth parameter as `true`.\r\n *\r\n * @param text       Input text\r\n * @param maxChars   Maximum character count of output\r\n * @param ellipsis   Ellipsis string, i.e. \"...\"\r\n * @param fullWords  If `true`, will not break mid-word, unless there's a single word and it does not with into `maxChars`\r\n * @param rtl        Is this an RTL text?\r\n * @return Truncated text\r\n */\r\nexport function truncateWithEllipsis(text: string, maxChars: number, ellipsis: string, fullWords?: boolean, rtl?: boolean): string {\r\n\r\n\tif (text.length <= maxChars) {\r\n\t\treturn text;\r\n\t}\r\n\r\n\t// Calc max chars\r\n\tmaxChars -= ellipsis.length;\r\n\tif (maxChars < 1) {\r\n\t\tmaxChars = 1;\r\n\t\t//ellipsis = \"\";\r\n\t}\r\n\r\n\t// Get lines\r\n\tlet lines = splitTextByCharCount(text, maxChars, fullWords, rtl);\r\n\r\n\t// Use first line\r\n\treturn (lines[0] || \"\") + ellipsis;\r\n}\r\n\r\n/**\r\n * Removes whitespace from beginning and end of the string.\r\n *\r\n * @param str  Input\r\n * @return Output\r\n */\r\nexport function trim(str: string): string {\r\n\treturn str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, \"\");\r\n};\r\n\r\n/**\r\n * Removes whitespace from end of the string.\r\n *\r\n * @param str  Input\r\n * @return Output\r\n */\r\nexport function rtrim(str: string): string {\r\n\treturn str.replace(/[\\s\\uFEFF\\xA0]+$/g, \"\");\r\n};\r\n\r\n/**\r\n * Removes whitespace from beginning of the string.\r\n *\r\n * @param str  Input\r\n * @return Output\r\n */\r\nexport function ltrim(str: string): string {\r\n\treturn str.replace(/^[\\s\\uFEFF\\xA0]+/g, \"\");\r\n};\r\n\r\n/**\r\n * Reverses string.\r\n *\r\n * @param str  Input\r\n * @return Output\r\n */\r\nexport function reverseString(str: string): string {\r\n\treturn str.split(\"\").reverse().join(\"\");\r\n}\r\n\r\n/**\r\n * Removes quotes from the string.\r\n *\r\n * @param str  Input\r\n * @return Output\r\n */\r\nexport function unquote(str: string): string {\r\n\tlet res = str.trim();\r\n\tres = str.replace(/^'(.*)'$/, \"$1\");\r\n\tif (res == str) {\r\n\t\tres = str.replace(/^\"(.*)\"$/, \"$1\");\r\n\t}\r\n\treturn res;\r\n}\r\n\r\n/**\r\n * Pads a string with additional characters to certain length.\r\n *\r\n * @param value  A numeric value\r\n * @param len    Result string length in characters\r\n * @param char   A character to use for padding\r\n * @return Padded value as string\r\n */\r\nexport function padString(value: any, len: number = 0, char: string = \"0\"): string {\r\n\tif (typeof value !== \"string\") {\r\n\t\tvalue = value.toString();\r\n\t}\r\n\r\n\treturn len > value.length ? Array(len - value.length + 1).join(char) + value : value;\r\n}\r\n\r\n/**\r\n * Tries to determine format type.\r\n *\r\n * @ignore Exclude from docs\r\n * @param format  Format string\r\n * @return Format type (\"string\" | \"number\" | \"date\" | \"duration\")\r\n */\r\nexport function getFormat(format: string): string {\r\n\r\n\t// Undefined?\r\n\tif (typeof format === \"undefined\") {\r\n\t\treturn $strings.STRING;\r\n\t}\r\n\r\n\t// Cleanup and lowercase format\r\n\tformat = format.toLowerCase().replace(/^\\[[^\\]]*\\]/, \"\");\r\n\r\n\t// Remove style tags\r\n\tformat = format.replace(/\\[[^\\]]+\\]/, \"\");\r\n\r\n\t// Trim\r\n\tformat = format.trim();\r\n\r\n\t// Check for any explicit format hints (i.e. /Date)\r\n\tlet hints: RegExpMatchArray | null = format.match(/\\/(date|number|duration)$/);\r\n\r\n\tif (hints) {\r\n\t\treturn hints[1];\r\n\t}\r\n\r\n\t// Check for explicit hints\r\n\tif (format === $strings.NUMBER) {\r\n\t\treturn $strings.NUMBER;\r\n\t}\r\n\r\n\tif (format === $strings.DATE) {\r\n\t\treturn $strings.DATE;\r\n\t}\r\n\r\n\tif (format === $strings.DURATION) {\r\n\t\treturn $strings.DURATION;\r\n\t}\r\n\r\n\t// Detect number formatting symbols\r\n\tif (format.match(/[#0]/)) {\r\n\t\treturn $strings.NUMBER;\r\n\t}\r\n\r\n\t// Detect date formatting symbols\r\n\tif (format.match(/[ymwdhnsqaxkzgtei]/)) {\r\n\t\treturn $strings.DATE;\r\n\t}\r\n\r\n\t// Nothing? Let's display as string\r\n\treturn $strings.STRING;\r\n}\r\n\r\n/**\r\n * Cleans up format:\r\n * * Strips out formatter hints\r\n *\r\n * @ignore Exclude from docs\r\n * @param format  Format\r\n * @return Cleaned format\r\n */\r\nexport function cleanFormat(format: string): string {\r\n\treturn format.replace(/\\/(date|number|duration)$/i, \"\");\r\n}\r\n\r\n/**\r\n * Strips all tags from the string.\r\n *\r\n * @param text  Source string\r\n * @return String without tags\r\n */\r\nexport function stripTags(text: string): string {\r\n\treturn text ? text.replace(/<[^>]*>/g, \"\") : text;\r\n}\r\n\r\n/**\r\n * Removes new lines and tags from a string.\r\n *\r\n * @param text  String to conver\r\n * @return Converted string\r\n */\r\nexport function plainText(text: string): string {\r\n\treturn text ? stripTags((\"\" + text).replace(/[\\n\\r]+/g, \". \")) : text;\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * TYPE CONVERSION FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Converts numeric value into string. Deals with large or small numbers that\r\n * would otherwise use exponents.\r\n *\r\n * @param value  Numeric value\r\n * @return Numeric value as string\r\n */\r\nexport function numberToString(value: number): string {\r\n\t// TODO handle Infinity and -Infinity\r\n\tif ($type.isNaN(value)) {\r\n\t\treturn \"NaN\";\r\n\t}\r\n\r\n\tif (value === Infinity) {\r\n\t\treturn \"Infinity\";\r\n\t}\r\n\r\n\tif (value === -Infinity) {\r\n\t\treturn \"-Infinity\";\r\n\t}\r\n\r\n\t// Negative 0\r\n\tif ((value === 0) && (1 / value === -Infinity)) {\r\n\t\treturn \"-0\";\r\n\t}\r\n\r\n\t// Preserve negative and deal with absoute values\r\n\tlet negative = value < 0;\r\n\r\n\tvalue = Math.abs(value);\r\n\r\n\t// TODO test this\r\n\tlet parsed = $type.getValue(/^([0-9]+)(?:\\.([0-9]+))?(?:e[\\+\\-]([0-9]+))?$/.exec(\"\" + value));\r\n\tlet digits = parsed[1];\r\n\tlet decimals = parsed[2] || \"\";\r\n\r\n\tlet res: string;\r\n\r\n\t// Leave the nummber as it is if it does not use exponents\r\n\tif (parsed[3] == null) {\r\n\t\tres = (decimals === \"\" ? digits : digits + \".\" + decimals);\r\n\r\n\t} else {\r\n\t\tlet exponent = +parsed[3];\r\n\r\n\t\t// Deal with decimals\r\n\t\tif (value < 1) {\r\n\t\t\tlet zeros = exponent - 1;\r\n\r\n\t\t\tres = \"0.\" + $string.repeat(\"0\", zeros) + digits + decimals;\r\n\r\n\t\t\t// Deal with integers\r\n\t\t} else {\r\n\t\t\tlet zeros = exponent - decimals.length;\r\n\r\n\t\t\tif (zeros === 0) {\r\n\t\t\t\tres = digits + decimals;\r\n\r\n\t\t\t} else if (zeros < 0) {\r\n\t\t\t\tres = digits + decimals.slice(0, zeros) + \".\" + decimals.slice(zeros);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tres = digits + decimals + $string.repeat(\"0\", zeros);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn negative ? \"-\" + res : res;\r\n}\r\n\r\n/**\r\n * Converts anything to Date object.\r\n *\r\n * @param value  A value of any type\r\n * @return Date object representing a value\r\n */\r\nexport function anyToDate(value: Date | number | string): Date {\r\n\tif ($type.isDate(value)) {\r\n\t\t// TODO maybe don't create a new Date ?\r\n\t\tconst date = new Date(value);\r\n\t\t// This is needed because IE does not copy over milliseconds\r\n\t\tdate.setMilliseconds(value.getMilliseconds());\r\n\t\treturn date;\r\n\t}\r\n\r\n\telse if ($type.isNumber(value)) {\r\n\t\treturn new Date(value);\r\n\t}\r\n\r\n\telse {\r\n\t\t// Try converting to number (assuming timestamp)\r\n\t\tlet num = Number(value);\r\n\r\n\t\tif (!$type.isNumber(num)) {\r\n\t\t\treturn new Date(value);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn new Date(num);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Tries converting any value to a number.\r\n *\r\n * @param value  Source value\r\n * @return Number\r\n */\r\nexport function anyToNumber(value: Date | number | string): $type.Optional<number> {\r\n\tif ($type.isDate(value)) {\r\n\t\treturn value.getTime();\r\n\t}\r\n\r\n\telse if ($type.isNumber(value)) {\r\n\t\treturn value;\r\n\t}\r\n\r\n\telse if ($type.isString(value)) {\r\n\t\t// Try converting to number (assuming timestamp)\r\n\t\tlet num = Number(value);\r\n\r\n\t\tif (!$type.isNumber(num)) {\r\n\t\t\t// Failing\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn num;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * DATE-RELATED FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Returns a year day.\r\n *\r\n * @param date  Date\r\n * @param utc   Assume UTC dates?\r\n * @return Year day\r\n * @todo Account for UTC\r\n */\r\nexport function getYearDay(date: Date, utc: boolean = false): number {\r\n\tconst start = new Date(date.getFullYear(), 0, 0);\r\n\tconst diff = (date.getTime() - start.getTime()) + ((start.getTimezoneOffset() - date.getTimezoneOffset()) * 60 * 1000);\r\n\tconst oneDay = 1000 * 60 * 60 * 24;\r\n\treturn Math.floor(diff / oneDay);\r\n}\r\n\r\n/**\r\n * Returns week number for a given date.\r\n *\r\n * @param date  Date\r\n * @param utc   Assume UTC dates?\r\n * @return Week number\r\n * @todo Account for UTC\r\n */\r\nexport function getWeek(date: Date, utc: boolean = false): number {\r\n\tconst day = getYearDay(date, utc) - 1;\r\n\tlet week = Math.floor((day - (date.getDay() || 7) + 10) / 7);\r\n\tif (week === 0) {\r\n\t\tweek = 53;\r\n\t}\r\n\telse if (week === 53) {\r\n\t\tweek = 1;\r\n\t}\r\n\treturn week;\r\n}\r\n\r\n/**\r\n * Returns a week number in the month.\r\n *\r\n * @param date  Source Date\r\n * @param utc   Assume UTC dates?\r\n * @return Week number in month\r\n */\r\nexport function getMonthWeek(date: Date, utc: boolean = false): number {\r\n\tconst firstWeek = getWeek(new Date(date.getFullYear(), date.getMonth(), 1), utc);\r\n\tlet currentWeek = getWeek(date, utc);\r\n\tif (currentWeek == 1) {\r\n\t\tcurrentWeek = 53;\r\n\t}\r\n\treturn currentWeek - firstWeek + 1;\r\n}\r\n\r\n/**\r\n * Returns a year day out of the given week number.\r\n *\r\n * @param week     Week\r\n * @param year     Year\r\n * @param weekday  Weekday\r\n * @param utc      Assume UTC dates\r\n * @return Day in a year\r\n */\r\nexport function getDayFromWeek(week: number, year: number, weekday: number = 1, utc: boolean = false): number {\r\n\tlet date = new Date(year, 0, 4, 0, 0, 0, 0);\r\n\tif (utc) {\r\n\t\tdate.setUTCFullYear(year);\r\n\t}\r\n\tlet day = week * 7 + weekday - ((date.getDay() || 7) + 3);\r\n\treturn day;\r\n}\r\n\r\n/**\r\n * Returns 12-hour representation out of the 24-hour hours.\r\n *\r\n * @param hours  24-hour number\r\n * @return 12-hour number\r\n */\r\nexport function get12Hours(hours: number, base?: number): number {\r\n\tif (hours > 12) {\r\n\t\thours -= 12;\r\n\t}\r\n\telse if (hours === 0) {\r\n\t\thours = 12;\r\n\t}\r\n\treturn $type.hasValue(base) ? hours + (base - 1) : hours;\r\n}\r\n\r\n/**\r\n * Returns a string name of the tome zone.\r\n *\r\n * @param date     Date object\r\n * @param long     Should return long (\"Pacific Standard Time\") or short abbreviation (\"PST\")\r\n * @param savings  Include information if it's in daylight savings mode\r\n * @param utc      Assume UTC dates\r\n * @return Time zone name\r\n */\r\nexport function getTimeZone(date: Date, long: boolean = false, savings: boolean = false, utc: boolean = false): string {\r\n\tif (utc) {\r\n\t\treturn long ? \"Coordinated Universal Time\" : \"UTC\";\r\n\t}\r\n\tlet wotz = date.toLocaleString(\"UTC\");\r\n\tlet wtz = date.toLocaleString(\"UTC\", { timeZoneName: long ? \"long\" : \"short\" }).substr(wotz.length);\r\n\t//wtz = wtz.replace(/[+-]+[0-9]+$/, \"\");\r\n\tif (savings === false) {\r\n\t\twtz = wtz.replace(/ (standard|daylight|summer|winter) /i, \" \");\r\n\t}\r\n\treturn wtz;\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * NUMBER-RELATED FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Returns a random number between `from` and `to`.\r\n *\r\n * @param from  From number\r\n * @param to    To number\r\n * @return Random number\r\n */\r\nexport function random(from: number, to: number): number {\r\n\treturn Math.floor(Math.random() * (to - from)) + from;\r\n}\r\n\r\n/**\r\n * Fits the number into specific `min` and `max` bounds.\r\n *\r\n * @param value  Input value\r\n * @param min    Minimum value\r\n * @param max    Maximum value\r\n * @return Possibly adjusted value\r\n */\r\nexport function fitNumber(value: number, min: number, max: number): number {\r\n\tif (value > max) {\r\n\t\treturn max;\r\n\t}\r\n\telse if (value < min) {\r\n\t\treturn min;\r\n\t}\r\n\treturn value;\r\n}\r\n\r\n/**\r\n * Fits the number into specific `min` and `max` bounds.\r\n *\r\n * If the value is does not fit withing specified range, it \"wraps\" around the\r\n * values.\r\n *\r\n * For example, if we have input value 10 with min set at 1 and max set at 8,\r\n * the value will not fit. The remainder that does not fit (2) will be added\r\n * to `min`, resulting in 3.\r\n *\r\n * The output of regular `fitNumber()` would return 8 instead.\r\n *\r\n * @param value  Input value\r\n * @param min    Minimum value\r\n * @param max    Maximum value\r\n * @return Possibly adjusted value\r\n */\r\nexport function fitNumberRelative(value: number, min: number, max: number): number {\r\n\tlet gap = max - min;\r\n\tif (value > max) {\r\n\t\tvalue = min + (value - gap * Math.floor(value / gap));\r\n\t}\r\n\telse if (value < min) {\r\n\t\tvalue = min + (value - gap * Math.floor(value / gap));\r\n\t}\r\n\treturn value;\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * SPRITE-RELATED FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Converts SVG element coordinates to coordinates within specific [[Sprite]].\r\n *\r\n * @param point   SVG coordinates\r\n * @param sprite  Sprite\r\n * @return Sprite coordinates\r\n */\r\nexport function svgPointToSprite(point: IPoint, sprite: Sprite): IPoint {\r\n\tlet x: number = point.x;\r\n\tlet y: number = point.y;\r\n\tlet sprites: Sprite[] = [];\r\n\tif (sprite) {\r\n\t\twhile ($type.hasValue(sprite.parent)) {\r\n\t\t\tsprites.push(sprite);\r\n\t\t\tsprite = sprite.parent as any;\r\n\t\t}\r\n\r\n\t\tsprites.reverse();\r\n\r\n\t\tfor (let i = 0; i < sprites.length; i++) {\r\n\t\t\tlet sprite: Sprite = sprites[i];\r\n\t\t\tlet angle: number = sprite.rotation;\r\n\r\n\t\t\tlet relativeX = x - sprite.pixelX - sprite.ex;\r\n\t\t\tlet relativeY = y - sprite.pixelY - sprite.ey;\r\n\r\n\t\t\tif (sprite.dx) {\r\n\t\t\t\tx -= sprite.dx;\r\n\t\t\t}\r\n\t\t\tif (sprite.dy) {\r\n\t\t\t\ty -= sprite.dy;\r\n\t\t\t}\r\n\r\n\t\t\tlet scale = sprite.scale;\r\n\r\n\t\t\t// this handles nonscaling\r\n\t\t\tif(sprite.group){\r\n\t\t\t\tscale = sprite.group.scale; \r\n\t\t\t}\r\n\r\n\t\t\tx = ($math.cos(-angle) * relativeX - $math.sin(-angle) * relativeY) / scale - sprite.pixelPaddingLeft;\r\n\t\t\ty = ($math.cos(-angle) * relativeY + $math.sin(-angle) * relativeX) / scale - sprite.pixelPaddingTop;\r\n\t\t}\r\n\t}\r\n\r\n\treturn { x: x, y: y };\r\n}\r\n\r\n/**\r\n * Converts coordinates within [[Sprite]] to coordinates relative to the whole\r\n * SVG element.\r\n *\r\n * @param point   Sprite coordinates\r\n * @param sprite  Sprite\r\n * @return SVG coordinates\r\n */\r\nexport function spritePointToSvg(point: IPoint, sprite: Sprite): IPoint {\r\n\tlet x: number = point.x;\r\n\tlet y: number = point.y;\r\n\r\n\tif (sprite) {\r\n\t\twhile ($type.hasValue(sprite.parent)) {\r\n\t\t\tlet angle: number = sprite.rotation;\r\n\r\n\t\t\tx += sprite.pixelPaddingLeft + sprite.ex;\r\n\t\t\ty += sprite.pixelPaddingTop + sprite.ey;\r\n\r\n\t\t\tlet scale = sprite.scale;\r\n\r\n\t\t\t// this handles nonscaling\r\n\t\t\tif(sprite.group){\r\n\t\t\t\tscale = sprite.group.scale; \r\n\t\t\t}\r\n\r\n\t\t\tlet relativeX = sprite.pixelX + ((x * $math.cos(angle) - y * $math.sin(angle))) * scale;\r\n\t\t\tlet relativeY = sprite.pixelY + ((x * $math.sin(angle) + y * $math.cos(angle))) * scale;\r\n\r\n\t\t\tif (sprite.dx) {\r\n\t\t\t\trelativeX += sprite.dx;\r\n\t\t\t}\r\n\t\t\tif (sprite.dy) {\r\n\t\t\t\trelativeY += sprite.dy;\r\n\t\t\t}\r\n\r\n\t\t\tx = relativeX;\r\n\t\t\ty = relativeY;\r\n\r\n\t\t\tsprite = sprite.parent as any;\r\n\t\t}\r\n\t}\r\n\treturn { x: x, y: y };\r\n}\r\n\r\n\r\n/**\r\n * Converts coordinates of one sprite to another.\r\n *\r\n * @param point   Sprite coordinates\r\n * @param sprite  Sprite\r\n * @param toSprite  Sprite\r\n * @return converted coordinates\r\n */\r\nexport function spritePointToSprite(point: IPoint, sprite: Sprite, toSprite: Sprite): IPoint {\r\n\treturn svgPointToSprite(spritePointToSvg(point, sprite), toSprite);\r\n}\r\n\r\n\r\n/**\r\n * Converts a rectangle expressed in SVG element coordinates to coordinates\r\n * within specific [[Sprite]].\r\n *\r\n * @param rect    SVG rectangle\r\n * @param sprite  Sprite\r\n * @return Sprite rectangle\r\n */\r\nexport function svgRectToSprite(rect: IRectangle, sprite: Sprite): IRectangle {\r\n\tlet p1: IPoint = svgPointToSprite(rect, sprite);\r\n\tlet p2: IPoint = svgPointToSprite({ x: rect.x + rect.width, y: rect.y + rect.height }, sprite);\r\n\treturn { x: p1.x, y: p1.y, width: p2.x - p1.x, height: p2.y - p1.y };\r\n}\r\n\r\n/**\r\n * Converts a rectangle expressed in [[Sprite]] coordinates to SVG coordinates.\r\n *\r\n * @param rect    Sprite rectangle\r\n * @param sprite  Sprite\r\n * @return SVG rectangle\r\n */\r\nexport function spriteRectToSvg(rect: IRectangle, sprite: Sprite): IRectangle {\r\n\tlet p1: IPoint = spritePointToSvg(rect, sprite);\r\n\tlet p2: IPoint = spritePointToSvg({ x: rect.x + rect.width, y: rect.y + rect.height }, sprite);\r\n\treturn { x: p1.x, y: p1.y, width: p2.x - p1.x, height: p2.y - p1.y };\r\n}\r\n\r\n/**\r\n * Converts global document-wide coordinates to coordinates within SVG element.\r\n *\r\n * @param point         Global coordinates\r\n * @param svgContainer  SVG element\r\n * @return SVG coordinates\r\n */\r\nexport function documentPointToSvg(point: IPoint, svgContainer: HTMLElement, cssScale?: number): IPoint {\r\n\ttry {\r\n\t\tlet bbox = svgContainer.getBoundingClientRect();\r\n\r\n\t\tif (!$type.isNumber(cssScale)) {\r\n\t\t\tcssScale = 1;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t\"x\": (point.x - bbox.left) / cssScale,\r\n\t\t\t\"y\": (point.y - bbox.top) / cssScale\r\n\t\t};\r\n\t}\r\n\tcatch (e) {\r\n\t\treturn point;\r\n\t}\r\n}\r\n\r\n/**\r\n * Converts SVG coordinates to global document-wide coordinates.\r\n *\r\n * @param point         SVG coordinates\r\n * @param svgContainer  SVG element\r\n * @return Global coordinates\r\n */\r\nexport function svgPointToDocument(point: IPoint, svgContainer: HTMLElement): IPoint {\r\n\ttry {\r\n\t\tlet bbox = svgContainer.getBoundingClientRect();\r\n\r\n\t\treturn {\r\n\t\t\t\"x\": point.x + bbox.left,\r\n\t\t\t\"y\": point.y + bbox.top\r\n\t\t};\r\n\t}\r\n\tcatch (e) {\r\n\t\treturn point;\r\n\t}\r\n}\r\n\r\n/**\r\n * Converts document-wide global coordinates to coordinates within specific\r\n * [[Sprite]].\r\n *\r\n * @param point   Global coordinates\r\n * @param sprite  Sprite\r\n * @return Sprite coordinates\r\n */\r\nexport function documentPointToSprite(point: IPoint, sprite: Sprite): IPoint {\r\n\tif (sprite && sprite.htmlContainer) {\r\n\t\tlet svgPoint: IPoint = documentPointToSvg(point, $type.getValue(sprite.htmlContainer), sprite.svgContainer.cssScale);\r\n\t\treturn svgPointToSprite(svgPoint, sprite);\r\n\t}\r\n\telse {\r\n\t\treturn point;\r\n\t}\r\n}\r\n\r\n/**\r\n * Converts coordinates within [[Sprite]] to global document coordinates.\r\n *\r\n * @param point   Sprite coordinates\r\n * @param sprite  Sprite\r\n * @return Global coordinates\r\n */\r\nexport function spritePointToDocument(point: IPoint, sprite: Sprite): IPoint {\r\n\tif (sprite && sprite.htmlContainer) {\r\n\t\tlet svgPoint: IPoint = spritePointToSvg(point, sprite);\r\n\t\treturn svgPointToDocument(svgPoint, $type.getValue(sprite.htmlContainer));\r\n\t}\r\n\telse {\r\n\t\treturn point;\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * DEPRECATED FUNCTIONS\r\n * @todo Review and remove\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Returns element's width.\r\n *\r\n * @ignore Exclude from docs\r\n * @param element  Element\r\n * @return Width (px)\r\n * @deprecated Not used anywhere\r\n */\r\nexport function width(element: HTMLElement): number {\r\n\r\n\tlet cs = getComputedStyle(element);\r\n\r\n\tlet paddingX = parseFloat(cs.paddingLeft) + parseFloat(cs.paddingRight);\r\n\tlet borderX = parseFloat(cs.borderLeftWidth) + parseFloat(cs.borderRightWidth);\r\n\r\n\treturn element.clientWidth - paddingX - borderX;\r\n}\r\n\r\n/**\r\n * Returns element's height.\r\n *\r\n * @ignore Exclude from docs\r\n * @param element  Element\r\n * @return Height (px)\r\n * @deprecated Not used anywhere\r\n */\r\nexport function height(element: HTMLElement): number {\r\n\r\n\tlet cs = getComputedStyle(element);\r\n\r\n\tlet paddingY = parseFloat(cs.paddingTop) + parseFloat(cs.paddingBottom);\r\n\tlet borderY = parseFloat(cs.borderTopWidth) + parseFloat(cs.borderBottomWidth);\r\n\r\n\treturn element.clientHeight - paddingY - borderY;\r\n}\r\n\r\n/**\r\n * Returns number of decimals\r\n *\r\n * @ignore Exclude from docs\r\n * @param number  Input number\r\n * @return Number of decimals\r\n */\r\nexport function decimalPlaces(number: number): number {\r\n\tlet match = ('' + number).match(/(?:\\.(\\d+))?(?:[eE]([+-]?\\d+))?$/);\r\n\tif (!match) { return 0; }\r\n\treturn Math.max(0, (match[1] ? match[1].length : 0) - (match[2] ? +match[2] : 0));\r\n}\r\n\r\n\r\n/**\r\n * A parsed URL\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport interface Url {\r\n\tprotocol: string;\r\n\tseparator: string;\r\n\tauthority: string;\r\n\tdomain: string;\r\n\tport: string;\r\n\tpath: string;\r\n\tquery: string;\r\n\thash: string;\r\n}\r\n\r\nconst urlRegexp = /^([a-zA-Z][a-zA-Z0-9\\+\\.\\-]*:)?(?:(\\/\\/)([^\\@]+\\@)?([^\\/\\?\\#\\:]*)(\\:[0-9]+)?)?([^\\?\\#]*)(\\?[^\\#]*)?(\\#.*)?$/;\r\n\r\n/**\r\n * Parses a URL\r\n *\r\n * @ignore Exclude from docs\r\n */\r\n// TODO test this\r\nexport function parseUrl(url: string): Url {\r\n\tconst match = urlRegexp.exec(url);\r\n\r\n\treturn {\r\n\t\tprotocol: (match && match[1]) || \"\",\r\n\t\tseparator: (match && match[2]) || \"\",\r\n\t\tauthority: (match && match[3]) || \"\",\r\n\t\tdomain: (match && match[4]) || \"\",\r\n\t\tport: (match && match[5]) || \"\",\r\n\t\tpath: (match && match[6]) || \"\",\r\n\t\tquery: (match && match[7]) || \"\",\r\n\t\thash: (match && match[8]) || \"\"\r\n\t};\r\n}\r\n\r\n/**\r\n * Serializes a Url into a string\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport function serializeUrl(url: Url): string {\r\n\treturn url.protocol + url.separator + url.authority + url.domain + url.port + url.path + url.query + url.hash;\r\n}\r\n\r\n/**\r\n * Checks whether a Url is relative or not\r\n *\r\n * @ignore Exclude from docs\r\n */\r\n// TODO is this correct ?\r\nfunction isRelativeUrl(url: Url): boolean {\r\n\treturn url.protocol === \"\" &&\r\n\t\turl.separator === \"\" &&\r\n\t\turl.authority === \"\" &&\r\n\t\turl.domain === \"\" &&\r\n\t\turl.port === \"\";\r\n}\r\n\r\n/**\r\n * Joins together two URLs, resolving relative URLs correctly\r\n *\r\n * @ignore Exclude from docs\r\n */\r\n// TODO test this\r\nexport function joinUrl(left: string, right: string): string {\r\n\tconst parsedLeft = parseUrl(left);\r\n\tconst parsedRight = parseUrl(right);\r\n\r\n\tif (isRelativeUrl(parsedLeft)) {\r\n\t\tthrow new Error(\"Left URL is not absolute\");\r\n\t}\r\n\r\n\tif (isRelativeUrl(parsedRight)) {\r\n\t\t// TODO is this correct ?\r\n\t\tif (parsedRight.path !== \"\") {\r\n\t\t\tif (parsedRight.path[0] === \"/\") {\r\n\t\t\t\tparsedLeft.path = parsedRight.path;\r\n\r\n\t\t\t\t// TODO is this correct ?\r\n\t\t\t} else {\r\n\t\t\t\tconst leftPath = parsedLeft.path.split(/\\//);\r\n\t\t\t\tconst rightPath = parsedRight.path.split(/\\//);\r\n\r\n\t\t\t\t// TODO is this correct ?\r\n\t\t\t\tif (leftPath.length === 0) {\r\n\t\t\t\t\tif (rightPath.length !== 0) {\r\n\t\t\t\t\t\tleftPath.push(\"\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (leftPath.length > 1) {\r\n\t\t\t\t\tleftPath.pop();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$array.pushAll(leftPath, rightPath);\r\n\r\n\t\t\t\tparsedLeft.path = leftPath.join(\"/\");\r\n\r\n\t\t\t\tif (parsedLeft.path !== \"\" && parsedLeft.path[0] !== \"/\") {\r\n\t\t\t\t\tthrow new Error(\"URL path must start with /\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// TODO is this correct ?\r\n\t\tparsedLeft.query = parsedRight.query;\r\n\t\tparsedLeft.hash = parsedRight.hash;\r\n\r\n\t\treturn serializeUrl(parsedLeft);\r\n\r\n\t} else {\r\n\t\treturn serializeUrl(parsedRight);\r\n\t}\r\n}\r\n\r\n/**\r\n * Detects MSIE.\r\n *\r\n * @return Is IE?\r\n */\r\nexport function isIE(): boolean {\r\n\treturn !!(<any>window).MSInputMethodContext && !!(<any>document).documentMode;\r\n}\r\n","/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { IClone } from \"./Clone\";\r\nimport { Disposer, MultiDisposer, IDisposer } from \"./Disposer\";\r\nimport { EventDispatcher, AMEvent } from \"./EventDispatcher\";\r\nimport { Ordering } from \"./Order\";\r\nimport * as $array from \"./Array\";\r\nimport * as $iter from \"./Iterator\";\r\nimport * as $type from \"./Type\";\r\n\r\n/**\r\n * @todo Description\r\n */\r\nexport class IndexedIterable<A> {\r\n\r\n\t/**\r\n\t * Item list\r\n\t */\r\n\tprivate _array: Array<A>;\r\n\r\n\t/**\r\n\t * Start index.\r\n\t */\r\n\tprivate _start: number;\r\n\r\n\t/**\r\n\t * End index.\r\n\t */\r\n\tprivate _end: number;\r\n\r\n\t/**\r\n\t * Constructor.\r\n\t *\r\n\t * @param array  List items\r\n\t * @param start  Start index\r\n\t * @param end    End index\r\n\t */\r\n\tconstructor(array: Array<A>, start: number, end: number) {\r\n\t\tthis._array = array;\r\n\t\tthis._start = start;\r\n\t\tthis._end = end;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a list item iterator.\r\n\t *\r\n\t * @return Iterator\r\n\t */\r\n\tpublic iterator(): $iter.Iterator<A> {\r\n\t\treturn (push) => {\r\n\t\t\tif (this._start !== this._end) {\r\n\t\t\t\tif (this._start < this._end) {\r\n\t\t\t\t\tfor (let i = this._start; i < this._end; ++i) {\r\n\t\t\t\t\t\tif (!push(this._array[i])) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (let i = this._start - 1; i >= this._end; --i) {\r\n\t\t\t\t\t\tif (!push(this._array[i])) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an interable list sorted backwards than current list.\r\n\t *\r\n\t * @return List\r\n\t */\r\n\tpublic backwards(): IndexedIterable<A> {\r\n\t\treturn new IndexedIterable(this._array, this._end, this._start);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new list consisting only of specific range of items between\r\n\t * `start` and `end` indexes.\r\n\t *\r\n\t * @param start  Start index\r\n\t * @param end    End index\r\n\t * @return List\r\n\t */\r\n\tpublic range(start: number, end: number): IndexedIterable<A> {\r\n\t\tif (start <= end) {\r\n\t\t\tif (this._start === this._end) {\r\n\t\t\t\treturn this;\r\n\r\n\t\t\t} else if (this._start < this._end) {\r\n\t\t\t\tconst diff = end - start;\r\n\r\n\t\t\t\tstart = Math.max(this._start + start, this._start);\r\n\t\t\t\tend = Math.min(start + diff, this._end);\r\n\r\n\t\t\t\treturn new IndexedIterable(this._array, start, end);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tconst diff = end - start;\r\n\r\n\t\t\t\tstart = Math.max(this._start - start, this._end);\r\n\t\t\t\tend = Math.max(start - diff, this._end);\r\n\r\n\t\t\t\treturn new IndexedIterable(this._array, start, end);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"Start index must be lower than end index\");\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Defines events for the [[List]].\r\n */\r\nexport interface IListEvents<A> {\r\n\t/**\r\n\t * Invoked when item is added to the list.\r\n\t *\r\n\t * @todo remove this later?\r\n\t */\r\n\tinserted: {\r\n\t\tnewValue: A;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when item is removed from the list.\r\n\t *\r\n\t * @todo remove this later?\r\n\t */\r\n\tremoved: {\r\n\t\toldValue: A;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when `setAll` method is called.\r\n\t */\r\n\tsetAll: {\r\n\t\toldArray: Array<A>;\r\n\t\tnewArray: Array<A>;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when `insertIndex` method is called.\r\n\t */\r\n\tinsertIndex: {\r\n\t\tindex: number;\r\n\t\tnewValue: A;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when `setIndex` method is called.\r\n\t */\r\n\tsetIndex: {\r\n\t\tindex: number;\r\n\t\toldValue: A;\r\n\t\tnewValue: A;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when item is removed.\r\n\t */\r\n\tremoveIndex: {\r\n\t\tindex: number;\r\n\t\toldValue: A;\r\n\t};\r\n\r\n}\r\n\r\n/**\r\n * ListGrouper organizes [[List]] items into groups.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport class ListGrouper<A> extends MultiDisposer {\r\n\r\n\t/**\r\n\t * Function that can be used to extract a \"value\" of the list element.\r\n\t *\r\n\t * Used for ordering.\r\n\t */\r\n\tprivate _getKey: (value: A) => number;\r\n\r\n\t/**\r\n\t * A function that  is used to order list groups.\r\n\t */\r\n\tprivate _sort: (left: number, right: number) => Ordering;\r\n\r\n\t/**\r\n\t * Grouping keys.\r\n\t */\r\n\tprivate _keys: Array<number> = [];\r\n\r\n\t/**\r\n\t * List item groups.\r\n\t */\r\n\tprivate _groups: { [key: number]: Array<A> } = {};\r\n\r\n\t/**\r\n\t * Inserts an item (`x`) to a specific group (`key`) and specific `index`.\r\n\t *\r\n\t * @param x      Item\r\n\t * @param key    Group name\r\n\t * @param index  Index\r\n\t */\r\n\tprivate _insert(x: A, key: number, index?: number): void {\r\n\t\tif (this._groups[key] == null) {\r\n\t\t\tthis._groups[key] = [];\r\n\r\n\t\t\t// TODO code duplication with SortedList\r\n\t\t\tconst { found, index } = $array.getSortedIndex(this._keys, this._sort, key);\r\n\r\n\t\t\tif (found) {\r\n\t\t\t\tthrow new Error(\"Key already exists: \" + key);\r\n\r\n\t\t\t} else {\r\n\t\t\t\t$array.insertIndex(this._keys, index, key);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (index == null) {\r\n\t\t\tthis._groups[key].push(x);\r\n\r\n\t\t} else {\r\n\t\t\t$array.insertIndex(this._groups[key], index, x);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes an item from the list.\r\n\t *\r\n\t * @param x Item to remove\r\n\t */\r\n\tprivate _remove(x: A): void {\r\n\t\tconst key = this._getKey(x);\r\n\r\n\t\tconst values = this._groups[key];\r\n\r\n\t\tif (values != null) {\r\n\t\t\t$array.remove(values, x);\r\n\r\n\t\t\tif (values.length === 0) {\r\n\t\t\t\tdelete this._groups[key];\r\n\r\n\t\t\t\tconst { found, index } = $array.getSortedIndex(this._keys, this._sort, key);\r\n\r\n\t\t\t\tif (found) {\r\n\t\t\t\t\t$array.removeIndex(this._keys, index);\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(\"Key doesn't exist: \" + key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Constructor.\r\n\t */\r\n\tconstructor(\r\n\t\tlist: $iter.Iterable<A> & {\r\n\t\t\tevents: EventDispatcher<{\r\n\t\t\t\tinserted: { newValue: A },\r\n\t\t\t\tremoved: { oldValue: A }\r\n\t\t\t}>;\r\n\t\t},\r\n\t\tgetKey: (value: A) => number,\r\n\t\tsort: (left: number, right: number) => Ordering\r\n\t) {\r\n\t\tsuper([\r\n\t\t\tlist.events.on(\"inserted\", (x) => {\r\n\t\t\t\tconst value = x.newValue;\r\n\t\t\t\tconst key = this._getKey(value);\r\n\r\n\t\t\t\tlet index = 0;\r\n\r\n\t\t\t\t$iter.eachContinue(list.iterator(), (x) => {\r\n\t\t\t\t\tif (x === value) {\r\n\t\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t\t} else if (this._getKey(x) === key) {\r\n\t\t\t\t\t\t++index;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis._insert(value, key, index);\r\n\t\t\t}, undefined, false),\r\n\r\n\t\t\tlist.events.on(\"removed\", (x) => {\r\n\t\t\t\tthis._remove(x.oldValue);\r\n\t\t\t}, undefined, false)\r\n\t\t]);\r\n\r\n\t\tthis._getKey = getKey;\r\n\t\tthis._sort = sort;\r\n\r\n\t\t$iter.each(list.iterator(), (x) => {\r\n\t\t\tthis._insert(x, getKey(x));\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterator for the list.\r\n\t *\r\n\t * The iterator will iterate through all items in all groups.\r\n\t *\r\n\t * @return Iterator\r\n\t */\r\n\tpublic iterator(): $iter.Iterator<A> {\r\n\t\treturn $iter.flatten($iter.map($iter.fromArray(this._keys), (key) => {\r\n\t\t\treturn $iter.fromArray(this._groups[key]);\r\n\t\t}));\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * @todo Description\r\n * @ignore Exclude from docs\r\n */\r\nexport type ListLike<A> = $iter.Iterable<A> & {\r\n\tevents: EventDispatcher<{ removed: { oldValue: A } }>;\r\n};\r\n\r\n/**\r\n * A disposable list, which when disposed itself will call `dispose()` method\r\n * on all its items.\r\n */\r\nexport class ListDisposer<A extends IDisposer> extends Disposer {\r\n\tconstructor(list: ListLike<A>, disposeOnRemove: boolean = true) {\r\n\t\tif (disposeOnRemove) {\r\n\t\t\tconst disposer = list.events.on(\"removed\", (x) => {\r\n\t\t\t\tx.oldValue.dispose();\r\n\t\t\t}, undefined, false);\r\n\r\n\t\t\tsuper(() => {\r\n\t\t\t\tdisposer.dispose();\r\n\r\n\t\t\t\t// TODO clear the list ?\r\n\t\t\t\t$iter.each(list.iterator(), (x) => {\r\n\t\t\t\t\tx.dispose();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t} else {\r\n\t\t\tsuper(() => {\r\n\t\t\t\t// TODO clear the list ?\r\n\t\t\t\t$iter.each(list.iterator(), (x) => {\r\n\t\t\t\t\tx.dispose();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Checks if specific index fits into length.\r\n *\r\n * @param index  Index\r\n * @param len    Length\r\n */\r\nfunction checkBounds(index: number, len: number): void {\r\n\tif (!(index >= 0 && index < len)) {\r\n\t\tthrow new Error(\"Index out of bounds: \" + index);\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * A List class is used to hold a number of indexed items of the same type.\r\n */\r\nexport class List<T> {\r\n\r\n\t/**\r\n\t * List values.\r\n\t */\r\n\tprivate _values: Array<T>;\r\n\r\n\t/**\r\n\t * Event dispatcher.\r\n\t */\r\n\tpublic events: EventDispatcher<AMEvent<this, IListEvents<T>>> = new EventDispatcher();\r\n\r\n\t/**\r\n\t * Constructor\r\n\t *\r\n\t * @param initial  Inital list of values to add to list\r\n\t */\r\n\tconstructor(initial: Array<T> = []) {\r\n\t\tthis._values = initial;\r\n\t}\r\n\r\n\t/**\r\n\t * An array of values in the list.\r\n\t *\r\n\t * Do not use this property to add values. Rather use dedicated methods, like\r\n\t * `push()`, `removeIndex()`, etc.\r\n\t *\r\n\t * @readonly\r\n\t * @return List values\r\n\t */\r\n\tpublic get values(): Array<T> {\r\n\t\treturn this._values;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if list contains specific item reference.\r\n\t *\r\n\t * @param item  Item to search for\r\n\t * @return `true` if found, `false` if not found\r\n\t */\r\n\tpublic contains(value: T): boolean {\r\n\t\treturn this._values.indexOf(value) !== -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes specific item from the list.\r\n\t *\r\n\t * @param item An item to remove\r\n\t */\r\n\tpublic removeValue(value: T): void {\r\n\t\tlet i = 0;\r\n\t\tlet length = this._values.length;\r\n\r\n\t\twhile (i < length) {\r\n\t\t\t// TODO handle NaN\r\n\t\t\tif (this._values[i] === value) {\r\n\t\t\t\tthis.removeIndex(i);\r\n\t\t\t\t--length;\r\n\r\n\t\t\t} else {\r\n\t\t\t\t++i;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Searches the list for specific item and returns its index.\r\n\t *\r\n\t * @param item  An item to search for\r\n\t * @return Index or -1 if not found\r\n\t */\r\n\tpublic indexOf(value: T): number {\r\n\t\treturn $array.indexOf(this._values, value);\r\n\t}\r\n\r\n\t/**\r\n\t * Number of items in list.\r\n\t *\r\n\t * @readonly\r\n\t * @return Number of items\r\n\t */\r\n\tpublic get length(): number {\r\n\t\treturn this._values.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if there's a value at specific index.\r\n\t *\r\n\t * @param index  Index\r\n\t * @return Value exists?\r\n\t */\r\n\tpublic hasIndex(index: number): boolean {\r\n\t\treturn index >= 0 && index < this._values.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an item at specified index.\r\n\t *\r\n\t * @param index  Index\r\n\t * @return List item\r\n\t */\r\n\tpublic getIndex(index: number): T | undefined {\r\n\t\treturn this._values[index];\r\n\t}\r\n\r\n\t/**\r\n\t * Sets value at specific index.\r\n\t *\r\n\t * If there's already a value at the index, it is overwritten.\r\n\t *\r\n\t * @param index  Index\r\n\t * @param value  New value\r\n\t * @return New value\r\n\t */\r\n\tpublic setIndex(index: number, value: T): T {\r\n\t\tcheckBounds(index, this._values.length);\r\n\r\n\t\tconst oldValue = this._values[index];\r\n\r\n\t\t// Do nothing if the old value and the new value are the same\r\n\t\tif (oldValue !== value) {\r\n\t\t\tthis._values[index] = value;\r\n\r\n\t\t\tif (this.events.isEnabled(\"setIndex\")) {\r\n\t\t\t\tthis.events.dispatchImmediately(\"setIndex\", {\r\n\t\t\t\t\ttype: \"setIndex\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tindex: index,\r\n\t\t\t\t\toldValue: oldValue,\r\n\t\t\t\t\tnewValue: value\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (this.events.isEnabled(\"removed\")) {\r\n\t\t\t\tthis.events.dispatchImmediately(\"removed\", {\r\n\t\t\t\t\ttype: \"removed\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\toldValue: oldValue\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (this.events.isEnabled(\"inserted\")) {\r\n\t\t\t\tthis.events.dispatchImmediately(\"inserted\", {\r\n\t\t\t\t\ttype: \"inserted\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tnewValue: value\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn oldValue;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an item to the list at a specific index, which pushes all the other\r\n\t * items further down the list.\r\n\t *\r\n\t * @param index Index\r\n\t * @param item  An item to add\r\n\t */\r\n\tpublic insertIndex(index: number, value: T): void {\r\n\t\tcheckBounds(index, this._values.length + 1);\r\n\r\n\t\t$array.insertIndex(this._values, index, value);\r\n\r\n\t\tif (this.events.isEnabled(\"insertIndex\")) {\r\n\t\t\tthis.events.dispatchImmediately(\"insertIndex\", {\r\n\t\t\t\ttype: \"insertIndex\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tindex: index,\r\n\t\t\t\tnewValue: value\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this.events.isEnabled(\"inserted\")) {\r\n\t\t\tthis.events.dispatchImmediately(\"inserted\", {\r\n\t\t\t\ttype: \"inserted\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tnewValue: value\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [_sortQuicksort description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param low    [description]\r\n\t * @param high   [description]\r\n\t * @param order  [description]\r\n\t */\r\n\tprivate _sortQuicksort(low: number, high: number, order: (left: T, right: T) => Ordering): void {\r\n\t\tif (low < high) {\r\n\t\t\tconst p = this._sortPartition(low, high, order);\r\n\t\t\tthis._sortQuicksort(low, p, order);\r\n\t\t\tthis._sortQuicksort(p + 1, high, order);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [_sortPartition description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param low    [description]\r\n\t * @param high   [description]\r\n\t * @param order  [description]\r\n\t * @return [description]\r\n\t */\r\n\tprivate _sortPartition(low: number, high: number, order: (left: T, right: T) => Ordering): number {\r\n\t\tconst values = this._values;\r\n\t\tconst pivot = values[low];\r\n\r\n\t\tlet i = low - 1;\r\n\t\tlet j = high + 1;\r\n\r\n\t\tfor (; ;) {\r\n\t\t\tdo {\r\n\t\t\t\t++i;\r\n\t\t\t} while (order(values[i], pivot) < 0);\r\n\r\n\t\t\tdo {\r\n\t\t\t\t--j;\r\n\t\t\t} while (order(values[j], pivot) > 0);\r\n\r\n\t\t\tif (i >= j) {\r\n\t\t\t\treturn j;\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis.swap(i, j);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Reorders list items according to specific ordering function.\r\n\t *\r\n\t * @param order  Ordering function\r\n\t */\r\n\tpublic sort(order: (left: T, right: T) => Ordering): void {\r\n\t\t// https://en.wikipedia.org/wiki/Quicksort#Hoare_partition_scheme\r\n\t\t// @todo faster implementation of this\r\n\t\t// @todo test this\r\n\t\tthis._sortQuicksort(0, this._values.length - 1, order);\r\n\t}\r\n\r\n\t/**\r\n\t * Swaps indexes of two items in the list.\r\n\t *\r\n\t * @param a  Item 1\r\n\t * @param b  Item 2\r\n\t */\r\n\tpublic swap(a: number, b: number): void {\r\n\t\tconst len = this._values.length;\r\n\r\n\t\tcheckBounds(a, len);\r\n\t\tcheckBounds(b, len);\r\n\r\n\t\tif (a !== b) {\r\n\t\t\tconst value_a = this._values[a];\r\n\t\t\tconst value_b = this._values[b];\r\n\r\n\t\t\tthis._values[a] = value_b;\r\n\r\n\t\t\tif (this.events.isEnabled(\"setIndex\")) {\r\n\t\t\t\tthis.events.dispatchImmediately(\"setIndex\", {\r\n\t\t\t\t\ttype: \"setIndex\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tindex: a,\r\n\t\t\t\t\toldValue: value_a,\r\n\t\t\t\t\tnewValue: value_b\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tthis._values[b] = value_a;\r\n\r\n\t\t\tif (this.events.isEnabled(\"setIndex\")) {\r\n\t\t\t\tthis.events.dispatchImmediately(\"setIndex\", {\r\n\t\t\t\t\ttype: \"setIndex\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tindex: b,\r\n\t\t\t\t\toldValue: value_b,\r\n\t\t\t\t\tnewValue: value_a\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a value at specific index.\r\n\t *\r\n\t * @param index  Index of value to remove\r\n\t * @return Removed value\r\n\t */\r\n\tpublic removeIndex(index: number): T {\r\n\t\tcheckBounds(index, this._values.length);\r\n\r\n\t\tconst oldValue = this._values[index];\r\n\r\n\t\t$array.removeIndex(this._values, index);\r\n\r\n\t\tif (this.events.isEnabled(\"removeIndex\")) {\r\n\t\t\tthis.events.dispatchImmediately(\"removeIndex\", {\r\n\t\t\t\ttype: \"removeIndex\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tindex: index,\r\n\t\t\t\toldValue: oldValue\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this.events.isEnabled(\"removed\")) {\r\n\t\t\tthis.events.dispatchImmediately(\"removed\", {\r\n\t\t\t\ttype: \"removed\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\toldValue: oldValue\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn oldValue;\r\n\t}\r\n\r\n\t/**\r\n\t * Moves an item to a specific index within the list.\r\n\t *\r\n\t * If the index is not specified it will move the item to the end of the\r\n\t * list.\r\n\t *\r\n\t * @param value  Item to move\r\n\t * @param index  Index to place item at\r\n\t */\r\n\tpublic moveValue(value: T, toIndex?: number): void {\r\n\t\t// TODO don't do anything if the desired index is the same as the current index\r\n\t\tlet index = this.indexOf(value);\r\n\r\n\t\t// TODO remove all old values rather than only the first ?\r\n\t\tif (index !== -1) {\r\n\t\t\tconst oldValue = this._values[index];\r\n\r\n\t\t\t$array.removeIndex(this._values, index);\r\n\r\n\t\t\tif (this.events.isEnabled(\"removeIndex\")) {\r\n\t\t\t\tthis.events.dispatchImmediately(\"removeIndex\", {\r\n\t\t\t\t\ttype: \"removeIndex\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tindex: index,\r\n\t\t\t\t\toldValue: oldValue\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (toIndex == null) {\r\n\t\t\ttoIndex = this._values.length;\r\n\t\t\tthis._values.push(value);\r\n\r\n\t\t} else {\r\n\t\t\t$array.insertIndex(this._values, toIndex, value);\r\n\t\t}\r\n\r\n\t\tif (this.events.isEnabled(\"insertIndex\")) {\r\n\t\t\tthis.events.dispatchImmediately(\"insertIndex\", {\r\n\t\t\t\ttype: \"insertIndex\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tindex: toIndex,\r\n\t\t\t\tnewValue: value\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (index === -1) {\r\n\t\t\tif (this.events.isEnabled(\"inserted\")) {\r\n\t\t\t\tthis.events.dispatchImmediately(\"inserted\", {\r\n\t\t\t\t\ttype: \"inserted\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tnewValue: value\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an item to the end of the list.\r\n\t *\r\n\t * @param item  An item to add\r\n\t */\r\n\tpublic push<K extends T>(value: K): K {\r\n\t\tconst index = this._values.push(value) - 1;\r\n\r\n\t\tif (this.events.isEnabled(\"insertIndex\")) {\r\n\t\t\tthis.events.dispatchImmediately(\"insertIndex\", {\r\n\t\t\t\ttype: \"insertIndex\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tindex: index,\r\n\t\t\t\tnewValue: value\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this.events.isEnabled(\"inserted\")) {\r\n\t\t\tthis.events.dispatchImmediately(\"inserted\", {\r\n\t\t\t\ttype: \"inserted\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tnewValue: value\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an item as a first item in the list.\r\n\t *\r\n\t * @param item  An item to add\r\n\t */\r\n\tpublic unshift(value: T): void {\r\n\t\tthis.insertIndex(0, value);\r\n\t}\r\n\r\n\t/**\r\n\t * Adds multiple items to the list.\r\n\t *\r\n\t * @param items  An Array of items to add\r\n\t */\r\n\tpublic pushAll(values: Array<T>): void {\r\n\t\t$array.each(values, (value) => {\r\n\t\t\tthis.push(value);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Copies and adds items from abother list.\r\n\t *\r\n\t * @param source  A list top copy items from\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\tthis.pushAll(source._values);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the last item from the list, and removes it.\r\n\t *\r\n\t * @return Item\r\n\t */\r\n\tpublic pop(): $type.Optional<T> {\r\n\t\tlet index = this._values.length - 1;\r\n\t\treturn index < 0 ? undefined : this.removeIndex(this._values.length - 1);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the first item from the list, and removes it.\r\n\t *\r\n\t * @return Item\r\n\t */\r\n\tpublic shift(): $type.Optional<T> {\r\n\t\treturn this._values.length ? this.removeIndex(0) : undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets multiple items to the list.\r\n\t *\r\n\t * All current items are removed.\r\n\t *\r\n\t * @param newArray  New items\r\n\t */\r\n\tpublic setAll(newArray: Array<T>): void {\r\n\t\t// @tod if a value exists in both the new and old arrays, don't send remove/insert events\r\n\t\tconst oldArray = $array.copy(this._values);\r\n\r\n\t\tthis._values.length = 0;\r\n\r\n\t\t$array.each(newArray, (value) => {\r\n\t\t\tthis._values.push(value);\r\n\t\t});\r\n\r\n\t\tif (this.events.isEnabled(\"setAll\")) {\r\n\t\t\tthis.events.dispatchImmediately(\"setAll\", {\r\n\t\t\t\ttype: \"setAll\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\toldArray: oldArray,\r\n\t\t\t\tnewArray: this._values // TODO make a copy ?\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this.events.isEnabled(\"removed\")) {\r\n\t\t\t$array.each(oldArray, (x) => {\r\n\t\t\t\tthis.events.dispatchImmediately(\"removed\", {\r\n\t\t\t\t\ttype: \"removed\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\toldValue: x\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this.events.isEnabled(\"inserted\")) {\r\n\t\t\t$array.each(this._values, (x) => {\r\n\t\t\t\tthis.events.dispatchImmediately(\"inserted\", {\r\n\t\t\t\t\ttype: \"inserted\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tnewValue: x\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all items from the list.\r\n\t */\r\n\tpublic clear(): void {\r\n\t\tthis.setAll([]);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a list iterator.\r\n\t *\r\n\t * @return Iterator\r\n\t */\r\n\tpublic iterator(): $iter.Iterator<T> {\r\n\t\treturn $iter.fromArray(this._values);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an ES6 iterator for the list.\r\n\t */\r\n\tpublic *[Symbol.iterator](): Iterator<T> {\r\n\t\tconst length = this._values.length;\r\n\r\n\t\tfor (let i = 0; i < length; ++i) {\r\n\t\t\tyield this._values[i];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Calls `f` for each element in the list.\r\n\t *\r\n\t * `f` should have at least one parameter defined which will get a current\r\n\t * item, with optional second argument - index.\r\n\t */\r\n\tpublic each(f: (value: T, index: number) => void): void {\r\n\t\t$array.each(this._values, f);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a specific range of list items, which can be iterated.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Code duplication with IndexedIterable\r\n\t * @param start  Start index\r\n\t * @param end    End index\r\n\t * @return Range\r\n\t */\r\n\tpublic range(start: number, end: number): IndexedIterable<T> {\r\n\t\tif (start <= end) {\r\n\t\t\tconst diff = end - start;\r\n\r\n\t\t\tstart = Math.max(start, 0);\r\n\t\t\tend = Math.min(start + diff, this._values.length);\r\n\r\n\t\t\treturn new IndexedIterable(this._values, start, end);\r\n\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"Start index must be lower than end index\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an iterator that has list items sorted backwards.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return List\r\n\t */\r\n\tpublic backwards(): IndexedIterable<T> {\r\n\t\treturn new IndexedIterable(this._values, this._values.length, 0);\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * A version of a [[List]] that has a \"template\".\r\n *\r\n * A template is an instance of an object, that can be used to create new\r\n * elements in the list without actually needing to create instances for those.\r\n *\r\n * When new element is created in the list, e.g. by calling its `create()`\r\n * method, an exact copy of the element is created (including properties and\r\n * other attributes), inserted into the list and returned.\r\n */\r\nexport class ListTemplate<T extends IClone<T> & { isTemplate: boolean }> extends List<T> implements IClone<ListTemplate<T>> {\r\n\t/**\r\n\t * A template object.\r\n\t *\r\n\t * @todo Make this private\r\n\t */\r\n\tpublic _template!: T;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t *\r\n\t * @param t Template object\r\n\t */\r\n\tpublic constructor(t: T) {\r\n\t\tsuper();\r\n\t\tthis.template = t;\r\n\t}\r\n\r\n\t/**\r\n\t * A \"template\" object to copy all properties from when creating new list\r\n\t * items.\r\n\t *\r\n\t * @param v  Template object\r\n\t */\r\n\tpublic set template(v: T) {\r\n\t\tv.isTemplate = true;\r\n\t\tthis._template = v;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Template object\r\n\t */\r\n\tpublic get template(): T {\r\n\t\treturn this._template;\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all elements from other list.\r\n\t *\r\n\t * @param source  Source list\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\t$iter.each(source.iterator(), (value) => {\r\n\t\t\tthis.push(value.clone());\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Instantiates a new object of the specified type, adds it to the end of\r\n\t * the list, and returns it.\r\n\t *\r\n\t * @param make  Item type to use. Will use the default type for the list if not specified.\r\n\t * @return      Newly created item\r\n\t */\r\n\tpublic create(make: { new(): T; }): T;\r\n\tpublic create(): T;\r\n\tpublic create(make?: { new(): T; }): T {\r\n\t\tconst clone =\r\n\t\t\t(make != null\r\n\t\t\t\t? new make()\r\n\t\t\t\t: this.template.clone());\r\n\r\n\t\tthis.push(clone);\r\n\r\n\t\treturn clone;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates an exact clone of the list, including its items and template.\r\n\t *\r\n\t * @return New list\r\n\t */\r\n\tpublic clone(): ListTemplate<T> {\r\n\t\tconst out = new ListTemplate(this.template);\r\n\r\n\t\tconst values = this.values;\r\n\r\n\t\tconst length = values.length;\r\n\r\n\t\tfor (let i = 0; i < length; ++i) {\r\n\t\t\tout.push(values[i].clone());\r\n\t\t}\r\n\r\n\t\treturn out;\r\n\t}\r\n\r\n}\r\n","/**\r\n * This module contains a version of ColorSet that can (and should) be used for\r\n * coloring UI elements.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObject } from \"../Base\";\r\nimport { registry } from \"../Registry\";\r\nimport { Color, color } from \"./Color\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines available color purposes and their relation with the color set color\r\n * index.\r\n */\r\nexport interface IColorPurpose {\r\n\tstroke: Color,\r\n\tfill: Color,\r\n\r\n\tprimaryButton: Color,\r\n\tprimaryButtonHover: Color,\r\n\tprimaryButtonDown: Color,\r\n\tprimaryButtonActive: Color,\r\n\tprimaryButtonText: Color,\r\n\tprimaryButtonStroke: Color,\r\n\r\n\tsecondaryButton: Color,\r\n\tsecondaryButtonHover: Color,\r\n\tsecondaryButtonDown: Color,\r\n\tsecondaryButtonActive: Color,\r\n\tsecondaryButtonText: Color,\r\n\tsecondaryButtonStroke: Color,\r\n\r\n\tgrid: Color,\r\n\tbackground: Color,\r\n\talternativeBackground: Color,\r\n\ttext: Color,\r\n\talternativeText: Color,\r\n\tdisabledBackground: Color,\r\n\r\n\tpositive: Color,\r\n\tnegative: Color\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * This module contains a version of ColorSet that can (and should) be used for\r\n * coloring UI elements.\r\n *\r\n * The main difference from the basic [[ColorSet]] is that instead of sequenced\r\n * colors, it uses a concept of named colors.\r\n *\r\n * This way, every element in the UI can extract an exact color theme author\r\n * meant for the specific purpose, like strokes, backgrounds, etc.\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v4/concepts/colors/} for color-related info\r\n */\r\nexport class InterfaceColorSet extends BaseObject {\r\n\r\n\t/**\r\n\t * Maps the list of purposes (like \"stroke\") to an index of color of the\r\n\t * color set.\r\n\t */\r\n\tprotected _purposes: IColorPurpose = {\r\n\t\tstroke: color(\"#e5e5e5\"),\r\n\t\tfill: color(\"#f3f3f3\"),\r\n\r\n\t\tprimaryButton: color(\"#6794dc\"),\r\n\t\tprimaryButtonHover: color(\"#6771dc\"),\r\n\t\tprimaryButtonDown: color(\"#68dc75\"),\r\n\t\tprimaryButtonActive: color(\"#68dc75\"),\r\n\t\tprimaryButtonText: color(\"#FFFFFF\"),\r\n\t\tprimaryButtonStroke: color(\"#FFFFFF\"),\r\n\r\n\t\tsecondaryButton: color(\"#d9d9d9\"),\r\n\t\tsecondaryButtonHover: color(\"#d9d9d9\").brighten(-0.25),\r\n\t\tsecondaryButtonDown: color(\"#d9d9d9\").brighten(-0.35),\r\n\t\tsecondaryButtonActive: color(\"#d9d9d9\").brighten(0.35),\r\n\t\tsecondaryButtonText: color(\"#000000\"),\r\n\r\n\t\tsecondaryButtonStroke: color(\"#FFFFFF\"),\r\n\r\n\t\tgrid: color(\"#000000\"),\r\n\t\tbackground: color(\"#ffffff\"),\r\n\t\talternativeBackground: color(\"#000000\"),\r\n\t\ttext: color(\"#000000\"),\r\n\t\talternativeText: color(\"#FFFFFF\"),\r\n\t\tdisabledBackground: color(\"#999999\"),\r\n\t\tpositive: color(\"#67dc75\"),\r\n\t\tnegative: color(\"#dc6788\")\r\n\t};\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"InterfaceColorSet\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\tprotected debug(): void {}\r\n\r\n\t/**\r\n\t * Returns a color to be used for the specific purpose.\r\n\t *\r\n\t * ```TypeScript\r\n\t * let uicolors = new am4core.InterfaceColorSet();\r\n\t * console.log(uicolors.getFor(\"stroke\"));\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * var uicolors = new am4core.InterfaceColorSet();\r\n\t * console.log(uicolors.getFor(\"stroke\"));\r\n\t * ```\r\n\t *\r\n\t * @param purpose  Color use purpuse\r\n\t * @return Color\r\n\t */\r\n\tpublic getFor(purpose: keyof IColorPurpose): Color {\r\n\t\treturn this._purposes[purpose];\r\n\t}\r\n\r\n\t/**\r\n\t * Sets color to be used for the specific purpose.\r\n\t *\r\n\t * @param purpose  Color use purpose\r\n\t * @param color    Color\r\n\t */\r\n\tpublic setFor(purpose: keyof IColorPurpose, color: Color): void {\r\n\t\tthis._purposes[purpose] = color;\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"InterfaceColorSet\"] = InterfaceColorSet;\r\n","/**\r\n * This module contains Color object definition\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { iRGB, iHSV, iHSL } from \"./Colors\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $colors from \"./Colors\";\r\nimport * as $type from \"./Type\";\r\n\r\n// Re-export\r\nexport { iRGB, iHSV, iHSL };\r\n\r\n/**\r\n * Represents a color.\r\n *\r\n * `Color` accepts value only in [[iRGB]] object format. To create `Color`\r\n * object by parsing it from any supported string-based formats, use helper\r\n * [[color]] function:\r\n *\r\n * ```TypeScript\r\n * am4core.color(\"#ff0000\");\r\n * am4core.color(\"#f00\");\r\n * am4core.color(\"rgb(255, 0, 0)\");\r\n * am4core.color(\"rgba(255, 0, 0, 0.5)\");\r\n * am4core.color({ r: 255, g: 0, b: 0 });\r\n * am4core.color(\"red\");\r\n * ```\r\n * ```JavaScript\r\n * am4core.color(\"#ff0000\");\r\n * am4core.color(\"#f00\");\r\n * am4core.color(\"rgb(255, 0, 0)\");\r\n * am4core.color(\"rgba(255, 0, 0, 0.5)\");\r\n * am4core.color({ r: 255, g: 0, b: 0 });\r\n * am4core.color(\"red\");\r\n * ```\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v4/concepts/colors/} for color-related info\r\n */\r\nexport class Color {\r\n\r\n\t/**\r\n\t * Light color (used when light contrasting color is required).\r\n\t *\r\n\t * @param {Color}\r\n\t * @ignore\r\n\t */\r\n\tprotected _lightColor: $type.Optional<Color>;\r\n\r\n\t/**\r\n\t * Dark color (used when dark contrasting color is required).\r\n\t *\r\n\t * @param {Color}\r\n\t * @ignore\r\n\t */\r\n\tprotected _darkColor: $type.Optional<Color>;\r\n\r\n\t/**\r\n\t * Holds RGB value of the color.\r\n\t */\r\n\tprotected _value: $type.Optional<iRGB>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t *\r\n\t * @param color Source color\r\n\t */\r\n\tconstructor(color: $type.Optional<iRGB>) {\r\n\t\tthis._value = color;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns [[iRGB]] representation of the color.\r\n\t *\r\n\t * @return RGB object\r\n\t */\r\n\tpublic get rgb(): $type.Optional<iRGB> {\r\n\t\treturn this._value;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns color hex value string, e.g. \"#FF0000\".\r\n\t *\r\n\t * @return Hex color code\r\n\t */\r\n\tpublic get hex(): string {\r\n\t\treturn this._value ? $colors.rgbToHex(this._value) : \"none\";\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an `rgba()` representation of the color, e.g.:\r\n\t * `rgba(255, 0, 0, 0.5)`.\r\n\t *\r\n\t * @return rgba color string\r\n\t */\r\n\tpublic get rgba(): string {\r\n\t\treturn this._value ? $colors.rgbToRGBA(this._value) : \"none\";\r\n\t}\r\n\r\n\t/**\r\n\t * Set alpha (transparency) of the color.\r\n\t *\r\n\t * @param value Alpha (0-1)\r\n\t */\r\n\tpublic set alpha(value: number) {\r\n\t\tif (this._value) {\r\n\t\t\tthis._value.a = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current transparency.\r\n\t *\r\n\t * @return Alpha (0-1)\r\n\t */\r\n\tpublic get alpha(): number {\r\n\t\tif (this._value != null && this._value.a != null) {\r\n\t\t\treturn this._value.a;\r\n\r\n\t\t} else {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets \"light\" color. Used when determining contrasting color.\r\n\t *\r\n\t * @param color Color\r\n\t */\r\n\tpublic set lightColor(color: Color) {\r\n\t\tthis._lightColor = color;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current light color setting.\r\n\t *\r\n\t * @return Color\r\n\t */\r\n\tpublic get lightColor(): Color {\r\n\t\tif (!this._lightColor) {\r\n\t\t\tthis._lightColor = new Color({ r: 255, g: 255, b: 255 });\r\n\t\t}\r\n\t\treturn this._lightColor;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets \"dark\" color. Used when determining contrasting color.\r\n\t *\r\n\t * @param color Color\r\n\t */\r\n\tpublic set darkColor(color: Color) {\r\n\t\tthis._darkColor = color;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current dark color setting.\r\n\t *\r\n\t * @return Color\r\n\t */\r\n\tpublic get darkColor(): Color {\r\n\t\tif (!this._darkColor) {\r\n\t\t\tthis._darkColor = new Color({ r: 0, g: 0, b: 0 });\r\n\t\t}\r\n\t\treturn this._darkColor;\r\n\t}\r\n\r\n\t/**\r\n\t * Overrides `toString` method so that [[Color]] object can be used as\r\n\t * string.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return String represantion of color (usable in CSS)\r\n\t */\r\n\tpublic toString(): string {\r\n\t\treturn this.alpha < 1 ? this.rgba : this.hex;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new [[Color]] which is percent lighter (positive value),\r\n\t * or darker (negative value).\r\n\t *\r\n\t * Parameter is in the scale of -1 to 1.\r\n\t *\r\n\t * @param percent  Increase/decrease lightness by X\r\n\t * @return New Color\r\n\t */\r\n\tpublic lighten(percent: number): Color {\r\n\t\treturn new Color($colors.lighten(this.rgb, percent));\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new [[Color]] which is percent brighter (positive value),\r\n\t * or darker (negative value).\r\n\t *\r\n\t * Parameter is in the scale of -1 to 1.\r\n\t *\r\n\t * @param percent  Increase/decrease brightness by X\r\n\t * @return New Color\r\n\t */\r\n\tpublic brighten(percent: number): Color {\r\n\t\treturn new Color($colors.brighten(this.rgb, percent));\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new [[Color]] based on current color with specific saturation\r\n\t * applied.\r\n\t *\r\n\t * `saturation` can be in the range of 0 (fully desaturated) to 1 (fully\r\n\t * saturated).\r\n\t *\r\n\t * @param saturation  Saturation (0-1)\r\n\t * @return New (saturated) color\r\n\t */\r\n\tpublic saturate(saturation: number): Color {\r\n\t\treturn new Color($colors.saturate(this.rgb, saturation));\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a either light or dark color that contrasts specifically with\r\n\t * this color.\r\n\t *\r\n\t * Uses properties `darkColor` (default black) and `lightColor` (default\r\n\t * white).\r\n\t *\r\n\t * Useful when determining which color label should be on a colored\r\n\t * background, so that it stands out.\r\n\t *\r\n\t * @return Contrasting color\r\n\t */\r\n\tpublic get alternative(): Color {\r\n\t\tif (this.rgb != null) {\r\n\t\t\treturn $colors.isLight(this.rgb) ? this.darkColor : this.lightColor;\r\n\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"Color does not exist\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Resolves an input variable to a normal [[iRGB]] color and creates [[Color]]\r\n * object for it.\r\n *\r\n * @param value  Input value\r\n * @param alpha  Alpha (0-1)\r\n * @return Color object\r\n */\r\nexport function color(value?: string | iRGB | Color, alpha?: number): Color {\r\n\r\n\tif (!$type.hasValue(value)) {\r\n\t\treturn new Color(undefined);\r\n\t}\r\n\r\n\tif (typeof value == \"string\") {\r\n\t\tlet cacheId = \"_color_\" + value + \"_\" + (alpha || \"1\");\r\n\t\tlet cached = registry.getCache(cacheId);\r\n\t\tif (cached) {\r\n\t\t\treturn new Color({\r\n\t\t\t\tr: cached.r,\r\n\t\t\t\tg: cached.g,\r\n\t\t\t\tb: cached.b,\r\n\t\t\t\ta: cached.a\r\n\t\t\t});\r\n\t\t}\r\n\t\tlet rgb = $colors.rgb(value, alpha);\r\n\t\tregistry.setCache(cacheId, rgb);\r\n\t\treturn new Color(rgb);\r\n\t}\r\n\r\n\t// Check if it's already a Color object\r\n\tif (value instanceof Color) {\r\n\t\tif ($type.hasValue(alpha)) {\r\n\t\t\tvalue.alpha = alpha;\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\t// Not a string or Color instance, it's the iRGB object then\r\n\treturn new Color(value);\r\n}\r\n\r\n/**\r\n * Checks if supplied argument is instance of [[Color]].\r\n *\r\n * @param value  Input value\r\n * @return Is Color?\r\n */\r\nexport function isColor(value: any): boolean {\r\n\treturn value instanceof Color;\r\n}\r\n\r\n/**\r\n * Converts any value to [[Color]].\r\n *\r\n * @param value  Input value\r\n * @return Color\r\n */\r\nexport function castColor(value: any): Color {\r\n\treturn color(value);\r\n}\r\n\r\n/**\r\n * Converts any value into a [[Color]].\r\n *\r\n * @param value  Source value\r\n * @return Color object\r\n */\r\nexport function toColor(value: any): Color {\r\n\tif ($type.hasValue(value) && !isColor(value)) {\r\n\t\treturn castColor(value);\r\n\t}\r\n\treturn value;\r\n}\r\n","/**\r\n * Container module\r\n * @todo Needs description\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite, ISpriteProperties, ISpriteAdapters, ISpriteEvents, AMEvent } from \"./Sprite\";\r\nimport { SpriteState } from \"./SpriteState\";\r\nimport { Animation } from \"./utils/Animation\";\r\nimport { List, IListEvents } from \"./utils/List\";\r\nimport { VerticalAlign } from \"./defs/VerticalAlign\";\r\nimport { IDisposer, MultiDisposer } from \"./utils/Disposer\";\r\nimport { Dictionary, DictionaryDisposer } from \"./utils/Dictionary\";\r\nimport { getInteraction } from \"./interaction/Interaction\";\r\nimport { Align } from \"./defs/Align\";\r\nimport { Group } from \"./rendering/Group\";\r\nimport { Rectangle } from \"./elements/Rectangle\";\r\nimport { IPoint } from \"./defs/IPoint\";\r\nimport { Percent } from \"./utils/Percent\";\r\nimport { registry } from \"./Registry\";\r\nimport { Preloader } from \"./elements/Preloader\";\r\nimport { DataItem } from \"./DataItem\";\r\nimport { Optional } from \"./utils/Type\";\r\nimport { InterfaceColorSet } from \"../core/utils/InterfaceColorSet\";\r\nimport { Paper } from \"./rendering/Paper\";\r\nimport * as $iter from \"./utils/Iterator\";\r\nimport * as $array from \"./utils/Array\";\r\nimport * as $math from \"./utils/Math\";\r\nimport * as $type from \"./utils/Type\";\r\nimport * as $dom from \"./utils/DOM\";\r\nimport { system } from \"./System\";\r\nimport { options } from \"./Options\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines available font weights.\r\n */\r\nexport type FontWeight = \"normal\" | \"bold\" | \"bolder\" | \"lighter\" | \"100\" | \"200\" | \"300\" | \"400\" | \"500\" | \"600\" | \"700\" | \"800\" | \"900\";\r\n\r\n/**\r\n * Defines available text decorations.\r\n */\r\nexport type TextDecoration = \"none\" | \"underline\" | \"overline\" | \"line-through\" | \"blink\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * DATA ITEM\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n// Defined in DataItem.ts\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines available [[Container]] layout types\r\n */\r\nexport type ContainerLayout = \"absolute\" | \"vertical\" | \"horizontal\" | \"grid\" | \"none\";\r\n\r\n/**\r\n * Defines properties for [[Container]]\r\n */\r\nexport interface IContainerProperties extends ISpriteProperties {\r\n\r\n\t/**\r\n\t * Container layout.\r\n\t *\r\n\t * Options: \"absolute\" (default), \"vertical\", \"horizontal\", or \"grid\".\r\n\t *\r\n\t * @default \"absolute\"\r\n\t */\r\n\tlayout?: ContainerLayout;\r\n\r\n\t/**\r\n\t * Default font weight.\r\n\t *\r\n\t * @default \"normal\"\r\n\t */\r\n\tfontWeight?: FontWeight;\r\n\r\n\t/**\r\n\t * Font size for the text.\r\n\t */\r\n\tfontSize?: number;\r\n\r\n\t/**\r\n\t * Font family for the text.\r\n\t */\r\n\tfontFamily?: string;\r\n\r\n\t/**\r\n\t * Default font decoration.\r\n\t *\r\n\t * @default \"none\"\r\n\t */\r\n\ttextDecoration?: TextDecoration;\r\n\r\n\t/**\r\n\t * Horizontal alignment of Container's items.\r\n\t */\r\n\tcontentAlign?: Align;\r\n\r\n\t/**\r\n\t * Vertical alignment of Container's items.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tcontentValign?: VerticalAlign;\r\n\r\n\t/**\r\n\t * If set to `true`, all columns of the container with layout type \"grid\"\r\n\t * will be equally sized.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tfixedWidthGrid?: boolean;\r\n\r\n\t/**\r\n\t * Maximum number of columns (when using `\"grid\"` layout).\r\n\t */\r\n\tmaxColumns?: number;\r\n\r\n\t/**\r\n\t * If set to `true`, the children of the container will be drawn in reverse\r\n\t * order.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\treverseOrder?: boolean;\r\n\r\n\t/**\r\n\t * Specifies if, when state is applied on this container, the same state\r\n\t * should be applied to container's children as well as `background`.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tsetStateOnChildren?: boolean\r\n}\r\n\r\n/**\r\n * Defines events for the [[Container]]\r\n */\r\nexport interface IContainerEvents extends ISpriteEvents {\r\n\r\n\t/**\r\n\t * Invoked when a child Sprite is added to Container.\r\n\t */\r\n\tchildadded: {\r\n\t\tnewValue: Sprite;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when a child Sprite is removed from\r\n\t */\r\n\tchildremoved: {\r\n\t\toldValue: Sprite;\r\n\t};\r\n\r\n\t/**\r\n\t * invoked when layout of the container is validated\r\n\t */\r\n\tlayoutvalidated:{ }\r\n\r\n};\r\n\r\n/**\r\n * Defines adapters\r\n * Includes both the [[Adapter]] definitions and properties\r\n * @see {@link Adapter}\r\n */\r\nexport interface IContainerAdapters extends ISpriteAdapters, IContainerProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Container can contain multiple sprites and arrange them in various layouts.\r\n *\r\n * @see {@link IContainerEvents} for a list of available events\r\n * @see {@link IContainerAdapters} for a list of available Adapters\r\n * @important\r\n */\r\nexport class Container extends Sprite {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IContainerProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IContainerAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IContainerEvents;\r\n\r\n\t/**\r\n\t * Container children. (sorted by layout)\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _childrenByLayout: Sprite[] = [];\r\n\r\n\t/**\r\n\t * Available width (px).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _availableWidth: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * Available height (px).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _availableHeight: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * Container's child elements. (sorded by their `zIndex`)\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _children: $type.Optional<List<Sprite>>;\r\n\r\n\t/**\r\n\t * Container's disposers for its child elements.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _childrenDisposers: Dictionary<string, IDisposer> = new Dictionary();\r\n\r\n\r\n\t/**\r\n\t * A [[Sprite]] instance to use as Container's background.\r\n\t *\r\n\t * @todo Make it protected\r\n\t */\r\n\tpublic _background: Sprite;\r\n\r\n\t/**\r\n\t * A reference to a [[Preloader]] element to show when Container is building\r\n\t * itself.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _preloader: $type.Optional<Preloader>;\r\n\r\n\t/**\r\n\t * Indicates if this container contains any focused elements, including\r\n\t * itself.\r\n\t */\r\n\tpublic hasFocused: boolean = false;\r\n\r\n\t/**\r\n\t * A reference to a currently focused item.\r\n\t *\r\n\t * @since 4.9.29\r\n\t */\r\n\tpublic focusedElement: $type.Optional<Sprite>;\r\n\r\n\t/**\r\n\t * An array of references to elements the state should be set, when it is set\r\n\t * on this element.\r\n\t */\r\n\tpublic setStateOnSprites: Sprite[] = [];\r\n\r\n\t/*\r\n\t * @ignore\r\n\t */\r\n\tpublic layoutInvalid: boolean = false;\r\n\r\n\tprotected _absoluteWidth: number = 0;\r\n\r\n\tprotected _absoluteHeight: number = 0;\r\n\r\n\t/**\r\n\t * Width (in pixels) of the actual content in the Container.\r\n\t *\r\n\t * Please note that it might be bigger than width of the Container.\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tpublic contentWidth: number;\r\n\r\n\t/**\r\n\t * Height (in pixels) of the actual content in the Container.\r\n\t *\r\n\t * Please note that it might be bigger than height of the Container.\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tpublic contentHeight: number;\r\n\r\n\r\n\t/**\r\n\t * An array of child Sprites that should be ready before this object can\r\n\t * fire a \"ready\" event.\r\n\t */\r\n\tprotected _shouldBeReady: Sprite[] = [];\r\n\r\n\t/**\r\n\t * Enables touch tap protection.\r\n\t */\r\n\tprotected _tapToActivate: boolean = false;\r\n\r\n\t/**\r\n\t * Timeout reference for `tapToActivate` functionality.\r\n\t */\r\n\tprotected _tapToActivateTimeout: Optional<IDisposer>;\r\n\r\n\t/**\r\n\t * If `tapToActivate` is used, this setting will determine how long the chart\r\n\t * will stay in \"active\" mode.\r\n\t *\r\n\t * @default 3000\r\n\t * @since 4.4.0\r\n\t */\r\n\tpublic tapTimeout: number = 3000;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"Container\";\r\n\r\n\t\tthis._element = this.paper.addGroup(\"g\");\r\n\t\tthis.group.add(this.element);\r\n\r\n\t\tthis.setPropertyValue(\"pixelPerfect\", false);\r\n\t\tthis.setPropertyValue(\"layout\", \"absolute\");\r\n\t\tthis.setPropertyValue(\"fixedWidthGrid\", false);\r\n\r\n\t\tthis.setPropertyValue(\"verticalCenter\", \"none\");\r\n\t\tthis.setPropertyValue(\"horizontalCenter\", \"none\");\r\n\r\n\t\tthis._positionPrecision = 4;\r\n\r\n\t\tthis._disposers.push(new DictionaryDisposer(this._childrenDisposers));\r\n\r\n\t\tthis.children.events.on(\"inserted\", this.handleChildAdded, this);\r\n\t\tthis.children.events.on(\"removed\", this.handleChildRemoved, this);\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Handles adding of a new child into `children`. Adding new children might\r\n\t * affect the whole layout so it needs to be revalidated.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param event Event object\r\n\t * @todo Throw an exception on adding a disposed object. Of course it's better NOT TO add disposed objects, so that what we should focus on.\r\n\t */\r\n\tpublic handleChildAdded(event: IListEvents<Sprite>[\"inserted\"]): void {\r\n\t\tthis.processChild(event.newValue);\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic processChild(child: Sprite) {\r\n\t\t// try solves the problem when somedy adds child directly to children\r\n\t\ttry {\r\n\t\t\tthis._childrenDisposers.insertKey(child.uid, new MultiDisposer([\r\n\t\t\t\t// it's not enough to listen to POSITION_CHANGED only, as some extra redrawals will happen.\r\n\t\t\t\tchild.events.on(\"transformed\", this.handleChildTransform, this),\r\n\t\t\t\tchild.events.on(\"zIndexChanged\", this.sortAndAdd, this)\r\n\t\t\t]));\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\t// void\r\n\t\t}\r\n\r\n\t\tif (this.element) {\r\n\t\t\tlet group = <Group>this.element;\r\n\t\t\tgroup.add(child.group);\r\n\t\t}\r\n\r\n\t\tchild.parent = this;\r\n\t\tchild.paper = this.paper;\r\n\r\n\t\tthis.dispatchImmediately(\"childadded\", { type: \"childadded\", newValue: child });\r\n\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected sortAndAdd() {\r\n\t\tthis.sortChildren();\r\n\t\tthis.addChildren();\r\n\t}\r\n\r\n\t/**\r\n\t * Handles child removal. Changing size of the child may change the\r\n\t * whole layout of the Container, hence layout needs to be invalidated.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param event Event object\r\n\t */\r\n\tpublic handleChildRemoved(event: IListEvents<Sprite>[\"removed\"]): void {\r\n\t\tlet child: Sprite = event.oldValue;\r\n\r\n\t\t// TODO figure out why the key sometimes doesn't exist\r\n\t\tthis._childrenDisposers.removeKey(child.uid);\r\n\r\n\t\tif (this.element) {\r\n\t\t\tlet group = <Group>this.element;\r\n\t\t\tgroup.removeElement(child.group);\r\n\t\t}\r\n\r\n\t\tif (child.isMeasured) {\r\n\t\t\tthis.invalidateLayout();\r\n\t\t}\r\n\r\n\t\tthis.dispatchImmediately(\"childremoved\", { type: \"childremoved\", oldValue: child });\r\n\t}\r\n\r\n\t/**\r\n\t * Handles child transformation. Changing size of the child may change the\r\n\t * whole layout of the Container, hence layout needs to be invalidated.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param event Event object\r\n\t */\r\n\tpublic handleChildTransform(event: AMEvent<Sprite, ISpriteEvents>[\"transformed\"] | AMEvent<Sprite, ISpriteEvents>[\"sizechanged\"]): void {\r\n\t\tlet child: Sprite = event.target;\r\n\t\tif (child.isMeasured) {// && this.layout != \"none\" && this.layout != \"absolute\") {\r\n\t\t\tthis.invalidateLayout();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates Container's layout, causing it to be re-evaluated again.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic invalidateLayout(): void {\r\n\t\tif (this.layoutInvalid || this.disabled || this.isTemplate || this.layout == \"none\" || this.__disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.layoutInvalid = true;\r\n\t\tregistry.addToInvalidLayouts(this);\r\n\t\tsystem.requestFrame();\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates element.\r\n\t *\r\n\t * Object will be redrawn during the next update cycle.\r\n\t *\r\n\t * Please note that in most cases elements will auto-invalidate when needed. If\r\n\t * everything works, DO NOT use this method. Use it only if some changes do\r\n\t * not take otherwise.\r\n\t */\r\n\tpublic invalidate(): void {\r\n\t\tsuper.invalidate();\r\n\t\tthis.invalidateLayout();\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates the whole element, including layout AND all its child\r\n\t * elements.\r\n\t *\r\n\t * As this will essentially force all elements to redraw, use only if\r\n\t * absolutely necessary.\r\n\t */\r\n\tpublic deepInvalidate(): void {\r\n\t\tsuper.invalidate();\r\n\t\t//this.sortChildren();\r\n\r\n\t\t$array.each(this._childrenByLayout, (child) => {\r\n\t\t\tif (child instanceof Container) {\r\n\t\t\t\tchild.deepInvalidate();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tchild.invalidate();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.invalidateLayout();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a list of the child [[Sprite]] elements contained in this\r\n\t * Container.\r\n\t *\r\n\t * @return List of child elements (Sprites)\r\n\t */\r\n\tpublic get children(): List<Sprite> {\r\n\t\t// @todo Review if we can add all children to disposers\r\n\t\tif (!this._children) {\r\n\t\t\tthis._children = new List<Sprite>();\r\n\t\t\t//this._disposers.push(new ListDisposer(this._children));\r\n\t\t}\r\n\t\treturn this._children;\r\n\t}\r\n\r\n\t/**\r\n\t * Minimum width (px) for the Container. A container will not\r\n\t * auto-shrink beyond this value, even if child elements are smaller.\r\n\t *\r\n\t * @param value  Width (px)\r\n\t */\r\n\tpublic set minWidth(value: Optional<number>) {\r\n\t\tif (this.setPropertyValue(\"minWidth\", value)) {\r\n\t\t\tthis.invalidateLayout();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Width (px)\r\n\t */\r\n\tpublic get minWidth(): Optional<number> {\r\n\t\treturn this.getPropertyValue(\"minWidth\");\r\n\t}\r\n\r\n\t/**\r\n\t * Minimum height (px) for the Container. A container will not\r\n\t * auto-shrink beyond this value, even if child elements are smaller.\r\n\t *\r\n\t * @param value  Height (px)\r\n\t */\r\n\tpublic set minHeight(value: Optional<number>) {\r\n\t\tif (this.setPropertyValue(\"minHeight\", value)) {\r\n\t\t\tthis.invalidateLayout();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Height (px)\r\n\t */\r\n\tpublic get minHeight(): Optional<number> {\r\n\t\treturn this.getPropertyValue(\"minHeight\");\r\n\t}\r\n\r\n\t/**\r\n\t * Overrides the original `removeElement` so that Container's actual element\r\n\t * is not removed. We do not need to remove element of a Container.\r\n\t *\r\n\t * We do this because remove element each time will fail the `getBBox`.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected removeElement(): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Sorts Container's children: the ones with variable width and height are\r\n\t * put at the end of the list (depending on layout type), so that fixed-width\r\n\t * ones can be drawn first.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic sortChildren(): void {\r\n\r\n\t\tthis._childrenByLayout = [];\r\n\r\n\t\tif (this.layout == \"none\" || this.layout == \"absolute\" || !this.layout) {\r\n\t\t\t//$iter.each(this.children.iterator(), (child) => {\r\n\t\t\t//\tthis._childrenByLayout.push(child);\r\n\t\t\t//});\r\n\t\t\tthis._childrenByLayout = this.children.values;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Assemble fixed-size and relative lists\r\n\t\t\tlet fixed: Sprite[] = [];\r\n\t\t\tlet relative: Sprite[] = [];\r\n\r\n\t\t\t$iter.each(this.children.iterator(), (child) => {\r\n\t\t\t\tif (this.layout == \"horizontal\" || this.layout == \"grid\") {\r\n\t\t\t\t\tif (!$type.isNumber(child.percentWidth)) {\r\n\t\t\t\t\t\tfixed.push(child);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\trelative.push(child);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.layout == \"vertical\") {\r\n\t\t\t\t\tif (!$type.isNumber(child.percentHeight)) {\r\n\t\t\t\t\t\tfixed.push(child);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\trelative.push(child);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfixed.push(child);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Concat everything into list\r\n\t\t\tthis._childrenByLayout = fixed.concat(relative);\r\n\t\t}\r\n\r\n\t\tthis.calculateRelativeSize();\r\n\t}\r\n\r\n\t/**\r\n\t * Calculates relative sizes for all Container's children.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Make it protected?\r\n\t */\r\n\tpublic calculateRelativeSize(): void {\r\n\t\tlet totalRelativeWidth: number = 0;\r\n\t\tlet totalRelativeHeight: number = 0;\r\n\r\n\t\t$array.each(this._childrenByLayout, (child) => {\r\n\t\t\t// if child is not measured, we do not care about it at all.\r\n\t\t\tif (child.isMeasured) {\r\n\t\t\t\tif ($type.isNumber(child.percentWidth)) {\r\n\t\t\t\t\ttotalRelativeWidth += child.percentWidth;\r\n\t\t\t\t}\r\n\t\t\t\tif ($type.isNumber(child.percentHeight)) {\r\n\t\t\t\t\ttotalRelativeHeight += child.percentHeight;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$array.each(this._childrenByLayout, (child) => {\r\n\t\t\tif (child.isMeasured) {\r\n\t\t\t\tif (this.layout == \"horizontal\") {\r\n\t\t\t\t\tif ($type.isNumber(child.percentWidth)) {\r\n\t\t\t\t\t\tchild.relativeWidth = child.percentWidth / totalRelativeWidth;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ($type.isNumber(child.percentHeight)) {\r\n\t\t\t\t\t\tchild.relativeHeight = child.percentHeight / 100;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (this.layout == \"vertical\") {\r\n\t\t\t\t\tif ($type.isNumber(child.percentHeight)) {\r\n\t\t\t\t\t\tchild.relativeHeight = child.percentHeight / totalRelativeHeight;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ($type.isNumber(child.percentWidth)) {\r\n\t\t\t\t\t\tchild.relativeWidth = child.percentWidth / 100;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.layout == \"grid\") {\r\n\t\t\t\t\tif ($type.isNumber(child.percentHeight)) {\r\n\t\t\t\t\t\tchild.relativeHeight = child.percentHeight / 100;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ($type.isNumber(child.percentWidth)) {\r\n\t\t\t\t\t\tchild.relativeWidth = child.percentWidth / 100;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.layout == \"absolute\" || !child.isMeasured) {\r\n\t\t\t\tif ($type.isNumber(child.percentWidth)) {\r\n\t\t\t\t\tchild.relativeWidth = child.percentWidth / 100;\r\n\t\t\t\t}\r\n\t\t\t\tif ($type.isNumber(child.percentHeight)) {\r\n\t\t\t\t\tchild.relativeHeight = child.percentHeight / 100;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Adds all children to Container's SVG element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected addChildren(): void {\r\n\t\t/*\r\n\t\t  Need this check because a child might be assigned to parent even before element is created, for example a theme\r\n\t\t  access scrollbar.thumb\r\n\t\t*/\r\n\t\tif (this.element) {\r\n\t\t\tlet zindexed = $array.copy(this.children.values); // not children by layout!\r\n\r\n\t\t\tlet sortArray = zindexed.map(function(data, idx) {\r\n\t\t\t\treturn { idx: idx, data: data }\r\n\t\t\t});\r\n\r\n\t\t\tsortArray.sort(function(a: any, b: any) {\r\n\t\t\t\tconst ai = (a.data.zIndex || 0);\r\n\t\t\t\tconst bi = (b.data.zIndex || 0);\r\n\t\t\t\tif (ai < bi) { return -1; }\r\n\t\t\t\tif (ai > bi) { return 1; }\r\n\t\t\t\treturn a.idx - b.idx\r\n\t\t\t});\r\n\r\n\t\t\tzindexed = sortArray.map(function(val) {\r\n\t\t\t\treturn val.data;\r\n\t\t\t});\r\n\r\n\t\t\tlet group = <Group>this.element;\r\n\r\n\t\t\t// check, maybe the order is good already\r\n\t\t\tlet isCorrect = true;\r\n\r\n\t\t\tif (group.node && group.node.childNodes) {\r\n\t\t\t\tfor (let i = 0, len = group.node.childNodes.length; i < len; i++) {\r\n\t\t\t\t\tif (group.node.childNodes[i] != zindexed[i].group.node) {\r\n\t\t\t\t\t\tisCorrect = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!isCorrect) {\r\n\t\t\t\t$array.each(zindexed, (child) => {\r\n\t\t\t\t\tif (child.group) {\r\n\t\t\t\t\t\tgroup.add(child.group);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\r\n\t\t\t\tif (this._background) {\r\n\t\t\t\t\tthis.group.addToBack(this._background.group);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.invalidateLayout();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new element of specific type and assigns as a child to the\r\n\t * Container.\r\n\t *\r\n\t * @param Class type for the new element\r\n\t * @return New element\r\n\t */\r\n\tpublic createChild<T extends Sprite>(classType: { new(): T; }): T {\r\n\t\tlet sprite = new classType();\r\n\t\tsprite.parent = this;\r\n\t\treturn sprite;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all Container's children without actually destroying them.\r\n\t *\r\n\t * To destroy children use `disposeChildren()` instead.\r\n\t */\r\n\tpublic removeChildren(): void {\r\n\t\t// remove all children\r\n\t\t// TODO use iteration instead\r\n\t\twhile (this.children.length > 0) {\r\n\t\t\tlet child = <Sprite>this.children.getIndex(0);\r\n\t\t\tchild.parent = undefined;\r\n\t\t\tthis.children.removeValue(child);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes and destroys all Container's children.\r\n\t *\r\n\t * To remove children from Container without destroying them, use\r\n\t * `removeChildren()`.\r\n\t */\r\n\tpublic disposeChildren(): void {\r\n\t\t// TODO use iteration instead\r\n\t\twhile (this.children.length > 0) {\r\n\t\t\tlet child = <Sprite>this.children.getIndex(0);\r\n\t\t\tchild.dispose();\r\n\t\t\tthis.children.removeValue(child);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * An element to use as container background.\r\n\t *\r\n\t * @param background  Background element\r\n\t */\r\n\tpublic set background(background: this[\"_background\"]) {\r\n\t\tif (this._background && this.background != background) {\r\n\t\t\tthis.removeDispose(this._background);\r\n\t\t}\r\n\r\n\t\tif (background) {\r\n\t\t\tthis._background = background;\r\n\t\t\tthis._disposers.push(background);\r\n\t\t\tthis.processBackground();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles the situation where parent element is resized.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic handleGlobalScale(): void {\r\n\t\tsuper.handleGlobalScale();\r\n\t\tthis.children.each((child) => {\r\n\t\t\tchild.handleGlobalScale();\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns a [[Rectangle]] to use as a background for Container.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Background Rectangle element\r\n\t */\r\n\tpublic createBackground(): this[\"_background\"] {\r\n\t\treturn <any>new Rectangle();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Background element\r\n\t */\r\n\tpublic get background(): this[\"_background\"] {\r\n\t\tif (!this._background) {\r\n\t\t\tthis._background = this.createBackground();\r\n\t\t\tthis.processBackground();\r\n\t\t}\r\n\r\n\t\treturn this._background;\r\n\t}\r\n\r\n\t/**\r\n\t * Decorates background element with required properties.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic processBackground(): void {\r\n\t\tlet background = this._background;\r\n\t\tif (background) {\r\n\t\t\tbackground.isMeasured = false;\r\n\t\t\tthis._background.fill = new InterfaceColorSet().getFor(\"background\");\r\n\t\t\tbackground.parent = this;\r\n\t\t\tbackground.isMeasured = false;\r\n\t\t\tthis.children.removeValue(background);\r\n\t\t\tthis._disposers.push(background);\r\n\t\t\tthis.group.addToBack(this._background.group);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Measures the size of container and informs its children of how much size\r\n\t * they can occupy, by setting their relative `maxWidth` and `maxHeight`\r\n\t * properties.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validateLayout(): void {\r\n\r\n\t\tregistry.removeFromInvalidLayouts(this);\r\n\r\n\t\tthis.layoutInvalid = false;\r\n\r\n\t\t// prevents from drawing if topparent is 0x0\r\n\t\t/*\r\n\t\tlet topParent = this.topParent;\r\n\t\tif (topParent) {\r\n\t\t\tif (!topParent.maxWidth || !topParent.maxHeight) {\r\n\t\t\t\tthis._disposers.push(topParent.events.once(\"maxsizechanged\", this.invalidateLayout, this));\r\n\t\t\t}\r\n\t\t}*/\r\n\r\n\t\tthis._availableWidth = this.innerWidth;\r\n\t\tthis._availableHeight = this.innerHeight;\r\n\r\n\t\tlet measuredWidth = 0;\r\n\t\tlet measuredHeight = 0;\r\n\r\n\t\tlet allValid = true;\r\n\r\n\t\tif (this.children) {\r\n\r\n\t\t\tthis.sortChildren();\r\n\r\n\t\t\t// we itterate through list of children, sorted by layout priority. sprites which width non-relative width/height will go first, so we will reduce available width before proceeding to sprites with relative width/height\r\n\t\t\t$array.each(this._childrenByLayout, (child) => {\r\n\t\t\t\tlet maxWidth: number;\r\n\t\t\t\tlet maxHeight: number;\r\n\r\n\t\t\t\tif ($type.isNumber(child.relativeWidth)) {\r\n\t\t\t\t\tmaxWidth = $math.round(this._availableWidth * child.relativeWidth, 2);\r\n\t\t\t\t\tif (this.layout == \"horizontal\") {// || this.layout == \"absolute\") {\r\n\t\t\t\t\t\tmaxWidth -= child.pixelMarginRight + child.pixelMarginLeft;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (this.layout == \"horizontal\") {\r\n\t\t\t\t\t\tif (child.invalid) {\r\n\t\t\t\t\t\t\tchild.validate();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($type.isNumber(child.relativeHeight)) {\r\n\t\t\t\t\tmaxHeight = $math.round(this._availableHeight * child.relativeHeight, 2);\r\n\t\t\t\t\tif (this.layout == \"vertical\") {//  || this.layout == \"absolute\") {\r\n\t\t\t\t\t\tmaxHeight -= child.pixelMarginTop + child.pixelMarginBottom;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (this.layout == \"vertical\") {\r\n\t\t\t\t\t\tif (child.invalid) {\r\n\t\t\t\t\t\t\tchild.validate();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// if child is valid\r\n\t\t\t\tif (child.invalid == false) {\r\n\r\n\t\t\t\t\tif ($type.isNumber(child.relativeWidth)) {\r\n\t\t\t\t\t\tchild.maxWidth = maxWidth;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ($type.isNumber(child.relativeHeight)) {\r\n\t\t\t\t\t\tchild.maxHeight = maxHeight;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (child.isMeasured) {\r\n\t\t\t\t\t\t// reduce available width if this is horizontal layout\r\n\t\t\t\t\t\tif (this.layout == \"horizontal\") {\r\n\t\t\t\t\t\t\tif (!$type.isNumber(child.percentWidth)) {\r\n\t\t\t\t\t\t\t\tif (child.measuredWidth > 0) {\r\n\t\t\t\t\t\t\t\t\tthis._availableWidth -= child.measuredWidth + child.pixelMarginLeft + child.pixelMarginRight;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// reduce available height if this is vertical layout\r\n\t\t\t\t\t\tif (this.layout == \"vertical\") {\r\n\t\t\t\t\t\t\tif (!$type.isNumber(child.percentHeight)) {\r\n\t\t\t\t\t\t\t\tif (child.measuredHeight > 0) {\r\n\t\t\t\t\t\t\t\t\tthis._availableHeight -= child.measuredHeight + child.pixelMarginTop + child.pixelMarginBottom;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlet childMeasuredWidth = child.measuredWidth;\r\n\t\t\t\t\t\tlet childMeasuredHeight = child.measuredHeight;\r\n\r\n\t\t\t\t\t\tif (child.align != \"none\") {\r\n\t\t\t\t\t\t\tchildMeasuredWidth += child.pixelMarginLeft + child.pixelMarginRight;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (child.valign != \"none\") {\r\n\t\t\t\t\t\t\tchildMeasuredHeight += child.pixelMarginTop + child.pixelMarginBottom;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tmeasuredWidth = Math.max(measuredWidth, childMeasuredWidth);\r\n\t\t\t\t\t\tmeasuredHeight = Math.max(measuredHeight, childMeasuredHeight);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// if child is not valid\r\n\t\t\t\telse {\r\n\t\t\t\t\t// tell child what maximum width/ height it can occupy\r\n\t\t\t\t\tif (child.isMeasured) {\r\n\t\t\t\t\t\tif ($type.isNumber(child.relativeWidth)) {\r\n\t\t\t\t\t\t\tif (child.maxWidth != maxWidth) { // need to check this because of allValid\r\n\t\t\t\t\t\t\t\tchild.maxWidth = maxWidth;\r\n\t\t\t\t\t\t\t\tallValid = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ($type.isNumber(child.relativeHeight)) {\r\n\t\t\t\t\t\t\tif (child.maxHeight != maxHeight) { // need to check this because of allValid\r\n\t\t\t\t\t\t\t\tchild.maxHeight = maxHeight;\r\n\r\n\t\t\t\t\t\t\t\tallValid = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._absoluteWidth = measuredWidth;\r\n\t\tthis._absoluteHeight = measuredHeight;\r\n\r\n\t\t// arrange after measuring, only if all children are valid already\r\n\t\tif (allValid) {\r\n\t\t\tthis.arrange();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Arranges children according to layout specs and available space / child\r\n\t * sizes.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic arrange(): void {\r\n\t\tlet children = this.children;\r\n\t\t/*\r\n\t\t   in this method we not only arrange children but also find out the size of the container\r\n\t\t   it might seem it would be easier to get container size using sprite's measure method,\r\n\t\t   however it would return only actual size of the bbox. However as each child meight have\r\n\t\t   margins set, we need to check each child - we do it here.\r\n\r\n\t\t   This method doesn't do anything with DOM, so it's not expensive\r\n\t\t*/\r\n\t\tlet measuredWidth: number = 0;\r\n\t\tlet measuredHeight: number = 0;\r\n\r\n\t\t//let innerWidth: number = this.innerWidth; //$math.max(this.innerWidth, this._measuredWidth - paddingLeft - paddingRight);\r\n\t\t//let innerHeight: number = this.innerHeight; //$math.max(this.innerHeight, this._measuredHeight - paddingTop - paddingBottom);\r\n\t\t// above is wrong, as if a w/h is not specified, it is 0 and alignment doesn't work at all.\r\n\t\tlet innerWidth: number = $math.max(this.innerWidth, this._absoluteWidth);\r\n\t\tlet innerHeight: number = $math.max(this.innerHeight, this._absoluteHeight);\r\n\r\n\t\tlet left: $type.Optional<number>;// = 0;\r\n\t\tlet right: $type.Optional<number>;// = innerWidth;\r\n\t\tlet top: $type.Optional<number>;// = 0;\r\n\t\tlet bottom: $type.Optional<number>;// = innerHeight;\r\n\r\n\t\tlet paddingLeft: number = this.pixelPaddingLeft;\r\n\t\tlet paddingRight: number = this.pixelPaddingRight;\r\n\t\tlet paddingTop: number = this.pixelPaddingTop;\r\n\t\tlet paddingBottom: number = this.pixelPaddingBottom;\r\n\r\n\t\tlet nextX: number = 0;\r\n\t\tlet nextY: number = 0;\r\n\t\tlet row: number = 0;\r\n\t\tlet column: number = 0;\r\n\r\n\t\tlet columnWidth: number[] = [];\r\n\t\tlet rowHeight: number[] = [];\r\n\r\n\t\tlet maxCellWidth: $type.Optional<number>;\r\n\t\tlet minCellWidth: $type.Optional<number>;\r\n\t\tlet columnCount: $type.Optional<number>;\r\n\r\n\t\tlet maxWidth = this.maxWidth;\r\n\t\tlet maxHeight = this.maxHeight;\r\n\t\tlet minWidth = this.minWidth;\r\n\t\tlet minHeight = this.minHeight;\r\n\r\n\t\tlet childrenCopy = $array.copy(children.values);\r\n\t\tif (this.reverseOrder) {\r\n\t\t\tchildrenCopy.reverse();\r\n\t\t}\r\n\r\n\t\t// GRID PRECALCULATIONS\r\n\t\tif (this.layout == \"grid\") {\r\n\r\n\t\t\tminCellWidth = maxWidth;\r\n\t\t\tmaxCellWidth = 1;\r\n\r\n\t\t\tfor (let i = 0, len = childrenCopy.length; i < len; i++) {\r\n\t\t\t\tlet child = childrenCopy[i];\r\n\t\t\t\tif (child.isMeasured && !child.disabled && !child.__disabled) {\r\n\t\t\t\t\tlet childMeasuredWidth = child.measuredWidth;\r\n\t\t\t\t\tif (childMeasuredWidth < minCellWidth) {\r\n\t\t\t\t\t\tminCellWidth = childMeasuredWidth;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (childMeasuredWidth > maxCellWidth) {\r\n\t\t\t\t\t\tmaxCellWidth = childMeasuredWidth;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tminCellWidth = $math.fitToRange(minCellWidth, 1, maxWidth);\r\n\t\t\tmaxCellWidth = $math.fitToRange(maxCellWidth, 1, maxWidth);\r\n\r\n\r\n\t\t\tif (this.fixedWidthGrid) {\r\n\t\t\t\tcolumnCount = maxWidth / maxCellWidth;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcolumnCount = maxWidth / minCellWidth; // predicted number of columns, yes it is usually much more than real number, but we fix that later\r\n\t\t\t}\r\n\r\n\t\t\tcolumnCount = $math.max(1, Math.floor(columnCount));\r\n\t\t\tcolumnCount = $math.min(this.maxColumns, columnCount);\r\n\t\t\tcolumnWidth = this.getColumnWidth(childrenCopy, columnCount, maxCellWidth);\r\n\t\t}\r\n\r\n\t\tlet contentLeft: $type.Optional<number>;\r\n\t\tlet contentRight: $type.Optional<number>;\r\n\t\tlet contentTop: $type.Optional<number>;\r\n\t\tlet contentBottom: $type.Optional<number>;\r\n\r\n\t\t// we itterate through array of children\r\n\t\t// TODO use iterator instead\r\n\r\n\r\n\r\n\t\tfor (let i = 0, len = childrenCopy.length; i < len; i++) {\r\n\t\t\tlet child = childrenCopy[i];\r\n\r\n\t\t\tif (child.isMeasured && !child.disabled && !child.__disabled) {\r\n\r\n\t\t\t\tlet x: $type.Optional<number> = undefined;//child.pixelX; // must reset\r\n\t\t\t\tlet y: $type.Optional<number> = undefined;//child.pixelY; // must reset\r\n\r\n\t\t\t\tlet childMarginLeft: number = child.pixelMarginLeft;\r\n\t\t\t\tlet childMarginRight: number = child.pixelMarginRight;\r\n\t\t\t\tlet childMarginTop: number = child.pixelMarginTop;\r\n\t\t\t\tlet childMarginBottom: number = child.pixelMarginBottom;\r\n\r\n\t\t\t\tlet childWidth: number = child.measuredWidth;\r\n\t\t\t\tlet childHeight: number = child.measuredHeight;\r\n\r\n\t\t\t\tlet childLeft: $type.Optional<number>;\r\n\t\t\t\tlet childRight: $type.Optional<number>;\r\n\t\t\t\tlet childTop: $type.Optional<number>;\r\n\t\t\t\tlet childBottom: $type.Optional<number>;\r\n\r\n\t\t\t\tswitch (this.layout) {\r\n\t\t\t\t\tcase \"none\":\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// absolute layout\r\n\t\t\t\t\tcase \"absolute\":\r\n\t\t\t\t\t\t// horizontal alignment\r\n\t\t\t\t\t\tswitch (child.align) {\r\n\t\t\t\t\t\t\tcase \"left\":\r\n\t\t\t\t\t\t\t\tx = childMarginLeft - child.maxLeft;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"center\":\r\n\t\t\t\t\t\t\t\tx = (innerWidth - childWidth) / 2 - child.maxLeft;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"right\":\r\n\t\t\t\t\t\t\t\tx = innerWidth - childMarginRight - child.maxRight;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tif (!(child.x instanceof Percent)) {\r\n\t\t\t\t\t\t\t\t\tx = child.pixelX;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// vertical alignment\r\n\t\t\t\t\t\tswitch (child.valign) {\r\n\t\t\t\t\t\t\tcase \"top\":\r\n\t\t\t\t\t\t\t\ty = childMarginTop - child.maxTop;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"middle\":\r\n\t\t\t\t\t\t\t\ty = (innerHeight - childHeight) / 2 - child.maxTop;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"bottom\":\r\n\t\t\t\t\t\t\t\ty = innerHeight - childMarginBottom - child.maxBottom;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tif (!(child.y instanceof Percent)) {\r\n\t\t\t\t\t\t\t\t\ty = child.pixelY;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// vertical layout\r\n\t\t\t\t\tcase \"vertical\":\r\n\t\t\t\t\t\t//if ($type.isNumber(child.relativeHeight)) {\r\n\t\t\t\t\t\t//\tchildHeight = child.maxHeight;\r\n\t\t\t\t\t\t//}\r\n\r\n\t\t\t\t\t\tswitch (child.align) {\r\n\t\t\t\t\t\t\tcase \"left\":\r\n\t\t\t\t\t\t\t\tx = childMarginLeft - child.maxLeft;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"center\":\r\n\t\t\t\t\t\t\t\tx = (innerWidth - childWidth) / 2 - child.maxLeft;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"right\":\r\n\t\t\t\t\t\t\t\tx = innerWidth - childMarginRight - child.maxRight;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tx = child.pixelX;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ty = nextY + childMarginTop - child.maxTop;\r\n\t\t\t\t\t\tnextY = y + child.maxBottom + childMarginBottom;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t// horizontal layout\r\n\t\t\t\t\tcase \"horizontal\":\r\n\r\n\t\t\t\t\t\t//if ($type.isNumber(child.relativeHeight)) {\r\n\t\t\t\t\t\t//\tchildHeight = child.maxHeight;\r\n\t\t\t\t\t\t//}\r\n\r\n\t\t\t\t\t\tswitch (child.valign) {\r\n\t\t\t\t\t\t\tcase \"top\":\r\n\t\t\t\t\t\t\t\ty = childMarginTop - child.maxTop;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"middle\":\r\n\t\t\t\t\t\t\t\ty = (innerHeight - childHeight) / 2 - child.maxTop;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"bottom\":\r\n\t\t\t\t\t\t\t\ty = innerHeight - childMarginBottom - child.maxBottom;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\ty = child.pixelY;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tx = nextX + childMarginLeft - child.maxLeft;\r\n\t\t\t\t\t\tnextX = x + child.maxRight + childMarginRight;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"grid\":\r\n\t\t\t\t\t\tx = nextX + childMarginLeft - child.maxLeft;\r\n\t\t\t\t\t\tswitch (child.valign) {\r\n\t\t\t\t\t\t\tcase \"top\":\r\n\t\t\t\t\t\t\t\ty = nextY + childMarginTop - child.maxTop;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"middle\":\r\n\t\t\t\t\t\t\t\ty = nextY + (innerHeight - childHeight) / 2 - child.maxTop;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase \"bottom\":\r\n\t\t\t\t\t\t\t\ty = nextY + innerHeight - childMarginBottom - child.maxBottom;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\ty = nextY - child.maxTop;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tnextX += columnWidth[column];\r\n\r\n\t\t\t\t\t\trowHeight[row] = $math.max(rowHeight[row], childHeight);\r\n\t\t\t\t\t\tcolumn++;\r\n\r\n\t\t\t\t\t\tlet nextColumnWidth = columnWidth[column];\r\n\r\n\t\t\t\t\t\tif (!$type.isNumber(nextColumnWidth)) {\r\n\t\t\t\t\t\t\tnextColumnWidth = maxCellWidth;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (nextX > $math.min(this.innerWidth, maxWidth) - nextColumnWidth + 1 && column < columnCount) {\r\n\t\t\t\t\t\t\tcolumnCount = column;\r\n\r\n\t\t\t\t\t\t\tnextX = 0;\r\n\t\t\t\t\t\t\tnextY = 0;\r\n\r\n\t\t\t\t\t\t\trow = 0;\r\n\t\t\t\t\t\t\tcolumn = 0;\r\n\r\n\t\t\t\t\t\t\tcolumnWidth = this.getColumnWidth(childrenCopy, columnCount, maxCellWidth);\r\n\t\t\t\t\t\t\trowHeight = [];\r\n\r\n\t\t\t\t\t\t\ti = -1;\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (column >= columnCount) {\r\n\t\t\t\t\t\t\tcolumn = 0;\r\n\t\t\t\t\t\t\tnextY += rowHeight[row];\r\n\t\t\t\t\t\t\trow++;\r\n\t\t\t\t\t\t\tnextX = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.layout !== \"none\") {\r\n\t\t\t\t\tchild.moveTo({ x: x, y: y }); // must use moveTo, otherwise x/y set in percent won't work\r\n\r\n\t\t\t\t\tchildLeft = x + child.maxLeft - childMarginLeft;\r\n\t\t\t\t\tchildRight = x + child.maxRight + childMarginRight;\r\n\t\t\t\t\tchildTop = y + child.maxTop - childMarginTop;\r\n\t\t\t\t\tchildBottom = y + child.maxBottom + childMarginBottom;\r\n\r\n\t\t\t\t\tif (childRight > right || !$type.isNumber(right)) {\r\n\t\t\t\t\t\tright = childRight;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (childLeft < left || !$type.isNumber(left)) {\r\n\t\t\t\t\t\tleft = childLeft;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (childTop < top || !$type.isNumber(top)) {\r\n\t\t\t\t\t\ttop = childTop;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (childBottom > bottom || !$type.isNumber(bottom)) {\r\n\t\t\t\t\t\tbottom = childBottom;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (childRight > contentRight || !$type.isNumber(contentRight)) {\r\n\t\t\t\t\t\tcontentRight = childRight;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (childLeft < contentLeft || !$type.isNumber(contentLeft)) {\r\n\t\t\t\t\t\tcontentLeft = childLeft;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (childTop < contentTop || !$type.isNumber(contentTop)) {\r\n\t\t\t\t\t\tcontentTop = childTop;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (childBottom > contentBottom || !$type.isNumber(contentBottom)) {\r\n\t\t\t\t\t\tcontentBottom = contentBottom;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tchild.validatePosition();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.layout == \"none\") {\r\n\t\t\tlet noneBBox = this.bbox;\r\n\t\t\tleft = noneBBox.x;\r\n\t\t\tright = noneBBox.x + noneBBox.width;\r\n\t\t\ttop = noneBBox.y;\r\n\t\t\tbottom = noneBBox.y + noneBBox.height;\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(left)) {\r\n\t\t\tleft = 0;\r\n\t\t\tcontentLeft = 0;\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(right)) {\r\n\t\t\tright = this._availableWidth;\r\n\t\t\tcontentRight = right;\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(top)) {\r\n\t\t\ttop = 0;\r\n\t\t\tcontentTop = 0;\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(bottom)) {\r\n\t\t\tbottom = this._availableHeight;\r\n\t\t\tcontentBottom = bottom;\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(contentTop)) {\r\n\t\t\tcontentTop = 0;\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(contentBottom)) {\r\n\t\t\tcontentBottom = contentTop;\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(contentLeft)) {\r\n\t\t\tcontentLeft = 0;\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(contentRight)) {\r\n\t\t\tcontentRight = contentLeft;\r\n\t\t}\r\n\r\n\t\tmeasuredWidth = right - left;\r\n\t\tmeasuredHeight = bottom - top;\r\n\r\n\t\tif ($type.isNumber(this.relativeWidth)) {\r\n\t\t\tmeasuredWidth = maxWidth - paddingLeft - paddingRight;\r\n\t\t\tleft = 0;\r\n\t\t\tright = measuredWidth;\r\n\t\t}\r\n\r\n\t\tif ($type.isNumber(this.relativeHeight)) {\r\n\t\t\tmeasuredHeight = maxHeight - paddingTop - paddingBottom;\r\n\t\t\ttop = 0;\r\n\t\t\tbottom = measuredHeight;\r\n\t\t}\r\n\r\n\t\tif ($type.isNumber(this._pixelWidth)) {\r\n\t\t\tleft = 0;\r\n\t\t\tmeasuredWidth = this._pixelWidth - paddingLeft - paddingRight;\r\n\t\t}\r\n\r\n\t\tif ($type.isNumber(minWidth) && measuredWidth < minWidth) {\r\n\t\t\tleft = 0;\r\n\t\t\tmeasuredWidth = this.minWidth - paddingLeft - paddingRight;\r\n\t\t}\r\n\r\n\t\tif ($type.isNumber(this._pixelHeight)) {\r\n\t\t\ttop = 0;\r\n\t\t\tmeasuredHeight = this._pixelHeight - paddingTop - paddingBottom;\r\n\t\t}\r\n\r\n\t\tif ($type.isNumber(minHeight) && measuredHeight < minHeight) {\r\n\t\t\ttop = 0;\r\n\t\t\tmeasuredHeight = minHeight - paddingTop - paddingBottom;\r\n\t\t}\r\n\r\n\t\tlet measuredContentWidth = contentRight - contentLeft;\r\n\t\tlet measuredContentHeight = contentBottom - contentTop;\r\n\r\n\t\t/// handle content alignment\r\n\t\tif (this.layout != \"none\" && (this.contentAlign || this.contentValign) && children.length > 0) {\r\n\t\t\tlet dx: $type.Optional<number>;\r\n\t\t\tlet dy: $type.Optional<number>;\r\n\r\n\t\t\tlet mwa = measuredWidth;\r\n\t\t\tlet mha = measuredHeight;\r\n\t\t\tif (mwa < measuredContentWidth) {\r\n\t\t\t\tmwa = measuredContentWidth;\r\n\t\t\t}\r\n\r\n\t\t\tif (mha < measuredContentHeight) {\r\n\t\t\t\tmha = measuredContentHeight;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.contentAlign == \"center\") {\r\n\t\t\t\tdx = (mwa - measuredContentWidth) / 2;\r\n\t\t\t}\r\n\t\t\tif (this.contentAlign == \"right\") {\r\n\t\t\t\tdx = mwa - measuredContentWidth;\r\n\t\t\t}\r\n\t\t\tif (this.contentValign == \"middle\") {\r\n\t\t\t\tdy = (mha - measuredContentHeight) / 2;\r\n\t\t\t}\r\n\t\t\tif (this.contentValign == \"bottom\") {\r\n\t\t\t\tdy = mha - measuredContentHeight;\r\n\t\t\t}\r\n\r\n\t\t\tif ($type.isNumber(dx)) {\r\n\t\t\t\t$iter.each(children.iterator(), (child) => {\r\n\t\t\t\t\tlet childLeft: number = child.maxLeft;\r\n\r\n\t\t\t\t\tlet ddx: number = dx;\r\n\r\n\t\t\t\t\tif (this.layout == \"horizontal\") {\r\n\t\t\t\t\t\tchild.x = child.pixelX + ddx;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// individual grid elements can not be aligned vertically, that's why it's different from horizontal\r\n\t\t\t\t\tif (this.layout == \"grid\") {\r\n\t\t\t\t\t\tchild.x = child.pixelX + ddx;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.layout == \"vertical\") {\r\n\t\t\t\t\t\tddx += child.pixelMarginLeft;\r\n\t\t\t\t\t\tif (child.align == \"none\") {\r\n\t\t\t\t\t\t\tchild.x = ddx - childLeft;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this.layout == \"absolute\") {\r\n\t\t\t\t\t\tddx += child.pixelMarginLeft;\r\n\t\t\t\t\t\tif (child.align == \"none\") {\r\n\t\t\t\t\t\t\tchild.x = ddx - childLeft;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif ($type.isNumber(dy)) {\r\n\t\t\t\t$iter.each(children.iterator(), (child) => {\r\n\t\t\t\t\tlet childTop: number = child.maxTop;\r\n\r\n\t\t\t\t\tlet ddy: number = dy;\r\n\r\n\t\t\t\t\tif (this.layout == \"horizontal\") {\r\n\t\t\t\t\t\tddy += child.pixelMarginTop;\r\n\t\t\t\t\t\tif (child.valign == \"none\") {\r\n\t\t\t\t\t\t\tchild.y = ddy - childTop;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// individual grid elements can not be aligned vertically, that's why it's different from horizontal\r\n\t\t\t\t\tif (this.layout == \"grid\") {\r\n\t\t\t\t\t\tddy += child.pixelMarginTop;\r\n\t\t\t\t\t\tchild.y = ddy - childTop;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.layout == \"vertical\") {\r\n\t\t\t\t\t\tchild.y = child.pixelY + ddy;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this.layout == \"absolute\") {\r\n\t\t\t\t\t\tddy += child.pixelMarginTop;\r\n\r\n\t\t\t\t\t\tif (child.valign == \"none\") {\r\n\t\t\t\t\t\t\tchild.y = ddy - childTop;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet oldBBox = this.bbox;\r\n\r\n\r\n\t\t// this will mess up maxw/maxh set by container layout, we need a separate min/maxwidth for users\r\n\t\t// this prevents invalidating layout in such cases as scrolling category axis, when labels go outside bounds and results transformed event\r\n\t\t// todo: need to check if this doesn't cause other problems.\r\n\t\t//if (this.maxWidth > 0) {\r\n\t\t//measuredWidth = $math.min(measuredWidth, this.maxWidth);\r\n\t\t//measuredWidth = $math.max(measuredWidth, this.minWidth);\r\n\t\t//}\r\n\r\n\t\t//if (this.maxHeight > 0) {\r\n\t\t//measuredHeight = $math.min(measuredHeight, this.maxHeight);\r\n\t\t//measuredHeight = $math.max(measuredHeight, this.minHeight);\r\n\t\t//}\r\n\r\n\t\tmeasuredWidth = $math.max(measuredWidth, minWidth);\r\n\t\tmeasuredHeight = $math.max(measuredHeight, minHeight);\r\n\r\n\t\tthis.contentWidth = measuredWidth;\r\n\t\tthis.contentHeight = measuredHeight;\r\n\t\t// new\r\n\t\tmeasuredWidth = $math.min(measuredWidth, maxWidth);\r\n\t\tmeasuredHeight = $math.min(measuredHeight, maxHeight);\r\n\r\n\t\tthis._bbox = { x: left, y: top, width: measuredWidth, height: measuredHeight };\r\n\r\n\t\tlet prevLeft = this.maxLeft;\r\n\t\tlet prevTop = this.maxTop;\r\n\t\tlet prevBotttom = this.maxBottom;\r\n\t\tlet prevRight = this.maxRight;\r\n\r\n\t\tthis.measure();\r\n\r\n\t\tif (prevLeft != this.maxLeft || prevRight != this.maxRight || prevTop != this.maxTop || prevBotttom != this.maxBottom) {\r\n\t\t\tif (this.events.isEnabled(\"transformed\")) {\r\n\t\t\t\tlet event: AMEvent<this, IContainerEvents>[\"transformed\"] = {\r\n\t\t\t\t\ttype: \"transformed\",\r\n\t\t\t\t\ttarget: this\r\n\t\t\t\t};\r\n\t\t\t\tif (oldBBox) {\r\n\t\t\t\t\tevent.dummyData = oldBBox.width + \" \" + measuredWidth + \"  \" + oldBBox.height + \" \" + measuredHeight;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.events.dispatchImmediately(\"transformed\", event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.dispatchImmediately(\"layoutvalidated\");\r\n\t}\r\n\r\n\t/**\r\n\t * Positions element according its center settings.\r\n\t *\r\n\t * @todo Description (review)\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic updateCenter() {\r\n\t\tsuper.updateCenter();\r\n\t\tthis.updateBackground();\r\n\t}\r\n\r\n\t/**\r\n\t * Update the background to fit into specific dimensions.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Make it protected?\r\n\t */\r\n\tpublic updateBackground(): void {\r\n\t\tlet background: Sprite = this._background; // accessing protected, as getter creates instance if it doesn't exist\r\n\r\n\t\tif (background) {\r\n\t\t\tbackground.x = this.maxLeft;\r\n\t\t\tbackground.y = this.maxTop;\r\n\t\t\tbackground.width = this.maxRight - this.maxLeft;\r\n\t\t\tbackground.height = this.maxBottom - this.maxTop;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns widths of all columns in a horizontal Container layout.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param columnCount   Number of columns\r\n\t * @param maxCellWidth  Maximum width of one grid cell\r\n\t * @return An array of column widths\r\n\t */\r\n\tpublic getColumnWidth(children: Sprite[], columnCount: number, maxCellWidth: number): number[] {\r\n\t\tlet columnWidth: number[] = [];\r\n\t\tlet column: number = 0;\r\n\r\n\t\t$array.each(children, (child) => {\r\n\t\t\tif (child.isMeasured && !child.disabled && !child.__disabled) {\r\n\t\t\t\tif (this.fixedWidthGrid) {\r\n\t\t\t\t\tcolumnWidth[column] = maxCellWidth;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tcolumnWidth[column] = $math.max(columnWidth[column], child.measuredWidth + child.pixelMarginRight + child.pixelMarginLeft);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcolumn++;\r\n\r\n\t\t\t\tif (column == columnCount) {\r\n\t\t\t\t\tcolumn = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn columnWidth;\r\n\t}\r\n\r\n\t/**\r\n\t * Container layout.\r\n\t *\r\n\t * Options: \"absolute\" (default), \"vertical\", \"horizontal\", \"grid\", \"none\". \"none\" is quite the same as \"absolute\" - the objects will\r\n\t * be positioned at their x, y coordinates, the difference is that with \"absolute\" you can still use align/valign for children and with \"none\" you can not.\r\n\t * Use \"none\" as much as you can as it's most cpu-saving layout.\r\n\t *\r\n\t * @default \"absolute\"\r\n\t * @param value Layout\r\n\t */\r\n\tpublic set layout(value: ContainerLayout) {\r\n\t\tif (this.setPropertyValue(\"layout\", value)) {\r\n\t\t\tthis.invalidateLayout();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Layout\r\n\t */\r\n\tpublic get layout(): ContainerLayout {\r\n\t\treturn this.getPropertyValue(\"layout\");\r\n\t}\r\n\r\n\t/**\r\n\t * Vertical alignment of the elements for the vertical Container.\r\n\t *\r\n\t * This is used when Container is larger than the height of all its children.\r\n\t *\r\n\t * @param value vertical alignment\r\n\t */\r\n\tpublic set contentValign(value: VerticalAlign) {\r\n\t\tthis.setPropertyValue(\"contentValign\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Vertical alignment\r\n\t */\r\n\tpublic get contentValign(): VerticalAlign {\r\n\t\treturn this.getPropertyValue(\"contentValign\");\r\n\t}\r\n\r\n\t/**\r\n\t * Horizontal alignment of the elements for the horizontal Container.\r\n\t *\r\n\t * This is used when Container is larger than the height of all its children.\r\n\t *\r\n\t * @param value  Horizontal alignment\r\n\t */\r\n\tpublic set contentAlign(value: Align) {\r\n\t\tthis.setPropertyValue(\"contentAlign\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Horizontal alignment\r\n\t */\r\n\tpublic get contentAlign(): Align {\r\n\t\treturn this.getPropertyValue(\"contentAlign\");\r\n\t}\r\n\r\n\t/**\r\n\t * Controls if the grid of the Container should use fixed width. Fixed width\r\n\t * grid will divide available space to all its columns/rows equally, without\r\n\t * adapting to actual child sizes or size requirements.\r\n\t *\r\n\t * @default false\r\n\t * @param value  Should use fixed width grid?\r\n\t */\r\n\tpublic set fixedWidthGrid(value: boolean) {\r\n\t\tthis.setPropertyValue(\"fixedWidthGrid\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Should use fixed width grid?\r\n\t */\r\n\tpublic get fixedWidthGrid(): boolean {\r\n\t\treturn this.getPropertyValue(\"fixedWidthGrid\");\r\n\t}\r\n\r\n\t/**\r\n\t * Maximum number of columns (when using `\"grid\"` layout).\r\n\t *\r\n\t * @param value  Should use fixed width grid?\r\n\t */\r\n\tpublic set maxColumns(value: Optional<number>) {\r\n\t\tthis.setPropertyValue(\"maxColumns\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Should use fixed width grid?\r\n\t */\r\n\tpublic get maxColumns(): Optional<number> {\r\n\t\treturn this.getPropertyValue(\"maxColumns\");\r\n\t}\r\n\r\n\t/**\r\n\t * If set to `true`, the children of the container will be drawn in reverse\r\n\t * order.\r\n\t *\r\n\t * @default false\r\n\t * @param value  Reverse children?\r\n\t */\r\n\tpublic set reverseOrder(value: Optional<boolean>) {\r\n\t\tthis.setPropertyValue(\"reverseOrder\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Reverse children?\r\n\t */\r\n\tpublic get reverseOrder(): Optional<boolean> {\r\n\t\treturn this.getPropertyValue(\"reverseOrder\");\r\n\t}\r\n\r\n\t/**\r\n\t * Specifies if, when state is applied on this container, the same state\r\n\t * should be applied to container's children as well as `background`.\r\n\t *\r\n\t * @default false\r\n\t * @param value  Set state on children\r\n\t */\r\n\tpublic set setStateOnChildren(value: boolean) {\r\n\t\tthis.setPropertyValue(\"setStateOnChildren\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Set state on children\r\n\t */\r\n\tpublic get setStateOnChildren(): boolean {\r\n\t\treturn this.getPropertyValue(\"setStateOnChildren\");\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if point is within bounds of a container.\r\n\t *\r\n\t * @param point  A coordinate to check\r\n\t * @return `true` if it fits within container\r\n\t */\r\n\tpublic fitsToBounds(point: IPoint): boolean {\r\n\t\tlet x = point.x;\r\n\t\tlet y = point.y;\r\n\t\tlet deviation = 0.5; // sometimes coordinates are rounded to numbers like .999 so we add deviation here\r\n\t\tif (x >= -deviation && x <= this.pixelWidth + deviation && y >= -deviation && y <= this.pixelHeight + deviation) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all properties from different Container, including background\r\n\t * clone.\r\n\t *\r\n\t * @param source  Source Container to copy from\r\n\t */\r\n\tpublic copyFrom(source: this) {\r\n\t\tsuper.copyFrom(source);\r\n\t\tthis.layout = source.layout;\r\n\t\tthis.setStateOnChildren = source.setStateOnChildren;\r\n\r\n\t\tif (source._background) {\r\n\t\t\tthis.background = source._background.clone();\r\n\t\t\tthis.background.copyFrom(source._background); // won't work without this\r\n\t\t}\r\n\r\n\t\t$iter.each(source.children.iterator(), (child) => {\r\n\t\t\tif (child.shouldClone) {\r\n\t\t\t\tlet clonedChild: Sprite = child.clone();\r\n\t\t\t\tclonedChild.parent = this;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Preloader]] instance to be used when Container is busy.\r\n\t *\r\n\t * @param preloader  Preloader instance\r\n\t */\r\n\tpublic set preloader(preloader: $type.Optional<Preloader>) {\r\n\t\tif (this._preloader) {\r\n\t\t\tthis.removeDispose(this._preloader);\r\n\t\t}\r\n\t\tthis._preloader = preloader;\r\n\t\tif (preloader) {\r\n\t\t\tpreloader.parent = this.tooltipContainer;\r\n\t\t\tthis._disposers.push(preloader);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Preloader instance\r\n\t */\r\n\tpublic get preloader(): $type.Optional<Preloader> {\r\n\t\tconst preloader = this._preloader;\r\n\r\n\t\tif (preloader) {\r\n\t\t\treturn preloader;\r\n\t\t}\r\n\t\telse if (this.parent) {\r\n\t\t\treturn this.parent.preloader;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets [[Paper]] instance to use to draw elements.\r\n\t * @ignore\r\n\t * @param paper Paper\r\n\t * @return true if paper was changed, false, if it's the same\r\n\t */\r\n\tpublic setPaper(paper: Paper): boolean {\r\n\t\tlet changed = super.setPaper(paper);\r\n\r\n\t\tif (changed) {\r\n\t\t\tif (this._background) {\r\n\t\t\t\tthis._background.paper = paper;\r\n\t\t\t\tthis._background.topParent = this.topParent;\r\n\t\t\t}\r\n\t\t\tthis.children.each((child) => {\r\n\t\t\t\tchild.setPaper(paper);\r\n\t\t\t\tchild.topParent = this.topParent;\r\n\t\t\t})\r\n\t\t}\r\n\t\treturn changed;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes Container from the system-wide list of invalid Containers.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected removeFromInvalids() {\r\n\t\tsuper.removeFromInvalids();\r\n\t\tregistry.removeFromInvalidLayouts(this);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a [[DataItem]] to be used as data for the Container.\r\n\t *\r\n\t * @todo Description\r\n\t * @param dataItem DataItem\r\n\t */\r\n\tprotected setDataItem(dataItem: DataItem) {\r\n\t\t// this place is potentially dangerous, as if we set datItem for some dummy container, all children dataItems will be overriden\r\n\t\t// the main reason for doing this is that we need a setDataItem code to be called for each sprite, otherwise property fields won't be\r\n\t\t// applied. Also, getting dataItem from parent all the time is more expensive than saving value.\r\n\t\tif (this._dataItem != dataItem) {\r\n\t\t\t$iter.each(this.children.iterator(), (child) => {\r\n\t\t\t\tchild.dataItem = dataItem;\r\n\t\t\t});\r\n\r\n\t\t\tif (this._background) {\r\n\t\t\t\tthis._background.dataItem = dataItem;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsuper.setDataItem(dataItem);\r\n\t}\r\n\r\n\t/**\r\n\t * Measures the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic measureElement(): void {\r\n\t\tif (this.disabled || this.isTemplate || this.layout == \"none\" || this.__disabled) {\r\n\t\t\t// void\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.validateLayout();\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Font family to be used for the text.\r\n\t *\r\n\t * Parts of the text may override this setting using in-line formatting.\r\n\t *\r\n\t * @param value Font family value\r\n\t */\r\n\tpublic set fontFamily(value: string) {\r\n\t\tif (this.setPropertyValue(\"fontFamily\", value, true)) {\r\n\t\t\tthis.setSVGAttribute({ \"font-family\": value });\r\n\t\t\tthis.invalidateLabels();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Font family\r\n\t */\r\n\tpublic get fontFamily(): string {\r\n\t\treturn this.getPropertyValue(\"fontFamily\");\r\n\t}\r\n\r\n\t/**\r\n\t * Font size to be used for the text. The size can either be numeric, in\r\n\t * pixels, or other measurements.\r\n\t *\r\n\t * Parts of the text may override this setting using in-line formatting.\r\n\t *\r\n\t * @param value Font size value\r\n\t */\r\n\tpublic set fontSize(value: any) {\r\n\t\tif (this.setPropertyValue(\"fontSize\", value, true)) {\r\n\t\t\tthis.setSVGAttribute({ \"font-size\": value });\r\n\t\t\tthis.invalidateLabels();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Font size\r\n\t */\r\n\tpublic get fontSize(): any {\r\n\t\treturn this.getPropertyValue(\"fontSize\");\r\n\t}\r\n\r\n\t/**\r\n\t * When fontSize of fontFamily changes we need to hard-invalidate all Labels of this container to position them properly.\r\n\t */\r\n\tpublic invalidateLabels() {\r\n\t\tthis.children.each((child) => {\r\n\t\t\t// can't import Label because of Circular dependencies\r\n\t\t\tif ((<any>child)[\"hardInvalidate\"]) {\r\n\t\t\t\t(<any>child)[\"hardInvalidate\"]();\r\n\t\t\t\t// this fixes firefox and viewport issue\r\n\t\t\t\tchild.events.once(\"validated\", (<any>child).handleValidate, child, false);\r\n\t\t\t}\r\n\t\t\telse if (child instanceof Container) {\r\n\t\t\t\tchild.invalidateLabels();\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * Font weight to use for text.\r\n\t *\r\n\t * Parts of the text may override this setting using in-line formatting.\r\n\t *\r\n\t * @param value Font weight\r\n\t */\r\n\tpublic set fontWeight(value: FontWeight) {\r\n\t\tthis.setPropertyValue(\"fontWeight\", value);\r\n\t\tthis.setSVGAttribute({ \"font-weight\": value });\r\n\t}\r\n\r\n\t/**\r\n\t * @return Font weight\r\n\t */\r\n\tpublic get fontWeight(): FontWeight {\r\n\t\treturn this.getPropertyValue(\"fontWeight\");\r\n\t}\r\n\r\n\t/**\r\n\t * A text decoration to use for text.\r\n\t *\r\n\t * Parts of the text may override this setting using in-line formatting.\r\n\t *\r\n\t * @param value  Decoration\r\n\t */\r\n\tpublic set textDecoration(value: TextDecoration) {\r\n\t\tthis.setPropertyValue(\"textDecoration\", value);\r\n\t\tthis.setSVGAttribute({ \"text-decoration\": value });\r\n\t}\r\n\r\n\t/**\r\n\t * @return Decoration\r\n\t */\r\n\tpublic get textDecoration(): TextDecoration {\r\n\t\treturn this.getPropertyValue(\"textDecoration\");\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes (destroys) the element and all its children.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tif (this._background) {\r\n\t\t\tthis._background.dispose();\r\n\t\t}\r\n\t\tthis._shouldBeReady = [];\r\n\t\tthis.disposeChildren();\r\n\t\tsuper.dispose();\r\n\t}\r\n\r\n\t/**\r\n\t * Applies a [[SpriteState]] on this element.\r\n\t *\r\n\t * The first parameter can either be a name of the state or a [[SpriteState]]\r\n\t * instance.\r\n\t *\r\n\t * When run, this method will apply SVG properties defined in a\r\n\t * [[SpriteState]], but only those that are relevant to this particular\r\n\t * element, that is are listed in its respective `properties` array.\r\n\t *\r\n\t * @see {@link SpriteState}\r\n\t * @param value               A state - name key or instance\r\n\t * @param transitionDuration  Duration of the transition between current and new state\r\n\t * @param easing              An easing function\r\n\t */\r\n\tpublic setState(value: string | SpriteState<this[\"_properties\"], this[\"_adapter\"]>, transitionDuration?: number, easing?: (value: number) => number): $type.Optional<Animation> {\r\n\r\n\t\tlet stateName = value;\r\n\t\tif (value instanceof SpriteState) {\r\n\t\t\tstateName = value.name;\r\n\t\t}\r\n\r\n\t\tif (this.setStateOnChildren) {\r\n\t\t\t$iter.each(this.children.iterator(), (child) => {\r\n\t\t\t\tchild.setState(stateName, transitionDuration, easing);\r\n\r\n\t\t\t\t// not good to set it in child setState\r\n\t\t\t\tif (stateName != \"active\") {\r\n\t\t\t\t\tchild.isActive = false;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\tif (this._background) {\r\n\t\t\tthis._background.setState(stateName);\r\n\t\t}\r\n\r\n\t\tif (this.setStateOnSprites.length) {\r\n\t\t\t$array.each(this.setStateOnSprites, (item) => {\r\n\t\t\t\titem.setState(stateName, transitionDuration, easing);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn super.setState(value, transitionDuration, easing);\r\n\t}\r\n\r\n\t// otherwise isActive won't work properly with background\r\n\tprotected setActive(value: boolean) {\r\n\t\tsuper.setActive(value);\r\n\t\tif (this._background) {\r\n\t\t\tthis._background.isActive = value;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Dispatches ready event. Dispatches when all children are ready.\r\n\t */\r\n\tpublic dispatchReady() {\r\n\t\tif (!this.isReady() && !this.isDisposed()) {\r\n\t\t\tlet allReady = true;\r\n\r\n\t\t\t$iter.eachContinue(this.children.iterator(), (sprite) => {\r\n\t\t\t\tif (!sprite.__disabled && !sprite.disabled && !sprite.isReady()) {\r\n\t\t\t\t\tallReady = false;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$array.eachContinue(this._shouldBeReady, (sprite) => {\r\n\t\t\t\tif (!sprite.__disabled && !sprite.disabled && !sprite.isReady()) {\r\n\t\t\t\t\tallReady = false;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tif (allReady) {\r\n\t\t\t\tsuper.dispatchReady();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tregistry.events.once(\"exitframe\", () => {\r\n\t\t\t\t\tthis.dispatchReady();\r\n\t\t\t\t\tsystem.requestFrame();\r\n\t\t\t\t}, undefined, false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Called during the System.update method\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic _systemUpdate(skippedSprites: Array<Sprite>): void {\r\n\t\tthis.children.each((child) => {\r\n\t\t\tif (child.invalid) {\r\n\t\t\t\tif (!child._systemCheckIfValidate()) {\r\n\t\t\t\t\tskippedSprites.push(child);\r\n\t\t\t\t}\r\n\t\t\t\telse if (child.dataItem && child.dataItem.component && child.dataItem.component.dataInvalid) {\r\n\t\t\t\t\tskippedSprites.push(child);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tchild.validate();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsuper._systemUpdate(skippedSprites);\r\n\t}\r\n\r\n\t/**\r\n\t * Called during the System.validatePositions method\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic _systemValidatePositions() {\r\n\t\tthis.children.each((sprite) => {\r\n\t\t\tif (sprite.positionInvalid) {\r\n\t\t\t\tsprite.validatePosition();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsuper._systemValidatePositions();\r\n\t}\r\n\r\n\t/**\r\n\t * Called during the System.validateLayouts method\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic _systemValidateLayouts() {\r\n\t\tif (this.layoutInvalid && !this.isDisposed()) {\r\n\t\t\tthis.validateLayout();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * If set to `true` the chart's regular touch functionality will be suspended\r\n\t * so that the whole page it is located in remains scrollable, even when\r\n\t * swiping over the chart's body.\r\n\t *\r\n\t * User will need to tap the chart in order to activate its regular touch\r\n\t * functionality.\r\n\t *\r\n\t * The chart will remain \"active\" as long as user keeps interacting with the\r\n\t * chart. After `tapTimeout` milliseconds the chart will return to its\r\n\t * \"protected\" mode.\r\n\t *\r\n\t * @default false\r\n\t * @since 4.4.0\r\n\t * @param  value  Enable touch protection?\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/touch/} For more information.\r\n\t */\r\n\tpublic set tapToActivate(value: boolean) {\r\n\t\tif (this._tapToActivate != value) {\r\n\t\t\tthis.setTapToActivate(value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Enable touch protection?\r\n\t */\r\n\tpublic get tapToActivate(): boolean {\r\n\t\treturn this._tapToActivate;\r\n\t}\r\n\r\n\tprotected setTapToActivate(value: boolean): void {\r\n\t\tthis._tapToActivate = value;\r\n\t\tthis.interactions.isTouchProtected = value;\r\n\t\t// setEventDisposer will also remove listeners if value == false\r\n\t\tif (value) {\r\n\t\t\tthis.interactions.setEventDisposer(\"container-tapToActivate\", value, () => new MultiDisposer([\r\n\t\t\t\tthis.events.on(\"hit\", this.handleTapToActivate, this, false),\r\n\t\t\t\tthis.events.on(\"down\", this.initTapTimeout, this, false),\r\n\t\t\t\tthis.events.on(\"track\", this.initTapTimeout, this, false),\r\n\t\t\t\t//this.events.on(\"drag\", this.initTapTimeout, this, false),\r\n\t\t\t\tgetInteraction().body.events.on(\"down\", (ev) => {\r\n\t\t\t\t\tif (!getInteraction().isLocalElement(ev.pointer, this.paper.svg, this.uid)) {\r\n\t\t\t\t\t\tthis.handleTapToActivateDeactivation();\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this, false)\r\n\t\t\t]));\r\n\t\t}\r\n\r\n\t\tgetInteraction()\r\n\t}\r\n\r\n\t/**\r\n\t * @todo Ignore on non-touch events\r\n\t */\r\n\tprotected handleTapToActivate(): void {\r\n\t\tthis.interactions.isTouchProtected = false;\r\n\t\tthis.initTapTimeout();\r\n\t}\r\n\r\n\tprotected handleTapToActivateDeactivation(): void {\r\n\t\tthis.interactions.isTouchProtected = true;\r\n\t}\r\n\r\n\tprotected initTapTimeout(): void {\r\n\t\tif (this._tapToActivateTimeout) {\r\n\t\t\tthis._tapToActivateTimeout.dispose();\r\n\t\t}\r\n\t\tif (this.tapToActivate && !this.interactions.isTouchProtected && this.tapTimeout) {\r\n\t\t\tthis._tapToActivateTimeout = this.setTimeout(() => {\r\n\t\t\t\tthis.handleTapToActivateDeactivation()\r\n\t\t\t}, this.tapTimeout);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Moves the whole chart to other HTML container.\r\n\t *\r\n\t * `htmlElement` can either be a reference to a DOM element, or an id of\r\n\t * such element.\r\n\t *\r\n\t * @since 4.9.24\r\n\t * @param  htmlElement  Target element\r\n\t */\r\n\tpublic moveHtmlContainer(htmlElement: string | HTMLElement): void {\r\n\t\tlet newContainer = $dom.getElement(htmlElement);\r\n\t\tif (newContainer) {\r\n\t\t\tthis.htmlContainer = newContainer;\r\n\t\t\tconst svgDiv = this.svgContainer;\r\n\t\t\tsvgDiv.htmlElement = newContainer;\r\n\t\t\tsvgDiv.htmlElement.appendChild(svgDiv.SVGContainer);\r\n\t\t\tsvgDiv.initSensor();\r\n\t\t\tsvgDiv.measure();\r\n\t\t}\r\n\t\telse if($type.isString(htmlElement) && htmlElement != \"\") {\r\n\t\t\tsystem.log(\"html container '\" + htmlElement + \"' not found\");\r\n\t\t\t//throw new Error(\"html container not found\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * @return Has license?\r\n\t */\r\n\tpublic hasLicense(): boolean {\r\n\t\tif (options.commercialLicense) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tfor (let i = 0; i < options.licenses.length; i++) {\r\n\t\t\tif (options.licenses[i].match(/^CH.{5,}/i)) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Container\"] = Container;\r\n","/**\r\n * This is the main class that encapsulates every object on the chart.\r\n *\r\n * If it's an element that is to be displayed on the screen at some point, its\r\n * class must extend [[Sprite]] class.\r\n */\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { SpriteState } from \"./SpriteState\";\r\nimport { ISpriteEvents, SpriteEventDispatcher, AMEvent } from \"./SpriteEvents\";\r\nexport { ISpriteEvents, SpriteEventDispatcher, AMEvent };\r\n\r\nimport { BaseObjectEvents } from \"./Base\";\r\nimport { Adapter, globalAdapter } from \"./utils/Adapter\";\r\nimport { ITheme } from \"../themes/ITheme\";\r\nimport { Dictionary, IDictionaryEvents, DictionaryTemplate, DictionaryDisposer } from \"./utils/Dictionary\";\r\nimport { ListTemplate, ListDisposer, List } from \"./utils/List\";\r\nimport { EventDispatcher } from \"./utils/EventDispatcher\";\r\nimport { MultiDisposer, IDisposer, Disposer, MutableValueDisposer } from \"./utils/Disposer\";\r\nimport { Animation, IAnimatable, IAnimationOptions, AnimationDisposer } from \"./utils/Animation\";\r\nimport { Optional } from \"./utils/Type\";\r\nimport { Group } from \"./rendering/Group\";\r\nimport { Paper, getGhostPaper } from \"./rendering/Paper\";\r\nimport { DataItem } from \"./DataItem\";\r\nimport { Container } from \"./Container\";\r\nimport { Pattern } from \"./rendering/fills/Pattern\";\r\nimport { LinearGradient } from \"./rendering/fills/LinearGradient\";\r\nimport { RadialGradient } from \"./rendering/fills/RadialGradient\";\r\nimport { SVGContainer } from \"./rendering/SVGContainer\";\r\nimport { Align } from \"./defs/Align\";\r\nimport { Roles, AriaLive } from \"./defs/Accessibility\";\r\nimport { IPlugin } from \"./utils/Plugin\";\r\nimport { Popup } from \"./elements/Popup\";\r\nimport { Modal } from \"./elements/Modal\";\r\nimport { Color, color, toColor } from \"./utils/Color\";\r\nimport { Ordering } from \"./utils/Order\";\r\n\r\nimport { HorizontalCenter } from \"./defs/HorizontalCenter\";\r\nimport { VerticalCenter } from \"./defs/VerticalCenter\";\r\nimport { VerticalAlign } from \"./defs/VerticalAlign\";\r\nimport { ShapeRendering } from \"./defs/ShapeRendering\";\r\nimport { AMElement } from \"./rendering/AMElement\";\r\nimport { Filter } from \"./rendering/filters/Filter\";\r\n\r\nimport { ColorModifier } from \"./rendering/fills/ColorModifier\";\r\n\r\nimport { getInteraction } from \"./interaction/Interaction\";\r\nimport { InteractionObject } from \"./interaction/InteractionObject\";\r\n\r\nimport { IInertiaOptions, ISwipeOptions, IHitOptions, IHoverOptions, ICursorOptions, IKeyboardOptions, IMouseOptions } from \"./interaction/InteractionOptions\";\r\nimport { IPointer } from \"./interaction/Pointer\";\r\nimport { MouseCursorStyle } from \"./interaction/Mouse\";\r\nimport { InertiaTypes } from \"./interaction/Inertia\";\r\nimport { IStyleProperty } from \"./defs/IStyleProperty\";\r\n\r\nimport { options } from \"./Options\";\r\nimport { registry } from \"./Registry\";\r\nimport { IPoint } from \"./defs/IPoint\";\r\nimport { IRectangle } from \"./defs/IRectangle\";\r\nimport { Tooltip } from \"./elements/Tooltip\";\r\n\r\nimport { NumberFormatter } from \"./formatters/NumberFormatter\";\r\nimport { DateFormatter } from \"./formatters/DateFormatter\";\r\nimport { DurationFormatter } from \"./formatters/DurationFormatter\";\r\nimport { getTextFormatter } from \"./formatters/TextFormatter\";\r\nimport { Language } from \"./utils/Language\";\r\nimport { Export } from \"./export/Export\";\r\nimport { AmChartsLogo } from \"./elements/AmChartsLogo\";\r\n\r\n\r\nimport { ISVGAttribute } from \"./rendering/AMElement\";\r\n\r\nimport * as $utils from \"./utils/Utils\";\r\nimport * as $math from \"./utils/Math\";\r\nimport * as $strings from \"./utils/Strings\";\r\nimport * as $array from \"./utils/Array\";\r\nimport * as $object from \"./utils/Object\";\r\nimport * as $type from \"./utils/Type\";\r\nimport * as $iter from \"./utils/Iterator\";\r\n\r\nimport { system } from \"./System\";\r\n\r\nimport { Percent, percent } from \"./utils/Percent\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[Sprite]]\r\n */\r\nexport interface ISpriteProperties {\r\n\tdisabled?: boolean;\r\n\tx?: number | Percent;\r\n\ty?: number | Percent;\r\n\twidth?: number | Percent;\r\n\theight?: number | Percent;\r\n\tscale?: number;\r\n\trotation?: number;\r\n\tpixelPerfect?: boolean;\r\n\tmarginLeft?: number;\r\n\tmarginRight?: number;\r\n\tmarginTop?: number;\r\n\tmarginBottom?: number;\r\n\tfillOpacity?: number;\r\n\tfill?: Color | LinearGradient | RadialGradient | Pattern;\r\n\topacity?: number;\r\n\tstroke?: Color | LinearGradient | RadialGradient | Pattern;\r\n\tstrokeOpacity?: number;\r\n\tstrokeWidth?: number;\r\n\tstrokeDasharray?: string;\r\n\tstrokeDashoffset?: number;\r\n\tstrokeLinecap?: \"butt\" | \"square\" | \"round\";\r\n\tstrokeLinejoin?: \"miter\" | \"round\" | \"bevel\";\r\n\tshapeRendering?: ShapeRendering;\r\n\tdraggable?: boolean;\r\n\tinert?: boolean;\r\n\tresizable?: boolean;\r\n\tswipeable?: boolean;\r\n\ttrackable?: boolean;\r\n\thoverable?: boolean;\r\n\tclickable?: boolean;\r\n\ttogglable?: boolean;\r\n\twheelable?: boolean;\r\n\tfocusable?: boolean;\r\n\ttabindex?: number;\r\n\tcontextMenuDisabled?: boolean;\r\n\tvisible?: boolean;\r\n\ttooltipText?: string;\r\n\ttooltipHTML?: string;\r\n\ttooltipX?: number | Percent;\r\n\ttooltipY?: number | Percent;\r\n\talwaysShowTooltip?: boolean;\r\n\ttooltipPosition?: \"fixed\" | \"pointer\";\r\n\tshowTooltipOn?: \"hover\" | \"hit\" | \"always\";\r\n\tinteractionsEnabled?: boolean;\r\n\thorizontalCenter?: HorizontalCenter;\r\n\tverticalCenter?: VerticalCenter;\r\n\talign?: Align;\r\n\tvalign?: VerticalAlign;\r\n\tpaddingLeft?: number;\r\n\tpaddingRight?: number;\r\n\tpaddingTop?: number;\r\n\tpaddingBottom?: number;\r\n\tminX?: number;\r\n\tminY?: number;\r\n\tmaxX?: number;\r\n\tmaxY?: number;\r\n\tdx?: number;\r\n\tdy?: number;\r\n\trole?: Roles;\r\n\treaderDescribedBy?: string;\r\n\treaderLabelledBy?: string;\r\n\treaderLive?: AriaLive;\r\n\treaderControls?: string;\r\n\treaderChecked?: boolean;\r\n\treaderHidden?: boolean;\r\n\treaderDescription?: string;\r\n\treaderTitle?: string;\r\n\treaderOrientation?: string;\r\n\treaderValueNow?: string;\r\n\treaderValueText?: string;\r\n\tnonScaling?: boolean;\r\n\tnonScalingStroke?: boolean;\r\n\tzIndex?: number;\r\n\tminWidth?: number;\r\n\tmaxWidth?: number;\r\n\tminHeight?: number;\r\n\tmaxHeight?: number;\r\n\tfillModifier?: ColorModifier;\r\n\tstrokeModifier?: ColorModifier;\r\n\thoverOnFocus?: boolean;\r\n\tpath?: string;\r\n\turlTarget?: string;\r\n\turl?: string;\r\n\thidden?: boolean;\r\n\tshowOnInit?: boolean;\r\n\tid?: string;\r\n\tisActive?: boolean;\r\n\tisHover?: boolean;\r\n\tuserClassName?: string;\r\n}\r\n\r\n/**\r\n * Defines animation options\r\n */\r\nexport interface ISpriteAnimationOptions {\r\n\tfrom?: Percent | Color | number | string;\r\n\tto: Percent | Color | number | string;\r\n\tproperty: any; // todo: this[\"_properties\"] can not be used here, think.\r\n}\r\n\r\n/**\r\n * Defines list ofvisual properties\r\n */\r\nexport const visualProperties: (keyof ISpriteProperties)[] = [\"fill\", \"fillOpacity\", \"stroke\", \"strokeOpacity\", \"strokeWidth\", \"strokeDasharray\", \"strokeDashoffset\", \"strokeLinecap\", \"strokeLinejoin\"]; // do not add opacity here, as it is used for showing/hiding\r\n\r\n/**\r\n * Represents a list of available adapters for [[Sprite]]\r\n */\r\nexport interface ISpriteAdapters extends ISpriteProperties {\r\n\r\n\tpixelHeight: number;\r\n\tpixelWidth: number;\r\n\trelativeHeight: number\r\n\trelativeWidth: number;\r\n\tmeasuredHeight: number;\r\n\tmeasuredWidth: number;\r\n\touterHeight: number;\r\n\touterWidth: number;\r\n\tinnerHeight: number;\r\n\tinnerWidth: number;\r\n\tglobalScale: number;\r\n\tpixelMarginRight: number;\r\n\trelativeMarginRight: number;\r\n\tpixelMarginLeft: number;\r\n\trelativeMarginLeft: number;\r\n\tpixelMarginTop: number;\r\n\trelativeMarginTop: number;\r\n\tpixelMarginBottom: number;\r\n\trelativeMarginBottom: number;\r\n\tpixelX: number;\r\n\trelativeX: number;\r\n\tpixelY: number;\r\n\trelativeY: number;\r\n\tmask: Sprite;\r\n\tpopulateString: string;\r\n\r\n\tinertiaOptions: Dictionary<InertiaTypes, IInertiaOptions>;\r\n\thitOptions: IHitOptions;\r\n\thoverOptions: IHoverOptions;\r\n\tswipeOptions: ISwipeOptions;\r\n\tkeyboardOptions: IKeyboardOptions;\r\n\tmouseOptions: IMouseOptions;\r\n\tcursorOptions: ICursorOptions;\r\n\tcriticalError: Error;\r\n};\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Sprite represents any displayable element.\r\n *\r\n * This is the main class that encapsulates every object on the chart.\r\n *\r\n * If it's an element that is to be displayed on the screen at some point, its\r\n * class must extend [[Sprite]] class.\r\n *\r\n * [[Sprite]] class represents the a hierarchical structure. Every object that\r\n * extends [[Sprite]] can have children, that would inherit their properties,\r\n * such as language, formatters, etc.\r\n *\r\n * @see {@link SpriteState}\r\n * @see {@link ISpriteEvents} for a list of available events\r\n * @see {@link ISpriteAdapters} for a list of available Adapters\r\n *\r\n * @todo Review child elements that need to go into `_disposers`\r\n * @important\r\n */\r\nexport class Sprite extends BaseObjectEvents implements IAnimatable {\r\n\r\n\t/**\r\n\t * Defines property types.\r\n\t */\r\n\tpublic _properties!: ISpriteProperties;\r\n\r\n\t/**\r\n\t * Defines state type.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\t//public _state: SpriteState;\r\n\r\n\t/**\r\n\t * Defines type used in the Sprite.\r\n\t */\r\n\tpublic _adapter!: ISpriteAdapters;\r\n\r\n\t/**\r\n\t * Holds values for Sprite's properties.\r\n\t */\r\n\tpublic properties: this[\"_properties\"] = {};\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: ISpriteEvents;\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic _eventDispatcher: SpriteEventDispatcher<AMEvent<this, this[\"_events\"]>> = new SpriteEventDispatcher(this);\r\n\r\n\t/**\r\n\t * Event dispatcher.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/event-listeners/} for more info about Events\r\n\t */\r\n\tpublic get events(): SpriteEventDispatcher<AMEvent<this, this[\"_events\"]>> {\r\n\t\treturn this._eventDispatcher;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic _adapterO: Adapter<this, this[\"_adapter\"]>;\r\n\r\n\t/**\r\n\t * Holds Adapter.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/adapters/} for more info about Adapters\r\n\t */\r\n\tpublic get adapter(): Adapter<this, this[\"_adapter\"]> {\r\n\t\tif (!this._adapterO) {\r\n\t\t\tthis._adapterO = new Adapter<this, this[\"_adapter\"]>(this);\r\n\t\t}\r\n\t\treturn this._adapterO;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tprivate _bindings: { [key: string]: IDisposer } = {};\r\n\r\n\t/**\r\n\t * Holds indicator if this Sprite is a \"template\" to be used for creating\r\n\t * other Sprites from and should not be treated as full-fledged element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _isTemplate: boolean = false;\r\n\r\n\tprotected _isPath: boolean = false;\r\n\r\n\t/**\r\n\t * Holds collection of Sprite States.\r\n\t */\r\n\tpublic _states: $type.Optional<DictionaryTemplate<string, SpriteState<this[\"_properties\"], this[\"_adapter\"]>>>;\r\n\r\n\t/**\r\n\t * Holds indicator whether this sprite was already initialized.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _inited: boolean = false;\r\n\r\n\t/**\r\n\t * Holds indicator whether this sprite was already initialized and ready.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _ready: boolean = false;\r\n\r\n\t/**\r\n\t * A reference to a Tooltip for this Sprite.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _tooltip: $type.Optional<Tooltip>;\r\n\r\n\t/**\r\n\t * A special data item which tooltip will use when formatting data. In case\r\n\t * it is not set, dataItem will be used.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _tooltipDataItem: $type.Optional<DataItem>;\r\n\r\n\t/**\r\n\t * A reference to another sprite or sprite template from which tooltip should take colors if getFillFromObject or getStrokeFromObject are set to true.\r\n\t * Mostly used when we need to adjust tooltip color for a series, depending on column or bullet color.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _tooltipColorSource: $type.Optional<Sprite>;\r\n\r\n\t/**\r\n\t * If `sprite.hide()` is called and we have \"hidden\" state and\r\n\t * `transitionDuration > 0`, we set `isHiding` flag to `true` in order to\r\n\t * avoid restarting animations in case `hide()` method is called multiple\r\n\t * times.\r\n\t */\r\n\tpublic isHiding: boolean = false;\r\n\r\n\t/**\r\n\t * If `sprite.hide()` is called, we set isHidden to true when sprite is hidden.\r\n\t * This was added becaus hidden state might have visibility set to true and so\r\n\t * there would not be possible to find out if a sprite is technically hidden or not.\r\n\t */\r\n\tprotected _isHidden: boolean = false;\r\n\r\n\t/**\r\n\t * This property indicates if Sprite is currently being revealed from hidden\r\n\t * state. This is used to prevent multiple calls to `sprite.show()` to\r\n\t * restart reveal animation. (if enabled)\r\n\t */\r\n\tpublic isShowing: boolean = false;\r\n\r\n\t/**\r\n\t * Indicates if this element is a standalone instance. A \"standalone\r\n\t * instance\" means this is a autonomous object which maintains its own\r\n\t * set of controls like Preloader, Export, etc.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic isStandaloneInstance: boolean = false;\r\n\r\n\t/**\r\n\t * Indicates if togglable Sprite is currently active (toggled on).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _isActive: boolean = false;\r\n\r\n\t/**\r\n\t * A Sprite element to use as a mask for this Sprite.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _mask = new MutableValueDisposer<Sprite>();\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tprotected _clipPath: Optional<Group>;\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tprotected _clipElement: $type.Optional<AMElement>;\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tprotected _positionPrecision: number = 3;\r\n\r\n\t/**\r\n\t * Holds reference to Sprite's [[InteractionObject]]. Sprite does not\r\n\t * perform any user interactions directly, it happens via [[InteractionObject]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _interaction: $type.Optional<InteractionObject>;\r\n\r\n\t/**\r\n\t * An instance of [[Language]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _language = new MutableValueDisposer<Language>();\r\n\r\n\t/**\r\n\t * An instance of [[NumberFormatter]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _numberFormatter: $type.Optional<NumberFormatter>;\r\n\r\n\t/**\r\n\t * An instance of [[DateFormatter]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _dateFormatter: $type.Optional<DateFormatter>;\r\n\r\n\t/**\r\n\t * An instance of [[DurationFormatter]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _durationFormatter: $type.Optional<DurationFormatter>;\r\n\r\n\t/**\r\n\t * An HTML element to which [[svgContainer]] is added.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _htmlContainer: $type.Optional<HTMLElement>;\r\n\r\n\t/**\r\n\t * An HTML element to which all chart elements are added.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _svgContainer: $type.Optional<SVGContainer>;\r\n\r\n\t/**\r\n\t * A [[Container]] instance to place this element's [[Tooltip]] elements in\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _tooltipContainer: $type.Optional<Container>;\r\n\r\n\r\n\tprotected _urlDisposer: $type.Optional<IDisposer>;\r\n\r\n\t/**\r\n\t * Should this element be measured when measuring its parent container's\r\n\t * dimentions?\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _isMeasured: $type.Optional<boolean>;\r\n\r\n\t/**\r\n\t * Indicates if the chart should follow right-to-left rules.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _rtl: boolean;\r\n\r\n\t/**\r\n\t * Holds [[Export]] object.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _exporting = new MutableValueDisposer<Export>();\r\n\r\n\t/**\r\n\t * Should this Sprite be included when exporting?\r\n\t */\r\n\tprotected _exportable: boolean = true;\r\n\r\n\t/**\r\n\t * A reference to a top-level SVG node for this Sprite element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _element: Optional<AMElement>;\r\n\r\n\t/**\r\n\t * Holds Sprite's main SVG group (`<g>`) element. Other Sprite's elements\r\n\t * are all placed in this group.\r\n\t */\r\n\tpublic group: Group;\r\n\r\n\t/**\r\n\t * A reference to [[Paper]] SVG renderer used to create SVG nodes.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _paper: $type.Optional<Paper>;\r\n\r\n\t/**\r\n\t * Elements's top-level [[Container]].\r\n\t *\r\n\t *\r\n\t * @return Top-level ascendant\r\n\t */\r\n\tprotected _topParent: Optional<Container>;\r\n\r\n\t/**\r\n\t * Data item assigned to the sprite. It might contain information defining\r\n\t * some style properties.\r\n\t */\r\n\tpublic _dataItem: $type.Optional<DataItem>;\r\n\r\n\t/**\r\n\t * Parent container.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _parent: Container;\r\n\r\n\t/**\r\n\t * Sprite's \"virtual\" parent.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _virtualParent: Sprite;\r\n\r\n\t/**\r\n\t * Defines bounding box (square) for this element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _bbox: IRectangle = { x: 0, y: 0, width: 0, height: 0 };\r\n\r\n\t/**\r\n\t * Base tab index for the Sprite. Used for TAB-key selection order.\r\n\t *\r\n\t * Use accessors `tabIndex` to set and retrieve.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _tabindex: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * Should system tooltips be allowed to be displayed if the element has\r\n\t * `readerTitle` set?\r\n\t *\r\n\t * Use accessors `showSystemTooltip` to set and retrieve.\r\n\t *\r\n\t * This is an accessibility feature.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _showSystemTooltip: $type.Optional<boolean>;\r\n\r\n\t/**\r\n\t * List of animations currently playing for this Sprite.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _animations: $type.Optional<Array<Animation>>;\r\n\r\n\t/**\r\n\t * A link to [[Disposer]] for event handler which is attached to hide\r\n\t * animation. In some cases we need to cancel this event. This property is\r\n\t * used to hold the reference to disposer of this event so that we can\r\n\t * cancel it by calling its `dispose()` method.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _showHideDisposer: $type.Optional<IDisposer>;\r\n\r\n\t/**\r\n\t * If element is currently hiding, this property will hold a reference to\r\n\t * [[Animation]] instance, which is handling hiding animation.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _hideAnimation: $type.Optional<Animation>;\r\n\r\n\t/**\r\n\t * List of [[Filter]] items that are currently applied to the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _filters: $type.Optional<List<Filter>>;\r\n\r\n\t/**\r\n\t * A shortcut to the special \"Focus\" filter which is applied when the element\r\n\t * gains focus.\r\n\t *\r\n\t * This is an accessibility feature.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _focusFilter: $type.Optional<Filter>;\r\n\r\n\t/**\r\n\t * Indicates if this element is invalid and should be re-validated (redrawn).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic invalid: boolean = false;\r\n\r\n\t/**\r\n\t * Indicates if this elements position is invalid and should be repositioned\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic positionInvalid: boolean = false;\r\n\r\n\t/**\r\n\t * A collection of key/value pairs that can be used to bind specific Sprite\r\n\t * properties to [[DataItem]].\r\n\t *\r\n\t * For example: `fill` property can be bound to `myCustomColor` field in\r\n\t * DataItem. The Sprite will automatically get the value for `fill` from its\r\n\t * DataItem.\r\n\t *\r\n\t * Can be set for each [[SpriteState]] individually to override default\r\n\t * bindings.\r\n\t *\r\n\t * @see {@link SpriteState}\r\n\t */\r\n\tpublic propertyFields: { [index in keyof this[\"_properties\"]]?: string } = {};\r\n\t//public propertyFields: Dictionary<keyof this[\"_properties\"], string> = new Dictionary<keyof this[\"_properties\"], string>();\r\n\r\n\t/**\r\n\t * Element's relative width.\r\n\t *\r\n\t * Do not set this property directly. Use `width` accessor with [[Percent]]\r\n\t * value instead.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic percentWidth: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * Element's relative height.\r\n\t *\r\n\t * Do not set this property directly. Use `height` accessor with [[Percent]]\r\n\t * value instead.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic percentHeight: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * An SVG group element that is used to put all SVG filters to.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic filterElement: $type.Optional<Group>;\r\n\r\n\t/**\r\n\t * A field in data context of element's `dataItem` that holds config values\r\n\t * for this element.\r\n\t *\r\n\t * This is a very powerful feature, allowing changing virtually any setting,\r\n\t * including those for element's children, for the element via data.\r\n\t *\r\n\t * Example data:\r\n\t *\r\n\t * ```JSON\r\n\t * {\r\n\t *   \"value\": 100,\r\n\t *   \"config\": {\r\n\t *     \"fill\": \"#F00\"\r\n\t *   }\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * If you set element's `configField = \"config\"`, the element for this\r\n\t * specific data point will have a red fill.\r\n\t */\r\n\tpublic configField: $type.Optional<string>;\r\n\r\n\t/**\r\n\t * Reference to element's `<title>` element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _titleElement: Optional<AMElement>;\r\n\r\n\t/**\r\n\t * Reference to element's `<description>` element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _descriptionElement: Optional<AMElement>;\r\n\r\n\t/**\r\n\t * Specifies if property changes on this object should be propagated to the\r\n\t * objects cloned from this object.\r\n\t *\r\n\t * This setting affects property changes *after* cloning, since at the moment\r\n\t * of cloning all of properties from source object are copied to the clone\r\n\t * anyway.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tpublic applyOnClones: boolean = false;\r\n\r\n\t/**\r\n\t * a reference to an object which should be used when populating string. used for tooltip label mostly.\r\n\t * @ignore\r\n\t */\r\n\tpublic populateStringFrom: any;\r\n\r\n\t/**\r\n\t * Internal storage properties.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\r\n\tprotected _measuredWidth: number;\r\n\tprotected _measuredHeight: number;\r\n\r\n\t// unrotated unscaled\r\n\tprotected _measuredWidthSelf: number = 0;\r\n\tprotected _measuredHeightSelf: number = 0;\r\n\r\n\tprotected _prevMeasuredWidth: number;\r\n\tprotected _prevMeasuredHeight: number;\r\n\r\n\tprotected _pixelWidth: $type.Optional<number>;\r\n\tprotected _pixelHeight: $type.Optional<number>;\r\n\r\n\tprotected _relativeWidth: $type.Optional<number>;\r\n\tprotected _relativeHeight: $type.Optional<number>;\r\n\r\n\t// read only, sprite extreme coordinates\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic maxLeft: number = 0;\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic maxRight: number = 0;\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic maxTop: number = 0;\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic maxBottom: number = 0;\r\n\r\n\t// not rotated and not scaled\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic maxLeftSelf: number = 0;\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic maxRightSelf: number = 0;\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic maxTopSelf: number = 0;\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic maxBottomSelf: number = 0;\r\n\r\n\tprotected _isDragged: boolean = false;\r\n\r\n\tprotected _isResized: boolean = false;\r\n\r\n\t/**\r\n\t * @deprecated Moved to [[SpriteProperties]]\r\n\t */\r\n\tprotected _disabled: boolean = false;\r\n\r\n\tprotected _internalDisabled: boolean = false;\r\n\r\n\tprotected _updateDisabled: boolean = false;\r\n\r\n\tprotected _maskRectangle: $type.Optional<IRectangle>;\r\n\r\n\tprotected _internalDefaultsApplied: boolean = false;\r\n\r\n\tprotected _interactionDisposer: $type.Optional<IDisposer>;\r\n\r\n\t/**\r\n\t * You can set bbox from outside if you know what size your element must be (used in radar chart for example)\r\n\t * @ignore\r\n\t */\r\n\tpublic definedBBox: IRectangle;\r\n\r\n\t/**\r\n\t * Time in milliseconds after which rollout event happens when user rolls-out of the sprite. This helps to avoid flickering in some cases.\r\n\t */\r\n\tpublic rollOutDelay: number = 0;\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected _outTimeout: $type.Optional<IDisposer>;\r\n\r\n\t/**\r\n\t * This flag is set to `true` for the initial sprite you create and place\r\n\t * to the div so that we could clear all additional\r\n\t * sprites/containers when this sprite is disposed.\r\n\t *\r\n\t * @ignore\r\n\t */\r\n\tpublic isBaseSprite: boolean = false;\r\n\r\n\t/**\r\n\t * Indicates whether this sprite should be cloned when cloning its parent\r\n\t * container. We set this to `false` in those cases when a sprite is created\r\n\t * by the class, so that when cloning a duplicate sprite would not appear.\r\n\t */\r\n\tpublic shouldClone: boolean = true;\r\n\r\n\t/**\r\n\t * A property which you can use to store any data you want.\r\n\t */\r\n\tpublic dummyData: any;\r\n\r\n\t/**\r\n\t * A reference to a real fill object. Sometimes might be useful to modify\r\n\t * gradient (when fill is color but we have FillModifier).\r\n\t */\r\n\tpublic realFill: Color | Pattern | LinearGradient | RadialGradient;\r\n\r\n\t/**\r\n\t * A reference to a real stroke object. Sometimes might be useful to modify\r\n\t * gradient (when fill is color but we have a FillModifier).\r\n\t */\r\n\tpublic realStroke: Color | Pattern | LinearGradient | RadialGradient;\r\n\r\n\t/**\r\n\t * A reference to amCharts logo element.\r\n\t *\r\n\t * @ignore\r\n\t */\r\n\tpublic logo: AmChartsLogo;\r\n\r\n\t/**\r\n\t * [_baseId description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _baseId: string;\r\n\r\n\t/**\r\n\t * A read-only flag which indicates if a sprite has completed its initial\r\n\t * animation (if `showOnInit = true`).\r\n\t *\r\n\t * In case `showOnInit = false`, `appeared` is set to `true` on init.\r\n\t *\r\n\t * @readonly\r\n\t */\r\n\tpublic appeared: boolean = false;\r\n\r\n\t/**\r\n\t * [ex description]\r\n\t *\r\n\t * @todo Description\r\n\t * @ignore\r\n\t */\r\n\tpublic ex: number = 0;\r\n\r\n\t/**\r\n\t * [ey description]\r\n\t *\r\n\t * @todo Description\r\n\t * @ignore\r\n\t */\r\n\tpublic ey: number = 0;\r\n\r\n\t/**\r\n\t * [_showOnInitDisposer description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _showOnInitDisposer: MultiDisposer;\r\n\r\n\t/**\r\n\t * Holds the list of plugins attached to this Sprite.\r\n\t */\r\n\tprotected _plugins: $type.Optional<List<IPlugin>>;\r\n\r\n\t/**\r\n\t * Indicates if the sprite can be moved around when resizing it with two fingers (will only work if draggable = false)\r\n\t * @ignore\r\n\t */\r\n\tpublic dragWhileResize: boolean = false;\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic vpDisposer: MultiDisposer;\r\n\r\n\tprotected _alwaysShowDisposers: IDisposer[];\r\n\r\n\t/**\r\n\t *  @ignore\r\n\t */\r\n\tpublic measureFailed: boolean = false;\r\n\r\n\t/**\r\n\t * If this flag is set to true, calling show() will not reveal the sprite.\r\n\t *\r\n\t * @ignore\r\n\t */\r\n\tpublic preventShow: boolean = false;\r\n\r\n\t/**\r\n\t * When cloning a sprite, if the template has it's own tooltip assigned, this tooltip is also cloned by default.\r\n\t * This is not good for cpu and sometimes you might only need one single tooltip for all clones. Set this to false in order not to clone tooltip.\r\n\t */\r\n\tpublic cloneTooltip: boolean = true;\r\n\r\n\t/**\r\n\t * Constructor:\r\n\t * * Creates initial node\r\n\t * * Sets default properties\r\n\t * * Creates required default states\r\n\t * * Inits accessibility\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\r\n\t\tthis.className = \"Sprite\";\r\n\r\n\t\tthis._disposers.push(this._eventDispatcher);\r\n\r\n\t\t// Generate a unique ID\r\n\t\t$utils.used(this.uid);\r\n\r\n\t\t// Create SVG group to hold everything in\r\n\t\tthis.group = this.paper.addGroup(\"g\");\r\n\r\n\t\t// Set defaults\r\n\t\t// it is better to set defauls like this in order to save invaliation calls and events\r\n\t\tthis.setPropertyValue(\"scale\", 1);\r\n\t\tthis.setPropertyValue(\"rotation\", 0);\r\n\t\tthis.setPropertyValue(\"align\", \"none\");\r\n\t\tthis.setPropertyValue(\"valign\", \"none\");\r\n\t\tthis.setPropertyValue(\"pixelPerfect\", false);\r\n\t\tthis.setPropertyValue(\"visible\", true);\r\n\t\tthis.setPropertyValue(\"tooltipPosition\", \"fixed\");\r\n\t\tthis.setPropertyValue(\"verticalCenter\", \"none\");\r\n\t\tthis.setPropertyValue(\"horizontalCenter\", \"none\");\r\n\r\n\t\tthis.setPropertyValue(\"tooltipX\", percent(50));\r\n\t\tthis.setPropertyValue(\"tooltipX\", percent(50));\r\n\r\n\t\tthis.setPropertyValue(\"marginTop\", 0);\r\n\t\tthis.setPropertyValue(\"marginBottom\", 0);\r\n\t\tthis.setPropertyValue(\"marginLeft\", 0);\r\n\t\tthis.setPropertyValue(\"marginRight\", 0);\r\n\r\n\t\tthis.setPropertyValue(\"dx\", 0);\r\n\t\tthis.setPropertyValue(\"dy\", 0);\r\n\r\n\t\tthis.setPropertyValue(\"paddingTop\", 0);\r\n\t\tthis.setPropertyValue(\"paddingBottom\", 0);\r\n\t\tthis.setPropertyValue(\"paddingRight\", 0);\r\n\t\tthis.setPropertyValue(\"paddingLeft\", 0);\r\n\r\n\t\tthis.setPropertyValue(\"togglable\", false);\r\n\t\tthis.setPropertyValue(\"hidden\", false);\r\n\t\tthis.setPropertyValue(\"urlTarget\", \"_self\");\r\n\t\tthis.setPropertyValue(\"alwaysShowTooltip\", false);\r\n\t\tthis.setPropertyValue(\"showTooltipOn\", \"hover\");\r\n\r\n\t\tthis._prevMeasuredWidth = 0;\r\n\t\tthis._prevMeasuredHeight = 0;\r\n\t\tthis._measuredWidth = 0;\r\n\t\tthis._measuredHeight = 0;\r\n\r\n\t\tthis._isMeasured = true;\r\n\r\n\t\t// Invalidate the Sprite so that renderer knows it needs to be drawn\r\n\t\tthis.invalidate();\r\n\r\n\t\t//this.states.create(\"default\").properties.opacity = 1;\r\n\r\n\t\t// Apply the theme\r\n\t\tthis.applyTheme();\r\n\r\n\t\t//this._disposers.push(this._clickable);\r\n\r\n\t\t// Decorate adapter with events so that we can apply its settings whenever\r\n\t\t// it is modified\r\n\t\t// @todo Think what to do here. We can't just apply the adapter value to\r\n\t\t// property since not all of those are for properties. Commented out for\r\n\t\t// now.\r\n\t\t/*this.adapter.events.on(\"inserted\", (ev: any) => {\r\n\t\t\t(<any>this)[ev.newValue.key] = (<any>this)[ev.newValue.key];\r\n\t\t});\r\n\t\tthis.adapter.events.on(\"removed\", (ev: any) => {\r\n\t\t\t(<any>this)[ev.newValue.key] = (<any>this)[ev.newValue.key];\r\n\t\t});*/\r\n\r\n\t\t// Add disposable dependencies to `_disposers` so they are automatically\r\n\t\t// disposed of when this object is disposed\r\n\t\tthis._disposers.push(this.events);\r\n\t\tthis._disposers.push(this.group);\r\n\t\tthis._disposers.push(this._mask);\r\n\t\tthis._disposers.push(this._language);\r\n\t\tthis._disposers.push(this._exporting);\r\n\t\t//this._disposers.push(this._parent);\r\n\t\t//this._disposers.push(this._modal);\r\n\r\n\t\tthis._disposers.push(new Disposer(() => {\r\n\t\t\t$object.each(this._bindings, (key, value) => {\r\n\t\t\t\tvalue.dispose();\r\n\t\t\t});\r\n\t\t}));\r\n\r\n\t\tthis.setPropertyValue(\"interactionsEnabled\", true);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * ELEMENT VALIDATION, INIT, AND DRAWING STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Applies properties from all assigned themes.\r\n\t *\r\n\t * We do this here so that we can apply class names as well.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic applyTheme(): void {\r\n\t\tsuper.applyTheme();\r\n\t\tif (options.autoSetClassName) {\r\n\t\t\tthis.setClassName();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns theme(s) used by this object either set explicitly on this\r\n\t * element, inherited from parent, or inherited from [[System]].\r\n\t *\r\n\t * @return An array of theme references\r\n\t */\r\n\tpublic getCurrentThemes(): ITheme[] {\r\n\t\tconst themes = this._themes;\r\n\r\n\t\tif (themes) {\r\n\t\t\treturn themes;\r\n\r\n\t\t} else {\r\n\t\t\tconst parent = this._parent;\r\n\r\n\t\t\tif (parent) {\r\n\t\t\t\treturn parent.getCurrentThemes();\r\n\r\n\t\t\t} else {\r\n\t\t\t\treturn registry.themes;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Called just before element's validation, this function allows setting\r\n\t * defaults.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected applyInternalDefaults(): void {\r\n\r\n\t\t// Nothing here, but extending classes might override this function\r\n\t\t// so that they can set their defaults\r\n\t\tthis._internalDefaultsApplied = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates element.\r\n\t *\r\n\t * Object will be redrawn during the next update cycle.\r\n\t *\r\n\t * Please note that in most cases elements will auto-invalidate when needed. If\r\n\t * everything works, DO NOT use this method. Use it only if some changes do\r\n\t * not take otherwise.\r\n\t */\r\n\tpublic invalidate(): void {\r\n\t\tif (this.disabled || this._isTemplate || this.__disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// We no longer reset this on each invalidate, so that they are applied\r\n\t\t// only once, and do not overwrite user-defined settings\r\n\t\t//this._internalDefaultsApplied = false;\r\n\r\n\t\tif (!this.invalid) {\r\n\t\t\tthis.invalid = true;\r\n\t\t\tregistry.addToInvalidSprites(this);\r\n\t\t\tsystem.requestFrame();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Validates element:\r\n\t * * Triggers events\r\n\t * * Redraws the element\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate(): void {\r\n\t\tthis.dispatchImmediately(\"beforevalidated\");\r\n\r\n\t\t// prevents from drawing if topparent is 0x0\r\n\t\t/*\r\n\t\tlet topParent = this.topParent;\r\n\r\n\t\tif (topParent) {\r\n\t\t\tif (!topParent.maxWidth || !topParent.maxHeight) {\r\n\t\t\t\tthis._disposers.push(topParent.events.once(\"maxsizechanged\", this.invalidate, this));\r\n\t\t\t}\r\n\t\t}*/\r\n\r\n\t\t// Set internal defaults\r\n\t\tif (!this._internalDefaultsApplied) {\r\n\t\t\tthis.applyInternalDefaults();\r\n\t\t}\r\n\r\n\t\tthis.beforeDraw();\r\n\t\tthis.draw();\r\n\r\n\t\tthis.invalid = false;\r\n\r\n\t\tregistry.removeFromInvalidSprites(this);\r\n\t\tthis.afterDraw();\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates element's position.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic invalidatePosition(): void {\r\n\t\tif (this.disabled || this._isTemplate) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!this.positionInvalid) {\r\n\t\t\tthis.positionInvalid = true;\r\n\t\t\tregistry.addToInvalidPositions(this);\r\n\t\t\tsystem.requestFrame();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Transforms the element.\r\n\t *\r\n\t * @todo Description (review)\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validatePosition(): void {\r\n\r\n\t\tlet pixelX = this.pixelX;\r\n\t\tlet pixelY = this.pixelY;\r\n\t\tlet dx = this.dx;\r\n\t\tlet dy = this.dy;\r\n\r\n\t\tlet x: number = pixelX + dx;\r\n\t\tlet y: number = pixelY + dy;\r\n\r\n\t\tif (this._updateDisabled) {\r\n\t\t\tif (this._internalDisabled) {\r\n\t\t\t\tthis.group.attr({ \"display\": \"none\" })\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (!this.disabled) {\r\n\t\t\t\t\tthis.removeSVGAttribute(\"display\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._updateDisabled = false;\r\n\t\t}\r\n\r\n\t\tlet sizeChanged: boolean = this.measure();\r\n\r\n\t\t//if (!this.invalid) {\r\n\t\tlet prevGroupTransform: string = this.group.transformString;\r\n\r\n\t\tthis.group.moveTo({ x: x, y: y });\r\n\t\tthis.group.rotation = this.rotation;\r\n\t\tif (this.nonScaling) {\r\n\t\t\tthis.group.scale = this.scale / this.globalScale;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.group.scale = this.scale;\r\n\t\t}\r\n\r\n\t\tif (prevGroupTransform != this.group.transformString || sizeChanged) {\r\n\t\t\t// not yet sure, this is to avoid many transforms=>container layout invalidation on initial buid\r\n\t\t\tif (prevGroupTransform == null) {\r\n\t\t\t\tthis.dispatch(\"transformed\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.dispatchImmediately(\"transformed\");\r\n\t\t\t}\r\n\t\t\t// TODO clear existing positionchanged dispatches ?\r\n\t\t\tthis.dispatch(\"positionchanged\");\r\n\r\n\t\t\tif (this.showTooltipOn == \"hit\" || this.showTooltipOn == \"always\") {\r\n\t\t\t\tthis.updateTooltipPosition();\r\n\t\t\t}\r\n\t\t}\r\n\t\t//}\r\n\r\n\t\t// it might happen that x and y changed again, so we only remove if they didn't\r\n\t\tif (pixelX + dx == x && pixelY + dy == y) {\r\n\t\t\tregistry.removeFromInvalidPositions(this);\r\n\t\t\tthis.positionInvalid = false;\r\n\t\t}\r\n\t\tlet maskRectangle = this._maskRectangle;\r\n\t\t// todo: verify this\r\n\t\tif (maskRectangle) {\r\n\t\t\tthis._clipElement.moveTo({ x: maskRectangle.x - pixelX, y: maskRectangle.y - pixelY });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A placeholder method that is called **before** element begins to be drawn.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected beforeDraw(): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * A placeholder method that draws the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected draw(): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * A placeholder method that is called **after** element finishes drawing\r\n\t * itself.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected afterDraw(): void {\r\n\t\tif (this.isMeasured || this.horizontalCenter !== \"none\" || this.verticalCenter !== \"none\") {\r\n\t\t\tthis.measureElement();\r\n\t\t}\r\n\r\n\t\t//this.applyMask();\r\n\r\n\t\tif (!this._inited) {\r\n\t\t\tif (this._adapterO) {\r\n\t\t\t\t// used to be applySVGAttrbutes here, this is more efficient\r\n\t\t\t\tfor (let key of this._adapterO.keys()) {\r\n\t\t\t\t\tswitch (key) {\r\n\t\t\t\t\t\tcase \"mask\":\r\n\t\t\t\t\t\tcase \"fill\":\r\n\t\t\t\t\t\tcase \"opacity\":\r\n\t\t\t\t\t\tcase \"fillOpacity\":\r\n\t\t\t\t\t\tcase \"stroke\":\r\n\t\t\t\t\t\tcase \"strokeOpacity\":\r\n\t\t\t\t\t\tcase \"strokeWidth\":\r\n\t\t\t\t\t\tcase \"shapeRendering\":\r\n\t\t\t\t\t\tcase \"strokeDasharray\":\r\n\t\t\t\t\t\tcase \"strokeDashoffset\":\r\n\t\t\t\t\t\tcase \"strokeLinecap\":\r\n\t\t\t\t\t\tcase \"strokeLinejoin\":\r\n\t\t\t\t\t\tcase \"textDecoration\":\r\n\t\t\t\t\t\tcase \"fontSize\":\r\n\t\t\t\t\t\tcase \"fontFamily\":\r\n\t\t\t\t\t\tcase \"fontWeight\":\r\n\t\t\t\t\t\t\t//case \"focusable\":\r\n\t\t\t\t\t\t\t//case \"tabindex\":\r\n\t\t\t\t\t\t\t//case \"role\":\r\n\t\t\t\t\t\t\t(<any>this)[key] = (<any>this)[key];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.applyFilters();\r\n\r\n\t\t\tthis.visible = this.visible;\r\n\t\t\tthis.interactionsEnabled = this.getPropertyValue(\"interactionsEnabled\"); // can't use .interactionsEnabled as it get's parent's\r\n\r\n\t\t\tthis._inited = true;\r\n\r\n\t\t\tif (!this.showOnInit) {\r\n\t\t\t\tthis.appeared = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.hidden) {\r\n\t\t\t\tthis.hide(0);\r\n\t\t\t}\r\n\r\n\t\t\tthis.applyMask();\r\n\t\t\tthis.dispatch(\"validated\");\r\n\t\t\tthis.dispatch(\"inited\");\r\n\t\t\tthis.dispatchReady();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.dispatch(\"validated\");\r\n\t\t}\r\n\r\n\t\tif (this.showTooltipOn == \"always\") {\r\n\t\t\tif (this.visible && !this.disabled && !this.__disabled) {\r\n\t\t\t\tthis.showTooltip();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.hideTooltip(0);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Dispatches `\"ready\"` event. Sprite dispatches it right after `\"inited\"` event.\r\n\t *\r\n\t * @ignore\r\n\t */\r\n\tpublic dispatchReady(): void {\r\n\t\tif (!this.isReady()) {\r\n\t\t\tthis._ready = true;\r\n\t\t\tthis.dispatch(\"ready\");\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Triggers a re-initialization of this element.\r\n\t *\r\n\t * Will result in complete redrawing of the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic reinit(): void {\r\n\t\tthis._inited = false;\r\n\t\tthis.setState(this.defaultState);\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * Handles the situation where parent element is resized.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic handleGlobalScale(): void {\r\n\t\tthis.dispatch(\"globalscalechanged\");\r\n\r\n\t\tif (this.nonScalingStroke) {\r\n\t\t\tthis.strokeWidth = this.strokeWidth;\r\n\t\t}\r\n\r\n\t\tif (this.nonScaling) {\r\n\t\t\tthis.validatePosition();\r\n\t\t}\r\n\r\n\t\tthis.updateFilterScale();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Updates filter properties which might depend on scale\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected updateFilterScale(): void {\r\n\t\t$iter.each(this.filters.iterator(), (filter) => {\r\n\t\t\tfilter.scale = this.globalScale;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Removes itself from system's invalid lists.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected removeFromInvalids() {\r\n\t\tregistry.removeFromInvalidSprites(this);\r\n\t\tregistry.removeFromInvalidPositions(this);\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all parameters from another [[Sprite]].\r\n\t *\r\n\t * @param source Source Sprite\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\tsuper.copyFrom(source);\r\n\r\n\t\tthis.isMeasured = source.isMeasured;\r\n\r\n\t\tthis.states.copyFrom(source.states);\r\n\r\n\t\tif (source.filters.length > 0) {\r\n\t\t\tsource.filters.each((filter) => {\r\n\t\t\t\tthis.filters.push(filter.clone());\r\n\t\t\t})\r\n\t\t}\r\n\t\tif (source._adapterO) {\r\n\t\t\tthis.adapter.copyFrom(source._adapterO);\r\n\t\t}\r\n\r\n\t\t//helps to avoid calling getter which creates instance\r\n\t\tif ((<any>source)[\"_interaction\"]) {\r\n\t\t\tthis.interactions.copyFrom(source.interactions);\r\n\t\t}\r\n\r\n\t\tif ((<any>source)[\"_plugins\"]) {\r\n\t\t\tthis.plugins.copyFrom(source.plugins);\r\n\t\t}\r\n\r\n\t\tthis.configField = source.configField;\r\n\r\n\t\tthis.applyOnClones = source.applyOnClones;\r\n\r\n\t\t// this.numberFormatter = source.numberFormatter; // todo: this creates loose number formatter and copies it to all clones. somehow we need to know if source had numberFormatter explicitly created and not just because a getter was called.\r\n\r\n\t\t//this.mask = source.mask; need to think about this, generally this causes a lot of problems\r\n\t\tthis.disabled = source.disabled;\r\n\r\n\t\tthis.virtualParent = source.virtualParent;\r\n\r\n\t\tthis.exportable = source.exportable;\r\n\t\t//@todo: create tooltip if it's on source but not on this?\r\n\t\t//const tooltip = this._tooltip;\r\n\t\t//if (tooltip) {\r\n\t\t//\ttooltip.copyFrom(source.tooltip);\r\n\t\t//}\r\n\r\n\t\tif (source._tooltip) {\r\n\t\t\tif (this._tooltip) {\r\n\t\t\t\tthis._tooltip.copyFrom(source.tooltip);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (source.cloneTooltip) {\r\n\t\t\t\t\tthis.tooltip = source.tooltip.clone();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._tooltip = source.tooltip;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//if ((<any>source)[\"_tooltip\"] && !this._tooltip) {\r\n\t\t//\tthis._tooltip = (<any>source)[\"_tooltip\"];\r\n\t\t//}\r\n\r\n\t\tthis._showSystemTooltip = source.showSystemTooltip;\r\n\r\n\t\t$utils.copyProperties(source.propertyFields, this.propertyFields);\r\n\t\t$utils.copyProperties(source.properties, this);\r\n\r\n\t\tif (source.fillModifier) {\r\n\t\t\tthis.fillModifier = source.fillModifier.clone();\r\n\t\t}\r\n\r\n\t\tif (source.strokeModifier) {\r\n\t\t\tthis.strokeModifier = source.strokeModifier.clone();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys this object and all related data.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tif (!this.isDisposed()) {\r\n\r\n\t\t\tif (this.showTooltipOn == \"always\" && this.tooltip) {\r\n\t\t\t\tthis.tooltip.hide();\r\n\t\t\t}\r\n\r\n\t\t\tthis.dispatchImmediately(\"beforedisposed\");\r\n\r\n\t\t\tif (this.isBaseSprite) {\r\n\t\t\t\tif (this.htmlContainer) {\r\n\t\t\t\t\twhile (this.htmlContainer.childNodes.length > 0) {\r\n\t\t\t\t\t\tthis.htmlContainer.removeChild(this.htmlContainer.firstChild);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.isBaseSprite = false;\r\n\t\t\t}\r\n\r\n\t\t\tsuper.dispose();\r\n\r\n\t\t\t// Clear adapters\r\n\t\t\tif (this._adapterO) {\r\n\t\t\t\tthis._adapterO.clear();\r\n\t\t\t}\r\n\r\n\t\t\tif (this.applyOnClones) {\r\n\t\t\t\tif (this._clones) {\r\n\t\t\t\t\tfor (let i = this._clones.length - 1; i >= 0; i--) {\r\n\t\t\t\t\t\tlet clone = this._clones.getIndex(i);\r\n\t\t\t\t\t\tclone.dispose();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this._svgContainer) {\r\n\t\t\t\tthis._svgContainer.dispose();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._interactionDisposer) {\r\n\t\t\t\tthis._interactionDisposer.dispose();\r\n\t\t\t\tthis._interactionDisposer = undefined;\r\n\t\t\t}\r\n\r\n\t\t\tif (this._urlDisposer) {\r\n\t\t\t\tthis._urlDisposer.dispose();\r\n\t\t\t}\r\n\r\n\t\t\tthis.removeFromInvalids();\r\n\r\n\t\t\tif (this.element) {\r\n\t\t\t\tthis.element.dispose();\r\n\t\t\t}\r\n\t\t\tif (this.group) {\r\n\t\t\t\tthis.group.dispose();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._numberFormatter) {\r\n\t\t\t\tthis._numberFormatter.dispose();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._focusFilter) {\r\n\t\t\t\tthis._focusFilter.dispose();\r\n\t\t\t}\r\n\r\n\t\t\tlet stroke = this.stroke;\r\n\t\t\tif (stroke && !(stroke instanceof Color) && stroke.dispose) {\r\n\t\t\t\tif (this.clonedFrom && this.clonedFrom.stroke == stroke) {\r\n\t\t\t\t\t// do nothing\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tstroke.dispose();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// TODO a bit hacky\r\n\t\t\tlet fill = this.fill;\r\n\t\t\tif (fill && !(fill instanceof Color) && fill.dispose) {\r\n\t\t\t\tif (this.clonedFrom && this.clonedFrom.fill == fill) {\r\n\t\t\t\t\t// do nothing\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tfill.dispose();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// remove from map\r\n\t\t\tif ($type.hasValue(this.id)) {\r\n\t\t\t\tthis.map.removeKey(this.id);\r\n\t\t\t}\r\n\r\n\t\t\tthis.parent = undefined;\r\n\t\t\tif (this._filters) {\r\n\t\t\t\twhile (this._filters.length > 0) {\r\n\t\t\t\t\tlet filter = <Filter>this._filters.getIndex(0);\r\n\t\t\t\t\tfilter.dispose();\r\n\t\t\t\t\tthis._filters.removeValue(filter);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis._alwaysShowDisposers = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if this element is a \"template\".\r\n\t *\r\n\t * Template Sprites act only as a holders for config for other \"real\"\r\n\t * elements to be cloned from.\r\n\t *\r\n\t * Templates are treated differently, as they are not validated, redrawn, or\r\n\t * otherwise are processed.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value Is template?\r\n\t */\r\n\tpublic set isTemplate(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this._isTemplate != value) {\r\n\t\t\tthis._isTemplate = value;\r\n\r\n\t\t\tif (this instanceof Container) {\r\n\t\t\t\t$iter.each(this.children.iterator(), (child) => {\r\n\t\t\t\t\tchild.isTemplate = value;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tif (value) {\r\n\t\t\t\tthis.parent = this._parent;\r\n\t\t\t\tthis.removeFromInvalids();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.invalidate();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Is template?\r\n\t */\r\n\tpublic get isTemplate(): boolean {\r\n\t\treturn this._isTemplate;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether the element should attempt to construct itself in a way\r\n\t * so that system tooltip is shown if its `readerTitle` is set.\r\n\t *\r\n\t * @param value Show system tooltip?\r\n\t */\r\n\tpublic set showSystemTooltip(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this._showSystemTooltip != value) {\r\n\t\t\tthis._showSystemTooltip = value;\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Show system tooltip?\r\n\t */\r\n\tpublic get showSystemTooltip(): boolean {\r\n\t\tif (!$type.hasValue(this._showSystemTooltip)) {\r\n\t\t\tif (this.virtualParent) {\r\n\t\t\t\treturn this.virtualParent.showSystemTooltip;\r\n\t\t\t}\r\n\t\t\telse if (this._parent) {\r\n\t\t\t\treturn this._parent.showSystemTooltip;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._showSystemTooltip;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * HIERARCHY AND STRUCTURE RELATED STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Sprites's top-level [[Container]].\r\n\t *\r\n\t * Please note that in most cases it won't be the chart element.\r\n\t *\r\n\t * To access base chart element, use `baseSprite` instead.\r\n\t *\r\n\t * @return Top-level ascendant\r\n\t */\r\n\tpublic get topParent(): Optional<Container> {\r\n\t\tif (this._topParent) {\r\n\t\t\treturn this._topParent;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (this._parent) {\r\n\t\t\t\treturn this._parent.topParent;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * @param value {Container} top parent of a sprite\r\n\t */\r\n\tpublic set topParent(value: Container) {\r\n\t\tthis._topParent = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Elements' parent [[Container]].\r\n\t *\r\n\t * @param parent  Parent container\r\n\t */\r\n\tpublic set parent(parent: Optional<Container>) {\r\n\t\tif (this._isTemplate) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// TODO is this needed ?\r\n\t\t$utils.used(this.paper);\r\n\r\n\t\tlet oldParent = this._parent;\r\n\t\tif (oldParent != parent) {\r\n\r\n\t\t\tif (oldParent) {\r\n\t\t\t\toldParent.children.removeValue(this);\r\n\t\t\t}\r\n\r\n\t\t\tthis._parent = parent;\r\n\r\n\t\t\tif (parent) {\r\n\r\n\t\t\t\tthis.topParent = parent.topParent;\r\n\r\n\t\t\t\tif (parent.isTemplate) {\r\n\t\t\t\t\tthis.isTemplate = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.baseId = parent.baseId;\r\n\r\n\t\t\t\tparent.children.push(this);\r\n\t\t\t\t// insert handler at Container invalidates +  invalidatesLayout + adds to group\r\n\r\n\t\t\t\tif (this._tooltip && !this._tooltipContainer) {\r\n\t\t\t\t\tthis._tooltip.parent = parent.tooltipContainer;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!this._dataItem) {\r\n\t\t\t\t\tthis.dataItem = parent.dataItem;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.handleAlwaysShowTooltip();\r\n\r\n\t\t\t\tif (this.dataItem) {\r\n\t\t\t\t\t// No need to apply accessibility if there's no data item\r\n\t\t\t\t\t// The whole reason of applying it here is to populate data\r\n\t\t\t\t\t// placesholders, and if tehre's no data item, it won't work anyway\r\n\t\t\t\t\tthis.applyAccessibility();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.dispatchImmediately(\"parentset\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.topParent = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected handleAlwaysShow() {\r\n\t\tthis.showTooltip();\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected handleAlwaysShowTooltip() {\r\n\t\tlet sprite: Sprite = this;\r\n\r\n\t\tlet oldDisposers = this._alwaysShowDisposers;\r\n\t\tif (oldDisposers) {\r\n\t\t\t$array.each(oldDisposers, (oldDisposer) => {\r\n\t\t\t\toldDisposer.dispose();\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tthis._alwaysShowDisposers = [];\r\n\r\n\t\tif (this.showTooltipOn == \"always\") {\r\n\t\t\twhile (sprite != undefined) {\r\n\t\t\t\tlet disposer = sprite.events.on(\"visibilitychanged\", this.handleAlwaysShow, this, false);\r\n\t\t\t\tthis.addDisposer(disposer);\r\n\t\t\t\tthis._alwaysShowDisposers.push(disposer);\r\n\t\t\t\tsprite = sprite.parent;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Parent container\r\n\t */\r\n\tpublic get parent(): Optional<Container> {\r\n\t\treturn this._parent;\r\n\t}\r\n\r\n\t/**\r\n\t * Element's \"virtual\" parent.\r\n\t *\r\n\t * This is required in ordere to maintain proper inheritance (like\r\n\t * formatters).\r\n\t *\r\n\t * Sometimes an element is a \"logical\" parent, even though it's not a direct\r\n\t * ascendant.\r\n\t *\r\n\t * Example: a bullet is not a child of the axis, but it would make sense\r\n\t * for it to inherit series' formatters.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value  Virtual parent\r\n\t */\r\n\tpublic set virtualParent(value: Sprite) {\r\n\t\tthis._virtualParent = value;\r\n\t\tif (this.dataItem) {\r\n\t\t\t// No need to apply accessibility if there's no data item\r\n\t\t\t// The whole reason of applying it here is to populate data\r\n\t\t\t// placesholders, and if tehre's no data item, it won't work anyway\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Virtual parent\r\n\t */\r\n\tpublic get virtualParent(): Optional<Sprite> {\r\n\t\treturn this._virtualParent;\r\n\t}\r\n\r\n\t/**\r\n\t * Moves `<defs>` to correct place in DOM.\r\n\t *\r\n\t * Some elements are initially created in \"ghost\" container. When moving\r\n\t * those into proper place in DOM, their respective `<defs>` need to be moved\r\n\t * as well.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic appendDefs(): void {\r\n\r\n\t\tif (this.filterElement) {\r\n\t\t\tthis.paper.appendDef(this.filterElement);\r\n\t\t}\r\n\r\n\t\tlet fill = <any>this.fill;\r\n\r\n\t\tif (fill && fill.element) {\r\n\t\t\tthis.paper.appendDef(fill.element);\r\n\t\t}\r\n\r\n\t\tlet stroke = <any>this.stroke;\r\n\t\tif (stroke && stroke.element) {\r\n\t\t\tthis.paper.appendDef(stroke.element);\r\n\t\t}\r\n\r\n\t\tif (this.fillModifier && this.fill instanceof Color) {\r\n\t\t\tlet fill = <any>this.fillModifier.modify(this.fill);\r\n\t\t\tif (fill && fill.element) {\r\n\t\t\t\tthis.paper.appendDef(fill.element);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.strokeModifier && this.stroke instanceof Color) {\r\n\t\t\tlet stroke = <any>this.strokeModifier.modify(this.stroke);\r\n\t\t\tif (stroke && stroke.element) {\r\n\t\t\t\tthis.paper.appendDef(stroke.element);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._clipPath) {\r\n\t\t\tthis.paper.appendDef(this._clipPath);\r\n\t\t}\r\n\r\n\t\tif (this._exportable === false) {\r\n\t\t\tthis.exportable = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a [[Dictionary]] which maps object ids with their respective\r\n\t * objects.\r\n\t *\r\n\t * Can be used to retrieve any object by id, e.g.:\r\n\t *\r\n\t * ```TypeScript\r\n\t * console.log(mySprite.map.getKey(\"myid\"));\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * console.log(mySprite.map.getKey(\"myid\"));\r\n\t * ```\r\n\t *\r\n\t * @return Map collection\r\n\t */\r\n\tpublic get map(): Dictionary<string, any> {\r\n\t\tconst top = this.topParent;\r\n\r\n\t\tif (top) {\r\n\t\t\treturn top.map;\r\n\t\t} else if (!this._map) {\r\n\t\t\tthis._map = new Dictionary<string, any>();\r\n\t\t}\r\n\r\n\t\treturn this._map;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * @return Map collection\r\n\t */\r\n\tpublic get delayedMap(): Dictionary<string, any> {\r\n\t\tconst top = this.topParent;\r\n\r\n\t\tif (top) {\r\n\t\t\treturn top.delayedMap;\r\n\t\t} else if (!this._delayedMap) {\r\n\t\t\tthis._delayedMap = new Dictionary<string, any>();\r\n\t\t}\r\n\r\n\t\treturn this._delayedMap;\r\n\t}\r\n\r\n\t/**\r\n\t * Element's user-defined ID.\r\n\t *\r\n\t * Will throw an Error if there already is an object with the same ID.\r\n\t *\r\n\t * Please note that above check will be performed withing the scope of the\r\n\t * current chart instance. It will not do checks across other chart instances\r\n\t * or in globally in DOM.\r\n\t *\r\n\t * Make sure the IDs are unique.\r\n\t *\r\n\t * @param value ID\r\n\t */\r\n\tpublic set id(value: string) {\r\n\t\tif (this._id != value) {\r\n\t\t\tthis._id = value;\r\n\t\t\tif (this.map.hasKey(value)) {\r\n\t\t\t\tthrow Error(\"Duplicate id (\" + value + \") used on multiple objects.\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.map.setKey(value, this);\r\n\t\t\t}\r\n\t\t\tif (options.autoSetClassName) {\r\n\t\t\t\tthis.setClassName();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return ID\r\n\t */\r\n\tpublic get id(): string {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * ELEMENT AND DOM TREE MANIPULATION AND MEASURING\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Returns DOM element reference associated with this element.\r\n\t *\r\n\t * @readonly\r\n\t * @return DOM element\r\n\t */\r\n\tpublic get dom(): SVGSVGElement {\r\n\t\treturn this.group.node;\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Paper]] instance to place elements on.\r\n\t *\r\n\t * If there's no Paper set for this element, it goes up the ascendant tree\r\n\t * until it finds one.\r\n\t *\r\n\t * This method is used by important `addChild()` method, so it's essential\r\n\t * to have a [[Paper]] instance.\r\n\t *\r\n\t * If this element has a separate `htmlContainer` set, it will have a\r\n\t * [[Paper]] instance itself.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param paper  Paper\r\n\t */\r\n\tpublic set paper(paper: Paper) {\r\n\t\tthis.setPaper(paper);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets [[Paper]] instance to use to draw elements.\r\n\t * @ignore\r\n\t * @param paper Paper\r\n\t * @return true if paper was changed, false, if it's the same\r\n\t */\r\n\tpublic setPaper(paper: Paper): boolean {\r\n\t\tlet oldPaper = this._paper;\r\n\r\n\t\tif (oldPaper != paper) {\r\n\t\t\tthis._paper = paper;\r\n\r\n\t\t\tthis.appendDefs();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Paper\r\n\t */\r\n\tpublic get paper(): Paper {\r\n\t\tif (this._paper) {\r\n\t\t\treturn this._paper;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet parent = this._parent;\r\n\t\t\tif (parent) {\r\n\t\t\t\treturn parent.paper;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn getGhostPaper();\r\n\t}\r\n\r\n\t/**\r\n\t * An HTML element to be used when placing wrapper element (`<div>`)\r\n\t * for the whole chart.\r\n\t *\r\n\t * This is the same for **all** elements within the same chart.\r\n\t *\r\n\t * @param htmlContainer HTML element\r\n\t */\r\n\tpublic set htmlContainer(htmlContainer: $type.Optional<HTMLElement>) {\r\n\t\tthis._htmlContainer = htmlContainer;\r\n\t}\r\n\r\n\t/**\r\n\t * @return HTML element\r\n\t */\r\n\tpublic get htmlContainer(): $type.Optional<HTMLElement> {\r\n\t\tif (this._htmlContainer) {\r\n\t\t\treturn this._htmlContainer;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet parent = this._parent;\r\n\t\t\tif (parent) {\r\n\t\t\t\treturn parent.htmlContainer;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates (if not yet created) and returns element's `<title>` element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Title element\r\n\t */\r\n\tpublic get titleElement(): AMElement {\r\n\t\tif (!this._titleElement) {\r\n\t\t\tthis._titleElement = this.paper.add(\"title\");\r\n\t\t\tthis.group.add(this._titleElement);\r\n\t\t}\r\n\t\treturn this._titleElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates (if not yet created) and returns element's `<desc>` element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Desc element\r\n\t */\r\n\tpublic get descriptionElement(): AMElement {\r\n\t\tif (!this._descriptionElement) {\r\n\t\t\tthis._descriptionElement = this.paper.add(\"desc\");\r\n\t\t\tthis.group.add(this._descriptionElement);\r\n\t\t}\r\n\t\treturn this._descriptionElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns list of SVG filters (effects) applied to element. If the filter\r\n\t * list is not yet initilized, creates and returns an empty one.\r\n\t * Note, not all filters combine well with one another. We recommend using one filter per sprite.\r\n\t *\r\n\t * @return List of filters\r\n\t */\r\n\tpublic get filters(): List<Filter> {\r\n\t\tif (!this._filters) {\r\n\t\t\tthis._filters = new List<Filter>();\r\n\t\t\t// TODO only add certain events ?\r\n\t\t\tthis._disposers.push(this._filters.events.onAll(this.applyFilters, this));\r\n\t\t\tthis._disposers.push(new ListDisposer(this._filters));\r\n\t\t}\r\n\t\treturn this._filters;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets required SVG attributes. Must be called every time an element is\r\n\t * redrawn so that attributes are (re)applied.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected setSVGAttributes(): void {\r\n\t\tthis.fill = this.fill;\r\n\t\tthis.opacity = this.opacity;\r\n\t\tthis.fillOpacity = this.fillOpacity;\r\n\t\tthis.stroke = this.stroke;\r\n\t\tthis.strokeOpacity = this.strokeOpacity;\r\n\t\tthis.shapeRendering = this.shapeRendering;\r\n\t\tthis.strokeDasharray = this.strokeDasharray;\r\n\t\tthis.strokeDashoffset = this.strokeDashoffset;\r\n\t\tthis.strokeLinecap = this.strokeLinecap;\r\n\t\tthis.strokeLinejoin = this.strokeLinejoin;\r\n\t\tthis.focusable = this.focusable;\r\n\t\tthis.tabindex = this.tabindex;\r\n\t\tthis.role = this.role;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets an attribute directly on an SVG element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param attribute Attribute object\r\n\t */\r\n\tprotected setSVGAttribute(attribute: ISVGAttribute): void {\r\n\t\tthis.group.attr(attribute);\r\n\t}\r\n\r\n\t/**\r\n\t * Removes an attribute directly from SVG element.\r\n\t *\r\n\t * @param attribute Attribute key to remove\r\n\t */\r\n\tprotected removeSVGAttribute(attribute: string): void {\r\n\t\tthis.group.removeAttr(attribute);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets `class` attribute of the elements SVG node.\r\n\t *\r\n\t * Uses `am4core.options.classNamePrefix`.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic setClassName(): void {\r\n\r\n\t\tlet className = this.className;\r\n\t\tlet classNamePrefix = options.classNamePrefix;\r\n\r\n\t\tif (this.element) {\r\n\t\t\tthis.element.addClass(classNamePrefix + className);\r\n\t\t}\r\n\r\n\t\tthis.group.addClass(classNamePrefix + className + \"-group\");\r\n\r\n\t\tif ($type.hasValue(this.id)) {\r\n\t\t\tthis.group.addClass(classNamePrefix + this.id);\r\n\t\t}\r\n\r\n\t\tif (this.userClassName) {\r\n\t\t\tthis.group.addClass(this.userClassName);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an `id` attribute the the element and returns the id.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Element's ID\r\n\t */\r\n\tpublic uidAttr(): string {\r\n\t\tthis.setSVGAttribute({ \"id\": this.uid });\r\n\t\treturn this.uid;\r\n\t}\r\n\r\n\t/**\r\n\t * [updateClipPath description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected updateClipPath(): void {\r\n\t\tconst element = this._clipElement;\r\n\r\n\t\tif (element) {\r\n\t\t\telement.moveTo({ x: this.mask.pixelX, y: this.mask.pixelY });\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected createClipPath() {\r\n\t\tif (!this._clipPath) {\r\n\t\t\tthis._clipPath = this.paper.addGroup(\"clipPath\");\r\n\t\t\tthis.paper.appendDef(this._clipPath);\r\n\t\t\tthis._disposers.push(this._clipPath);\r\n\t\t\tlet id: string = registry.getUniqueId();\r\n\t\t\tthis._clipPath.attr({ \"id\": id });\r\n\t\t\tthis.group.attr({ \"clip-path\": \"url(\\\"\" + $utils.getBaseURI() + id + \"\\\")\" });\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Applies the mask Sprite.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected applyMask(): void {\r\n\t\tlet mask = this.mask;\r\n\r\n\t\tif (this._clipPath && mask) {\r\n\t\t\t// Container\r\n\t\t\tif (mask instanceof Container) {\r\n\t\t\t\tthis._clipElement.attr({ \"width\": $math.max(0, mask.pixelWidth), \"height\": $math.max(0, mask.pixelHeight) });\r\n\r\n\t\t\t\tlet point = $utils.spritePointToSprite({ x: mask.pixelX, y: mask.pixelY }, mask.parent, this);\r\n\r\n\t\t\t\tthis._clipPath.x = point.x;\r\n\t\t\t\tthis._clipPath.y = point.y;\r\n\t\t\t}\r\n\t\t\t// Sprite\r\n\t\t\telse {\r\n\t\t\t\tif (mask.element && mask.element != this._clipElement) {\r\n\t\t\t\t\tthis._clipElement = mask.element;\r\n\t\t\t\t\tthis._clipPath.add(this._clipElement);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._clipPath.scale = mask.scale;\r\n\t\t\t\tthis._clipPath.x = mask.pixelX;\r\n\t\t\t\tthis._clipPath.y = mask.pixelY;\r\n\t\t\t\tthis._clipPath.rotation = mask.rotation;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Applies filters to the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected applyFilters(): void {\r\n\t\t// we create a separate filter for each sprite as otherwise it would be impossible to animate filter.\r\n\t\t// svg doesn't support multiple filters applied to one element, so we put all the primitives to one filterElement of a sprite.\r\n\t\tif (this._filters && this._filters.length > 0) {\r\n\r\n\t\t\tlet width = 100;\r\n\t\t\tlet height = 100;\r\n\r\n\t\t\tif (!this.filterElement) {\r\n\t\t\t\tthis.filterElement = this.paper.addGroup(\"filter\");\r\n\t\t\t\tthis._disposers.push(this.filterElement);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.filterElement.removeChildNodes();\r\n\t\t\t}\r\n\r\n\t\t\tthis.paper.appendDef(this.filterElement);\r\n\r\n\t\t\tlet id: string = \"filter-\" + this.uid;\r\n\t\t\tthis.filterElement.attr({ \"id\": id });\r\n\r\n\t\t\t$iter.each(this.filters.iterator(), (filter) => {\r\n\t\t\t\tfilter.sprite = this;\r\n\t\t\t\tfilter.paper = this.paper;\r\n\r\n\t\t\t\tthis.filterElement.attr({ filterUnits: filter.filterUnits });\r\n\r\n\t\t\t\tfilter.appendPrimitives(this.filterElement);\r\n\r\n\t\t\t\tif (filter.width > width) {\r\n\t\t\t\t\twidth = filter.width;\r\n\t\t\t\t}\r\n\t\t\t\tif (filter.height > height) {\r\n\t\t\t\t\theight = filter.height;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfilter.scale = this.globalScale;\r\n\t\t\t});\r\n\r\n\t\t\tlet w = width + \"%\";\r\n\t\t\tlet h = height + \"%\";\r\n\r\n\t\t\t/* temporarily removed as it is breaking tooltips on Safari @todo come back to this\r\n\t\t\tif (this._measuredHeight <= 1) {\r\n\t\t\t\th = height + \"\";\r\n\t\t\t}\r\n\r\n\t\t\tif (this._measuredWidth <= 1) {\r\n\t\t\t\th = width + \"\";\r\n\t\t\t}*/\r\n\r\n\t\t\tthis.filterElement.attr({ \"width\": w, \"height\": h, \"x\": -(width - 100) / 2 + \"%\", \"y\": -(height - 100) / 2 + \"%\" });\r\n\r\n\t\t\tthis.group.attr({ \"filter\": \"url(\\\"\" + $utils.getBaseURI() + id + \"\\\")\" });\r\n\t\t}\r\n\t\telse if (this.filterElement) {\r\n\t\t\tthis.group.removeAttr(\"filter\");\r\n\t\t\tthis.filterElement.removeChildNodes();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [removeClipPath description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tprotected removeClipPath(): void {\r\n\t\tif (this._clipPath) {\r\n\t\t\t//this._clipPath.dispose();\r\n\t\t\tthis.removeDispose(this._clipPath);\r\n\t\t\tthis._clipPath = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [setElement description]\r\n\t *\r\n\t * @ignore\r\n\t * @todo Description\r\n\t * @param element [description]\r\n\t */\r\n\tpublic setElement(element: AMElement) {\r\n\t\tthis.element = element;\r\n\t\tthis.setSVGAttributes();\r\n\t\tthis.applyAccessibility();\r\n\t}\r\n\r\n\t/**\r\n\t * The main element for this Sprite, usually an SVG `<g>`.\r\n\t *\r\n\t * All other sub-elements are created in it.\r\n\t *\r\n\t * @param element  Element\r\n\t */\r\n\tpublic set element(element: Optional<AMElement>) {\r\n\r\n\t\t// Destroy previous element if there was one before\r\n\t\tthis.removeElement();\r\n\r\n\t\t// Set new element\r\n\t\tthis._element = element;\r\n\r\n\t\t// Add element to group\r\n\t\t// Since we are adding Element to group, which is already in the\r\n\t\t// `.disposers` it will be removed automatically when Sprite is disposed\r\n\t\t// of\r\n\t\tthis.group.add(element);\r\n\r\n\t\tif (element.node instanceof SVGPathElement) {\r\n\t\t\tthis._isPath = true;\r\n\t\t}\r\n\r\n\t\t// This is needed if someone is setting element not in draw method but\r\n\t\t// from outside\r\n\t\tif (!this.invalid) {\r\n\t\t\tthis.validate();\r\n\t\t}\r\n\r\n\t\tif (options.autoSetClassName) {\r\n\t\t\tthis.setClassName();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Element\r\n\t */\r\n\tpublic get element(): Optional<AMElement> {\r\n\t\treturn this._element;\r\n\t}\r\n\r\n\t/**\r\n\t * HTML container (`<div>`) which is used to place chart's `<svg>` element\r\n\t * in.\r\n\t *\r\n\t * @return Container for chart elements\r\n\t */\r\n\tpublic get svgContainer(): $type.Optional<SVGContainer> {\r\n\t\tif (this._svgContainer) {\r\n\t\t\treturn this._svgContainer;\r\n\t\t}\r\n\t\telse if (this._parent) {\r\n\t\t\treturn this._parent.svgContainer;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets HTML container to add SVG and other chart elements to.\r\n\t *\r\n\t * @param svgContainer Container for chart elements\r\n\t */\r\n\tpublic set svgContainer(svgContainer: $type.Optional<SVGContainer>) {\r\n\t\tthis._svgContainer = svgContainer;\r\n\t}\r\n\r\n\t/**\r\n\t * Measures main element.\r\n\t *\r\n\t * Saves measurements into private `_bbox` property.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected measureElement() {\r\n\r\n\t\tif (this.element) {\r\n\t\t\tif (this.definedBBox) {\r\n\t\t\t\tthis._bbox = this.definedBBox;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet svgBBox: IRectangle = this.element.getBBox();\r\n\t\t\t\tthis._bbox = { x: svgBBox.x, y: svgBBox.y, width: svgBBox.width, height: svgBBox.height };\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Positions element according its center settings.\r\n\t *\r\n\t * @todo Description (review)\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic updateCenter() {\r\n\t\tif (this.element) {\r\n\t\t\tlet prevElementTransform: string = this.element.transformString;\r\n\r\n\t\t\tlet bbox = this.bbox;\r\n\r\n\t\t\tlet ex = 0;\r\n\t\t\tlet ey = 0;\r\n\r\n\t\t\tlet elementX = bbox.x;\r\n\t\t\tlet elementY = bbox.y;\r\n\r\n\t\t\tlet elementWidth = bbox.width;\r\n\t\t\tlet elementHeigth = bbox.height;\r\n\r\n\t\t\tlet pixelPaddingLeft = this.pixelPaddingLeft;\r\n\t\t\tlet pixelPaddingRight = this.pixelPaddingRight;\r\n\t\t\tlet pixelPaddingTop = this.pixelPaddingTop;\r\n\t\t\tlet pixelPaddingBottom = this.pixelPaddingBottom;\r\n\r\n\t\t\t// add padding to the measured size\r\n\t\t\tlet measuredWidth = $math.max(elementWidth + pixelPaddingLeft + pixelPaddingRight, this.pixelWidth);\r\n\t\t\tlet measuredHeight = $math.max(elementHeigth + pixelPaddingTop + pixelPaddingBottom, this.pixelHeight);\r\n\r\n\t\t\t// extremes\r\n\t\t\tlet left = bbox.x;\r\n\t\t\tlet right = bbox.x + measuredWidth;\r\n\r\n\t\t\tlet top = bbox.y;\r\n\t\t\tlet bottom = bbox.y + measuredHeight;\r\n\r\n\t\t\tlet horizontalCenter = this.horizontalCenter;\r\n\t\t\tlet verticalCenter = this.verticalCenter;\r\n\r\n\t\t\tswitch (horizontalCenter) {\r\n\t\t\t\tcase \"none\":\r\n\t\t\t\t\tex = elementX + pixelPaddingLeft;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"left\":\r\n\t\t\t\t\tex = pixelPaddingLeft;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"middle\":\r\n\t\t\t\t\tex = pixelPaddingLeft - (elementWidth + pixelPaddingRight + pixelPaddingLeft) / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"right\":\r\n\t\t\t\t\tex = -pixelPaddingRight - elementWidth;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tswitch (verticalCenter) {\r\n\t\t\t\tcase \"none\":\r\n\t\t\t\t\tey = elementY + pixelPaddingTop;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"top\":\r\n\t\t\t\t\tey = pixelPaddingTop;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"middle\":\r\n\t\t\t\t\tey = pixelPaddingTop - (elementHeigth + pixelPaddingBottom + pixelPaddingTop) / 2;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"bottom\":\r\n\t\t\t\t\tey = -pixelPaddingBottom - elementHeigth;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tthis._measuredHeight = measuredHeight;\r\n\t\t\tthis._measuredWidth = measuredWidth;\r\n\r\n\t\t\tlet x: number = $math.round(ex - elementX, this._positionPrecision, true);\r\n\t\t\tlet y: number = $math.round(ey - elementY, this._positionPrecision, true);\r\n\r\n\t\t\tthis.ex = x - pixelPaddingLeft;\r\n\t\t\tthis.ey = y - pixelPaddingTop;\r\n\r\n\t\t\tthis.maxLeft = left + x - pixelPaddingLeft;\r\n\t\t\tthis.maxRight = right + x - pixelPaddingLeft;\r\n\r\n\t\t\tthis.maxTop = top + y - pixelPaddingTop;\r\n\t\t\tthis.maxBottom = bottom + y - pixelPaddingTop;\r\n\r\n\t\t\tif (this.pixelPerfect && options.pixelPerfectPrecision == 0) {\r\n\t\t\t\tx -= 0.5;\r\n\t\t\t\ty -= 0.5;\r\n\t\t\t}\r\n\r\n\t\t\tthis.element.moveTo({ x: x, y: y });\r\n\r\n\t\t\tif (prevElementTransform != this.element.transformString) {\r\n\t\t\t\tthis.dispatchImmediately(\"transformed\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Measures the whole element.\r\n\t *\r\n\t * Returns `true` if the size has changed from the last measurement.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Did the size changed from the last measurement?\r\n\t */\r\n\tpublic measure(): boolean {\r\n\r\n\t\tthis.updateCenter();\r\n\r\n\t\tlet measuredWidth = this._measuredWidth;\r\n\t\tlet measuredHeight = this._measuredHeight;\r\n\r\n\t\t// extremes\r\n\t\tlet left = this.maxLeft;\r\n\t\tlet right = this.maxRight;\r\n\r\n\t\tlet top = this.maxTop;\r\n\t\tlet bottom = this.maxBottom;\r\n\r\n\t\t// non-parent wise size\r\n\t\tthis._measuredWidthSelf = measuredWidth;\r\n\t\tthis._measuredHeightSelf = measuredHeight;\r\n\r\n\t\tlet positionPrecision = this._positionPrecision;\r\n\r\n\t\tthis.maxLeftSelf = this.maxLeft;\r\n\t\tthis.maxRightSelf = this.maxRight;\r\n\t\tthis.maxTopSelf = this.maxTop;\r\n\t\tthis.maxBottomSelf = this.maxBottom;\r\n\r\n\t\t// if a sprite is rotated or scaled, calculate measured size after transformations\r\n\r\n\t\tif (this.rotation !== 0 || this.scale !== 1 || this.nonScaling) {\r\n\r\n\t\t\t// not good to handleGlobalScale here.\r\n\t\t\tif (this.nonScalingStroke) {\r\n\t\t\t\tthis.strokeWidth = this.strokeWidth;\r\n\t\t\t}\r\n\r\n\t\t\tlet svg = this.paper.svg;\r\n\r\n\t\t\tlet matrix: SVGMatrix = svg.createSVGMatrix();\r\n\t\t\tlet rotation: number = this.rotation;\r\n\r\n\t\t\tlet scale = this.scale;\r\n\r\n\t\t\tif (this.nonScaling) {\r\n\t\t\t\tscale = this.scale / this.globalScale;\r\n\t\t\t}\r\n\r\n\t\t\tmatrix.a = $math.cos(rotation) * scale;\r\n\t\t\tmatrix.c = - $math.sin(rotation) * scale;\r\n\t\t\tmatrix.e = 0;\r\n\t\t\tmatrix.b = $math.sin(rotation) * scale;\r\n\t\t\tmatrix.d = $math.cos(rotation) * scale;\r\n\t\t\tmatrix.f = 0;\r\n\r\n\t\t\tlet p1: SVGPoint = svg.createSVGPoint();\r\n\t\t\tp1.x = left;\r\n\t\t\tp1.y = top;\r\n\r\n\t\t\tlet p2: SVGPoint = svg.createSVGPoint();\r\n\t\t\tp2.x = right;\r\n\t\t\tp2.y = top;\r\n\r\n\t\t\tlet p3: SVGPoint = svg.createSVGPoint();\r\n\t\t\tp3.x = right;\r\n\t\t\tp3.y = bottom;\r\n\r\n\t\t\tlet p4: SVGPoint = svg.createSVGPoint();\r\n\t\t\tp4.x = left;\r\n\t\t\tp4.y = bottom;\r\n\r\n\t\t\tlet pt1: SVGPoint = p1.matrixTransform(matrix);\r\n\t\t\tlet pt2: SVGPoint = p2.matrixTransform(matrix);\r\n\t\t\tlet pt3: SVGPoint = p3.matrixTransform(matrix);\r\n\t\t\tlet pt4: SVGPoint = p4.matrixTransform(matrix);\r\n\r\n\t\t\tleft = Math.min(pt1.x, pt2.x, pt3.x, pt4.x);\r\n\t\t\tright = Math.max(pt1.x, pt2.x, pt3.x, pt4.x);\r\n\t\t\ttop = Math.min(pt1.y, pt2.y, pt3.y, pt4.y);\r\n\t\t\tbottom = Math.max(pt1.y, pt2.y, pt3.y, pt4.y);\r\n\r\n\t\t\tmeasuredWidth = right - left;\r\n\t\t\tmeasuredHeight = bottom - top;\r\n\r\n\t\t\tthis.maxLeft = $math.round(left, positionPrecision, true);\r\n\t\t\tthis.maxRight = $math.round(right, positionPrecision, true);\r\n\t\t\tthis.maxTop = $math.round(top, positionPrecision, true);\r\n\t\t\tthis.maxBottom = $math.round(bottom, positionPrecision, true);\r\n\t\t}\r\n\r\n\t\tthis._measuredWidth = $math.round(measuredWidth, positionPrecision, true);\r\n\t\tthis._measuredHeight = $math.round(measuredHeight, positionPrecision, true);\r\n\r\n\r\n\t\t// dispatch event\r\n\t\tif (this._measuredWidth != this._prevMeasuredWidth || this._measuredHeight != this._prevMeasuredHeight) {\r\n\t\t\tthis._prevMeasuredHeight = this._measuredHeight;\r\n\t\t\tthis._prevMeasuredWidth = this._measuredWidth;\r\n\r\n\t\t\t// TODO clear existing sizechanged dispatches ?\r\n\t\t\tthis.dispatch(\"sizechanged\");\r\n\r\n\t\t\tif ((this.isHover || this.showTooltipOn == \"hit\" || this.showTooltipOn == \"always\") && this.tooltip && this.tooltip.visible && ($type.hasValue(this.tooltipText) || $type.hasValue(this.tooltipHTML))) {\r\n\t\t\t\tthis.updateTooltipPosition();\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Insert this element before sibling element.\r\n\t *\r\n\t * @param sprite  Target element\r\n\t * @return This element\r\n\t */\r\n\tpublic insertBefore(sprite: Sprite): Sprite {\r\n\t\tlet parent = this._parent;\r\n\r\n\t\tif (parent) {\r\n\t\t\tlet index: number = parent.children.indexOf(sprite);\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\tparent.children.moveValue(this, index);\r\n\t\t\t\tparent.sortChildren();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Insert this element after sibling element.\r\n\t *\r\n\t * @param sprite  Target element\r\n\t * @return This element\r\n\t */\r\n\tpublic insertAfter(sprite: Sprite): Sprite {\r\n\t\tlet parent = this._parent;\r\n\r\n\t\tif (parent) {\r\n\t\t\tlet index: number = parent.children.indexOf(sprite);\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\tparent.children.moveValue(this, index + 1);\r\n\t\t\t\tparent.sortChildren();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes the main SVG element.\r\n\t *\r\n\t * This does not destroy the whole Sprite element. To do that use\r\n\t * `dispose()` instead.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected removeElement() {\r\n\t\t// remove visual element\r\n\t\tif (this._element) {\r\n\t\t\tthis.removeDispose(this._element);\r\n\t\t\tthis._element = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns relative (percent) value of the X coordindate within this element.\r\n\t *\r\n\t * A relative value is a hundredth of a percent. So 100% would result in a 1\r\n\t * as relative value.\r\n\t *\r\n\t * @param value  Absolute or relative X coordinate\r\n\t * @return Relative value\r\n\t */\r\n\tpublic getRelativeX(value: number | Percent): number {\r\n\t\tif (value instanceof Percent) {\r\n\t\t\treturn value.value;\r\n\t\t}\r\n\t\telse if (this._parent) {\r\n\t\t\treturn value / this._parent.innerWidth;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns relative (percent) value of the Y coordindate within this element.\r\n\t *\r\n\t * A relative value is a hundredth of a percent. So 100% would result in a 1\r\n\t * as relative value.\r\n\t *\r\n\t * @param value  Absolute or relative Y coordinate\r\n\t * @return Relative value\r\n\t */\r\n\tpublic getRelativeY(value: number | Percent): number {\r\n\t\tif (value instanceof Percent) {\r\n\t\t\treturn value.value;\r\n\t\t}\r\n\t\telse if (this._parent) {\r\n\t\t\treturn value / this._parent.innerHeight;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an X coordinate in pixel within the element.\r\n\t *\r\n\t * If number is passed in as parameter, the same number will be returned\r\n\t * back.\r\n\t *\r\n\t * If [[Percent]] is passed in, it will be recalculated to pixels.\r\n\t *\r\n\t * @param value  Absolute or relative X coordinate\r\n\t * @return X coordinate in pixels\r\n\t */\r\n\tpublic getPixelX(value: number | Percent): number {\r\n\r\n\t\t// we don't use $utils.valueToRelative as this would mean that we should access parent.innerWidth\r\n\t\t// all the time and this would result chain of the same actions and will slow down the system a lot\r\n\r\n\t\tlet pixel: number = 0;\r\n\t\tif ($type.isNumber(value)) {\r\n\t\t\tpixel = value;\r\n\t\t}\r\n\t\telse if (value instanceof Percent) {\r\n\t\t\tlet relative: number = value.value;\r\n\r\n\t\t\tif (this._parent) {\r\n\t\t\t\tpixel = $math.round(this._parent.innerWidth * relative, this._positionPrecision, true);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pixel;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an Y coordinate in pixel within the element.\r\n\t *\r\n\t * If number is passed in as parameter, the same number will be returned\r\n\t * back.\r\n\t *\r\n\t * If [[Percent]] is passed in, it will be recalculated to pixels.\r\n\t *\r\n\t * @param value  Absolute or relative Y coordinate\r\n\t * @return Y coordinate in pixels\r\n\t */\r\n\tpublic getPixelY(value: number | Percent): number {\r\n\r\n\t\t// we don't use $utils.valueToRelative as this would mean that we should access parent.innerWidth\r\n\t\t// all the time and this would result chain of the same actions and will slow down the system a lot\r\n\r\n\t\tlet pixel: number = 0;\r\n\t\tif ($type.isNumber(value)) {\r\n\t\t\tpixel = value;\r\n\t\t}\r\n\t\telse if (value instanceof Percent) {\r\n\t\t\tlet relative: number = value.value;\r\n\r\n\t\t\tif (this._parent) {\r\n\t\t\t\tpixel = $math.round(this._parent.innerHeight * relative, this._positionPrecision, true);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn pixel;\r\n\t}\r\n\r\n\t/**\r\n\t * Moves the element to a specified coordinates.\r\n\t *\r\n\t * Using this method is preferred method of moving element, as it saves some\r\n\t * CPU processing power over setting `x` and `y` properties separately.\r\n\t *\r\n\t * The method respects element's center settings. The element will be\r\n\t * positioned so that `point` coordinates come in whatever \"center\" of the\r\n\t * element is, as set in `horizontalCenter` and `verticalCenter`.\r\n\t *\r\n\t * Besides moving the element, you can also at the same time scale and\r\n\t * rotate the element.\r\n\t *\r\n\t * @param point     New coordinates\r\n\t * @param rotation  New rotation\r\n\t * @param scale     New Scale\r\n\t */\r\n\tpublic moveTo(point: IPoint, rotation?: number, scale?: number, isDragged?: boolean): void {\r\n\t\tif (this.isDragged && !isDragged) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (point) {\r\n\t\t\tif ($type.isNumber(point.x)) {\r\n\t\t\t\tthis.setPropertyValue(\"x\", $math.round(point.x, this._positionPrecision, true));\r\n\t\t\t}\r\n\t\t\tif ($type.isNumber(point.y)) {\r\n\t\t\t\tthis.setPropertyValue(\"y\", $math.round(point.y, this._positionPrecision, true));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($type.isNumber(rotation)) {\r\n\t\t\tthis.rotation = rotation;\r\n\t\t}\r\n\r\n\t\tif ($type.isNumber(scale)) {\r\n\t\t\tthis.scale = scale;\r\n\t\t}\r\n\r\n\t\t// must leave this\r\n\t\tthis.invalidatePosition();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets another [[Sprite]] element as this elements mask.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param mask A [[Sprite]] to use as mask\r\n\t */\r\n\tpublic set mask(mask: Optional<Sprite>) {\r\n\t\tif (this._mask.get() !== mask) {\r\n\t\t\t// this is good\r\n\t\t\tif (mask) {\r\n\r\n\t\t\t\tthis.createClipPath();\r\n\r\n\t\t\t\tif (!(mask instanceof Container)) {\r\n\t\t\t\t\tmask.isMeasured = false;\r\n\t\t\t\t\tif (mask.element) {\r\n\t\t\t\t\t\tthis._clipElement = mask.element;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._clipElement = this.paper.add(\"rect\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._clipElement) {\r\n\t\t\t\t\tthis._clipPath.add(this._clipElement);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._mask.set(mask, new MultiDisposer([\r\n\t\t\t\t\t//mask.addEventListener(SpriteEvent.TRANSFORMED, this.applyMask, false, this);\r\n\t\t\t\t\tmask.events.on(\"maxsizechanged\", () => { if (this.inited) { this.applyMask(); } }, undefined, false),\r\n\t\t\t\t\tmask.events.on(\"validated\", this.applyMask, this, false),\r\n\t\t\t\t\tmask.events.on(\"positionchanged\", this.applyMask, this, false)\r\n\t\t\t\t]));\r\n\r\n\t\t\t\tthis.applyMask();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._mask.reset();\r\n\t\t\t\tthis.group.removeAttr(\"clip-path\");\r\n\t\t\t\tthis.removeClipPath();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns [[Sprite]] element currently used as mask for this element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return A [[Sprite]] to use as mask\r\n\t */\r\n\tpublic get mask(): Optional<Sprite> {\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn this._mask.get();\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"mask\", this._mask.get());\r\n\t\t}\r\n\t}\r\n\r\n\t// you can set IRectangle as a mask instead o a sprite. Note, the changes of the object won't be monitored\r\n\r\n\t/**\r\n\t * Instead of creating a [[Sprite]] for mask, you can just use a\r\n\t * [[Rectangle]] by setting this accessor.\r\n\t *\r\n\t * Please note that the element will not monitor any changes to the mask\r\n\t * rectangle.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param rect Mask Rectangle\r\n\t */\r\n\tpublic set maskRectangle(rect: IRectangle) {\r\n\t\tif (rect) {\r\n\r\n\t\t\tthis.createClipPath();\r\n\r\n\t\t\tif (!this._clipElement) {\r\n\t\t\t\tthis._clipElement = this.paper.add(\"rect\");\r\n\t\t\t\tthis._clipPath.add(this._clipElement);\r\n\t\t\t}\r\n\t\t\tthis._clipElement.attr({ \"width\": rect.width, \"height\": rect.height });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.removeClipPath();\r\n\t\t\tthis._clipElement = undefined;\r\n\t\t}\r\n\t\tthis._maskRectangle = rect;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Mask Rectangle\r\n\t */\r\n\tpublic get maskRectangle(): IRectangle {\r\n\t\treturn this._maskRectangle;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if this element was already measured.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value Was element already measured?\r\n\t */\r\n\tpublic set isMeasured(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\r\n\t\tif (!value) {\r\n\t\t\tthis._measuredWidth = 0;\r\n\t\t\tthis._measuredHeight = 0;\r\n\t\t\t//this._pixelHeight = 0;\r\n\t\t\t//this._pixelWidth = 0;\r\n\t\t}\r\n\r\n\t\tif (this._isMeasured != value) {\r\n\t\t\tthis._isMeasured = value;\r\n\t\t\tthis.invalidatePosition();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Was element already measured?\r\n\t */\r\n\tpublic get isMeasured(): boolean {\r\n\t\treturn this._isMeasured;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the this element has any of its parts overlapping with another\r\n\t * element.\r\n\t *\r\n\t * @todo Description (review)\r\n\t * @param sprite  Second element to test again\r\n\t * @return Overlapping?\r\n\t */\r\n\tpublic hitTest(sprite: Sprite): boolean {\r\n\t\t// validate, otherwise we will not know measuredWidth and measuredHeight\r\n\t\tif (this.invalid) {\r\n\t\t\tthis.validate();\r\n\t\t}\r\n\t\tif (sprite.invalid) {\r\n\t\t\tsprite.validate();\r\n\t\t}\r\n\r\n\t\tlet ax1 = this.pixelX + this.maxLeft;\r\n\t\tlet ay1 = this.pixelY + this.maxTop;\r\n\t\tlet ax2 = ax1 + this.maxRight;\r\n\t\tlet ay2 = ay1 + this.maxBottom;\r\n\r\n\t\tlet bx1 = sprite.pixelX + sprite.maxLeft;\r\n\t\tlet by1 = sprite.pixelY + sprite.maxTop;\r\n\t\tlet bx2 = bx1 + sprite.maxRight;\r\n\t\tlet by2 = by1 + sprite.maxBottom;\r\n\r\n\t\treturn !(bx1 > ax2 || bx2 < ax1 || by1 > ay2 || by2 < ay1);\r\n\t}\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * STATE-RELATED\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Returns `true` if Sprite has already finished initializing.\r\n\t *\r\n\t * @return Initialized?\r\n\t */\r\n\tpublic get inited(): boolean {\r\n\t\treturn this._inited;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if Sprite has already finished initializing and is ready.\r\n\t *\r\n\t * If this object is a [[Container]] it will wait for all of its children\r\n\t * are ready before becoming ready itself and firing a `\"ready\"` event.\r\n\t *\r\n\t * @return is ready?\r\n\t */\r\n\tpublic isReady(): boolean {\r\n\t\treturn this._ready;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a collection of element's available [[SpriteState]] entries.\r\n\t *\r\n\t * @see {@link SpriteState}\r\n\t * @return States\r\n\t */\r\n\tpublic get states(): DictionaryTemplate<string, SpriteState<this[\"_properties\"], this[\"_adapter\"]>> {\r\n\t\tif (!this._states) {\r\n\t\t\tconst state = new SpriteState<this[\"_properties\"], this[\"_adapter\"]>();\r\n\r\n\t\t\t// works\r\n\t\t\tthis._states = new DictionaryTemplate<string, SpriteState<this[\"_properties\"], this[\"_adapter\"]>>(state);\r\n\r\n\t\t\t// TODO what about removeKey ?\r\n\t\t\tthis._disposers.push(this._states.events.on(\"insertKey\", this.processState, this, false));\r\n\t\t\tthis._disposers.push(this._states.events.on(\"setKey\", this.processState, this, false));\r\n\r\n\t\t\tthis._disposers.push(new DictionaryDisposer(this._states));\r\n\t\t\tthis._disposers.push(state);\r\n\t\t}\r\n\t\treturn this._states;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a [[SpriteState]] object for \"hidden\" state.\r\n\t *\r\n\t * This is a shortcut to `this.states.getKey(\"hidden\")`.\r\n\t *\r\n\t * @return Hidden state\r\n\t */\r\n\tpublic get hiddenState(): SpriteState<this[\"_properties\"], this[\"_adapter\"]> {\r\n\t\tif (!this.states.getKey(\"hidden\")) {\r\n\t\t\tlet hiddenState = this.states.create(\"hidden\");\r\n\t\t\thiddenState.properties.opacity = 0;\r\n\t\t\thiddenState.properties.visible = false;\r\n\t\t}\r\n\r\n\t\treturn this.states.getKey(\"hidden\");\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a [[SpriteState]] object for \"default\" state.\r\n\t *\r\n\t * This is a shortcut to `this.states.getKey(\"default\")`.\r\n\t *\r\n\t * @return Hidden state\r\n\t */\r\n\tpublic get defaultState(): SpriteState<this[\"_properties\"], this[\"_adapter\"]> {\r\n\r\n\t\tif (!this.states.getKey(\"default\")) {\r\n\t\t\tlet defaultState = this.states.create(\"default\");\r\n\t\t\tdefaultState.properties.opacity = 1;\r\n\t\t}\r\n\r\n\t\treturn this.states.getKey(\"default\");\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if some key states are defined and updates Sprite properties\r\n\t * accordingly.\r\n\t *\r\n\t * For example if there's a state \"down\" defined for Sprite, we automatically\r\n\t * make it \"clickable\".\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param event An event which caused state list update\r\n\t */\r\n\tprotected processState(event: IDictionaryEvents<string, SpriteState<this[\"_properties\"], this[\"_adapter\"]>>[\"insertKey\" | \"setKey\"]): void {\r\n\t\tlet state: SpriteState<this[\"_properties\"], this[\"_adapter\"]> = event.newValue;\r\n\t\tstate.sprite = this;\r\n\t\tstate.name = event.key;\r\n\t\tif (this.states.hasKey(\"hover\") || (this.showTooltipOn == \"hover\" && ($type.hasValue(this.tooltipHTML) || $type.hasValue(this.tooltipText)))) {\r\n\t\t\tthis.hoverable = true;\r\n\t\t}\r\n\r\n\t\tif (this.states.hasKey(\"down\") || (this.showTooltipOn == \"hover\" && ($type.hasValue(this.tooltipHTML) || $type.hasValue(this.tooltipText)))) {\r\n\t\t\tthis.clickable = true;\r\n\t\t}\r\n\r\n\t\tif (this.states.hasKey(\"focus\")) {\r\n\t\t\tthis.focusable = true;\r\n\t\t}\r\n\r\n\t\t// Propagate the new state to clones\r\n\t\tif (this.applyOnClones) {\r\n\t\t\tconst clones = this.clones.values;\r\n\t\t\tconst length = clones.length;\r\n\r\n\t\t\tfor (let i = 0; i < length; ++i) {\r\n\t\t\t\tconst clone = clones[i];\r\n\t\t\t\tif (!clone.isDisposed()) {\r\n\t\t\t\t\tclone.states.setKey(state.name, state);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a list elements's animations currently being played.\r\n\t *\r\n\t * If the list has not been initialized it is created.\r\n\t *\r\n\t * @return List of animations\r\n\t */\r\n\tpublic get animations(): Array<Animation> {\r\n\t\tif (!this._animations) {\r\n\t\t\tthis._animations = [];\r\n\t\t\tthis._disposers.push(new AnimationDisposer(this._animations));\r\n\t\t}\r\n\t\treturn this._animations;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts element's local coordinates to the coordinates within the main\r\n\t * chart container.\r\n\t *\r\n\t * @param point  Local point\r\n\t * @return Global point\r\n\t */\r\n\tpublic getSvgPoint(point: IPoint): IPoint {\r\n\t\ttry {\r\n\t\t\t// Calculate SVG point\r\n\t\t\tlet bbox = this.htmlContainer.getBoundingClientRect();\r\n\r\n\t\t\treturn {\r\n\t\t\t\t\"x\": point.x - bbox.left,\r\n\t\t\t\t\"y\": point.y - bbox.top\r\n\t\t\t};\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\treturn point;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and starts an [[Animation]] with given `animationOptions`.\r\n\t *\r\n\t * @see {@link Animation} for additional information about available options\r\n\t * @param animationOptions  Animation options\r\n\t * @param duration          Duration in milliseconds\r\n\t * @param easing            Easing function\r\n\t * @return Animation instance\r\n\t */\r\n\tpublic animate(animationOptions: ISpriteAnimationOptions[] | ISpriteAnimationOptions, duration: number, easing?: (value: number) => number): Animation {\r\n\t\treturn new Animation(this, animationOptions, duration, easing).start();\r\n\t}\r\n\r\n\t/**\r\n\t * Applies a [[SpriteState]] on this element.\r\n\t *\r\n\t * The first parameter can either be a name state or a [[SpriteState]]\r\n\t * instance.\r\n\t *\r\n\t * When run, this method will apply SVG properties defined in a\r\n\t * [[SpriteState]], but only those that are relevant to this particular\r\n\t * element, i.e. are in the `properties` array.\r\n\t *\r\n\t * @see {@link SpriteState}\r\n\t * @param value               A state - name key or instance\r\n\t * @param transitionDuration  Duration of the transition between current and new state\r\n\t * @param easing              An easing function\r\n\t */\r\n\tpublic setState(value: string | SpriteState<this[\"_properties\"], this[\"_adapter\"]>, transitionDuration?: number, easing?: (value: number) => number): $type.Optional<Animation> {\r\n\t\tlet state: Optional<SpriteState<this[\"_properties\"], this[\"_adapter\"]>>;\r\n\t\tif (value instanceof SpriteState) {\r\n\t\t\tthis.states.setKey(value.name, value);\r\n\t\t\tstate = value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstate = this.states.getKey(value);\r\n\t\t\tif (!state) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// stop previous transition\r\n\t\t// not good - foe expample, we are animating to some \"active\" state and in them middle \"hover\" state happens. then \"active\" stat won't be applied\r\n\t\t//if (this._transition) {\r\n\t\t//this._transition.stop();\r\n\t\t//}\r\n\r\n\t\tif (state.name == \"hover\") {\r\n\t\t\tif (this.isHidden) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.isHover = true;\r\n\t\t}\r\n\r\n\t\tif (state.name == \"hidden\") {\r\n\t\t\tthis.isHiding = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (!this.visible) {\r\n\t\t\t\tthis.setVisibility(state.properties.visible || this.defaultState.properties.visible);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (state.name == \"active\") {\r\n\t\t\tthis.isActive = true;\r\n\t\t}\r\n\t\t// we do not set isActive = false here if it's not active, but container does that if setStateOnChildren = true\r\n\r\n\r\n\t\tif (!$type.isNumber(transitionDuration)) {\r\n\t\t\ttransitionDuration = state.transitionDuration;\r\n\t\t}\r\n\r\n\t\tif (!$type.hasValue(easing)) {\r\n\t\t\teasing = state.transitionEasing;\r\n\t\t}\r\n\r\n\t\treturn this.transitTo(state, transitionDuration, easing);\r\n\t}\r\n\r\n\t/**\r\n\t * Applies proper state based on the condition of the element. A condition is\r\n\t * deducted in this order:\r\n\t * * \"hover\" if Sprite has currently any pointers over it\r\n\t * * \"down\" if Sprite has any pointers (touch or mouse) currently pressed over it\r\n\t * * \"focus\" if Sprite has currently got focus (accessibility)\r\n\t * * \"hidden\" if Sprite is currently hidden\r\n\t *\r\n\t * Returns an [[Animation]] object, which is handling gradual transition from\r\n\t * current values of properties, to the new target state(s).\r\n\t *\r\n\t * @param duration  Duration for the animation (ms)\r\n\t * @return [[Animation]] object which is handling the transition\r\n\t */\r\n\tpublic applyCurrentState(duration?: number): $type.Optional<Animation> {\r\n\r\n\t\t//if (!this.isHidden) { // this was done for hover state not to take effect if \"hidden\" is actually visible, need to think about it.\r\n\r\n\t\tlet animation: $type.Optional<Animation> = this.setState(this.defaultState, duration);\r\n\r\n\t\tif (this.isHover) {\r\n\t\t\tanimation = this.setState(\"hover\", duration);\r\n\t\t}\r\n\r\n\t\tif (this.isDown && this.interactions.downPointers.length) {\r\n\t\t\tanimation = this.setState(\"down\", duration);\r\n\t\t}\r\n\r\n\t\tthis.isFocused = this.isFocused;\r\n\r\n\t\tif (this.isActive) {\r\n\t\t\tanimation = this.setState(\"active\", duration);\r\n\t\t\tif (this.isHover && this.states.hasKey(\"hoverActive\")) {\r\n\t\t\t\tanimation = this.setState(\"hoverActive\", duration);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn animation;\r\n\t\t//}\r\n\t}\r\n\r\n\t/**\r\n\t * Starts an [[Animation]] of the properties to specific values as they are\r\n\t * set in `state`.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param state     Target State\r\n\t * @param duration  Duration in milliseconds\r\n\t * @param easing    Easing function\r\n\t * @return Transition Animation\r\n\t */\r\n\tprotected transitTo(state: SpriteState<this[\"_properties\"], this[\"_adapter\"]>, duration: number, easing?: (value: number) => number): Optional<Animation> {\r\n\t\t// Init\r\n\t\tlet options: ISpriteAnimationOptions[] = [],\r\n\t\t\tpropValues = state.allValues,\r\n\t\t\ttransition: Optional<Animation>;\r\n\r\n\t\t// todo: do this for numeric/color properties only?\r\n\t\t// @todo use state.getPropertyValue instead\r\n\t\t$object.each(propValues, (propertyName, finalValue) => {\r\n\t\t\tlet currentValue: any = (<any>this)[propertyName];\r\n\t\t\t// save current value to default state. this solves a big problem where values must be set both on sprite and default state\r\n\t\t\tif (finalValue != currentValue && this.defaultState.properties[propertyName] == undefined) {\r\n\t\t\t\tthis.defaultState.properties[propertyName] = currentValue;\r\n\t\t\t}\r\n\r\n\t\t\t//if (finalValue != currentValue && $type.hasValue(finalValue)) {\r\n\t\t\tif (<any>finalValue != \"__unset\") {\r\n\t\t\t\tlet option: ISpriteAnimationOptions = { from: currentValue, to: <any>finalValue, property: propertyName };\r\n\t\t\t\toptions.push(option);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (options.length > 0) {\r\n\t\t\ttransition = this.animate(options, duration, easing);\r\n\t\t\tif (transition && !transition.isFinished()) {\r\n\t\t\t\t// TODO should this use events.once ?\r\n\t\t\t\t// TODO push onto _disposers array ?\r\n\t\t\t\tthis._disposers.push(transition.events.on(\"animationended\", () => {\r\n\t\t\t\t\tthis.dispatchImmediately(\"transitionended\");\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.dispatchImmediately(\"transitionended\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// apply filters if set\r\n\t\tif (state.filters.length > 0) {\r\n\t\t\tlet newFilters: Filter[] = [];\r\n\t\t\t// check for the same filters\r\n\t\t\t$iter.each(state.filters.iterator(), (stateFilter) => {\r\n\t\t\t\tlet newFilter: Filter = <Filter>stateFilter.clone();\r\n\t\t\t\tnewFilters.push(newFilter);\r\n\t\t\t\tlet animationOptions: IAnimationOptions[] = [];\r\n\r\n\t\t\t\t$iter.each(this.filters.iterator(), (currentFilter) => {\r\n\t\t\t\t\t// if we have the same filters\r\n\t\t\t\t\tif (currentFilter.className == newFilter.className) {\r\n\r\n\t\t\t\t\t\tif (!$iter.contains(this.defaultState.filters.iterator(), (x) => x.className === newFilter.className)) {\r\n\t\t\t\t\t\t\tthis.defaultState.filters.push(currentFilter);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t$object.each(newFilter.properties, (propertyName, newValue) => {\r\n\t\t\t\t\t\t\tlet currentValue = (<any>currentFilter).properties[propertyName];\r\n\t\t\t\t\t\t\t// if values are not the same, push to animation options array\r\n\t\t\t\t\t\t\tif (currentValue != newValue) {\r\n\t\t\t\t\t\t\t\tanimationOptions.push({ property: propertyName, from: currentValue, to: newValue });\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// animate to new value\r\n\t\t\t\tnewFilter.animate(animationOptions, duration, easing);\r\n\t\t\t});\r\n\t\t\tthis.filters.clear();\r\n\t\t\tthis.filters.pushAll(newFilters);\r\n\t\t}\r\n\r\n\t\treturn transition;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if Sprite is currently transiting from one state/value to\r\n\t * another.\r\n\t *\r\n\t * @return Is in transition?\r\n\t */\r\n\tpublic isInTransition(): boolean {\r\n\t\treturn this.animations.length > 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if this element has a mouse pointer currently hovering\r\n\t * over it, or if it has any touch pointers pressed on it.\r\n\t *\r\n\t * You can force element to be \"hovered\" manually, by setting this property\r\n\t * to `true`.\r\n\t *\r\n\t * @param value Is hovered?\r\n\t */\r\n\tpublic set isHover(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (value !== this.isHover) {\r\n\t\t\tif (this.isInteractive()) {\r\n\t\t\t\tthis.interactions.isHover = value;\r\n\t\t\t\tif (value) {\r\n\t\t\t\t\tthis.handleOver();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.interactions.isRealHover = false;\r\n\t\t\t\t\tthis.handleOut();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Is hovered?\r\n\t */\r\n\tpublic get isHover(): boolean {\r\n\t\tif (this.isInteractive()) {\r\n\t\t\treturn this.interactions.isHover;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns indicator if this element is being dragged at the moment.\r\n\t *\r\n\t * @return Is dragged?\r\n\t */\r\n\tpublic get isDragged(): boolean {\r\n\t\treturn this._isDragged;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns indicator if this element is being resized at the moment.\r\n\t *\r\n\t * @return Is resized?\r\n\t */\r\n\tpublic get isResized(): boolean {\r\n\t\treturn this._isResized;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if this element has any pointers (mouse or touch) pressing down\r\n\t * on it.\r\n\t *\r\n\t * @param value Is down?\r\n\t */\r\n\tpublic set isDown(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.isInteractive() && this.isDown != value) {\r\n\t\t\tthis.interactions.isDown = value;\r\n\t\t\tif (value) {\r\n\t\t\t\tthis.handleDown();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.handleUp();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Is down?\r\n\t */\r\n\tpublic get isDown(): boolean {\r\n\t\tif (this.isInteractive()) {\r\n\t\t\treturn this.interactions.isDown;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if this element is focused (possibly by tab navigation).\r\n\t *\r\n\t * @param value Is focused?\r\n\t */\r\n\tpublic set isFocused(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.focusable && this.isFocused != value) {\r\n\t\t\tif (this.isInteractive()) {\r\n\t\t\t\tthis.interactions.isFocused = value;\r\n\t\t\t\tif (value === true) {\r\n\t\t\t\t\tthis.handleFocus();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.handleBlur();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Is focused?\r\n\t */\r\n\tpublic get isFocused(): boolean {\r\n\t\tif (this.isInteractive()) {\r\n\t\t\treturn this.interactions.isFocused;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if this element is currently active (toggled on) or not\r\n\t * (toggled off).\r\n\t *\r\n\t * @param value Is active?\r\n\t */\r\n\tpublic set isActive(value: boolean) {\r\n\t\tthis.setActive(value);\r\n\t}\r\n\r\n\r\n\tprotected setActive(value: boolean) {\r\n\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this._isActive !== value) {\r\n\t\t\tthis._isActive = value;\r\n\t\t\tif (value && this.states.hasKey(\"active\")) {\r\n\t\t\t\tthis.setState(\"active\");\r\n\t\t\t\tif (this.isHover && this.states.hasKey(\"hoverActive\")) {\r\n\t\t\t\t\tthis.setState(\"hoverActive\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.applyCurrentState();\r\n\t\t\t}\r\n\r\n\t\t\tthis.dispatchImmediately(\"toggled\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Is active?\r\n\t */\r\n\tpublic get isActive(): boolean {\r\n\t\treturn this._isActive;\r\n\t}\r\n\r\n\t/**\r\n\t * Controls if element is disabled.\r\n\t *\r\n\t * A disabled element is hidden, and is removed from any processing, layout\r\n\t * calculations, and generally treated as if it does not exist.\r\n\t *\r\n\t * The element itself is not destroyed, though. Setting this back to `false`,\r\n\t * will \"resurrect\" the element.\r\n\t *\r\n\t * @param value  Disabled?\r\n\t */\r\n\tpublic set disabled(value: boolean) {\r\n\t\tthis.setDisabled(value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Disabled?\r\n\t */\r\n\tpublic get disabled(): boolean {\r\n\t\t//if(this._internalDisabled){\r\n\t\t//\treturn true;\r\n\t\t//}\r\n\t\tlet current = this.getPropertyValue(\"disabled\");\r\n\t\tif ($type.hasValue(current)) {\r\n\t\t\treturn current;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (this.virtualParent) {\r\n\t\t\t\treturn this.virtualParent.disabled;\r\n\t\t\t}\r\n\t\t\tif (this._parent) {\r\n\t\t\t\treturn this._parent.disabled;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n\tprotected setDisabled(value: boolean): boolean {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tlet current = this.getPropertyValue(\"disabled\");\r\n\t\tif (current != value) {\r\n\t\t\tthis.setPropertyValue(\"disabled\", value, true);\r\n\t\t\tif (value) {\r\n\t\t\t\tthis.parent = this._parent;\r\n\t\t\t\tthis.removeFromInvalids();\r\n\t\t\t\tthis.group.attr({ \"display\": \"none\" });\r\n\t\t\t\tthis.dispatch(\"disabled\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (this._parent) {\r\n\t\t\t\t\tlet group = <Group>this._parent.element;\r\n\t\t\t\t\tif (!group.hasChild(this.group)) {\r\n\t\t\t\t\t\tgroup.add(this.group);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this instanceof Container) {\r\n\t\t\t\t\tthis.deepInvalidate();\r\n\t\t\t\t\tif (this._background) {\r\n\t\t\t\t\t\tthis._background.invalidate();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.invalidate();\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.__disabled) {\r\n\t\t\t\t\tthis.removeSVGAttribute(\"display\");\r\n\t\t\t\t}\r\n\t\t\t\tthis.dispatch(\"enabled\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.dispatch(\"transformed\");\r\n\t\t\tsystem.requestFrame();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Internal disable method.\r\n\t *\r\n\t * Do not use it for disabling elements. Use `disabled` accessor instead.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value Disabled?\r\n\t */\r\n\tpublic set __disabled(value: boolean) {\r\n\t\tif (this._internalDisabled != value) {\r\n\t\t\tthis._internalDisabled = value;\r\n\t\t\tthis._updateDisabled = true;\r\n\t\t\tthis.invalidatePosition(); // better use this instead of invalidate()\r\n\r\n\t\t\tif(!value){\r\n\t\t\t\tthis.invalidate();\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * @return Disabled?\r\n\t */\r\n\tpublic get __disabled(): boolean {\r\n\t\treturn this._internalDisabled;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * FORMATTERS AND OTHER EXTERNAL HELPERS\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * A [[NumberFormatter]] instance.\r\n\t *\r\n\t * This is used to format numbers.\r\n\t *\r\n\t * ```TypeScript\r\n\t * chart.numberFormatter.numberFormat = \"#,###.#####\";\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * chart.numberFormatter.numberFormat = \"#,###.#####\";\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"numberFormatter\": {\r\n\t *     \"numberFormat\": \"#,###.#####\"\r\n\t *   }\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * You can set a separate instance of formatter for each\r\n\t * individual element. However that would be unnecessary overhead as\r\n\t * all elements would automatically inherit formatter from their parents,\r\n\t * all the way up to the chart itself.\r\n\t *\r\n\t *\r\n\t * @see {@link NumberFormatter} for more info on formatting numbers\r\n\t * @param value  An instance of NumberFormatter\r\n\t */\r\n\tpublic set numberFormatter(value: NumberFormatter) {\r\n\t\tthis._numberFormatter = value;\r\n\t\tthis._numberFormatter.language = this.language;\r\n\t}\r\n\r\n\t/**\r\n\t * @return A [[NumberFormatter]] instance to be used\r\n\t */\r\n\tpublic get numberFormatter(): NumberFormatter {\r\n\t\tif (this._numberFormatter) {\r\n\t\t\treturn this._numberFormatter;\r\n\t\t}\r\n\t\telse if (this.virtualParent) {\r\n\t\t\treturn this.virtualParent.numberFormatter;\r\n\t\t}\r\n\t\telse if (this._parent) {\r\n\t\t\treturn this._parent.numberFormatter;\r\n\t\t}\r\n\t\tthis._numberFormatter = new NumberFormatter();\r\n\t\tthis._numberFormatter.language = this.language;\r\n\t\treturn this.numberFormatter;\r\n\t}\r\n\r\n\t/**\r\n\t * A [[DateFormatter]] instance.\r\n\t *\r\n\t * This is used to format dates, e.g. on a date axes, balloons, etc.\r\n\t *\r\n\t * ```TypeScript\r\n\t * chart.dateFormatter.dateFormat = \"yyyy-MM-dd\";\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * chart.dateFormatter.dateFormat = \"yyyy-MM-dd\";\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"dateFormatter\": {\r\n\t *     \"dateFormat\": \"yyyy-MM-dd\"\r\n\t *   }\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * You can set a separate instance of formatter for each\r\n\t * individual element. However that would be unnecessary overhead as\r\n\t * all elements would automatically inherit formatter from their parents,\r\n\t * all the way up to the chart itself.\r\n\t *\r\n\t * @see {@link DateFormatter} for more info on dates formatting\r\n\t * @param value  An instance of DateFormatter\r\n\t */\r\n\tpublic set dateFormatter(value: DateFormatter) {\r\n\t\tthis._dateFormatter = value;\r\n\t\tthis._dateFormatter.language = this.language;\r\n\t}\r\n\r\n\t/**\r\n\t * @return An instance of DateFormatter\r\n\t */\r\n\tpublic get dateFormatter(): DateFormatter {\r\n\t\tif (this._dateFormatter) {\r\n\t\t\treturn this._dateFormatter;\r\n\t\t}\r\n\t\telse if (this.virtualParent) {\r\n\t\t\treturn this.virtualParent.dateFormatter;\r\n\t\t}\r\n\t\telse if (this._parent) {\r\n\t\t\treturn this._parent.dateFormatter;\r\n\t\t}\r\n\t\tthis._dateFormatter = new DateFormatter();\r\n\t\tthis._dateFormatter.language = this.language;\r\n\t\treturn this.dateFormatter;\r\n\t}\r\n\r\n\t/**\r\n\t * A [[DurationFormatter]] instance.\r\n\t *\r\n\t * This is used to format numbers as durations, e.g. on a value axes.\r\n\t *\r\n\t * You can set a separate instance of formatter for each\r\n\t * individual element. However that would be unnecessary overhead as\r\n\t * all elements would automatically inherit formatter from their parents,\r\n\t * all the way up to the chart itself.\r\n\t *\r\n\t * @see {@link DurationFormatter} for more info on durations\r\n\t * @param value  An instance of DurationFormatter\r\n\t */\r\n\tpublic set durationFormatter(value: DurationFormatter) {\r\n\t\tthis._durationFormatter = value;\r\n\t\tthis._durationFormatter.language = this.language;\r\n\t}\r\n\r\n\t/**\r\n\t * @return An instance of DurationFormatter\r\n\t */\r\n\tpublic get durationFormatter(): DurationFormatter {\r\n\t\tif (this._durationFormatter) {\r\n\t\t\treturn this._durationFormatter;\r\n\t\t}\r\n\t\telse if (this.virtualParent) {\r\n\t\t\treturn this.virtualParent.durationFormatter;\r\n\t\t}\r\n\t\telse if (this._parent) {\r\n\t\t\treturn this._parent.durationFormatter;\r\n\t\t}\r\n\t\tthis._durationFormatter = new DurationFormatter();\r\n\t\tthis._durationFormatter.language = this.language;\r\n\t\treturn this.durationFormatter;\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Language]] instance to use for translations.\r\n\t *\r\n\t * Normally it is enough to set language for the top-most element - chart.\r\n\t *\r\n\t * All other element child elements will automatically re-use that language\r\n\t * object.\r\n\t *\r\n\t * @param value  An instance of Language\r\n\t */\r\n\tpublic set language(value: Language) {\r\n\t\tif (this._language.get() !== value) {\r\n\t\t\tthis._language.set(value, value.events.on(\"localechanged\", (ev) => {\r\n\t\t\t\tif (this._numberFormatter) {\r\n\t\t\t\t\tthis._numberFormatter.language = this.language;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._dateFormatter) {\r\n\t\t\t\t\tthis._dateFormatter.language = this.language;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._durationFormatter) {\r\n\t\t\t\t\tthis._durationFormatter.language = this.language;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._exporting.get()) {\r\n\t\t\t\t\tconst exporting = this._exporting.get();\r\n\t\t\t\t\texporting.numberFormatter.language = this.language;\r\n\t\t\t\t\texporting.dateFormatter.language = this.language;\r\n\t\t\t\t\texporting.durationFormatter.language = this.language;\r\n\t\t\t\t\texporting.language = this.language;\r\n\t\t\t\t}\r\n\t\t\t\tif (this instanceof Container) {\r\n\t\t\t\t\tthis.deepInvalidate();\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return An instance of Language\r\n\t */\r\n\tpublic get language(): Language {\r\n\t\tlet language = this._language.get();\r\n\t\tif (language) {\r\n\t\t\treturn language;\r\n\t\t}\r\n\t\telse if (this.virtualParent) {\r\n\t\t\treturn this.virtualParent.language;\r\n\t\t}\r\n\t\telse if (this._parent) {\r\n\t\t\treturn this._parent.language;\r\n\t\t}\r\n\t\tlanguage = new Language();\r\n\t\tthis.language = language;\r\n\t\treturn language;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * DATA-RELATED STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Parses the string for meta tags `{tag}` and replaces them with a real\r\n\t * value. Supports straight up tags referring to the field in data, i.e.\r\n\t * `{value}` or tags with additional formatting info. E.g.:\r\n\t *\r\n\t * ```Text\r\n\t * {myfield.formatDate(\"yyyy-MM-dd\")}\r\n\t * {myfield.formatDate()}\r\n\t * {myfield.formatNumber(\"#,####.00\")}\r\n\t * {myfield.formatNumber()}\r\n\t * {myField.formatDuration(\"mm:ss\")}\r\n\t * ```\r\n\t *\r\n\t * Etc.\r\n\t *\r\n\t * This method Will automatically detect and use proper formatter for the\r\n\t * value.\r\n\t *\r\n\t * The source value will be looked up in various places: (in order)\r\n\t * * Sprite's own `dataItem`\r\n\t * * Sprite's properties\r\n\t * * Parent's `dataItem`\r\n\t * * Parent's properties\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param string            A string to format\r\n\t * @param dataItem          DataItem\r\n\t * @return Formatted string\r\n\t */\r\n\r\n\tpublic populateString(string: string, dataItem?: DataItem): string {\r\n\t\tif ($type.hasValue(string)) {\r\n\t\t\tstring = $type.castString(string);\r\n\t\t\tstring = getTextFormatter().escape(string);\r\n\t\t\tlet tags = string.match(/\\{([^}]+)\\}/g);\r\n\t\t\tlet i;\r\n\t\t\tif (tags) {\r\n\t\t\t\tfor (i = 0; i < tags.length; i++) {\r\n\t\t\t\t\tlet tag = tags[i].replace(/\\{([^}]+)\\}/, \"$1\");\r\n\t\t\t\t\tlet value = this.getTagValue(tag, \"\", dataItem);\r\n\r\n\t\t\t\t\tif (!$type.hasValue(value)) {\r\n\t\t\t\t\t\tvalue = \"\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstring = string.split(tags[i]).join(value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tstring = getTextFormatter().unescape(string);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstring = \"\";\r\n\t\t}\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn string;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"populateString\", string);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the value from data item and formats it according to specified format.\r\n\t *\r\n\t * If `format` is specified, it will use its contents to choose formatter for\r\n\t * the value. Otherwise it will select formatter accordingly to actual value\r\n\t * type.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Ability to force certain formatter on known numeric and date values\r\n\t * @see {@link NumberFormatter}\r\n\t * @see {@link DateFormatter}\r\n\t * @see {@link DurationFormatter}\r\n\t * @param tagName           Tag name to replace\r\n\t * @param format            Format to use\r\n\t * @param dataItem          DataItem\r\n\t * @return Formatted value\r\n\t */\r\n\tpublic getTagValue(tagName: string, format?: string, dataItem?: DataItem): string {\r\n\t\tlet value: any;\r\n\t\tif (!$type.hasValue(dataItem)) {\r\n\t\t\tdataItem = this.dataItem;\r\n\t\t}\r\n\r\n\t\t// Parse parts\r\n\t\tlet parts: any[] = [];\r\n\t\tlet reg = /([^.]+)\\(([^)]*)\\)|([^.]+)/g;;\r\n\t\tlet matches;\r\n\r\n\t\twhile (true) {\r\n\t\t\tmatches = reg.exec(tagName);\r\n\r\n\t\t\tif (matches === null) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (matches[3]) {\r\n\t\t\t\t// Simple property\r\n\t\t\t\tparts.push({\r\n\t\t\t\t\tprop: matches[3]\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Method\r\n\t\t\t\t// Parse parameters\r\n\t\t\t\tlet params: any[] = [];\r\n\t\t\t\tif ($utils.trim(matches[2]) != \"\") {\r\n\t\t\t\t\tlet reg2 = /'([^']*)'|\"([^\"]*)\"|([0-9\\-]+)/g;\r\n\t\t\t\t\tlet matches2;\r\n\r\n\t\t\t\t\twhile (true) {\r\n\t\t\t\t\t\tmatches2 = reg2.exec(matches[2]);\r\n\r\n\t\t\t\t\t\tif (matches2 === null) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tparams.push(matches2[1] || matches2[2] || matches2[3])\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tparts.push({\r\n\t\t\t\t\tmethod: matches[1],\r\n\t\t\t\t\tparams: params\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\t// Check if we can retrieve the value from data item\r\n\t\tif (dataItem) {\r\n\r\n\r\n\t\t\t// Check values\r\n\t\t\tvalue = this.getTagValueFromObject(parts, dataItem.values);\r\n\r\n\t\t\t// Check properties\r\n\t\t\tif (!$type.hasValue(value) || $type.isObject(value)) { // isObject helps to solve problem with date axis, as for example dateX will get dateX from values object and won't get to the dateX date.\r\n\t\t\t\tvalue = this.getTagValueFromObject(parts, dataItem);\r\n\t\t\t}\r\n\r\n\t\t\t// Check data context\r\n\t\t\tlet dataContext: any = dataItem.dataContext;\r\n\t\t\tif (!$type.hasValue(value) && dataContext) {\r\n\t\t\t\tvalue = this.getTagValueFromObject(parts, dataItem.dataContext);\r\n\r\n\t\t\t\t// Maybe it's a literal dot-separated name of the key in dataContext?\r\n\t\t\t\tif (!$type.hasValue(value)) {\r\n\t\t\t\t\tvalue = this.getTagValueFromObject([{\r\n\t\t\t\t\t\tprop: tagName\r\n\t\t\t\t\t}], dataContext);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// scond data context level sometimes exist (tree map)\r\n\t\t\t\tif (!$type.hasValue(value) && dataContext.dataContext) {\r\n\t\t\t\t\tvalue = this.getTagValueFromObject(parts, dataContext.dataContext);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check component's data item\r\n\t\t\tif (!$type.hasValue(value) && dataItem.component && dataItem.component.dataItem !== dataItem) {\r\n\t\t\t\tvalue = dataItem.component.getTagValue(tagName, format);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check sprite's properties\r\n\t\tif (!$type.hasValue(value)) {\r\n\t\t\tvalue = this.getTagValueFromObject(parts, this.populateStringFrom || <any>this);\r\n\t\t}\r\n\r\n\t\t// Finally, check the parent\r\n\t\tif (!$type.hasValue(value) && this._parent) {\r\n\t\t\tvalue = this._parent.getTagValue(tagName, format);\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Tries to retrieve values from properties of any object, then applies\r\n\t * proper formatting to it.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description (improve)\r\n\t * @param parts   Properties ant methods to access\r\n\t * @param object  Source object\r\n\t * @param format  A specific format to apply\r\n\t * @return Formatted value\r\n\t */\r\n\tpublic getTagValueFromObject(parts: any[], object: any, format?: string): any {\r\n\t\tlet current: any = object;\r\n\t\tlet formatApplied = false;\r\n\t\tfor (let i = 0, len = parts.length; i < len; i++) {\r\n\t\t\tlet part = parts[i];\r\n\t\t\tif (part.prop) {\r\n\t\t\t\t// Regular property\r\n\t\t\t\tcurrent = current[part.prop];\r\n\t\t\t\tif (!$type.hasValue(current)) {\r\n\t\t\t\t\t// Not set, return undefined\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Method\r\n\r\n\t\t\t\tswitch (part.method) {\r\n\t\t\t\t\tcase \"formatNumber\":\r\n\t\t\t\t\t\tlet numberValue = $utils.anyToNumber(current);\r\n\t\t\t\t\t\tif ($type.hasValue(numberValue)) {\r\n\t\t\t\t\t\t\tcurrent = this.numberFormatter.format(\r\n\t\t\t\t\t\t\t\tnumberValue,\r\n\t\t\t\t\t\t\t\tformat || part.params[0] || undefined\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tformatApplied = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"formatDate\":\r\n\t\t\t\t\t\tlet dateValue;\r\n\t\t\t\t\t\tif ($type.isString(current)) {\r\n\t\t\t\t\t\t\tdateValue = this.dateFormatter.parse(current);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tdateValue = $utils.anyToDate(current);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!$type.isDate(dateValue) || $type.isNaN(dateValue.getTime())) {\r\n\t\t\t\t\t\t\t// Was not able to get date out of value, quitting and letting\r\n\t\t\t\t\t\t\t// calling method try another value\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ($type.hasValue(dateValue)) {\r\n\t\t\t\t\t\t\tcurrent = this.dateFormatter.format(\r\n\t\t\t\t\t\t\t\tdateValue,\r\n\t\t\t\t\t\t\t\tformat || part.params[0] || undefined\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tformatApplied = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"formatDuration\":\r\n\t\t\t\t\t\tlet durationValue = $utils.anyToNumber(current);\r\n\t\t\t\t\t\tif ($type.hasValue(durationValue)) {\r\n\t\t\t\t\t\t\tcurrent = this.durationFormatter.format(\r\n\t\t\t\t\t\t\t\tdurationValue,\r\n\t\t\t\t\t\t\t\tformat || part.params[0] || undefined,\r\n\t\t\t\t\t\t\t\tpart.params[1] || undefined\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tformatApplied = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"urlEncode\":\r\n\t\t\t\t\tcase \"encodeURIComponent\":\r\n\t\t\t\t\t\tcurrent = encodeURIComponent(current);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tif (current[part.method]) {\r\n\t\t\t\t\t\t\tcurrent[part.method].apply(this, part.params);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Apply default format if it wasn't applied explicitly\r\n\t\tif (!formatApplied) {\r\n\r\n\t\t\tlet formatParts = [{\r\n\t\t\t\tmethod: \"\",\r\n\t\t\t\tparams: format\r\n\t\t\t}];\r\n\r\n\t\t\tif (!$type.hasValue(format)) {\r\n\r\n\t\t\t\t// Format is not set\r\n\t\t\t\t// Determine from the type of the value\r\n\t\t\t\tif ($type.isNumber(current)) {\r\n\t\t\t\t\tformatParts[0].method = \"formatNumber\";\r\n\t\t\t\t\tformatParts[0].params = \"\";\r\n\t\t\t\t}\r\n\t\t\t\telse if ($type.isDate(current)) {\r\n\t\t\t\t\tformatParts[0].method = \"formatDate\";\r\n\t\t\t\t\tformatParts[0].params = \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\r\n\t\t\t\t// Format set\r\n\t\t\t\t// Try to determine formatter based on the format\r\n\t\t\t\tlet formatterType: string = $utils.getFormat(format);\r\n\r\n\t\t\t\t// format\r\n\t\t\t\tif (formatterType === $strings.NUMBER) {\r\n\t\t\t\t\tformatParts[0].method = \"formatNumber\";\r\n\t\t\t\t}\r\n\t\t\t\telse if (formatterType === $strings.DATE) {\r\n\t\t\t\t\tformatParts[0].method = \"formatDate\";\r\n\t\t\t\t}\r\n\t\t\t\telse if (formatterType === $strings.DURATION) {\r\n\t\t\t\t\tformatParts[0].method = \"formatDuration\";\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Apply format\r\n\t\t\tif (formatParts[0].method) {\r\n\t\t\t\tcurrent = this.getTagValueFromObject(formatParts, current);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn current;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * A [[DataItem]] to use as element's data source.\r\n\t *\r\n\t * @todo Review type\r\n\t * @param dataItem  DataItem\r\n\t */\r\n\tpublic set dataItem(dataItem: this[\"_dataItem\"]) {\r\n\t\t//an not use this[\"_dataItem\"] here, as we return parent data item if this sprite doesn't have one.\r\n\t\t// @todo:think about it\r\n\t\tthis.setDataItem(dataItem);\r\n\t}\r\n\r\n\t/**\r\n\t * @return [[DataItem]]\r\n\t */\r\n\tpublic get dataItem(): this[\"_dataItem\"] {\r\n\t\tif (!this._dataItem) {\r\n\t\t\tif (this.virtualParent) {\r\n\t\t\t\treturn this.virtualParent.dataItem;\r\n\t\t\t}\r\n\t\t\tif (this._parent) {\r\n\t\t\t\treturn this._parent.dataItem;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._dataItem;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets currently used [[DataItem]].\r\n\t *\r\n\t * If the element has also `configField` set, it will also look for any\r\n\t * config in DataItem's data context to apply to this element.\r\n\t *\r\n\t * @param dataItem DataItem\r\n\t */\r\n\tprotected setDataItem(dataItem: DataItem) {\r\n\t\tif (this._dataItem != dataItem) {\r\n\t\t\tthis._dataItem = dataItem;\r\n\t\t\tif (dataItem) {\r\n\t\t\t\tif (this.configField) {\r\n\t\t\t\t\tlet dataContext: any = dataItem.dataContext;\r\n\t\t\t\t\tif (dataContext) {\r\n\t\t\t\t\t\tthis.config = dataContext[this.configField];\r\n\t\t\t\t\t\tif (!this.config && dataContext.dataContext) {\r\n\t\t\t\t\t\t\tthis.config = dataContext.dataContext[this.configField];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet dataContext = <any>dataItem.dataContext;\r\n\r\n\t\t\t\tif (dataContext) {\r\n\r\n\t\t\t\t\tlet dataContext2 = dataContext.dataContext;\r\n\r\n\t\t\t\t\t$object.each(this.propertyFields, (propertyName, fieldValue) => {\r\n\t\t\t\t\t\tif ($type.hasValue(dataContext[fieldValue])) {\r\n\t\t\t\t\t\t\tlet anyThis = <any>this;\r\n\t\t\t\t\t\t\tanyThis[propertyName] = dataContext[fieldValue];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tif (dataContext2) {\r\n\t\t\t\t\t\t\t\tlet value = dataContext2[fieldValue];\r\n\t\t\t\t\t\t\t\tif ($type.hasValue(value)) {\r\n\t\t\t\t\t\t\t\t\tlet anyThis = <any>this;\r\n\t\t\t\t\t\t\t\t\tanyThis[propertyName] = value;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * PROPERTY UTILITIES\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Returns element's property value.\r\n\t *\r\n\t * Will check if there are any bindings with [[DataItem]].\r\n\t *\r\n\t * Will also apply any adapters bound to `propertyName`.\r\n\t *\r\n\t * @param propertyName  Property name\r\n\t * @return Property value\r\n\t */\r\n\tpublic getPropertyValue<Key extends keyof this[\"_properties\"]>(propertyName: Key): this[\"_properties\"][Key] {\r\n\t\tlet propValue: this[\"_properties\"][Key] = this.properties[propertyName];\r\n\r\n\t\t// Apply adapter\r\n\t\tif (!this._isTemplate) {\r\n\t\t\tif (this._adapterO) {\r\n\t\t\t\tpropValue = this._adapterO.apply(propertyName, <any>propValue);\r\n\t\t\t}\r\n\r\n\t\t\tpropValue = globalAdapter.applyAll(this, propertyName, propValue);\r\n\t\t}\r\n\r\n\t\treturn propValue;\r\n\t}\r\n\r\n\r\n\tprotected setColorProperty<Key extends keyof this[\"properties\"]>(property: Key, value: $type.Optional<Color | Pattern | LinearGradient | RadialGradient>, invalidate?: boolean): boolean {\r\n\t\tlet currentValue = this.properties[property];\r\n\t\tif (value instanceof Color && currentValue instanceof Color && value.toString() == currentValue.toString()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this.setPropertyValue(property, value, invalidate);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tprotected setPercentProperty<Key extends keyof this[\"properties\"]>(property: Key, value: Percent | number, invalidate?: boolean, transform?: boolean, precision?: number, floor?: boolean): boolean {\r\n\t\tvalue = $type.toNumberOrPercent(value);\r\n\r\n\t\tif ($type.isNumber(value)) {\r\n\t\t\tif ($type.isNumber(precision)) {\r\n\t\t\t\tvalue = $math.round(value, precision, floor);\r\n\t\t\t}\r\n\r\n\t\t\treturn this.setPropertyValue(property, value, invalidate, transform);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet currentValue = this.properties[property];\r\n\r\n\t\t\tif (value instanceof Percent && currentValue instanceof Percent && value.value == currentValue.value) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn this.setPropertyValue(property, value, invalidate, transform);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Sets elements's property value. Will also propagate the same property value\r\n\t * on all element's clones.\r\n\t *\r\n\t * @param property    Property\r\n\t * @param value       Value\r\n\t * @param invalidate  Should the sprite be invalidated, cause it's re-rendering\r\n\t * @param transform   Re-apply positioning of the element\r\n\t * @return Did the value change? It will return `true` if the new value and the old value of the property are not the same\r\n\t * @todo Review propagation to clones. Right now we simply check if clone is disposed before setting the same property on it. It's better to remove from clone list altogether.\r\n\t */\r\n\tpublic setPropertyValue<Key extends keyof this[\"properties\"]>(property: Key, value: any, invalidate?: boolean, transform?: boolean): boolean {\r\n\t\tif (this.properties[property] !== value && !this.isDisposed()) {\r\n\t\t\tthis.properties[property] = value;\r\n\r\n\t\t\tif (this.events.isEnabled(\"propertychanged\")) {\r\n\r\n\t\t\t\tconst event: AMEvent<this, ISpriteEvents>[\"propertychanged\"] = {\r\n\t\t\t\t\ttype: \"propertychanged\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tproperty: <string>property\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"propertychanged\", event);\r\n\t\t\t}\r\n\r\n\t\t\tif (invalidate) {\r\n\t\t\t\tthis.invalidate();\r\n\t\t\t}\r\n\r\n\t\t\tif (transform) {\r\n\t\t\t\tthis.invalidatePosition();\r\n\t\t\t}\r\n\r\n\t\t\tif (this.applyOnClones) {\r\n\t\t\t\tconst clones = this.clones.values;\r\n\t\t\t\tconst length = clones.length;\r\n\r\n\t\t\t\tfor (let i = 0; i < length; ++i) {\r\n\t\t\t\t\tconst clone = clones[i];\r\n\r\n\t\t\t\t\tif (!clone.isDisposed()) {\r\n\t\t\t\t\t\t//(<Sprite>clone).setPropertyValue(<any>property, value, invalidate, transform);\r\n\t\t\t\t\t\t(<any>clone)[property] = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @todo Verify this\r\n\t */\r\n\tpublic bind<\r\n\t\tS extends { cloneId: string, events: EventDispatcher<{ propertychanged: { property: string } }> },\r\n\t\tFrom extends (keyof S & keyof this),\r\n\t\tTo extends keyof this\r\n\t>(\r\n\t\tproperty: To,\r\n\t\tsource: S,\r\n\t\tbindToProperty: From,\r\n\t\tmodifier?: (value: this[From]) => this[To]\r\n\t): void;\r\n\tpublic bind<\r\n\t\tS extends { cloneId: string, events: EventDispatcher<{ propertychanged: { property: string } }> },\r\n\t\tKey extends (keyof S & keyof this)\r\n\t>(\r\n\t\tproperty: Key,\r\n\t\tsource: S,\r\n\t\tmodifier?: (value: this[Key]) => this[Key]\r\n\t): void;\r\n\tpublic bind<\r\n\t\tS extends this & { cloneId: string, events: EventDispatcher<{ propertychanged: { property: string } }> },\r\n\t\tKey extends (keyof S & keyof this)\r\n\t>(\r\n\t\tproperty: Key,\r\n\t\tsource: S,\r\n\t\tbindToProperty: Key = property,\r\n\t\tmodifier?: (value: this[Key]) => this[Key]\r\n\t): void {\r\n\t\tif ($type.hasValue(this._bindings[<string>property])) {\r\n\t\t\tthis._bindings[<string>property].dispose();\r\n\t\t}\r\n\r\n\t\t// set current value\r\n\t\tthis[property] = source[bindToProperty];\r\n\r\n\t\t//source.addEventListener(AMEvent.PROPERTY_CHANGED, this.handleBindings, false, this);\r\n\t\tthis._bindings[<string>property] = source.events.on(\"propertychanged\", (event) => {\r\n\t\t\tif (event.property === bindToProperty) {\r\n\t\t\t\tlet value: this[Key] = source[bindToProperty];\r\n\r\n\t\t\t\tif (modifier) {\r\n\t\t\t\t\tvalue = modifier(value);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// TODO clonesById\r\n\t\t\t\tthis[property] = value;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Sets up and obeserver function to monitor changes in particular property\r\n\t * or properties.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param property  Element's property name\r\n\t * @param listener  Handler function\r\n\t * @param context   Context for handler function\r\n\t * @returns Event Disposer\r\n\t */\r\n\tpublic observe<C>(property: string | string[], listener: (this: C, event: AMEvent<this, ISpriteEvents>[\"propertychanged\"]) => void, context?: C, shouldClone?: boolean): IDisposer {\r\n\t\treturn new MultiDisposer($array.map($array.toArray(property), (prop) => {\r\n\t\t\treturn this.events.on(\"propertychanged\", (e) => {\r\n\t\t\t\tif (e.property === prop) {\r\n\t\t\t\t\tlistener.call(context, e);\r\n\t\t\t\t}\r\n\t\t\t}, context, shouldClone);\r\n\t\t}));\r\n\t}\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * ACCESSIBILITY-RELATED PROPERTIES\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Applies accessibility to the SVG element.\r\n\t *\r\n\t * Adds `<title>` and `<description>` elements as well as `aria-labelledby`\r\n\t * and `role` properties.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected applyAccessibility(): void {\r\n\r\n\t\t// Check if we need to add label and description\r\n\t\tlet title = this.readerTitle,\r\n\t\t\tdescription = this.readerDescription,\r\n\t\t\trole = this.role,\r\n\t\t\thidden = this.readerHidden,\r\n\t\t\tchecked = this.readerChecked,\r\n\t\t\tcontrols = this.readerControls,\r\n\t\t\tlive = this.readerLive,\r\n\t\t\torientation = this.readerOrientation,\r\n\t\t\tvalueNow = this.readerValueNow,\r\n\t\t\tvalueText = this.readerValueText;\r\n\r\n\t\t// Init label/describe ids\r\n\t\tlet labelledByIds: string[] = [];\r\n\t\tlet describedByIds: string[] = [];\r\n\r\n\t\tlet labelledBy: string = this.readerLabelledBy;\r\n\t\tif (labelledBy) {\r\n\t\t\tlabelledByIds.push(labelledBy);\r\n\t\t}\r\n\r\n\t\tlet describedBy: string = this.readerDescribedBy;\r\n\t\tif (describedBy) {\r\n\t\t\tdescribedByIds.push(describedBy);\r\n\t\t}\r\n\r\n\t\t// Add arial-label attribute if present\r\n\t\t// If not readerTitle and labelledBy is set we will use <title> element\r\n\t\t// instead of aria-label\r\n\t\t// TODO: should we check agains this.showSystemTooltip?\r\n\t\tif (title) {\r\n\r\n\t\t\tif (labelledByIds.length || this.showSystemTooltip) {\r\n\r\n\t\t\t\tconst titleElement = this.titleElement;\r\n\t\t\t\tconst titleId = this.uid + \"-title\";\r\n\t\t\t\tif (titleElement.node.textContent != title) {\r\n\t\t\t\t\ttitleElement.node.textContent = title;\r\n\t\t\t\t\ttitleElement.attr({ id: titleId });\r\n\t\t\t\t}\r\n\t\t\t\tlabelledByIds.push(titleId);\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\r\n\t\t\t\tif (this._titleElement) {\r\n\t\t\t\t\tthis.group.removeElement(this._titleElement);\r\n\t\t\t\t\tthis._titleElement = undefined;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.setSVGAttribute({\r\n\t\t\t\t\t\"aria-label\": title\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.removeSVGAttribute(\"aria-label\");\r\n\t\t\tif (this._titleElement) {\r\n\t\t\t\tthis.group.removeElement(this._titleElement);\r\n\t\t\t\tthis._titleElement = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\t// Add description\r\n\t\tif (description) {\r\n\r\n\t\t\tconst descriptionElement = this.descriptionElement;\r\n\t\t\tconst descriptionId = this.uid + \"-description\";\r\n\t\t\tif (descriptionElement.node.textContent != description) {\r\n\t\t\t\tdescriptionElement.node.textContent = description;\r\n\t\t\t\tdescriptionElement.attr({ id: descriptionId });\r\n\t\t\t}\r\n\t\t\tdescribedByIds.push(descriptionId);\r\n\r\n\t\t}\r\n\t\telse if (this._descriptionElement) {\r\n\t\t\tthis.group.removeElement(this._descriptionElement);\r\n\t\t\tthis._descriptionElement = undefined;\r\n\t\t}\r\n\r\n\r\n\t\t// Add label and described properties\r\n\t\tif (labelledByIds.length) {\r\n\t\t\tthis.setSVGAttribute({ \"aria-labelledby\": labelledByIds.join(\" \") });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.removeSVGAttribute(\"aria-labelledby\");\r\n\t\t}\r\n\r\n\t\tif (describedByIds.length) {\r\n\t\t\tthis.setSVGAttribute({ \"aria-describedby\": describedByIds.join(\" \") });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.removeSVGAttribute(\"aria-describedby\");\r\n\t\t}\r\n\r\n\t\t// Apply role\r\n\t\tif (role) {\r\n\t\t\tthis.setSVGAttribute({ \"role\": role });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.removeSVGAttribute(\"role\");\r\n\t\t}\r\n\r\n\t\t// Apply aria-hidden\r\n\t\tif (hidden) {\r\n\t\t\tthis.setSVGAttribute({ \"aria-hidden\": \"true\" });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.removeSVGAttribute(\"aria-hidden\");\r\n\t\t}\r\n\r\n\t\t// Apply aria-checked\r\n\t\tif (checked) {\r\n\t\t\tthis.setSVGAttribute({ \"aria-checked\": \"true\" });\r\n\t\t}\r\n\t\telse if (checked === false) {\r\n\t\t\tthis.setSVGAttribute({ \"aria-checked\": \"false\" });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.removeSVGAttribute(\"aria-checked\");\r\n\t\t}\r\n\r\n\t\t// Apply aria-controls\r\n\t\tif (controls) {\r\n\t\t\tthis.setSVGAttribute({ \"aria-controls\": controls });\r\n\t\t} else {\r\n\t\t\tthis.removeSVGAttribute(\"aria-controls\");\r\n\t\t}\r\n\r\n\t\t// Apply aria-live\r\n\t\tif (live) {\r\n\t\t\tthis.setSVGAttribute({ \"aria-live\": live });\r\n\t\t} else {\r\n\t\t\tthis.removeSVGAttribute(\"aria-live\");\r\n\t\t}\r\n\r\n\t\t// Apply aria-orientation\r\n\t\tif (orientation) {\r\n\t\t\tthis.setSVGAttribute({ \"aria-orientation\": orientation });\r\n\t\t} else {\r\n\t\t\tthis.removeSVGAttribute(\"aria-orientation\");\r\n\t\t}\r\n\r\n\t\t// Apply aria-valuenow\r\n\t\tif (valueNow) {\r\n\t\t\tthis.setSVGAttribute({ \"aria-valuenow\": valueNow });\r\n\t\t} else {\r\n\t\t\tthis.removeSVGAttribute(\"aria-valuenow\");\r\n\t\t}\r\n\r\n\t\t// Apply aria-valuetext\r\n\t\tif (valueText) {\r\n\t\t\tthis.setSVGAttribute({ \"aria-valuetext\": valueText });\r\n\t\t} else {\r\n\t\t\tthis.removeSVGAttribute(\"aria-valuetext\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Screen reader title of the element.\r\n\t *\r\n\t * @param value Title\r\n\t */\r\n\tpublic set readerTitle(value: string) {\r\n\t\tvalue = $type.toText(value);\r\n\t\tif (this.setPropertyValue(\"readerTitle\", value)) {\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Title\r\n\t */\r\n\tpublic get readerTitle(): string {\r\n\t\tconst title = this.getPropertyValue(\"readerTitle\");\r\n\t\tif ($type.hasValue(title) && this.dataItem) {\r\n\t\t\treturn this.populateString(title);\r\n\t\t}\r\n\t\treturn title;\r\n\t}\r\n\r\n\t/**\r\n\t * Screen reader description of the element.\r\n\t *\r\n\t * @param value Description\r\n\t */\r\n\tpublic set readerDescription(value: string) {\r\n\t\tvalue = $type.toText(value);\r\n\t\tif (this.setPropertyValue(\"readerDescription\", value)) {\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Description\r\n\t */\r\n\tpublic get readerDescription(): string {\r\n\t\tconst description = this.getPropertyValue(\"readerDescription\");\r\n\t\tif ($type.hasValue(description) && this.dataItem) {\r\n\t\t\treturn this.populateString(description);\r\n\t\t}\r\n\t\treturn this.getPropertyValue(\"readerDescription\");\r\n\t}\r\n\r\n\t/**\r\n\t * A WAI-ARIA role for the element.\r\n\t *\r\n\t * @see {@link https://www.w3.org/TR/wai-aria-1.1/#role_definitions} for more information on WAI-ARIA roles\r\n\t * @param value  Role\r\n\t */\r\n\tpublic set role(value: Roles) {\r\n\t\tvalue = <Roles>$type.toText(value);\r\n\t\tif (this.setPropertyValue(\"role\", value)) {\r\n\t\t\tthis.applyAccessibility();\r\n\r\n\t\t\tif (value == \"slider\") {\r\n\t\t\t\tthis.setSVGAttribute({ \"aria-valuemin\": \"0\" });\r\n\t\t\t\tthis.setSVGAttribute({ \"aria-valuemax\": \"100\" });\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Role\r\n\t */\r\n\tpublic get role(): Roles {\r\n\t\treturn this.getPropertyValue(\"role\");\r\n\t}\r\n\r\n\t/**\r\n\t * Controls if element should be hidden from screen readers.\r\n\t *\r\n\t * @see {@link https://www.w3.org/TR/wai-aria-1.1/#aria-hidden} for more information\r\n\t * @param value  Hidden?\r\n\t */\r\n\tpublic set readerHidden(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.setPropertyValue(\"readerHidden\", value)) {\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Hidden?\r\n\t */\r\n\tpublic get readerHidden(): boolean {\r\n\t\treturn this.getPropertyValue(\"readerHidden\");\r\n\t}\r\n\r\n\t/**\r\n\t * Controls if element is currently marked as \"checked\".\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @see {@link https://www.w3.org/TR/wai-aria-1.1/#aria-checked} for more information\r\n\t * @param value Checked?\r\n\t */\r\n\tpublic set readerChecked(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.setPropertyValue(\"readerChecked\", value)) {\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Checked?\r\n\t */\r\n\tpublic get readerChecked(): boolean {\r\n\t\treturn this.getPropertyValue(\"readerChecked\");\r\n\t}\r\n\r\n\t/**\r\n\t * A `uid` of an element this element controls.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @see {@link https://www.w3.org/TR/wai-aria-1.1/#aria-controls} for more information\r\n\t * @param value Setting value\r\n\t */\r\n\tpublic set readerControls(value: string) {\r\n\t\tvalue = $type.toText(value);\r\n\t\tif (this.setPropertyValue(\"readerControls\", value)) {\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Setting value\r\n\t */\r\n\tpublic get readerControls(): string {\r\n\t\treturn this.getPropertyValue(\"readerControls\");\r\n\t}\r\n\r\n\t/**\r\n\t * Controls accessibility setting \"aria-live\" for the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @see {@link https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Live_Regions} for more information\r\n\t * @param value Setting value\r\n\t */\r\n\tpublic set readerLive(value: AriaLive) {\r\n\t\tvalue = <AriaLive>$type.toText(value);\r\n\t\tif (this.setPropertyValue(\"readerLive\", value)) {\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Setting value\r\n\t */\r\n\tpublic get readerLive(): AriaLive {\r\n\t\treturn this.getPropertyValue(\"readerLive\");\r\n\t}\r\n\r\n\t/**\r\n\t * A `uid` of an element that describes this element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @see {@link https://www.w3.org/TR/wai-aria-1.1/#aria-labelledby} for more information\r\n\t * @param value Target element\r\n\t */\r\n\tpublic set readerLabelledBy(value: string) {\r\n\t\tvalue = $type.toText(value);\r\n\t\tif (this.setPropertyValue(\"readerLabelledBy\", value)) {\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Target element\r\n\t */\r\n\tpublic get readerLabelledBy(): string {\r\n\t\treturn this.getPropertyValue(\"readerLabelledBy\");\r\n\t}\r\n\r\n\t/**\r\n\t * A `uid` of an element that describes this element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @see {@link https://www.w3.org/TR/wai-aria-1.1/#aria-describedby} for more information\r\n\t * @param value Target element\r\n\t */\r\n\tpublic set readerDescribedBy(value: string) {\r\n\t\tvalue = $type.toText(value);\r\n\t\tif (this.setPropertyValue(\"readerDescribedBy\", value)) {\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Target element\r\n\t */\r\n\tpublic get readerDescribedBy(): string {\r\n\t\treturn this.getPropertyValue(\"readerDescribedBy\");\r\n\t}\r\n\r\n\t/**\r\n\t * Orientation of the element.\r\n\t *\r\n\t * @since 4.7.16\r\n\t * @param value Orientation\r\n\t */\r\n\tpublic set readerOrientation(value: string) {\r\n\t\tvalue = $type.toText(value);\r\n\t\tif (this.setPropertyValue(\"readerOrientation\", value)) {\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Orientation\r\n\t */\r\n\tpublic get readerOrientation(): string {\r\n\t\treturn this.getPropertyValue(\"readerOrientation\");\r\n\t}\r\n\r\n\t/**\r\n\t * Current value of the element.\r\n\t *\r\n\t * @since 4.7.16\r\n\t * @param value Current value\r\n\t */\r\n\tpublic set readerValueNow(value: string) {\r\n\t\tvalue = $type.toText(value);\r\n\t\tif (this.setPropertyValue(\"readerValueNow\", value)) {\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Current value\r\n\t */\r\n\tpublic get readerValueNow(): string {\r\n\t\treturn this.getPropertyValue(\"readerValueNow\");\r\n\t}\r\n\r\n\t/**\r\n\t * Text representation of the current value of the element.\r\n\t *\r\n\t * @since 4.7.16\r\n\t * @param value Current value (text)\r\n\t */\r\n\tpublic set readerValueText(value: string) {\r\n\t\tvalue = $type.toText(value);\r\n\t\tif (this.setPropertyValue(\"readerValueText\", value)) {\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Current value (text)\r\n\t */\r\n\tpublic get readerValueText(): string {\r\n\t\treturn this.getPropertyValue(\"readerValueText\");\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * USER INTERACTIONS\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Returns elements keyboard options.\r\n\t *\r\n\t * @return Keyboard options\r\n\t */\r\n\tpublic get keyboardOptions(): IKeyboardOptions {\r\n\t\tif (!this.interactions.keyboardOptions) {\r\n\t\t\tif (this.virtualParent) {\r\n\t\t\t\treturn this.virtualParent.keyboardOptions;\r\n\t\t\t}\r\n\t\t\tif (this._parent) {\r\n\t\t\t\treturn this._parent.keyboardOptions;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.interactions.keyboardOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * Mouse options.\r\n\t *\r\n\t * Enables controlling options related to the mouse, for example sensitivity\r\n\t * of its mouse wheel.\r\n\t *\r\n\t * E.g. the below will reduce chart's wheel-zoom speed to half its default\r\n\t * speed:\r\n\t *\r\n\t * ```TypeScript\r\n\t * chart.plotContainer.mouseOptions.sensitivity = 0.5;\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * chart.plotContainer.mouseOptions.sensitivity = 0.5;\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"plotContainer\": {\r\n\t *     \"mouseOptions\": {\r\n\t *       \"sensitivity\": 0.5\r\n\t *     }\r\n\t *   }\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @return Mouse options\r\n\t */\r\n\tpublic get mouseOptions(): IMouseOptions {\r\n\t\tif (!this.interactions.mouseOptions) {\r\n\t\t\tif (this.virtualParent) {\r\n\t\t\t\treturn this.virtualParent.mouseOptions;\r\n\t\t\t}\r\n\t\t\tif (this._parent) {\r\n\t\t\t\treturn this._parent.mouseOptions;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.interactions.mouseOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns (creates if necessary) an [[InteractionObject]] associated with\r\n\t * this element.\r\n\t *\r\n\t * [[InteractionObject]] is used to attach all kinds of user-interactions to\r\n\t * the element, e.g. click/touch, dragging, hovering, and similar events.\r\n\t *\r\n\t * @return Interaction object\r\n\t */\r\n\tpublic get interactions(): InteractionObject {\r\n\t\tif (!this._interaction) {\r\n\t\t\tconst interaction = getInteraction().getInteraction(this.dom);\r\n\t\t\tthis._interaction = interaction;\r\n\t\t\tthis._interaction.clickable = this.clickable;\r\n\t\t\tthis._interaction.hoverable = this.hoverable;\r\n\t\t\tthis._interaction.trackable = this.trackable;\r\n\t\t\tthis._interaction.draggable = this.draggable;\r\n\t\t\tthis._interaction.swipeable = this.swipeable;\r\n\t\t\tthis._interaction.resizable = this.resizable;\r\n\t\t\tthis._interaction.wheelable = this.wheelable;\r\n\t\t\tthis._interaction.contextMenuDisabled = this.contextMenuDisabled;\r\n\t\t\tthis._interaction.inert = this.inert;\r\n\t\t\tthis._interaction.sprite = this;\r\n\t\t\tthis._disposers.push(this._interaction);\r\n\t\t}\r\n\t\treturn this._interaction;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns true if interactions object was created. Mostly used just to avoid creating interactions object if not needed.\r\n\t * @return Is Sprite interactive?\r\n\t */\r\n\tpublic isInteractive(): boolean {\r\n\t\tif (this._interaction) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * ELEMENT FOCUS-RELATED STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Controls if the element can gain focus.\r\n\t *\r\n\t * Focusable element will be selectable via TAB key.\r\n\t *\r\n\t * Please note, clicking it with a mouse or touching will not add focus to\r\n\t * it.\r\n\t *\r\n\t * Focused element will show a system-specific highlight, which might ruin\r\n\t * the overal look. This is why we don't focus element on click/touch.\r\n\t *\r\n\t * A default setting varies for different elements. By default all elements\r\n\t * are not focusable, except certain items like buttons, legend items, etc.\r\n\t *\r\n\t * @default undefined (auto)\r\n\t * @param value  Can element be focused?\r\n\t */\r\n\tpublic set focusable(value: Optional<boolean>) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.setPropertyValue(\"focusable\", value)) {\r\n\t\t\tif (!value && !this.isInteractive()) {\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.interactions.focusable = value;\r\n\t\t\t\tif (value) {\r\n\t\t\t\t\tthis.setSVGAttribute({ \"focusable\": value });\r\n\t\t\t\t\tif (!this._tabindex) {\r\n\t\t\t\t\t\tthis.tabindex = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.removeSVGAttribute(\"focusable\");\r\n\t\t\t\t\tthis.tabindex = undefined;\r\n\t\t\t\t}\r\n\t\t\t\t// Set focus events that would apply \"focus\" state\r\n\t\t\t\t// setEventDisposer will also remove listeners if value == false\r\n\t\t\t\tthis.interactions.setEventDisposer(\"sprite-focusable\", value, () => new MultiDisposer([\r\n\t\t\t\t\tthis.events.on(\"blur\", this.handleBlur, this, false),\r\n\t\t\t\t\tthis.events.on(\"focus\", this.handleFocus, this, false)\r\n\t\t\t\t]));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Can element be focused?\r\n\t */\r\n\tpublic get focusable(): Optional<boolean> {\r\n\t\treturn this.getPropertyValue(\"focusable\");\r\n\t}\r\n\r\n\t/**\r\n\t * Applies filters (if set) when element gains focus.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Original event\r\n\t */\r\n\tpublic handleFocus(ev?: AMEvent<Sprite, ISpriteEvents>[\"focus\"]): void {\r\n\t\tif (this.focusable) {\r\n\t\t\tif (this.topParent) {\r\n\t\t\t\tthis.topParent.hasFocused = true;\r\n\t\t\t\tthis.topParent.focusedElement = this;\r\n\t\t\t}\r\n\t\t\tif (this.focusFilter) {\r\n\t\t\t\t// Any `filters` manipulation will trigger `applyFilters()` so we don't\r\n\t\t\t\t// need to call it here\r\n\t\t\t\tthis.filters.push(this.focusFilter);\r\n\t\t\t}\r\n\t\t\tif (this.hoverOnFocus) {\r\n\t\t\t\t// Trigger a hover event as well\r\n\t\t\t\tthis.isHover = true;\r\n\t\t\t\tthis.handleOver();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes focus filter (if set) when elementloses focus.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Original event\r\n\t */\r\n\tpublic handleBlur(ev?: AMEvent<Sprite, ISpriteEvents>[\"blur\"]): void {\r\n\t\tif (this.focusable) {\r\n\t\t\tif (this.topParent) {\r\n\t\t\t\tthis.topParent.hasFocused = false;\r\n\t\t\t\tthis.topParent.focusedElement = undefined;\r\n\t\t\t}\r\n\t\t\tif (this.focusFilter) {\r\n\t\t\t\t// Any `filters` manipulation will trigger `applyFilters()` so we don't\r\n\t\t\t\t// need to call it here\r\n\t\t\t\tthis.filters.removeValue(this.focusFilter);\r\n\t\t\t}\r\n\t\t\tif (this.hoverOnFocus) {\r\n\t\t\t\t// Trigger a out event as well\r\n\t\t\t\tthis.isHover = false;\r\n\t\t\t\tthis.handleOut();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A reference to a [[Filter]] to apply to element when it gains focus.\r\n\t *\r\n\t * Normally, browsers will draw a default ugly square around focused element,\r\n\t * which totally makes sense because its purpose is to help identify active\r\n\t * element for visually impaired people.\r\n\t *\r\n\t * However, if you would rather apply a filter, so you can modify how focused\r\n\t * element looks like, use `focusFilter`.\r\n\t *\r\n\t * Simply set it to an anstance of [[FocusFilter]], or any other filter\r\n\t * object.\r\n\t *\r\n\t * ```TypeScript\r\n\t * chart.focusFilter = new am4core.FocusFilter();\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * chart.focusFilter = new am4core.FocusFilter();\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"focusFilter\": {\r\n\t *     \"type\": \"FocusFilter\"\r\n\t *   },\r\n\t *   // ...\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @see {@link Filter}\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/accessibility/} more about accessibility\r\n\t * @see {@link https://www.amcharts.com/docs/v4/tutorials/changing-appearance-of-focused-items/} cusomizing focus appearance\r\n\t * @ignore Exclude from docs\r\n\t * @return Focused element filter\r\n\t */\r\n\tpublic get focusFilter(): $type.Optional<Filter> {\r\n\t\t/*if (!this._focusFilter) {\r\n\t\t\tthis._focusFilter = new FocusFilter();\r\n\t\t\tthis._disposers.push(this._focusFilter);\r\n\t\t}*/\r\n\t\t//return this._focusFilter;\r\n\r\n\t\tconst focusFilter = this._focusFilter;\r\n\r\n\t\tif (focusFilter) {\r\n\t\t\treturn focusFilter;\r\n\t\t}\r\n\t\tif (this.virtualParent) {\r\n\t\t\treturn this.virtualParent.focusFilter;\r\n\t\t}\r\n\t\telse if (this._parent) {\r\n\t\t\treturn this._parent.focusFilter;\r\n\t\t}\r\n\r\n\t\t//this._focusFilter = new FocusFilter();\r\n\t\t//this._disposers.push(this._focusFilter);\r\n\t}\r\n\r\n\t/**\r\n\t * @see {@link Filter}\r\n\t * @ignore Exclude from docs\r\n\t * @todo This is still experimental, don't use it\r\n\t */\r\n\tpublic set focusFilter(value: $type.Optional<Filter>) {\r\n\t\tthis._focusFilter = value;\r\n\t}\r\n\r\n\t/**\r\n\t * If set to `true`, this element will also trigger `\"over\"` event with all\r\n\t * the related consequences, like \"hover\" state being applied and tooltip\r\n\t * being shown.\r\n\t *\r\n\t * Useful as an accessibility feature to display rollover tooltips on items\r\n\t * selected via keyboard.\r\n\t *\r\n\t * @param value  Trigger hover on focus?\r\n\t * @default false\r\n\t */\r\n\tpublic set hoverOnFocus(value: boolean) {\r\n\t\tif (value !== this.hoverOnFocus) {\r\n\t\t\tthis.setPropertyValue(\"hoverOnFocus\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Trigger hover on focus?\r\n\t */\r\n\tpublic get hoverOnFocus(): boolean {\r\n\t\treturn this.getPropertyValue(\"hoverOnFocus\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets or returns TAB index.\r\n\t *\r\n\t * Tab index maintains the order in which focusable elements gain focus when\r\n\t * TAB key is pressed.\r\n\t *\r\n\t * Please note, tab index is not local to the chart. It affects the whole\r\n\t * of the page, including non-SVG elements. Maintain extreme causion when\r\n\t * setting tab indexes, as it affects the user experience for the whole\r\n\t * web page.\r\n\t *\r\n\t * @param value TAB index\r\n\t */\r\n\tpublic set tabindex(value: number) {\r\n\t\tvalue = $type.toNumber(value);\r\n\t\tif (this.setPropertyValue(\"tabindex\", value) && $type.isNumber(value)) {\r\n\t\t\tthis.interactions.tabindex = value;\r\n\t\t\tthis.setSVGAttribute({ \"tabindex\": value });\r\n\t\t\tthis._tabindex = value;\r\n\t\t\tif (value > -1) {\r\n\t\t\t\tthis.focusable = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.focusable = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return TAB index\r\n\t */\r\n\tpublic get tabindex(): $type.Optional<number> {\r\n\t\tconst index = this._tabindex;\r\n\r\n\t\tif (index != null) {\r\n\t\t\treturn index;\r\n\t\t}\r\n\t\telse if (this.virtualParent) {\r\n\t\t\treturn this.virtualParent.tabindex;\r\n\t\t}\r\n\t\telse if (this._parent) {\r\n\t\t\treturn this._parent.tabindex;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * DRAGGING AND RELATED STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Returns element's options to be used for inertia. This setting is\r\n\t * inheritable, meaning that if not set directly, it will search in all its\r\n\t * ascendants until very top.\r\n\t *\r\n\t * Inertia is used only if element's `inert` is set to `true`.\r\n\t *\r\n\t * \"Inert\" element, when dragged and released, will carry the momentum of the\r\n\t * movement, and will continue moving in the same drag direction, gradually\r\n\t * reducing in speed until finally stops.\r\n\t *\r\n\t * Check [[IInertiaOptions]] for how you tweak inertia animations.\r\n\t *\r\n\t * @return Inertia options\r\n\t */\r\n\tpublic get inertiaOptions(): Dictionary<InertiaTypes, IInertiaOptions> {\r\n\t\tif (!this.interactions.inertiaOptions) {\r\n\t\t\tif (this._parent) {\r\n\t\t\t\treturn this._parent.inertiaOptions;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.interactions.inertiaOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * Controls if the element is draggable.\r\n\t *\r\n\t * @param value  `true` if element can be dragged\r\n\t */\r\n\tpublic set draggable(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.setPropertyValue(\"draggable\", value)) {\r\n\r\n\t\t\tif (!value && !this.isInteractive()) {\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.applyCursorStyle();\r\n\t\t\t\tthis.interactions.draggable = value;\r\n\t\t\t\t//interaction.processDraggable(this);\r\n\r\n\t\t\t\t// Add events\r\n\t\t\t\t// @todo Maybe attach to InteractionObject's multidisposer so that\r\n\t\t\t\t// sprites events get disposed together with them?\r\n\t\t\t\t// this.interactions.disposers.getItem(\"movable\")\r\n\t\t\t\t// setEventDisposer will also remove listeners if value == false\r\n\t\t\t\tthis.interactions.setEventDisposer(\"sprite-draggable\", value, () => new MultiDisposer([\r\n\t\t\t\t\tthis.events.on(\"down\", this.handleDown, this, false),\r\n\t\t\t\t\tthis.events.on(\"dragstart\", this.handleDragStart, this, false),\r\n\t\t\t\t\tthis.events.on(\"drag\", this.handleDragMove, this, false),\r\n\t\t\t\t\tthis.events.on(\"dragstop\", this.handleDragStop, this, false)\r\n\t\t\t\t]));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return `true` if element can be dragged\r\n\t */\r\n\tpublic get draggable(): boolean {\r\n\t\treturn this.getPropertyValue(\"draggable\");\r\n\t}\r\n\r\n\t/**\r\n\t * Executes when dragged element is being started to drag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected handleDragStart(ev: AMEvent<Sprite, ISpriteEvents>[\"dragstart\"]): void {\r\n\t\tif (!this.interactions.isTouchProtected || !ev.touch) {\r\n\t\t\tthis.interactions.originalPosition = {\r\n\t\t\t\tx: this.pixelX,\r\n\t\t\t\ty: this.pixelY\r\n\t\t\t};\r\n\t\t\tthis._isDragged = true;\r\n\t\t\tthis.hideTooltip(0);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Tell this element to start being dragged. This is useful if you want to\r\n\t * drag items by interactions performed not directly on the target element.\r\n\t *\r\n\t * Parameter `pointer` is highly recommended. By passing in the Pointer you\r\n\t * will ensure that movement is tracked for the pointer that you want. If not\r\n\t * supplied, the system will try to determine the most logical pointer.\r\n\t *\r\n\t * However this may fail if you have more than one pointer active, which\r\n\t * might happen if you have several objects being dragged on a touch device.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param pointer Pointer to use for movement\r\n\t */\r\n\tpublic dragStart(pointer?: IPointer): void {\r\n\t\t//this.dragStop(pointer);\r\n\t\t//this.draggable = true;\r\n\t\tthis._isDragged = true;\r\n\t\tgetInteraction().dragStart(this.interactions, pointer);\r\n\t}\r\n\r\n\t/**\r\n\t * Executes when dragged element is being dropped.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected handleDragStop(ev: AMEvent<Sprite, ISpriteEvents>[\"dragstop\"]): void {\r\n\t\tif (!this.interactions.isTouchProtected || !ev.touch) {\r\n\t\t\tthis._isDragged = false;\r\n\t\t\tthis.showTooltip();\r\n\t\t\tthis.interactions.originalPosition = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Stops manually initiated dragging of the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param pointer Pointer to use as a reference\r\n\t */\r\n\tpublic dragStop(pointer?: IPointer, cancelled?: boolean): void {\r\n\t\t//this.draggable = false;\r\n\t\tthis._isDragged = false;\r\n\t\tgetInteraction().dragStop(this.interactions, pointer, cancelled);\r\n\t\t//this.handleDragStop();\r\n\t}\r\n\r\n\t/**\r\n\t * Executes when {Sprite} is being dragged.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Event object\r\n\t * @todo Implement parent position offset calculation\r\n\t */\r\n\tpublic handleDragMove(ev: AMEvent<Sprite, ISpriteEvents>[\"drag\"]): void {\r\n\t\tif (!this.interactions.isTouchProtected || !ev.touch) {\r\n\t\t\tlet point: Optional<IPoint> = this.interactions.originalPosition;\r\n\r\n\t\t\tif (point && this._isDragged) {\r\n\t\t\t\tlet globalScale = this._parent.globalScale * this.svgContainer.cssScale;\r\n\t\t\t\tthis.moveTo({ x: point.x + ev.shift.x / globalScale, y: point.y + ev.shift.y / globalScale }, undefined, undefined, true);\r\n\t\t\t}\r\n\r\n\t\t\tthis.dispatchImmediately(\"dragged\", ev);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Controls if the element should use inertia when interacted with.\r\n\t *\r\n\t * \"Inert\" element, when dragged and released, will carry the momentum of the\r\n\t * movement, and will continue moving in the same drag direction, gradually\r\n\t * reducing in speed until finally stops.\r\n\t *\r\n\t * @default false\r\n\t * @param value `true` if element should use inertia when animated\r\n\t */\r\n\tpublic set inert(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.setPropertyValue(\"inert\", value)) {\r\n\t\t\tif (!value && !this.isInteractive()) {\r\n\t\t\t\t// void\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.interactions.inert = value;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return `true` if element should use inertia when animated\r\n\t */\r\n\tpublic get inert(): boolean {\r\n\t\treturn this.getPropertyValue(\"inert\");\r\n\t}\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * HOVERING\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Returns Sprite's hover options.\r\n\t *\r\n\t * @see {@link IHoverOptions} for available options.\r\n\t * @return Options\r\n\t */\r\n\tpublic get hoverOptions(): IHoverOptions {\r\n\t\tif (!this.interactions.hoverOptions) {\r\n\t\t\tif (this.virtualParent) {\r\n\t\t\t\treturn this.virtualParent.hoverOptions;\r\n\t\t\t}\r\n\t\t\tif (this._parent) {\r\n\t\t\t\treturn this._parent.hoverOptions;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.interactions.hoverOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * Controls if the element is hoverable (hover events are registered).\r\n\t *\r\n\t * Use `over` and `out` events, to watch for those respective actions.\r\n\t *\r\n\t * @default false\r\n\t * @param value `true` if element can be hovered\r\n\t */\r\n\tpublic set hoverable(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.setPropertyValue(\"hoverable\", value)) {\r\n\t\t\tif (!value && !this.isInteractive()) {\r\n\t\t\t\t// void\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.applyCursorStyle();\r\n\t\t\t\tthis.interactions.hoverable = value;\r\n\r\n\t\t\t\t// setEventDisposer will also remove listeners if value == false\r\n\t\t\t\tthis.interactions.setEventDisposer(\"sprite-hoverable\", value, () => new MultiDisposer([\r\n\t\t\t\t\tthis.events.on(\"over\", this.handleOver, this, false),\r\n\t\t\t\t\tthis.events.on(\"out\", this.handleOut, this, false),\r\n\t\t\t\t]));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return `true` if element is hoverable\r\n\t */\r\n\tpublic get hoverable(): boolean {\r\n\t\treturn this.getPropertyValue(\"hoverable\");\r\n\t}\r\n\r\n\t/**\r\n\t * Handles tasks when element becomes hovered:\r\n\t * * Shows [[Tooltip]] if applicable\r\n\t * * Applies \"hover\" state\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Event object\r\n\t */\r\n\tpublic handleOver(ev?: AMEvent<Sprite, ISpriteEvents>[\"over\"]): void {\r\n\t\tif (this._outTimeout) {\r\n\t\t\tthis._outTimeout.dispose();\r\n\t\t}\r\n\t\tif (this.isHover) {\r\n\r\n\t\t\tif (this.states.hasKey(\"hover\")) {\r\n\t\t\t\t//this.setState(\"hover\");\r\n\t\t\t\t// This will check `isHover` and will set \"hover\" state\r\n\t\t\t\tif (!this.isHidden) {\r\n\t\t\t\t\tthis.applyCurrentState();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet point: IPoint\r\n\t\t\tif (ev && ev.pointer) {\r\n\t\t\t\tpoint = $utils.documentPointToSvg(ev.pointer.point, this.svgContainer.SVGContainer, this.svgContainer.cssScale)\r\n\t\t\t}\r\n\r\n\t\t\tif (this.showTooltipOn == \"hover\") {\r\n\t\t\t\tthis.showTooltip(point);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (this.showTooltipOn == \"hover\") {\r\n\t\t\t\tthis.hideTooltip();\r\n\t\t\t}\r\n\t\t\tif (!this.isHidden && this.states.hasKey(\"hover\")) {\r\n\t\t\t\tthis.applyCurrentState();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles tasks when element loses hover:\r\n\t *\r\n\t * * Hides [[Tooltip]]\r\n\t * * Applies default state\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev [description]\r\n\t */\r\n\tpublic handleOut(ev?: AMEvent<Sprite, ISpriteEvents>[\"out\"]): void {\r\n\t\tif (this.tooltip && this.tooltip.targetSprite == this && this.tooltip.keepTargetHover) {\r\n\t\t\tthis._outTimeout = this.setTimeout(() => {\r\n\t\t\t\tif (!this.tooltip.isHover) {\r\n\t\t\t\t\tif (this.tooltip.targetSprite == this) {\r\n\t\t\t\t\t\tthis.hideTooltip();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._outTimeout = this.setTimeout(this.handleOutReal.bind(this), this.rollOutDelay);\r\n\t\t\t\t}\r\n\t\t\t}, 10);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.showTooltipOn == \"hover\") {\r\n\t\t\tthis.hideTooltip();\r\n\t\t}\r\n\t\tthis._outTimeout = this.setTimeout(this.handleOutReal.bind(this), this.rollOutDelay);\r\n\t}\r\n\r\n\t/**\r\n\t * [handleOutReal description]\r\n\t *\r\n\t * @ignore\r\n\t * @todo description\r\n\t */\r\n\tpublic handleOutReal() {\r\n\t\tif (!this.isHidden && !this.isHiding && this.states.hasKey(\"hover\")) {\r\n\t\t\tthis.applyCurrentState();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * CLICKING/TAPPING AND TOGGLING STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Returns Sprite's click (hit) options.\r\n\t *\r\n\t * Click (hit) options control things like double-click, timeouts, etc.\r\n\t *\r\n\t * @see {@link IHitOptions} for available options.\r\n\t * @return Options\r\n\t */\r\n\tpublic get hitOptions(): IHitOptions {\r\n\t\tif (!this.interactions.hitOptions) {\r\n\t\t\tif (this.virtualParent) {\r\n\t\t\t\treturn this.virtualParent.hitOptions;\r\n\t\t\t}\r\n\t\t\tif (this._parent) {\r\n\t\t\t\treturn this._parent.hitOptions;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.interactions.hitOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * Prepares element's after `down` event.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Event\r\n\t */\r\n\tpublic handleDown(ev?: AMEvent<Sprite, ISpriteEvents>[\"down\"]): void {\r\n\t\tif (this.interactions.downPointers.length === 1) {\r\n\t\t\tthis.interactions.originalPosition = {\r\n\t\t\t\tx: this.pixelX,\r\n\t\t\t\ty: this.pixelY\r\n\t\t\t};\r\n\t\t\tthis.interactions.originalAngle = this.rotation;\r\n\t\t\tthis.interactions.originalScale = this.scale;\r\n\t\t\tif (this.states.hasKey(\"down\")) {\r\n\t\t\t\tthis.setState(\"down\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Prepares element's after `up` event.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Event\r\n\t */\r\n\tpublic handleUp(ev?: AMEvent<Sprite, ISpriteEvents>[\"up\"]): void {\r\n\t\t/*if (!this.isDown) {\r\n\t\t\tthis.interactions.originalPosition = null;\r\n\t\t\tthis.interactions.originalAngle = null;\r\n\t\t\tthis.interactions.originalScale = null;\r\n\t\t}*/\r\n\t\tthis._isResized = false;\r\n\t\tif (this.states.hasKey(\"down\")) {\r\n\t\t\tthis.applyCurrentState();\r\n\t\t}\r\n\t\tif (this.showTooltipOn == \"hit\") {\r\n\t\t\tthis.updateTooltipPosition(ev.pointer ? ev.pointer.point : undefined);\r\n\t\t\tthis._disposers.push(registry.events.once(\"exitframe\", () => {\r\n\t\t\t\tthis.showTooltip();\r\n\t\t\t}));\r\n\r\n\t\t\tthis._disposers.push(getInteraction().body.events.once(\"down\", (ev) => {\r\n\t\t\t\tthis.hideTooltip();\r\n\t\t\t}));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if the element is clickable.\r\n\t *\r\n\t * Some type of the elements, like buttons are clickable by default.\r\n\t *\r\n\t * Most of the elements are not clickable by default.\r\n\t *\r\n\t * Use `hit`, `doublehit`, `up`, `down`, `toggled` events to watch for\r\n\t * respective click/touch actions.\r\n\t *\r\n\t * @param value `true` if element can be clicked\r\n\t */\r\n\tpublic set clickable(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.setPropertyValue(\"clickable\", value)) {\r\n\t\t\tif (!value && !this.isInteractive()) {\r\n\t\t\t\t// void\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.applyCursorStyle();\r\n\t\t\t\tthis.interactions.clickable = value;\r\n\r\n\t\t\t\t// setEventDisposer will also remove listeners if value == false\r\n\t\t\t\tthis.interactions.setEventDisposer(\"sprite-clickable\", value, () => new MultiDisposer([\r\n\t\t\t\t\tthis.events.on(\"down\", this.handleDown, this, false),\r\n\t\t\t\t\tthis.events.on(\"up\", this.handleUp, this, false)\r\n\t\t\t\t]));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return {boolean}\r\n\t */\r\n\tpublic get clickable(): boolean {\r\n\t\treturn this.getPropertyValue(\"clickable\");\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if element can be toggled on and off by subsequent clicks/taps.\r\n\t *\r\n\t * Togglable element will alternate its `isActive` property between `true`\r\n\t * and `false` with each click.\r\n\t *\r\n\t * @param value Is togglable?\r\n\t */\r\n\tpublic set togglable(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.setPropertyValue(\"togglable\", value)) {\r\n\t\t\tif (!value && !this.isInteractive()) {\r\n\t\t\t\t// void\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// setEventDisposer will also remove listeners if value == false\r\n\t\t\t\tthis.interactions.setEventDisposer(\"sprite-togglable\", value, () => this.events.on(\"hit\", this.handleToggle, this, false));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Is togglable?\r\n\t */\r\n\tpublic get togglable(): boolean {\r\n\t\treturn this.getPropertyValue(\"togglable\");\r\n\t}\r\n\r\n\t/**\r\n\t * Handles toggling of the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Event\r\n\t */\r\n\tpublic handleToggle(ev: AMEvent<Sprite, ISpriteEvents>[\"hit\"]) {\r\n\t\tthis.isActive = !this.isActive;\r\n\t}\r\n\r\n\t/**\r\n\t * Should element prevent context menu to be displayed, e.g. when\r\n\t * right-clicked?\r\n\t *\r\n\t * @default false\r\n\t * @param value Context menu disabled?\r\n\t */\r\n\tpublic set contextMenuDisabled(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.setPropertyValue(\"contextMenuDisabled\", value)) {\r\n\t\t\tthis.interactions.contextMenuDisabled = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Context menu disabled?\r\n\t */\r\n\tpublic get contextMenuDisabled(): boolean {\r\n\t\treturn this.getPropertyValue(\"contextMenuDisabled\");\r\n\t}\r\n\r\n\t/**\r\n\t * Click-through URL for this element.\r\n\t *\r\n\t * If set, clicking/tapping this element will open the new URL in a target\r\n\t * window/tab as set by `urlTarget`.\r\n\t *\r\n\t * Please note that URL will be parsed by data placeholders in curly\r\n\t * brackets, to be populated from data. E.g.:\r\n\t *\r\n\t * ```TypeScript\r\n\t * series.columns.template.url = \"https://www.google.com/search?q={category.urlEncode()}\";\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * series.columns.template.url = \"https://www.google.com/search?q={category.urlEncode()}\";\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"series\": [{\r\n\t *     // ...\r\n\t *     \"columns\": {\r\n\t *       \"url\": \"https://www.google.com/search?q={category.urlEncode()}\"\r\n\t *     }\r\n\t *   }]\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @param value URL\r\n\t */\r\n\tpublic set url(value: $type.Optional<string>) {\r\n\t\tif (this.setPropertyValue(\"url\", value)) {\r\n\t\t\tif (this._urlDisposer) {\r\n\t\t\t\tthis._urlDisposer.dispose();\r\n\t\t\t}\r\n\r\n\t\t\t// If URL is not empty, set up events\r\n\t\t\tif ($utils.isNotEmpty(value)) {\r\n\t\t\t\tthis._urlDisposer = this.events.on(\"hit\", this.urlHandler, this, false);\r\n\r\n\t\t\t\t// Set other required parameters\r\n\t\t\t\tthis.clickable = true;\r\n\t\t\t\tthis.cursorOverStyle = MouseCursorStyle.pointer;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return URL\r\n\t */\r\n\tpublic get url(): $type.Optional<string> {\r\n\t\treturn this.getPropertyValue(\"url\");\r\n\t}\r\n\r\n\t/**\r\n\t * [baseId description]\r\n\t *\r\n\t * @ignore\r\n\t * @param  value  [description]\r\n\t */\r\n\tpublic set baseId(value: string) {\r\n\t\tthis.setBaseId(value);\r\n\t}\r\n\r\n\t/**\r\n\t * [baseId description]\r\n\t *\r\n\t * @ignore\r\n\t * @return [description]\r\n\t */\r\n\tpublic get baseId(): string {\r\n\t\tif (!this._baseId && this._parent) {\r\n\t\t\tthis.baseId = this._parent.baseId;\r\n\t\t}\r\n\r\n\t\treturn this._baseId;\r\n\t}\r\n\r\n\tprotected setBaseId(value: string) {\r\n\t\tif (value != this._baseId) {\r\n\t\t\tif (this.invalid) {\r\n\t\t\t\tthis.invalid = false;\r\n\t\t\t\tregistry.removeFromInvalidSprites(this);\r\n\t\t\t\tthis.invalidate();\r\n\t\t\t}\r\n\t\t\tthis._baseId = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the mail chart object that this element belongs to.\r\n\t *\r\n\t * In most cases it will mean the chart object.\r\n\t *\r\n\t * Can be used to retrieve chart object in various events and adapters.\r\n\t *\r\n\t * ```TypeScript\r\n\t * chart.seriesContainer.events.on(\"hit\", function(ev) {\r\n\t *   console.log(ev.target.baseSprite);\r\n\t * });\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * chart.seriesContainer.events.on(\"hit\", function(ev) {\r\n\t *   console.log(ev.target.baseSprite);\r\n\t * });\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"seriesContainer\": {\r\n\t *     \"events\": {\r\n\t *       \"hit\": function(ev) {\r\n\t *         console.log(ev.target.baseSprite);\r\n\t *       }\r\n\t *     }\r\n\t *   }\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @readonly\r\n\t * @return  Base chart object\r\n\t */\r\n\tpublic get baseSprite(): $type.Optional<Sprite> {\r\n\t\tif (this.isBaseSprite) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\telse if (this._parent) {\r\n\t\t\treturn this._parent.baseSprite;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Target to use for URL clicks:\r\n\t *\r\n\t * * _blank\r\n\t * * _self (default)\r\n\t * * _parent\r\n\t * * _top\r\n\t * * Name of the window/frame\r\n\t *\r\n\t * Ignored if `url` is not set.\r\n\t *\r\n\t * @param value URL target\r\n\t */\r\n\tpublic set urlTarget(value: string) {\r\n\t\tthis.setPropertyValue(\"urlTarget\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return URL target\r\n\t */\r\n\tpublic get urlTarget(): string {\r\n\t\treturn this.getPropertyValue(\"urlTarget\");\r\n\t}\r\n\r\n\t/**\r\n\t * Handles URL transition on element click.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev An event object\r\n\t */\r\n\tpublic urlHandler(ev: AMEvent<Sprite, ISpriteEvents>[\"hit\"]): void {\r\n\t\t// Is URL set?\r\n\t\tif ($utils.isNotEmpty(this.url)) {\r\n\t\t\t// Proceed to the URL\r\n\t\t\tlet url = this.populateString(this.url);\r\n\t\t\tif (this.urlTarget === \"_self\") {\r\n\t\t\t\twindow.location.href = url;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\twindow.open(url, this.urlTarget);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * SWIPING GESTURE TRACKING\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Returns element's swipe gesture options.\r\n\t *\r\n\t * @return Swipe gesture options\r\n\t */\r\n\tpublic get swipeOptions(): ISwipeOptions {\r\n\t\tif (!this.interactions.swipeOptions) {\r\n\t\t\tif (this.virtualParent) {\r\n\t\t\t\treturn this.virtualParent.swipeOptions;\r\n\t\t\t}\r\n\t\t\tif (this._parent) {\r\n\t\t\t\treturn this._parent.swipeOptions;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.interactions.swipeOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * Controls if element is swipeable.\r\n\t *\r\n\t * Swipable element will invoke `swipe`, `swipeleft` and `swiperight` events,\r\n\t * when quick horizontal drag action is performed with either mouse or touch.\r\n\t *\r\n\t * Please note that combining swipe and drag is possible, however will incur\r\n\t * a slight but noticeable delay in drag start.\r\n\t *\r\n\t * @param value  Element swipable?\r\n\t */\r\n\tpublic set swipeable(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.setPropertyValue(\"swipeable\", value)) {\r\n\t\t\tthis.applyCursorStyle();\r\n\t\t\tif (!value && !this.isInteractive()) {\r\n\t\t\t\t// void\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.interactions.swipeable = value;\r\n\t\t\t}\r\n\t\t\t//interaction.processSwipeable(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Element swipable?\r\n\t */\r\n\tpublic get swipeable(): boolean {\r\n\t\treturn this.getPropertyValue(\"swipeable\");\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * POINTER TRACKING\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Indicates if the element is trackable (mouse position over it is reported to\r\n\t * event listeners).\r\n\t *\r\n\t * Will invoke `track` events whenever pointer (cursor) changes position\r\n\t * while over element.\r\n\t *\r\n\t * Please note, touch devices will also invoke `track` events when touch\r\n\t * point is moved while holding down on a trackable element.\r\n\t *\r\n\t * @param value Track cursor movement over element?\r\n\t */\r\n\tpublic set trackable(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.setPropertyValue(\"trackable\", value)) {\r\n\t\t\tif (!value && !this.isInteractive()) {\r\n\t\t\t\t// void\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.applyCursorStyle();\r\n\t\t\t\tthis.interactions.trackable = value;\r\n\t\t\t}\r\n\t\t\t//interaction.processTrackable(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Track cursor movement over element?\r\n\t */\r\n\tpublic get trackable(): boolean {\r\n\t\treturn this.getPropertyValue(\"trackable\");\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * MOUSE-WHEEL RELATED\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Indicates if the element can be interacted with mouse wheel.\r\n\t *\r\n\t * Will invoke `wheel`, `wheelup`, `wheeldown`, `wheelleft`, and `wheelright`\r\n\t * events when using mouse wheel over the element.\r\n\t *\r\n\t * @param value Mouse wheel events enabled?\r\n\t */\r\n\tpublic set wheelable(value: boolean) {\r\n\t\tif (this.setPropertyValue(\"wheelable\", value)) {\r\n\t\t\tif (!value && !this.isInteractive()) {\r\n\t\t\t\t// void\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.applyCursorStyle();\r\n\t\t\t\tthis.interactions.wheelable = value;\r\n\t\t\t}\r\n\t\t\t//interaction.processWheelable(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Mouse wheel events enabled?\r\n\t */\r\n\tpublic get wheelable(): boolean {\r\n\t\treturn this.getPropertyValue(\"wheelable\");\r\n\t}\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * RESIZE\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Indicates if this element is resizable.\r\n\t *\r\n\t * Enabling resize will turn on various interactions on the element. Their\r\n\t * actual functionality will depend on other properties.\r\n\t *\r\n\t * If the element also `draggable`, resize will only happen with two points\r\n\t * of contact on a touch device.\r\n\t *\r\n\t * If the element is not draggable, resize can be performed with just one\r\n\t * point of contact, touch or mouse.\r\n\t *\r\n\t * Will invoke `resize` event every time the size of the element changes.\r\n\t *\r\n\t * @param value  Element resizable?\r\n\t */\r\n\tpublic set resizable(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.setPropertyValue(\"resizable\", value)) {\r\n\t\t\tif (!value && !this.isInteractive()) {\r\n\t\t\t\t// void\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.applyCursorStyle();\r\n\t\t\t\tthis.interactions.resizable = value;\r\n\t\t\t\t// setEventDisposer will also remove listeners if value == false\r\n\t\t\t\tthis.interactions.setEventDisposer(\"sprite-resizable\", value, () => new MultiDisposer([\r\n\t\t\t\t\tthis.events.on(\"down\", this.handleDown, this, false),\r\n\t\t\t\t\tthis.events.on(\"resize\", this.handleResize, this, false)\r\n\t\t\t\t]));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Element resizable?\r\n\t */\r\n\tpublic get resizable(): boolean {\r\n\t\treturn this.getPropertyValue(\"resizable\");\r\n\t}\r\n\r\n\t/**\r\n\t * Handles resize intermediate step.\r\n\t *\r\n\t * By default this method resizes actual element. Each element, can override\r\n\t * this method to implement their own resize logic.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Event object\r\n\t */\r\n\tpublic handleResize(ev: AMEvent<Sprite, ISpriteEvents>[\"resize\"]): void {\r\n\t\tif (!this.interactions.isTouchProtected || !ev.touch) {\r\n\t\t\tthis._isResized = true;\r\n\r\n\t\t\tthis.scale = this.interactions.originalScale * ev.scale;\r\n\r\n\t\t\tthis.validatePosition();\r\n\t\t\t/*center: (io.draggable\r\n\t\t\t? $math.getMidPoint(point1, point2)\r\n\t\t\t: {\r\n\t\t\t\t\"x\": io.originalPosition.x,\r\n\t\t\t\t\"y\": io.originalPosition.y\r\n\t\t\t})*/\r\n\t\t\t//this.moveTo(this.originalPosition.x + ev.shift.x, this.originalPosition.y + ev.shift.y);\r\n\t\t\tif (this.draggable || this.dragWhileResize) {\r\n\t\t\t\tthis._isDragged = false;\r\n\t\t\t\tlet svgPoint1: IPoint = $utils.documentPointToSvg(ev.point1, this.htmlContainer, this.svgContainer.cssScale);\r\n\t\t\t\tlet svgPoint2: IPoint = $utils.documentPointToSvg(ev.point2, this.htmlContainer, this.svgContainer.cssScale);\r\n\t\t\t\tlet svgMidPoint: IPoint = $math.getMidPoint(svgPoint1, svgPoint2);\r\n\r\n\t\t\t\tlet parentPoint1: IPoint = $utils.documentPointToSprite(ev.startPoint1, this._parent);\r\n\t\t\t\tlet parentPoint2: IPoint = $utils.documentPointToSprite(ev.startPoint2, this._parent);\r\n\r\n\t\t\t\tlet originalPosition: Optional<IPoint> = this.interactions.originalPosition;\r\n\t\t\t\tlet originalScale: number = this.interactions.originalScale;\r\n\r\n\t\t\t\tif (originalPosition) {\r\n\t\t\t\t\tlet spritePoint1: IPoint = { x: (parentPoint1.x - originalPosition.x) / originalScale, y: (parentPoint1.y - originalPosition.y) / originalScale };\r\n\t\t\t\t\tlet spritePoint2: IPoint = { x: (parentPoint2.x - originalPosition.x) / originalScale, y: (parentPoint2.y - originalPosition.y) / originalScale };\r\n\r\n\t\t\t\t\tlet spriteMidPoint: IPoint = $math.getMidPoint(spritePoint1, spritePoint2);\r\n\r\n\t\t\t\t\tlet parentPoint: IPoint = $utils.svgPointToSprite(svgMidPoint, this._parent);\r\n\t\t\t\t\tthis.moveTo({ x: parentPoint.x - spriteMidPoint.x * this.scale, y: parentPoint.y - spriteMidPoint.y * this.scale }, undefined, undefined, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * MOUSE-RELATED\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Returns element's cursor options.\r\n\t *\r\n\t * Cursor options usually define cursor style for various states of the\r\n\t * hovered element.\r\n\t *\r\n\t * Elements inherit `cursorOptions` from their parents if they don't have\r\n\t * them set explicitly.\r\n\t *\r\n\t * @see {@link ICursorOptions} for a list of available options\r\n\t * @return Cursor options\r\n\t */\r\n\tpublic get cursorOptions(): ICursorOptions {\r\n\t\tif (!this.interactions.cursorOptions) {\r\n\t\t\tif (this.virtualParent) {\r\n\t\t\t\treturn this.virtualParent.cursorOptions;\r\n\t\t\t}\r\n\t\t\tif (this._parent) {\r\n\t\t\t\treturn this._parent.cursorOptions;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.interactions.cursorOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * A shortcut to setting mouse cursor on hover.\r\n\t *\r\n\t * Example:\r\n\t *\r\n\t * ```TypeScript\r\n\t * series.slices.template.cursorOverStyle = am4core.MouseCursorStyle.pointer;\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * series.slices.template.cursorOverStyle = am4core.MouseCursorStyle.pointer;\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"series\": {\r\n\t *     // ...\r\n\t *     \"slices\": {\r\n\t *       \"cursorOverStyle\": \"pointer\"\r\n\t *     }\r\n\t *   }\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @param style An array of styles to apply onhover\r\n\t */\r\n\tpublic set cursorOverStyle(style: Array<IStyleProperty>) {\r\n\t\tif (!this.cursorOptions.overStyle) {\r\n\t\t\tthis.interactions.cursorOptions = {\r\n\t\t\t\tdefaultStyle: this.cursorOptions.defaultStyle\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis.cursorOptions.overStyle = style;\r\n\t\tgetInteraction().applyCursorOverStyle(this.interactions);\r\n\t}\r\n\r\n\t/**\r\n\t * A shortcut to setting mouse cursor when button is pressed down.\r\n\t *\r\n\t * Example:\r\n\t *\r\n\t * ```TypeScript\r\n\t * series.slices.template.cursorDownStyle = am4core.MouseCursorStyle.grabbing;\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * series.slices.template.cursorDownStyle = am4core.MouseCursorStyle.grabbing;\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"series\": {\r\n\t *     // ...\r\n\t *     \"slices\": {\r\n\t *       \"cursorDownStyle\": \"grabbing\"\r\n\t *     }\r\n\t *   }\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @param style An array of styles to apply onhover\r\n\t */\r\n\tpublic set cursorDownStyle(style: Array<IStyleProperty>) {\r\n\t\tthis.cursorOptions.downStyle = style;\r\n\t}\r\n\r\n\t/**\r\n\t * Applies default cursor styles for interactable elements.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Determine if this is necessary. Maybe let's not apply any cursor styles by default\r\n\t */\r\n\tpublic applyCursorStyle(): void {\r\n\r\n\t\t// Draggable styles\r\n\t\t/*if (this.draggable) {\r\n\r\n\t\t\tif (!$type.hasValue(this.cursorOptions.overStyle)) {\r\n\t\t\t\tthis.cursorOptions.overStyle = MouseCursorStyle.grab;\r\n\t\t\t}\r\n\r\n\t\t\tif (!$type.hasValue(this.cursorOptions.downStyle)) {\r\n\t\t\t\tthis.cursorOptions.downStyle = MouseCursorStyle.grabbing;\r\n\t\t\t}\r\n\t\t}*/\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Setting this to `false` will effectively disable all interactivity on the\r\n\t * element.\r\n\t *\r\n\t * @param value  Is interaction enabled for this element?\r\n\t */\r\n\tpublic set interactionsEnabled(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\r\n\t\tif (this.setPropertyValue(\"interactionsEnabled\", value)) {\r\n\t\t\tlet pointerEvents = null; // must be null, not \"null\"!\r\n\t\t\tif (!value) {\r\n\t\t\t\tpointerEvents = \"none\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// this is for IE\r\n\t\t\t\tthis.group.node.style.pointerEvents = \"\";\r\n\t\t\t}\r\n\t\t\tthis.group.node.style.pointerEvents = pointerEvents;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Is interaction enabled for this element?\r\n\t */\r\n\tpublic get interactionsEnabled(): boolean {\r\n\t\tlet value = this.getPropertyValue(\"interactionsEnabled\");\r\n\t\tif (value === false) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (this.virtualParent) {\r\n\t\t\treturn this.virtualParent.interactionsEnabled;\r\n\t\t}\r\n\t\tif (this._parent) {\r\n\t\t\treturn this._parent.interactionsEnabled;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * EXPORT-RELATED STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * An [[Export]] instance.\r\n\t *\r\n\t * Used to access API of the chart export functionality.\r\n\t *\r\n\t * If `exporting` is not set, the element inherits [[Export]] instance from\r\n\t * its parents.\r\n\t *\r\n\t * Upon request, if no parent has such instance, a new one is created, using\r\n\t * default settings, what in most cases is just enough.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/exporting/} for more info about exporting\r\n\t * @param exp  Export\r\n\t */\r\n\tpublic set exporting(exp: Export) {\r\n\t\tthis._exporting.set(exp, exp);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Export instance\r\n\t */\r\n\tpublic get exporting(): Export {\r\n\t\treturn this.getExporting();\r\n\t}\r\n\r\n\t/**\r\n\t * This is here as a method so that inheriting classes could override it.\r\n\t *\r\n\t * @return Export instance\r\n\t */\r\n\tprotected getExporting(): Export {\r\n\t\tlet _export = this._exporting.get();\r\n\r\n\t\tif (_export) {\r\n\t\t\treturn _export;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (this.isStandaloneInstance || !this._parent) {\r\n\t\t\t\t_export = new Export(this.svgContainer.SVGContainer);\r\n\t\t\t\t_export.sprite = this;\r\n\t\t\t\t_export.language = this.language;\r\n\t\t\t\t_export.numberFormatter = this.numberFormatter;\r\n\t\t\t\t_export.dateFormatter = this.dateFormatter;\r\n\t\t\t\t_export.durationFormatter = this.durationFormatter;\r\n\t\t\t\tthis._exporting.set(_export, _export);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn this._parent.exporting;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn _export;\r\n\t}\r\n\r\n\t/**\r\n\t * If set to `false` this element will be omitted when exporting the chart\r\n\t * to an image.\r\n\t *\r\n\t * @default true\r\n\t * @param value  Export?\r\n\t */\r\n\tpublic set exportable(value: boolean) {\r\n\t\tconst svgContainer = this.svgContainer;\r\n\t\tthis._exportable = value;\r\n\t\tif (svgContainer) {\r\n\t\t\tif (value) {\r\n\t\t\t\t$array.remove(svgContainer.nonExportableSprites, this);\r\n\t\t\t}\r\n\t\t\telse if ($array.indexOf(svgContainer.nonExportableSprites, this) == -1) {\r\n\t\t\t\tsvgContainer.nonExportableSprites.push(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Export?\r\n\t */\r\n\tpublic get exportable(): boolean {\r\n\t\treturn this._exportable;\r\n\t\t/*const svgContainer = this.svgContainer;\r\n\t\treturn !svgContainer || $array.indexOf(svgContainer.nonExportableSprites, this) == -1;*/\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * MODAL/POPUP RELATED STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Private method to be used for \"classPrefix\" adapter for modals/popups.\r\n\t *\r\n\t * @param value  Prefix\r\n\t */\r\n\tprivate modalPrefix(value: string) {\r\n\t\tvalue = options.classNamePrefix + value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a [[Modal]] instance, associated with this chart.\r\n\t * (elements top parent)\r\n\t *\r\n\t * Accessing modal does not make it appear. To make a modal appear, use\r\n\t * `showModal()` method.\r\n\t *\r\n\t * @see {@link Modal} for more information about using Modal windows\r\n\t * @return Modal instance\r\n\t */\r\n\tpublic get modal(): Optional<Modal> {\r\n\t\tconst svgContainer = this.svgContainer;\r\n\t\tif (svgContainer) {\r\n\t\t\tconst modal = svgContainer.modal;\r\n\t\t\tif (!modal.adapter.has(\"classPrefix\", this.modalPrefix)) {\r\n\t\t\t\tmodal.adapter.add(\"classPrefix\", this.modalPrefix);\r\n\t\t\t}\r\n\t\t\treturn modal;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Opens a modal window with specific content (`text` parameter) and,\r\n\t * optionally, `title`.\r\n\t *\r\n\t * The `text` parameter can contain HTML content.\r\n\t *\r\n\t * @see {@link Modal} for more information about using Modal windows\r\n\t * @param text   Modal contents\r\n\t * @param title  Title for the modal window\r\n\t */\r\n\tpublic openModal(text: string, title?: string): Optional<Modal> {\r\n\t\tconst svgContainer = this.svgContainer;\r\n\t\tif (svgContainer) {\r\n\t\t\treturn svgContainer.openModal(text, title);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hides modal window if there is one currently open.\r\n\t */\r\n\tpublic closeModal(): void {\r\n\t\tconst svgContainer = this.svgContainer;\r\n\t\tif (svgContainer) {\r\n\t\t\tsvgContainer.closeModal();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A list of popups for this chart.\r\n\t *\r\n\t * @return Popups\r\n\t */\r\n\tpublic get popups(): Optional<ListTemplate<Popup>> {\r\n\t\tconst svgContainer = this.svgContainer;\r\n\t\tif (svgContainer) {\r\n\t\t\tconst popups = svgContainer.popups;\r\n\t\t\tpopups.template.sprite = this;\r\n\r\n\t\t\tif (!popups.template.adapter.has(\"classPrefix\", this.modalPrefix)) {\r\n\t\t\t\tpopups.template.adapter.add(\"classPrefix\", this.modalPrefix);\r\n\t\t\t}\r\n\t\t\treturn popups;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Creates, opens, and returns a new [[Popup]] window.\r\n\t *\r\n\t * `text` can be any valid HTML.\r\n\t *\r\n\t * `title` is currently not supported.\r\n\t *\r\n\t * @param text   Popup contents\r\n\t * @param title  Popup title\r\n\t * @return Popup instance\r\n\t */\r\n\tpublic openPopup(text: string, title?: string): Optional<Popup> {\r\n\t\tconst svgContainer = this.svgContainer;\r\n\t\tif (svgContainer) {\r\n\t\t\treturn svgContainer.openPopup(text, title);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Closes all currently open popup windows\r\n\t */\r\n\tpublic closeAllPopups(): void {\r\n\t\tconst svgContainer = this.svgContainer;\r\n\t\tif (svgContainer) {\r\n\t\t\tsvgContainer.closeAllPopups();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * POSITIONAL PROPERTIES AND RELATED STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Element's absolute or relative X coordinate.\r\n\t *\r\n\t * If setting both X and Y, please consider using `moveTo()` method instead,\r\n\t * as it will be faster to set both coordinates at once.\r\n\t *\r\n\t * @param value X coordinate\r\n\t */\r\n\tpublic set x(value: number | Percent) {\r\n\t\tif (!this.isDragged) {\r\n\t\t\tthis.setPercentProperty(\"x\", value, false, true, this._positionPrecision, true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return X coordinate\r\n\t */\r\n\tpublic get x(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"x\");\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's current absolute X coordinate in pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return X coordinate (px)\r\n\t */\r\n\tpublic get pixelX(): number {\r\n\t\tlet value = $math.fitToRange(this.getPixelX(this.x), this.minX, this.maxX);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"pixelX\", value);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's current relative X coordinate in [[Percent]].\r\n\t *\r\n\t * @return X coordinate ([[Percent]])\r\n\t */\r\n\tpublic get relativeX(): number {\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn this.getRelativeX(this.x)\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"relativeX\", this.getRelativeX(this.x));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * The smallest allowable absolute X coordinate for this element.\r\n\t *\r\n\t * This is used to contain element movement within certain boundaries.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value Min X (px)\r\n\t */\r\n\tpublic set minX(value: number) {\r\n\t\tif ($type.isNumber(value)) {\r\n\t\t\tvalue = $math.round(value, this._positionPrecision, true);\r\n\t\t\tthis.setPropertyValue(\"minX\", value, false, true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Min X (px)\r\n\t */\r\n\tpublic get minX(): number {\r\n\t\treturn this.getPropertyValue(\"minX\");\r\n\t}\r\n\r\n\t/**\r\n\t * The biggest allowable absolute X coordinate for this element.\r\n\t *\r\n\t * This is used to contain element movement within certain boundaries.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value Max X (px)\r\n\t */\r\n\tpublic set maxX(value: number) {\r\n\t\tif ($type.isNumber(value)) {\r\n\t\t\tvalue = $math.round(value, this._positionPrecision, true);\r\n\t\t\tthis.setPropertyValue(\"maxX\", value, false, true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Max X (px)\r\n\t */\r\n\tpublic get maxX(): number {\r\n\t\treturn this.getPropertyValue(\"maxX\");\r\n\t}\r\n\r\n\t/**\r\n\t * Element's absolute or relative Y coordinate.\r\n\t *\r\n\t * If setting both X and Y, please consider using `moveTo()` method instead,\r\n\t * as it will be faster to set both coordinates at once.\r\n\t *\r\n\t * @param value  Y coordinate\r\n\t */\r\n\tpublic set y(value: number | Percent) {\r\n\t\tif (!this.isDragged) {\r\n\t\t\tthis.setPercentProperty(\"y\", value, false, true, this._positionPrecision, true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Y coordinate\r\n\t */\r\n\tpublic get y(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"y\");\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's current absolute Y coordinate in pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return Y coordinate (px)\r\n\t */\r\n\tpublic get pixelY(): number {\r\n\t\tlet value = $math.fitToRange(this.getPixelY(this.y), this.minY, this.maxY);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"pixelY\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's current relative Y coordinate in [[Percent]].\r\n\t *\r\n\t * @readonly\r\n\t * @return Y coordinate ([[Percent]])\r\n\t */\r\n\tpublic get relativeY(): number {\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn this.getRelativeX(this.y);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"relativeY\", this.getRelativeX(this.y));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * The smallest allowable absolute Y coordinate for this element.\r\n\t *\r\n\t * This is used to contain element movement within certain boundaries.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value Min Y (px)\r\n\t */\r\n\tpublic set minY(value: number) {\r\n\t\tif ($type.isNumber(value)) {\r\n\t\t\tvalue = $math.round(value, this._positionPrecision, true);\r\n\t\t\tthis.setPropertyValue(\"minY\", value, false, true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Min Y (px)\r\n\t */\r\n\tpublic get minY(): number {\r\n\t\treturn this.getPropertyValue(\"minY\");\r\n\t}\r\n\r\n\t/**\r\n\t * The biggest allowable absolute Y coordinate for this element.\r\n\t *\r\n\t * This is used to contain element movement within certain boundaries.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value  Max Y (px)\r\n\t */\r\n\tpublic set maxY(value: number) {\r\n\t\tif ($type.isNumber(value)) {\r\n\t\t\tvalue = $math.round(value, this._positionPrecision, true);\r\n\t\t\tthis.setPropertyValue(\"maxY\", value, false, true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Max Y (px)\r\n\t */\r\n\tpublic get maxY(): number {\r\n\t\treturn this.getPropertyValue(\"maxY\");\r\n\t}\r\n\r\n\t/**\r\n\t * A horizontal offset for the element in pixels.\r\n\t *\r\n\t * Can be negative value for offset to the left.\r\n\t *\r\n\t * @param value  Horizontal offset (px)\r\n\t */\r\n\tpublic set dx(value: number) {\r\n\t\tif ($type.isNumber(value)) {\r\n\t\t\tvalue = $math.round(value, this._positionPrecision, true);\r\n\t\t\tthis.setPropertyValue(\"dx\", value, false, true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Horizontal offset (px)\r\n\t */\r\n\tpublic get dx(): number {\r\n\t\treturn this.getPropertyValue(\"dx\");\r\n\t}\r\n\r\n\t/**\r\n\t * A vertical offset for the element in pixels.\r\n\t *\r\n\t * Can be negative value for offset upwards.\r\n\t *\r\n\t * @param value  Vertical offset (px)\r\n\t */\r\n\tpublic set dy(value: number) {\r\n\t\tif ($type.isNumber(value)) {\r\n\t\t\tvalue = $math.round(value, this._positionPrecision, true);\r\n\t\t\tthis.setPropertyValue(\"dy\", value, false, true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Vertical offset (px)\r\n\t */\r\n\tpublic get dy(): number {\r\n\t\treturn this.getPropertyValue(\"dy\");\r\n\t}\r\n\r\n\t/**\r\n\t * Rotation of the element in degrees. (0-360)\r\n\t *\r\n\t * Note: For convenience purposes, negative values (for counter-clockwise\r\n\t * rotation) and values exceeding 360 can also be used.\r\n\t *\r\n\t * @param value  Rotation (0-360)\r\n\t */\r\n\tpublic set rotation(value: number) {\r\n\t\tvalue = $type.toNumber(value);\r\n\t\tif (!$type.isNumber(value)) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tthis.setPropertyValue(\"rotation\", value, false, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Rotation (0-360)\r\n\t */\r\n\tpublic get rotation(): number {\r\n\t\treturn this.getPropertyValue(\"rotation\");\r\n\t}\r\n\r\n\t/**\r\n\t * Controls horizontal alignment of the element.\r\n\t *\r\n\t * This is used by parent [[Container]] when layouting its children.\r\n\t *\r\n\t * @param value  Horizontal align\r\n\t */\r\n\tpublic set align(value: Align) {\r\n\t\tvalue = <Align>$type.toText(value);\r\n\t\tif (this.setPropertyValue(\"align\", value)) {\r\n\t\t\tif (this._parent) {\r\n\t\t\t\tthis._parent.invalidateLayout();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Horizontal align\r\n\t */\r\n\tpublic get align(): Align {\r\n\t\treturn this.getPropertyValue(\"align\");\r\n\t}\r\n\r\n\t/**\r\n\t * Controls vertical alignment of the element.\r\n\t *\r\n\t * This is used by parent [[Container]] when layouting its children.\r\n\t *\r\n\t * @param value  Vertical align\r\n\t */\r\n\tpublic set valign(value: VerticalAlign) {\r\n\t\tvalue = <VerticalAlign>$type.toText(value);\r\n\t\tif (this.setPropertyValue(\"valign\", value)) {\r\n\t\t\tif (this._parent) {\r\n\t\t\t\tthis._parent.invalidateLayout();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Vertical align\r\n\t */\r\n\tpublic get valign(): VerticalAlign {\r\n\t\treturn this.getPropertyValue(\"valign\");\r\n\t}\r\n\r\n\t/**\r\n\t * Controls which part of the element to treat as a horizontal center.\r\n\t *\r\n\t * The setting will be used when positioning, resizing and rotating the\r\n\t * element.\r\n\t *\r\n\t * @param value  Horizontal center\r\n\t */\r\n\tpublic set horizontalCenter(value: HorizontalCenter) {\r\n\t\tvalue = <HorizontalCenter>$type.toText(value);\r\n\t\tif (this.setPropertyValue(\"horizontalCenter\", value)) {\r\n\t\t\tthis.updateCenter();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Horizontal center\r\n\t */\r\n\tpublic get horizontalCenter(): HorizontalCenter {\r\n\t\treturn this.getPropertyValue(\"horizontalCenter\");\r\n\t}\r\n\r\n\t/**\r\n\t * Controls which part of the element to treat as a vertical center.\r\n\t *\r\n\t * The setting will be used when positioning, resizing and rotating the\r\n\t * element.\r\n\t *\r\n\t * @param value  Vertical center\r\n\t */\r\n\tpublic set verticalCenter(value: VerticalCenter) {\r\n\t\tvalue = <VerticalCenter>$type.toText(value);\r\n\t\tif (this.setPropertyValue(\"verticalCenter\", value)) {\r\n\t\t\tthis.updateCenter();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Vertical center\r\n\t */\r\n\tpublic get verticalCenter(): VerticalCenter {\r\n\t\treturn this.getPropertyValue(\"verticalCenter\");\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * DIMENSIONAL PROPERTIES AND RELATED STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Maximum allowed width for the element in pixels.\r\n\t *\r\n\t * @param value  Maximum width (px)\r\n\t */\r\n\tpublic set maxWidth(value: number) {\r\n\t\tthis.setMaxWidth(value);\r\n\t}\r\n\r\n\tprotected setMaxWidth(value: number) {\r\n\t\tlet prevWidth = this.maxWidth;\r\n\t\tlet prevHeight = this.maxHeight;\r\n\t\tif (this.setPropertyValue(\"maxWidth\", value)) {\r\n\t\t\tif ($type.isNumber(this.relativeWidth)) {\r\n\t\t\t\tthis.invalidate();\r\n\t\t\t}\r\n\r\n\t\t\tconst event: AMEvent<this, ISpriteEvents>[\"maxsizechanged\"] = {\r\n\t\t\t\ttype: \"maxsizechanged\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tpreviousWidth: prevWidth,\r\n\t\t\t\tpreviousHeight: prevHeight\r\n\t\t\t};\r\n\r\n\t\t\tthis.dispatchImmediately(\"maxsizechanged\", event);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Maximum width (px)\r\n\t */\r\n\tpublic get maxWidth(): number {\r\n\t\tlet maxWidth = this.getPropertyValue(\"maxWidth\");\r\n\r\n\t\tif (!$type.isNumber(maxWidth)) {\r\n\t\t\tif (this._parent) {\r\n\t\t\t\tlet parentWidth = this._parent.maxWidth;\r\n\t\t\t\tif (this._parent.layout != \"absolute\" && this.align != \"none\" && this.align != undefined) {\r\n\t\t\t\t\tparentWidth = parentWidth - this.pixelMarginLeft - this.pixelMarginRight;\r\n\t\t\t\t}\r\n\t\t\t\treturn parentWidth;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn maxWidth;\r\n\t}\r\n\r\n\t/**\r\n\t * Maximum allowed height for the element in pixels.\r\n\t *\r\n\t * @param value  Maximum height (px)\r\n\t */\r\n\tpublic set maxHeight(value: number) {\r\n\t\tthis.setMaxHeight(value);\r\n\t}\r\n\r\n\tprotected setMaxHeight(value: number) {\r\n\r\n\t\tlet prevWidth = this.maxWidth;\r\n\t\tlet prevHeight = this.maxHeight;\r\n\r\n\t\tif (this.setPropertyValue(\"maxHeight\", value)) {\r\n\r\n\t\t\tif ($type.isNumber(this.relativeHeight)) {\r\n\t\t\t\tthis.invalidate();\r\n\t\t\t}\r\n\r\n\t\t\tconst event: AMEvent<this, ISpriteEvents>[\"maxsizechanged\"] = {\r\n\t\t\t\ttype: \"maxsizechanged\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tpreviousWidth: prevWidth,\r\n\t\t\t\tpreviousHeight: prevHeight\r\n\t\t\t};\r\n\r\n\t\t\tthis.dispatchImmediately(\"maxsizechanged\", event);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Maximum height (px)\r\n\t */\r\n\tpublic get maxHeight(): number {\r\n\t\tlet maxHeight = this.getPropertyValue(\"maxHeight\");\r\n\t\tif (!$type.isNumber(maxHeight)) {\r\n\t\t\tif (this._parent) {\r\n\t\t\t\tlet parentHeight = this._parent.maxHeight;\r\n\t\t\t\tif (this._parent.layout != \"absolute\" && this.valign != \"none\" && this.valign != undefined) {\r\n\t\t\t\t\tparentHeight = parentHeight - this.pixelMarginTop - this.pixelMarginBottom;\r\n\t\t\t\t}\r\n\t\t\t\treturn parentHeight;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn maxHeight;\r\n\t}\r\n\r\n\t/**\r\n\t * Minimum width of the element in pixels.\r\n\t *\r\n\t * Set to `undefined` to remove the limit.\r\n\t *\r\n\t * @param value  Minimum width (px)\r\n\t */\r\n\tpublic set minWidth(value: Optional<number>) {\r\n\t\tthis.setPropertyValue(\"minWidth\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Minimum width (px)\r\n\t */\r\n\tpublic get minWidth(): Optional<number> {\r\n\t\treturn this.getPropertyValue(\"minWidth\");\r\n\t}\r\n\r\n\t/**\r\n\t * Minimum height for the element in pixels.\r\n\t *\r\n\t * Set to `undefined` to remove the limit.\r\n\t *\r\n\t * @param value  Minimum height (px)\r\n\t */\r\n\tpublic set minHeight(value: Optional<number>) {\r\n\t\tthis.setPropertyValue(\"minHeight\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Minimum height (px)\r\n\t */\r\n\tpublic get minHeight(): Optional<number> {\r\n\t\treturn this.getPropertyValue(\"minHeight\");\r\n\t}\r\n\r\n\t/**\r\n\t * Element's absolute or relative width.\r\n\t *\r\n\t * The width can either be absolute, set in numeric pixels, or relative, set\r\n\t * in [[Percent]].\r\n\t *\r\n\t * Relative width will be calculated using closest measured ancestor\r\n\t * [[Container]].\r\n\t *\r\n\t * NOTE: `width` is an accessor, which allows setting width in pixels or\r\n\t * percent. It is a sort of a \"shortcut\" for the users. Actual renderer does\r\n\t * not ever use it. It uses either `pixelWidth` or `percentWidth`, so if\r\n\t * you need to add an adapter for width add it for either of the two\r\n\t * properties - whichever suits your requirements.\r\n\t *\r\n\t * @param value  Width (numeric in pixels or relative)\r\n\t */\r\n\tpublic set width(value: number | Percent) {\r\n\r\n\t\tlet changed: boolean = this.setPercentProperty(\"width\", value, true, false, this._positionPrecision, true);\r\n\r\n\t\tif (changed) {\r\n\t\t\tthis.percentWidth = undefined;\r\n\t\t\tthis.relativeWidth = undefined;\r\n\r\n\t\t\tif (value instanceof Percent) {\r\n\t\t\t\tthis.percentWidth = value.percent;\r\n\t\t\t\tif ($type.isNumber(this._pixelWidth)) {\r\n\t\t\t\t\tthis.maxWidth = undefined;\r\n\t\t\t\t}\r\n\t\t\t\tthis._pixelWidth = undefined;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._pixelWidth = Number(value);\r\n\t\t\t\t//this._measuredWidth = this._pixelWidth;\r\n\t\t\t\tthis.maxWidth = this._pixelWidth;\r\n\t\t\t}\r\n\t\t\tthis.invalidatePosition();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Width (absolute or relative)\r\n\t */\r\n\tpublic get width(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"width\");\r\n\t}\r\n\r\n\t/**\r\n\t * Element's absolute or relative height.\r\n\t *\r\n\t * The height can either be absolute, set in numeric pixels, or relative, set\r\n\t * in [[Percent]].\r\n\t *\r\n\t * Relative height will be calculated using closest measured ancestor\r\n\t * [[Container]].\r\n\t *\r\n\t * NOTE: `height` is an accessor, which allows setting height in pixels or\r\n\t * percent. It is a sort of a \"shortcut\" for the users. Actual renderer does\r\n\t * not ever use it. It uses either `pixelHeight` or `percentHeight`, so if\r\n\t * you need to add an adapter for height add it for either of the two\r\n\t * properties - whichever suits your requirements.\r\n\t *\r\n\t * @param value  Height (numeric in pixels or relative)\r\n\t */\r\n\tpublic set height(value: number | Percent) {\r\n\r\n\t\tlet changed: boolean = this.setPercentProperty(\"height\", value, true, false, this._positionPrecision, true);\r\n\r\n\t\tif (changed) {\r\n\t\t\tthis.percentHeight = undefined;\r\n\t\t\tthis._relativeHeight = undefined;\r\n\r\n\t\t\tif (value instanceof Percent) {\r\n\t\t\t\tthis.percentHeight = value.percent;\r\n\t\t\t\tif ($type.isNumber(this._pixelHeight)) {\r\n\t\t\t\t\tthis.maxHeight = undefined;\r\n\t\t\t\t}\r\n\t\t\t\tthis._pixelHeight = undefined;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._pixelHeight = Number(value);\r\n\t\t\t\t//this._measuredHeight = this._pixelHeight;\r\n\t\t\t\tthis.maxHeight = this._pixelHeight; // yes, we reset maxWidth\r\n\t\t\t}\r\n\r\n\t\t\tthis.invalidatePosition();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return height (absolute or relative)\r\n\t */\r\n\tpublic get height(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"height\");\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's width in pixels, if width was set. For actual width use measuredWidth property.\r\n\t *\r\n\t * @readonly\r\n\t * @return Width (px)\r\n\t */\r\n\tpublic get pixelWidth(): number {\r\n\t\tlet width: number;\r\n\t\tif ($type.isNumber(this.percentWidth)) {\r\n\t\t\twidth = this.maxWidth;\r\n\t\t}\r\n\t\telse if ($type.isNumber(this._pixelWidth)) {\r\n\t\t\twidth = this._pixelWidth;\r\n\t\t}\r\n\t\telse {\r\n\t\t\twidth = 0;\r\n\t\t}\r\n\r\n\t\tconst minWidth = this.minWidth;\r\n\r\n\t\tif (minWidth != null && width < minWidth) {\r\n\t\t\twidth = minWidth;\r\n\t\t}\r\n\t\tlet value = $math.round(width, this._positionPrecision, true);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"pixelWidth\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's height in pixels. For actual height use measuredHeight property.\r\n\t *\r\n\t * @readonly\r\n\t * @return Height (px)\r\n\t */\r\n\tpublic get pixelHeight(): number {\r\n\t\tlet height: number;\r\n\t\tif ($type.isNumber(this.percentHeight)) {\r\n\t\t\theight = this.maxHeight;\r\n\t\t}\r\n\t\telse if ($type.isNumber(this._pixelHeight)) {\r\n\t\t\theight = this._pixelHeight;\r\n\t\t}\r\n\t\telse {\r\n\t\t\theight = 0//this._measuredHeightSelf;\r\n\t\t}\r\n\r\n\t\tconst minHeight = this.minHeight;\r\n\r\n\t\tif (minHeight != null && height < minHeight) {\r\n\t\t\theight = minHeight;\r\n\t\t}\r\n\t\tlet value = $math.round(height, this._positionPrecision, true);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"pixelHeight\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Element's relative width in [[Percent]].\r\n\t * @ignore\r\n\t *\r\n\t * @param value  Relative width\r\n\t */\r\n\tpublic set relativeWidth(value: $type.Optional<number>) {\r\n\t\tif (this._relativeWidth != value) {\r\n\t\t\tthis._relativeWidth = value;\r\n\t\t\t//\t\t\tthis.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Relative width\r\n\t * @ignore\r\n\t */\r\n\tpublic get relativeWidth(): $type.Optional<number> {\r\n\t\tconst relativeWidth = this._relativeWidth;\r\n\r\n\t\tif ($type.isNumber(relativeWidth)) {\r\n\t\t\tif (!this._adapterO) {\r\n\t\t\t\treturn relativeWidth;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn this._adapterO.apply(\"relativeWidth\", relativeWidth);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Element's relative height in [[Percent]].\r\n\t *\r\n\t * @param value  Relative height\r\n\t * @ignore\r\n\t */\r\n\tpublic set relativeHeight(value: $type.Optional<number>) {\r\n\t\tif (this._relativeHeight != value) {\r\n\t\t\tthis._relativeHeight = value;\r\n\t\t\t//\t\t\tthis.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Relative height\r\n\t * @ignore\r\n\t */\r\n\tpublic get relativeHeight(): $type.Optional<number> {\r\n\t\tconst relativeHeight = this._relativeHeight;\r\n\r\n\t\tif ($type.isNumber(relativeHeight)) {\r\n\t\t\tif (!this._adapterO) {\r\n\t\t\t\treturn relativeHeight;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn this._adapterO.apply(\"relativeHeight\", relativeHeight);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's measured width in pixels.\r\n\t *\r\n\t * A measured width is actual width of contents plus `paddingRight` and* `paddingLeft`, relative to sprite parent, meaning that\r\n\t * rotation and scale is taken into account.\r\n\t *\r\n\t * @readonly\r\n\t * @return Width (px)\r\n\t */\r\n\tpublic get measuredWidth(): number {\r\n\r\n\t\tif (this.disabled || this.__disabled) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn this._measuredWidth;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"measuredWidth\", this._measuredWidth);\r\n\t\t}\r\n\t\t// it's not good to fit to min/max range as then rotations and scale won't be taken into account\r\n\t\t//return this.adapter.apply(\"measuredWidth\", $math.fitToRange(this._measuredWidth, this.minWidth, this.maxWidth));\r\n\t}\r\n\r\n\t/**\r\n\t * Returns elements's measured height in pixels.\r\n\t *\r\n\t * A measured height is actual height of contents plus `paddingTop` and `paddingBottom`, relative to sprite parent, meaning that\r\n\t * rotation and scale taken into account.\r\n\t *\r\n\t * @readonly\r\n\t * @return Height (px)\r\n\t */\r\n\tpublic get measuredHeight(): number {\r\n\r\n\t\tif (this.disabled || this.__disabled) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\t// it's not good to fit to min/max range as then rotations and scale won't be taken into account\r\n\t\t//return this.adapter.apply(\"measuredHeight\", $math.fitToRange(this._measuredHeight, this.minHeight, this.maxHeight));\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn this._measuredHeight;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"measuredHeight\", this._measuredHeight);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's measured width plus its left and right margins in\r\n\t * pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return Outer width (px)\r\n\t */\r\n\tpublic get outerWidth(): number {\r\n\t\tlet value = this.pixelWidth + this.pixelMarginRight + this.pixelMarginLeft;\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"outerWidth\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's measured height plus its top and bottom margins in\r\n\t * pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return Outer height (px)\r\n\t */\r\n\tpublic get outerHeight(): number {\r\n\t\tlet value = this.pixelHeight + this.pixelMarginTop + this.pixelMarginBottom;\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"outerHeight\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's measured inner width in pixels.\r\n\t *\r\n\t * Inner width is actual available space for content, e.g. element's width\r\n\t * minus horizontal padding.\r\n\t *\r\n\t * @readonly\r\n\t * @return Inner width (px)\r\n\t */\r\n\tpublic get innerWidth(): number {\r\n\t\tlet value = Math.max(0, this.pixelWidth - this.pixelPaddingRight - this.pixelPaddingLeft);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"innerWidth\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's measured inner height in pixels.\r\n\t *\r\n\t * Inner height is actual available space for content, e.g. element's height\r\n\t * minus vertical padding.\r\n\t *\r\n\t * @readonly\r\n\t * @return Inner height (px)\r\n\t */\r\n\tpublic get innerHeight(): number {\r\n\t\tlet value = Math.max(0, this.pixelHeight - this.pixelPaddingTop - this.pixelPaddingBottom);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"innerHeight\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's current \"global\" scale.\r\n\t *\r\n\t * Scale values accumulate over hierarchy of elements.\r\n\t *\r\n\t * E.g. if a [[Container]] has `scale = 2` and it's child has a `scale = 2`,\r\n\t * the child's `globalScale` will be 4. (a multitude of `2 x 2`)\r\n\t *\r\n\t * @readonly\r\n\t * @return Global scale\r\n\t */\r\n\tpublic get globalScale(): number {\r\n\t\tlet scale: number = this.scale;\r\n\t\tif (this._parent) {\r\n\t\t\tscale = scale * this._parent.globalScale;\r\n\t\t}\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn scale;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"globalScale\", scale);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Scale of the element.\r\n\t *\r\n\t * The scale is set from 0 (element reduced to nothing) to 1 (default size).\r\n\t * * 2 will mean element is increased twice.\r\n\t * * 0.5 - reduced by 50%.\r\n\t *\r\n\t * Etc.\r\n\t *\r\n\t * @param value  Scale (0-1)\r\n\t */\r\n\tpublic set scale(value: number) {\r\n\t\tvalue = $type.toNumber(value);\r\n\t\tif (value < 0) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tif (value != this.getPropertyValue(\"scale\")) {\r\n\t\t\tthis.setPropertyValue(\"scale\", value, false, true);\r\n\t\t\tthis.handleGlobalScale();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Scale (0-1)\r\n\t */\r\n\tpublic get scale(): number {\r\n\t\treturn this.getPropertyValue(\"scale\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets all four margins for the element at once.\r\n\t *\r\n\t * Margins are set in pixels.\r\n\t *\r\n\t * @param top     Top margin\r\n\t * @param right   Right margin\r\n\t * @param bottom  Bottom margin\r\n\t * @param left    Left margin\r\n\t * @return Current element\r\n\t */\r\n\tpublic margin(top: number, right: number, bottom: number, left: number): Sprite {\r\n\t\tthis.marginTop = top;\r\n\t\tthis.marginRight = right;\r\n\t\tthis.marginBottom = bottom;\r\n\t\tthis.marginLeft = left;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Left margin - absolute (px) or relative ([[Percent]]).\r\n\t *\r\n\t * @param value  Margin value\r\n\t */\r\n\tpublic set marginLeft(value: number | Percent) {\r\n\t\tthis.setPercentProperty(\"marginLeft\", value, true, true, this._positionPrecision, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Margin value\r\n\t */\r\n\tpublic get marginLeft(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"marginLeft\");\r\n\t}\r\n\r\n\t/**\r\n\t * Right margin - absolute (px) or relative ([[Percent]]).\r\n\t *\r\n\t * @param value  Margin value\r\n\t */\r\n\tpublic set marginRight(value: number | Percent) {\r\n\t\tthis.setPercentProperty(\"marginRight\", value, true, true, this._positionPrecision, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Margin value\r\n\t */\r\n\tpublic get marginRight(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"marginRight\");\r\n\t}\r\n\r\n\t/**\r\n\t * Top margin - absolute (px) or relative ([[Percent]]).\r\n\t *\r\n\t * @param value  Margin value\r\n\t */\r\n\tpublic set marginTop(value: number | Percent) {\r\n\t\tthis.setPercentProperty(\"marginTop\", value, true, true, this._positionPrecision, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Margin value\r\n\t */\r\n\tpublic get marginTop(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"marginTop\");\r\n\t}\r\n\r\n\t/**\r\n\t * Bottom margin - absolute (px) or relative ([[Percent]]).\r\n\t *\r\n\t * @param value  Margin value\r\n\t */\r\n\tpublic set marginBottom(value: number | Percent) {\r\n\t\tthis.setPercentProperty(\"marginBottom\", value, true, true, this._positionPrecision, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Margin value\r\n\t */\r\n\tpublic get marginBottom(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"marginBottom\");\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current right margin in pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return Right margin (px)\r\n\t */\r\n\tpublic get pixelMarginRight(): number {\r\n\t\tlet value = this.getPixelX(this.marginRight);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"pixelMarginRight\", value);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current relative right margin.\r\n\t *\r\n\t * @readonly\r\n\t * @return Relative right margin\r\n\t */\r\n\tpublic get relativeMarginRight(): number {\r\n\t\t// @todo Maybe use [[Percent]]?\r\n\t\tlet value = this.getRelativeX(this.marginRight);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"relativeMarginRight\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current left margin in pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return Left margin (px)\r\n\t */\r\n\tpublic get pixelMarginLeft(): number {\r\n\t\tlet value = this.getPixelX(this.marginLeft);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"pixelMarginLeft\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current relative left margin.\r\n\t *\r\n\t * @readonly\r\n\t * @return Relative left margin\r\n\t */\r\n\tpublic get relativeMarginLeft(): number {\r\n\t\t//@todo Maybe use [[Percent]]?\r\n\t\tlet value = this.getRelativeX(this.marginLeft);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"relativeMarginLeft\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current top margin in pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return Top margin (px)\r\n\t */\r\n\tpublic get pixelMarginTop(): number {\r\n\t\tlet value = this.getPixelY(this.marginTop);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"pixelMarginTop\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current relative top margin.\r\n\t *\r\n\t * @readonly\r\n\t * @return Relative top margin\r\n\t */\r\n\tpublic get relativeMarginTop(): number {\r\n\t\t// @todo Maybe use [[Percent]]?\r\n\t\tlet value = this.getRelativeY(this.marginTop);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"relativeMarginTop\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current bottom margin in pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return Bottom margin (px)\r\n\t */\r\n\tpublic get pixelMarginBottom(): number {\r\n\t\tlet value = this.getPixelY(this.marginBottom);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"pixelMarginBottom\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current relative bottom margin.\r\n\t *\r\n\t * @readonly\r\n\t * @return Relative bottom margin\r\n\t */\r\n\tpublic get relativeMarginBottom(): number {\r\n\t\t// @todo Maybe use [[Percent]]?\r\n\t\tlet value = this.getRelativeY(this.marginBottom);\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"relativeMarginBottom\", value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets padding for the element in pixels.\r\n\t *\r\n\t * @param top     Top padding (px)\r\n\t * @param right   Right padding (px)\r\n\t * @param bottom  Bottom padding (px)\r\n\t * @param left    Left padding (px)\r\n\t * @return Element\r\n\t */\r\n\tpublic padding(top: number, right: number, bottom: number, left: number): Sprite {\r\n\t\tthis.paddingTop = top;\r\n\t\tthis.paddingRight = right;\r\n\t\tthis.paddingBottom = bottom;\r\n\t\tthis.paddingLeft = left;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Left padding - absolute (px) or relative ([[Percent]]).\r\n\t *\r\n\t * @param value  Padding value\r\n\t */\r\n\tpublic set paddingLeft(value: number | Percent) {\r\n\t\tthis.setPercentProperty(\"paddingLeft\", value, true, true, this._positionPrecision, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Padding value\r\n\t */\r\n\tpublic get paddingLeft(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"paddingLeft\");\r\n\t}\r\n\r\n\t/**\r\n\t * Right padding - absolute (px) or relative ([[Percent]]).\r\n\t *\r\n\t * @param value  Padding value\r\n\t */\r\n\tpublic set paddingRight(value: number | Percent) {\r\n\t\tthis.setPercentProperty(\"paddingRight\", value, true, true, this._positionPrecision, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Padding value\r\n\t */\r\n\tpublic get paddingRight(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"paddingRight\");\r\n\t}\r\n\r\n\t/**\r\n\t * Top padding - absolute (px) or relative ([[Percent]]).\r\n\t *\r\n\t * @param value  Padding value\r\n\t */\r\n\tpublic set paddingTop(value: number | Percent) {\r\n\t\tthis.setPercentProperty(\"paddingTop\", value, true, true, this._positionPrecision, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Padding value\r\n\t */\r\n\tpublic get paddingTop(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"paddingTop\");\r\n\t}\r\n\r\n\t/**\r\n\t * Bottom padding - absolute (px) or relative ([[Percent]]).\r\n\t *\r\n\t * @param value  Padding value\r\n\t */\r\n\tpublic set paddingBottom(value: number | Percent) {\r\n\t\tthis.setPercentProperty(\"paddingBottom\", value, true, true, this._positionPrecision, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Padding value\r\n\t */\r\n\tpublic get paddingBottom(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"paddingBottom\");\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current right padding in pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return Right padding (px)\r\n\t */\r\n\tpublic get pixelPaddingRight(): number {\r\n\t\treturn this.getPixelX(this.paddingRight);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current relative right padding.\r\n\t *\r\n\t * @readonly\r\n\t * @return Relative right padding\r\n\t */\r\n\tpublic get relativePaddingRight(): number {\r\n\t\t// @todo Maybe use [[Percent]]?\r\n\t\treturn this.getRelativeX(this.paddingRight);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current left padding in pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return Left padding (px)\r\n\t */\r\n\tpublic get pixelPaddingLeft(): number {\r\n\t\treturn this.getPixelX(this.paddingLeft);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current relative left padding.\r\n\t *\r\n\t * @readonly\r\n\t * @return Relative left padding\r\n\t */\r\n\tpublic get relativePaddingLeft(): number {\r\n\t\t// @todo Maybe use [[Percent]]?\r\n\t\treturn this.getRelativeX(this.paddingLeft);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current top padding in pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return Top padding (px)\r\n\t */\r\n\tpublic get pixelPaddingTop(): number {\r\n\t\treturn this.getPixelY(this.paddingTop);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current relative top padding.\r\n\t *\r\n\t * @readonly\r\n\t * @return Relative top padding\r\n\t */\r\n\tpublic get relativePaddingTop(): number {\r\n\t\t// @todo Maybe use [[Percent]]?\r\n\t\treturn this.getRelativeY(this.paddingTop);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current bottom padding in pixels.\r\n\t *\r\n\t * @readonly\r\n\t * @return Bottom padding (px)\r\n\t */\r\n\tpublic get pixelPaddingBottom(): number {\r\n\t\treturn this.getPixelY(this.paddingBottom);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current relative bottom padding.\r\n\t *\r\n\t * @readonly\r\n\t * @return Relative bottom padding\r\n\t */\r\n\tpublic get relativePaddingBottom(): number {\r\n\t\t// @todo Maybe use [[Percent]]?\r\n\t\treturn this.getRelativeY(this.paddingBottom);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * APPEARANCE-RELATED PROPERTIES AND RELATED STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Path of Sprite element\r\n\t */\r\n\tpublic set path(value: string) {\r\n\t\tthis.setPath(value);\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected setPath(value: string): boolean {\r\n\t\tif (this.setPropertyValue(\"path\", value)) {\r\n\r\n\t\t\tif (this._adapterO) {\r\n\t\t\t\tvalue = this._adapterO.apply(\"path\", value);\r\n\t\t\t}\r\n\r\n\t\t\tif (!this._isPath) {\r\n\t\t\t\tif (!this.element || (this.element.node && !(this.element.node instanceof SVGPathElement))) {\r\n\t\t\t\t\tthis.element = this.paper.add(\"path\");\r\n\t\t\t\t}\r\n\t\t\t\tthis._isPath = true;\r\n\t\t\t}\r\n\t\t\tif ($type.hasValue(value)) {\r\n\t\t\t\tthis.element.attr({ \"d\": value });\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.element.removeAttr(\"d\");\r\n\t\t\t}\r\n\t\t\tthis.invalidatePosition();\r\n\t\t\t// otherwise is 0x0\r\n\t\t\tif (!this.inited) {\r\n\t\t\t\tthis.events.once(\"inited\", this.validatePosition, this, false);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Path of a Sprite element\r\n\t */\r\n\tpublic get path(): string {\r\n\t\treturn this.getPropertyValue(\"path\");\r\n\t}\r\n\r\n\t/**\r\n\t * [[ColorModifier]] that can be used to modify color and pattern of the\r\n\t * element's fill, e.g. create gradients.\r\n\t *\r\n\t * @param value  Fill color modifiier\r\n\t */\r\n\tpublic set fillModifier(value: ColorModifier) {\r\n\t\tif (this.setPropertyValue(\"fillModifier\", value)) {\r\n\t\t\tthis.setFill(this.fill);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Fill color modifier\r\n\t */\r\n\tpublic get fillModifier(): ColorModifier {\r\n\t\treturn this.getPropertyValue(\"fillModifier\");\r\n\t}\r\n\r\n\t/**\r\n\t * [[ColorModifier]] that can be used to modify color and pattern of the\r\n\t * element's stroke (outline), e.g. create gradients.\r\n\t *\r\n\t * @param value  Stroke color modifier\r\n\t */\r\n\tpublic set strokeModifier(value: ColorModifier) {\r\n\t\tthis.setPropertyValue(\"strokeModifier\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Stroke color modifier\r\n\t */\r\n\tpublic get strokeModifier(): ColorModifier {\r\n\t\treturn this.getPropertyValue(\"strokeModifier\");\r\n\t}\r\n\r\n\t/**\r\n\t * Element's fill opacity.\r\n\t *\r\n\t * Opacity ranges from 0 (fully transparent) to 1 (fully opaque).\r\n\t *\r\n\t * @param value  Opacity (0-1)\r\n\t */\r\n\tpublic set fillOpacity(value: number) {\r\n\t\tvalue = $math.toNumberRange(value, 0, 1);\r\n\t\tif (this.setPropertyValue(\"fillOpacity\", value)) {\r\n\t\t\tthis.setSVGAttribute({ \"fill-opacity\": value });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Opacity (0-9)\r\n\t */\r\n\tpublic get fillOpacity(): number {\r\n\t\treturn this.getPropertyValue(\"fillOpacity\");\r\n\t}\r\n\r\n\t/**\r\n\t * Element's fill color or pattern.\r\n\t *\r\n\t * @param value  Fill\r\n\t */\r\n\tpublic set fill(value: $type.Optional<Color | Pattern | LinearGradient | RadialGradient>) {\r\n\t\tthis.setFill(value);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets actual `fill` property on the SVG element, including applicable color\r\n\t * modifiers.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value  Fill\r\n\t */\r\n\tprotected setFill(value: $type.Optional<Color | Pattern | LinearGradient | RadialGradient>): void {\r\n\t\tif (!$type.isObject(value) || \"r\" in value) {\r\n\t\t\tvalue = toColor(value);\r\n\t\t}\r\n\r\n\t\tif (this.setColorProperty(\"fill\", value) || this.fillModifier) {\r\n\t\t\t// this can not go into next if, as value is turned to Gradient\r\n\t\t\tif (value instanceof Color) {\r\n\t\t\t\tif (this.fillModifier) {\r\n\t\t\t\t\tvalue = this.fillModifier.modify(value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.realFill = value;\r\n\r\n\t\t\t// todo: review this place when some Color type will be added\r\n\t\t\tif (value instanceof Color) {\r\n\t\t\t\tthis.setSVGAttribute({ \"fill\": value.toString() });\r\n\t\t\t}\r\n\t\t\telse if (!$type.hasValue(value)) {\r\n\t\t\t\tthis.removeSVGAttribute(\"fill\");\r\n\t\t\t}\r\n\t\t\telse if (<any>value instanceof Pattern || <any>value instanceof LinearGradient || <any>value instanceof RadialGradient) {\r\n\t\t\t\tlet fill = value;\r\n\t\t\t\tfill.paper = this.paper;\r\n\t\t\t\tthis.setSVGAttribute({ \"fill\": \"url(\\\"\" + $utils.getBaseURI() + fill.id + \"\\\")\" });\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Fill\r\n\t */\r\n\tpublic get fill(): $type.Optional<Color | Pattern | LinearGradient | RadialGradient> {\r\n\t\treturn this.getPropertyValue(\"fill\");\r\n\t}\r\n\r\n\t/**\r\n\t * Element's opacity.\r\n\t *\r\n\t * Opacity setting can range from 0 (fully transparent) to 1 (fully opaque).\r\n\t *\r\n\t * ATTENTION: It is highly not recommended to use `opacity` directly on the\r\n\t * element. The charts use `opacity` to hide/show elements, so your setting\r\n\t * might be lost if element is hidden and then later shown.\r\n\t *\r\n\t * Instead use methods `hide()` and `show()` to completely toggle off and on\r\n\t * the element.\r\n\t *\r\n\t * Or, use properties `fillOpacity` and `strokeOpacity`, if you need to make\r\n\t * the element semi-transparent.\r\n\t *\r\n\t * @param value Opacity (0-1)\r\n\t */\r\n\tpublic set opacity(value: number) {\r\n\t\tvalue = $math.toNumberRange(value, 0, 1);\r\n\t\tif (this.setPropertyValue(\"opacity\", value)) {\r\n\t\t\tthis.setSVGAttribute({ \"opacity\": value });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Opacity (0-1)\r\n\t */\r\n\tpublic get opacity(): number {\r\n\t\treturn this.getPropertyValue(\"opacity\");\r\n\t}\r\n\r\n\t/**\r\n\t * Element's stroke (outline) color or pattern.\r\n\t *\r\n\t * @param value  Stroke setting\r\n\t */\r\n\tpublic set stroke(value: Color | Pattern | LinearGradient | RadialGradient) {\r\n\t\tthis.setStroke(value);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets actual `stroke` property on the SVG element, including applicable\r\n\t * color modifiers.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value Stroke setting\r\n\t */\r\n\tprotected setStroke(value: Color | Pattern | LinearGradient | RadialGradient) {\r\n\t\tif (!$type.isObject(value) || \"r\" in value) {\r\n\t\t\tvalue = toColor(value);\r\n\t\t}\r\n\r\n\t\tif (this.setColorProperty(\"stroke\", value) || this.strokeModifier) {\r\n\r\n\t\t\t// this can not go into next if, as value is turned to Gradient\r\n\t\t\tif (value instanceof Color) {\r\n\t\t\t\tif (this.strokeModifier) {\r\n\t\t\t\t\tvalue = this.strokeModifier.modify(value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.realStroke = value;\r\n\r\n\t\t\tif (value instanceof Color) {\r\n\t\t\t\tif (value.hex == \"none\") {\r\n\t\t\t\t\tthis.removeSVGAttribute(\"stroke\");\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.setSVGAttribute({ \"stroke\": value.toString() });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (!$type.hasValue(value)) {\r\n\t\t\t\tthis.removeSVGAttribute(\"stroke\");\r\n\t\t\t}\r\n\t\t\telse if (<any>value instanceof Pattern || <any>value instanceof LinearGradient || <any>value instanceof RadialGradient) {\r\n\t\t\t\tlet stroke = value;\r\n\t\t\t\tstroke.paper = this.paper;\r\n\t\t\t\tthis.setSVGAttribute({ \"stroke\": \"url(\\\"\" + $utils.getBaseURI() + stroke.id + \"\\\")\" });\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Stroke setting\r\n\t */\r\n\tpublic get stroke(): Color | Pattern | LinearGradient | RadialGradient {\r\n\t\treturn this.getPropertyValue(\"stroke\");\r\n\t}\r\n\r\n\t/**\r\n\t * Stroke (outline) opacity.\r\n\t *\r\n\t * The values may range from 0 (fully transparent) to 1 (fully opaque).\r\n\t *\r\n\t * @param value  Opacity (0-1)\r\n\t */\r\n\tpublic set strokeOpacity(value: number) {\r\n\t\tvalue = $math.toNumberRange(value, 0, 1);\r\n\t\tif (this.setPropertyValue(\"strokeOpacity\", value)) {\r\n\t\t\tthis.setSVGAttribute({ \"stroke-opacity\": value });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Opacity (0-1)\r\n\t */\r\n\tpublic get strokeOpacity(): number {\r\n\t\treturn this.getPropertyValue(\"strokeOpacity\");\r\n\t}\r\n\r\n\t/**\r\n\t * Controls if the element's stroke (outline) should remain keep constant\r\n\t * thicnkess and do not scale when the whole element is resized.\r\n\t *\r\n\t * @param value  Do not scale stroke (outline)\r\n\t */\r\n\tpublic set nonScalingStroke(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.setPropertyValue(\"nonScalingStroke\", value)) {\r\n\t\t\tthis.strokeWidth = this.strokeWidth;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Do not scale stroke (outline)\r\n\t */\r\n\tpublic get nonScalingStroke(): boolean {\r\n\t\treturn this.getPropertyValue(\"nonScalingStroke\");\r\n\t}\r\n\r\n\t/**\r\n\t * Controls if element should keep constant size and not scale even if there is\r\n\t * space available, or it does not fit.\r\n\t *\r\n\t * @param value  Is element scaleable?\r\n\t */\r\n\tpublic set nonScaling(value: boolean) {\r\n\t\t// @todo Description (review)\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tthis.setPropertyValue(\"nonScaling\", value, false, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Is element scaleable?\r\n\t */\r\n\tpublic get nonScaling(): boolean {\r\n\t\treturn this.getPropertyValue(\"nonScaling\");\r\n\t}\r\n\r\n\t/**\r\n\t * Stroke (outline) thickness in pixels.\r\n\t *\r\n\t * @param value  Thickness (px)\r\n\t */\r\n\tpublic set strokeWidth(value: number) {\r\n\t\tvalue = $type.toNumber(value);\r\n\t\tthis.setPropertyValue(\"strokeWidth\", value, true);\r\n\r\n\t\tif (this.nonScalingStroke) {\r\n\t\t\tif (!$type.isNumber(value)) {\r\n\t\t\t\tvalue = 1;\r\n\t\t\t}\r\n\t\t\tvalue = value / this.globalScale;\r\n\t\t}\r\n\t\tthis.setSVGAttribute({ \"stroke-width\": value });\r\n\t}\r\n\r\n\t/**\r\n\t * @return Thickness (px)\r\n\t */\r\n\tpublic get strokeWidth(): number {\r\n\t\treturn this.getPropertyValue(\"strokeWidth\");\r\n\t}\r\n\r\n\t/**\r\n\t * A `stroke-dasharray` for the stroke (outline).\r\n\t *\r\n\t * \"Dasharray\" allows setting rules to make lines dashed, dotted, etc.\r\n\t *\r\n\t * @see {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-dasharray} for more info on `stroke-dasharray`\r\n\t * @param value  `stroke-dasharray`\r\n\t */\r\n\tpublic set strokeDasharray(value: string) {\r\n\t\tvalue = $type.toText(value);\r\n\t\tif (this.setPropertyValue(\"strokeDasharray\", value)) {\r\n\t\t\tthis.setSVGAttribute({ \"stroke-dasharray\": value });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return `stroke-dasharray`\r\n\t */\r\n\tpublic get strokeDasharray(): string {\r\n\t\treturn this.getPropertyValue(\"strokeDasharray\");\r\n\t}\r\n\r\n\t/**\r\n\t * A `stroke-dashoffset` for the stroke (outline).\r\n\t *\r\n\t * \"Dashoffset\" allows setting the start position of the dashes if\r\n\t * `strokeDasharray` is used.\r\n\t *\r\n\t * @see {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-dashoffset} for more info on `stroke-dashoffset`\r\n\t * @param value  `stroke-dashoffset`\r\n\t */\r\n\tpublic set strokeDashoffset(value: number) {\r\n\t\tvalue = $type.toNumber(value);\r\n\t\tif (this.setPropertyValue(\"strokeDashoffset\", value)) {\r\n\t\t\tthis.setSVGAttribute({ \"stroke-dashoffset\": value });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return `stroke-dashoffset`\r\n\t */\r\n\tpublic get strokeDashoffset(): number {\r\n\t\treturn this.getPropertyValue(\"strokeDashoffset\");\r\n\t}\r\n\r\n\t/**\r\n\t * A `stroke-linecap` to indicate how line ends are drawn.\r\n\t *\r\n\t * @see {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Fills_and_Strokes#Stroke} for more info on `stroke-linecap`\r\n\t * @param value  `stroke-linecap`\r\n\t */\r\n\tpublic set strokeLinecap(value: \"butt\" | \"square\" | \"round\") {\r\n\t\tif (this.setPropertyValue(\"strokeLinecap\", value)) {\r\n\t\t\tthis.setSVGAttribute({ \"stroke-linecap\": value });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return `stroke-linecap`\r\n\t */\r\n\tpublic get strokeLinecap(): \"butt\" | \"square\" | \"round\" {\r\n\t\treturn this.getPropertyValue(\"strokeLinecap\");\r\n\t}\r\n\r\n\t/**\r\n\t * A `stroke-linejoin` to indicate how line ends are drawn.\r\n\t *\r\n\t * @see {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Fills_and_Strokes#Stroke} for more info on `stroke-linejoin`\r\n\t * @param value  `stroke-linejoin`\r\n\t */\r\n\tpublic set strokeLinejoin(value: \"miter\" | \"round\" | \"bevel\") {\r\n\t\tif (this.setPropertyValue(\"strokeLinejoin\", value)) {\r\n\t\t\tthis.setSVGAttribute({ \"stroke-linejoin\": value });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return `stroke-linejoin`\r\n\t */\r\n\tpublic get strokeLinejoin(): \"miter\" | \"round\" | \"bevel\" {\r\n\t\treturn this.getPropertyValue(\"strokeLinejoin\");\r\n\t}\r\n\r\n\t/**\r\n\t * An SVG-specific `shape-rendering` value.\r\n\t *\r\n\t * `shape-rendering` controls how vector graphics are drawn and rendered.\r\n\t *\r\n\t * @see {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/shape-rendering} for more information about `shape-rendering`\r\n\t * @default \"auto\"\r\n\t * @param value  'shape-rendering' value\r\n\t */\r\n\tpublic set shapeRendering(value: ShapeRendering) {\r\n\t\tvalue = <ShapeRendering>$type.toText(value);\r\n\t\tif (this.setPropertyValue(\"shapeRendering\", value)) {\r\n\t\t\tthis.setSVGAttribute({ \"shape-rendering\": value });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return 'shape-rendering' value\r\n\t */\r\n\tpublic get shapeRendering(): ShapeRendering {\r\n\t\treturn this.getPropertyValue(\"shapeRendering\");\r\n\t}\r\n\r\n\t/**\r\n\t * Controls if SVG vectors should be drawn with \"pixel\" precision, producing\r\n\t * perfectly crisp lines on retina displays.\r\n\t *\r\n\t * Setting this to `true` might improve visual quality, but may have a\r\n\t * negative effect on performance.\r\n\t *\r\n\t * Different elements use different default setting for `pixelPerfect`.\r\n\t *\r\n\t * We recommend leaving this at their default settings, unless there's a\r\n\t * specific need.\r\n\t *\r\n\t * @param value  Use pixel perfect?\r\n\t */\r\n\tpublic set pixelPerfect(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (value) {\r\n\t\t\tthis._positionPrecision = options.pixelPerfectPrecision;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._positionPrecision = 3;\r\n\t\t}\r\n\r\n\t\tthis.setPropertyValue(\"pixelPerfect\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Use pixel perfect?\r\n\t */\r\n\tpublic get pixelPerfect(): boolean {\r\n\t\treturn this.getPropertyValue(\"pixelPerfect\");\r\n\t}\r\n\r\n\t/**\r\n\t * An RTL (right-to-left) setting.\r\n\t *\r\n\t * RTL may affect alignment, text, and other visual properties.\r\n\t *\r\n\t * If you set this on a top-level chart object, it will be used for all\r\n\t * child elements, e.g. labels, unless they have their own `rtl` setting\r\n\t * set directly on them.\r\n\t *\r\n\t * @param value  `true` for to use RTL\r\n\t */\r\n\tpublic set rtl(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (this.isBaseSprite) {\r\n\t\t\tthis.topParent.rtl = value;\r\n\t\t}\r\n\t\tthis._rtl = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return RTL?\r\n\t */\r\n\tpublic get rtl(): boolean {\r\n\t\tif ($type.hasValue(this._rtl)) {\r\n\t\t\treturn this._rtl;\r\n\t\t}\r\n\t\telse if (this._topParent) {\r\n\t\t\treturn this._topParent.rtl;\r\n\t\t}\r\n\t\t//this.rtl = false;\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * VISIBILITY AND ORDER PROPERTIES AND RELATED STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n \t * Reveals hidden element.\r\n \t *\r\n \t * Has no effect if element is already visible.\r\n \t *\r\n \t * If `duration` is not specified, it will use default.\r\n \t *\r\n \t * @param duration  Fade in duration (ms)\r\n \t * @return Animation object if such object was created\r\n \t */\r\n\tpublic show(duration?: number): $type.Optional<Animation> {\r\n\t\treturn this.showReal(duration);\r\n\t}\r\n\r\n\t/**\r\n\t * Performs actual operations to reveal this element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param duration Fade in duration (ms)\r\n\t * @return Fade in duration (ms)\r\n\t */\r\n\tprotected showReal(duration?: number): $type.Optional<Animation> {\r\n\t\tif (this.preventShow) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet transition: $type.Optional<Animation>;\r\n\r\n\t\tconst properties = this.defaultState.properties;\r\n\r\n\t\tif (!this.disabled && (this.isHidden || !this.visible || this.isHiding || (properties.opacity != null && this.opacity < properties.opacity && !this.isShowing)) && !this.isDisposed()) {\r\n\r\n\t\t\t// helps to avoid flicker, as show might change opacity or visibility but item might be at invalid state/position\r\n\t\t\tif (this.invalid) {\r\n\t\t\t\tthis.validate();\r\n\t\t\t}\r\n\r\n\t\t\tif (this.positionInvalid) {\r\n\t\t\t\tthis.validatePosition();\r\n\t\t\t}\r\n\r\n\t\t\tif (!$type.isNumber(duration)) {\r\n\t\t\t\tduration = this.defaultState.transitionDuration;\r\n\t\t\t}\r\n\r\n\t\t\tif (this._hideAnimation) {\r\n\t\t\t\tthis._hideAnimation.kill();\r\n\t\t\t\tthis._hideAnimation = undefined;\r\n\t\t\t}\r\n\r\n\t\t\t// Cancel hide handler just in case it was there\r\n\t\t\tif (this._showHideDisposer) {\r\n\t\t\t\tthis.removeDispose(this._showHideDisposer);\r\n\t\t\t}\r\n\r\n\t\t\tthis._isHidden = false;\r\n\t\t\tthis.isHiding = false;\r\n\t\t\tthis.isShowing = true;\r\n\r\n\t\t\t// Apply current state\r\n\t\t\ttransition = this.applyCurrentState(duration);\r\n\r\n\t\t\tif (transition && !transition.isFinished()) {\r\n\r\n\t\t\t\tthis._showHideDisposer = transition.events.on(\"animationended\", () => {\r\n\t\t\t\t\tthis.isShowing = false;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis._disposers.push(this._showHideDisposer);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.isShowing = false;\r\n\t\t\t}\r\n\t\t\t// Make it visible\r\n\t\t\tlet visible = this.defaultState.properties.visible;\r\n\t\t\tif (!$type.hasValue(visible)) {\r\n\t\t\t\tvisible = true;\r\n\t\t\t}\r\n\t\t\tthis.visible = visible;\r\n\r\n\t\t\t// Unhide from screen readers\r\n\t\t\tthis.readerHidden = false;\r\n\r\n\t\t\t// Dispatch \"show\" event\r\n\t\t\tthis.dispatchImmediately(\"shown\");\r\n\t\t}\r\n\r\n\t\treturn transition;\r\n\t}\r\n\r\n\t/**\r\n\t * Initiates hiding of Sprite.\r\n\t * When called it will fade out the the Sprite to transparency, then make it\r\n\t * invisible.\r\n\t * @param duration Duration in millisecons\r\n\t */\r\n\r\n\t/**\r\n\t * Hides the element, by applying `hidden` state.\r\n\t *\r\n\t * Has no effect if element is already hidden.\r\n \t *\r\n \t * If `duration` is not specified, it will use default.\r\n \t *\r\n \t * While element is fading out, its `isHiding` property will resolve to\r\n \t * `true`.\r\n \t *\r\n \t * When element is hidden, its `visible` property will resolve to `false`.\r\n\t *\r\n\t * @param duration  Fade out duration (ms)\r\n\t * @return hide Animation object if such object was created\r\n\t */\r\n\tpublic hide(duration?: number): $type.Optional<Animation> {\r\n\t\treturn this.hideReal(duration);\r\n\t}\r\n\r\n\t/**\r\n\t * Hides actual SVG elements and handles hiding animations.\r\n\t *\r\n\t * @param duration  Fade out duration (ms)\r\n\t * @return Fade out duration (ms)\r\n\t * @ignore\r\n\t */\r\n\tprotected hideReal(duration?: number): $type.Optional<Animation> {\r\n\t\tlet transition: $type.Optional<Animation>;\r\n\r\n\t\tif (!this.isHiding && this.visible && !this.isDisposed()) {\r\n\t\t\t// added to solve 51375\r\n\t\t\tif (this.tooltip && this.tooltip.currentSprite == this) {\r\n\t\t\t\tthis.hideTooltip(0);\r\n\t\t\t}\r\n\r\n\t\t\tif (this._hideAnimation) {\r\n\t\t\t\tthis._hideAnimation.kill();\r\n\t\t\t\tthis._hideAnimation = undefined;\r\n\t\t\t}\r\n\r\n\t\t\tthis.isShowing = false;\r\n\r\n\t\t\t// Cancel hide handler just in case it was there\r\n\t\t\tif (this._showHideDisposer) {\r\n\t\t\t\tthis.removeDispose(this._showHideDisposer);\r\n\t\t\t}\r\n\r\n\t\t\t// Get state\r\n\t\t\tlet hiddenState = this.hiddenState;\r\n\r\n\t\t\t// Transition to \"hidden\" state, provided Sprite has one set\r\n\t\t\tif (hiddenState) {\r\n\t\t\t\t// Yes, we have a \"hidden\" state\r\n\t\t\t\t// `setState` will return an `Animation` object which we can set\r\n\t\t\t\t// events on\r\n\t\t\t\ttransition = this.setState(hiddenState, duration, undefined);\r\n\r\n\t\t\t\tif (transition && !transition.isFinished()) {\r\n\t\t\t\t\tthis._hideAnimation = transition;\r\n\t\t\t\t\tthis._showHideDisposer = transition.events.on(\"animationended\", () => {\r\n\t\t\t\t\t\tthis.isHiding = false;\r\n\t\t\t\t\t\tthis._isHidden = true;\r\n\t\t\t\t\t\tif (hiddenState.properties.visible == false) {\r\n\t\t\t\t\t\t\tthis.visible = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, this);\r\n\r\n\t\t\t\t\tthis._disposers.push(this._showHideDisposer);\r\n\r\n\t\t\t\t\t// Thrown everything into `_disposers` just in case Sprite gets\r\n\t\t\t\t\t// destroyed in the meantime\r\n\t\t\t\t\tthis._disposers.push(transition);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.isHiding = false;\r\n\t\t\t\t\tthis._isHidden = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// No hidden state, let's just set `visible` and call it a day\r\n\t\t\t\tthis.visible = false;\r\n\t\t\t\tthis.isHiding = false;\r\n\t\t\t\tthis._isHidden = true;\r\n\t\t\t}\r\n\r\n\t\t\t// Hide from screen readers\r\n\t\t\tthis.readerHidden = true;\r\n\r\n\t\t\t// Dispach \"hidden\" event\r\n\t\t\tthis.dispatchImmediately(\"hidden\");\r\n\t\t\tthis.invalidate(); // hide it at once to avoid flickers // validate() causes SO\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(duration)) {\r\n\t\t\tduration = this.hiddenState.transitionDuration;\r\n\t\t}\r\n\r\n\t\treturn transition;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if element is current visible (`true`) or hidden (`false`).\r\n\t *\r\n\t * @param value Visible?\r\n\t */\r\n\tpublic set visible(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tthis.setVisibility(value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Visible?\r\n\t */\r\n\tpublic get visible(): boolean {\r\n\t\treturn this.getVisibility();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns visibility value\r\n\t * @ignore\r\n\t */\r\n\tprotected getVisibility(): boolean {\r\n\t\tlet value = this.getPropertyValue(\"visible\");\r\n\t\tif (!$type.hasValue(value)) {\r\n\t\t\tvalue = true;\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Sets `visibility` property:\r\n\t *\r\n\t * * `true` - visible\r\n\t * * `false` - hidden\r\n\t *\r\n\t * @param value  true - visible, false - hidden\r\n\t * @return Current visibility\r\n\t */\r\n\tpublic setVisibility(value: boolean) {\r\n\t\tif (this.setPropertyValue(\"visible\", value)) {\r\n\t\t\tif (value) {\r\n\t\t\t\tthis.group.removeAttr(\"visibility\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.group.attr({ \"visibility\": \"hidden\" });\r\n\t\t\t}\r\n\t\t\t//this.invalidatePosition();\r\n\r\n\t\t\tif (this.events.isEnabled(\"visibilitychanged\")) {\r\n\t\t\t\tconst event: AMEvent<this, ISpriteEvents>[\"visibilitychanged\"] = {\r\n\t\t\t\t\ttype: \"visibilitychanged\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tvisible: value\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"visibilitychanged\", event);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A \"zIndex\" of the element.\r\n\t *\r\n\t * \"zIndex\" determines the order of how elements are placed over each other.\r\n\t *\r\n\t * Higher \"zIndex\" will mean the element will be draw on top of elements\r\n\t * with lower \"zIndexes\".\r\n\t *\r\n\t * @param value  zIndex\r\n\t */\r\n\tpublic set zIndex(value: number) {\r\n\t\tvalue = $type.toNumber(value);\r\n\t\tif (this.setPropertyValue(\"zIndex\", value)) {\r\n\t\t\tthis.dispatch(\"zIndexChanged\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return zIndex\r\n\t */\r\n\tpublic get zIndex(): number {\r\n\t\treturn this.getPropertyValue(\"zIndex\");\r\n\t}\r\n\r\n\t/**\r\n\t * Moves the element to the very top in element order, so that it appears\r\n\t * in front of other elements.\r\n\t */\r\n\tpublic toFront(): void {\r\n\t\tlet parent = this._parent;\r\n\t\tif (parent && parent.children.indexOf(this) != parent.children.length - 1) {\r\n\t\t\tparent.children.moveValue(this, parent.children.length - 1);\r\n\t\t\tthis.dispatch(\"zIndexChanged\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Moves the element to the very bottom in the element order, so that it\r\n\t * appears behind other elements.\r\n\t */\r\n\tpublic toBack(): void {\r\n\t\tlet parent = this._parent;\r\n\t\tif (parent && parent.children.indexOf(this) != 0) {\r\n\t\t\tparent.children.moveValue(this, 0);\r\n\t\t\tthis.dispatch(\"zIndexChanged\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A custom class name to set on the element.\r\n\t *\r\n\t * If set, the value will be added to element's `class` attribute.\r\n\t *\r\n\t * @since 4.9.11\r\n\t * @param  value  Class name\r\n\t */\r\n\tpublic set userClassName(value: string) {\r\n\t\tif (this.setPropertyValue(\"userClassName\", value)) {\r\n\t\t\tif (!value && this.userClassName) {\r\n\t\t\t\tthis.group.removeClass(this.userClassName);\r\n\t\t\t}\r\n\t\t\tthis.setClassName();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Class name\r\n\t */\r\n\tpublic get userClassName(): string {\r\n\t\treturn this.getPropertyValue(\"userClassName\");\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * TOOLTIP-RELATED PROPERTIES STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * A [[Tooltip]] object to be used when displayed rollover information for\r\n\t * the element.\r\n\t *\r\n\t * @param tooltip  Tooltip\r\n\t */\r\n\tpublic set tooltip(tooltip: $type.Optional<Tooltip>) {\r\n\t\tif (this._tooltip) {\r\n\t\t\t//this._tooltip.dispose();\r\n\t\t\tthis.removeDispose(this._tooltip);\r\n\t\t}\r\n\r\n\t\tthis._tooltip = tooltip;\r\n\r\n\t\tif (tooltip) {\r\n\t\t\ttooltip.parent = this.tooltipContainer;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tooltip\r\n\t */\r\n\tpublic get tooltip(): $type.Optional<Tooltip> {\r\n\t\tif (this._tooltip) {\r\n\t\t\treturn this._tooltip;\r\n\t\t}\r\n\t\telse if (this.virtualParent) {\r\n\t\t\treturn this.virtualParent.tooltip;\r\n\t\t}\r\n\t\telse if (this._parent) {\r\n\t\t\treturn this._parent.tooltip;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A [[DataItem]] to use when populating content for the element's\r\n\t * [[Tooltip]].\r\n\t *\r\n\t * @see {@link Tooltip}\r\n\t * @see {@link DataItem}\r\n\t * @param value  Tooltip data item\r\n\t */\r\n\tpublic set tooltipDataItem(value: DataItem) {\r\n\t\t// important: do not dispose tooltip dataItem, as it is some actual data item from data!\r\n\t\tthis._tooltipDataItem = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tooltip data item\r\n\t */\r\n\tpublic get tooltipDataItem(): DataItem {\r\n\t\tconst tooltipDataItem = this._tooltipDataItem;\r\n\r\n\t\tif (tooltipDataItem) {\r\n\t\t\treturn tooltipDataItem;\r\n\r\n\t\t} else {\r\n\t\t\treturn this.dataItem;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Sprite]] or sprite template to use when getting colors for tooltip. If a template is set,\r\n\t * tooltip will look for a clone in tooltipDataItem.sprites. If no clone is found, then template colors will be used.\r\n\t *\r\n\t * @see {@link Tooltip}\r\n\t * @see {@link Sprite}\r\n\t * @param sprite Sprite\r\n\t */\r\n\tpublic set tooltipColorSource(sprite: $type.Optional<Sprite>) {\r\n\t\tthis._tooltipColorSource = sprite;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tooltip color source\r\n\t */\r\n\tpublic get tooltipColorSource(): $type.Optional<Sprite> {\r\n\t\treturn this._tooltipColorSource;\r\n\t}\r\n\r\n\t/**\r\n\t * Shows the element's [[Tooltip]].\r\n\t *\r\n\t * A tooltip will be populated using text templates in either `tooltipHTML` or\r\n\t * `tooltipText` as well as data in `tooltipDataItem`.\r\n\t *\r\n\t * @see {@link Tooltip}\r\n\t * @param optional point (sprite-related) to which tooltip must point.\r\n\t * @return returns true if the tooltip was shown and false if it wasn't (no text was found)\r\n\t */\r\n\tpublic showTooltip(point?: IPoint): boolean {\r\n\r\n\t\tif (this.showTooltipOn == \"always\" && !this._tooltip && this.tooltip) {\r\n\t\t\tthis._tooltip = this.tooltip.clone();\r\n\t\t}\r\n\r\n\t\tif (!point && this.tooltipPosition == \"pointer\" && this.isHover) {\r\n\t\t\tpoint = $utils.documentPointToSvg(getInteraction().lastPointer.point, this.svgContainer.SVGContainer, this.svgContainer.cssScale);\r\n\t\t}\r\n\r\n\t\t// do not show if hidden\r\n\t\tlet sprite: Sprite = this;\r\n\t\twhile (sprite != undefined) {\r\n\t\t\tif (!sprite.visible || sprite.disabled || sprite.__disabled) {\r\n\t\t\t\tif (this._tooltip && this._tooltip.visible) {\r\n\t\t\t\t\tthis._tooltip.hide(0);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tsprite = sprite.parent;\r\n\t\t}\r\n\r\n\t\tif ($type.hasValue(this.tooltipText) || $type.hasValue(this.tooltipHTML)) {\r\n\t\t\tlet tooltip = this.tooltip;\r\n\t\t\tlet tooltipDataItem = this.tooltipDataItem;\r\n\r\n\t\t\tif (tooltip) {\r\n\r\n\t\t\t\ttooltip.targetSprite = this;\r\n\r\n\t\t\t\tlet colorSource: Sprite = this;\r\n\t\t\t\tlet tooltipColorSource = this.tooltipColorSource;\r\n\t\t\t\tif ((tooltip.getStrokeFromObject || tooltip.getFillFromObject) && tooltipColorSource) {\r\n\t\t\t\t\tif (tooltipColorSource.isTemplate) {\r\n\t\t\t\t\t\tif (tooltipDataItem) {\r\n\t\t\t\t\t\t\t$array.eachContinue(tooltipDataItem.sprites, (sprite) => {\r\n\t\t\t\t\t\t\t\tif (sprite.clonedFrom == tooltipColorSource) {\r\n\t\t\t\t\t\t\t\t\tcolorSource = sprite;\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tcolorSource = tooltipColorSource;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif (tooltip.getStrokeFromObject) {\r\n\t\t\t\t\tlet stroke = this.stroke;\r\n\t\t\t\t\tlet source: Sprite = colorSource;\r\n\r\n\t\t\t\t\twhile (source.parent != undefined) {\r\n\t\t\t\t\t\tstroke = source.stroke;\r\n\t\t\t\t\t\tif (stroke == undefined) {\r\n\t\t\t\t\t\t\tsource = source.parent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (stroke != undefined) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (stroke instanceof Color) {\r\n\t\t\t\t\t\ttooltip.background.animate({ property: \"stroke\", to: stroke }, tooltip.animationDuration);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttooltip.background.stroke = stroke;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set data item\r\n\t\t\t\ttooltip.dataItem = tooltipDataItem;\r\n\t\t\t\ttooltip.label.populateStringFrom = this;\r\n\r\n\t\t\t\tif (tooltip.getFillFromObject) {\r\n\r\n\t\t\t\t\tlet fill = this.fill;\r\n\r\n\t\t\t\t\tlet source: Sprite = colorSource;\r\n\r\n\t\t\t\t\twhile (source.parent != undefined) {\r\n\t\t\t\t\t\tfill = source.fill;\r\n\t\t\t\t\t\tif (fill == undefined || (fill instanceof Color && fill.rgb == undefined)) {\r\n\t\t\t\t\t\t\tsource = source.parent;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (fill != undefined) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (fill == undefined) {\r\n\t\t\t\t\t\tfill = color(\"#000000\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (fill instanceof Color) {\r\n\t\t\t\t\t\tif (!tooltip.visible) {\r\n\t\t\t\t\t\t\ttooltip.background.fill = fill;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\ttooltip.background.animate({ property: \"fill\", to: fill }, tooltip.animationDuration);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttooltip.background.fill = fill;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (tooltip.autoTextColor && fill instanceof Color) {\r\n\t\t\t\t\t\ttooltip.label.fill = fill.alternative;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Apply tooltip text\r\n\t\t\t\tlet text = \"\";\r\n\t\t\t\tif (this.tooltipHTML) {\r\n\t\t\t\t\ttooltip.html = this.tooltipHTML;\r\n\t\t\t\t\ttext = this.tooltipHTML;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.tooltipText) {\r\n\t\t\t\t\ttooltip.text = this.tooltipText;\r\n\t\t\t\t\ttext = this.tooltipText;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.updateTooltipPosition(point)) {\r\n\r\n\t\t\t\t\t// Set accessibility option\r\n\t\t\t\t\ttooltip.readerDescribedBy = this.uidAttr();\r\n\r\n\t\t\t\t\t// make label to render to be able to check currentText\r\n\t\t\t\t\tif (tooltip.label.invalid) {\r\n\t\t\t\t\t\ttooltip.label.validate();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (text != undefined && text != \"\" && tooltip.label.currentText != \"\") {\r\n\r\n\t\t\t\t\t\t//@todo: think of how to solve this better\r\n\t\t\t\t\t\tif (tooltip && !tooltip.parent) {\r\n\t\t\t\t\t\t\ttooltip.parent = this.tooltipContainer;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Reveal tooltip\r\n\t\t\t\t\t\t// showing it in 1 ms helps to avoid strange flickering in IE\r\n\t\t\t\t\t\tlet duration = tooltip.defaultState.transitionDuration;\r\n\t\t\t\t\t\tif (duration <= 0) {\r\n\t\t\t\t\t\t\tduration = 1;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttooltip.show(duration);\r\n\t\t\t\t\t\ttooltip.currentSprite = this;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.hideTooltip(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.hideTooltip(0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected updateTooltipPosition(point?: IPoint): boolean {\r\n\t\tif (this.tooltipPosition == \"pointer\") {\r\n\r\n\t\t\tif (this._interactionDisposer) {\r\n\t\t\t\tthis._interactionDisposer.dispose();\r\n\t\t\t}\r\n\r\n\t\t\tthis._interactionDisposer = getInteraction().body.events.on(\"track\", (ev) => {\r\n\t\t\t\treturn this.pointTooltipTo($utils.documentPointToSvg(ev.point, this.svgContainer.SVGContainer, this.svgContainer.cssScale), true);\r\n\t\t\t});\r\n\t\t\tif (point) {\r\n\t\t\t\treturn this.pointTooltipTo(point, true);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Point to the X/Y of this Sprite\r\n\t\t\tlet globalPoint = $utils.spritePointToSvg({\r\n\t\t\t\t\"x\": this.getTooltipX(),\r\n\t\t\t\t\"y\": this.getTooltipY()\r\n\t\t\t}, this);\r\n\t\t\treturn this.pointTooltipTo(globalPoint);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the point the [[Tooltip]] should point to.\r\n\t *\r\n\t * @param point      Coordinates to point to\r\n\t * @param instantly  Move instantly without animation\r\n\t */\r\n\tprotected pointTooltipTo(point: IPoint, instantly?: boolean): boolean {\r\n\t\tlet tooltip = this.tooltip;\r\n\t\tif (tooltip && this.topParent) {\r\n\r\n\t\t\tif (tooltip.showInViewport) {\r\n\t\t\t\ttooltip.pointTo(point, instantly);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tif ($math.isInRectangle(point, { x: 0, y: 0, width: this.topParent.maxWidth, height: this.topParent.maxHeight })) {\r\n\t\t\t\ttooltip.pointTo(point, instantly);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Hides element's [[Tooltip]].\r\n\t *\r\n\t * @see {@link Tooltip}\r\n\t */\r\n\tpublic hideTooltip(duration?: number): void {\r\n\r\n\t\tif (this.showTooltipOn == \"always\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet tooltip = this.tooltip;\r\n\t\tif (tooltip) {\r\n\t\t\tif (tooltip.targetSprite == this) {\r\n\t\t\t\ttooltip.targetSprite = undefined;\r\n\t\t\t}\r\n\t\t\ttooltip.hide(duration);\r\n\t\t\tif (this._interactionDisposer) {\r\n\t\t\t\tthis._interactionDisposer.dispose();\r\n\t\t\t\tthis._interactionDisposer = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * An HTML template to be used to populate [[Tooltip]] contents.\r\n\t *\r\n\t * If element has `tooltipDataItem` or `dataItem` set, this will be parsed\r\n\t * for any data values to be replaced with the values from respective data\r\n\t * items.\r\n\t *\r\n\t * @param value Tooltip HTML content template\r\n\t */\r\n\tpublic set tooltipHTML(value: string) {\r\n\t\tvalue = $type.toText(value);\r\n\t\tthis.hoverable = true;\r\n\t\tif (this.setPropertyValue(\"tooltipHTML\", value)) {\r\n\t\t\tif (this.tooltip) {\r\n\t\t\t\tif (this.tooltip.visible) {\r\n\t\t\t\t\tthis.showTooltip();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tooltip HTML content template\r\n\t */\r\n\tpublic get tooltipHTML(): string {\r\n\t\treturn this.getPropertyValue(\"tooltipHTML\");\r\n\t}\r\n\r\n\t/**\r\n\t * A text template to be used to populate Tooltip's contents.\r\n\t *\r\n\t * If element has `tooltipDataItem` or `dataItem` set, this will be parsed\r\n\t * for any data values to be replaced with the values from respective data\r\n\t * items.\r\n\t *\r\n\t * This template will also be parsed for any special formatting tags.\r\n\t *\r\n\t * @param value Tooltip content template\r\n\t * @see {@link TextFormatter}\r\n\t */\r\n\tpublic set tooltipText(value: string) {\r\n\t\tvalue = $type.toText(value);\r\n\t\tif (value) {\r\n\t\t\tthis.hoverable = true;\r\n\t\t}\r\n\t\tif (this.setPropertyValue(\"tooltipText\", value)) {\r\n\t\t\tif (this.tooltip) {\r\n\t\t\t\tif (this.tooltip.visible) {\r\n\t\t\t\t\tthis.showTooltip();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tooltip content template\r\n\t */\r\n\tpublic get tooltipText(): string {\r\n\t\treturn this.getPropertyValue(\"tooltipText\");\r\n\t}\r\n\r\n\t/**\r\n\t * A container reference that should be used to place element's\r\n\t * [[Tooltip]] in.\r\n\t *\r\n\t * Will use parent's container if does not have one set.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value Container\r\n\t * @todo Dispose of the old _tooltipContainer ?\r\n\t */\r\n\tpublic set tooltipContainer(value: $type.Optional<Container>) {\r\n\t\tthis._tooltipContainer = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Container\r\n\t */\r\n\tpublic get tooltipContainer(): $type.Optional<Container> {\r\n\t\tif (this._tooltipContainer) {\r\n\t\t\treturn this._tooltipContainer;\r\n\t\t}\r\n\t\telse if (this._parent) {\r\n\t\t\treturn this._parent.tooltipContainer;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * X coordinate the [[Tooltip]] should be shown at.\r\n\t *\r\n\t * @param value  Tooltip X (px)\r\n\t */\r\n\tpublic set tooltipX(value: number | Percent) {\r\n\t\tif (this.setPercentProperty(\"tooltipX\", value) && this.tooltip) {\r\n\t\t\tthis.tooltip.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tooltip X (px)\r\n\t */\r\n\tpublic get tooltipX(): number | Percent {\r\n\t\treturn this.getTooltipX();\r\n\t}\r\n\r\n\t/**\r\n\t * DEPRECATION NOTICE: This setting is deprecated in favor of a more flexible\r\n\t * setting: `showTooltipOn`. Please use `showTooltipOn = \"always\"` instead.\r\n\t *\r\n\t * Indicates if this element should display a tooltip permanently.\r\n\t *\r\n\t * Useful, if you want to show permanent tooltips on some items.\r\n\t *\r\n\t * @default false\r\n\t * @since 4.5.4\r\n\t * @deprecated Use `showTooltipOn = \"always\"` instead\r\n\t * @param  value  Always show tooltip?\r\n\t */\r\n\tpublic set alwaysShowTooltip(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tif (value) {\r\n\t\t\tthis.showTooltipOn = \"always\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Always show tooltip?\r\n\t */\r\n\tpublic get alwaysShowTooltip(): boolean {\r\n\t\treturn this.getPropertyValue(\"showTooltipOn\") == \"always\";\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates when tooltip needs to be shown on this element:\r\n\t *\r\n\t * * `\"hover\"` (default) - Tooltip will be shown when element is hovered on.\r\n\t * * `\"hit\"` - Tooltip will be shown when element is clicked/tapped. Tooltip will be hidden when clicked/tapped anywhere else.\r\n\t * * `\"always\"` - Tooltip will be shown on the element permanently.\r\n\t *\r\n\t * For example, if you would like to show tooltips on all of the columns of\r\n\t * a [[ColumnSeries]]:\r\n\t *\r\n\t * ```TypeScript\r\n\t * series.columns.template.showTooltipOn = \"always\";\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * series.columns.template.showTooltipOn = \"always\";\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"series\": [{\r\n\t *     // ...\r\n\t *     \"columns\": {\r\n\t *       \"showTooltipOn\": \"always\"\r\n\t *     }\r\n\t *   }]\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * It can even be set to display on a selected columns via `propertyFields`:\r\n\t *\r\n\t * ```TypeScript\r\n\t * series.columns.template.propertyFields.showTooltipOn = \"tooltip\";\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * series.columns.template.propertyFields.showTooltipOn = \"tooltip\";\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"series\": [{\r\n\t *     // ...\r\n\t *     \"columns\": {\r\n\t *       \"propertyFields\": {\r\n\t *         \"showTooltipOn\": \"tooltip\"\r\n\t *       }\r\n\t *     }\r\n\t *   }]\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @default \"hover\"\r\n\t * @since 4.7.9\r\n\t * @param  value  When to show tooltip\r\n\t */\r\n\tpublic set showTooltipOn(value: \"hover\" | \"hit\" | \"always\") {\r\n\t\tif (this.setPropertyValue(\"showTooltipOn\", value)) {\r\n\t\t\tif (value == \"hit\") {\r\n\t\t\t\tthis.clickable = true;\r\n\t\t\t}\r\n\t\t\tif (this.tooltip) {\r\n\t\t\t\tif (value == \"always\") {\r\n\t\t\t\t\tthis.showTooltip();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.handleAlwaysShowTooltip();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return When to show tooltip\r\n\t */\r\n\tpublic get showTooltipOn(): \"hover\" | \"hit\" | \"always\" {\r\n\t\treturn this.getPropertyValue(\"showTooltipOn\");\r\n\t}\r\n\r\n\t/**\r\n\t * Specifies if [[Tooltip]] should follow the mouse or touch pointer or stay\r\n\t * at the fixed position.\r\n\t *\r\n\t * @param value  Position\r\n\t */\r\n\tpublic set tooltipPosition(value: \"fixed\" | \"pointer\") {\r\n\t\tthis.setPropertyValue(\"tooltipPosition\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * Position\r\n\t */\r\n\tpublic get tooltipPosition(): \"fixed\" | \"pointer\" {\r\n\t\treturn this.getPropertyValue(\"tooltipPosition\");\r\n\t}\r\n\r\n\t/**\r\n\t * Y coordinate the [[Tooltip]] should be shown at.\r\n\t *\r\n\t * @param value  Tooltip Y (px)\r\n\t */\r\n\tpublic set tooltipY(value: number | Percent) {\r\n\t\tif (this.setPercentProperty(\"tooltipY\", value) && this.tooltip) {\r\n\t\t\tthis.tooltip.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tooltip Y (px)\r\n\t */\r\n\tpublic get tooltipY(): number | Percent {\r\n\t\treturn this.getTooltipY();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns Tooltip X coordinate if it's set, or middle of the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return X (px)\r\n\t */\r\n\tpublic getTooltipX(): number {\r\n\r\n\t\tlet x = this.getPropertyValue(\"tooltipX\");\r\n\r\n\t\tif (!$type.hasValue(x)) {\r\n\t\t\tx = percent(50);\r\n\t\t}\r\n\r\n\t\tlet value: number;\r\n\t\tif ($type.isNumber(x)) {\r\n\t\t\tvalue = x;\r\n\t\t}\r\n\r\n\t\tif (x instanceof Percent) {\r\n\t\t\tvalue = this.maxLeftSelf + this._measuredWidthSelf * x.value - this.pixelPaddingLeft - this.ex; // overflow is know only for measured items, so this is not always good\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(value)) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns Tooltip Y coordinate if it's set, or middle of the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Y (px)\r\n\t */\r\n\tpublic getTooltipY(): number {\r\n\t\tlet y = this.getPropertyValue(\"tooltipY\");\r\n\r\n\t\tif (!$type.hasValue(y)) {\r\n\t\t\ty = percent(50);\r\n\t\t}\r\n\r\n\t\tlet value: number;\r\n\t\tif ($type.isNumber(y)) {\r\n\t\t\tvalue = y;\r\n\t\t}\r\n\r\n\t\tif (y instanceof Percent) {\r\n\t\t\tvalue = this.maxTopSelf + this._measuredHeightSelf * y.value - this.pixelPaddingTop - this.ey;  // overflow is know only for measured items, so this is not always good\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(value)) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Displays a modal or console message with error, and halts any further\r\n\t * processing of this item.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param e Error\r\n\t * @todo Implement from applying further actions to this item\r\n\t */\r\n\tpublic raiseCriticalError(e: Error, closable?: boolean) {\r\n\r\n\t\tif (this.svgContainer) {\r\n\t\t\tif (!this._adapterO) {\r\n\t\t\t\tthis.modal.content = e.message;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.modal.content = this._adapterO.apply(\"criticalError\", e).message;\r\n\t\t\t}\r\n\r\n\t\t\tif (!closable) {\r\n\t\t\t\tthis.disabled = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.modal.closable = true;\r\n\t\t\t}\r\n\r\n\t\t\tif (!options.suppressErrors) {\r\n\t\t\t\tthis.modal.open();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (options.verbose) {\r\n\t\t\tconsole.log(e);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n * Processes JSON-based config before it is applied to the object.\r\n *\r\n * @ignore Exclude from docs\r\n * @param config  Config\r\n */\r\n\tpublic processConfig(config?: { [index: string]: any }): void {\r\n\r\n\t\tif (config) {\r\n\r\n\t\t\t// Tooltip color source\r\n\t\t\tif ($type.hasValue(config.tooltipColorSource) && $type.isString(config.tooltipColorSource) && this.map.hasKey(config.tooltipColorSource)) {\r\n\t\t\t\tconfig.tooltipColorSource = this.map.getKey(config.tooltipColorSource);\r\n\t\t\t}\r\n\r\n\t\t\t// Cursor styles\r\n\t\t\tif ($type.hasValue(config.cursorOverStyle) && $type.isString(config.cursorOverStyle)) {\r\n\t\t\t\tconfig.cursorOverStyle = this.getCursorStyle(config.cursorOverStyle);\r\n\t\t\t}\r\n\t\t\tif ($type.hasValue(config.cursorDowntyle) && $type.isString(config.cursorDowntyle)) {\r\n\t\t\t\tconfig.cursorDowntyle = this.getCursorStyle(config.cursorDowntyle);\r\n\t\t\t}\r\n\t\t\tif ($type.hasValue(config.cursorOptions)) {\r\n\t\t\t\tif ($type.hasValue(config.cursorOptions.overStyle) && $type.isString(config.cursorOptions.overStyle)) {\r\n\t\t\t\t\tconfig.cursorOptions.overStyle = this.getCursorStyle(config.cursorOptions.overStyle);\r\n\t\t\t\t}\r\n\t\t\t\tif ($type.hasValue(config.cursorOptions.downStyle) && $type.isString(config.cursorOptions.downStyle)) {\r\n\t\t\t\t\tconfig.cursorOptions.downStyle = this.getCursorStyle(config.cursorOptions.downStyle);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tsuper.processConfig(config);\r\n\r\n\t\tthis.processDelayedMap();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Converts string name of the cursor into actual [[MouseCursorStyle]].\r\n\t *\r\n\t * @param style  Cursor type\r\n\t * @return Cursor definition\r\n\t */\r\n\tprivate getCursorStyle(style: string): MouseCursorStyle {\r\n\t\tswitch (style) {\r\n\t\t\tcase \"grab\":\r\n\t\t\t\treturn MouseCursorStyle.grab;\r\n\t\t\tcase \"grabbing\":\r\n\t\t\t\treturn MouseCursorStyle.grabbing;\r\n\t\t\tcase \"pointer\":\r\n\t\t\t\treturn MouseCursorStyle.pointer;\r\n\t\t\tcase \"horizontalResize\":\r\n\t\t\t\treturn MouseCursorStyle.horizontalResize;\r\n\t\t\tcase \"verticalResize\":\r\n\t\t\t\treturn MouseCursorStyle.verticalResize;\r\n\t\t\tdefault:\r\n\t\t\t\treturn MouseCursorStyle.default;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * This function is used to sort element's JSON config properties, so that\r\n\t * some properties that absolutely need to be processed last, can be put at\r\n\t * the end.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param a  Element 1\r\n\t * @param b  Element 2\r\n\t * @return Sorting number\r\n\t */\r\n\tprotected configOrder(a: string, b: string): Ordering {\r\n\t\tif (a == b) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\t// Must come last\r\n\t\telse if (a == \"tooltipColorSource\") {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\telse if (b == \"tooltipColorSource\") {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn super.configOrder(a, b);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * If `sprite.hide()` is called, we set isHidden to true when sprite is hidden.\r\n\t * This was added becaus hidden state might have visibility set to true and so\r\n\t * there would not be possible to find out if a sprite is technically hidden or not.\r\n\t */\r\n\tpublic get isHidden(): boolean {\r\n\t\tif (this._isHidden) {\r\n\t\t\treturn this._isHidden;\r\n\t\t}\r\n\t\telse if (this._parent) {\r\n\t\t\treturn this._parent.isHidden;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * If this is set to `true`, Sprite, when inited will be instantly hidden\r\n\t * (\"hidden\" state applied) and then shown (\"default\" state applied).\r\n\t *\r\n\t * If your \"default\" state's `transitionDuration > 0` this will result in\r\n\t * initial animation from \"hidden\" state to \"default\" state.\r\n\t *\r\n\t * If you need a Sprite which has `showOnInit = true` not to be shown\r\n\t * initially, set `sprite.hidden = true`. Setting `sprite.visible = false`\r\n\t * will not prevent the animation and the sprite will be shown.\r\n\t *\r\n\t * @param value show on init?\r\n\t */\r\n\tpublic set showOnInit(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tthis.setShowOnInit(value);\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected setShowOnInit(value: boolean) {\r\n\t\tif (this.setPropertyValue(\"showOnInit\", value)) {\r\n\t\t\tif (!this.isTemplate) {\r\n\t\t\t\tif (value && !this.inited && !this.hidden) {\r\n\t\t\t\t\tthis._showOnInitDisposer = new MultiDisposer([\r\n\t\t\t\t\t\tregistry.events.once(\"enterframe\", this.hideInitially, this),\r\n\t\t\t\t\t\tthis.events.once(\"beforevalidated\", this.hideInitially, this, false),\r\n\t\t\t\t\t\tthis.events.on(\"inited\", this.appear, this, false)\r\n\t\t\t\t\t])\r\n\r\n\t\t\t\t\tthis._disposers.push(this._showOnInitDisposer);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (this._showOnInitDisposer) {\r\n\t\t\t\t\t\tthis._showOnInitDisposer.dispose();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected hideInitially() {\r\n\t\tif (!this.isDisposed()) {\r\n\t\t\tthis.appeared = false;\r\n\t\t\t//if (!this.hidden && !this._isHidden) { // not good for series, as on enterframe it doesn't have data items yet.\r\n\t\t\tif (!this.inited) {\r\n\t\t\t\tthis.hide(0);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hides the chart instantly and then shows it. If defaultState.transitionDuration > 0, this will result an animation in which properties of hidden state will animate to properties of visible state.\r\n\t */\r\n\tpublic appear() {\r\n\t\tthis.appeared = false;\r\n\t\tif (!this.hidden && !this.isHidden) {\r\n\t\t\tthis.hide(0);\r\n\t\t}\r\n\t\tif (!this.hidden) {\r\n\r\n\t\t\tlet animation = this.show();\r\n\r\n\t\t\tif (animation && !animation.isFinished()) {\r\n\t\t\t\tthis.addDisposer(animation.events.on(\"animationended\", () => {\r\n\t\t\t\t\tthis.appeared = true;\r\n\t\t\t\t\tthis.dispatch(\"appeared\");\r\n\t\t\t\t}))\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.appeared = true;\r\n\t\t\t\tthis.dispatch(\"appeared\");\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.appeared = true;\r\n\t\t\tthis.dispatch(\"appeared\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Show on init?\r\n\t */\r\n\tpublic get showOnInit(): boolean {\r\n\t\treturn this.getPropertyValue(\"showOnInit\");\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * If a sprite has `showOnInit = true`, it will animate from \"hidden\" to\r\n\t * \"default\" state when initialized. To prevent this but keep\r\n\t * `showOnInit = true`, you can set `sprite.hidden = true`.\r\n\t *\r\n\t * @param value initially hidden?\r\n\t */\r\n\tpublic set hidden(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tthis.setPropertyValue(\"hidden\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Is initially hidden?\r\n\t */\r\n\tpublic get hidden(): boolean {\r\n\t\treturn this.getPropertyValue(\"hidden\");\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Returns bounding box (square) for this element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic get bbox(): IRectangle {\r\n\t\tif (this.definedBBox) {\r\n\t\t\treturn this.definedBBox;\r\n\t\t}\r\n\t\treturn this._bbox;\r\n\t}\r\n\r\n\t/**\r\n\t * A list of plugins (objects that implement [[IPlugin]] interface) attached\r\n\t * to this object.\r\n\t *\r\n\t * @since 4.2.2\r\n\t * @return List of plugins\r\n\t */\r\n\tpublic get plugins(): List<IPlugin> {\r\n\t\tif (!this._plugins) {\r\n\t\t\tthis._plugins = new List<IPlugin>();\r\n\t\t\tthis._disposers.push(this._plugins.events.on(\"inserted\", (ev) => {\r\n\t\t\t\tev.newValue.target = this;\r\n\t\t\t\tev.newValue.init();\r\n\t\t\t}));\r\n\t\t\tthis._disposers.push(new ListDisposer(this._plugins));\r\n\t\t}\r\n\t\treturn this._plugins;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Called during the System.update method\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic _systemUpdate(skippedSprites: Array<Sprite>) {\r\n\t\tthis.validate();\r\n\t}\r\n\r\n\t/**\r\n\t * Called during the System.update method\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic _systemCheckIfValidate(): boolean {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Called during the System.validatePositions method\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic _systemValidatePositions() {\r\n\t\tthis.validatePosition();\r\n\t}\r\n\r\n\t/**\r\n\t * Called during the System.validateLayouts method\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic _systemValidateLayouts() {\r\n\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Sprite\"] = Sprite;\r\n","/**\r\n * Base functionality\r\n*/\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { IClone } from \"./utils/Clone\";\r\nimport { List, ListTemplate } from \"./utils/List\";\r\nimport { OrderedListTemplate, SortedListTemplate } from \"./utils/SortedList\";\r\nimport { Dictionary, DictionaryTemplate } from \"./utils/Dictionary\";\r\nimport { Disposer, IDisposer } from \"./utils/Disposer\";\r\nimport { EventDispatcher, AMEvent } from \"./utils/EventDispatcher\";\r\nimport { Adapter } from \"./utils/Adapter\";\r\nimport { Color, color } from \"./utils/Color\";\r\nimport { Percent, percent } from \"./utils/Percent\";\r\nimport { ITheme } from \"../themes/ITheme\";\r\nimport { Ordering } from \"./utils/Order\";\r\n\r\nimport { registry } from \"./Registry\";\r\nimport { cache } from \"./utils/Cache\";\r\n\r\nimport * as $array from \"./utils/Array\";\r\nimport * as $object from \"./utils/Object\";\r\nimport * as $type from \"./utils/Type\";\r\n\r\n//import * as $debug from \"./utils/Debug\";\r\n\r\n/**\r\n * Provides base functionality for all derivative objects, like generating ids,\r\n * handling cache, etc.\r\n */\r\nexport class BaseObject implements IClone<BaseObject>, IDisposer {\r\n\r\n\t/**\r\n\t * A unique ID for this object.\r\n\t *\r\n\t * Generated on first access by `uid()` getter.\r\n\t */\r\n\tprotected _uid: $type.Optional<string>;\r\n\r\n\t/**\r\n\t * Indicates if this object has already been deleted. Any\r\n\t * destruction/disposal code should take this into account when deciding\r\n\t * wheter to run potentially costly disposal operations if they already have\r\n\t * been run.\r\n\t */\r\n\tprotected _disposed: boolean = false;\r\n\r\n\t/**\r\n\t * List of IDisposer which will be disposed when the BaseObject is disposed.\r\n\t */\r\n\tprotected _disposers: Array<IDisposer> = [];\r\n\r\n\t/**\r\n\t * User-defined id of the object.\r\n\t */\r\n\tprotected _id: $type.Optional<string>;\r\n\r\n\t/**\r\n\t * Holds a universal mapping collection, so that elements and their children\r\n\t * can create and look up all kinds of relations between id and object.\r\n\t */\r\n\tprotected _map: $type.Optional<Dictionary<string, any>>;\r\n\r\n\t/**\r\n\t * Holds mapping for objects referenced by id in JSON config that are not yet\r\n\t * available at processing time.\r\n\t */\r\n\tprotected _delayedMap: $type.Optional<Dictionary<string, any>>;\r\n\r\n\t/**\r\n\t * The theme used by this object.\r\n\t */\r\n\tprotected _themes: $type.Optional<ITheme[]>;\r\n\r\n\t// @review\r\n\t/**\r\n\t * A list of objects that are clones of this object. An object needs to\r\n\t * maintain a list of its clones so that properties can be re-applied to\r\n\t * clones whenever property on the object they were cloned from changes.\r\n\t */\r\n\tprotected _clones: $type.Optional<List<this>>;\r\n\r\n\r\n\t// @review\r\n\t/**\r\n\t * Reference to the original object this object was cloned from. We need to\r\n\t * keep this so we can disassociate it from source object when this object\r\n\t * is disposed.\r\n\t */\r\n\tpublic clonedFrom: $type.Optional<this>;\r\n\r\n\t/**\r\n\t * A class name for the object.\r\n\t *\r\n\t * This property is used by deriving classes to identify which class it is.\r\n\t * We could derive the class name from the object itself, however method of\r\n\t * doing so is too costly, so we are relying on this property to quickly\r\n\t * access type of class.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _className: $type.Optional<string>;\r\n\r\n\t/**\r\n\t * [cloneId description]\r\n\t *\r\n\t * @todo Needs description\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic cloneId: $type.Optional<string>;\r\n\r\n\t/**\r\n\t * Holds processing error list.\r\n\t */\r\n\tprotected _processingErrors: string[];\r\n\r\n\t//protected _classes: { [index: string]: any } = {};\r\n\r\n\t/**\r\n\t * Constructor\r\n\t * * Sets class name\r\n\t */\r\n\tconstructor() {\r\n\t\tthis.className = \"BaseObject\";\r\n\t\t//this.debug();\r\n\t}\r\n\r\n\tprotected debug(): void {\r\n\t\t//$debug.debug(this);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns object's internal unique ID.\r\n\t *\r\n\t * @return Unique ID\r\n\t */\r\n\tpublic get uid(): string {\r\n\t\tif (!this._uid) {\r\n\t\t\tthis._uid = registry.getUniqueId();\r\n\t\t\tregistry.map.setKey(this._uid, this);\r\n\t\t}\r\n\t\treturn this._uid;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the user-defined id of the element.\r\n\t *\r\n\t * @param value Id\r\n\t */\r\n\tpublic set id(value: $type.Optional<string>) {\r\n\t\t//registry.map.setKey(value, this); // registry.map only stores by uid\r\n\t\tthis._id = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Id\r\n\t */\r\n\tpublic get id(): $type.Optional<string> {\r\n\t\treturn this._id;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a universal collection for mapping ids with objects.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Map collection\r\n\t */\r\n\tpublic get map(): Dictionary<string, any> {\r\n\t\tif (!this._map) {\r\n\t\t\tthis._map = new Dictionary<string, any>();\r\n\t\t}\r\n\t\treturn this._map;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns mapping for objects referenced by id in JSON config that are not yet\r\n\t * available at processing time.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Map collection\r\n\t */\r\n\tpublic get delayedMap(): Dictionary<string, any> {\r\n\t\tif (!this._delayedMap) {\r\n\t\t\tthis._delayedMap = new Dictionary<string, any>();\r\n\t\t}\r\n\t\treturn this._delayedMap;\r\n\t}\r\n\r\n\t/**\r\n\t * Logs an id and property of the target element that is not yet available\r\n\t * for later assignment.\r\n\t * \r\n\t * @ignore\r\n\t * @param  property  Property to set\r\n\t * @param  id        ID of the target element\r\n\t */\r\n\tpublic addDelayedMap(property: string, id: string): void {\r\n\t\tconst map = this.delayedMap;\r\n\t\tif (!map.hasKey(id)) {\r\n\t\t\tmap.setKey(id, []);\r\n\t\t}\r\n\t\tconst list = map.getKey(id);\r\n\t\tlist.push({\r\n\t\t\tproperty: property,\r\n\t\t\ttarget: this\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Processes delayed JSON config items.\r\n\t * \r\n\t * @ignore\r\n\t */\r\n\tpublic processDelayedMap(): void {\r\n\t\tthis.delayedMap.each((id, list) => {\r\n\t\t\tif (this.map.hasKey(id)) {\r\n\t\t\t\tconst target = this.map.getKey(id);\r\n\t\t\t\t$array.each(list, (item: any) => {\r\n\t\t\t\t\titem.target[item.property] = target;\r\n\t\t\t\t});\r\n\t\t\t\tthis.delayedMap.removeKey(id);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Applies properties from all assigned themes.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic applyTheme(): void {\r\n\t\t// TODO is this needed ?\r\n\t\tif (registry) {\r\n\t\t\tlet themes = this.getCurrentThemes();\r\n\r\n\t\t\t// TODO is this needed ?\r\n\t\t\tif (themes) {\r\n\t\t\t\t$array.each(themes, (theme, index) => {\r\n\t\t\t\t\ttheme(this);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A list of themes to be used for this element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value An array of themes\r\n\t */\r\n\tpublic set themes(value: $type.Optional<ITheme[]>) {\r\n\t\tthis._themes = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return An array of themes\r\n\t */\r\n\tpublic get themes(): $type.Optional<ITheme[]> {\r\n\t\treturn this._themes;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a list of themes that should be applied to this element. It could\r\n\t * either be a list of themes set explicitly on this element, or system-wide.\r\n\t *\r\n\t * @return List of themes\r\n\t */\r\n\tpublic getCurrentThemes(): ITheme[] {\r\n\t\treturn this.themes || registry.themes;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns if this object has been already been disposed.\r\n\t *\r\n\t * @return Is disposed?\r\n\t */\r\n\tpublic isDisposed(): boolean {\r\n\t\treturn this._disposed;\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys this object and all related data.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tif (!this._disposed) {\r\n\t\t\tthis._disposed = true;\r\n\r\n\t\t\tconst a = this._disposers;\r\n\r\n\t\t\tthis._disposers = <any>null;\r\n\r\n\t\t\twhile (a.length !== 0) {\r\n\t\t\t\tconst disposer = a.shift();\r\n\t\t\t\tdisposer.dispose();\r\n\t\t\t}\r\n\r\n\t\t\t// Clear cache\r\n\t\t\tthis.clearCache();\r\n\r\n\t\t\t// remove from clones list\r\n\t\t\tif (this.clonedFrom) {\r\n\t\t\t\tthis.clonedFrom.clones.removeValue(this);\r\n\t\t\t}\r\n\r\n\t\t\tconst uid = this._uid;\r\n\r\n\t\t\tif (uid != null) {\r\n\t\t\t\tregistry.map.removeKey(uid);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an IDisposer, which will be disposed when this object is disposed.\r\n\t *\r\n\t * @param target Object to dispose\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic addDisposer(target: IDisposer): void {\r\n\t\tthis._disposers.push(target);\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes disposable object and removes it from `_disposers`.\r\n\t *\r\n\t * @param target Object to dispose\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic removeDispose(target: IDisposer): void {\r\n\t\t//if(target){\r\n\t\tif (!this._disposed) {\r\n\t\t\tlet index = $array.indexOf(this._disposers, target);\r\n\t\t\tif (index > -1) {\r\n\t\t\t\tthis._disposers.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttarget.dispose();\r\n\t\t//}\r\n\t}\r\n\r\n\t/**\r\n\t * Makes a copy of this object and returns the clone. Try to avoid cloning complex objects like chart, create new instances if you need them.\r\n\t *\r\n\t * @param cloneId  An id to use for clone (if not set a unique id will be generated)\r\n\t * @returns Clone\r\n\t */\r\n\tpublic clone<A extends this>(cloneId?: string): this {\r\n\t\tif (!cloneId) {\r\n\t\t\tcloneId = \"clone-\" + registry.getUniqueId();\r\n\t\t}\r\n\r\n\t\tlet newObject: this = new (<{ new(): A; }>this.constructor)();\r\n\t\tnewObject.cloneId = cloneId;\r\n\r\n\t\tnewObject.copyFrom(this);\r\n\r\n\t\t// add to clones list\r\n\t\t// this.clones.push(newObject); // moved this to copyFrom\r\n\r\n\r\n\t\treturn newObject;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a collection of object's clones.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Clones\r\n\t */\r\n\tpublic get clones(): List<this> {\r\n\t\tif (!this._clones) {\r\n\t\t\tthis._clones = new List<this>();\r\n\t\t}\r\n\t\treturn this._clones;\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all properties and related data from different element.\r\n\t *\r\n\t * @param object Source element\r\n\t */\r\n\tpublic copyFrom(object: this): void {\r\n\t\tobject.clones.push(this); // do not moveValue, as it is expensive! even if there will be several items in clones list, it's not that bad.\r\n\t\tthis.clonedFrom = object;\r\n\t}\r\n\r\n\t/**\r\n\t * Element's class name. (a class that was used to instantiate the element)\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value  Class name\r\n\t */\r\n\tpublic set className(value: $type.Optional<string>) {\r\n\t\tthis._className = value;\r\n\t\t/*if (registry) {\r\n\t\t\tregistry.registeredClasses[value] = typeof this;\r\n\t\t}*/\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Class name\r\n\t */\r\n\tpublic get className(): $type.Optional<string> {\r\n\t\treturn this._className;\r\n\t}\r\n\r\n\t/**\r\n\t * Caches value in object's cache.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param key    Key\r\n\t * @param value  Value\r\n\t * @param ttl    TTL in seconds\r\n\t */\r\n\tpublic setCache(key: string, value: any, ttl?: number): void {\r\n\t\tcache.set(this.uid, key, value, ttl);\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves cached value.\r\n\t *\r\n\t * If optional second padarameter is specified, it will return that value\r\n\t * if cache is not available or is expired.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param key    Key\r\n\t * @param value  Value to return if cache is not available\r\n\t * @return Value\r\n\t */\r\n\tpublic getCache(key: string, value: any = undefined): any {\r\n\t\treturn cache.get(this.uid, key, value);\r\n\t}\r\n\r\n\t/**\r\n\t * Clears object's local cache.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic clearCache(): void {\r\n\t\tcache.clear(this.uid);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates [[Disposer]] for `setTimeout` function call. This ensures that all\r\n\t * timeouts created by the object will be cleared when object itself is\r\n\t * disposed.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param fn     Callback function\r\n\t * @param delay  Timeout (ms)\r\n\t * @return Disposer for timeout\r\n\t */\r\n\tpublic setTimeout(fn: () => void, delay: number): IDisposer {\r\n\t\tconst id = setTimeout(() => {\r\n\t\t\tthis.removeDispose(disposer);\r\n\t\t\tfn();\r\n\t\t}, delay);\r\n\r\n\t\tconst disposer = new Disposer(() => {\r\n\t\t\tclearTimeout(id);\r\n\t\t});\r\n\r\n\t\tthis._disposers.push(disposer);\r\n\t\treturn disposer;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates [[Disposer]] for `setInterval` function call. This ensures that all\r\n\t * timeouts created by the object will be cleared when object itself is\r\n\t * disposed.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param fn     Callback function\r\n\t * @param delay  Timeout (ms)\r\n\t * @return Disposer for timeout\r\n\t */\r\n\tpublic setInterval(fn: () => void, delay: number): IDisposer {\r\n\t\tconst id = setInterval(() => {\r\n\t\t\tthis.removeDispose(disposer);\r\n\t\t\tfn();\r\n\t\t}, delay);\r\n\r\n\t\tconst disposer = new Disposer(() => {\r\n\t\t\tclearTimeout(id);\r\n\t\t});\r\n\r\n\t\tthis._disposers.push(disposer);\r\n\t\treturn disposer;\r\n\t}\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * JSON-BASED CONFIG PROCESSING\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Use this property to set JSON-based config. When set, triggers processing\r\n\t * routine, which will go through all properties, and try to apply values,\r\n\t * create instances, etc.\r\n\t *\r\n\t * Use this with caution, as it is a time-consuming process. It's used for\r\n\t * initialchart setup only, not routine operations.\r\n\t *\r\n\t * @param json JSON config\r\n\t */\r\n\tpublic set config(config: object) {\r\n\t\ttry {\r\n\t\t\tthis.processConfig(config);\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\t/*if (this instanceof Sprite) {\r\n\t\t\t\tthis.raiseCriticalError(e);\r\n\t\t\t}*/\r\n\t\t\t(<any>this).raiseCriticalError(e);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Processes the JSON config.\r\n\t *\r\n\t * @param json  JSON config\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected processConfig(config?: object): void {\r\n\r\n\t\tif (!config) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Get target\r\n\t\tlet target = <any>this;\r\n\r\n\t\t// Iterate through all of the items\r\n\t\t$object.eachOrdered(config, (configKey, value) => {\r\n\t\t\tlet configValue: any = value;\r\n\r\n\t\t\t// Is this a callback?\r\n\t\t\tif (configKey == \"callback\" && typeof value == \"function\") {\r\n\t\t\t\t(<any>value).call(target);\r\n\t\t\t}\r\n\r\n\t\t\t// Check if there's a property in target\r\n\t\t\tif (this.hasProperty(configKey)) {\r\n\r\n\t\t\t\tlet item: any;\r\n\r\n\t\t\t\t// Do we have instructions to create an object?\r\n\t\t\t\t// We create a new object if \"type\" key is set, but only if the\r\n\t\t\t\t// target object is of different type.\r\n\t\t\t\tif (\r\n\t\t\t\t\t$type.isObject(configValue)\r\n\t\t\t\t\t&& $type.hasValue((<any>configValue)[\"type\"])\r\n\t\t\t\t\t&& (\r\n\t\t\t\t\t\t!$type.isObject(target[configKey])\r\n\t\t\t\t\t\t|| !$type.hasValue(target[configKey].className)\r\n\t\t\t\t\t\t|| (<any>configValue)[\"forceCreate\"]\r\n\t\t\t\t\t\t|| target[configKey].className != (<any>configValue)[\"type\"]\r\n\t\t\t\t\t)\r\n\t\t\t\t\t&& !this.asIs(configKey)\r\n\t\t\t\t) {\r\n\t\t\t\t\titem = this.createClassInstance((<any>configValue)[\"type\"]);\r\n\r\n\t\t\t\t\t// Create new instance\r\n\t\t\t\t\tif (item) {\r\n\t\t\t\t\t\ttarget[configKey] = item;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\titem = target[configKey];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Get item from the object\r\n\t\t\t\t\titem = target[configKey];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * It is...\r\n\t\t\t\t * --------------------------------------------------------------------\r\n\t\t\t\t */\r\n\r\n\t\t\t\tif (item instanceof Adapter) {\r\n\r\n\t\t\t\t\t// ... an Adapter, try to add handlers to it\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\t\t\t\t\tthis.processAdapters(item, configValue);\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse if (item instanceof EventDispatcher) {\r\n\r\n\t\t\t\t\t// ... an EventDispatcher, try to add handlers to it\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\t\t\t\t\tthis.processEvents(item, configValue);\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse if (configKey == \"locale\" && $type.isString(configValue)) {\r\n\r\n\t\t\t\t\t// ... a locale specified as string, e.g. \"fr_FR\"\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\t\t\t\t\tif ((<any>window)[\"am4lang_\" + configValue]) {\r\n\t\t\t\t\t\ttarget[configKey] = (<any>window)[\"am4lang_\" + configValue];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse if (configKey == \"parent\" && $type.isString(configValue)) {\r\n\r\n\t\t\t\t\t// ... a parent referred via its it\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\t\t\t\t\tconst parent = this.map.getKey(configValue);\r\n\t\t\t\t\tif (parent) {\r\n\t\t\t\t\t\ttarget[configKey] = parent;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.addDelayedMap(\"parent\", configValue);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.asIs(configKey)) {\r\n\r\n\t\t\t\t\t// ... a special field, just set it to new value\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\t\t\t\t\t// (no need to add each indvidual item)\r\n\t\t\t\t\ttarget[configKey] = configValue;\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.asFunction(configKey) && $type.isString(configValue)) {\r\n\r\n\t\t\t\t\t// ... a field indicating function name to look for in registry\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\t\t\t\t\tif ($type.hasValue(registry.registeredClasses[configValue])) {\r\n\t\t\t\t\t\ttarget[configKey] = registry.registeredClasses[configValue];\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthrow Error(\"Invalid easing function: \" + configValue);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse if (<any>configValue instanceof BaseObject) {\r\n\r\n\t\t\t\t\t// ... a BaseObject object, we just going to use it as it is\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\t\t\t\t\ttarget[configKey] = configValue;\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse if (item instanceof BaseObject) {\r\n\r\n\t\t\t\t\t// ... another child BaseObject\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\t\t\t\t\t// Let's just pass in config part in and let itself deal with it\r\n\t\t\t\t\titem.config = configValue;\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse if (item instanceof ListTemplate || item instanceof OrderedListTemplate || item instanceof SortedListTemplate) {\r\n\r\n\t\t\t\t\t// ... a list with template\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\r\n\t\t\t\t\t// Let's see what we can do with it\r\n\t\t\t\t\tif ($type.isArray(configValue)) {\r\n\r\n\t\t\t\t\t\t// It's an array.\r\n\t\t\t\t\t\t// Create a list item for entry, or try to apply properties to an\r\n\t\t\t\t\t\t// existing entry if possible and it is present.\r\n\t\t\t\t\t\tif (item instanceof ListTemplate) {\r\n\t\t\t\t\t\t\tthis.processListTemplate(configValue, item);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tthis.processOrderedTemplate(configValue, item);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if ($type.isObject(configValue)) {\r\n\t\t\t\t\t\t// It's a single oject.\r\n\t\t\t\t\t\t// Treat it as a template.\r\n\t\t\t\t\t\tif (<any>configValue instanceof BaseObject) {\r\n\t\t\t\t\t\t\t// Item is already a BaseObject, no need to process it further\r\n\t\t\t\t\t\t\titem.template = configValue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t\t\t// Now let's find out if the whole object if a template, or we\r\n\t\t\t\t\t\t\t// need to get it from `template` key\r\n\t\t\t\t\t\t\tlet templateValue;\r\n\t\t\t\t\t\t\tif ($type.hasValue((<any>configValue).template)) {\r\n\t\t\t\t\t\t\t\ttemplateValue = (<any>configValue).template;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\ttemplateValue = configValue;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (item.template instanceof BaseObject) {\r\n\t\t\t\t\t\t\t\t// Template is a BaseObject so we will just let its config\r\n\t\t\t\t\t\t\t\t// deal with the configuration\r\n\t\t\t\t\t\t\t\t(<any>item.template).config = templateValue;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t\t\t\t$object.each(templateValue, (entryKey, entryValue) => {\r\n\r\n\t\t\t\t\t\t\t\t\tlet listItem = (<any>item.template)[entryKey];\r\n\r\n\t\t\t\t\t\t\t\t\tif (listItem instanceof Adapter) {\r\n\t\t\t\t\t\t\t\t\t\tthis.processAdapters(listItem, entryValue);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse if (listItem instanceof EventDispatcher) {\r\n\t\t\t\t\t\t\t\t\t\tthis.processEvents(listItem, entryValue);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse if (listItem instanceof DictionaryTemplate) {\r\n\t\t\t\t\t\t\t\t\t\tthis.processDictionaryTemplate(listItem, entryValue);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse if (item.template[entryKey] instanceof BaseObject) {\r\n\t\t\t\t\t\t\t\t\t\t// Template is a BaseObject. Let it deal with its own config.\r\n\t\t\t\t\t\t\t\t\t\t(<any>item.template[entryKey]).config = entryValue;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse if ($type.isObject(entryValue) && $type.hasValue((<any>entryValue)[\"type\"])) {\r\n\t\t\t\t\t\t\t\t\t\tlistItem = this.createClassInstance((<any>entryValue)[\"type\"])\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (listItem) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (listItem instanceof BaseObject) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tlistItem.config = <any>entryValue;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\titem.template[entryKey] = listItem;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\t\titem.template[entryKey] = entryValue;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse if (listItem instanceof List) {\r\n\t\t\t\t\t\t\t\t\t\t// It's List, process it\r\n\t\t\t\t\t\t\t\t\t\tthis.processList(entryValue, listItem);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\t// Aything else. Just assing and be done with it.\r\n\t\t\t\t\t\t\t\t\t\titem.template[entryKey] = this.maybeColorOrPercent(entryValue);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Check maybe there are `values` to insert\r\n\t\t\t\t\t\t\tif ($type.hasValue((<any>configValue).values)) {\r\n\t\t\t\t\t\t\t\tif (item instanceof ListTemplate) {\r\n\t\t\t\t\t\t\t\t\tthis.processListTemplate((<any>configValue).values, item);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tthis.processOrderedTemplate((<any>configValue).values, item);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t\t// Something else?\r\n\t\t\t\t\t\t// Not sure what to do with it on a list - ignore\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\telse if (item instanceof List) {\r\n\r\n\t\t\t\t\t// ... a list\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\r\n\t\t\t\t\tif (configKey == \"children\") {\r\n\t\t\t\t\t\tthis.processList(configValue, item, this);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.processList(configValue, item);\r\n\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\telse if (item instanceof DictionaryTemplate) {\r\n\r\n\t\t\t\t\t// ... a dictionary with template\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\r\n\t\t\t\t\tthis.processDictionaryTemplate(item, configValue);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\telse if (item instanceof Dictionary) {\r\n\r\n\t\t\t\t\t// ... a dictionary\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\r\n\t\t\t\t\tthis.processDictionary(item, configValue);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\telse if (item instanceof Color || item instanceof Percent) {\r\n\r\n\t\t\t\t\t// ... it's a Color or Percent\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\t\t\t\t\ttarget[configKey] = this.maybeColorOrPercent(configValue);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\telse if ($type.isObject(item) && $type.isObject(configValue)) {\r\n\r\n\t\t\t\t\t// ... a regular object\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\r\n\t\t\t\t\t$object.copyAllProperties(<Object>configValue, <Object>item);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\telse {\r\n\r\n\t\t\t\t\t// ... something else - probably a simple property or object\r\n\t\t\t\t\t// ------------------------------------------------------------------\r\n\r\n\t\t\t\t\t// Maybe convert to `Percent` or `Color`?\r\n\t\t\t\t\tconfigValue = this.maybeColorOrPercent(configValue);\r\n\r\n\t\t\t\t\t// Assign\r\n\t\t\t\t\ttarget[configKey] = configValue;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse if (!this.isReserved(configKey)) {\r\n\r\n\t\t\t\t// Doesn't have property set. But we're going to assume JSON config\r\n\t\t\t\t// creator knows what he/she is doing and set it anyway.\r\n\t\t\t\ttarget[configKey] = configValue;\r\n\r\n\t\t\t}\r\n\t\t}, this.configOrder);\r\n\r\n\t\t// Any errors?\r\n\t\tif (this.processingErrors.length) {\r\n\t\t\tlet errors = this.processingErrors.join(\"\\n\");\r\n\t\t\tthis._processingErrors = [];\r\n\t\t\tthrow Error(errors);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Tries to detect if value is color or percent and converts to proper object\r\n\t * if necessary.\r\n\t *\r\n\t * Returns the same source value if no color/percent detected\r\n\t *\r\n\t * @param value  Source value\r\n\t * @return Converted value\r\n\t */\r\n\tprotected maybeColorOrPercent(value: any): any {\r\n\t\tif ($type.isString(value)) {\r\n\t\t\tif (value.match(/^[\\-]?[0-9.]+\\%$/)) {\r\n\t\t\t\treturn percent($type.toNumber(value));\r\n\t\t\t}\r\n\t\t\telse if (value.match(/^\\#[0-9abcdef]{3,}$/i)) {\r\n\t\t\t\treturn color(value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\tprotected processAdapters(item: Adapter<any, any>, config: any): void {\r\n\t\tif ($type.isArray(config)) {\r\n\t\t\t$array.each(config, (entry: { key: string, callback: any, priority?: number }, index) => {\r\n\t\t\t\titem.add(entry.key, entry.callback, entry.priority || 0, this);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse if ($type.isObject(config)) {\r\n\t\t\t$object.each(config, (key, entry) => {\r\n\t\t\t\tif (!item.has(key, entry)) {\r\n\t\t\t\t\titem.add(key, entry);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprotected processEvents(item: EventDispatcher<any>, config: any): void {\r\n\t\tif ($type.isArray(config)) {\r\n\t\t\t$array.each(config, (entry: { type: string, callback: any }, index) => {\r\n\t\t\t\titem.on(entry.type, entry.callback, this);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse if ($type.isObject(config)) {\r\n\t\t\t$object.each(config, (key, entry) => {\r\n\t\t\t\tif (!item.has(key, entry)) {\r\n\t\t\t\t\titem.on(key, entry);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Processes JSON config for a [[DictionaryTemplate]] item.\r\n\t *\r\n\t * @todo Description\r\n\t * @param item    Item\r\n\t * @param config  Config\r\n\t */\r\n\tprotected processDictionaryTemplate(item: DictionaryTemplate<any, any>, config: any): void {\r\n\r\n\t\t// We can only process object\r\n\t\t// Not sure what to do with other types - ignore\r\n\t\tif ($type.isObject(config)) {\r\n\r\n\t\t\t// Create an entry for each item, or override properties for\r\n\t\t\t// existing one.\r\n\t\t\t$object.each(config, (entryKey, entryValue) => {\r\n\t\t\t\tlet listItem;\r\n\r\n\t\t\t\t// Get existing one, or create a new one\r\n\t\t\t\tif (entryKey == \"template\") {\r\n\t\t\t\t\tlistItem = item.template;\r\n\t\t\t\t}\r\n\t\t\t\telse if (item.hasKey(entryKey)) {\r\n\t\t\t\t\tlistItem = item.getKey(entryKey);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlistItem = item.create(entryKey);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set data\r\n\t\t\t\tif (listItem instanceof BaseObject) {\r\n\t\t\t\t\tlistItem.config = entryValue;\r\n\t\t\t\t}\r\n\t\t\t\telse if ($type.isObject(listItem) && $type.isObject(entryValue)) {\r\n\t\t\t\t\t$object.copyAllProperties(<Object>entryValue, <Object>listItem);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlistItem.setKey(entryKey, entryValue);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Processes JSON config for a [[Dictionary]] item.\r\n\t *\r\n\t * @todo Description\r\n\t * @param item    Item\r\n\t * @param config  Config\r\n\t */\r\n\tprotected processDictionary(item: Dictionary<any, any>, config: any): void {\r\n\r\n\t\t// We can only process object\r\n\t\t// Not sure what to do with other types - ignore\r\n\t\tif ($type.isObject(config)) {\r\n\r\n\t\t\t// Create an entry for each item, or override properties for\r\n\t\t\t// existing one.\r\n\t\t\t// @todo support for non-basic types\r\n\t\t\t$object.each(config, (entryKey, entryValue) => {\r\n\t\t\t\titem.setKey(entryKey, entryValue);\r\n\t\t\t});\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Processes [[ListTemplate]].\r\n\t *\r\n\t * @param configValue  Config value\r\n\t * @param item         Item\r\n\t */\r\n\tprotected processListTemplate(configValue: any, item: ListTemplate<any>): void {\r\n\r\n\t\t$array.each(configValue, (entry, index) => {\r\n\t\t\tlet type = this.getConfigEntryType(entry);\r\n\t\t\tlet listItem;\r\n\t\t\tif (item.hasIndex(index) && !(<any>entry)[\"forceCreate\"]) {\r\n\t\t\t\tlistItem = item.getIndex(index);\r\n\t\t\t}\r\n\t\t\telse if (<any>entry instanceof BaseObject) {\r\n\t\t\t\t// Item is already a BaseObject, no need to process it further\r\n\t\t\t\titem.push(entry);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (type) {\r\n\t\t\t\tlistItem = item.create(type);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlistItem = item.create();\r\n\t\t\t}\r\n\r\n\t\t\tif (entry === listItem) {\r\n\t\t\t\t// It's already the same item, do nothing\r\n\t\t\t}\r\n\t\t\telse {\r\n\r\n\t\t\t\tif ($type.isObject(entry)) {\r\n\r\n\t\t\t\t\t// If the list item is BaseObject, we just need to let it\r\n\t\t\t\t\t// deal if its own config\r\n\t\t\t\t\tif (listItem instanceof BaseObject) {\r\n\t\t\t\t\t\t(<any>listItem).config = entry;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if ($type.isObject(listItem) && $type.isObject(entry)) {\r\n\t\t\t\t\t\t$object.copyAllProperties(<Object>entry, <Object>listItem);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\titem.setIndex(item.indexOf(listItem), entry);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Truncate the list if it contains less items than the config\r\n\t\t// array\r\n\t\twhile (configValue.length > item.length) {\r\n\t\t\titem.pop();\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Processes [[OrdererListTemplate]] or [[SortedListTemplate]].\r\n\t *\r\n\t * @param configValue  Config value\r\n\t * @param item         Item\r\n\t */\r\n\tprotected processOrderedTemplate(configValue: any, item: OrderedListTemplate<any> | SortedListTemplate<any>): void {\r\n\r\n\t\t$array.each(configValue, (entry, index) => {\r\n\t\t\tlet type = this.getConfigEntryType(entry);\r\n\t\t\tlet listItem;\r\n\t\t\tif (type) {\r\n\t\t\t\tlistItem = item.create(type);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlistItem = item.create();\r\n\t\t\t}\r\n\r\n\t\t\tif ($type.isObject(entry)) {\r\n\r\n\t\t\t\t// If the list item is BaseObject, we just need to let it\r\n\t\t\t\t// deal if its own config\r\n\t\t\t\tif (listItem instanceof BaseObject) {\r\n\t\t\t\t\t(<any>listItem).config = entry;\r\n\t\t\t\t}\r\n\t\t\t\telse if ($type.isObject(listItem) && $type.isObject(entry)) {\r\n\t\t\t\t\t$object.copyAllProperties(<Object>entry, <Object>listItem);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\titem.insert(entry);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Processes [[List]].\r\n\t *\r\n\t * @param configValue  Config value\r\n\t * @param item         Item\r\n\t */\r\n\tprotected processList(configValue: any, item: List<any>, parent?: any): void {\r\n\r\n\t\t// Convert to array if necessary\r\n\t\tif (!$type.isArray(configValue)) {\r\n\t\t\tconfigValue = [configValue];\r\n\t\t}\r\n\r\n\t\t// It's an array\r\n\t\t// Create a list item for entry\r\n\t\tconst itemCount = item.length;\r\n\t\tlet extraCount = 0;\r\n\t\t$array.each(configValue, (entry, index) => {\r\n\r\n\t\t\tif ($type.isObject(entry)) {\r\n\r\n\t\t\t\t// An object.\r\n\t\t\t\t//\r\n\t\t\t\t// Let's see if we can instantiate a class out of it, or we need\r\n\t\t\t\t// to push it into list as it is.\r\n\t\t\t\t//\r\n\t\t\t\t// If there are items already at the specified index in the list,\r\n\t\t\t\t// apply properties rather than create a new one.\r\n\r\n\t\t\t\tlet listItem;\r\n\t\t\t\tif ((index < itemCount) && !(<any>entry)[\"forceCreate\"]) {\r\n\t\t\t\t\tlistItem = item.getIndex(index);\r\n\t\t\t\t}\r\n\t\t\t\telse if (<any>entry instanceof BaseObject) {\r\n\t\t\t\t\t// Item is already a BaseObject, no need to process it further\r\n\t\t\t\t\titem.push(entry);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\textraCount++;\r\n\t\t\t\t\tlistItem = this.createEntryInstance(entry);\r\n\t\t\t\t\tif (parent) {\r\n\t\t\t\t\t\tlistItem.parent = parent;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\titem.push(listItem);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If the list item is BaseObject, we just need to let it\r\n\t\t\t\t// deal if its own config\r\n\t\t\t\tif (listItem instanceof BaseObject) {\r\n\t\t\t\t\t(<any>listItem).config = entry;\r\n\t\t\t\t}\r\n\t\t\t\telse if ($type.isObject(listItem) && $type.isObject(entry)) {\r\n\t\t\t\t\t$object.copyAllProperties(<Object>entry, <Object>listItem);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\r\n\t\t\t\t// Basic value.\r\n\t\t\t\t// Just push it into list, or override existing value\r\n\t\t\t\tif (item.hasIndex(index)) {\r\n\t\t\t\t\titem.setIndex(index, entry);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\titem.push(entry);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\t// Truncate the list if it contains less items than the config\r\n\t\t// array\r\n\t\twhile ((configValue.length + extraCount) < item.length) {\r\n\t\t\titem.pop();\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * This function is used to sort element's JSON config properties, so that\r\n\t * some properties that absolutely need to be processed last, can be put at\r\n\t * the end.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param a  Element 1\r\n\t * @param b  Element 2\r\n\t * @return Sorting number\r\n\t */\r\n\tprotected configOrder(a: string, b: string): Ordering {\r\n\t\tif (a == b) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\t// Language must come first, so it's all set up when the rest of the\r\n\t\t// elements are being instantiated\r\n\t\telse if (a == \"language\") {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\telse if (b == \"language\") {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\r\n\t\telse {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if field should be just assigned as is, without any checking when\r\n\t * processing JSON config.\r\n\t *\r\n\t * Extending functions can override this function to do their own checks.\r\n\t *\r\n\t * @param field  Field name\r\n\t * @return Assign as is?\r\n\t */\r\n\tprotected asIs(field: string): boolean {\r\n\t\treturn $array.indexOf([\"locale\"], field) != -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if field needs to be converted to function, if it is specified\r\n\t * as string.\r\n\t *\r\n\t * @param field  Field name\r\n\t * @return Assign as function?\r\n\t */\r\n\tprotected asFunction(field: string): boolean {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a relevant class instance if such class definition exists.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param className  Class name\r\n\t * @return Instance\r\n\t */\r\n\tprotected createClassInstance(className: string): Object {\r\n\t\tif ($type.hasValue(registry.registeredClasses[className])) {\r\n\t\t\treturn new registry.registeredClasses[className]();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow Error(\"Invalid type: \\\"\" + className + \"\\\".\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a class instance for a config entry using it's type. (as set in\r\n\t * `type` property)\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param config  Config part\r\n\t * @return Instance\r\n\t */\r\n\tprotected createEntryInstance(config: any): any {\r\n\t\tlet res: Object;\r\n\t\tif ($type.hasValue(config[\"type\"])) {\r\n\t\t\tres = this.createClassInstance(config[\"type\"]);\r\n\t\t}\r\n\t\tif (!res) {\r\n\t\t\treturn config;\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Determines config object type.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param config  Config part\r\n\t * @return Type\r\n\t */\r\n\tprotected getConfigEntryType(config: any): any {\r\n\t\tif ($type.hasValue(config[\"type\"])) {\r\n\t\t\tif ($type.hasValue(registry.registeredClasses[config[\"type\"]])) {\r\n\t\t\t\treturn registry.registeredClasses[config[\"type\"]];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthrow Error(\"Invalid type: \\\"\" + config[\"type\"] + \"\\\".\");\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if this element has a property.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param prop  Property name\r\n\t * @return Has property?\r\n\t */\r\n\tprotected hasProperty(prop: string): boolean {\r\n\t\treturn prop in this ? true : false;\r\n\t}\r\n\r\n\t/**\r\n\t * Checkes whether JSON key is a reserved keyword.\r\n\t *\r\n\t * @param key  Key\r\n\t * @return Reserved\r\n\t */\r\n\tprotected isReserved(key: string): boolean {\r\n\t\treturn [\"type\", \"forceCreate\"].indexOf(key) !== -1;\r\n\t}\r\n\r\n\t/**\r\n\t * A list of errors that happened during JSON processing.\r\n\t *\r\n\t * @return Errors\r\n\t */\r\n\tprotected get processingErrors(): string[] {\r\n\t\tif (!this._processingErrors) {\r\n\t\t\tthis._processingErrors = [];\r\n\t\t}\r\n\t\treturn this._processingErrors;\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[BaseObjectEvents]].\r\n */\r\nexport interface IBaseObjectEvents { };\r\n\r\n/**\r\n * A version of [[BaseObject]] with events properties and methods.\r\n * Classes that use [[EventDispatcher]] should extend this instead of\r\n * [[BaseObject]] directly.\r\n */\r\nexport class BaseObjectEvents extends BaseObject {\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"BaseObjectEvents\";\r\n\t}\r\n\r\n\tpublic _events!: IBaseObjectEvents;\r\n\r\n\t/**\r\n\t * An [[EventDispatcher]] instance\r\n\t * @ignore\r\n\t */\r\n\tpublic _eventDispatcher: EventDispatcher<AMEvent<this, this[\"_events\"]>>;\r\n\r\n\t/**\r\n\t * An [[EventDispatcher]] instance\r\n\t */\r\n\tpublic get events(): EventDispatcher<AMEvent<this, this[\"_events\"]>> {\r\n\t\tif (!this._eventDispatcher) {\r\n\t\t\tthis._eventDispatcher = new EventDispatcher();\r\n\t\t\tthis._disposers.push(this._eventDispatcher);\r\n\t\t}\r\n\t\treturn this._eventDispatcher;\r\n\t}\r\n\r\n\t//public set events(value:EventDispatcher<AMEvent<this, this[\"_events\"]>>){\r\n\t//\tthis._eventDispatcher = value;\r\n\t//}\r\n\r\n\t/**\r\n\t * Dispatches an event using own event dispatcher. Will automatically\r\n\t * populate event data object with event type and target (this element).\r\n\t * It also checks if there are any handlers registered for this sepecific\r\n\t * event.\r\n\t *\r\n\t * @param eventType Event type (name)\r\n\t * @param data      Data to pass into event handler(s)\r\n\t */\r\n\tpublic dispatch<Key extends keyof this[\"_events\"]>(eventType: Key, data?: any): void {\r\n\t\t// @todo Implement proper type check\r\n\t\tif (this._eventDispatcher) {\r\n\t\t\tif (this.events.isEnabled(eventType)) {\r\n\t\t\t\tif (data) {\r\n\t\t\t\t\tdata.type = eventType;\r\n\t\t\t\t\tdata.target = data.target || this;\r\n\t\t\t\t\t(<any>this.events).dispatch(eventType, {\r\n\t\t\t\t\t\ttype: eventType,\r\n\t\t\t\t\t\ttarget: this\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t(<any>this.events).dispatch(eventType, {\r\n\t\t\t\t\t\ttype: eventType,\r\n\t\t\t\t\t\ttarget: this\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Works like `dispatch`, except event is triggered immediately, without\r\n\t * waiting for the next frame cycle.\r\n\t *\r\n\t * @param eventType Event type (name)\r\n\t * @param data      Data to pass into event handler(s)\r\n\t */\r\n\tpublic dispatchImmediately<Key extends keyof this[\"_events\"]>(eventType: Key, data?: any): void {\r\n\t\t// @todo Implement proper type check\r\n\t\tif (this._eventDispatcher) {\r\n\t\t\tif (this.events.isEnabled(eventType)) {\r\n\t\t\t\tif (data) {\r\n\t\t\t\t\tdata.type = eventType;\r\n\t\t\t\t\tdata.target = data.target || this;\r\n\t\t\t\t\t(<any>this.events).dispatchImmediately(eventType, data);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t(<any>this.events).dispatchImmediately(eventType, {\r\n\t\t\t\t\t\ttype: eventType,\r\n\t\t\t\t\t\ttarget: this\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all parameters from another [[Sprite]].\r\n\t *\r\n\t * @param source Source object\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\tsuper.copyFrom(source);\r\n\t\tif (source._eventDispatcher) {\r\n\t\t\tthis.events.copyFrom(source._eventDispatcher);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","/**\r\n * A collection of DOM-related functions.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Disposer, IDisposer } from \"./Disposer\";\r\nimport { readFrame, writeFrame } from \"./AsyncPending\";\r\nimport { options } from \"../Options\";\r\nimport * as $object from \"./Object\";\r\nimport * as $array from \"./Array\";\r\nimport * as $type from \"./Type\";\r\n\r\n/**\r\n * SVG namespace.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport const SVGNS: string = \"http://www.w3.org/2000/svg\";\r\n\r\n/**\r\n * XML namespace.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport const XMLNS: string = \"http://www.w3.org/2000/xmlns/\";\r\n\r\n/**\r\n * XLINK namespace.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport const XLINK: string = \"http://www.w3.org/1999/xlink\";\r\n\r\n\r\n/**\r\n * Function that adds a disposable event listener directly to a DOM element.\r\n *\r\n * @ignore Exclude from docs\r\n * @param dom       A DOM element to add event to\r\n * @param type      Event type\r\n * @param listener  Event listener\r\n * @returns Disposable event\r\n */\r\nexport function addEventListener<E extends Event>(dom: EventTarget, type: string, listener: (event: E) => void, options?: any): IDisposer {\r\n\t//@todo proper type check for options: EventListenerOptions | boolean (TS for some reason gives error on passive parameter)\r\n\t//console.log(type, dom);\r\n\tdom.addEventListener(type, <EventListener>listener, options || false);\r\n\r\n\treturn new Disposer(() => {\r\n\t\tdom.removeEventListener(type, <EventListener>listener, options || false);\r\n\t});\r\n}\r\n\r\n/**\r\n * Finds and returns an element reference using following logic:\r\n * * If we pass in an element instance, we just return it back.\r\n * * If we pass in a string, the function looks for an element with such id.\r\n * * If no element with such id is found, we grab the first element with a tag name like this.\r\n *\r\n * @ignore Exclude from docs\r\n * @param el  Element definition (reference, or id, or tag name)\r\n * @return Element reference\r\n * @todo Review this function as it seems pretty fuzzy and hacky\r\n */\r\nexport function getElement(el: $type.Optional<HTMLElement | string>): $type.Optional<HTMLElement> {\r\n\tif ($type.isString(el)) {\r\n\t\tlet e: Element | null = document.getElementById(el);\r\n\r\n\t\tif (e == null) {\r\n\t\t\te = document.getElementsByClassName(el)[0];\r\n\t\t}\r\n\r\n\t\tif (e instanceof HTMLElement) {\r\n\t\t\treturn e;\r\n\t\t}\r\n\r\n\t} else if (el instanceof HTMLElement) {\r\n\t\treturn el;\r\n\t}\r\n}\r\n\r\n/**\r\n * Adds a class name to an HTML or SVG element.\r\n *\r\n * @ignore Exclude from docs\r\n * @param element    Element\r\n * @param className  Class name to add\r\n */\r\nexport function addClass(element: HTMLElement | SVGSVGElement, className: string): void {\r\n\tif (!element) {\r\n\t\treturn;\r\n\t}\r\n\tif (element.classList) {\r\n\t\tconst classes = className.split(\" \");\r\n\t\t$array.each(classes, (name) => {\r\n\t\t\telement.classList.add(name);\r\n\t\t});\r\n\t}\r\n\telse {\r\n\t\tlet currentClassName = element.getAttribute(\"class\");\r\n\t\tif (currentClassName) {\r\n\t\t\telement.setAttribute(\"class\", currentClassName.split(\" \").filter((item) => {\r\n\t\t\t\treturn item !== className;\r\n\t\t\t}).join(\" \") + \" \" + className);\r\n\t\t}\r\n\t\telse {\r\n\t\t\telement.setAttribute(\"class\", className);\r\n\t\t}\r\n\t\t//element.className = element.className.replace(new RegExp(\"^\" + className + \"| \" + className), \"\") + \" \" + className;\r\n\t}\r\n}\r\n\r\n/**\r\n * Removes a class name from an HTML or SVG element.\r\n *\r\n * @ignore Exclude from docs\r\n * @param element    Element\r\n * @param className  Class name to add\r\n */\r\nexport function removeClass(element: HTMLElement | SVGSVGElement, className: string): void {\r\n\tif (!element) {\r\n\t\treturn;\r\n\t}\r\n\tif (element.classList) {\r\n\t\telement.classList.remove(className);\r\n\t}\r\n\telse {\r\n\t\tlet currentClassName = element.getAttribute(\"class\");\r\n\t\tif (currentClassName) {\r\n\t\t\telement.setAttribute(\"class\", currentClassName.split(\" \").filter((item) => {\r\n\t\t\t\treturn item !== className;\r\n\t\t\t}).join(\" \"));\r\n\t\t}\r\n\t\t//element.className = element.className.replace(new RegExp(\"^\" + className + \"| \" + className), \"\");\r\n\t}\r\n}\r\n\r\n/**\r\n * Sets style property on DOM element.\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Still needed?\r\n */\r\nexport function setStyle(element: HTMLElement | SVGSVGElement, property: string, value: string): void {\r\n\t(<any>element.style)[property] = value;\r\n}\r\n\r\n/**\r\n * Gets the computed style value for an element.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport function getComputedStyle(element: Element, property: string): string | number {\r\n\r\n\tif ((<any>element).currentStyle) {\r\n\t\treturn (<any>element).currentStyle[property];\r\n\t}\r\n\r\n\treturn document.defaultView.getComputedStyle(element, null).getPropertyValue(property);\r\n}\r\n\r\n/**\r\n * Removes focus from any element by shifting focus to body.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport function blur(): void {\r\n\tif (document.activeElement && document.activeElement != document.body) {\r\n\t\tif ((<any>document.activeElement).blur) {\r\n\t\t\t(<any>document.activeElement).blur();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet input = document.createElement(\"button\");\r\n\t\t\tinput.style.position = \"fixed\";\r\n\t\t\tinput.style.top = \"0px\";\r\n\t\t\tinput.style.left = \"-10000px\";\r\n\t\t\tdocument.body.appendChild(input);\r\n\t\t\tinput.focus();\r\n\t\t\tinput.blur();\r\n\t\t\tdocument.body.removeChild(input);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Tries to focus the element.\r\n *\r\n * @ignore Exlude from docs\r\n * @param element  Element to focus\r\n */\r\nexport function focus(element: HTMLElement | SVGSVGElement): void {\r\n\r\n\tif (element instanceof HTMLElement) {\r\n\t\telement.focus();\r\n\t}\r\n\telse {\r\n\t\tlet input = document.createElement(\"input\");\r\n\t\tlet fo = <SVGSVGElement>document.createElementNS(SVGNS, \"foreignObject\");\r\n\t\tfo.appendChild(input);\r\n\t\telement.appendChild(fo);\r\n\t\tinput.focus();\r\n\t\tinput.disabled = true;\r\n\t\tfo.remove();\r\n\t}\r\n\r\n\t/*if ((<any>element).focus != undefined) {\r\n\t\t(<any>element).focus();\r\n\t}\r\n\telse if (element instanceof SVGSVGElement) {\r\n\t\t// Not implemented\r\n\t\t// @todo implement focus fallback\r\n\t}*/\r\n}\r\n\r\n/**\r\n * Returns markup for the element including the element tag itself.\r\n * SVG elements do not support `outerHTML` so this functions applies of\r\n * a workaround which creates a new temporary wrapper, clones element and uses\r\n * wrapper's `innerHTML`.\r\n *\r\n * @ignore Exclude from docs\r\n * @param element  Element to get full markup for\r\n * @return Markup\r\n * @deprecated Not in use anywhere\r\n */\r\nexport function outerHTML(element: HTMLElement | SVGSVGElement): string {\r\n\tif (element.outerHTML) {\r\n\t\treturn element.outerHTML;\r\n\t}\r\n\telse {\r\n\t\tlet twrap = document.createElement(\"div\");\r\n\t\tlet tnode = element.cloneNode(true);\r\n\t\ttwrap.appendChild(tnode);\r\n\t\tlet content = twrap.innerHTML;\r\n\t\treturn content;\r\n\t}\r\n}\r\n\r\n/**\r\n * Checks if element is a valid DOM node.\r\n *\r\n * @ignore Exclude from docs\r\n * @param el  Element\r\n * @return `true` if element is a valid DOM node\r\n */\r\nexport function isElement(el: HTMLElement): boolean {\r\n\treturn el instanceof Object && el && el.nodeType === 1;\r\n}\r\n\r\n/**\r\n * Checks of element `a` contains element `b`.\r\n *\r\n * @param a  Aleged ascendant\r\n * @param b  Aleged descendant\r\n * @return Contains?\r\n */\r\nexport function contains(a: HTMLElement | SVGSVGElement, b: HTMLElement | SVGSVGElement): boolean {\r\n\tlet cursor: Node = b;\r\n\r\n\twhile (true) {\r\n\t\tif (a === cursor) {\r\n\t\t\treturn true;\r\n\r\n\t\t} else if (cursor.parentNode == null) {\r\n\t\t\t// TODO better ShadowRoot detection\r\n\t\t\tif ((<ShadowRoot>cursor).host == null) {\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t} else {\r\n\t\t\t\tcursor = (<ShadowRoot>cursor).host;\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tcursor = cursor.parentNode;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns the shadow root of the element or null\r\n *\r\n * @param a  Node\r\n * @return Root\r\n */\r\nexport function getShadowRoot(a: Node): ShadowRoot | null {\r\n\tlet cursor: Node = a;\r\n\r\n\twhile (true) {\r\n\t\tif (cursor.parentNode == null) {\r\n\t\t\t// TODO better ShadowRoot detection\r\n\t\t\tif ((<ShadowRoot>cursor).host != null) {\r\n\t\t\t\treturn <ShadowRoot>cursor;\r\n\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tcursor = cursor.parentNode;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns the root of the element (either the Document or the ShadowRoot)\r\n *\r\n * @param a  Node\r\n * @return Root\r\n */\r\nexport function getRoot(a: Node): Document | ShadowRoot | null {\r\n\t// TODO replace with Node.prototype.getRootNode\r\n\tconst owner = a.ownerDocument;\r\n\r\n\tlet cursor: Node = a;\r\n\r\n\twhile (true) {\r\n\t\tif (cursor.parentNode == null) {\r\n\t\t\t// If the cursor is the document, or it is a ShadowRoot\r\n\t\t\t// TODO better ShadowRoot detection\r\n\t\t\tif (cursor === owner || (<ShadowRoot>cursor).host != null) {\r\n\t\t\t\treturn <Document | ShadowRoot>cursor;\r\n\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tcursor = cursor.parentNode;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Gets the true target of the Event.\r\n *\r\n * This is needed to make events work with the shadow DOM.\r\n *\r\n * @param event  Event\r\n * @return EventTarget\r\n */\r\nexport function eventTarget(event: Event): EventTarget {\r\n\tif (typeof (<any>event).composedPath === \"function\") {\r\n\t\treturn (<any>event).composedPath()[0];\r\n\r\n\t} else {\r\n\t\treturn event.target;\r\n\t}\r\n}\r\n\r\n/**\r\n * Copies attributes from one element to another.\r\n *\r\n * @ignore Exclude from docs\r\n * @param source  Element to copy attributes from\r\n * @param target  Element to copy attributes to\r\n */\r\nexport function copyAttributes(source: Element | HTMLElement | SVGSVGElement, target: HTMLElement | SVGSVGElement): void {\r\n\t$array.each(source.attributes, (attr) => {\r\n\t\t// TODO what if it's null ?\r\n\t\tif (attr.value != null) {\r\n\t\t\ttarget.setAttribute(attr.name, attr.value);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n/**\r\n * [fixPixelPerfect description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param el  Element\r\n */\r\nexport function fixPixelPerfect(el: HTMLElement): void {\r\n\treadFrame(() => {\r\n\t\t// sometimes IE doesn't like this\r\n\t\t// TODO figure out a way to remove this\r\n\t\ttry {\r\n\t\t\tconst rect = el.getBoundingClientRect();\r\n\r\n\t\t\tconst left = rect.left - Math.round(rect.left);\r\n\t\t\tconst top = rect.top - Math.round(rect.top);\r\n\r\n\t\t\tif (left !== 0) {\r\n\t\t\t\twriteFrame(() => {\r\n\t\t\t\t\tel.style.left = left + \"px\";\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (top !== 0) {\r\n\t\t\t\twriteFrame(() => {\r\n\t\t\t\t\tel.style.top = top + \"px\";\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t} catch (e) { }\r\n\t});\r\n}\r\n\r\n/**\r\n * [rootStylesheet description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n */\r\nlet rootStylesheet: $type.Optional<CSSStyleSheet>;\r\n\r\n/**\r\n * [getStylesheet description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @return [description]\r\n */\r\nfunction getStylesheet(element: ShadowRoot | null): CSSStyleSheet {\r\n\tif (element == null) {\r\n\t\tif (!$type.hasValue(rootStylesheet)) {\r\n\t\t\t// TODO use createElementNS ?\r\n\t\t\tconst e = document.createElement(\"style\");\r\n\t\t\te.type = \"text/css\";\r\n\t\t\tif (options.nonce != \"\") {\r\n\t\t\t\te.setAttribute(\"nonce\", options.nonce)\r\n\t\t\t}\r\n\t\t\tdocument.head.appendChild(e);\r\n\t\t\trootStylesheet = e.sheet as CSSStyleSheet;\r\n\t\t}\r\n\r\n\t\treturn rootStylesheet;\r\n\r\n\t} else {\r\n\t\t// TODO use createElementNS ?\r\n\t\tconst e = document.createElement(\"style\");\r\n\t\te.type = \"text/css\";\r\n\t\tif (options.nonce != \"\") {\r\n\t\t\te.setAttribute(\"nonce\", options.nonce)\r\n\t\t}\r\n\t\telement.appendChild(e);\r\n\t\treturn e.sheet as CSSStyleSheet;\r\n\t}\r\n}\r\n\r\n/**\r\n * [makeStylesheet description]\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param selector  [description]\r\n * @return [description]\r\n */\r\nfunction appendStylesheet(root: CSSStyleSheet, selector: string): CSSStyleRule {\r\n\tconst index = root.cssRules.length;\r\n\r\n\troot.insertRule(selector + \"{}\", index);\r\n\r\n\treturn root.cssRules[index] as CSSStyleRule;\r\n}\r\n\r\n/**\r\n * Defines a class for a CSS rule.\r\n *\r\n * Can be used to dynamically add CSS to the document.\r\n */\r\nexport class StyleRule extends Disposer {\r\n\r\n\t/**\r\n\t * CSS rule.\r\n\t */\r\n\tprivate _rule: CSSStyleRule;\r\n\r\n\t/**\r\n\t * A CSS selector text.\r\n\t *\r\n\t * E.g.: `.myClass p`\r\n\t *\r\n\t * @param selector  CSS selector\r\n\t */\r\n\tpublic set selector(selector: string) {\r\n\t\tthis._rule.selectorText = selector;\r\n\t}\r\n\r\n\t/**\r\n\t * @return CSS selector\r\n\t */\r\n\tpublic get selector(): string {\r\n\t\treturn this._rule.selectorText;\r\n\t}\r\n\r\n\t/**\r\n\t * Constructor.\r\n\t *\r\n\t * @param selector  CSS selector\r\n\t * @param styles    An object of style attribute - value pairs\r\n\t */\r\n\tconstructor(element: ShadowRoot | null, selector: string, styles: { [name: string]: string }) {\r\n\t\tconst root = getStylesheet(element);\r\n\r\n\t\t// TODO test this\r\n\t\tsuper(() => {\r\n\t\t\t// TODO a bit hacky\r\n\t\t\tconst index = $array.indexOf(root.cssRules, this._rule);\r\n\r\n\t\t\tif (index === -1) {\r\n\t\t\t\tthrow new Error(\"Could not dispose StyleRule\");\r\n\r\n\t\t\t} else {\r\n\t\t\t\t// TODO if it's empty remove it from the DOM ?\r\n\t\t\t\troot.deleteRule(index);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._rule = appendStylesheet(root, selector);\r\n\r\n\t\t$object.each(styles, (key, value) => {\r\n\t\t\tthis.setStyle(key, value);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the same style properties with browser-specific prefixes.\r\n\t *\r\n\t * @param name   Attribute name\r\n\t * @param value  Attribute value\r\n\t */\r\n\tprivate _setVendorPrefixName(name: string, value: string): void {\r\n\t\tconst style = this._rule.style;\r\n\t\tstyle.setProperty(\"-webkit-\" + name, value, \"\");\r\n\t\tstyle.setProperty(\"-moz-\" + name, value, \"\");\r\n\t\tstyle.setProperty(\"-ms-\" + name, value, \"\");\r\n\t\tstyle.setProperty(\"-o-\" + name, value, \"\");\r\n\t\tstyle.setProperty(name, value, \"\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a value for specific style attribute.\r\n\t *\r\n\t * @param name   Attribute\r\n\t * @param value  Value\r\n\t */\r\n\tpublic setStyle(name: string, value: string): void {\r\n\t\tif (name === \"transition\") {\r\n\t\t\tthis._setVendorPrefixName(name, value);\r\n\r\n\t\t} else {\r\n\t\t\tthis._rule.style.setProperty(name, value, \"\");\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * An internal counter for unique style ids.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nlet styleId: number = 0;\r\n\r\n/**\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n */\r\nexport class StyleClass extends StyleRule {\r\n\r\n\t/**\r\n\t * Class name.\r\n\t */\r\n\tprivate _className: string;\r\n\r\n\t/**\r\n\t * Constructor.\r\n\t *\r\n\t * @param styles  An object of style attribute - value pairs\r\n\t * @param name    Class name\r\n\t */\r\n\tconstructor(element: ShadowRoot | null, styles: { [name: string]: string }, name?: string) {\r\n\t\tconst className =\r\n\t\t\t(!$type.hasValue(name)\r\n\t\t\t\t// TODO generate the classname randomly\r\n\t\t\t\t? \"__style_\" + (++styleId) + \"__\"\r\n\t\t\t\t: name);\r\n\r\n\t\tsuper(element, \".\" + className, styles);\r\n\r\n\t\tthis._className = className;\r\n\t}\r\n\r\n\t/**\r\n\t * Class name.\r\n\t *\r\n\t * @param name  Class name\r\n\t */\r\n\tpublic set className(name: string) {\r\n\t\tthis._className = name;\r\n\t\tthis.selector = \".\" + name;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Class name\r\n\t */\r\n\tpublic get className(): string {\r\n\t\treturn this._className;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the whole class to\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic toString(): string {\r\n\t\treturn this._className;\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport function ready(f: () => void): void {\r\n\tif (document.readyState !== \"loading\") {\r\n\t\tf();\r\n\r\n\t} else {\r\n\t\tconst listener = () => {\r\n\t\t\tif (document.readyState !== \"loading\") {\r\n\t\t\t\tdocument.removeEventListener(\"readystatechange\", listener);\r\n\t\t\t\tf();\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tdocument.addEventListener(\"readystatechange\", listener);\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns a font fmaily name for the element (directly set or\r\n * computed/inherited).\r\n *\r\n * @ignore Exclude from docs\r\n * @param element  Element\r\n * @return Font family\r\n */\r\nexport function findFont(element: Element): string {\r\n\r\n\t// Check if element has styles set\r\n\tlet font = getComputedStyle(element, \"font-family\");\r\n\r\n\tif (!font) {\r\n\t\t// Completely transparent. Look for a parent\r\n\t\tlet parent = element.parentElement || <Element>element.parentNode;\r\n\t\tif (parent) {\r\n\t\t\treturn findFont(parent);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\treturn (<string>font);\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Returns a font fmaily name for the element (directly set or\r\n * computed/inherited).\r\n *\r\n * @ignore Exclude from docs\r\n * @param element  Element\r\n * @return Font family\r\n */\r\nexport function findFontSize(element: Element): string {\r\n\r\n\t// Check if element has styles set\r\n\tlet font = getComputedStyle(element, \"font-size\");\r\n\r\n\tif (!font) {\r\n\t\t// Completely transparent. Look for a parent\r\n\t\tlet parent = element.parentElement || <Element>element.parentNode;\r\n\t\tif (parent) {\r\n\t\t\treturn findFontSize(parent);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\treturn (<string>font);\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Checks whether element is not visible, whether directly or via its\r\n * ascendants.\r\n *\r\n * @param   element  Target element\r\n * @return           Hidden?\r\n */\r\nexport function isHidden(element: HTMLElement): boolean {\r\n\treturn (element.offsetParent === null);\r\n}\r\n\r\n\r\n/**\r\n * Checks wthether element is in the current viewport.\r\n *\r\n * @since 2.5.5\r\n * @param   el Element\r\n * @return     Within viewport?\r\n */\r\nexport function isElementInViewport(el: HTMLElement, viewportTarget?: HTMLElement | HTMLElement[]): boolean {\r\n\r\n\t// Get position data of the element\r\n\tlet rect = el.getBoundingClientRect();\r\n\r\n\t// Convert to array\r\n\tconst targets = $type.isArray(viewportTarget) ? viewportTarget : viewportTarget ? [viewportTarget] : [];\r\n\r\n\t// Should we measure against specific viewport element?\r\n\tif (targets.length) {\r\n\t\tfor (let i = 0; i < targets.length; i++) {\r\n\r\n\t\t\tconst target = targets[i];\r\n\r\n\t\t\t// Check if viewport itself is visible\r\n\t\t\tif (!isElementInViewport(target)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if element is visible within the viewport\r\n\t\t\tlet viewportRect = target.getBoundingClientRect();\r\n\t\t\tif (\r\n\t\t\t\trect.top >= 0 &&\r\n\t\t\t\trect.left >= 0 &&\r\n\t\t\t\trect.top <= (viewportRect.top + viewportRect.height) &&\r\n\t\t\t\trect.left <= (viewportRect.left + viewportRect.width)\r\n\t\t\t) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn (\r\n\t\trect.top >= 0 &&\r\n\t\trect.left >= 0 &&\r\n\t\trect.top <= (window.innerHeight || document.documentElement.clientHeight) &&\r\n\t\trect.left <= (window.innerWidth || document.documentElement.clientWidth)\r\n\t);\r\n\r\n}\r\n","/**\r\n * A collection of functions that deals with path calculations.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { IRectangle } from \"../defs/IRectangle\";\r\nimport * as $math from \"../utils/Math\";\r\nimport * as $type from \"../utils/Type\";\r\nimport { getGhostPaper } from \"../rendering/Paper\";\r\nimport { options } from \"../Options\";\r\n\r\n/**\r\n * ============================================================================\r\n * PATH FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Returns an SVG path from a number of points.\r\n *\r\n * @ignore Exclude from docs\r\n * @param points  An array of line elbow points\r\n * @return SVG path\r\n */\r\nexport function polyline(points: IPoint[]): string {\r\n\tlet path = lineTo(points[0]);\r\n\tlet prevPoint = { x: 0, y: 0 };\r\n\r\n\tlet minStep = options.minPolylineStep;\r\n\tif (!$type.isNumber(minStep)) {\r\n\t\tminStep = 0.5;\r\n\t}\r\n\r\n\tfor (let i = 0, len = points.length; i < len; i++) {\r\n\t\tlet point = points[i];\r\n\t\tif ($math.getDistance(point, prevPoint) > minStep) {\r\n\t\t\tpath += lineTo(point);\r\n\t\t\tprevPoint = point;\r\n\t\t}\r\n\t}\r\n\treturn path;\r\n}\r\n\r\n\r\n/**\r\n * Returns a starting point of an SVG path.\r\n *\r\n * @ignore Exclude from docs\r\n * @param point  Starting point\r\n * @return SVG path\r\n */\r\nexport function moveTo(point: IPoint): string {\r\n\treturn \" M\" + $math.round(point.x, 4) + \",\" + $math.round(point.y, 4) + \" \";\r\n}\r\n\r\n/**\r\n * Returns a line part of SVG path.\r\n *\r\n * @ignore Exclude from docs\r\n * @param point  SVG path\r\n * @return SVG path\r\n */\r\nexport function lineTo(point: IPoint): string {\r\n\treturn \" L\" + $math.round(point.x, 4) + \",\" + $math.round(point.y, 4) + \" \";\r\n}\r\n\r\n/**\r\n * Returns a quadratic curve part of an SVG path.\r\n *\r\n * @ignore Exclude from docs\r\n * @param point         End point of the curve\r\n * @param controlPoint  Control point\r\n * @return SVG path\r\n */\r\nexport function quadraticCurveTo(point: IPoint, controlPoint: IPoint): string {\r\n\treturn \" Q\" + $math.round(controlPoint.x, 4)\r\n\t\t+ \",\" + $math.round(controlPoint.y, 4) + \" \" + $math.round(point.x, 4)\r\n\t\t+ \",\" + $math.round(point.y, 4);\r\n}\r\n\r\n/**\r\n * Returns a cubic curve part of an SVG path.\r\n *\r\n * @ignore Exclude from docs\r\n * @param point          End point of the curve\r\n * @param controlPointA  Control point A\r\n * @param controlPointB  Control point B\r\n * @return SVG path\r\n */\r\nexport function cubicCurveTo(point: IPoint, controlPointA: IPoint, controlPointB: IPoint): string {\r\n\treturn \" C\" + $math.round(controlPointA.x, 4)\r\n\t\t+ \",\" + $math.round(controlPointA.y, 4) + \" \" + $math.round(controlPointB.x, 4)\r\n\t\t+ \",\" + $math.round(controlPointB.y, 4) + \" \" + $math.round(point.x, 4)\r\n\t\t+ \",\" + $math.round(point.y, 4);\r\n}\r\n\r\n/**\r\n * Returns a terminator for an SVG path.\r\n *\r\n * @ignore Exclude from docs\r\n * @return SVG path\r\n */\r\nexport function closePath(): string {\r\n\treturn \" Z\";\r\n}\r\n\r\n/**\r\n * Returns an arc part of an SVG path.\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Better parameter descriptions\r\n * @param startAngle  Starting angle\r\n * @param arc         Arc\r\n * @param radius      Radius\r\n * @param radiusY     Vertical radius\r\n * @return SVG path\r\n */\r\nexport function arcTo(startAngle: number, arc: number, radius: number, radiusY?: number): string {\r\n\r\n\tif (arc == 0) {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tif (!$type.isNumber(radiusY)) {\r\n\t\tradiusY = radius;\r\n\t}\r\n\r\n\tlet path = \"\";\r\n\tlet c = \",\";\r\n\tlet segments = Math.ceil(Math.abs(arc) / 180);\r\n\tlet l = 1;\r\n\r\n\tif (arc < 0) {\r\n\t\tl = 0;\r\n\t}\r\n\r\n\t// previous, as we use a not A\r\n\tlet pax: number = 0;\r\n\tlet pay: number = 0;\r\n\r\n\t// center\r\n\tlet cx: number = -$math.cos(startAngle) * radius;\r\n\tlet cy: number = -$math.sin(startAngle) * radiusY;\r\n\r\n\t// foir very short angles and big radius, solves artefacts\r\n\tif (arc < 0.5 && radius > 3000) {\r\n\t\tlet endAngle = startAngle + arc\r\n\t\tlet ax = $math.round($math.cos(endAngle) * radius, 4);\r\n\t\tlet ay = $math.round($math.sin(endAngle) * radiusY, 4);\r\n\t\treturn lineTo({ x: ax, y: ay })\r\n\t}\r\n\r\n\tfor (let i = 0; i < segments; i++) {\r\n\t\tlet endAngle = startAngle + arc / segments * (i + 1);\r\n\r\n\t\tlet ax = $math.round($math.cos(endAngle) * radius + cx - pax, 4);\r\n\t\tlet ay = $math.round($math.sin(endAngle) * radiusY + cy - pay, 4);\r\n\r\n\t\tpath += \" a\" + radius + c + radiusY + c + 0 + c + 0 + c + l + c + ax + c + ay;\r\n\r\n\t\tpax = ax;\r\n\t\tpay = ay;\r\n\t}\r\n\treturn path;\r\n}\r\n\r\n/**\r\n * Creates an arc path.\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param startAngle         [description]\r\n * @param arc                [description]\r\n * @param radius             [description]\r\n * @param innerRadius        [description]\r\n * @param radiusY            [description]\r\n * @param cornerRadius       [description]\r\n * @param innerCornerRadius  [description]\r\n * @return SVG path\r\n */\r\nexport function arc(startAngle: number, arc: number, radius: number, innerRadius?: number, radiusY?: number, cornerRadius?: number, innerCornerRadius?: number): string {\r\n\tif (arc == 0) {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tif (!$type.isNumber(innerRadius)) {\r\n\t\tinnerRadius = 0;\r\n\t}\r\n\r\n\tif (radius == 0 && innerRadius <= 0) {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tif (radius < innerRadius) {\r\n\t\tlet temp = radius;\r\n\t\tradius = innerRadius;\r\n\t\tinnerRadius = temp;\r\n\r\n\t\tif ($type.isNumber(radiusY)) {\r\n\t\t\tradiusY = radiusY / innerRadius * radius;\r\n\t\t}\r\n\t}\r\n\r\n\tarc = $math.min(arc, 360);\r\n\r\n\tif (arc == 360) {\r\n\t\tcornerRadius = 0;\r\n\t\tinnerCornerRadius = 0;\r\n\t}\r\n\r\n\tlet endAngle = startAngle + arc;\r\n\tlet crSin = $math.sin($math.min(arc, 45) / 2);\r\n\r\n\tradiusY = $type.isNumber(radiusY) ? radiusY : radius;\r\n\tcornerRadius = cornerRadius || 0;\r\n\tinnerCornerRadius = $type.isNumber(innerCornerRadius) ? innerCornerRadius : cornerRadius;\r\n\r\n\tlet innerRadiusY = (radiusY / radius) * innerRadius;\r\n\r\n\tlet cornerRadiusY = (radiusY / radius) * cornerRadius;\r\n\tlet innerCornerRadiusY = (radiusY / radius) * innerCornerRadius;\r\n\r\n\tcornerRadius = $math.fitToRange(cornerRadius, 0, (radius - innerRadius) / 2);\r\n\tcornerRadiusY = $math.fitToRange(cornerRadiusY, 0, (radiusY - innerRadiusY) / 2);\r\n\r\n\tinnerCornerRadius = $math.fitToRange(innerCornerRadius, 0, (radius - innerRadius) / 2);\r\n\tinnerCornerRadiusY = $math.fitToRange(innerCornerRadiusY, 0, (radiusY - innerRadiusY) / 2);\r\n\r\n\tcornerRadius = $math.round($math.fitToRange(cornerRadius, 0, radius * crSin), 4);\r\n\tcornerRadiusY = $math.round($math.fitToRange(cornerRadiusY, 0, radiusY * crSin), 4);\r\n\r\n\tinnerCornerRadius = $math.round($math.fitToRange(innerCornerRadius, 0, innerRadius * crSin), 4);\r\n\tinnerCornerRadiusY = $math.round($math.fitToRange(innerCornerRadiusY, 0, innerRadiusY * crSin), 4);\r\n\r\n\tlet crAngle: number = Math.asin(cornerRadius / radius / 2) * $math.DEGREES * 2;\r\n\tlet crAngleY: number = Math.asin(cornerRadiusY / radiusY / 2) * $math.DEGREES * 2;\r\n\r\n\tif (innerRadius < innerCornerRadius) {\r\n\t\tinnerRadius = innerCornerRadius;\r\n\t}\r\n\r\n\tif (innerRadiusY < innerCornerRadiusY) {\r\n\t\tinnerRadiusY = innerCornerRadiusY;\r\n\t}\r\n\r\n\tlet crInnerAngle: number = Math.asin(innerCornerRadius / innerRadius / 2) * $math.DEGREES * 2;\r\n\tlet crInnerAngleY: number = Math.asin(innerCornerRadiusY / innerRadiusY / 2) * $math.DEGREES * 2;\r\n\r\n\tif (!$type.isNumber(crInnerAngle)) {\r\n\t\tcrInnerAngle = 0;\r\n\t}\r\n\tif (!$type.isNumber(crInnerAngleY)) {\r\n\t\tcrInnerAngleY = 0;\r\n\t}\r\n\r\n\tlet middleAngle = startAngle + arc / 2;\r\n\tlet mPoint = { x: $math.round($math.cos(middleAngle) * innerRadius, 4), y: $math.sin(middleAngle) * innerRadiusY };\r\n\r\n\tlet a0 = { x: $math.cos(startAngle) * (innerRadius + innerCornerRadius), y: $math.sin(startAngle) * (innerRadiusY + innerCornerRadiusY) };\r\n\tlet b0 = { x: $math.cos(startAngle) * (radius - cornerRadius), y: $math.sin(startAngle) * (radiusY - cornerRadiusY) };\r\n\tlet c0 = { x: $math.cos(endAngle) * (radius - cornerRadius), y: $math.sin(endAngle) * (radiusY - cornerRadiusY) };\r\n\tlet d0 = { x: $math.cos(endAngle) * (innerRadius + innerCornerRadius), y: $math.sin(endAngle) * (innerRadiusY + innerCornerRadiusY) };\r\n\r\n\tlet b1 = { x: $math.cos(startAngle + crAngle) * radius, y: $math.sin(startAngle + crAngleY) * radiusY };\r\n\tlet d1 = { x: $math.cos(endAngle - crInnerAngle) * innerRadius, y: $math.sin(endAngle - crInnerAngleY) * innerRadiusY };\r\n\r\n\t// some magic math\r\n\tinnerCornerRadius += innerCornerRadius * $math.sin(crInnerAngle / 2);\r\n\tinnerCornerRadiusY += innerCornerRadiusY * $math.sin(crInnerAngleY / 2);\r\n\r\n\tif (crInnerAngle > (endAngle - startAngle) / 2) {\r\n\t\td1 = mPoint;\r\n\t}\r\n\r\n\tlet path: string = \"\";\r\n\t// start from b if this is full circle\r\n\tif (arc == 360) {\r\n\t\tpath = moveTo(b0);\r\n\t}\r\n\t// otherwise start from a\r\n\telse {\r\n\t\tpath = moveTo(a0);\r\n\t\tpath += lineTo(b0);\r\n\t\tpath += arcToPoint(b1, cornerRadius, cornerRadiusY, true);\r\n\t}\r\n\r\n\t// draw arc\r\n\tpath += arcTo(startAngle + crAngle, arc - 2 * crAngle, radius, radiusY);\r\n\r\n\t// draw inner arc\r\n\tif ($type.isNumber(innerRadius) && innerRadius != 0) {\r\n\r\n\t\t// move to B if this is full circle\r\n\t\tif (arc == 360 && cornerRadius == 0) {\r\n\t\t\tpath += moveTo(d0);\r\n\t\t}\r\n\t\t// draw line otherwise\r\n\t\telse {\r\n\t\t\tpath += arcToPoint(c0, cornerRadius, cornerRadiusY, true);\r\n\t\t\tpath += lineTo(d0);\r\n\t\t\tpath += arcToPoint(d1, innerCornerRadius, innerCornerRadiusY, true);\r\n\t\t}\r\n\r\n\t\tpath += arcTo(endAngle - crInnerAngle, -(arc - 2 * crInnerAngle), innerRadius, innerRadiusY);\r\n\t\tif (arc < 360 || cornerRadius > 0) {\r\n\t\t\tpath += arcToPoint(a0, innerCornerRadius, innerCornerRadiusY, true);\r\n\t\t}\r\n\t\tpath += lineTo(a0);\r\n\t}\r\n\telse {\r\n\t\tpath += arcToPoint(c0, cornerRadius, cornerRadiusY, true);\r\n\t\tif (arc < 360) {\r\n\t\t\tpath += lineTo(a0);\r\n\t\t}\r\n\t}\r\n\r\n\treturn path;\r\n}\r\n\r\n/**\r\n * Creates a path for an arc to specific coordinate.\r\n *\r\n * @ignore Exclude from docs\r\n * @todo Description\r\n * @param point         Reference point\r\n * @param radius        Radius\r\n * @param radiusY       Vertical radius (for skewed arcs)\r\n * @param sweepFlag     [description]\r\n * @param largeArcFlag  [description]\r\n * @param xAxisRotation [description]\r\n * @return Arc path\r\n */\r\nexport function arcToPoint(point: IPoint, radius: number, radiusY?: number, sweepFlag?: boolean, largeArcFlag?: boolean, xAxisRotation?: number): string {\r\n\tif (radius == 0) {\r\n\t\treturn \"\";\r\n\t}\r\n\txAxisRotation = xAxisRotation || 0;\r\n\tlargeArcFlag = Boolean(largeArcFlag);\r\n\tsweepFlag = Boolean(sweepFlag);\r\n\r\n\tlet c = \",\";\r\n\tlet sweepFlagValue: number = +sweepFlag; // converts to 1 or 0\r\n\tlet largeArcFlagValue: number = +largeArcFlag;  // converts to 1 or 0\r\n\r\n\treturn \" A\" + radius + c + radiusY + c + xAxisRotation + c + largeArcFlagValue + c + sweepFlagValue + c + $math.round(point.x, 4) + c + $math.round(point.y, 4);\r\n}\r\n\r\n/**\r\n * Creates a new rectangle.\r\n *\r\n * @ignore Exclude from docs\r\n * @param width   Width (px)\r\n * @param height  Height (px)\r\n * @param x       X position\r\n * @param y       Y position\r\n * @return Rectangle\r\n */\r\nexport function rectangle(width: number, height: number, x?: number, y?: number): string {\r\n\tif (!$type.isNumber(x)) {\r\n\t\tx = 0;\r\n\t}\r\n\tif (!$type.isNumber(y)) {\r\n\t\ty = 0;\r\n\t}\r\n\treturn moveTo({ x: x, y: y }) + lineTo({ x: x + width, y: y }) + lineTo({ x: x + width, y: y + height }) + lineTo({ x: x, y: y + height }) + closePath();\r\n}\r\n\r\n/**\r\n * Converts a rectangle to an SVG path.\r\n *\r\n * @ignore Exclude from docs\r\n * @param rect  Rectangle\r\n * @param ccw   Counter-clockwise?\r\n * @return SVG path\r\n */\r\nexport function rectToPath(rect: IRectangle, ccw?: boolean): string {\r\n\tlet c = \",\";\r\n\tlet L = \" L\";\r\n\tif (ccw) {\r\n\t\treturn \"M\" + rect.x\r\n\t\t\t+ c + rect.y + L + rect.x\r\n\t\t\t+ c + (rect.y + rect.height) + L + (rect.x + rect.width)\r\n\t\t\t+ c + (rect.y + rect.height) + L + (rect.x + rect.width)\r\n\t\t\t+ c + rect.y + L + rect.x\r\n\t\t\t+ c + rect.y;\r\n\t}\r\n\telse {\r\n\t\treturn \"M\" + rect.x\r\n\t\t\t+ c + rect.y + L + (rect.x + rect.width)\r\n\t\t\t+ c + rect.y + L + (rect.x + rect.width)\r\n\t\t\t+ c + (rect.y + rect.height) + L + rect.x\r\n\t\t\t+ c + (rect.y + rect.height) + L + rect.x\r\n\t\t\t+ c + rect.y;\r\n\t}\r\n}\r\n\r\n/**\r\n * Converts SVG path to array of points.\r\n *\r\n * Note, this is experimental feature based on method which is deprecated\r\n * on some browsers and some browsers do not support it at all.\r\n *\r\n * You can save the output of this function, but not rely on it completely.\r\n */\r\nexport function pathToPoints(path: string, pointCount: number): IPoint[] {\r\n\r\n\tlet paper = getGhostPaper();\r\n\tlet svgPath: SVGPathElement = <any>paper.add(\"path\").node;\r\n\tsvgPath.setAttribute(\"d\", path);\r\n\r\n\tif (svgPath.getPointAtLength && svgPath.getTotalLength) {\r\n\t\tlet length = svgPath.getTotalLength();\r\n\r\n\t\tlet toPoints = []\r\n\t\tfor (let i = 0; i < pointCount; i++) {\r\n\t\t\tlet point = svgPath.getPointAtLength(i / pointCount * length);\r\n\t\t\ttoPoints.push({ x: point.x, y: point.y });\r\n\t\t}\r\n\r\n\t\treturn toPoints;\r\n\t}\r\n\r\n\tsvgPath.remove();\r\n}\r\n\r\n\r\nexport function spiralPoints(cx: number, cy: number, radius: number, radiusY: number, innerRadius: number, step: number, radiusStep: number, startAngle?: number, endAngle?: number): IPoint[] {\r\n\r\n\tif (!$type.isNumber(startAngle)) {\r\n\t\tstartAngle = 0;\r\n\t}\r\n\r\n\tif (!$type.isNumber(startAngle)) {\r\n\t\tendAngle = startAngle;\r\n\t}\r\n\r\n\tlet r = innerRadius + 0.01;\r\n\tlet angle = startAngle * $math.RADIANS;\r\n\tlet points = [];\r\n\r\n\twhile (r < radius + radiusStep) {\r\n\r\n\t\tlet stepSize = step;\r\n\t\tif (stepSize / 2 > r) {\r\n\t\t\tstepSize = 2 * r;\r\n\t\t}\r\n\r\n\t\tangle += 2 * Math.asin(stepSize / 2 / r);\t\t\r\n\r\n\t\tif (angle * $math.DEGREES > endAngle + ((radius - innerRadius) / radiusStep) * 360) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tlet degrees = angle * $math.DEGREES;\r\n\r\n\t\tlet point = { x: cx + r * Math.cos(angle), y: cy + r * radiusY / radius * Math.sin(angle) };\r\n\t\tpoints.push(point);\r\n\r\n\t\tr = innerRadius + degrees / 360 * radiusStep;\r\n\r\n\t}\r\n\r\n\tpoints.shift();\r\n\r\n\treturn points;\r\n}\r\n\r\nexport function pointsToPath(points: IPoint[]) {\r\n\tif (!points || points.length == 0) {\r\n\t\treturn \"\";\r\n\t}\r\n\tlet path = moveTo(points[0]);\r\n\tif (points && points.length > 0) {\r\n\t\tfor (let i = 1; i < points.length; i++) {\r\n\t\t\tpath += lineTo(points[i]);\r\n\t\t}\r\n\t}\r\n\treturn path;\r\n}\r\n","/**\r\n * An Adapter can be used to apply chained synchronous transformations to any\r\n * value at runtime.\r\n *\r\n * Each type class using Adapters must have `adapters` property and adapter\r\n * interface defined.\r\n *\r\n * Adapters can be used to allow external code to apply transformations to any\r\n * value at any time.\r\n *\r\n * For example we have a Weather class which has a method `now()` which returns\r\n * current temperature.\r\n *\r\n * ```\r\n * function now() {\r\n *   // ... calculate temperature\r\n *   let temp = \"Temperature now is \" + degrees + \"F\";\r\n *   return temp;\r\n * }\r\n * ```\r\n *\r\n * Now, supposed we want to let other classes to modify the output of the\r\n * `now()`? We just apply an adapter to the `temp` before it is returned:\r\n *\r\n * ```\r\n * temp = this.adapters.apply(\"now\", {\r\n *   temp: temp,\r\n *   degrees: degrees\r\n * }).temp;\r\n * ```\r\n *\r\n * Some other class might tap onto it by defining an Adapter that calculates\r\n * the temperature in Celsius:\r\n *\r\n * weather.adapters.add(\"now\", (arg) => {\r\n *   arg.temp += \"(\" + farenheitToCelsius(arg.degrees) + \"C)\";\r\n *   return arh;\r\n * });\r\n *\r\n * Furthermore some time-related class could add time:\r\n *\r\n * weather.adapters.add(\"now\", (arg) => {\r\n *   arg.temp += \"; the time now is \" + (new Date().toLocaleString());\r\n *   return arh;\r\n * });\r\n *\r\n * So without adapters we would get output like this:\r\n *\r\n * ```\r\n * Temperature now is 90F\r\n * ```\r\n *\r\n * With adapters applied we now have:\r\n *\r\n * ```\r\n * Temperature now is 90F (32C); the time now is 12/11/2012, 7:00:00 PM\r\n * ```\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { SortedList } from \"./SortedList\";\r\nimport { EventDispatcher } from \"./EventDispatcher\";\r\nimport * as $number from \"./Number\";\r\nimport * as $order from \"./Order\";\r\nimport * as $iter from \"../utils/Iterator\";\r\nimport * as $array from \"../utils/Array\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $object from \"../utils/Object\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n/**\r\n * Adapter interface.\r\n */\r\ninterface IAdapterCallback<Target, T> {\r\n\tid: number;\r\n\tkey: any;\r\n\tcallback: any;\r\n\tscope: any;\r\n\tpriority: number;\r\n}\r\n\r\n/**\r\n * Defines an interface for a global adapter.\r\n */\r\ninterface IGlobalAdapterCallback {\r\n\tid: number;\r\n\tkey: string;\r\n\tcallback: <T, Target, Key extends keyof T, C>(this: C, value: T[Key], target: Target, key?: keyof T) => T[Key];\r\n\tscope: any;\r\n\tpriority: number;\r\n\ttype: { new(): any };\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * GLOBAL ADAPTER\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * A global adapter is an adpater that is attached to a class type rather than\r\n * specific object instance.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport class GlobalAdapter {\r\n\r\n\t/**\r\n\t * Callback id iterator.\r\n\t */\r\n\tprivate _callbackId: number = 0;\r\n\r\n\t/**\r\n\t * A list of if callbacks (adapters).\r\n\t */\r\n\tprivate _callbacks = new SortedList<IGlobalAdapterCallback>((left, right) => {\r\n\t\treturn $order.or($number.order(left.priority, right.priority),\r\n\t\t\t$number.order(left.id, right.id));\r\n\t});\r\n\r\n\tpublic addAll<T, Target, Key extends keyof T>(\r\n\t\ttype: { new(): Target },\r\n\t\tkey: Key,\r\n\t\tcallback: (value: T[Key], target: Target, key: keyof T) => T[Key],\r\n\t\tpriority?: number\r\n\t): void;\r\n\r\n\tpublic addAll<T, Target, Key extends keyof T, C>(\r\n\t\ttype: { new(): Target },\r\n\t\tkey: Key,\r\n\t\tcallback: (this: C, value: T[Key], target: Target, key: keyof T) => T[Key],\r\n\t\tpriority?: number,\r\n\t\tscope?: C\r\n\t): void;\r\n\r\n\t/**\r\n\t * Adds a global callback which is not specific to any particular object.\r\n\t * Whenever an adapter in any object of the specific class type is invoked\r\n\t * global adapters will kick in.\r\n\t *\r\n\t * @param type      Class type\r\n\t * @param key       Adapter key\r\n\t * @param callback  Callback function\r\n\t * @param priority  Priority (higher priority meaning adapter will be applied later)\r\n\t * @param scope     Callback function scaope\r\n\t */\r\n\tpublic addAll(type: any, key: any, callback: any, priority: number = 0, scope?: any): void {\r\n\t\tthis._callbacks.insert({\r\n\t\t\tid: ++this._callbackId,\r\n\t\t\tkey: key,\r\n\t\t\tcallback: callback,\r\n\t\t\tpriority: priority,\r\n\t\t\tscope: scope,\r\n\t\t\ttype: type\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Returns if there are adapters for specific type available.\r\n\t *\r\n\t * @param type  Adapter type\r\n\t * @param key   Adapter key\r\n\t * @return {boolean}\r\n\t */\r\n\tpublic isEnabled<T, Target, Key extends keyof T>(type: Target, key: Key): boolean {\r\n\t\treturn $array.any(this._callbacks.values, (x) => x.key === key && type instanceof x.type);\r\n\t}\r\n\r\n\t/**\r\n\t * Applies global adapters for the object of the specific type.\r\n\t *\r\n\t * @param type   Class type\r\n\t * @param key    Adapter key\r\n\t * @param value  Value\r\n\t */\r\n\tpublic applyAll<T, Target, Key extends keyof T = keyof T>(type: Target, key: Key, value: T[Key]): T[Key] {\r\n\t\t// This is needed to improve the performance and reduce garbage collection\r\n\t\tconst callbacks = this._callbacks.values;\r\n\t\tconst length = callbacks.length;\r\n\r\n\t\tif (length == 0) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Cycle through all callbacks and find the ones we need to use\r\n\t\tfor (let i = 0; i < length; ++i) {\r\n\t\t\tconst item = callbacks[i];\r\n\r\n\t\t\tif (item.key === key && type instanceof item.type) {\r\n\t\t\t\tvalue = (<any>item).callback.call(item.scope, value, type, key);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * A global Adapter for plugins that want to add specific\r\n * functionality for any chart, not just specific instance.\r\n *\r\n * If you want to add an adapter which applies to all instances of the same\r\n * object type, like, for instance all slices in PieSeries, you can use\r\n * global adapter.\r\n *\r\n * Global adapter is a system-wide instance, accessible via `globalAdapter`.\r\n *\r\n * ```TypeScript\r\n * am4core.globalAdapter.addAll<am4charts.IPieSeriesAdapters, am4charts.PieSeries, \"fill\">(am4charts.PieSeries, \"fill\", (value, target, key) => {\r\n *   return am4core.color(\"#005500\");\r\n * });\r\n * ```\r\n * ```JavaScript\r\n * am4core.globalAdapter.addAll(am4charts.PieSeries, \"fill\", (value, target, key) => {\r\n *   return am4core.color(\"#005500\");\r\n * });\r\n * ```\r\n *\r\n * @ignore\r\n */\r\nexport let globalAdapter: GlobalAdapter = new GlobalAdapter();\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REGULAR ADAPTER\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Adapter allows adding ordered callback functions and associating them with a\r\n * string-based key. An Adapter user can then easily invoke those callbacks to\r\n * apply custom functions on its input, output or intermediate values.\r\n *\r\n * Custom code and plugins can add their own callbacks to modify and enhance\r\n * core functionality.\r\n *\r\n * See the description of `add()` for an example.\r\n *\r\n * Almost any object in amCharts4 has own adapter, accessible with `adapter`\r\n * property.\r\n *\r\n * Any adapters added to it will be applied to that object only.\r\n *\r\n * ### Global Adapters\r\n *\r\n * If you want to add an adapter which applies to all instances of the same\r\n * object type, like, for instance all slices in PieSeries, you can use\r\n * global adapter.\r\n *\r\n * Global adapter is a system-wide instance, accessible via `globalAdapter`.\r\n *\r\n * ```TypeScript\r\n * am4core.globalAdapter.addAll<am4charts.IPieSeriesAdapters, am4charts.PieSeries, \"fill\">(am4charts.PieSeries. \"fill\", (value, target, key) => {\r\n *   return am4core.color(\"#005500\");\r\n * });\r\n * ```\r\n * ```JavaScript\r\n * am4core.globalAdapter.addAll(am4charts.PieSeries. \"fill\", (value, target, key) => {\r\n *   return am4core.color(\"#005500\");\r\n * });\r\n * ```\r\n *\r\n * {@link https://www.amcharts.com/docs/v4/reference/adapter_module/#globalAdapter_property More info}.\r\n *\r\n * @important\r\n */\r\nexport class Adapter<Target, T> {\r\n\r\n\t/**\r\n\t * Internal counter for callback ids.\r\n\t */\r\n\tprivate _callbackId: number = 0;\r\n\r\n\t/**\r\n\t * A list of adapter callbacks.\r\n\t *\r\n\t * @param $number.order(left.priority, right.priority) [description]\r\n\t * @param $number.order(left.id,       right.id));\t}  [description]\r\n\t */\r\n\tprivate _callbacks = new SortedList<IAdapterCallback<Target, T>>((left, right) => {\r\n\t\treturn $order.or($number.order(left.priority, right.priority),\r\n\t\t\t$number.order(left.id, right.id));\r\n\t});\r\n\r\n\tprotected _disabled: { [key in keyof T]?: number } = {};\r\n\r\n\t/**\r\n\t * Holds an object reference this Adapter is for.\r\n\t */\r\n\tpublic object: Target;\r\n\r\n\t/**\r\n\t * Event dispatcher.\r\n\t */\r\n\tpublic events: EventDispatcher<{\r\n\t\tinserted: {};\r\n\t\tremoved: {};\r\n\t}>;\r\n\r\n\t/**\r\n\t * Constructor, sets the object referece this Adapter should be used for.\r\n\t *\r\n\t * @param c Object\r\n\t */\r\n\tconstructor(c: Target) {\r\n\t\tthis.object = c;\r\n\r\n\t\t// TODO this exposes the internal events\r\n\t\tthis.events = this._callbacks.events;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a callback for a specific key.\r\n\t *\r\n\t * ```TypeScript\r\n\t * // Override fill color value and make all slices green\r\n\t * chart.series.template.adapter.add(\"fill\", (value, target, key) => {\r\n\t *   return am4core.color(\"#005500\");\r\n\t * });\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * // Override fill color value and make all slices green\r\n\t * chart.series.template.adapter.add(\"fill\", function(value, target, key) {\r\n\t *   return am4core.color(\"#005500\");\r\n\t * });\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"series\": [{\r\n\t *     // ...\r\n\t *     \"adapter\": {\r\n\t *     \t// Override fill color value and make all slices green\r\n\t *     \t\"fill\": function(value, target, key) {\r\n\t *     \t  return am4core.color(\"#005500\");\r\n\t *     \t}\r\n\t *     }\r\n\t *   }]\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * The above will call user-defined function (adapter) whenever `fill` value\r\n\t * is requested from the Pie series, allowing it to override the default\r\n\t * using custom code and any fuzzy logic.\r\n\t *\r\n\t * There can be any number of adapters set on one property key.\r\n\t *\r\n\t * In this case adapters will be applied in daisy-chain fashion. The first\r\n\t * adapter in queue will make its transformation. The next one will have\r\n\t * the output of the first adapter as a starting value, etc.\r\n\t *\r\n\t * The order of the adapters are determined either by the order they were\r\n\t * added in, or their `priority` value.\r\n\t *\r\n\t * The heigher the `priority`, the later in the game adapter will be applied.\r\n\t *\r\n\t * @param key       Key\r\n\t * @param callback  A callback function\r\n\t * @param priority  The higher priority, the more chance the adapter will be applied last\r\n\t * @param scope     Scope for the callback function\r\n\t */\r\n\tpublic add<Key extends keyof T, C>(key: Key, callback: (this: C, value: T[Key], target: Target, key: Key) => T[Key], priority: number = 0, scope?: C): void {\r\n\t\tthis._callbacks.insert({\r\n\t\t\tid: ++this._callbackId,\r\n\t\t\tkey: key,\r\n\t\t\tcallback: callback,\r\n\t\t\tpriority: priority,\r\n\t\t\tscope: scope\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether specific adapter is already set.\r\n\t *\r\n\t * @param key       Key\r\n\t * @param callback  A callback function\r\n\t * @param priority  The higher priority, the more chance the adapter will be applied last\r\n\t * @param scope     Scope for the callback function\r\n\t * @returns                            Adapter set?\r\n\t */\r\n\tpublic has<Key extends keyof T, C>(key: Key, callback: (this: C, value: T[Key], target: Target, key: Key) => T[Key], priority: number = 0, scope?: C): boolean {\r\n\t\treturn $iter.contains(this._callbacks.iterator(), (item) => {\r\n\t\t\treturn item.key === key && item.callback === callback && item.priority === priority && item.scope === scope;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Removes adapter callbacks for the specific `key`.\r\n\t *\r\n\t * If `priority` is specified, only callbacks for that priority are removed.\r\n\t *\r\n\t * @param key      Key\r\n\t * @param priority Priority\r\n\t * @todo Implement\r\n\t */\r\n\tpublic remove(key: string, priority?: number): void {\r\n\t\t// It has to make a copy because it removes the elements while iterating\r\n\t\t// TODO inefficient\r\n\t\t// TODO should this re-enable the key ?\r\n\t\t$array.each($iter.toArray(this._callbacks.iterator()), (item) => {\r\n\t\t\t// TODO test this\r\n\t\t\tif (item.key === key && (!$type.isNumber(priority) || priority === item.priority)) {\r\n\t\t\t\tthis._callbacks.remove(item);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Enable applying adapters for a certain key, if it was disabled before by\r\n\t * `disableKey()`.\r\n\t *\r\n\t * @param key Key\r\n\t */\r\n\tpublic enableKey<Key extends keyof T>(key: Key): void {\r\n\t\tdelete this._disabled[key];\r\n\t}\r\n\r\n\t/**\r\n\t * Disable applying adapters for a certain key.\r\n\t *\r\n\t * Optionally, can set how many applies to skip before automatically\r\n\t * re-enabling the applying.\r\n\t *\r\n\t * @param key     Key\r\n\t * @param amount  Number of applies to skip\r\n\t */\r\n\tpublic disableKey<Key extends keyof T>(key: Key, amount: number = Infinity): void {\r\n\t\tthis._disabled[key] = amount;\r\n\t}\r\n\r\n\tprotected _hasListenersByType<Key extends keyof T>(key: Key): boolean {\r\n\t\treturn $array.any(this._callbacks.values, (x) => x.key === key);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns if there are any enabled adapters set for the specific `key`.\r\n\t *\r\n\t * @returns Are there any adapters for the key?\r\n\t */\r\n\tpublic isEnabled<Key extends keyof T>(key: Key): boolean {\r\n\t\treturn this._disabled[key] == null && (this._hasListenersByType(key) || globalAdapter.isEnabled<T, Target, Key>(this.object, key));\r\n\t}\r\n\r\n\tprotected _shouldDispatch<Key extends keyof T>(key: Key): boolean {\r\n\t\tconst count = this._disabled[key];\r\n\r\n\t\tif (!$type.isNumber(count)) {\r\n\t\t\treturn true;\r\n\r\n\t\t} else {\r\n\t\t\tif (count <= 1) {\r\n\t\t\t\tdelete this._disabled[key];\r\n\r\n\t\t\t} else {\r\n\t\t\t\t--this._disabled[key];\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Passes the input value through all the callbacks for the defined `key`.\r\n\t *\r\n\t * @param key      Key\r\n\t * @param value    Input value\r\n\t * @param ...rest  Rest of the parameters to be passed into callback\r\n\t * @return Output value\r\n\t */\r\n\tpublic apply<Key extends keyof T>(key: Key, value: T[Key]): T[Key] {\r\n\t\tif (this._shouldDispatch(key)) {\r\n\t\t\t// This is needed to improve the performance and reduce garbage collection\r\n\t\t\tconst callbacks = this._callbacks.values;\r\n\t\t\tconst length = callbacks.length;\r\n\r\n\t\t\tif (length > 0) {\r\n\t\t\t\tfor (let i = 0; i < length; ++i) {\r\n\t\t\t\t\tconst item = callbacks[i];\r\n\r\n\t\t\t\t\tif (item.key === key) {\r\n\t\t\t\t\t\tvalue = item.callback.call(item.scope, value, this.object, key);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Apply global adapters\r\n\t\t\tvalue = globalAdapter.applyAll<T, Target, Key>(this.object, key, value);\r\n\r\n\t\t\treturn value;\r\n\r\n\t\t} else {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns all adapter keys which are in this adapter.\r\n\t *\r\n\t * @return Adapter keys\r\n\t */\r\n\tpublic keys(): Array<string> {\r\n\t\t// TODO inefficient\r\n\t\treturn $iter.toArray($iter.map(this._callbacks.iterator(), (x) => x.key));\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Copies all the adapter callbacks from `source`.\r\n\t *\r\n\t * @param source  An Adapter to copy items from\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\t$iter.each(source._callbacks.iterator(), (x) => {\r\n\t\t\tthis.add(x.key, x.callback, x.priority, x.scope);\r\n\t\t});\r\n\t\t$object.each(source._disabled, (key, val) => {\r\n\t\t\tthis._disabled[key] = val;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Clears all callbacks from this Adapter.\r\n\t */\r\n\tpublic clear(): void {\r\n\t\t// TODO should this also re-enable all the keys ?\r\n\t\tthis._callbacks.clear();\r\n\t}\r\n\r\n}\r\n","/**\r\n * A collection of String-based constants.\r\n * @hidden\r\n * @ignore Exclude from docs\r\n */\r\n\r\n/**\r\n * @ignore Exclude from docs\r\n */\r\nexport let PX: string = \"px\";\r\n\r\n/**\r\n * @ignore Exclude from docs\r\n */\r\nexport let STRING: string = \"string\";\r\n\r\n/**\r\n * @ignore Exclude from docs\r\n */\r\nexport let NUMBER: string = \"number\";\r\n\r\n/**\r\n * @ignore Exclude from docs\r\n */\r\nexport let DATE: string = \"date\";\r\n\r\n/**\r\n * @ignore Exclude from docs\r\n */\r\nexport let DURATION: string = \"duration\";\r\n\r\n/**\r\n * @ignore Exclude from docs\r\n */\r\nexport let PLACEHOLDER: string = \"__§§§__\";\r\n\r\n/**\r\n * @ignore Exclude from docs\r\n */\r\nexport let PLACEHOLDER2: string = \"__§§§§__\";\r\n","/**\n * ============================================================================\n * IMPORTS\n * ============================================================================\n * @hidden\n */\nimport { ILocale } from \"./utils/Language\";\n\n/**\n * Defines system-wide options for amCharts 4.\n *\n * Accessible via singleton object `am4core.options`.\n *\n * Options set here are will be applicable to all charts created afterwards.\n *\n * E.g.:\n *\n * ```TypeScript\n * am4core.options.autoSetClassName = true;\n * ```\n * ```JavaScript\n * am4core.options.autoSetClassName = true;\n * ```\n */\nexport interface Options {\n\t/**\n\t * Console output enabled.\n\t */\n\tverbose: boolean;\n\n\t/**\n\t * @ignore\n\t */\n\tcommercialLicense: boolean;\n\n\t/**\n\t * amCharts will add `class` property to some elements. All those class names\n\t * will be prefixed by `classNamePrefix`.\n\t *\n\t * @default \"amcharts-\"\n\t */\n\tclassNamePrefix: string;\n\n\t/**\n\t * Normally, the chart will create its elements without any `className`\n\t * attributes.\n\t *\n\t * If you set this to `true`, it will set class names that will reflect\n\t * the actual class this the SVG element corresponds to.\n\t *\n\t * The className will contain class prefixed with `amcharts-`. (prefix is\n\t * configurable via `classNamePrefix`)\n\t *\n\t * E.g. `\"amcharts-button\"`.\n\t *\n\t * @default false\n\t */\n\tautoSetClassName: boolean;\n\n\t/**\n\t * A default locale to auto-apply to all new charts created.\n\t */\n\tdefaultLocale?: ILocale;\n\n\t/**\n\t * When multi-segment lines ([[Polyline]]) are drawn some points may be\n\t * simplified if they are closer than `minPolylineStep`.\n\t *\n\t * The bigger this value, the more simplified lines will come out.\n\t *\n\t * This setting will effect [[LineSeries]] and derivative classes.\n\t *\n\t * IMPORTANT: This setting is not compatible with [[StepLineSeries]].\n\t *\n\t * @default 0.5\n\t * @since 4.2.5\n\t */\n\tminPolylineStep?: number;\n\n\t/**\n\t * Whether the chart should only display when its container is visible\n\t * on the document viewport.\n\t *\n\t * This setting can be combined with `queue` for better performance.\n\t *\n\t * NOTE: if your charts are located in the scrollable container, make sure\n\t * you also set `viewportTarget` to a reference for that container.\n\t *\n\t * @default false\n\t * @since 4.5.0\n\t */\n\tonlyShowOnViewport: boolean;\n\n\t/**\n\t * A reference to the HTML element to be used as a secondary viewport for\n\t * charts.\n\t *\n\t * Use this if you are placing charts in a scrollable container and using\n\t * with `onlyShowOnViewport = true`.\n\t *\n\t * @since 4.7.4\n\t */\n\tviewportTarget?: HTMLElement | HTMLElement[];\n\n\t/**\n\t * Whether to queue all charts rendering. One chart will be rendered at a time. The next\n\t * chart starts to render after the previous chart's ready event.\n\t *\n\t * This setting can be combined with `onlyShowOnViewport` for better performance.\n\t *\n\t * @default false\n\t * @since 4.5.0\n\t */\n\tqueue: boolean;\n\n\t/**\n\t * Whether to automatically dispose the charts when they're removed from the DOM.\n\t *\n\t * @default false\n\t * @since 4.9.25\n\t */\n\tautoDispose: boolean;\n\n\t/**\n\t * List of applied licenses.\n\t *\n\t * @type {String[]}\n\t */\n\tlicenses: String[];\n\n\t/**\n\t * Should error modals be suppressed from displaying.\n\t *\n\t * Errors might originate from setting validation code, or generic JS-thrown\n\t * errors.\n\t *\n\t * @since 4.9.13\n\t * @default false\n\t */\n\tsuppressErrors: boolean;\n\n\t/**\n\t * Should warnings be suppressed from displaying.\n\t *\n\t * @since 4.9.29\n\t * @default false\n\t */\n\tsuppressWarnings: boolean;\n\n\t/**\n\t * Set this to `false` to effectivly disable all animations on all charts\n\t * regardless of themes used or individual animation properties.\n\t *\n\t * @since 4.9.14\n\t * @default false\n\t */\n\tanimationsEnabled: boolean\n\n\t/**\n\t * If set, amCharts will use this as a nonce-parameter for all dynamically\n\t * created stylesheets, so it can be addressed in `Content-Security-Policy`\n\t * headers.\n\t *\n\t * @since 4.9.17\n\t */\n\tnonce: string\n\n\t/**\n\t * When charts are created using `am4core.createDeferred()`, this parameter\n\t * determines number of milliseconds to wait between creation of each chart.\n\t *\n\t * @default 100\n\t * @since 4.10.0\n\t */\n\tdeferredDelay: number;\n\n\t/**\n\t * Should hovering of objects be disabled when some other element is being\n\t * transfored, e.g. dragged or resized.\n\t *\n\t * Available options:\n\t * * `\"never\"` (default) - hovers are never disabled.\n\t * * `\"touch\"` - hovers are disabled only if transforming via touch screen.\n\t * *`\"always\"` - hovers are disabled on all transforming actions.\n\t * \n\t * @default \"never\"\n\t * @since 4.10.1\n\t */\n\tdisableHoverOnTransform: \"never\" | \"touch\" | \"always\";\n\n\t/**\n\t * A precision (number of decimals) to be used for paths/lines/points\n\t * when `pixelPerfect = true`.\n\t *\n\t * @default 0\n\t * @since 4.10.11\n\t */\n\tpixelPerfectPrecision: number;\n\n}\n\n/**\n * Global options.\n */\nexport const options: Options = {\n\tverbose: true,\n\tcommercialLicense: false,\n\tclassNamePrefix: \"amcharts-\",\n\tautoSetClassName: false,\n\tminPolylineStep: 0.5,\n\tonlyShowOnViewport: false,\n\tqueue: false,\n\tautoDispose: false,\n\tlicenses: [],\n\tsuppressErrors: false,\n\tsuppressWarnings: false,\n\tanimationsEnabled: true,\n\tnonce: \"\",\n\tdeferredDelay: 100,\n\tdisableHoverOnTransform: \"never\",\n\tpixelPerfectPrecision:0\n};\n","/**\r\n * Interaction manages all aspects of user interaction - mouse move,\r\n * click, hover, drag events, touch gestures.\r\n *\r\n * [[InteractionObject]] elements that want to use certain events, must attach event\r\n * listeners to Interaction instance.\r\n *\r\n * Interaction itself will not modify [[InteractionObject]] elements, it will be up to\r\n * those elements to handle interaction information received via event triggers.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObjectEvents, IBaseObjectEvents } from \"../Base\";\r\nimport { List } from \"../utils/List\";\r\nimport { AMEvent } from \"../utils/EventDispatcher\";\r\nimport { Animation } from \"../utils/Animation\";\r\nimport { IInertiaOptions, ISwipeOptions, IHitOptions, IHoverOptions, IKeyboardOptions, IMouseOptions } from \"./InteractionOptions\";\r\nimport { MultiDisposer, IDisposer } from \"../utils/Disposer\";\r\nimport { InteractionObject, IInteractionObjectEvents } from \"./InteractionObject\";\r\nimport { InteractionKeyboardObject } from \"./InteractionKeyboardObject\";\r\nimport { Dictionary } from \"../utils/Dictionary\";\r\nimport { Inertia, InertiaTypes } from \"./Inertia\";\r\nimport { IPointer, IBreadcrumb } from \"./Pointer\";\r\nimport { addEventListener } from \"../utils/DOM\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { IStyleProperty } from \"../defs/IStyleProperty\";\r\nimport { keyboard } from \"../utils/Keyboard\";\r\nimport { system } from \"./../System\";\r\nimport { options } from \"./../Options\";\r\nimport * as $ease from \"../utils/Ease\";\r\nimport * as $math from \"../utils/Math\";\r\nimport * as $array from \"../utils/Array\";\r\nimport * as $dom from \"../utils/DOM\";\r\nimport * as $iter from \"../utils/Iterator\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $time from \"../utils/Time\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Represents an Event object that comes from [[Interaction]]\r\n */\r\nexport interface IInteractionEvents extends IBaseObjectEvents {\r\n\r\n\ttrack: {\r\n\t\tpointer: IPointer;\r\n\t\ttouch: boolean;\r\n\t\tevent: MouseEvent | TouchEvent;\r\n\t};\r\n\r\n\tdown: {\r\n\t\tpointer: IPointer;\r\n\t\ttouch: boolean;\r\n\t\tevent: MouseEvent | TouchEvent;\r\n\t};\r\n\r\n\tup: {\r\n\t\tpointer: IPointer;\r\n\t\ttouch: boolean;\r\n\t\tevent: MouseEvent | TouchEvent;\r\n\t};\r\n\r\n\tfocus: {\r\n\t\tevent: FocusEvent;\r\n\t}\r\n}\r\n\r\n/**\r\n * Interface representing a delayed event\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport interface IDelayedEvent {\r\n\ttype: keyof IInteractionObjectEvents;\r\n\tio: InteractionObject;\r\n\tpointer: IPointer;\r\n\tevent: MouseEvent | TouchEvent;\r\n\tkeepUntil?: number;\r\n\ttimeout?: IDisposer;\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n\r\n/**\r\n* Interaction manages all aspects of user interaction - mouse move,\r\n* click, hover, drag events, touch gestures.\r\n*\r\n* [[InteractionObject]] elements that want to use certain events, must attach event\r\n* listeners to Interaction instance.\r\n*\r\n* Interaction itself will not modify [[InteractionObject]] elements, it will be up to\r\n* those elements to handle interaction information received via event triggers.\r\n*\r\n* @see {@link IInteractionEvents} for a list of available events\r\n*/\r\nexport class Interaction extends BaseObjectEvents {\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t *\r\n\t * @deprecated Use inetraction.body.events instead\r\n\t */\r\n\tpublic _events!: IInteractionEvents;\r\n\r\n\t/**\r\n\t * A reference to an [[Interaction]] object for document's body.\r\n\t *\r\n\t * Users can use it to add global, non-chart related events, that will be\r\n\t * applicable to the whole document.\r\n\t */\r\n\tpublic body: InteractionObject;\r\n\r\n\t/**\r\n\t * An indicator of global events were already initialized.\r\n\t */\r\n\tprotected _globalEventsAdded: boolean = false;\r\n\r\n\t/**\r\n\t * Holds which mouse event listeners to use.\r\n\t */\r\n\tprotected _pointerEvents = {\r\n\t\t\"pointerdown\": \"mousedown\",\r\n\t\t\"pointerup\": \"mouseup\",\r\n\t\t\"pointermove\": \"mousemove\",\r\n\t\t\"pointercancel\": \"mouseup\",\r\n\t\t\"pointerover\": \"mouseover\",\r\n\t\t\"pointerout\": \"mouseout\",\r\n\t\t\"wheel\": \"wheel\"\r\n\t};\r\n\r\n\t/**\r\n\t * Indicates if Interaction should use only \"pointer\" type events, like\r\n\t * \"pointermove\", available in all modern browsers, ignoring \"legacy\"\r\n\t * events, like \"touchmove\".\r\n\t */\r\n\tprotected _usePointerEventsOnly: boolean = false;\r\n\r\n\t/**\r\n\t * Use only touch events (for touch only devices such as tablets and phones)\r\n\t */\r\n\tprotected _useTouchEventsOnly: boolean = false;\r\n\r\n\t/**\r\n\t * Add special hover events. Normally, touch device tap will also simulate\r\n\t * hover event. On some devices (ahem iOS) we want to prevent that so that\r\n\t * over/out events are not duplicated.\r\n\t */\r\n\tprotected _addHoverEvents: boolean = true;\r\n\r\n\t/**\r\n\t * Indicates if passive mode options is supported by this browser.\r\n\t */\r\n\tprotected _passiveSupported: boolean = false;\r\n\r\n\t/**\r\n\t * Holds list of delayed events\r\n\t */\r\n\tprotected _delayedEvents: { out: IDelayedEvent[] } = { out: [] };\r\n\r\n\t/**\r\n\t * List of objects that current have a pointer hovered over them.\r\n\t */\r\n\tpublic overObjects: List<InteractionObject> = new List<InteractionObject>();\r\n\r\n\t/**\r\n\t * List of objects that currently has a pressed pointer.\r\n\t */\r\n\tpublic downObjects: List<InteractionObject> = new List<InteractionObject>();\r\n\r\n\t/**\r\n\t * List of objects that need mouse position to be reported to them.\r\n\t */\r\n\tpublic trackedObjects: List<InteractionObject> = new List<InteractionObject>();\r\n\r\n\t/**\r\n\t * List of objects that are currently being dragged.\r\n\t */\r\n\tpublic transformedObjects: List<InteractionObject> = new List<InteractionObject>();\r\n\r\n\t/**\r\n\t * An object that currently has focus. Usually set automatically via\r\n\t * [[InteractionObject]] `isFocus` method.\r\n\t */\r\n\tpublic focusedObject: $type.Optional<InteractionObject>;\r\n\r\n\t/**\r\n\t * Holds all known pointers.\r\n\t */\r\n\tpublic pointers = new Dictionary<string, IPointer>();\r\n\r\n\t/**\r\n\t * Last pointer that generate some kind of action.\r\n\t *\r\n\t * @since 4.9.5\r\n\t * @ignore\r\n\t */\r\n\tpublic lastPointer: $type.Optional<IPointer>;\r\n\r\n\t/**\r\n\t * Inertia options that need to be applied to after element drag, if it's\r\n\t * `inert = true`.\r\n\t *\r\n\t * This is just a default, which can and probably will be overridden by\r\n\t * actual elements.\r\n\t */\r\n\tpublic inertiaOptions = new Dictionary<InertiaTypes, IInertiaOptions>();\r\n\r\n\t/**\r\n\t * Default options for click events. These can be overridden in\r\n\t * [[InteractionObject]].\r\n\t */\r\n\tpublic hitOptions: IHitOptions = {\r\n\t\t\"doubleHitTime\": 300,\r\n\t\t//\"delayFirstHit\": false,\r\n\t\t\"hitTolerance\": 10,\r\n\t\t\"noFocus\": true\r\n\t};\r\n\r\n\t/**\r\n\t * Default options for hover events. These can be overridden in\r\n\t * [[InteractionObject]].\r\n\t */\r\n\tpublic hoverOptions: IHoverOptions = {\r\n\t\t\"touchOutBehavior\": \"leave\",\r\n\t\t\"touchOutDelay\": 1000\r\n\t};\r\n\r\n\t/**\r\n\t * Default options for detecting a swipe gesture. These can be overridden in\r\n\t * [[InteractionObject]].\r\n\t */\r\n\tpublic swipeOptions: ISwipeOptions = {\r\n\t\t\"time\": 500,\r\n\t\t\"verticalThreshold\": 75,\r\n\t\t\"horizontalThreshold\": 30\r\n\t};\r\n\r\n\t/**\r\n\t * Default options for keyboard operations. These can be overridden in\r\n\t * [[InteractionObject]].\r\n\t */\r\n\tpublic keyboardOptions: IKeyboardOptions = {\r\n\t\t\"speed\": 0.1,\r\n\t\t\"accelleration\": 1.2,\r\n\t\t\"accellerationDelay\": 2000\r\n\t};\r\n\r\n\t/**\r\n\t * Default options for keyboard operations. These can be overridden in\r\n\t * [[InteractionObject]].\r\n\t *\r\n\t * @since 4.5.14\r\n\t */\r\n\tpublic mouseOptions: IMouseOptions = {\r\n\t\t\"sensitivity\": 1\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Constructor. Sets up universal document-wide move events to handle stuff\r\n\t * outside particular chart container.\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Call super\r\n\t\tsuper();\r\n\r\n\t\t// Set class name\r\n\t\tthis.className = \"Interaction\";\r\n\r\n\t\t// Create InteractionObject for <body>\r\n\t\tthis.body = this.getInteraction(document.body);\r\n\r\n\t\tthis._disposers.push(this.body);\r\n\r\n\t\t// Detect browser capabilities and determine what event listeners to use\r\n\t\tif (window.hasOwnProperty(\"PointerEvent\")) {\r\n\t\t\t// IE10+/Edge without touch controls enabled\r\n\t\t\tthis._pointerEvents.pointerdown = \"pointerdown\";\r\n\t\t\tthis._pointerEvents.pointerup = \"pointerup\";\r\n\t\t\tthis._pointerEvents.pointermove = \"pointermove\";\r\n\t\t\tthis._pointerEvents.pointercancel = \"pointercancel\";\r\n\t\t\tthis._pointerEvents.pointerover = \"pointerover\";\r\n\t\t\tthis._pointerEvents.pointerout = \"pointerout\";\r\n\t\t\t//this._usePointerEventsOnly = true;\r\n\t\t} else if (window.hasOwnProperty(\"MSPointerEvent\")) {\r\n\t\t\t// IE9\r\n\t\t\tthis._pointerEvents.pointerdown = \"MSPointerDown\";\r\n\t\t\tthis._pointerEvents.pointerup = \"MSPointerUp\";\r\n\t\t\tthis._pointerEvents.pointermove = \"MSPointerMove\";\r\n\t\t\tthis._pointerEvents.pointercancel = \"MSPointerUp\";\r\n\t\t\tthis._pointerEvents.pointerover = \"MSPointerOver\";\r\n\t\t\tthis._pointerEvents.pointerout = \"MSPointerOut\";\r\n\t\t\t//this._usePointerEventsOnly = true;\r\n\t\t}\r\n\t\telse if ((typeof matchMedia !== \"undefined\") && matchMedia('(pointer:fine)').matches) {\r\n\t\t\t// This is only for Safari as it does not support PointerEvent\r\n\t\t\t// Do nothing and let it use regular `mouse*` events\r\n\t\t\t// Hi Apple ;)\r\n\r\n\t\t\t// Additionally disable hover events for iOS devices\r\n\t\t\tif ('ontouchstart' in window) {\r\n\t\t\t\tthis._addHoverEvents = false;\r\n\t\t\t\tthis._useTouchEventsOnly = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (window.navigator.userAgent.match(/MSIE /)) {\r\n\t\t\t// Oh looky, an MSIE that does not support PointerEvent. Hi granpa IE9!\r\n\t\t\tthis._usePointerEventsOnly = true;\r\n\t\t}\r\n\t\telse if (this.fullFF()) {\r\n\t\t\t// Old FF, let's use regular events.\r\n\t\t\t// (Newer FFs would be detected by the PointerEvent availability check)\r\n\t\t\tthis._usePointerEventsOnly = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Uses defaults for normal browsers\r\n\t\t\t// We also assume that this must be a touch device that does not have\r\n\t\t\t// any pointer events\r\n\t\t\tthis._useTouchEventsOnly = true;\r\n\t\t}\r\n\r\n\t\t// Detect if device has a mouse\r\n\t\t// This is turning out to be not reliable\r\n\t\t// @todo remove\r\n\t\t/*if (!window.navigator.msPointerEnabled && (typeof matchMedia !== \"undefined\") && !matchMedia('(pointer:fine)').matches && !this.fullFF()) {\r\n\t\t\tthis._useTouchEventsOnly = true;\r\n\t\t}*/\r\n\r\n\t\t// Detect proper mouse wheel events\r\n\t\tif (\"onwheel\" in document.createElement(\"div\")) {\r\n\t\t\t// Modern browsers\r\n\t\t\tthis._pointerEvents.wheel = \"wheel\";\r\n\t\t}\r\n\t\telse if ($type.hasValue((<any>document).onmousewheel)) {\r\n\t\t\t// Webkit and IE support at least \"mousewheel\"\r\n\t\t\tthis._pointerEvents.wheel = \"mousewheel\";\r\n\t\t}\r\n\r\n\t\t// Set up default inertia options\r\n\t\tthis.inertiaOptions.setKey(\"move\", {\r\n\t\t\t\"time\": 100,\r\n\t\t\t\"duration\": 500,\r\n\t\t\t\"factor\": 1,\r\n\t\t\t\"easing\": $ease.polyOut3\r\n\t\t});\r\n\t\tthis.inertiaOptions.setKey(\"resize\", {\r\n\t\t\t\"time\": 100,\r\n\t\t\t\"duration\": 500,\r\n\t\t\t\"factor\": 1,\r\n\t\t\t\"easing\": $ease.polyOut3\r\n\t\t});\r\n\r\n\t\t// Set the passive mode support\r\n\t\tthis._passiveSupported = Interaction.passiveSupported;\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * This is a nasty detection for Firefox. The reason why we have is that\r\n\t * Firefox ESR version does not support matchMedia correctly.\r\n\t *\r\n\t * On iOS, Firefox uses different userAgent, so we don't have to detect iOS.\r\n\t *\r\n\t * @return Full Firefox?\r\n\t */\r\n\tprotected fullFF(): boolean {\r\n\t\treturn (window.navigator.userAgent.match(/Firefox/)) && !(window.navigator.userAgent.match(/Android/));\r\n\t}\r\n\r\n\tprotected debug(): void { }\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * Processing\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Sets up global events.\r\n\t *\r\n\t * We need this so that we can track drag movement beyond chart's container.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic addGlobalEvents(): void {\r\n\t\tif (!this._globalEventsAdded) {\r\n\r\n\t\t\tif (!this._useTouchEventsOnly) {\r\n\t\t\t\tthis._disposers.push(addEventListener<MouseEvent | PointerEvent>(\r\n\t\t\t\t\tdocument,\r\n\t\t\t\t\tthis._pointerEvents.pointerdown,\r\n\t\t\t\t\t(ev: MouseEvent) => { this.handleGlobalPointerDown(ev) }\r\n\t\t\t\t));\r\n\r\n\t\t\t\tthis._disposers.push(addEventListener<MouseEvent | PointerEvent>(\r\n\t\t\t\t\tdocument,\r\n\t\t\t\t\tthis._pointerEvents.pointermove,\r\n\t\t\t\t\t(ev: MouseEvent) => { this.handleGlobalPointerMove(ev) }\r\n\t\t\t\t));\r\n\r\n\t\t\t\tthis._disposers.push(addEventListener<MouseEvent | PointerEvent>(\r\n\t\t\t\t\tdocument,\r\n\t\t\t\t\tthis._pointerEvents.pointerup,\r\n\t\t\t\t\t(ev: MouseEvent) => { this.handleGlobalPointerUp(ev) }\r\n\t\t\t\t));\r\n\r\n\t\t\t\tthis._disposers.push(addEventListener<MouseEvent | PointerEvent>(\r\n\t\t\t\t\tdocument,\r\n\t\t\t\t\tthis._pointerEvents.pointercancel,\r\n\t\t\t\t\t(ev: MouseEvent) => { this.handleGlobalPointerUp(ev, true) }\r\n\t\t\t\t));\r\n\r\n\t\t\t\tthis._disposers.push(addEventListener<MouseEvent | PointerEvent>(\r\n\t\t\t\t\tdocument,\r\n\t\t\t\t\t\"mouseenter\",\r\n\t\t\t\t\t(ev: MouseEvent) => {\r\n\t\t\t\t\t\tif (!$type.hasValue(ev.relatedTarget) && (ev.buttons == 0 || ev.which == 0)) {\r\n\t\t\t\t\t\t\tthis.handleDocumentLeave(ev);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t));\r\n\t\t\t}\r\n\r\n\t\t\t// No need to duplicate events for hubrid systems that support both\r\n\t\t\t// pointer events and touch events. Touch events are need only for\r\n\t\t\t// some touch-only systems, like Mobile Safari.\r\n\t\t\tif (!this._usePointerEventsOnly) {\r\n\t\t\t\tthis._disposers.push(addEventListener(\r\n\t\t\t\t\tdocument,\r\n\t\t\t\t\t\"touchstart\",\r\n\t\t\t\t\t(ev: TouchEvent) => { this.handleGlobalTouchStart(ev) }\r\n\t\t\t\t));\r\n\r\n\t\t\t\tthis._disposers.push(addEventListener(\r\n\t\t\t\t\tdocument,\r\n\t\t\t\t\t\"touchmove\",\r\n\t\t\t\t\t(ev: TouchEvent) => { this.handleGlobalTouchMove(ev) }\r\n\t\t\t\t));\r\n\r\n\t\t\t\tthis._disposers.push(addEventListener(\r\n\t\t\t\t\tdocument,\r\n\t\t\t\t\t\"touchend\",\r\n\t\t\t\t\t(ev: TouchEvent) => { this.handleGlobalTouchEnd(ev) }\r\n\t\t\t\t));\r\n\t\t\t}\r\n\r\n\t\t\tthis._disposers.push(addEventListener(\r\n\t\t\t\tdocument,\r\n\t\t\t\t\"keydown\",\r\n\t\t\t\t(ev: KeyboardEvent) => { this.handleGlobalKeyDown(ev) }\r\n\t\t\t));\r\n\r\n\t\t\tthis._disposers.push(addEventListener(\r\n\t\t\t\tdocument,\r\n\t\t\t\t\"keyup\",\r\n\t\t\t\t(ev: KeyboardEvent) => { this.handleGlobalKeyUp(ev) }\r\n\t\t\t));\r\n\r\n\t\t\tthis._globalEventsAdded = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets if [[InteractionObject]] is clickable.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io [[InteractionObject]] instance\r\n\t */\r\n\tpublic processClickable(io: InteractionObject): void {\r\n\t\t// Add or remove touch events\r\n\t\tthis.processTouchable(io);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets if [[InteractionObject]] will display context menu when right-clicked.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io [[InteractionObject]] instance\r\n\t */\r\n\tpublic processContextMenu(io: InteractionObject): void {\r\n\t\tif (io.contextMenuDisabled) {\r\n\t\t\tif (!io.eventDisposers.hasKey(\"contextMenuDisabled\")) {\r\n\t\t\t\tio.eventDisposers.setKey(\"contextMenuDisabled\",\r\n\t\t\t\t\taddEventListener<MouseEvent | PointerEvent>(io.element, \"contextmenu\", (e) => {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (io.eventDisposers.hasKey(\"contextMenuDisabled\")) {\r\n\t\t\t\tio.eventDisposers.getKey(\"contextMenuDisabled\").dispose();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets if [[InteractionObject]] is hoverable.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io [[InteractionObject]] instance\r\n\t */\r\n\tpublic processHoverable(io: InteractionObject): void {\r\n\t\tif (io.hoverable || io.trackable) {\r\n\r\n\t\t\t// Add global events\r\n\t\t\tthis.addGlobalEvents();\r\n\r\n\t\t\t// Add hover styles\r\n\t\t\tthis.applyCursorOverStyle(io);\r\n\r\n\t\t\t// Add local events\r\n\t\t\tif (!io.eventDisposers.hasKey(\"hoverable\") && this._addHoverEvents) {\r\n\t\t\t\tio.eventDisposers.setKey(\"hoverable\", new MultiDisposer([\r\n\t\t\t\t\taddEventListener<MouseEvent | PointerEvent>(io.element, this._pointerEvents.pointerout, (e) => this.handlePointerOut(io, e)),\r\n\t\t\t\t\taddEventListener<MouseEvent | PointerEvent>(io.element, this._pointerEvents.pointerover, (e) => this.handlePointerOver(io, e))\r\n\t\t\t\t]));\r\n\t\t\t}\r\n\r\n\t\t\tif (io.trackable) {\r\n\t\t\t\t//sprite.addEventListener(\"touchmove\", this.handleTouchMove, false, this);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tconst disposer = io.eventDisposers.getKey(\"hoverable\");\r\n\r\n\t\t\tif (disposer != null) {\r\n\t\t\t\tdisposer.dispose();\r\n\t\t\t\tio.eventDisposers.removeKey(\"hoverable\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Add or remove touch events\r\n\t\tthis.processTouchable(io);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets up [[InteractionObject]] as movable. Movable can be any\r\n\t * transformation, e.g. drag, swipe, resize, track.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t */\r\n\tpublic processMovable(io: InteractionObject) {\r\n\r\n\t\t// Add unified events\r\n\t\tif (io.draggable || io.swipeable || io.trackable || io.resizable) {\r\n\r\n\t\t\t// Prep the element\r\n\t\t\tif (!this.isGlobalElement(io) && !io.isTouchProtected) {\r\n\t\t\t\tthis.prepElement(io);\r\n\t\t\t}\r\n\r\n\t\t\t// Add hover styles\r\n\t\t\tthis.applyCursorOverStyle(io);\r\n\r\n\t\t}\r\n\r\n\t\t// Add or remove touch events\r\n\t\tthis.processTouchable(io);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if [[InteractionObject]] is trackable and sets relative events.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t */\r\n\tpublic processTrackable(io: InteractionObject): void {\r\n\t\tthis.processHoverable(io);\r\n\t\tthis.processMovable(io);\r\n\t\tif (io.trackable) {\r\n\t\t\tthis.trackedObjects.moveValue(io);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.trackedObjects.removeValue(io);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if [[InteractionObject]] is draggable.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t */\r\n\tpublic processDraggable(io: InteractionObject): void {\r\n\t\tthis.processMovable(io);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if [[InteractionObject]] is swipeable and sets relative events.\r\n\t *\r\n\t * A swipe event is triggered when a horizontal drag of 75px or more (and\r\n\t * less than 30px vertically) occurs within 700 milliseconds. This can be\r\n\t * overridden in sprites [[swipeOptions]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t */\r\n\tpublic processSwipeable(io: InteractionObject): void {\r\n\t\tthis.processMovable(io);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if [[InteractionObject]] is resizable and attaches required events\r\n\t * to it.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t */\r\n\tpublic processResizable(io: InteractionObject): void {\r\n\t\tthis.processMovable(io);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if [[InteractionObject]] is supposed to capture mouse wheel events\r\n\t * and prepares it to catch those events.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t */\r\n\tpublic processWheelable(io: InteractionObject): void {\r\n\t\tif (io.wheelable) {\r\n\t\t\t//io.hoverable = true;\r\n\t\t\tif (!io.eventDisposers.hasKey(\"wheelable\")) {\r\n\t\t\t\tio.eventDisposers.setKey(\"wheelable\", new MultiDisposer([\r\n\t\t\t\t\taddEventListener<WheelEvent>(\r\n\t\t\t\t\t\tio.element,\r\n\t\t\t\t\t\tthis._pointerEvents.wheel,\r\n\t\t\t\t\t\t(e) => this.handleMouseWheel(io, e),\r\n\t\t\t\t\t\tthis._passiveSupported ? { passive: false } : false\r\n\t\t\t\t\t),\r\n\t\t\t\t\tio.events.on(\"out\", (e) => {\r\n\t\t\t\t\t\tif (io.wheelable) {\r\n\t\t\t\t\t\t\tthis.unlockWheel();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tio.events.on(\"over\", (e) => {\r\n\t\t\t\t\t\tif (io.wheelable) {\r\n\t\t\t\t\t\t\tthis.lockWheel();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t]));\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tconst disposer = io.eventDisposers.getKey(\"wheelable\");\r\n\r\n\t\t\tif (disposer != null) {\r\n\t\t\t\tdisposer.dispose();\r\n\t\t\t\tio.eventDisposers.removeKey(\"wheelable\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if [[InteractionObject]] is focusable. A focusable element is an\r\n\t * element that will be highlighted when users presses TAB key. If the\r\n\t * element is focusable, this function will attach relative focus/blur\r\n\t * events to it.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t */\r\n\tpublic processFocusable(io: InteractionObject): void {\r\n\t\tif (io.focusable === true && (io.tabindex > -1) && !this._useTouchEventsOnly) {\r\n\t\t\tif (!io.eventDisposers.hasKey(\"focusable\")) {\r\n\t\t\t\tio.eventDisposers.setKey(\"focusable\", new MultiDisposer([\r\n\t\t\t\t\taddEventListener<FocusEvent>(io.element, \"focus\", (e) => this.handleFocus(io, e)),\r\n\t\t\t\t\taddEventListener<FocusEvent>(io.element, \"blur\", (e) => this.handleBlur(io, e)),\r\n\t\t\t\t\taddEventListener<MouseEvent>(\r\n\t\t\t\t\t\tio.element,\r\n\t\t\t\t\t\tthis._pointerEvents.pointerdown,\r\n\t\t\t\t\t\t(e) => this.handleFocusBlur(io, e)\r\n\t\t\t\t\t),\r\n\r\n\t\t\t\t\taddEventListener<TouchEvent>(\r\n\t\t\t\t\t\tio.element,\r\n\t\t\t\t\t\t\"touchstart\",\r\n\t\t\t\t\t\t(e) => this.handleFocusBlur(io, e),\r\n\t\t\t\t\t\tthis._passiveSupported ? { passive: false } : false\r\n\t\t\t\t\t)\r\n\t\t\t\t]));\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst disposer = io.eventDisposers.getKey(\"focusable\");\r\n\r\n\t\t\tif (disposer != null) {\r\n\t\t\t\tdisposer.dispose();\r\n\t\t\t\tio.eventDisposers.removeKey(\"focusable\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if [[InteractionObject]] is \"touchable\". It means any interaction\r\n\t * whatsoever: mouse click, touch screen tap, swipe, drag, resize, etc.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t */\r\n\tpublic processTouchable(io: InteractionObject): void {\r\n\r\n\t\t// Add unified events\r\n\t\tif (io.clickable || io.hoverable || io.trackable || io.draggable || io.swipeable || io.resizable) {\r\n\r\n\t\t\t// Add global events\r\n\t\t\tthis.addGlobalEvents();\r\n\r\n\t\t\t// Add local events\r\n\t\t\tif (!io.eventDisposers.hasKey(\"touchable\")) {\r\n\t\t\t\tif (!this._useTouchEventsOnly && !this._usePointerEventsOnly) {\r\n\t\t\t\t\tio.eventDisposers.setKey(\"touchable\", new MultiDisposer([\r\n\r\n\t\t\t\t\t\taddEventListener<MouseEvent>(\r\n\t\t\t\t\t\t\tio.element,\r\n\t\t\t\t\t\t\tthis._pointerEvents.pointerdown,\r\n\t\t\t\t\t\t\t(e) => this.handlePointerDown(io, e)\r\n\t\t\t\t\t\t),\r\n\r\n\t\t\t\t\t\taddEventListener<TouchEvent>(\r\n\t\t\t\t\t\t\tio.element,\r\n\t\t\t\t\t\t\t\"touchstart\",\r\n\t\t\t\t\t\t\t(e) => this.handleTouchDown(io, e),\r\n\t\t\t\t\t\t\tthis._passiveSupported ? { passive: false } : false\r\n\t\t\t\t\t\t)\r\n\r\n\t\t\t\t\t]));\r\n\t\t\t\t}\r\n\t\t\t\telse if (!this._useTouchEventsOnly) {\r\n\t\t\t\t\tio.eventDisposers.setKey(\"touchable\",\r\n\t\t\t\t\t\taddEventListener<MouseEvent>(\r\n\t\t\t\t\t\t\tio.element,\r\n\t\t\t\t\t\t\tthis._pointerEvents.pointerdown,\r\n\t\t\t\t\t\t\t(e) => this.handlePointerDown(io, e)\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\telse if (!this._usePointerEventsOnly) {\r\n\t\t\t\t\tio.eventDisposers.setKey(\"touchable\",\r\n\t\t\t\t\t\taddEventListener<TouchEvent>(\r\n\t\t\t\t\t\t\tio.element,\r\n\t\t\t\t\t\t\t\"touchstart\",\r\n\t\t\t\t\t\t\t(e) => this.handleTouchDown(io, e),\r\n\t\t\t\t\t\t\tthis._passiveSupported ? { passive: false } : false\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tconst disposer = io.eventDisposers.getKey(\"touchable\");\r\n\r\n\t\t\tif (disposer != null) {\r\n\t\t\t\tdisposer.dispose();\r\n\t\t\t\tio.eventDisposers.removeKey(\"touchable\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * Non-pointer events\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Dispatches \"focus\" event when element gains focus.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t * @param ev  Original event\r\n\t */\r\n\tpublic handleFocus(io: InteractionObject, ev: FocusEvent): void {\r\n\t\tif (!io.focusable) {\r\n\t\t\tev.preventDefault();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tio.isFocused = true;\r\n\t\tif (io.events.isEnabled(\"focus\") && !system.isPaused) {\r\n\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"focus\"] = {\r\n\t\t\t\ttype: \"focus\",\r\n\t\t\t\ttarget: io,\r\n\t\t\t\tevent: ev\r\n\t\t\t};\r\n\t\t\tio.events.dispatchImmediately(\"focus\", imev);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Used by regular click events to prevent focus if \"noFocus\" is set.\r\n\t *\r\n\t * This should not be called by \"focus\" handlers.\r\n\t *\r\n\t * @param io  Element\r\n\t * @param ev  Original event\r\n\t */\r\n\tprivate handleFocusBlur(io: InteractionObject, ev: MouseEvent | TouchEvent): void {\r\n\t\tif (io.focusable !== false && this.getHitOption(io, \"noFocus\")) {\r\n\t\t\tio.events.once(\"focus\", () => {\r\n\t\t\t\tio.events.disableType(\"blur\");\r\n\t\t\t\t$dom.blur();\r\n\t\t\t\tif (io.sprite) {\r\n\t\t\t\t\tio.sprite.handleBlur();\r\n\t\t\t\t}\r\n\t\t\t\tio.events.enableType(\"blur\");\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Dispatches \"blur\" event when element loses focus.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t * @param ev  Original event\r\n\t */\r\n\tpublic handleBlur(io: InteractionObject, ev: FocusEvent): void {\r\n\t\tif (!io.focusable) {\r\n\t\t\tev.preventDefault();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tio.isFocused = false;\r\n\t\tif (io.events.isEnabled(\"blur\") && !system.isPaused) {\r\n\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"blur\"] = {\r\n\t\t\t\ttype: \"blur\",\r\n\t\t\t\ttarget: io,\r\n\t\t\t\tevent: ev\r\n\t\t\t};\r\n\t\t\tio.events.dispatchImmediately(\"blur\", imev);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * Global keyboard-related even handlers\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Checks if there is an item that has currently focus and that they key is\r\n\t * one of the directional keys. If both of the conditions are true, it\r\n\t * creates an object to simulate movement of dragable element with keyboard.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev An original keyboard event\r\n\t */\r\n\tpublic handleGlobalKeyDown(ev: KeyboardEvent): void {\r\n\r\n\t\tif (this.focusedObject) {\r\n\t\t\tif (keyboard.isKey(ev, \"esc\")) {\r\n\t\t\t\t// ESC removes focus\r\n\t\t\t\t$dom.blur();\r\n\t\t\t}\r\n\t\t\telse if (this.focusedObject.draggable && keyboard.isKey(ev, [\"up\", \"down\", \"left\", \"right\"])) {\r\n\r\n\t\t\t\t// Prevent scrolling of the document\r\n\t\t\t\tev.preventDefault();\r\n\r\n\t\t\t\t// Get focused object\r\n\t\t\t\tlet io = this.focusedObject;\r\n\r\n\t\t\t\t// Get particular key\r\n\t\t\t\tlet disposerKey = \"interactionKeyboardObject\";\r\n\r\n\t\t\t\t// If such disposer already exists we know the event is going on so we\r\n\t\t\t\t// just move on\r\n\t\t\t\tif (io.eventDisposers.hasKey(disposerKey)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Create a keyboard mover\r\n\t\t\t\tlet ko = new InteractionKeyboardObject(io, ev);\r\n\t\t\t\tio.eventDisposers.setKey(disposerKey, ko);\r\n\t\t\t\tswitch (keyboard.getEventKey(ev)) {\r\n\t\t\t\t\tcase \"up\":\r\n\t\t\t\t\t\tko.directionY = -1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"down\":\r\n\t\t\t\t\t\tko.directionY = 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"left\":\r\n\t\t\t\t\t\tko.directionX = -1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"right\":\r\n\t\t\t\t\t\tko.directionX = 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Dispatches related events when the keyboard key is realeasd.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev An original keyboard event\r\n\t */\r\n\tpublic handleGlobalKeyUp(ev: KeyboardEvent): void {\r\n\t\tlet disposerKey = \"interactionKeyboardObject\";\r\n\t\tif (this.focusedObject) {\r\n\t\t\tconst disposer = this.focusedObject.eventDisposers.getKey(disposerKey);\r\n\r\n\t\t\tif (disposer != null) {\r\n\t\t\t\t// Prevent scrolling of the document\r\n\t\t\t\tev.preventDefault();\r\n\r\n\t\t\t\t// Dispose stuff\r\n\t\t\t\tdisposer.dispose();\r\n\t\t\t\tthis.focusedObject.eventDisposers.removeKey(disposerKey);\r\n\t\t\t}\r\n\r\n\t\t\t// Does focused object have \"hit\" event?\r\n\t\t\tif (keyboard.isKey(ev, \"enter\")\r\n\t\t\t\t&& this.focusedObject.sprite\r\n\t\t\t\t&& !this.focusedObject.sprite.events.isEnabled(\"toggled\")\r\n\t\t\t) {\r\n\t\t\t\tif (this.focusedObject.sprite.events.isEnabled(\"hit\")) {\r\n\t\t\t\t\tthis.focusedObject.dispatchImmediately(\"hit\");\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.focusedObject.sprite.showTooltipOn == \"hit\") {\r\n\t\t\t\t\tthis.focusedObject.dispatchImmediately(\"up\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * Global pointer-related even handlers\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Handler for a global \"pointermove\" event.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Event object\r\n\t */\r\n\tpublic handleGlobalPointerMove(ev: MouseEvent): void {\r\n\t\t// Get pointer\r\n\t\tlet pointer: IPointer = this.getPointer(ev);\r\n\r\n\t\t// Update current point position\r\n\t\tpointer.point = this.getPointerPoint(ev);\r\n\r\n\t\t// Prepare and fire global event\r\n\t\tif (this.events.isEnabled(\"track\") && !system.isPaused) {\r\n\t\t\tlet imev: AMEvent<this, IInteractionEvents>[\"track\"] = {\r\n\t\t\t\ttype: \"track\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tevent: ev,\r\n\t\t\t\tpointer: pointer,\r\n\t\t\t\ttouch: pointer.touch\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"track\", imev);\r\n\t\t}\r\n\r\n\t\t// Track\r\n\t\tthis.addBreadCrumb(pointer, pointer.point);\r\n\r\n\t\t// Process further\r\n\t\tthis.handleGlobalMove(pointer, ev);\r\n\t}\r\n\r\n\t/**\r\n\t * Handler for a global \"pointerdown\" event.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Event object\r\n\t */\r\n\tpublic handleGlobalPointerDown(ev: MouseEvent): void {\r\n\r\n\t\t// Remove delayed hovers\r\n\t\tthis.processDelayed();\r\n\r\n\t\t// Get pointer\r\n\t\tlet pointer: IPointer = this.getPointer(ev);\r\n\r\n\t\t// Prepare and fire global event\r\n\t\tif (this.events.isEnabled(\"down\") && !system.isPaused) {\r\n\t\t\tlet imev: AMEvent<this, IInteractionEvents>[\"down\"] = {\r\n\t\t\t\ttype: \"down\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tevent: ev,\r\n\t\t\t\tpointer: pointer,\r\n\t\t\t\ttouch: pointer.touch\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"down\", imev);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Prevents touch action from firing.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Event\r\n\t */\r\n\tpublic preventTouchAction(ev: TouchEvent): void {\r\n\t\tif (!ev.defaultPrevented) {\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handler for a global \"pointerup\" event.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Event object\r\n\t */\r\n\tpublic handleGlobalPointerUp(ev: MouseEvent, cancelled: boolean = false): void {\r\n\r\n\t\t// Get pointer\r\n\t\tlet pointer: IPointer = this.getPointer(ev);\r\n\r\n\t\t// Prepare and fire global event\r\n\t\tif (this.events.isEnabled(\"up\") && !system.isPaused) {\r\n\t\t\tlet imev: AMEvent<this, IInteractionEvents>[\"up\"] = {\r\n\t\t\t\ttype: \"up\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tevent: ev,\r\n\t\t\t\tpointer: pointer,\r\n\t\t\t\ttouch: pointer.touch\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"up\", imev);\r\n\t\t}\r\n\r\n\t\t// Process further\r\n\t\tthis.handleGlobalUp(pointer, ev, cancelled);\r\n\r\n\t}\r\n\r\n\t/**\r\n * ==========================================================================\r\n * Global touch-related even handlers\r\n * ==========================================================================\r\n */\r\n\r\n\t/**\r\n\t * Handler for a global \"touchmove\" event.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Event object\r\n\t */\r\n\tpublic handleGlobalTouchMove(ev: TouchEvent): void {\r\n\r\n\t\t// Process each changed touch point\r\n\t\tfor (let i = 0; i < ev.changedTouches.length; i++) {\r\n\t\t\t// Get pointer\r\n\t\t\tlet pointer: IPointer = this.getPointer(ev.changedTouches[i]);\r\n\r\n\t\t\t// Update current point position\r\n\t\t\tpointer.point = this.getPointerPoint(ev.changedTouches[i]);\r\n\r\n\t\t\t// Prepare and fire global event\r\n\t\t\tif (this.events.isEnabled(\"track\") && !system.isPaused) {\r\n\t\t\t\tlet imev: AMEvent<this, IInteractionEvents>[\"track\"] = {\r\n\t\t\t\t\ttype: \"track\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\tpointer: pointer,\r\n\t\t\t\t\ttouch: pointer.touch\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"track\", imev);\r\n\t\t\t}\r\n\r\n\t\t\t// Track\r\n\t\t\tthis.addBreadCrumb(pointer, pointer.point);\r\n\r\n\t\t\t// Process further\r\n\t\t\tthis.handleGlobalMove(pointer, ev);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Handler for a global \"touchstart\" event.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Event object\r\n\t */\r\n\tpublic handleGlobalTouchStart(ev: TouchEvent): void {\r\n\r\n\t\t// Remove delayed hovers\r\n\t\tthis.processDelayed();\r\n\r\n\t\t// Process each changed touch point\r\n\t\tfor (let i = 0; i < ev.changedTouches.length; i++) {\r\n\r\n\t\t\t// Get pointer\r\n\t\t\tlet pointer: IPointer = this.getPointer(ev.changedTouches[i]);\r\n\r\n\t\t\t// Prepare and fire global event\r\n\t\t\tif (!this._usePointerEventsOnly && this.events.isEnabled(\"down\") && !system.isPaused) {\r\n\t\t\t\tlet imev: AMEvent<this, IInteractionEvents>[\"down\"] = {\r\n\t\t\t\t\ttype: \"down\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\tpointer: pointer,\r\n\t\t\t\t\ttouch: pointer.touch\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"down\", imev);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Handler for a global \"touchend\" event.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev Event object\r\n\t */\r\n\tpublic handleGlobalTouchEnd(ev: TouchEvent): void {\r\n\r\n\t\t// Process each changed touch point\r\n\t\tfor (let i = 0; i < ev.changedTouches.length; i++) {\r\n\r\n\t\t\t// Get pointer\r\n\t\t\tlet pointer: IPointer = this.getPointer(ev.changedTouches[i]);\r\n\r\n\t\t\t// Prepare and fire global event\r\n\t\t\tif (this.events.isEnabled(\"up\") && !system.isPaused) {\r\n\t\t\t\tlet imev: AMEvent<this, IInteractionEvents>[\"up\"] = {\r\n\t\t\t\t\ttype: \"up\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\tpointer: pointer,\r\n\t\t\t\t\ttouch: pointer.touch\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"up\", imev);\r\n\t\t\t}\r\n\r\n\t\t\t// Handle element-related events\r\n\t\t\tthis.handleGlobalUp(pointer, ev);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * Element-specific pointer-related even handlers\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Handles event when pointer is over [[InteractionObject]] and button is\r\n\t * pressed.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t * @param ev  Original event\r\n\t */\r\n\tpublic handlePointerDown(io: InteractionObject, ev: MouseEvent | PointerEvent): void {\r\n\r\n\t\t// Stop further propagation so we don't get multiple triggers on hybrid\r\n\t\t// devices (both mouse and touch capabilities)\r\n\t\t//ev.preventDefault();\r\n\t\t//ev.stopPropagation();\r\n\t\t//if (ev.defaultPrevented) {\r\n\t\t//}\r\n\r\n\t\t// Get pointer\r\n\t\tlet pointer = this.getPointer(ev);\r\n\r\n\t\t// Ignore if it's anything but mouse's primary button\r\n\t\tif (!pointer.touch && ev.which != 1 && ev.which != 3) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Set mouse button\r\n\t\tpointer.button = ev.which;\r\n\r\n\t\t// Reset pointer\r\n\t\tthis.resetPointer(pointer, ev);\r\n\r\n\t\t// Process down\r\n\t\tthis.handleDown(io, pointer, ev);\r\n\t}\r\n\r\n\t/**\r\n\t * Handles event when [[InteractionObject]] is hovered by a mouse pointer.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t * @param ev  Original event\r\n\t */\r\n\tpublic handlePointerOver(io: InteractionObject, ev: MouseEvent | PointerEvent): void {\r\n\t\t// Get pointer\r\n\t\tlet pointer = this.getPointer(ev);\r\n\r\n\t\t// Process down\r\n\t\tthis.handleOver(io, pointer, ev);\r\n\t}\r\n\r\n\t/**\r\n\t * Handles event when [[InteractionObject]] loses hover from a mouse pointer.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t * @param ev  Original event\r\n\t */\r\n\tpublic handlePointerOut(io: InteractionObject, ev: MouseEvent | PointerEvent): void {\r\n\r\n\t\t// Get pointer\r\n\t\tlet pointer = this.getPointer(ev);\r\n\r\n\t\t// Process down\r\n\t\tthis.handleOut(io, pointer, ev);\r\n\t}\r\n\r\n\t/**\r\n\t * Handles event when mouse wheel is crolled over the [[InteractionObject]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t * @param ev  Original event\r\n\t * @todo Investigate more-cross browser stuff https://developer.mozilla.org/en-US/docs/Web/Events/wheel\r\n\t */\r\n\tpublic handleMouseWheel(io: InteractionObject, ev: WheelEvent): void {\r\n\r\n\t\t// Get pointer\r\n\t\tlet pointer = this.getPointer(ev);\r\n\r\n\t\t// Update current point position\r\n\t\tpointer.point = this.getPointerPoint(ev);\r\n\r\n\t\t// Init delta values\r\n\t\tlet deltaX: number = 0, deltaY: number = 0;\r\n\r\n\t\t// Set up modifier\r\n\t\t// This is needed because FireFox reports wheel deltas in \"lines\" instead\r\n\t\t// of pixels so we have to approximate pixel value\r\n\t\tlet mod = 1;\r\n\t\tif (ev.deltaMode == 1) {\r\n\t\t\tmod = 50;\r\n\t\t}\r\n\r\n\t\t// Adjust configurable sensitivity\r\n\t\tmod *= this.getMouseOption(io, \"sensitivity\");\r\n\r\n\t\t// Calculate deltas\r\n\t\tif (ev instanceof WheelEvent) {\r\n\t\t\tdeltaX = Math.round((-1 * (<any>ev).wheelDeltaX) || ev.deltaX) * mod;\r\n\t\t\tdeltaY = Math.round((-1 * (<any>ev).wheelDeltaY) || ev.deltaY) * mod;\r\n\t\t} else {\r\n\t\t\tthrow new Error(\"Invalid event type\");\r\n\t\t}\r\n\r\n\t\t// Handle the event\r\n\t\tthis.handleWheel(io, pointer, deltaX, deltaY, ev);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * Element-specific touch-related even handlers\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t  * Handles an event when an [[InteractionObject]] is touched on a touch\r\n\t  * device.\r\n\t  *\r\n\t  * @ignore Exclude from docs\r\n\t  * @param io  Element\r\n\t  * @param ev  Original event\r\n\t  */\r\n\tpublic handleTouchDown(io: InteractionObject, ev: TouchEvent): void {\r\n\r\n\t\t// Stop further propagation so we don't get multiple triggers on hybrid\r\n\t\t// devices (both mouse and touch capabilities)\r\n\t\t//this.maybePreventDefault(io, ev);\r\n\t\t//return;\r\n\r\n\t\t// Process each changed touch point\r\n\t\tfor (let i = 0; i < ev.changedTouches.length; i++) {\r\n\r\n\t\t\t// Get pointer\r\n\t\t\tlet pointer = this.getPointer(ev.changedTouches[i]);\r\n\t\t\tthis.maybePreventDefault(io, ev, pointer);\r\n\r\n\t\t\t// Reset pointer\r\n\t\t\tthis.resetPointer(pointer, ev.changedTouches[i]);\r\n\r\n\t\t\t// Process down\r\n\t\t\tthis.handleDown(io, pointer, ev);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * Universal handlers\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Handles click/tap. Checks for doublehit.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Interaction object\r\n\t * @param pointer  Pointer\r\n\t * @param ev       Original event\r\n\t */\r\n\tpublic handleHit(io: InteractionObject, pointer: IPointer, ev: MouseEvent | TouchEvent): void {\r\n\r\n\t\t// Check if this is a double-hit\r\n\t\tlet now = $time.getTime();\r\n\t\tif (io.lastHit && (io.lastHit >= (now - this.getHitOption(io, \"doubleHitTime\")))) {\r\n\r\n\t\t\t// Yup - it's a double-hit\r\n\r\n\t\t\t// Cancel the hit\r\n\t\t\t//clearTimeout(io.lastHitPointer.hitTimeout);\r\n\r\n\t\t\t// If it happened too fast it probably means that hybrid device just\r\n\t\t\t// generated two events for the same tap\r\n\t\t\tif ((now - io.lastHit) < 100) {\r\n\t\t\t\t// Ignore\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Clear last hit\r\n\t\t\tio.lastHit = undefined;\r\n\t\t\tio.lastHitPointer = undefined;\r\n\r\n\t\t\t// Dispatch event\r\n\t\t\tif (io.events.isEnabled(\"doublehit\") && !system.isPaused) {\r\n\t\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"doublehit\"] = {\r\n\t\t\t\t\ttype: \"doublehit\",\r\n\t\t\t\t\ttarget: io,\r\n\t\t\t\t\tpoint: pointer.point,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\ttouch: pointer.touch\r\n\t\t\t\t};\r\n\t\t\t\tio.events.dispatchImmediately(\"doublehit\", imev);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\t// Log last hit\r\n\t\t\tio.lastHit = now;\r\n\t\t\tio.lastHitPointer = pointer;\r\n\r\n\t\t\tif (pointer.button === 3) {\r\n\t\t\t\t// Execute HIT now\r\n\t\t\t\tif (io.events.isEnabled(\"rightclick\") && !system.isPaused) {\r\n\t\t\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"rightclick\"] = {\r\n\t\t\t\t\t\ttype: \"rightclick\",\r\n\t\t\t\t\t\ttarget: io,\r\n\t\t\t\t\t\tevent: ev\r\n\t\t\t\t\t}\r\n\t\t\t\t\tio.events.dispatchImmediately(\"rightclick\", imev);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (io.events.isEnabled(\"hit\") && !system.isPaused) {\r\n\t\t\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"hit\"] = {\r\n\t\t\t\t\t\ttype: \"hit\",\r\n\t\t\t\t\t\ttarget: io,\r\n\t\t\t\t\t\tevent: ev,\r\n\t\t\t\t\t\tpoint: pointer.point,\r\n\t\t\t\t\t\ttouch: pointer.touch\r\n\t\t\t\t\t};\r\n\t\t\t\t\tio.events.dispatchImmediately(\"hit\", imev);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Handles pointer hovering over [[InteractionObject]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Interaction object\r\n\t * @param pointer  Pointer\r\n\t * @param ev       Original event\r\n\t * @param soft     Invoked by helper function\r\n\t */\r\n\tpublic handleOver(io: InteractionObject, pointer: IPointer, ev: MouseEvent | TouchEvent, soft: boolean = false): void {\r\n\r\n\t\tif (!io.hoverable) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet hoversPaused = false;\r\n\t\tif (this.shouldCancelHovers(pointer) && this.areTransformed() && this.moved(pointer, this.getHitOption(io, \"hitTolerance\"))) {\r\n\t\t\thoversPaused = true;\r\n\t\t\tthis.cancelAllHovers(ev);\r\n\t\t}\r\n\r\n\t\t// Remove any delayed outs\r\n\t\tthis.processDelayed();\r\n\r\n\t\t// Add pointer\r\n\t\tio.overPointers.moveValue(pointer);\r\n\r\n\t\t// Check if object is not yet hovered\r\n\t\tif (!io.isRealHover) {\r\n\r\n\t\t\t// Set element as hovered\r\n\t\t\tif (!hoversPaused) {\r\n\t\t\t\tio.isHover = true;\r\n\t\t\t\tio.isRealHover = true;\r\n\t\t\t\tthis.overObjects.moveValue(io);\r\n\t\t\t}\r\n\r\n\t\t\t// Generate body track event. This is needed so that if element loads\r\n\t\t\t// under unmoved mouse cursor, we still need all the actions that are\r\n\t\t\t// required to happen to kick in.\r\n\t\t\tthis.handleTrack(this.body, pointer, ev, true);\r\n\r\n\t\t\t// Event\r\n\t\t\tif (io.events.isEnabled(\"over\") && !system.isPaused && !hoversPaused) {\r\n\t\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"over\"] = {\r\n\t\t\t\t\ttype: \"over\",\r\n\t\t\t\t\ttarget: io,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\tpointer: pointer,\r\n\t\t\t\t\ttouch: pointer.touch\r\n\t\t\t\t};\r\n\t\t\t\tio.events.dispatchImmediately(\"over\", imev);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Handles when [[InteractionObject]] is no longer hovered.\r\n\t *\r\n\t * If `soft = true`, this means that method is being invoked by some other\r\n\t * code, not hard \"out\" function, like `handleUp` which implies we need to\r\n\t * run additional checks before unhovering the object.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Interaction object\r\n\t * @param pointer  Pointer\r\n\t * @param ev       Original event\r\n\t * @param soft     Invoked by helper function\r\n\t * @param force    Force imediate out\r\n\t */\r\n\tpublic handleOut(io: InteractionObject, pointer: IPointer, ev: MouseEvent | TouchEvent, soft: boolean = false, force: boolean = false): void {\r\n\r\n\t\tif (!io.hoverable) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Remove pointer\r\n\t\tio.overPointers.removeValue(pointer);\r\n\r\n\t\t// Check if element is still hovered\r\n\t\tif (io.isHover && (!io.hasDelayedOut || force)) {\r\n\r\n\r\n\t\t\t// Should we run additional checks?\r\n\t\t\tif (soft && io.overPointers.length) {\r\n\t\t\t\t// There are still pointers hovering - don't do anything else and\r\n\t\t\t\t// wait until either no over pointers are there or we get a hard out\r\n\t\t\t\t// event.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Should we delay \"out\" if this is happening on a touch device?\r\n\t\t\tif (pointer.touch && !force && !this.old(pointer)) {\r\n\r\n\t\t\t\t// This is a touch pointer, and it hasn't moved, let's pretend\r\n\t\t\t\t// the object is still hovered, and act as per \"behavior\" setting\r\n\t\t\t\tlet behavior = this.getHoverOption(io, \"touchOutBehavior\");\r\n\t\t\t\tif (behavior == \"leave\") {\r\n\t\t\t\t\t// Set to \"leave\", so we do not execute any \"out\" event.\r\n\t\t\t\t\t// It will be handled by any other interaction that happens\r\n\t\t\t\t\t// afterwards.\r\n\t\t\t\t\tthis._delayedEvents.out.push({\r\n\t\t\t\t\t\ttype: \"out\",\r\n\t\t\t\t\t\tio: io,\r\n\t\t\t\t\t\tpointer: pointer,\r\n\t\t\t\t\t\tevent: ev,\r\n\t\t\t\t\t\tkeepUntil: $time.getTime() + 500\r\n\t\t\t\t\t});\r\n\t\t\t\t\tio.hasDelayedOut = true;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\telse if (behavior == \"delay\" && this.getHoverOption(io, \"touchOutDelay\")) {\r\n\t\t\t\t\tthis._delayedEvents.out.push({\r\n\t\t\t\t\t\ttype: \"out\",\r\n\t\t\t\t\t\tio: io,\r\n\t\t\t\t\t\tpointer: pointer,\r\n\t\t\t\t\t\tevent: ev,\r\n\t\t\t\t\t\tkeepUntil: $time.getTime() + 500,\r\n\t\t\t\t\t\ttimeout: this.setTimeout(() => {\r\n\t\t\t\t\t\t\tthis.handleOut(io, pointer, ev, true);\r\n\t\t\t\t\t\t}, this.getHoverOption(io, \"touchOutDelay\"))\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Nothing for \"remove\" - that's how it works \"out-of-the-box\"\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Set element as not hovered\r\n\t\t\tio.isHover = false;\r\n\t\t\tthis.overObjects.removeValue(io);\r\n\r\n\t\t\t// Invoke event\r\n\t\t\tif (!io.isDisposed() && io.events.isEnabled(\"out\") && !system.isPaused) {\r\n\t\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"out\"] = {\r\n\t\t\t\t\ttype: \"out\",\r\n\t\t\t\t\ttarget: io,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\tpointer: pointer,\r\n\t\t\t\t\ttouch: pointer.touch\r\n\t\t\t\t};\r\n\t\t\t\tio.events.dispatchImmediately(\"out\", imev);\r\n\t\t\t}\r\n\r\n\t\t\t// Reset object from lefover delayed outs, pointers\r\n\t\t\tio.overPointers.clear();\r\n\t\t\tio.hasDelayedOut = false;\r\n\t\t\t// @todo (clean delayed)\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Processes dalyed events, such as \"out\" event that was initiated for\r\n\t * elements by touch.\r\n\t */\r\n\tprivate processDelayed(): void {\r\n\t\tlet delayedEvent;\r\n\r\n\t\twhile (true) {\r\n\t\t\tdelayedEvent = this._delayedEvents.out.pop();\r\n\r\n\t\t\tif (!delayedEvent) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (delayedEvent.timeout) {\r\n\t\t\t\tdelayedEvent.timeout.dispose();\r\n\t\t\t}\r\n\r\n\t\t\tthis.handleOut(delayedEvent.io, delayedEvent.pointer, delayedEvent.event, false, true);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Performs tasks on pointer down.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t * @param ev       Original event\r\n\t */\r\n\tpublic handleDown(io: InteractionObject, pointer: IPointer, ev: MouseEvent | TouchEvent | undefined): void {\r\n\r\n\t\t// Need to prevent default event from happening on transformable objects\r\n\t\tthis.maybePreventDefault(io, ev, pointer);\r\n\r\n\t\t// Stop inertia animations if they're currently being played out\r\n\t\tif (io.inert) {\r\n\t\t\tthis.stopInertia(io);\r\n\t\t}\r\n\r\n\t\t// Trigger hover because some touch devices won't trigger over events\r\n\t\t// on their own\r\n\t\tthis.handleOver(io, pointer, ev, true);\r\n\r\n\t\t// Add pointer to list\r\n\t\tio.downPointers.moveValue(pointer);\r\n\r\n\t\t// Apply styles if necessary\r\n\t\tthis.applyCursorDownStyle(io, pointer);\r\n\r\n\t\t// Check if object is already down\r\n\t\tif (!io.isDown) {\r\n\r\n\t\t\t// Lose focus if needed\r\n\t\t\tif (io.focusable !== false && this.getHitOption(io, \"noFocus\") && this.focusedObject) {\r\n\t\t\t\t$dom.blur();\r\n\t\t\t}\r\n\r\n\t\t\t// Set object as hovered\r\n\t\t\tio.isDown = true;\r\n\t\t\tthis.downObjects.moveValue(io);\r\n\r\n\t\t\t// Prep object for dragging and/or resizing\r\n\t\t\tif (io.draggable) {\r\n\t\t\t\tthis.processDragStart(io, pointer, ev);\r\n\t\t\t}\r\n\t\t\tif (io.resizable) {\r\n\t\t\t\tthis.processResizeStart(io, pointer, ev);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Dispatch \"down\" event\r\n\t\tif (io.events.isEnabled(\"down\") && !system.isPaused) {\r\n\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"down\"] = {\r\n\t\t\t\ttype: \"down\",\r\n\t\t\t\ttarget: io,\r\n\t\t\t\tevent: ev,\r\n\t\t\t\tpointer: pointer,\r\n\t\t\t\ttouch: pointer.touch\r\n\t\t\t};\r\n\t\t\tio.events.dispatchImmediately(\"down\", imev);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Performs tasks on pointer up.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param pointer  Pointer\r\n\t * @param ev       Original event\r\n\t */\r\n\tpublic handleGlobalUp(pointer: IPointer, ev: MouseEvent | TouchEvent | undefined, cancelled: boolean = false): void {\r\n\t\tconst sorted = this.downObjects.values.slice();\r\n\r\n\t\tsorted.sort((x, y) => {\r\n\t\t\tif (x && y) {\r\n\t\t\t\tconst pos = x.element.compareDocumentPosition(y.element);\r\n\r\n\t\t\t\tif (pos & Node.DOCUMENT_POSITION_CONTAINED_BY) {\r\n\t\t\t\t\treturn 1;\r\n\r\n\t\t\t\t} else if (pos & Node.DOCUMENT_POSITION_CONTAINS) {\r\n\t\t\t\t\treturn -1;\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Process all down objects\r\n\t\t$array.each(sorted, (io) => {\r\n\t\t\t// Check if this particular pointer is pressing down\r\n\t\t\t// on object\r\n\t\t\tif (io && io.downPointers.contains(pointer)) {\r\n\t\t\t\tthis.handleUp(io, pointer, ev, cancelled);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Simulates all pointers being up once mouse leaves document area.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev       Original event\r\n\t */\r\n\tpublic handleDocumentLeave(ev: MouseEvent): void {\r\n\r\n\t\t// Process all down objects\r\n\t\t$iter.each(this.downObjects.backwards().iterator(), (io) => {\r\n\t\t\tio.downPointers.each((pointer) => {\r\n\t\t\t\tthis.handleUp(io, pointer, ev);\r\n\t\t\t})\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Handles when [[InteractionObject]] is no longer hovered.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Interaction object\r\n\t * @param pointer  Pointer\r\n\t * @param ev       Original event\r\n\t */\r\n\tpublic handleUp(io: InteractionObject, pointer: IPointer, ev: MouseEvent | TouchEvent, cancelled: boolean = false): void {\r\n\r\n\t\t// Restore cursor style\r\n\t\tthis.restoreCursorDownStyle(io, pointer);\r\n\r\n\t\t// Remove pointer from the list\r\n\t\tio.downPointers.removeValue(pointer);\r\n\r\n\t\t// Trigger out because some touch devices won't trigger out events\r\n\t\t// on their own\r\n\t\tif (pointer.touch || this._useTouchEventsOnly) {\r\n\t\t\tthis.handleOut(io, pointer, ev, true);\r\n\t\t}\r\n\r\n\t\t// Check if object still down\r\n\t\tif (io.isDown) {\r\n\r\n\t\t\t// Check if there are no other pointers hovering this element\r\n\t\t\tif (io.downPointers.length == 0) {\r\n\t\t\t\t// Set element as no longer down\r\n\t\t\t\tio.isDown = false;\r\n\t\t\t\tthis.downObjects.removeValue(io);\r\n\t\t\t}\r\n\r\n\t\t\t// Dispatch \"up\" event\r\n\t\t\tif (io.events.isEnabled(\"up\") && !system.isPaused) {\r\n\t\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"up\"] = {\r\n\t\t\t\t\ttype: \"up\",\r\n\t\t\t\t\ttarget: io,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\tpointer: pointer,\r\n\t\t\t\t\ttouch: pointer.touch\r\n\t\t\t\t};\r\n\t\t\t\tio.events.dispatchImmediately(\"up\", imev);\r\n\t\t\t}\r\n\r\n\t\t\t// Check if this was not a cancelled event.\r\n\t\t\t// If event was canelled (which might happen if gesture resulted in\r\n\t\t\t// navigation or page scroll) there's no point in triggering hit and\r\n\t\t\t// other actions.\r\n\t\t\tif (!cancelled) {\r\n\r\n\t\t\t\t// Handle swiping-related stuff\r\n\t\t\t\tif (io.swipeable && this.swiped(io, pointer)) {\r\n\t\t\t\t\t// Swiped - nothing else should happen\r\n\t\t\t\t\tthis.handleSwipe(io, pointer, ev);\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t// Check if it maybe a click\r\n\t\t\t\t\tif (io.clickable && !this.moved(pointer, this.getHitOption(io, \"hitTolerance\"))) {\r\n\t\t\t\t\t\tthis.handleHit(io, pointer, ev);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Handle inertia\r\n\t\t\t\t\tif (io.inert && this.moved(pointer, this.getHitOption(io, \"hitTolerance\"))) {\r\n\t\t\t\t\t\tthis.handleInertia(io, pointer);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (io.draggable) {\r\n\t\t\t\t\t\tthis.processDragStop(io, pointer, ev);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (io.resizable) {\r\n\t\t\t\t\t\tthis.processResizeStop(io, pointer, ev);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if event needs to be prevented on draggable and such items, so that\r\n\t * touch gestures like navigation and scroll do not kick in.\r\n\t *\r\n\t * @param io  Object\r\n\t * @param ev  Event\r\n\t */\r\n\tprivate maybePreventDefault(io: InteractionObject, ev: MouseEvent | TouchEvent | undefined, pointer?: IPointer): void {\r\n\t\tif (\r\n\t\t\t$type.hasValue(ev)\r\n\t\t\t&& (io.draggable || io.swipeable || io.trackable || io.resizable)\r\n\t\t\t&& !this.isGlobalElement(io)\r\n\t\t\t&& ev.cancelable !== false\r\n\t\t\t&& (!io.isTouchProtected || !pointer || !pointer.touch)\r\n\t\t) {\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Cancels all hovers on all currently hovered objects.\r\n\t *\r\n\t * @param  pointer  Pointer\r\n\t * @param  ev       Event\r\n\t */\r\n\tprivate cancelAllHovers(ev?: MouseEvent | TouchEvent): void {\r\n\t\t//this.overObjects.each((io) => {\r\n\t\t$iter.each(this.overObjects.backwards().iterator(), (io) => {\r\n\t\t\tif (io) {\r\n\t\t\t\tconst pointer = io.overPointers.getIndex(0);\r\n\t\t\t\tthis.handleOut(io, pointer, ev, true, true);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if hovers should be cancelled on transform as per global options.\r\n\t * @param   pointer  Pointer\r\n\t * @return           Cancel?\r\n\t */\r\n\tprivate shouldCancelHovers(pointer: IPointer): boolean {\r\n\t\treturn options.disableHoverOnTransform == \"always\" || (options.disableHoverOnTransform == \"touch\" && pointer.touch);\r\n\t}\r\n\r\n\t/**\r\n\t * Handles pointer move.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param pointer  Pointer\r\n\t * @param ev       Original event\r\n\t */\r\n\tpublic handleGlobalMove(pointer: IPointer, ev: MouseEvent | TouchEvent): void {\r\n\r\n\t\t// Process hovered elements\r\n\t\t// We check if the element became unhovered without reporting the mouseout\r\n\t\t// event. (it happens in some cases)\r\n\t\tif (!pointer.touch) {\r\n\t\t\tconst target = <HTMLElement>$dom.eventTarget(<Event>pointer.lastEvent);\r\n\r\n\t\t\t$iter.each(this.overObjects.backwards().iterator(), (io) => {\r\n\t\t\t\t// Is this pointer relevant to element?\r\n\t\t\t\tif (io && io.overPointers.contains(pointer) && io.hoverable) {\r\n\t\t\t\t\t// Check if the element is still hovered\r\n\t\t\t\t\tlet reset = false;\r\n\t\t\t\t\tif (io.element && pointer.lastEvent) {\r\n\t\t\t\t\t\tif (!$dom.contains(io.element, target)) {\r\n\t\t\t\t\t\t\treset = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\treset = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (reset) {\r\n\t\t\t\t\t\tthis.handleOut(io, pointer, ev, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\r\n\t\t// Process down elements\r\n\t\t$iter.each(this.transformedObjects.backwards().iterator(), (io) => {\r\n\t\t\t// Is this pointer relevant to element?\r\n\t\t\tif (io.downPointers.contains(pointer) &&\r\n\t\t\t\t// Swipe still happening?\r\n\t\t\t\t!(io.swipeable && this.swiping(io, pointer)) &&\r\n\t\t\t\t(io.draggable || io.resizable)) {\r\n\t\t\t\tthis.handleTransform(io, ev);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Process tracked elements\r\n\t\t$iter.each(this.trackedObjects.backwards().iterator(), (io) => {\r\n\t\t\t// Is this pointer relevant to element?\r\n\t\t\tif (!io.overPointers.contains(pointer)) {\r\n\t\t\t\tthis.handleTrack(io, pointer, ev);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Handles reporting of pointer movement.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io        Element\r\n\t * @param pointer    Pointer\r\n\t * @param ev         Original event\r\n\t * @param skipCheck  Sould we skip check if cursor actually moved\r\n\t */\r\n\tpublic handleTrack(io: InteractionObject, pointer: IPointer, ev: MouseEvent | TouchEvent, skipCheck = false): void {\r\n\r\n\t\t// Do nothing if the cursor did not actually move\r\n\t\tif (!skipCheck && !this.moved(pointer, 0)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Initiate TRACK event\r\n\t\tif (io.events.isEnabled(\"track\") && !system.isPaused) {\r\n\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"track\"] = {\r\n\t\t\t\ttype: \"track\",\r\n\t\t\t\ttarget: io,\r\n\t\t\t\tevent: ev,\r\n\t\t\t\tpoint: pointer.point,\r\n\t\t\t\tpointer: pointer,\r\n\t\t\t\ttouch: pointer.touch\r\n\t\t\t};\r\n\t\t\tio.events.dispatchImmediately(\"track\", imev);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles swipe action.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t * @param ev       Original event\r\n\t */\r\n\tpublic handleSwipe(io: InteractionObject, pointer: IPointer, ev: MouseEvent | TouchEvent): void {\r\n\r\n\t\t// We pass in InteractionEvent with shift in mouse coordinates\r\n\t\t// between when the drag started and ended\r\n\t\tif (io.events.isEnabled(\"swipe\") && !system.isPaused) {\r\n\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"swipe\"] = {\r\n\t\t\t\ttype: \"swipe\",\r\n\t\t\t\ttarget: io,\r\n\t\t\t\tevent: ev,\r\n\t\t\t\ttouch: pointer.touch\r\n\t\t\t};\r\n\t\t\tio.events.dispatchImmediately(\"swipe\", imev);\r\n\t\t}\r\n\r\n\t\tif (pointer.startPoint.x < pointer.point.x) {\r\n\t\t\tif (io.events.isEnabled(\"swiperight\") && !system.isPaused) {\r\n\t\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"swiperight\"] = {\r\n\t\t\t\t\ttype: \"swiperight\",\r\n\t\t\t\t\ttarget: io,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\ttouch: pointer.touch\r\n\t\t\t\t};\r\n\t\t\t\tio.events.dispatchImmediately(\"swiperight\", imev);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (io.events.isEnabled(\"swipeleft\") && !system.isPaused) {\r\n\t\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"swipeleft\"] = {\r\n\t\t\t\t\ttype: \"swipeleft\",\r\n\t\t\t\t\ttarget: io,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\ttouch: pointer.touch\r\n\t\t\t\t};\r\n\t\t\t\tio.events.dispatchImmediately(\"swipeleft\", imev);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Handles event triggering for wheel rotation.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t * @param deltaX   Horizontal shift\r\n\t * @param deltaY   Vertical shift\r\n\t * @param ev       Original event\r\n\t */\r\n\tpublic handleWheel(io: InteractionObject, pointer: IPointer, deltaX: number, deltaY: number, ev: WheelEvent): void {\r\n\t\tconst shift: IPoint = {\r\n\t\t\tx: deltaX,\r\n\t\t\ty: deltaY\r\n\t\t};\r\n\r\n\t\t// Trigger generic WHEEL event\r\n\t\tif (io.events.isEnabled(\"wheel\") && !system.isPaused) {\r\n\t\t\tio.events.dispatchImmediately(\"wheel\", {\r\n\t\t\t\ttype: \"wheel\",\r\n\t\t\t\ttarget: io,\r\n\t\t\t\tevent: ev,\r\n\t\t\t\tpoint: pointer.point,\r\n\t\t\t\tshift: shift\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Trigger direction-specific events\r\n\r\n\t\t// Horizontal\r\n\t\tif (deltaX < 0) {\r\n\t\t\tif (io.events.isEnabled(\"wheelleft\") && !system.isPaused) {\r\n\t\t\t\tio.events.dispatchImmediately(\"wheelleft\", {\r\n\t\t\t\t\ttype: \"wheelleft\",\r\n\t\t\t\t\ttarget: io,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\tpoint: pointer.point,\r\n\t\t\t\t\tshift: shift\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t} else if (deltaX > 0) {\r\n\t\t\tif (io.events.isEnabled(\"swiperight\") && !system.isPaused) {\r\n\t\t\t\tio.events.dispatchImmediately(\"wheelright\", {\r\n\t\t\t\t\ttype: \"wheelright\",\r\n\t\t\t\t\ttarget: io,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\tpoint: pointer.point,\r\n\t\t\t\t\tshift: shift\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Vertical\r\n\t\t} else if (deltaY < 0) {\r\n\t\t\tif (io.events.isEnabled(\"wheelup\") && !system.isPaused) {\r\n\t\t\t\tio.events.dispatchImmediately(\"wheelup\", {\r\n\t\t\t\t\ttype: \"wheelup\",\r\n\t\t\t\t\ttarget: io,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\tpoint: pointer.point,\r\n\t\t\t\t\tshift: shift\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t} else if (deltaY > 0) {\r\n\t\t\tif (io.events.isEnabled(\"wheeldown\") && !system.isPaused) {\r\n\t\t\t\tio.events.dispatchImmediately(\"wheeldown\", {\r\n\t\t\t\t\ttype: \"wheeldown\",\r\n\t\t\t\t\ttarget: io,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\tpoint: pointer.point,\r\n\t\t\t\t\tshift: shift\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Initiates inertia checking sub-routines for different movement types:\r\n\t * drag, resize.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param sprite\r\n\t * @param pointer\r\n\t */\r\n\tpublic handleInertia(io: InteractionObject, pointer: IPointer): void {\r\n\r\n\t\tif (io.draggable && io.downPointers.length === 0) {\r\n\t\t\tthis.handleMoveInertia(io, pointer);\r\n\t\t}\r\n\r\n\t\tif (io.resizable && io.downPointers.length > 1) {\r\n\t\t\tthis.handleResizeInertia(io, pointer);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Continues moving the element to simulate the effect of inertia. Happens\r\n\t * when `inert` and `draggable` object is dragged and then released.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t */\r\n\tpublic handleMoveInertia(io: InteractionObject, pointer: IPointer): void {\r\n\t\tlet interaction = io;\r\n\t\tlet type: \"move\" = \"move\";\r\n\t\tlet point = {\r\n\t\t\t\"x\": pointer.point.x,\r\n\t\t\t\"y\": pointer.point.y\r\n\t\t};\r\n\t\tlet startPoint = {\r\n\t\t\t\"x\": pointer.startPoint.x,\r\n\t\t\t\"y\": pointer.startPoint.y\r\n\t\t};\r\n\r\n\t\t// Init inertia object\r\n\t\tlet inertia = new Inertia(interaction, type, point, startPoint);\r\n\r\n\t\t// Get inertia data\r\n\t\tlet ref = this.getTrailPoint(pointer, $time.getTime() - this.getInertiaOption(io, \"move\", \"time\"));\r\n\t\tif (typeof ref === \"undefined\") {\r\n\t\t\tthis.processDragStop(io, pointer, pointer.lastUpEvent);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Init animation options\r\n\t\tlet factor = this.getInertiaOption(io, \"move\", \"factor\");\r\n\t\tlet animationOptions = [{\r\n\t\t\t\"to\": pointer.point.x + (pointer.point.x - ref.point.x) * factor,\r\n\t\t\t\"property\": \"x\"\r\n\t\t}, {\r\n\t\t\t\"to\": pointer.point.y + (pointer.point.y - ref.point.y) * factor,\r\n\t\t\t\"property\": \"y\"\r\n\t\t}];\r\n\r\n\t\t// Start animation\r\n\t\tlet animation: Animation = new Animation(\r\n\t\t\tinertia,\r\n\t\t\tanimationOptions,\r\n\t\t\tthis.getInertiaOption(io, \"move\", \"duration\"),\r\n\t\t\tthis.getInertiaOption(io, \"move\", \"easing\")\r\n\t\t).start();\r\n\t\tthis._disposers.push(animation.events.on(\"animationended\", (ev) => {\r\n\t\t\tinertia.done();\r\n\t\t}));\r\n\r\n\t\t// Add inertia object\r\n\t\tio.inertias.setKey(\"move\", inertia);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Continues resizing of a `resizable` element after it is resized and\r\n\t * released.\r\n\t *\r\n\t * **NOTE:** this is is just a placeholder function. No actual fucntionality\r\n\t * is implemented, yet.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t */\r\n\tpublic handleResizeInertia(io: InteractionObject, pointer: IPointer): void {\r\n\r\n\t\t// Some day, folks. Some day...\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Recalculates element's position and size based on position of\r\n\t * all its related pointers.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io  Element\r\n\t * @param ev  Original event\r\n\t */\r\n\tpublic handleTransform(io: InteractionObject, ev: MouseEvent | TouchEvent): void {\r\n\r\n\t\t// Get primary pointer and its respective points\r\n\t\tlet pointer1: $type.Optional<IPointer> = io.downPointers.getIndex(0);\r\n\t\tlet point1: IPoint = null;\r\n\t\tlet startPoint1: IPoint = null;\r\n\r\n\t\tif (pointer1) {\r\n\t\t\tpoint1 = pointer1.point;\r\n\t\t\tstartPoint1 = pointer1.startPoint;\r\n\t\t}\r\n\r\n\t\t// Init secondary pointer\r\n\t\tlet pointer2: $type.Optional<IPointer>;\r\n\t\tlet point2: IPoint;\r\n\t\tlet startPoint2: IPoint;\r\n\r\n\t\t// Use center of the sprite to simulate \"second\" point of touch\r\n\t\tpoint2 = {\r\n\t\t\t\"x\": io.originalPosition.x,\r\n\t\t\t\"y\": io.originalPosition.y\r\n\t\t};\r\n\t\tstartPoint2 = point2;\r\n\r\n\t\t// Determine if it's a sinngle pointer or multi\r\n\t\tlet singlePoint: boolean = true;\r\n\t\tfor (let i = 1; i < io.downPointers.length; i++) {\r\n\r\n\t\t\t// Get pointer\r\n\t\t\tlet nextPointer = io.downPointers.getIndex(i);\r\n\r\n\t\t\t// Doublecheck if it's not the same pointer by comparing original position\r\n\t\t\tif (startPoint1.x != nextPointer.startPoint.x && startPoint1.y != nextPointer.startPoint.y) {\r\n\r\n\t\t\t\t// Several pointers down\r\n\t\t\t\tsinglePoint = false;\r\n\r\n\t\t\t\t// Get second pointer\r\n\t\t\t\tpointer2 = nextPointer;\r\n\t\t\t\tpoint2 = pointer2.point;\r\n\t\t\t\tstartPoint2 = pointer2.startPoint;\r\n\r\n\t\t\t\t// Stop looking\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Primary touch point moved?\r\n\t\tlet pointer1Moved = pointer1 && this.moved(pointer1, 0);\r\n\r\n\t\t// Report DRAG_START if necessary\r\n\t\tif (io.draggable && pointer1 && pointer1.dragStartEvents && pointer1.dragStartEvents.length && pointer1Moved) {\r\n\t\t\tif (io.events.isEnabled(\"dragstart\") && !system.isPaused) {\r\n\t\t\t\tio.events.dispatchImmediately(\"dragstart\", pointer1.dragStartEvents.shift());\r\n\t\t\t}\r\n\t\t\t//delete pointer1.dragStartEvents;\r\n\t\t}\r\n\r\n\t\t// Determine what we do in order of superiority\r\n\t\tif (singlePoint && io.draggable) {\r\n\r\n\t\t\t// We have only one pointer and the Sprite is draggable\r\n\t\t\t// There's nothing else to be done - just move it\r\n\t\t\tthis.handleTransformMove(io, point1, startPoint1, ev, pointer1Moved, pointer1.touch);\r\n\r\n\t\t\tif (this.shouldCancelHovers(pointer1) && this.moved(pointer1, this.getHitOption(io, \"hitTolerance\"))) {\r\n\t\t\t\tthis.cancelAllHovers(ev);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\t// Check if second touch point moved\r\n\t\t\tlet pointer2Moved = pointer2 && this.moved(pointer2, 0);\r\n\r\n\t\t\tif (\r\n\t\t\t\t(this.shouldCancelHovers(pointer1) && this.moved(pointer1, this.getHitOption(io, \"hitTolerance\")))\r\n\t\t\t\t||\r\n\t\t\t\t(this.shouldCancelHovers(pointer2) && this.moved(pointer2, this.getHitOption(io, \"hitTolerance\")))\r\n\t\t\t) {\r\n\t\t\t\tthis.cancelAllHovers(ev);\r\n\t\t\t}\r\n\r\n\t\t\tif (io.draggable && io.resizable) {\r\n\t\t\t\t//this.handleTransformAll(io, point1, startPoint1, point2, startPoint2, ev, pointer1Moved && pointer2Moved);\r\n\t\t\t\tthis.handleTransformMove(io, point1, startPoint1, ev, pointer1Moved && pointer2Moved, pointer1.touch);\r\n\t\t\t\tthis.handleTransformResize(io, point1, startPoint1, point2, startPoint2, ev, pointer1Moved && pointer2Moved, pointer1.touch);\r\n\t\t\t}\r\n\t\t\telse {\r\n\r\n\t\t\t\tif (io.draggable) {\r\n\t\t\t\t\tthis.handleTransformMove(io, point1, startPoint1, ev, pointer1Moved, pointer1.touch);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (io.resizable && (!singlePoint || ev.ctrlKey)) {\r\n\t\t\t\t\tthis.handleTransformResize(io, point1, startPoint1, point2, startPoint2, ev, pointer1Moved && pointer2Moved, pointer1.touch);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Handles movement of the dragged element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io            Element\r\n\t * @param point         Current point of the pointer\r\n\t * @param startPoint    Starting point of the pointer\r\n\t * @param ev            Original event\r\n\t * @param pointerMoved  Did pointer move?\r\n\t */\r\n\tpublic handleTransformMove(io: InteractionObject, point: IPoint, startPoint: IPoint, ev: MouseEvent | TouchEvent | KeyboardEvent, pointerMoved: boolean, touch: boolean): void {\r\n\r\n\t\tif (pointerMoved) {\r\n\t\t\tif (io.events.isEnabled(\"drag\") && !system.isPaused && (!io.isTouchProtected || !touch)) {\r\n\t\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"drag\"] = {\r\n\t\t\t\t\ttype: \"drag\",\r\n\t\t\t\t\ttarget: io,\r\n\t\t\t\t\tevent: ev,\r\n\t\t\t\t\tshift: {\r\n\t\t\t\t\t\t\"x\": point.x - startPoint.x,\r\n\t\t\t\t\t\t\"y\": point.y - startPoint.y\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstartPoint: startPoint,\r\n\t\t\t\t\tpoint: point,\r\n\t\t\t\t\ttouch: touch\r\n\t\t\t\t};\r\n\t\t\t\tio.events.dispatchImmediately(\"drag\", imev);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Handles resizing of the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io            Element\r\n\t * @param point1        Current position of reference point #1\r\n\t * @param startPoint1   Original position of reference point #1\r\n\t * @param point2        Current position of reference point #2\r\n\t * @param startPoint2   Original position of reference point #2\r\n\t * @param ev            Original event\r\n\t * @param pointerMoved  Did pointer move?\r\n\t */\r\n\tpublic handleTransformResize(io: InteractionObject, point1: IPoint, startPoint1: IPoint, point2: IPoint, startPoint2: IPoint, ev: MouseEvent | TouchEvent, pointerMoved: boolean, touch: boolean): void {\r\n\t\tif (io.events.isEnabled(\"resize\") && !system.isPaused && (!io.isTouchProtected || !touch)) {\r\n\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"resize\"] = {\r\n\t\t\t\ttype: \"resize\",\r\n\t\t\t\ttarget: io,\r\n\t\t\t\tevent: ev,\r\n\t\t\t\tscale: $math.getScale(point1, startPoint1, point2, startPoint2),\r\n\t\t\t\tstartPoint1: startPoint1,\r\n\t\t\t\tpoint1: point1,\r\n\t\t\t\tstartPoint2: startPoint2,\r\n\t\t\t\tpoint2: point2,\r\n\t\t\t\ttouch: touch\r\n\t\t\t};\r\n\t\t\tio.events.dispatchImmediately(\"resize\", imev);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Handles all the preparations of the element when it starts to be dragged.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t * @param ev       Original event\r\n\t */\r\n\tpublic processDragStart(io: InteractionObject, pointer?: IPointer, ev?: MouseEvent | TouchEvent): void {\r\n\r\n\t\t// Add to draggedObjects\r\n\t\tthis.transformedObjects.moveValue(io);\r\n\r\n\t\tif (this.shouldCancelHovers(pointer)) {\r\n\t\t\tthis.cancelAllHovers(ev);\r\n\t\t}\r\n\r\n\t\t// Report \"dragstart\"\r\n\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"dragstart\"] = {\r\n\t\t\ttype: \"dragstart\",\r\n\t\t\ttarget: io,\r\n\t\t\tevent: ev,\r\n\t\t\ttouch: pointer ? pointer.touch : false\r\n\t\t};\r\n\r\n\t\t// Log object that we are starting to drag, so we can check against and\r\n\t\t// avoid hovers on other objects that might be in the path of movement.\r\n\t\tif (pointer) {\r\n\t\t\tpointer.dragTarget = io;\r\n\t\t\t//pointer.startPoint = pointer.point;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * If pointer is set we will not fire the event until the pointer has\r\n\t\t * actually moved. If it's not set we don't have to wait for anything, so we\r\n\t\t * just fire off the event right away.\r\n\t\t */\r\n\t\tif (pointer && pointer.dragStartEvents) {\r\n\t\t\tpointer.dragStartEvents.push(imev);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (!system.isPaused) {\r\n\t\t\t\tio.dispatchImmediately(\"dragstart\", imev);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Finishes up element drag operation.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t * @param ev       Original event\r\n\t */\r\n\tpublic processDragStop(io: InteractionObject, pointer?: IPointer, ev?: MouseEvent | TouchEvent): void {\r\n\r\n\t\t// Pointer set?\r\n\t\tif (!pointer) {\r\n\t\t\tpointer = this.getDragPointer(io);\r\n\t\t}\r\n\r\n\t\t// Unset drag object\r\n\t\tif (pointer) {\r\n\t\t\tpointer.dragTarget = undefined;\r\n\t\t}\r\n\r\n\t\t// Removed from transformedObjects\r\n\t\tthis.transformedObjects.removeValue(io);\r\n\r\n\t\t// Unlock document\r\n\t\t//this.unlockDocument();\r\n\r\n\t\t// Report dragstop\r\n\t\tif (!pointer || this.moved(pointer, 0)) {\r\n\t\t\tif (io.events.isEnabled(\"dragstop\") && !system.isPaused) {\r\n\t\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"dragstop\"] = {\r\n\t\t\t\t\ttype: \"dragstop\",\r\n\t\t\t\t\ttarget: io,\r\n\t\t\t\t\ttouch: pointer ? pointer.touch : false\r\n\t\t\t\t};\r\n\t\t\t\tio.events.dispatchImmediately(\"dragstop\", imev);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles all the preparations of the element when it starts to be resized.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t * @param ev       Original event\r\n\t */\r\n\tpublic processResizeStart(io: InteractionObject, pointer?: IPointer, ev?: MouseEvent | TouchEvent): void {\r\n\r\n\t\t// Add to draggedObjects\r\n\t\tthis.transformedObjects.moveValue(io);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Finishes up element drag operation.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t * @param ev       Original event\r\n\t */\r\n\tpublic processResizeStop(io: InteractionObject, pointer?: IPointer, ev?: MouseEvent | TouchEvent): void {\r\n\r\n\t\t// Removed from transformedObjects\r\n\t\tthis.transformedObjects.removeValue(io);\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * Controls for InteractionObjects initiating directly\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Manually triggers drag start on the element. Could be useful in cases\r\n\t * where tracking or dragging one element can also influence dragging another\r\n\t * element.\r\n\t *\r\n\t * Passing in `pointer` reference is advisable. If not passed in it will try\r\n\t * to determine which pointer to attach to. However, it's better to specify\r\n\t * it explicitly.\r\n\t *\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t */\r\n\tpublic dragStart(io: InteractionObject, pointer?: IPointer): void {\r\n\t\tif (!pointer) {\r\n\t\t\tpointer = this.getDragPointer(io);\r\n\t\t}\r\n\r\n\t\tif (pointer) {\r\n\t\t\tthis.handleDown(io, pointer, pointer.lastDownEvent);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Manually ends drag on the element.\r\n\t *\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t */\r\n\tpublic dragStop(io: InteractionObject, pointer?: IPointer, cancelled?: boolean): void {\r\n\t\tif (!pointer) {\r\n\t\t\tpointer = this.getDragPointer(io);\r\n\t\t}\r\n\r\n\t\tif (pointer && !cancelled) {\r\n\t\t\tthis.handleGlobalUp(pointer, pointer.lastUpEvent, cancelled);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * This method uses a fuzzy logic to find the pointer to be used for dragging.\r\n\t * Beware that this is not a rock-solid solution. If there are a few objects\r\n\t * being dragged at the same time, you may get unexepected results.\r\n\t *\r\n\t * @param io  InteractionObject to get pointers from\r\n\t * @return Pointer currently being used for dragging\r\n\t */\r\n\tpublic getDragPointer(io?: InteractionObject): $type.Optional<IPointer> {\r\n\t\tif (io) {\r\n\t\t\t// InteractionObject is supplied\r\n\t\t\t// Use it's first down pointer\r\n\t\t\treturn io.downPointers.getIndex(0);\r\n\t\t}\r\n\t\telse if (this.transformedObjects.length) {\r\n\t\t\t// Use first dragged object\r\n\t\t\treturn this.getDragPointer(this.transformedObjects.getIndex(0));\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * Utils\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Returns pointer id for the given event object.\r\n\t *\r\n\t * @param ev  Event\r\n\t * @return Pointer ID\r\n\t */\r\n\tprotected getPointerId(ev: any): string {\r\n\t\tlet id = \"\";\r\n\t\tif ($type.hasValue(ev.identifier)) {\r\n\t\t\tid = \"\" + <string>ev.identifier;\r\n\t\t} else if ($type.hasValue(ev.pointerId)) {\r\n\t\t\tid = \"\" + <string>ev.pointerId;\r\n\t\t} else {\r\n\t\t\tid = \"m\";\r\n\t\t}\r\n\t\treturn id.replace(\"-\", \"\");\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a cursor position of the event.\r\n\t *\r\n\t * @param ev  Original event\r\n\t * @return Event point\r\n\t */\r\n\tprotected getPointerPoint(ev: MouseEvent | Touch): IPoint {\r\n\t\treturn {\r\n\t\t\t\"x\": ev.clientX,\r\n\t\t\t\"y\": ev.clientY\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Returns [[Pointer]] object that is associated with the Event.\r\n\t *\r\n\t * If no such [[Pointer]] object exists, it is created.\r\n\t *\r\n\t * @param ev  Event\r\n\t * @return Pointer\r\n\t */\r\n\tprotected getPointer(ev: MouseEvent | Touch): IPointer {\r\n\r\n\t\t// Get pointer id\r\n\t\tlet id = this.getPointerId(ev);\r\n\r\n\t\t// Get current coordinates\r\n\t\tlet point = this.getPointerPoint(ev);\r\n\r\n\t\t// Look for the pointer in the Dictionary if it maybe already exists\r\n\t\tlet pointer: IPointer;\r\n\t\tif (this.pointers.hasKey(id)) {\r\n\r\n\t\t\t// We already have such pointer\r\n\t\t\tpointer = this.pointers.getKey(id)!;\r\n\r\n\t\t\t// We need this, because Edge reuses pointer ids across touch and mouse\r\n\t\t\tpointer.touch = this.isPointerTouch(ev);\r\n\r\n\t\t\t// Reset pointer\r\n\t\t\t//pointer.point = point;\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Init pointer\r\n\t\t\tpointer = {\r\n\t\t\t\t\"id\": id,\r\n\t\t\t\t//\"touch\": !(ev instanceof MouseEvent) || ((<any>ev).pointerType && (<any>ev).pointerType != \"pointer\"),\r\n\t\t\t\t//\"touch\": !(ev instanceof MouseEvent) || ((<any>ev).pointerType && (<any>ev).pointerType != \"mouse\"),\r\n\t\t\t\t\"touch\": this.isPointerTouch(ev),\r\n\t\t\t\t\"startPoint\": point,\r\n\t\t\t\t\"startTime\": $time.getTime(),\r\n\t\t\t\t\"point\": point,\r\n\t\t\t\t\"track\": [],\r\n\t\t\t\t\"swipeCanceled\": false,\r\n\t\t\t\t\"dragStartEvents\": []\r\n\t\t\t};\r\n\r\n\t\t\t// Add first breadcrumb\r\n\t\t\tthis.addBreadCrumb(pointer, point);\r\n\r\n\t\t\t// Add for re-use later\r\n\t\t\tthis.pointers.setKey(id, pointer);\r\n\t\t}\r\n\r\n\t\t// Log last event\r\n\t\tpointer.lastEvent = ev;\r\n\r\n\t\tthis.lastPointer = pointer;\r\n\r\n\t\treturn pointer;\r\n\t}\r\n\r\n\t/**\r\n\t * Determines if pointer event originated from a touch pointer or mouse.\r\n\t *\r\n\t * @param ev  Original event\r\n\t * @return Touch pointer?\r\n\t */\r\n\tprotected isPointerTouch(ev: MouseEvent | Touch): boolean {\r\n\t\tif (typeof Touch !== \"undefined\" && ev instanceof Touch) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse if (typeof PointerEvent !== \"undefined\" && ev instanceof PointerEvent && $type.hasValue((<any>ev).pointerType)) {\r\n\t\t\tswitch ((<any>ev).pointerType) {\r\n\t\t\t\tcase \"touch\":\r\n\t\t\t\tcase \"pen\":\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\treturn true;\r\n\t\t\t\tcase \"mouse\":\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\treturn false;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn !(ev instanceof MouseEvent);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ($type.hasValue((<any>ev).type)) {\r\n\t\t\tif ((<any>ev).type.match(/^mouse/)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Resets the poiner to original state, i.e. cleans movement information,\r\n\t * starting point, etc.\r\n\t *\r\n\t * @param pointer Pointer\r\n\t */\r\n\tprotected resetPointer(pointer: IPointer, ev: MouseEvent | PointerEvent | Touch): void {\r\n\t\t// Get current coordinates\r\n\t\tlet point = this.getPointerPoint(ev);;\r\n\t\tpointer.startTime = $time.getTime();\r\n\t\tpointer.startPoint = { x: point.x, y: point.y };\r\n\t\tpointer.point = { x: point.x, y: point.y };\r\n\t\tpointer.track = [];\r\n\t\tpointer.swipeCanceled = false;\r\n\t\t//clearTimeout(pointer.swipeTimeout);\r\n\t\t//clearTimeout(pointer.holdTimeout);\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a \"breadcrumb\" point to the [[Pointer]] to log its movement path.\r\n\t *\r\n\t * @param pointer  Pointer\r\n\t * @param point    Point coordinates\r\n\t */\r\n\tprotected addBreadCrumb(pointer: IPointer, point: IPoint): void {\r\n\t\tpointer.track.push({\r\n\t\t\t\"timestamp\": $time.getTime(),\r\n\t\t\t\"point\": point\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Prepares the document for various touch-related operations.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic lockDocument(): void {\r\n\t\tthis.prepElement(this.body);\r\n\t}\r\n\r\n\t/**\r\n\t * Restores document functionality.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic unlockDocument(): void {\r\n\t\tif (this.transformedObjects.length == 0) {\r\n\t\t\tthis.restoreAllStyles(this.body);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Lock element (disable all touch)\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic lockElement(io: InteractionObject): void {\r\n\t\tthis.prepElement(io);\r\n\t}\r\n\r\n\t/**\r\n\t * Restores element's functionality.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic unlockElement(io: InteractionObject): void {\r\n\t\tthis.restoreAllStyles(io);\r\n\t}\r\n\r\n\t/**\r\n\t * Locks document's wheel scroll.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic lockWheel(): void {\r\n\t\twindow.addEventListener(\r\n\t\t\tthis._pointerEvents.wheel,\r\n\t\t\tthis.wheelLockEvent,\r\n\t\t\tthis._passiveSupported ? { passive: false } : false\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Unlocks document's wheel scroll.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic unlockWheel(): void {\r\n\t\twindow.removeEventListener(\r\n\t\t\tthis._pointerEvents.wheel,\r\n\t\t\tthis.wheelLockEvent\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if top element at pointer's position belongs to the SVG.\r\n\t *\r\n\t * @ignore Exlude from docs\r\n\t * @param pointer  Pointer\r\n\t * @param svg      The <svg> element\r\n\t * @param id       A unique identifier of the object that is checking for locality\r\n\t * @return Belongs to SVG\r\n\t */\r\n\tpublic isLocalElement(pointer: IPointer, svg: SVGSVGElement, id: string): boolean {\r\n\t\tconst cached = this.getCache(\"local_pointer_\" + pointer.id);\r\n\t\tif ($type.hasValue(cached)) {\r\n\t\t\treturn cached;\r\n\t\t}\r\n\t\tconst doc = ($dom.getRoot(svg) || document);\r\n\t\tif (doc.elementFromPoint) {\r\n\t\t\tconst target = doc.elementFromPoint(pointer.point.x, pointer.point.y);\r\n\t\t\tconst local = target && $dom.contains(svg, <HTMLElement>target);\r\n\t\t\tthis.setCache(\"local_pointer_\" + pointer.id + \"_\" + id, local, 100);\r\n\t\t\treturn local;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * A function that cancels mouse wheel scroll.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param ev  Event object\r\n\t * @return Returns `false` to cancel\r\n\t */\r\n\tprotected wheelLockEvent(ev: Event): boolean {\r\n\t\tev.preventDefault();\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Applies a set of styles to an element. Stores the original styles so they\r\n\t * can be restored later.\r\n\t *\r\n\t * @ignore\r\n\t * @param io      Element\r\n\t */\r\n\tpublic prepElement(io: InteractionObject): void {\r\n\r\n\t\tlet el = io.element;\r\n\r\n\t\tif (el) {\r\n\r\n\t\t\t// Define possible props\r\n\t\t\tlet props = [\r\n\t\t\t\t\"touchAction\", \"webkitTouchAction\", \"MozTouchAction\", \"MSTouchAction\", \"msTouchAction\", \"oTouchAction\",\r\n\t\t\t\t\"userSelect\", \"webkitUserSelect\", \"MozUserSelect\", \"MSUserSelect\", \"msUserSelect\", \"oUserSelect\",\r\n\t\t\t\t\"touchSelect\", \"webkitTouchSelect\", \"MozTouchSelect\", \"MSTouchSelect\", \"msTouchSelect\", \"oTouchSelect\",\r\n\t\t\t\t\"touchCallout\", \"webkitTouchCallout\", \"MozTouchCallout\", \"MSTouchCallout\", \"msTouchCallout\", \"oTouchCallout\",\r\n\t\t\t\t\"contentZooming\", \"webkitContentZooming\", \"MozContentZooming\", \"MSContentZooming\", \"msContentZooming\", \"oContentZooming\",\r\n\t\t\t\t\"userDrag\", \"webkitUserDrag\", \"MozUserDrag\", \"MSUserDrag\", \"msUserDrag\", \"oUserDrag\"\r\n\t\t\t];\r\n\t\t\tfor (let i = 0; i < props.length; i++) {\r\n\t\t\t\tif (props[i] in el.style) {\r\n\t\t\t\t\tthis.setTemporaryStyle(io, props[i], \"none\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove iOS-specific selection;\r\n\t\t\tthis.setTemporaryStyle(io, \"tapHighlightColor\", \"rgba(0, 0, 0, 0)\");\r\n\t\t\t//this.setTemporaryStyle(io, \"webkitOverflowScrolling\", \"none\");\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Restores replaced styles\r\n\t *\r\n\t * @ignore\r\n\t * @param  io  Element\r\n\t */\r\n\tpublic unprepElement(io: InteractionObject): void {\r\n\r\n\t\tlet el = io.element;\r\n\r\n\t\tif (el) {\r\n\r\n\t\t\t// Define possible props\r\n\t\t\tlet props = [\r\n\t\t\t\t\"touchAction\", \"webkitTouchAction\", \"MozTouchAction\", \"MSTouchAction\", \"msTouchAction\", \"oTouchAction\",\r\n\t\t\t\t\"userSelect\", \"webkitUserSelect\", \"MozUserSelect\", \"MSUserSelect\", \"msUserSelect\", \"oUserSelect\",\r\n\t\t\t\t\"touchSelect\", \"webkitTouchSelect\", \"MozTouchSelect\", \"MSTouchSelect\", \"msTouchSelect\", \"oTouchSelect\",\r\n\t\t\t\t\"touchCallout\", \"webkitTouchCallout\", \"MozTouchCallout\", \"MSTouchCallout\", \"msTouchCallout\", \"oTouchCallout\",\r\n\t\t\t\t\"contentZooming\", \"webkitContentZooming\", \"MozContentZooming\", \"MSContentZooming\", \"msContentZooming\", \"oContentZooming\",\r\n\t\t\t\t\"userDrag\", \"webkitUserDrag\", \"MozUserDrag\", \"MSUserDrag\", \"msUserDrag\", \"oUserDrag\"\r\n\t\t\t];\r\n\t\t\tfor (let i = 0; i < props.length; i++) {\r\n\t\t\t\tif (props[i] in el.style) {\r\n\t\t\t\t\tthis.restoreStyle(io, props[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove iOS-specific selection;\r\n\t\t\tthis.restoreStyle(io, \"tapHighlightColor\");\r\n\t\t\t//this.restoreStyle(io, \"webkitOverflowScrolling\");\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an option associated with hit events.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io      Element\r\n\t * @param option  Option key\r\n\t * @return Option value\r\n\t */\r\n\tpublic getHitOption(io: InteractionObject, option: keyof IHitOptions): any {\r\n\t\tlet res = io.hitOptions[option];\r\n\t\tif (typeof res === \"undefined\") {\r\n\t\t\tres = this.hitOptions[option];\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an option associated with hover events.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io      Element\r\n\t * @param option  Option key\r\n\t * @return Option value\r\n\t */\r\n\tpublic getHoverOption(io: InteractionObject, option: keyof IHoverOptions): any {\r\n\t\tlet res = io.hoverOptions[option];\r\n\t\tif (typeof res === \"undefined\") {\r\n\t\t\tres = this.hoverOptions[option];\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an option associated with swipe events.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io      Element\r\n\t * @param option  Option key\r\n\t * @return Option value\r\n\t */\r\n\tpublic getSwipeOption(io: InteractionObject, option: keyof ISwipeOptions): any {\r\n\t\tlet res = io.swipeOptions[option];\r\n\t\tif (typeof res === \"undefined\") {\r\n\t\t\tres = this.swipeOptions[option];\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an option for keyboard.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io      Element\r\n\t * @param option  Option key\r\n\t * @return Option value\r\n\t */\r\n\tpublic getKeyboardOption(io: InteractionObject, option: keyof IKeyboardOptions): any {\r\n\t\tlet res = io.keyboardOptions[option];\r\n\t\tif (typeof res === \"undefined\") {\r\n\t\t\tres = this.keyboardOptions[option];\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an option for mouse.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io      Element\r\n\t * @param option  Option key\r\n\t * @return Option value\r\n\t */\r\n\tpublic getMouseOption(io: InteractionObject, option: keyof IMouseOptions): any {\r\n\t\tlet res = io.mouseOptions[option];\r\n\t\tif (typeof res === \"undefined\") {\r\n\t\t\tres = this.mouseOptions[option];\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an option associated with inertia.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io      Element\r\n\t * @param type    Inertia type\r\n\t * @param option  Option key\r\n\t * @return Option value\r\n\t */\r\n\tpublic getInertiaOption(io: InteractionObject, type: InertiaTypes, option: keyof IInertiaOptions): any {\r\n\t\tlet options: any = io.inertiaOptions.getKey(type);\r\n\t\tlet res: IInertiaOptions;\r\n\t\tif (options && $type.hasValue(options[option])) {\r\n\t\t\tres = options[option];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tres = (<any>this.inertiaOptions.getKey(type))[option];\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Stops currently going on inertia. Useful if inertia is currently being\r\n\t * animated and the object is being interacted with.\r\n\t *\r\n\t * @param io Element\r\n\t */\r\n\tprotected stopInertia(io: InteractionObject): void {\r\n\t\tlet x: InertiaTypes;\r\n\t\tlet inertias: Array<InertiaTypes> = [\"move\", \"resize\"];\r\n\t\tfor (let i = 0; i < inertias.length; i++) {\r\n\t\t\tx = inertias[i];\r\n\t\t\tif (io.inertias.hasKey(x)) {\r\n\t\t\t\tlet inertia: $type.Optional<Inertia> = io.inertias.getKey(x);\r\n\t\t\t\tif (inertia) {\r\n\t\t\t\t\tinertia.dispose();\r\n\t\t\t\t\t//io.inertiaAnimations.removeKey(x);\r\n\t\t\t\t\t//this.processDragStop(io);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Check if swiping is currently being performed on an object.\r\n\t *\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer to check\r\n\t * @return `true` if swiping\r\n\t */\r\n\tpublic swiping(io: InteractionObject, pointer: IPointer): boolean {\r\n\t\tlet now = $time.getTime();\r\n\r\n\t\tif (pointer.swipeCanceled || !io.swipeable) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\telse if (\r\n\t\t\t(Math.abs(pointer.startPoint.y - pointer.point.y) < this.getSwipeOption(io, \"verticalThreshold\")) &&\r\n\t\t\t(pointer.startTime > (now - this.getSwipeOption(io, \"time\")))\r\n\t\t) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if a successfull swipe action was performed on an element.\r\n\t *\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t * @return Swiped?\r\n\t */\r\n\tpublic swiped(io: InteractionObject, pointer: IPointer): boolean {\r\n\t\tlet now = $time.getTime();\r\n\t\tif (pointer.swipeCanceled) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\telse if (\r\n\t\t\t(Math.abs(pointer.startPoint.x - pointer.point.x) > this.getSwipeOption(io, \"horizontalThreshold\")) &&\r\n\t\t\t(Math.abs(pointer.startPoint.y - pointer.point.y) < this.getSwipeOption(io, \"verticalThreshold\")) &&\r\n\t\t\t(pointer.startTime > (now - this.getSwipeOption(io, \"time\")))\r\n\t\t) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Applies style to mouse cursor based on its stage in relation to\r\n\t * [[InteractionObject]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param Element\r\n\t */\r\n\tpublic applyCursorOverStyle(io: InteractionObject): void {\r\n\r\n\t\t// Get sprite's cursor ooptions\r\n\t\tlet options = io.cursorOptions;\r\n\r\n\t\tif (!$type.hasValue(options.overStyle)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Apply cursor down styles\r\n\t\tfor (let i = 0; i < options.overStyle.length; i++) {\r\n\t\t\t$dom.setStyle(io.element, options.overStyle[i].property, options.overStyle[i].value);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Applies style to mouse cursor based on its stage in relation to\r\n\t * [[InteractionObject]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t */\r\n\tpublic applyCursorDownStyle(io: InteractionObject, pointer: IPointer): void {\r\n\r\n\t\t// Not applicable for touch pointers since they don't display a cursor\r\n\t\tif (pointer && pointer.touch) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst downStyle = io.cursorOptions.downStyle;\r\n\t\t// Is down?\r\n\t\tif (io.downPointers.contains(pointer) && $type.hasValue(downStyle)) {\r\n\t\t\t// Apply cursor down styles\r\n\t\t\tfor (let i = 0; i < downStyle.length; i++) {\r\n\t\t\t\tthis.setTemporaryStyle(this.body, downStyle[i].property, downStyle[i].value);\r\n\t\t\t\tthis.setTemporaryStyle(io, downStyle[i].property, downStyle[i].value);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Restores original cursor style for the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param io       Element\r\n\t * @param pointer  Pointer\r\n\t */\r\n\tpublic restoreCursorDownStyle(io: InteractionObject, pointer: IPointer): void {\r\n\r\n\t\t// Not applicable for touch pointers since they don't display a cursor\r\n\t\tif (pointer && pointer.touch) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst downStyle = io.cursorOptions.downStyle;\r\n\r\n\t\t// Is down?\r\n\t\tif (io.downPointers.contains(pointer) && $type.hasValue(downStyle)) {\r\n\t\t\t// Apply cursor down styles\r\n\t\t\tfor (let i = 0; i < downStyle.length; i++) {\r\n\t\t\t\tthis.restoreStyle(this.body, downStyle[i].property);\r\n\t\t\t\tthis.restoreStyle(io, downStyle[i].property);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets style on the body of the document.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param style  Style definitions\r\n\t */\r\n\tpublic setGlobalStyle(style: Array<IStyleProperty> | IStyleProperty): void {\r\n\t\tlet body = getInteraction().body;\r\n\t\tlet styles = <Array<IStyleProperty>>($type.isArray(style) ? style : [style]);\r\n\t\tfor (let i = 0; i < styles.length; i++) {\r\n\t\t\tthis.setTemporaryStyle(body, styles[i].property, styles[i].value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Restores style on the body of the document.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param style  Style definitions\r\n\t */\r\n\tpublic restoreGlobalStyle(style: Array<IStyleProperty> | IStyleProperty): void {\r\n\t\tlet body = getInteraction().body;\r\n\t\tlet styles = <Array<IStyleProperty>>($type.isArray(style) ? style : [style]);\r\n\t\tfor (let i = 0; i < styles.length; i++) {\r\n\t\t\tthis.restoreStyle(body, styles[i].property);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if element is a non-cahrt element.\r\n\t *\r\n\t * @param io  InteractionObject\r\n\t * @return Global element?\r\n\t */\r\n\tprotected isGlobalElement(io: InteractionObject): boolean {\r\n\t\treturn document.body === io.element;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if pointer has moved since it was created.\r\n\t *\r\n\t * @param pointer    Pointer\r\n\t * @param tolerance  Tolerance in pixels\r\n\t * @param minTime    Minimum time required for the pointer to be down to be considered moved\r\n\t * @return `true` if the pointer has moved\r\n\t */\r\n\tpublic moved(pointer: IPointer, tolerance: number, minTime: number = 300): boolean {\r\n\r\n\t\t/*// If there was more time, we don't care if cursor actually moved\r\n\t\tlet duration = $time.getTime() - pointer.startTime;\r\n\t\tif ($type.hasValue(minTime) && (minTime > duration)) {\r\n\t\t\treturn false;\r\n\t\t}*/\r\n\r\n\t\t// That was quick measure shift\r\n\t\tlet shift = this.getShift(pointer);\r\n\r\n\t\treturn (Math.abs(shift.x) > tolerance) || (Math.abs(shift.y) > tolerance);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns if pointer is \"old\", meaning it has been pressing for more than\r\n\t * X milliseconds.\r\n\t *\r\n\t * @ignore\r\n\t * @param pointer  Pointer\r\n\t * @param minTime  Minimum time to consider pointer old\r\n\t * @return {boolean}\r\n\t */\r\n\tpublic old(pointer: IPointer, minTime: number = 300): boolean {\r\n\t\treturn $time.getTime() - pointer.startTime > minTime;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns total a shift in pointers coordinates between its original\r\n\t * position and now.\r\n\t *\r\n\t * @param pointer  Pointer\r\n\t * @return Shift in coordinates (x/y)\r\n\t */\r\n\tpublic getShift(pointer: IPointer): IPoint {\r\n\t\treturn {\r\n\t\t\t\"x\": pointer.startPoint.x - pointer.point.x,\r\n\t\t\t\"y\": pointer.startPoint.y - pointer.point.y\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a point from [[Pointer]]'s move history at a certain timetamp.\r\n\t *\r\n\t * @param pointer    Pointer\r\n\t * @param timestamp  Timestamp\r\n\t * @return Point\r\n\t */\r\n\tpublic getTrailPoint(pointer: IPointer, timestamp: number): $type.Optional<IBreadcrumb> {\r\n\t\tlet res: $type.Optional<IBreadcrumb>;\r\n\t\tfor (let i = 0; i < pointer.track.length; i++) {\r\n\t\t\tif (pointer.track[i].timestamp >= timestamp) {\r\n\t\t\t\tres = pointer.track[i];\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if same pointer already exists in the list.\r\n\t *\r\n\t * @param list     List to check agains\r\n\t * @param pointer  Pointer\r\n\t * @return Exists?\r\n\t */\r\n\tprotected pointerExists(list: List<IPointer>, pointer: IPointer): boolean {\r\n\t\tlet exists = false;\r\n\t\tlist.each((item) => {\r\n\t\t\tif (item == pointer) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\texists = item.point.x == pointer.point.x && item.point.y == pointer.point.y;\r\n\t\t});\r\n\t\treturn exists;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an [[InteractionObject]] representation of a DOM element.\r\n\t *\r\n\t * You can use this on any HTML or SVG element, to add interactive features\r\n\t * to it.\r\n\t *\r\n\t * @param element  Element\r\n\t * @return InteractionObject\r\n\t */\r\n\tpublic getInteraction(element: HTMLElement | SVGSVGElement): InteractionObject {\r\n\t\treturn new InteractionObject(element);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a style property on an element. Stores original value to be restored\r\n\t * later with [[restoreStyle]].\r\n\t *\r\n\t * @see {@link restoreStyle}\r\n\t * @param io        Element\r\n\t * @param property  Property\r\n\t * @param value     Value\r\n\t */\r\n\tpublic setTemporaryStyle(io: InteractionObject, property: string, value: string): void {\r\n\r\n\t\t// Get element\r\n\t\t//let el = io.element.tagName == \"g\" ? <SVGSVGElement>io.element.parentNode : io.element;\r\n\t\tlet el = io.element;\r\n\r\n\t\t// Save original property if it is set and hasn't been saved before already\r\n\t\tif ($type.hasValue((<any>el.style)[property]) && !io.replacedStyles.hasKey(property)) {\r\n\t\t\tio.replacedStyles.setKey(property, (<any>el.style)[property]);\r\n\t\t}\r\n\r\n\t\t// Replace with the new one\r\n\t\t$dom.setStyle(el, property, value);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Restores specific style on an element.\r\n\t *\r\n\t * @param io        Element\r\n\t * @param property  Style property\r\n\t */\r\n\tpublic restoreStyle(io: InteractionObject, property: string): void {\r\n\r\n\t\t// Reset style\r\n\t\tif (io.replacedStyles.hasKey(property)) {\r\n\t\t\t(<any>io.element.style)[property] = io.replacedStyles.getKey(property);\r\n\t\t\tio.replacedStyles.removeKey(property);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelete (<any>io.element.style)[property];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Restore temporarily reset styles on an element.\r\n\t *\r\n\t * @param io Element\r\n\t */\r\n\tpublic restoreAllStyles(io: InteractionObject): void {\r\n\t\t$iter.each(io.replacedStyles.iterator(), (a) => {\r\n\t\t\tconst key = a[0];\r\n\t\t\tconst value = a[1];\r\n\t\t\t(<any>io.element.style)[key] = value;\r\n\t\t\tio.replacedStyles.removeKey(key);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes this object and cleans up after itself.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tif (!this.isDisposed()) {\r\n\t\t\tsuper.dispose();\r\n\t\t\tthis.restoreAllStyles(this.body);\r\n\t\t\tthis.unlockWheel();\r\n\t\t}\r\n\t}\r\n\r\n\t// @ts-ignore Used for debugging\r\n\tprivate log(text: string, ev: MouseEvent | TouchEvent | PointerEvent, io?: InteractionObject): void {\r\n\t\tlet show = true;\r\n\t\tif (show) {\r\n\t\t\t// Touchlist?\r\n\t\t\tif ((<any>ev).changedTouches) {\r\n\t\t\t\tfor (let i = 0; i < (<any>ev).changedTouches.length; i++) {\r\n\t\t\t\t\tthis.logTouch(text, ev.type, (<any>ev).changedTouches[i])\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Get type\r\n\t\t\tlet type = \"\";\r\n\t\t\tif ((<any>ev).pointerType) {\r\n\t\t\t\tswitch ((<any>ev).pointerType) {\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\ttype = \"touch\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\ttype = \"mouse\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\ttype = (<any>ev).pointerType;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (typeof TouchEvent != \"undefined\" && ev instanceof TouchEvent) {\r\n\t\t\t\ttype = \"touch\";\r\n\t\t\t}\r\n\t\t\telse if (ev.type.match(/^mouse/)) {\r\n\t\t\t\ttype = \"mouse\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttype = \"???\";\r\n\t\t\t}\r\n\r\n\t\t\t// Get ID\r\n\t\t\tlet id = \"\";\r\n\t\t\tif ($type.hasValue((<any>ev).identifier)) {\r\n\t\t\t\tid = <string>(<any>ev).identifier;\r\n\t\t\t} else if ($type.hasValue((<any>ev).pointerId)) {\r\n\t\t\t\tid = <string>(<any>ev).pointerId;\r\n\t\t\t} else {\r\n\t\t\t\tid = \"???\";\r\n\t\t\t}\r\n\r\n\t\t\tif (io) {\r\n\t\t\t\tconsole.log(text + \" (\" + io.uid + \")  \" + ev.type + \"  \" + type + \"  \" + id);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.log(text + \"  \" + ev.type + \"  \" + type + \"  \" + id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether there are currently any objects being transformed (dragged\r\n\t * or resized).\r\n\t *\r\n\t * If `except` is set, that object will be ignored.\r\n\t *\r\n\t * @since 4.9.3\r\n\t * @param   except  Ignore this object(s)\r\n\t * @return          Objects are being transformed\r\n\t */\r\n\tpublic areTransformed(except?: InteractionObject | InteractionObject[]): boolean {\r\n\t\tlet count = this.transformedObjects.length;\r\n\t\tif (except) {\r\n\t\t\tconst ex = $type.isArray(except) ? except : [except];\r\n\t\t\tfor (let i = 0; i < ex.length; i++) {\r\n\t\t\t\tif (this.transformedObjects.contains(ex[i])) {\r\n\t\t\t\t\tcount--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn count > 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Log.\r\n\t */\r\n\tprivate logTouch(text: string, type: string, ev: Touch): void {\r\n\t\tconsole.log(text + \"  \" + type + \"  \" + \"touch\" + \"  \" + ev.identifier);\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if passive mode options is supported by this browser.\r\n\t */\r\n\tprivate static _passiveSupported: boolean;\r\n\r\n\t/**\r\n\t * Indicates if passive mode options is supported by this browser.\r\n\t */\r\n\tstatic get passiveSupported() {\r\n\r\n\t\tif (this._passiveSupported == null) {\r\n\r\n\t\t\t// Check for passive mode support\r\n\t\t\ttry {\r\n\t\t\t\tlet options = Object.defineProperty({}, \"passive\", {\r\n\t\t\t\t\tget: () => {\r\n\t\t\t\t\t\tthis._passiveSupported = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\twindow.addEventListener(\"test\", options, options);\r\n\t\t\t\twindow.removeEventListener(\"test\", options, options);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tthis._passiveSupported = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this._passiveSupported;\r\n\t}\r\n\r\n}\r\n\r\n\r\nlet interaction: Interaction | null = null;\r\n\r\n/**\r\n * Returns a single unified global instance of [[Interaction]].\r\n *\r\n * All code should use this function, rather than create their own instances\r\n * of [[Interaction]].\r\n */\r\nexport function getInteraction(): Interaction {\r\n\tif (interaction == null) {\r\n\t\tinteraction = new Interaction();\r\n\t}\r\n\r\n\treturn interaction;\r\n}\r\n","/**\r\n * Responsive functionality module.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObjectEvents, IBaseObjectEvents } from \"../Base\";\r\nimport { Sprite, ISpriteProperties, ISpriteAdapters } from \"../Sprite\";\r\nimport { SpriteState } from \"../SpriteState\";\r\nimport { Container } from \"../Container\";\r\nimport { Component } from \"../Component\";\r\nimport { List } from \"../utils/List\";\r\nimport { Adapter } from \"../utils/Adapter\";\r\nimport { IDisposer } from \"../utils/Disposer\";\r\nimport { registry } from \"../Registry\";\r\nimport { Optional } from \"../utils/Type\";\r\nimport * as $iter from \"../utils/Iterator\";\r\nimport * as $array from \"../utils/Array\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $object from \"../utils/Object\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines an interface for the responsive rule, i.e. what overrides need to\r\n * be applied when certain conditions are matched.\r\n *\r\n * @important\r\n */\r\nexport interface IResponsiveRule {\r\n\r\n\t/**\r\n\t * A function which determines if this rule is relevant to current\r\n\t * conditions.\r\n\t *\r\n\t * Whenever the chrt size changes, this function will be run to determine\r\n\t * whether this rule needs to be applied.\r\n\t */\r\n\trelevant(target: Container): boolean;\r\n\r\n\t/**\r\n\t * A function which creates and returns a [[SpriteState]] that needs to be\r\n\t * set whenever rule should be applied.\r\n\t *\r\n\t * This is run only once.\r\n\t *\r\n\t * Once state is created, it is added to the Sprite's available states and\r\n\t * applied as necessary.\r\n\t */\r\n\tstate(target: Sprite, stateId: string): Optional<SpriteState<ISpriteProperties, ISpriteAdapters>>;\r\n\r\n\t/**\r\n\t * ID of the rule.\r\n\t */\r\n\tid?: string;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[Responsive]].\r\n */\r\nexport interface IResponsiveEvents extends IBaseObjectEvents {\r\n\r\n\t/**\r\n\t * Invoked when a list of applicable rules for the current resolution\r\n\t * changes.\r\n\t */\r\n\truleschanged: {},\r\n\r\n\t/**\r\n\t * Invoked after each rule is applied to the actual element.\r\n\t */\r\n\truleapplied: {\r\n\r\n\t\t/**\r\n\t\t * A rule that was just applied.\r\n\t\t */\r\n\t\t\"rule\": IResponsiveRule\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Defines adapters for [[Responsive]] class.\r\n *\r\n * Includes both the [[Adapter]] definitions and properties.\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IResponsiveAdapters {\r\n\r\n\t/**\r\n\t * Are responsive features enabled?\r\n\t */\r\n\tenabled: boolean;\r\n\r\n\t/**\r\n\t * Use default rules?\r\n\t *\r\n\t * If this is set `false`, only user-defined rules will be applied.\r\n\t */\r\n\tuseDefault: boolean;\r\n\r\n\t/**\r\n\t * A list of user-defined rules.\r\n\t */\r\n\trules: List<IResponsiveRule>;\r\n\r\n\t/**\r\n\t * A list of default rules.\r\n\t */\r\n\tdefaultRules: List<IResponsiveRule>;\r\n\r\n\t/**\r\n\t * A list of **all** rules - user-defined and default combined.\r\n\t */\r\n\tallRules: List<IResponsiveRule>;\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Responsive is responsible for overriding certain properties when conditions\r\n * are met.\r\n *\r\n * This class is used to dynamically apply and change certain chart properties\r\n * based on the current values of properties.\r\n *\r\n * Mainly, this is used with [[Sprite]]'s dimensional properties, like\r\n * `pixelWidth` and `pixelHeight`. However, it can be used to dynamically\r\n * change any property, based on any other property's value.\r\n *\r\n * A default responsive rules are disabled.\r\n *\r\n * To enable, set `enabled = false`. E.g.:\r\n *\r\n * ```TypeScript\r\n * chart.responsive.enabled = true;\r\n * ```\r\n * ```JavaScript\r\n * chart.responsive.enabled = true;\r\n * ```\r\n *\r\n * @see {@link IResponsiveEvents} for a list of available events\r\n * @see {@link IResponsiveAdapters} for a list of available Adapters\r\n * @todo Add default rules\r\n * @todo Watch for rule modification\r\n * @important\r\n */\r\nexport class Responsive extends BaseObjectEvents {\r\n\r\n\t/**\r\n\t * Holds a list of responsive rules organized by object type.\r\n\t */\r\n\tprotected _rules = new List<IResponsiveRule>();\r\n\r\n\t/**\r\n\t * Holds the list of the default responsive rules.\r\n\t * @deprecated\r\n\t */\r\n\t//protected _defaultRules = new List<IResponsiveRule>();\r\n\r\n\t/**\r\n\t * Holds the list of currently applied rules.\r\n\t */\r\n\tprotected _appliedRules: { [index: string]: boolean } = {};\r\n\r\n\t/**\r\n\t * Used to keep track of objects that have rules applied at the moment.\r\n\t */\r\n\tprotected _appliedTargets: string[] = [];\r\n\r\n\t/**\r\n\t * Use default rules in addition to the user-defined ones?\r\n\t */\r\n\tprotected _useDefault = true;\r\n\r\n\t/**\r\n\t * A target object responsive rules apply to.\r\n\t */\r\n\tprotected _component: $type.Optional<Component>;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IResponsiveEvents;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IResponsiveAdapters;\r\n\r\n\t/**\r\n\t * Adapter.\r\n\t */\r\n\tpublic adapter = new Adapter<this, IResponsiveAdapters>(this);\r\n\r\n\t/**\r\n\t * Indicates of responsive rules application is enabled.\r\n\t */\r\n\tprotected _enabled = false;\r\n\r\n\t/**\r\n\t * Holds disposers for all events added by this class.\r\n\t */\r\n\tprotected _responsiveDisposers: Array<IDisposer> = [];\r\n\r\n\t/**\r\n\t * Collection of objects and state ids that do not have any properties set.\r\n\t */\r\n\tprivate _noStates: string[] = [];\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"Responsive\";\r\n\r\n\t\t// Set up rules list events\r\n\t\tthis.rules.events.on(\"inserted\", () => { this.checkRules(); }, true);\r\n\t\tthis.rules.events.on(\"removed\", () => { this.checkRules(); }, true);\r\n\t\tthis._disposers.push(this.rules.events);\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * A target object that responsive rules will need to be applied to.\r\n\t *\r\n\t * @param value  Target object\r\n\t */\r\n\tpublic set component(value: $type.Optional<Component>) {\r\n\r\n\t\t// Check if it's the same\r\n\t\tif (value == this._component) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Check if we already have a set up component and remove its events\r\n\t\tthis.disposeResponsiveHandlers();\r\n\r\n\t\t// Set\r\n\t\tthis._component = value;\r\n\r\n\t\t// Set up resize monitoring events\r\n\t\tthis._responsiveDisposers.push($type.getValue(this.component).events.on(\"sizechanged\", () => { this.checkRules(); }, this));\r\n\t\tthis._responsiveDisposers.push($type.getValue(this.component).events.on(\"datavalidated\", () => {\r\n\t\t\tif (this._component.isReady()) {\r\n\t\t\t\tthis.checkRules(true);\r\n\t\t\t}\r\n\t\t}, this));\r\n\r\n\t\t// Enable resoponsive\r\n\t\tthis.enabled = true;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @return Target object\r\n\t */\r\n\tpublic get component(): $type.Optional<Component> {\r\n\t\treturn this._component;\r\n\t}\r\n\r\n\t/**\r\n\t * Should responsive rules be checked against and applied?\r\n\t *\r\n\t * @default false\r\n\t * @param value  Apply responsive rules?\r\n\t */\r\n\tpublic set enabled(value: boolean) {\r\n\t\tif (this._enabled != value) {\r\n\t\t\tthis._enabled = value;\r\n\r\n\t\t\t// Run `applyRules` so that any currently applied rules can be reset\r\n\t\t\tthis.applyRules();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Apply responsive rules?\r\n\t */\r\n\tpublic get enabled(): boolean {\r\n\t\treturn this.adapter.apply(\"enabled\", this._enabled);\r\n\t}\r\n\r\n\t/**\r\n\t * Should default responsive rules be applied in addition to user-defined\r\n\t * ones.\r\n\t *\r\n\t * User-defined rules will take precedence over default rules whenever they\r\n\t * produce conflicting settings.\r\n\t *\r\n\t * @default true\r\n\t * @param value  Use default rules?\r\n\t */\r\n\tpublic set useDefault(value: boolean) {\r\n\t\tif (this._useDefault != value) {\r\n\t\t\tthis._useDefault = value;\r\n\r\n\t\t\t// Run `applyRules` so that any currently applied rules can be reset\r\n\t\t\tthis.applyRules();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Use default rules?\r\n\t */\r\n\tpublic get useDefault(): boolean {\r\n\t\treturn this.adapter.apply(\"useDefault\", this._useDefault);\r\n\t}\r\n\r\n\t/**\r\n\t * User-defined responsive rules.\r\n\t *\r\n\t * User-defined rules will take precedence over default rules whenever they\r\n\t * produce conflicting settings.\r\n\t *\r\n\t * Use `allRules` to get all applicable rules including default and\r\n\t * user-defined ones.\r\n\t *\r\n\t * @param value  User-defined rules\r\n\t */\r\n\tpublic set rules(value: List<IResponsiveRule>) {\r\n\t\tthis._rules = value;\r\n\t\tthis._enabled = true;\r\n\t\tthis.applyRules();\r\n\t}\r\n\r\n\t/**\r\n\t * @return User-defined rules\r\n\t */\r\n\tpublic get rules(): List<IResponsiveRule> {\r\n\t\treturn this.adapter.apply(\"rules\", this._rules);\r\n\t}\r\n\r\n\t/**\r\n\t * Default responsive rules.\r\n\t *\r\n\t * @readonly\r\n\t * @return List of responsive rules\r\n\t */\r\n\tpublic get defaultRules(): List<IResponsiveRule> {\r\n\t\treturn this.adapter.apply(\"defaultRules\", defaultRules);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns all rules: default rules (if not disabled) combined with\r\n\t * user-defined ones.\r\n\t *\r\n\t * @readonly\r\n\t * @return List of all applicable rules\r\n\t */\r\n\tpublic get allRules(): List<IResponsiveRule> {\r\n\r\n\t\t// Create empty list\r\n\t\tlet rules = new List<IResponsiveRule>();\r\n\r\n\t\t// Add default rules if not disabled\r\n\t\t// A code, requesting `allRules` must ensure loading of default rules\r\n\t\t// by calling `loadDefaultRules()`\r\n\t\tif (this.useDefault) {\r\n\t\t\trules.copyFrom(this.defaultRules);\r\n\t\t}\r\n\r\n\t\t// Add user-defined ones\r\n\t\trules.copyFrom(this.rules);\r\n\r\n\t\treturn this.adapter.apply(\"allRules\", rules);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if rule by the particular id currently applied.\r\n\t *\r\n\t * @param ruleId  Rule ID\r\n\t * @return Is currently applied?\r\n\t */\r\n\tprotected isApplied(ruleId: string): boolean {\r\n\t\tconst rule = this._appliedRules[ruleId];\r\n\t\treturn $type.hasValue(rule) ? rule : false;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks which responsive rules currently satisfy their conditions and\r\n\t * should be applied, or unapplied.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic checkRules(force: boolean = false): void {\r\n\r\n\t\t// Check if there are any rules\r\n\t\tlet rules = this.allRules;\r\n\t\tif (!rules || rules.length == 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Init a list of rules to be applied\r\n\t\tlet rulesChanged: boolean = false;\r\n\r\n\t\tconst component = $type.getValue(this.component);\r\n\r\n\t\t// Check which rules match\r\n\t\t$iter.each(rules.iterator(), (rule) => {\r\n\r\n\t\t\t// Check if rule has an id\r\n\t\t\tif (!rule.id) {\r\n\t\t\t\trule.id = registry.getUniqueId();\r\n\t\t\t}\r\n\r\n\t\t\t// Init indicator if this rule should be applied\r\n\t\t\tlet apply = rule.relevant(component);\r\n\r\n\t\t\t// Let's check if this rule needs to be applied\r\n\t\t\tif ((apply && !this.isApplied(rule.id)) || (!apply && this.isApplied(rule.id))) {\r\n\t\t\t\trulesChanged = true;\r\n\t\t\t}\r\n\t\t\tthis._appliedRules[rule.id] = apply;\r\n\t\t});\r\n\r\n\t\tif (force) {\r\n\t\t\trulesChanged = true;\r\n\t\t}\r\n\r\n\t\t// Check if we need to re-apply the rules\r\n\t\tif (rulesChanged) {\r\n\r\n\t\t\tif (!this.component.isReady()) {\r\n\t\t\t\t// The chart is not yet ready (built)\r\n\t\t\t\t// We will hide the chart and delay application of rules\r\n\t\t\t\t// until \"ready\" event kicks in\r\n\t\t\t\t//component.hide(0);\r\n\t\t\t\tcomponent.hidden = true;\r\n\t\t\t\tcomponent.events.once(\"ready\", (ev) => {\r\n\t\t\t\t\tev.target.show(0);\r\n\t\t\t\t\tthis.applyRules();\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.dispatchImmediately(\"ruleschanged\");\r\n\t\t\tthis.applyRules();\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Applies current rules to the object.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param target Target object\r\n\t * @todo Better type check\r\n\t */\r\n\tpublic applyRules(target?: Container): void {\r\n\t\t// If no target supplied, we assume the top-level element\r\n\t\tconst newTarget = ($type.hasValue(target)\r\n\t\t\t? target\r\n\t\t\t: $type.getValue(this.component));\r\n\t\t// Check each rule\r\n\t\tlet defaultStateApplied = false;\r\n\t\tif (this.enabled) {\r\n\t\t\tlet isApplied = false;\r\n\t\t\t$iter.each(this.allRules.iterator(), (rule) => {\r\n\r\n\t\t\t\t// Get relevant state\r\n\t\t\t\tlet state = this.getState(rule, newTarget);\r\n\r\n\t\t\t\t// If there's a state, it means it needs to be applied\r\n\t\t\t\tif (state) {\r\n\r\n\t\t\t\t\t// Check if default state was already applied to this element.\r\n\t\t\t\t\t// We don't want to go resetting default states to ALL element,\r\n\t\t\t\t\t// if they don't have responsive states.\r\n\t\t\t\t\tif (!defaultStateApplied) {\r\n\t\t\t\t\t\t// Nope, reset states (instantly).\r\n\t\t\t\t\t\tif ($array.indexOf(this._appliedTargets, newTarget.uid) !== -1) {\r\n\t\t\t\t\t\t\t// But only if this element has any rules applied, otherwise no\r\n\t\t\t\t\t\t\t// point in setting current state\r\n\t\t\t\t\t\t\tnewTarget.setState(this.getDefaultState(newTarget), 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdefaultStateApplied = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Is this rule currently applied?\r\n\t\t\t\t\tif (this.isApplied($type.getValue(rule.id))) {\r\n\t\t\t\t\t\t// Yes. Apply the responsive state\r\n\t\t\t\t\t\tstate.transitionDuration = 0;\r\n\t\t\t\t\t\tthis.setTargetState(newTarget, state);\r\n\t\t\t\t\t\tthis.dispatchImmediately(\"ruleapplied\", {\r\n\t\t\t\t\t\t\trule: rule\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tisApplied = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (isApplied) {\r\n\t\t\t\t$array.replace(this._appliedTargets, newTarget.uid);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t$array.remove(this._appliedTargets, newTarget.uid);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Apply rules to the children\r\n\t\tif (newTarget.children) {\r\n\t\t\t$iter.each(newTarget.children.iterator(), (child) => {\r\n\t\t\t\tthis.applyRules(child as Container);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a relative state for the rule/target, or `undefined` if no state is\r\n\t * needed.\r\n\t *\r\n\t * @param rule    [description]\r\n\t * @param target  [description]\r\n\t * @return [description]\r\n\t */\r\n\tprotected getState(rule: IResponsiveRule, target: any): Optional<SpriteState<any, any>> {\r\n\t\tlet stateId = \"responsive-\" + rule.id;\r\n\t\tlet tmpId = target.uid + \"_\" + stateId;\r\n\t\tif ($array.indexOf(this._noStates, tmpId) !== -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\telse if (!target.states.hasKey(stateId)) {\r\n\t\t\tlet state = rule.state(target, stateId);\r\n\t\t\tif (!state) {\r\n\t\t\t\tthis._noStates.push(tmpId);\r\n\t\t\t}\r\n\t\t\treturn state;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn target.states.getKey(stateId);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns default responsive rule for the target.\r\n\t * \r\n\t * This rule will be used to \"reset\" to non-responsive values.\r\n\t * @param   target  Target Sprite\r\n\t * @return          State\r\n\t */\r\n\tprotected getDefaultState(target: any): SpriteState<any, any> {\r\n\t\tif (target.states.hasKey(\"responsive-default\")) {\r\n\t\t\treturn target.states.getKey(\"responsive-default\");\r\n\t\t}\r\n\t\treturn target.states.create(\"responsive-default\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets state on the target element and updates default state with the\r\n\t * overwritten values if needed.\r\n\t * \r\n\t * @param  target  Target\r\n\t * @param  state   State\r\n\t */\r\n\tprotected setTargetState(target: any, state: SpriteState<any, any>): void {\r\n\t\t// Update default state\r\n\t\tconst defaultState = this.getDefaultState(target);\r\n\t\t$object.each(state.properties, (key, val) => {\r\n\t\t\tif (!$type.hasValue(defaultState.properties[key])) {\r\n\t\t\t\tdefaultState.properties[key] = this.getValue(target, key);\r\n\t\t\t}\r\n\t\t});\r\n\t\ttarget.setState(state);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets a value from an element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param target    Target object\r\n\t * @param property  Property\r\n\t * @return Property value\r\n\t */\r\n\tpublic getValue(target: any, property: string): any {\r\n\t\t// This is a bit hacky, first we check if the property exist.\r\n\t\t// If it doesn't we try accessing target's property directly\r\n\t\tlet value: any = target.getPropertyValue(property);\r\n\t\tif (!$type.hasValue(value) && $type.hasValue(target[property])) {\r\n\t\t\tvalue = target[property];\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes the object.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tthis.disposeResponsiveHandlers();\r\n\t\tsuper.dispose();\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes all event handlers.\r\n\t */\r\n\tprotected disposeResponsiveHandlers(): void {\r\n\t\tlet disposer = this._responsiveDisposers.pop();\r\n\t\twhile (disposer) {\r\n\t\t\tdisposer.dispose();\r\n\t\t\tdisposer = this._responsiveDisposers.pop();\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * [defaultRules description]\r\n *\r\n * @todo description\r\n */\r\nexport let defaultRules = new List<IResponsiveRule>();\r\ndefaultRules.events.on(\"inserted\", (ev) => {\r\n\tev.newValue.id = registry.getUniqueId();\r\n});\r\n\r\n/**\r\n *\r\n * @todo description\r\n */\r\nexport class ResponsiveBreakpoints {\r\n\r\n\t// Named pixel breakpoints\r\n\tstatic XXS = 100;\r\n\tstatic XS = 200;\r\n\tstatic S = 300;\r\n\tstatic M = 400;\r\n\tstatic L = 600;\r\n\tstatic XL = 800;\r\n\tstatic XXL = 1000;\r\n\r\n\t// Breakpoint functions (for use in `relevant` clause of the responsive rules)\r\n\r\n\tstatic widthXXS(container: Container): boolean {\r\n\t\treturn container.pixelWidth <= ResponsiveBreakpoints.XXS;\r\n\t}\r\n\r\n\tstatic widthXS(container: Container): boolean {\r\n\t\treturn container.pixelWidth <= ResponsiveBreakpoints.XS;\r\n\t}\r\n\r\n\tstatic widthS(container: Container): boolean {\r\n\t\treturn container.pixelWidth <= ResponsiveBreakpoints.S;\r\n\t}\r\n\r\n\tstatic widthM(container: Container): boolean {\r\n\t\treturn container.pixelWidth <= ResponsiveBreakpoints.M;\r\n\t}\r\n\r\n\tstatic widthL(container: Container): boolean {\r\n\t\treturn container.pixelWidth <= ResponsiveBreakpoints.L;\r\n\t}\r\n\r\n\tstatic widthXL(container: Container): boolean {\r\n\t\treturn container.pixelWidth <= ResponsiveBreakpoints.XL;\r\n\t}\r\n\r\n\tstatic widthXXL(container: Container): boolean {\r\n\t\treturn container.pixelWidth <= ResponsiveBreakpoints.XXL;\r\n\t}\r\n\r\n\r\n\tstatic heightXXS(container: Container): boolean {\r\n\t\treturn container.pixelHeight <= ResponsiveBreakpoints.XXS;\r\n\t}\r\n\r\n\tstatic heightXS(container: Container): boolean {\r\n\t\treturn container.pixelHeight <= ResponsiveBreakpoints.XS;\r\n\t}\r\n\r\n\tstatic heightS(container: Container): boolean {\r\n\t\treturn container.pixelHeight <= ResponsiveBreakpoints.S;\r\n\t}\r\n\r\n\tstatic heightM(container: Container): boolean {\r\n\t\treturn container.pixelHeight <= ResponsiveBreakpoints.M;\r\n\t}\r\n\r\n\tstatic heightL(container: Container): boolean {\r\n\t\treturn container.pixelHeight <= ResponsiveBreakpoints.L;\r\n\t}\r\n\r\n\tstatic heightXL(container: Container): boolean {\r\n\t\treturn container.pixelHeight <= ResponsiveBreakpoints.XL;\r\n\t}\r\n\r\n\tstatic heightXXL(container: Container): boolean {\r\n\t\treturn container.pixelHeight <= ResponsiveBreakpoints.XXL;\r\n\t}\r\n\r\n\r\n\tstatic isXXS(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.XXS) && (container.pixelHeight <= ResponsiveBreakpoints.XXS);\r\n\t}\r\n\r\n\tstatic isXS(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.XS) && (container.pixelHeight <= ResponsiveBreakpoints.XS);\r\n\t}\r\n\r\n\tstatic isS(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.S) && (container.pixelHeight <= ResponsiveBreakpoints.S);\r\n\t}\r\n\r\n\tstatic isM(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.M) && (container.pixelHeight <= ResponsiveBreakpoints.M);\r\n\t}\r\n\r\n\tstatic isL(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.L) && (container.pixelHeight <= ResponsiveBreakpoints.L);\r\n\t}\r\n\r\n\tstatic isXL(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.XL) && (container.pixelHeight <= ResponsiveBreakpoints.XL);\r\n\t}\r\n\r\n\tstatic isXXL(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.XXL) && (container.pixelHeight <= ResponsiveBreakpoints.XXL);\r\n\t}\r\n\r\n\r\n\tstatic maybeXXS(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.XXS) || (container.pixelHeight <= ResponsiveBreakpoints.XXS);\r\n\t}\r\n\r\n\tstatic maybeXS(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.XS) || (container.pixelHeight <= ResponsiveBreakpoints.XS);\r\n\t}\r\n\r\n\tstatic maybeS(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.S) || (container.pixelHeight <= ResponsiveBreakpoints.S);\r\n\t}\r\n\r\n\tstatic maybeM(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.M) || (container.pixelHeight <= ResponsiveBreakpoints.M);\r\n\t}\r\n\r\n\tstatic maybeL(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.L) || (container.pixelHeight <= ResponsiveBreakpoints.L);\r\n\t}\r\n\r\n\tstatic maybeXL(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.XL) || (container.pixelHeight <= ResponsiveBreakpoints.XL);\r\n\t}\r\n\r\n\tstatic maybeXXL(container: Container): boolean {\r\n\t\treturn (container.pixelWidth <= ResponsiveBreakpoints.XXL) || (container.pixelHeight <= ResponsiveBreakpoints.XXL);\r\n\t}\r\n}\r\n","/**\r\n * A collection of easing functions\r\n *\r\n * Parts of this collection are taken from D3.js library (https://d3js.org/)\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport * as $math from \"../utils/Math\";\r\nimport { registry } from \"../Registry\";\r\n\r\n/**\r\n * The functions below are from D3.js library (https://d3js.org/)\r\n *\r\n * ----------------------------------------------------------------------------\r\n * Copyright 2017 Mike Bostock\r\n *\r\n * Redistribution and use in source and binary forms, with or without\r\n * modification, are permitted provided that the following conditions are met:\r\n *\r\n * 1. Redistributions of source code must retain the above copyright notice,\r\n *    this list of conditions and the following disclaimer.\r\n *\r\n * 2. Redistributions in binary form must reproduce the above copyright notice,\r\n *    this list of conditions and the following disclaimer in the documentation\r\n *    and/or other materials provided with the distribution.\r\n *\r\n * 3. Neither the name of the copyright holder nor the names of its\r\n *    contributors may be used to endorse or promote products derived from this\r\n *    software without specific prior written permission.\r\n *\r\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\r\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\r\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\r\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\r\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\r\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\r\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\r\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n * POSSIBILITY OF SUCH DAMAGE.\r\n * ----------------------------------------------------------------------------\r\n * @hidden\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * LINEAR FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Easing function: \"linear\".\r\n */\r\nexport function linear(t: number): number {\r\n\treturn +t;\r\n}\r\nregistry.registeredClasses[\"ease.linear\"] = linear;\r\n\r\n/**\r\n * Easing function: \"quadIn\".\r\n */\r\nexport function quadIn(t: number): number {\r\n\treturn t * t;\r\n}\r\nregistry.registeredClasses[\"ease.quadIn\"] = quadIn;\r\n\r\n/**\r\n * Easing function: \"quadOut\".\r\n */\r\nexport function quadOut(t: number): number {\r\n\treturn t * (2 - t);\r\n}\r\nregistry.registeredClasses[\"ease.quadOut\"] = quadOut;\r\n\r\n/**\r\n * Easing function: \"quadInOut\".\r\n */\r\nexport function quadInOut(t: number): number {\r\n\tt *= 2;\r\n\treturn (t <= 1 ? t * t : --t * (2 - t) + 1) / 2;\r\n}\r\nregistry.registeredClasses[\"ease.quadInOut\"] = quadInOut;\r\n\r\n/**\r\n * Easing function: \"polyIn\".\r\n */\r\nexport function polyIn(t: number, e: number): number {\r\n\treturn Math.pow(t, e);\r\n}\r\nregistry.registeredClasses[\"ease.polyIn\"] = polyIn;\r\n\r\n/**\r\n * Easing function: \"polyOut\".\r\n */\r\nexport function polyOut(t: number, e: number): number {\r\n\treturn 1 - Math.pow(1 - t, e);\r\n}\r\nregistry.registeredClasses[\"ease.polyOut\"] = polyOut;\r\n\r\n/**\r\n * Easing function: \"polyInOut\".\r\n */\r\nexport function polyInOut(t: number, e: number): number {\r\n\tt *= 2;\r\n\treturn (t <= 1 ? Math.pow(t, e) : 2 - Math.pow(2 - t, e)) / 2;\r\n}\r\nregistry.registeredClasses[\"ease.polyInOut\"] = polyInOut;\r\n\r\n/**\r\n * Easing function: \"polyIn3\".\r\n */\r\nexport function polyIn3(t: number): number {\r\n\treturn polyIn(t, 3);\r\n}\r\nregistry.registeredClasses[\"ease.polyIn3\"] = polyIn3;\r\n\r\n/**\r\n * Easing function: \"polyOut3\".\r\n */\r\nexport function polyOut3(t: number): number {\r\n\treturn polyOut(t, 3);\r\n}\r\nregistry.registeredClasses[\"ease.polyOut3\"] = polyOut3;\r\n\r\n/**\r\n * Easing function: \"polyInOut3\".\r\n */\r\nexport function polyInOut3(t: number): number {\r\n\treturn polyInOut(t, 3);\r\n}\r\nregistry.registeredClasses[\"ease.polyInOut3\"] = polyInOut3;\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * EXPONENTIAL FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Easing function: \"expIn\".\r\n */\r\nexport function expIn(t: number): number {\r\n\treturn Math.pow(2, 10 * t - 10);\r\n}\r\nregistry.registeredClasses[\"ease.expIn\"] = expIn;\r\n\r\n/**\r\n * Easing function: \"expOut\".\r\n */\r\nexport function expOut(t: number): number {\r\n\treturn 1 - Math.pow(2, -10 * t);\r\n}\r\nregistry.registeredClasses[\"ease.expOut\"] = expOut;\r\n\r\n/**\r\n * Easing function: \"expInOut\".\r\n */\r\nexport function expInOut(t: number): number {\r\n\tt *= 2;\r\n\treturn (t <= 1 ? Math.pow(2, 10 * t - 10) : 2 - Math.pow(2, 10 - 10 * t)) / 2;\r\n}\r\nregistry.registeredClasses[\"ease.expInOut\"] = expInOut;\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * SINE FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Easing function: \"sinIn\".\r\n */\r\nexport function sinIn(t: number): number {\r\n\treturn 1 - Math.cos(t * $math.HALFPI);\r\n}\r\nregistry.registeredClasses[\"ease.sinIn\"] = sinIn;\r\n\r\n/**\r\n * Easing function: \"sinOut\".\r\n */\r\nexport function sinOut(t: number): number {\r\n\treturn Math.sin(t * $math.HALFPI);\r\n}\r\nregistry.registeredClasses[\"ease.sinOut\"] = sinOut;\r\n\r\n/**\r\n * Easing function: \"sinInOut\".\r\n */\r\nexport function sinInOut(t: number): number {\r\n\treturn (1 - Math.cos($math.PI * t)) / 2;\r\n}\r\nregistry.registeredClasses[\"ease.sinInOut\"] = sinInOut;\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * CUBIC FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Easing function: \"cubicIn\".\r\n */\r\nexport function cubicIn(t: number): number {\r\n\treturn t * t * t;\r\n}\r\nregistry.registeredClasses[\"ease.cubicIn\"] = cubicIn;\r\n\r\n/**\r\n * Easing function: \"cubicOut\".\r\n */\r\nexport function cubicOut(t: number): number {\r\n\treturn --t * t * t + 1;\r\n}\r\nregistry.registeredClasses[\"ease.cubicOut\"] = cubicOut;\r\n\r\n/**\r\n * Easing function: \"cubicInOut\".\r\n */\r\nexport function cubicInOut(t: number): number {\r\n\tt *= 2;\r\n\treturn (t <= 1 ? t * t * t : (t -= 2) * t * t + 2) / 2;\r\n}\r\nregistry.registeredClasses[\"ease.cubicInOut\"] = cubicInOut;\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * CIRCLE FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Easing function: \"circleIn\".\r\n */\r\nexport function circleIn(t: number): number {\r\n\treturn 1 - Math.sqrt(1 - t * t);\r\n}\r\nregistry.registeredClasses[\"ease.circleIn\"] = circleIn;\r\n\r\n/**\r\n * Easing function: \"circleOut\".\r\n */\r\nexport function circleOut(t: number): number {\r\n\treturn Math.sqrt(1 - --t * t);\r\n}\r\nregistry.registeredClasses[\"ease.circleOut\"] = circleOut;\r\n\r\n/**\r\n * Easing function: \"circleInOut\".\r\n */\r\nexport function circleInOut(t: number): number {\r\n\tt *= 2;\r\n\treturn (t <= 1 ? 1 - Math.sqrt(1 - t * t) : Math.sqrt(1 - (t -= 2) * t) + 1) / 2;\r\n}\r\nregistry.registeredClasses[\"ease.circleInOut\"] = circleInOut;\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * BOUNCE FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nlet b1 = 4 / 11,\r\n\tb2 = 6 / 11,\r\n\tb3 = 8 / 11,\r\n\tb4 = 3 / 4,\r\n\tb5 = 9 / 11,\r\n\tb6 = 10 / 11,\r\n\tb7 = 15 / 16,\r\n\tb8 = 21 / 22,\r\n\tb9 = 63 / 64,\r\n\tb0 = 1 / b1 / b1;\r\n\r\n/**\r\n * Easing function: \"bounceIn\".\r\n */\r\nexport function bounceIn(t: number): number {\r\n\treturn 1 - bounceOut(1 - t);\r\n}\r\nregistry.registeredClasses[\"ease.bounceIn\"] = bounceIn;\r\n\r\n/**\r\n * Easing function: \"bounceOut\".\r\n */\r\nexport function bounceOut(t: number): number {\r\n\tt = +t;\r\n\treturn t < b1 ? b0 * t * t : t < b3 ? b0 * (t -= b2) * t + b4 : t < b6 ? b0 * (t -= b5) * t + b7 : b0 * (t -= b8) * t + b9;\r\n}\r\nregistry.registeredClasses[\"ease.bounceOut\"] = bounceOut;\r\n\r\n/**\r\n * Easing function: \"bounceInOut\".\r\n */\r\nexport function bounceInOut(t: number): number {\r\n\tt *= 2;\r\n\treturn (t <= 1 ? 1 - bounceOut(1 - t) : bounceOut(t - 1) + 1) / 2;\r\n}\r\nregistry.registeredClasses[\"ease.bounceInOut\"] = bounceInOut;\r\n\r\n/**\r\n * ============================================================================\r\n * ELASTIC FUNCTIONS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nlet tau = 2 * Math.PI;\r\nlet amplitude = 1;\r\nlet period = 0.3 / tau;\r\nlet s = Math.asin(1 / amplitude) * period;\r\n\r\n/**\r\n * Easing function: \"elasticIn\".\r\n *\r\n * @function elasticIn\r\n * @param a  Amplitude\r\n * @param p  period\r\n */\r\nexport function elasticIn(t: number): number {\r\n\treturn amplitude * Math.pow(2, 10 * --t) * Math.sin((s - t) / period);\r\n}\r\nregistry.registeredClasses[\"ease.elasticIn\"] = elasticIn;\r\n\r\n/**\r\n * Easing function: \"elasticOut\".\r\n *\r\n * @function elasticOut\r\n * @param a  Amplitude\r\n * @param p  period\r\n */\r\nexport function elasticOut(t: number): number {\r\n\treturn 1 - amplitude * Math.pow(2, -10 * (t = +t)) * Math.sin((t + s) / period);\r\n}\r\nregistry.registeredClasses[\"ease.elasticOut\"] = elasticOut;\r\n\r\n/**\r\n * Easing function: \"elasticInOut\".\r\n *\r\n * @function elasticInOut\r\n * @param a  Amplitude\r\n * @param p  period\r\n */\r\nexport function elasticInOut(t: number): number {\r\n\tt = t * 2 - 1;\r\n\treturn (t < 0\r\n\t\t? amplitude * Math.pow(2, 10 * t) * Math.sin((s - t) / period)\r\n\t\t: 2 - amplitude * Math.pow(2, -10 * t) * Math.sin((s + t) / period)) / 2;\r\n}\r\nregistry.registeredClasses[\"ease.elasticInOut\"] = elasticInOut;\r\n","/**\r\n * Animation module.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObjectEvents, IBaseObjectEvents } from \"../Base\";\r\nimport { AMEvent } from \"../utils/EventDispatcher\";\r\nimport { SVGDefaults } from \"../defs/SVGDefaults\";\r\nimport { Disposer, IDisposer } from \"../utils/Disposer\";\r\nimport { Color } from \"../utils/Color\";\r\nimport { Percent, percent } from \"../utils/Percent\";\r\nimport * as $async from \"../utils/AsyncPending\";\r\nimport * as $ease from \"../utils/Ease\";\r\nimport * as $colors from \"../utils/Colors\";\r\nimport * as $math from \"../utils/Math\";\r\nimport * as $array from \"../utils/Array\";\r\nimport * as $type from \"../utils/Type\";\r\nimport { system } from \"../System\";\r\nimport { options } from \"../Options\";\r\n\r\n\r\n/**\r\n * Defines interface for animation objects.\r\n *\r\n * Should at least contain `update()` method.\r\n */\r\nexport interface IAnimationObject {\r\n\tupdate: () => void\r\n}\r\n\r\n/**\r\n * Defines interface for objects that can be animated\r\n */\r\nexport interface IAnimatable {\r\n\tanimations: Array<Animation>;\r\n}\r\n\r\n\r\nexport type IAnimationOption = Color | Percent | number | string | boolean;\r\n\r\n/**\r\n * Defines interface for animation options.\r\n */\r\nexport interface IAnimationOptions {\r\n\r\n\t/**\r\n\t * An initial value to animate from.\r\n\t *\r\n\t * If omitted, the source value will be current value.\r\n\t */\r\n\tfrom?: IAnimationOption;\r\n\r\n\t/**\r\n\t * A target value to animate from.\r\n\t */\r\n\tto: IAnimationOption;\r\n\r\n\t/**\r\n\t * Property name to animate.\r\n\t */\r\n\tproperty?: any;\r\n\r\n\t/**\r\n\t * If current values should be taken from different object than the target\r\n\t * element of the animation, this property should be set to that object.\r\n\t */\r\n\tchildObject?: { [index: string]: any };\r\n\r\n\t/**\r\n\t * A method/function reference that will be called to for updating the\r\n\t * property value.\r\n\t */\r\n\tupdateMethod?(progress: number, from: IAnimationOption, to: IAnimationOption): IAnimationOption;\r\n\r\n\r\n\t/**\r\n\t * sometimes we need to pass some dummy data in animationOptions\r\n\t */\r\n\tdummyData?: any;\r\n\r\n}\r\n\r\n/**\r\n * An interface for an object defining [[Percent]] animation.\r\n */\r\nexport interface IPercentAnimationOptions extends IAnimationOptions {\r\n\r\n\t/**\r\n\t * Initial value.\r\n\t */\r\n\tfrom?: Percent;\r\n\r\n\t/**\r\n\t * Target value.\r\n\t */\r\n\tto: Percent;\r\n\r\n}\r\n\r\n/**\r\n * An interface for an object defining [[Color]] animation.\r\n */\r\nexport interface IColorAnimationOptions extends IAnimationOptions {\r\n\r\n\t/**\r\n\t * Initial value.\r\n\t */\r\n\tfrom?: Color;\r\n\r\n\t/**\r\n\t * Target value.\r\n\t */\r\n\tto: Color;\r\n\r\n}\r\n\r\n\r\n/**\r\n * Calls a `callback` function for the `duration` of milliseconds.\r\n *\r\n * @todo Needed?\r\n * @deprecated Not used anywhere\r\n * @ignore Exclude from docs\r\n * @param duration  Duration (ms)\r\n * @param callback  Callback function\r\n * @return Disposer\r\n */\r\nexport function animate(duration: number, callback: (time: number) => void): IDisposer {\r\n\tlet disposed = false;\r\n\r\n\t// TODO use performance.now() ?\r\n\tconst startTime = Date.now();\r\n\r\n\tfunction loop(now: number): void {\r\n\t\tif (!disposed) {\r\n\t\t\tconst diff = now - startTime;\r\n\r\n\t\t\tif (diff >= duration) {\r\n\t\t\t\tcallback(1);\r\n\r\n\t\t\t} else {\r\n\t\t\t\t$async.nextFrame(loop);\r\n\t\t\t\tcallback(diff / duration);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t$async.nextFrame(loop);\r\n\r\n\treturn new Disposer(() => {\r\n\t\tdisposed = true;\r\n\t});\r\n}\r\n\r\n\r\n/**\r\n * Defines events for [[Animation]].\r\n */\r\nexport interface IAnimationEvents extends IBaseObjectEvents {\r\n\r\n\t/**\r\n\t * Invoked when animation starts playing.\r\n\t */\r\n\tanimationstarted: {\r\n\t\tprogress: number;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when animation finishes playing.\r\n\t */\r\n\tanimationended: {\r\n\t\tprogress: number;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when animation makes progress.\r\n\t */\r\n\tanimationprogress: {\r\n\t\tprogress: number;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when animation is stopped by some other process, before it had\r\n\t * a chance to finish.\r\n\t */\r\n\tanimationstopped: {\r\n\t\tprogress: number;\r\n\t};\r\n\r\n}\r\n\r\n\r\n/**\r\n * Returns numeric value accoring to progress between start and end values.\r\n *\r\n * @param progress  Progress (0-1)\r\n * @param from\r\n * @param to\r\n * @return Value according to progress\r\n */\r\nfunction getProgressNumber(progress: number, from: number, to: number): number {\r\n\treturn from + ((to - from) * progress);\r\n}\r\n\r\n/**\r\n * Returns [[Percent]] value accoring to progress between start and end\r\n * values.\r\n *\r\n * @param progress  Progress (0-1)\r\n * @param from\r\n * @param to\r\n * @return Value according to progress\r\n */\r\nfunction getProgressPercent(progress: number, from: Percent, to: Percent): Percent {\r\n\treturn new Percent(getProgressNumber(progress, from.percent, to.percent));\r\n}\r\n\r\n/**\r\n * Returns color value accoring to progress between start and end values.\r\n *\r\n * @param progress  Progress (0-1)\r\n * @param from\r\n * @param to\r\n * @return Color according to progress\r\n */\r\nfunction getProgressColor(progress: number, from: Color, to: Color): Color {\r\n\tconst color = new Color($colors.interpolate(from.rgb, to.rgb, progress));\r\n\tif (from.alpha != to.alpha) {\r\n\t\tcolor.alpha = from.alpha + (to.alpha - from.alpha) * progress;\r\n\t}\r\n\treturn color;\r\n}\r\n\r\n/**\r\n * [getHybridProperty description]\r\n *\r\n * @todo Description\r\n * @param property [description]\r\n * @param type [description]\r\n * @return [description]\r\n */\r\nfunction getHybridProperty(property: string, type: \"pixel\" | \"relative\"): string {\r\n\treturn type + property.charAt(0).toUpperCase() + property.substr(1);\r\n}\r\n\r\n\r\nexport class AnimationDisposer implements IDisposer {\r\n\tprivate _disposer: Disposer;\r\n\r\n\tconstructor(array: Array<Animation>) {\r\n\t\tthis._disposer = new Disposer(() => {\r\n\t\t\twhile (array.length !== 0) {\r\n\t\t\t\tarray[0].dispose();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tisDisposed(): boolean {\r\n\t\treturn this._disposer.isDisposed();\r\n\t}\r\n\r\n\tdispose(): void {\r\n\t\tthis._disposer.dispose();\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * Animation can be used to transition certain properties on an object that\r\n * implements [[IAnimatable]] interface.\r\n *\r\n * @see {@link IAnimationEvents} for a list of available events\r\n */\r\nexport class Animation extends BaseObjectEvents implements IAnimationObject {\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IAnimationEvents;\r\n\r\n\t/**\r\n\t * An animation target object. [[Animation]] will update properties of\r\n\t * this object.\r\n\t */\r\n\tpublic object: IAnimatable;\r\n\r\n\t/**\r\n\t * An array of animation option objects. Each animation object represent\r\n\t * one property. Animation can animate any number of properties\r\n\t * simultaneously.\r\n\t */\r\n\tpublic animationOptions: IAnimationOptions[];\r\n\r\n\t/**\r\n\t * Duration of the animation in milliseconds.\r\n\t */\r\n\tpublic duration: number = 0;\r\n\r\n\t/**\r\n\t * Easing function to use.\r\n\t *\r\n\t * @see {@link Ease}\r\n\t */\r\n\tpublic easing: (value: number) => number = $ease.linear;\r\n\r\n\t/**\r\n\t * Contains progress of the current animation: 0 (start) to 1 (end).\r\n\t */\r\n\tpublic progress: number = 0;\r\n\r\n\t/**\r\n\t * A list of options that cannot be animated. Those will be applied when\r\n\t * Animation ends.\r\n\t */\r\n\tprotected staticOptions!: IAnimationOptions[];\r\n\r\n\t/**\r\n\t * Indicated how many times animation should loop.\r\n\t */\r\n\tprotected _loop: number = 0;\r\n\r\n\t/**\r\n\t * Animation is paused.\r\n\t */\r\n\tprotected _pause: boolean = false;\r\n\r\n\t/**\r\n\t * Holds reference to timeout for delayed play.\r\n\t */\r\n\tprotected _delayTimeout: IDisposer | null = null;\r\n\r\n\t/**\r\n\t * A timestamp of when animation started playing.\r\n\t */\r\n\tprotected _startTime: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * Elapsed time in currently playing animation.\r\n\t */\r\n\tprotected _time: number = 0;\r\n\r\n\t// TODO verify that this is correct\r\n\tprotected debug(): void { }\r\n\r\n\tprotected _isFinished: boolean = false;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t *\r\n\t * @param object            An object animation should run on\r\n\t * @param animationOptions  One or several (array) of animation options\r\n\t * @param duration          Duration (ms)\r\n\t * @param easing            Easing function\r\n\t */\r\n\tconstructor(object: IAnimatable, animationOptions: IAnimationOptions[] | IAnimationOptions, duration: number, easing?: (value: number) => number) {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"Animation\";\r\n\r\n\t\t// Override duration if animations disabled system-wide\r\n\t\tif (options.animationsEnabled === false) {\r\n\t\t\tduration = 0;\r\n\t\t}\r\n\r\n\t\t// Set parameters\r\n\t\tthis.object = object;\r\n\t\tthis.animationOptions = $array.toArray(animationOptions);\r\n\t\tthis.duration = duration;\r\n\t\tif (easing) {\r\n\t\t\tthis.easing = easing;\r\n\t\t}\r\n\r\n\t\t// Run check if there are already animations playing on the same properties\r\n\t\t// and stop them - the last animation takes precedence\r\n\t\t//this.stopSameAnimations();\r\n\r\n\t\t/*if ($type.hasValue(callback)) {\r\n\t\t\t// TODO don't use .call\r\n\t\t\tthis.events.on(\"animationended\", callback, object);\r\n\t\t}*/\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes this object, clears up after itself.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tsuper.dispose();\r\n\t\tthis.pause();\r\n\t}\r\n\r\n\t/**\r\n\t * Delays animation start by X milliseconds.\r\n\t *\r\n\t * @param delay  Delay (ms)\r\n\t * @return Animation\r\n\t */\r\n\tpublic delay(delay: number): Animation {\r\n\t\t//@todo Maybe not use `bind()`\r\n\t\tif (delay > 0) {\r\n\t\t\tthis.pause();\r\n\r\n\t\t\t// This is so that it will get disposed if `this.object` is disposed\r\n\t\t\t// TODO hacky, figure out a better way\r\n\t\t\t$array.move(this.object.animations, this);\r\n\r\n\t\t\tlet id = setTimeout(() => {\r\n\t\t\t\tthis._delayTimeout = null;\r\n\t\t\t\tthis.start();\r\n\t\t\t}, delay);\r\n\r\n\t\t\tthis._delayTimeout = new Disposer(() => {\r\n\t\t\t\tclearTimeout(id);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\tprivate _start() {\r\n\t\tthis._isFinished = false;\r\n\t\t// Clear delay timeout if there was one\r\n\t\tif (this._delayTimeout) {\r\n\t\t\tthis.removeDispose(this._delayTimeout);\r\n\t\t\tthis._delayTimeout = null;\r\n\t\t}\r\n\r\n\t\t// Run check if there are already animations playing on the same properties\r\n\t\t// and stop them - the last animation takes precedence\r\n\t\tthis.stopSameAnimations();\r\n\r\n\t\t// Reset counters\r\n\t\tthis._pause = false;\r\n\r\n\t\t// Register animation\r\n\t\t$array.move(system.animations, this);\r\n\r\n\t\t// Register this animation in object's `animations` list\r\n\t\t$array.move(this.object.animations, this);\r\n\r\n\t\tsystem.requestFrame();\r\n\t}\r\n\r\n\t/**\r\n\t * Starts animation.\r\n\t *\r\n\t * @return Animation\r\n\t */\r\n\tpublic start(): Animation {\r\n\t\tthis._start();\r\n\t\tthis._startTime = Date.now();\r\n\t\tthis._time = 0;\r\n\t\tthis.staticOptions = [];\r\n\r\n\t\t// Process initial property values\r\n\t\tfor (let i: number = this.animationOptions.length - 1; i >= 0; i--) {\r\n\t\t\tlet options: IAnimationOptions = this.animationOptions[i];\r\n\t\t\tif (!$type.hasValue(options.from)) {\r\n\t\t\t\tif (options.childObject) {\r\n\t\t\t\t\toptions.from = options.childObject[options.property];\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\toptions.from = (<any>this.object)[options.property];\r\n\r\n\t\t\t\t\tif (!$type.hasValue(options.from)) {\r\n\t\t\t\t\t\toptions.from = (<any>SVGDefaults)[options.property];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t/*if (!$type.hasValue(options.from)) {\r\n\t\t\t\t\tthrow Error(\"Could not get initial transition value.\");\r\n\t\t\t\t}*/\r\n\t\t\t}\r\n\r\n\t\t\tif (options.from == options.to) { // || options.to == (<any>this.object)[options.property]){ this is not good, as dataItem.value is set to final at once, and we animate workingValue\r\n\t\t\t\t$array.remove(this.animationOptions, options);\r\n\t\t\t}\r\n\t\t\telse if (!$type.hasValue(options.from) || (!(options.from instanceof Percent) && (options.to instanceof Percent)) || ((options.from instanceof Percent) && !(options.to instanceof Percent))) {\r\n\t\t\t\t// Initial value is undefined, treat it as static\r\n\t\t\t\tthis.staticOptions.push(options);\r\n\t\t\t\t$array.remove(this.animationOptions, options);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Use different update methods for different value types\r\n\t\t\t\tif ($type.isNumber(<number>options.to)) {\r\n\r\n\t\t\t\t\t// Numeric value\r\n\t\t\t\t\toptions.updateMethod = getProgressNumber;\r\n\r\n\t\t\t\t\t// Check if initial value is not Percent\r\n\t\t\t\t\tif (options.from instanceof Percent) {\r\n\t\t\t\t\t\t// It is. Let's convert it to pixel value\r\n\t\t\t\t\t\t// @todo Check if we can do this in a less hacky way\r\n\t\t\t\t\t\tlet convertedFrom: number = (<any>this.object)[getHybridProperty(options.property, \"pixel\")];\r\n\t\t\t\t\t\tif (!isNaN(convertedFrom)) {\r\n\t\t\t\t\t\t\toptions.from = convertedFrom;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tthis.staticOptions.push(options);\r\n\t\t\t\t\t\t\t$array.remove(this.animationOptions, options);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (isNaN(<number>options.from)) {\r\n\t\t\t\t\t\t// Static value\r\n\t\t\t\t\t\tthis.staticOptions.push(options);\r\n\t\t\t\t\t\t$array.remove(this.animationOptions, options);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Check if maybe we have a color or percent value\r\n\t\t\t\t\tif (options.to instanceof Color) {\r\n\t\t\t\t\t\t// Yup - set resolved named color\r\n\t\t\t\t\t\t//options.from = $colors.stringToColor(<string>options.from);\r\n\t\t\t\t\t\tif (options.from) {\r\n\t\t\t\t\t\t\toptions.updateMethod = getProgressColor;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t// Static value\r\n\t\t\t\t\t\t\tthis.staticOptions.push(options);\r\n\t\t\t\t\t\t\t$array.remove(this.animationOptions, options);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (options.to instanceof Percent) {\r\n\t\t\t\t\t\t// Percent\r\n\t\t\t\t\t\toptions.updateMethod = getProgressPercent;\r\n\r\n\t\t\t\t\t\t// Check if the initial value is maybe in pixels\r\n\t\t\t\t\t\tif (!isNaN(<number>options.from)) {\r\n\t\t\t\t\t\t\t// It is. Let's convert it\r\n\t\t\t\t\t\t\t// @todo Check if we can do this in a less hacky way\r\n\t\t\t\t\t\t\tlet convertedFrom: number = (<any>this.object)[getHybridProperty(options.property, \"relative\")];\r\n\t\t\t\t\t\t\tif (!isNaN(convertedFrom)) {\r\n\t\t\t\t\t\t\t\toptions.from = percent(convertedFrom * 100);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Static value\r\n\t\t\t\t\t\tthis.staticOptions.push(options);\r\n\t\t\t\t\t\t$array.remove(this.animationOptions, options);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Apply static options (just in case they were reset by previous\r\n\t\t// animation loop)\r\n\t\tthis.applyStaticOptions();\r\n\r\n\t\tif (this.events.isEnabled(\"animationstarted\")) {\r\n\t\t\tconst event: AMEvent<this, IAnimationEvents>[\"animationstarted\"] = {\r\n\t\t\t\ttype: \"animationstarted\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tprogress: this.progress\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"animationstarted\", event);\r\n\t\t}\r\n\r\n\t\tthis.update();\r\n\r\n\t\t// If duration is 0, just end animation\r\n\t\tif (this.duration === 0) {\r\n\t\t\tthis.end();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets loop count for the animation. If parameter is not a valid number the\r\n\t * animation will keep on looping indefinitely.\r\n\t *\r\n\t * @param count  Number of times to loop animation\r\n\t * @return Animation\r\n\t */\r\n\tpublic loop(count?: number): Animation {\r\n\t\tif (!$type.isNumber(count)) {\r\n\t\t\tcount = Infinity;\r\n\t\t}\r\n\t\tthis._loop = count;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Pauses animation.\r\n\t *\r\n\t * @return Animation\r\n\t */\r\n\tpublic pause(): Animation {\r\n\t\tthis._pause = true;\r\n\r\n\t\tif (this._delayTimeout) {\r\n\t\t\tthis.removeDispose(this._delayTimeout);\r\n\t\t\tthis._delayTimeout = null;\r\n\t\t}\r\n\r\n\t\t$array.remove(system.animations, this);\r\n\t\t$array.remove(this.object.animations, this);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Resumes paused animation.\r\n\t *\r\n\t * @return Animation\r\n\t */\r\n\tpublic resume(): Animation {\r\n\t\tthis._start();\r\n\t\tthis._startTime = Date.now() - this._time;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Jumps to animation end. If animation is set to loop, this will start\r\n\t * another round of animation from start.\r\n\t *\r\n\t * @return Animation\r\n\t */\r\n\tpublic end(): Animation {\r\n\r\n\t\t// Pause and complete the progress\r\n\t\tif (this._loop == 0) {\r\n\t\t\tthis.pause();\r\n\t\t}\r\n\t\tthis.setProgress(1);\r\n\r\n\t\t// Apply static options\r\n\t\tthis.applyStaticOptions();\r\n\r\n\t\tif (this.events.isEnabled(\"animationended\")) {\r\n\t\t\tconst event: AMEvent<this, IAnimationEvents>[\"animationended\"] = {\r\n\t\t\t\ttype: \"animationended\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tprogress: this.progress\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"animationended\", event);\r\n\t\t}\r\n\r\n\t\t// Check if we should loop\r\n\t\tif (this._loop > 0) {\r\n\t\t\tthis._loop--;\r\n\t\t\tthis.start();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.stop();\r\n\t\t\tthis._isFinished = true;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Stops animation immediately leaving properties in their current values.\r\n\t */\r\n\tpublic kill() {\r\n\t\tthis.pause();\r\n\t\tthis._isFinished = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns indicator if this animation is finished or not\r\n\t *\r\n\t * @return Is finished?\r\n\t */\r\n\tpublic isFinished(): boolean {\r\n\t\treturn this._isFinished;\r\n\t}\r\n\r\n\t/**\r\n\t * Applies static options that can't be animated.\r\n\t */\r\n\tprotected applyStaticOptions(): void {\r\n\t\t$array.each(this.staticOptions, (options) => {\r\n\t\t\tif (options.childObject) {\r\n\t\t\t\toptions.childObject[options.property] = this.progress == 1 ? options.to : options.from;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t(<any>this.object)[options.property] = this.progress == 1 ? options.to : options.from;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Stops animation.\r\n\t *\r\n\t * When animation is stopped, the properties of the target object will remain\r\n\t * where they were at the moment when `stop()` was called.\r\n\t *\r\n\t * @param skipEvent  Do not trigger `animationstopped` event\r\n\t * @return Animation\r\n\t */\r\n\tpublic stop(skipEvent?: boolean): Animation {\r\n\t\tthis.pause();\r\n\t\tif (!skipEvent) {\r\n\t\t\tif (this.events.isEnabled(\"animationstopped\")) {\r\n\t\t\t\tconst event: AMEvent<this, IAnimationEvents>[\"animationstopped\"] = {\r\n\t\t\t\t\ttype: \"animationstopped\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tprogress: this.progress\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"animationstopped\", event);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets current progress and updates object's numeric and color values.\r\n\t *\r\n\t * @param progress Progress (0-1)\r\n\t */\r\n\tpublic setProgress(progress: number): void {\r\n\t\tthis._time = this.duration * progress; // just in case we call this from outside\r\n\t\t$array.each(this.animationOptions, (options) => {\r\n\t\t\tif (options.updateMethod && $type.hasValue(options.from)) {\r\n\t\t\t\tlet value = options.updateMethod(progress, options.from, options.to);\r\n\r\n\t\t\t\tif (options.childObject) {\r\n\t\t\t\t\toptions.childObject[options.property] = value;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t(<any>this.object)[options.property] = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.progress = progress;\r\n\t\tif (this.events.isEnabled(\"animationprogress\")) {\r\n\t\t\tconst event: AMEvent<this, IAnimationEvents>[\"animationprogress\"] = {\r\n\t\t\t\ttype: \"animationprogress\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tprogress: this.progress\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"animationprogress\", event);\r\n\t\t}\r\n\r\n\t\tsystem.requestFrame();\r\n\t}\r\n\r\n\t/**\r\n\t * Tracks and sets progress according to time or frames.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Animation\r\n\t */\r\n\tpublic update(): Animation {\r\n\t\tif (!this._pause) {\r\n\r\n\t\t\tlet progress;\r\n\t\t\tthis._time = $math.fitToRange(Date.now() - this._startTime!, 0, this.duration);\r\n\t\t\tlet timeProgress = this._time / this.duration;\r\n\t\t\tprogress = this.easing(timeProgress);\r\n\t\t\tif (this.duration == 0 || !$type.isNumber(progress) || timeProgress >= 1) {\r\n\t\t\t\tprogress = 1;\r\n\t\t\t}\r\n\r\n\t\t\tthis.setProgress(progress);\r\n\r\n\t\t\tif ($math.round(this._time / this.duration, 6) == 1) {\r\n\t\t\t\tthis.end();\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if this animation is delayed.\r\n\t *\r\n\t * @readonly\r\n\t * @return [description]\r\n\t */\r\n\tpublic get delayed(): boolean {\r\n\t\treturn this._delayTimeout ? true : false;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks other animations currently running on the same object and removes\r\n\t * overlapping options from those other animations that are contained in\r\n\t * this animation.\r\n\t *\r\n\t * This is needed to ensure that no two confurent animations step on each\r\n\t * other's toes by trying to animate the same property.\r\n\t */\r\n\tprivate stopSameAnimations(): void {\r\n\t\t// stop animation of the same property\r\n\t\t// TODO make this more efficient\r\n\t\t// TODO don't copy the array\r\n\t\t$array.each($array.copy(this.object.animations), (animation) => {\r\n\t\t\tif (animation !== this && !animation.delayed) {\r\n\t\t\t\tconst killed: Array<IAnimationOptions> = [];\r\n\r\n\t\t\t\t$array.each(this.animationOptions, (newOptions) => {\r\n\t\t\t\t\t$array.each(animation.animationOptions, (oldOptions) => {\r\n\t\t\t\t\t\tif (newOptions.property == oldOptions.property && newOptions.childObject == oldOptions.childObject) {\r\n\t\t\t\t\t\t\tkilled.push(oldOptions);\r\n\r\n\t\t\t\t\t\t\tif (animation.animationOptions.length == 0) {\r\n\t\t\t\t\t\t\t\tanimation.kill();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$array.each(killed, (oldOptions) => {\r\n\t\t\t\t\t$array.remove(animation.animationOptions, oldOptions);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Adds easing functions to \"function\" fields.\r\n\t *\r\n\t * @param field  Field name\r\n\t * @return Assign as function?\r\n\t */\r\n\tprotected asFunction(field: string): boolean {\r\n\t\treturn field == \"easing\" || super.asIs(field);\r\n\t}\r\n\r\n}","/**\r\n * Text class deals with all text placed on chart.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Container, IContainerProperties, IContainerAdapters, IContainerEvents } from \"../Container\";\r\nimport { DataItem } from \"../DataItem\";\r\nimport { TextValign } from \"../defs/TextValign\";\r\nimport { TextAlign } from \"../defs/TextAlign\";\r\nimport { IRectangle } from \"../defs/IRectangle\";\r\nimport { AMElement } from \"../rendering/AMElement\";\r\nimport { Group } from \"../rendering/Group\";\r\nimport { registry } from \"../Registry\";\r\nimport { ITextChunk, getTextFormatter } from \"../formatters/TextFormatter\";\r\nimport { MultiDisposer } from \"../utils/Disposer\";\r\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\r\nimport * as $math from \"../utils/Math\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport * as $type from \"../utils/Type\";\r\nimport { Paper } from \"../rendering/Paper\";\r\nimport * as $dom from \"../utils/DOM\";\r\nimport { defaultRules, ResponsiveBreakpoints } from \"../utils/Responsive\";\r\nimport { options } from \"../Options\";\r\n\r\n\r\n/**\r\n * Defines properties for [[Text]].\r\n */\r\nexport interface ILabelProperties extends IContainerProperties {\r\n\r\n\t/**\r\n\t * Horizontal align of the text.\r\n\t *\r\n\t * @default \"start\"\r\n\t */\r\n\ttextAlign?: TextAlign;\r\n\r\n\t/**\r\n\t * Vertical align of the text.\r\n\t *\r\n\t * @default \"top\"\r\n\t */\r\n\ttextValign?: TextValign;\r\n\r\n\t/**\r\n\t * A plain text content.\r\n\t */\r\n\ttext?: string;\r\n\r\n\t/**\r\n\t * Should the lines wrap if they do not fit into max width?\r\n\t *\r\n\t * @default false\r\n\t */\r\n\twrap?: boolean;\r\n\r\n\t/**\r\n\t * Should the text be selectable>\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tselectable?: boolean;\r\n\r\n\t/**\r\n\t * HTML content.\r\n\t */\r\n\thtml?: string;\r\n\r\n\t/**\r\n\t * Should the lines be truncated (optionally with ellipsis) if they do not\r\n\t * fit into max width?\r\n\t *\r\n\t * @default false\r\n\t */\r\n\ttruncate?: boolean;\r\n\r\n\t/**\r\n\t * If `truncate` is enabled, should Label try to break only on full words\r\n\t * (`true`), or whenever needed, including middle of the word. (`false`)\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tfullWords?: boolean;\r\n\r\n\t/**\r\n\t * If lines are truncated, this ellipsis will be added at the end.\r\n\t *\r\n\t * @default \"…\"\r\n\t */\r\n\tellipsis?: string;\r\n\r\n\t/**\r\n\t * Hide text of it does not fit into element's dimensions?\r\n\t *\r\n\t * @default false\r\n\t */\r\n\thideOversized?: boolean;\r\n\r\n\t/**\r\n\t * If set to `true` square-bracket formatting blocks will be treated as\r\n\t * regular text.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tignoreFormatting?: boolean;\r\n\r\n\t/**\r\n\t * Path string along which text should be arranged\r\n\t */\r\n\tpath?: string\r\n\r\n\t/**\r\n\t * Relative label location on path.\r\n\t */\r\n\tlocationOnPath?: number;\r\n\r\n\t/**\r\n\t * A ratio to calculate text baseline. Ralative distance from the bottom of\r\n\t * the label.\r\n\t *\r\n\t * @default -0.27\r\n\t */\r\n\tbaseLineRatio?: number;\r\n}\r\n\r\n/**\r\n * Text line information.\r\n *\r\n * Objects used to hold cached information about lines in a Text element.\r\n */\r\nexport interface ITextLineInfo {\r\n\r\n\t/**\r\n\t * Measurements for the bounding box of the line.\r\n\t */\r\n\t\"bbox\"?: IRectangle,\r\n\r\n\t/**\r\n\t * A reference to an SVG `<g>` element that holds line elements.\r\n\t */\r\n\t\"element\"?: Group,\r\n\r\n\t/**\r\n\t * Indicates if line contains more than one element, e.g. has multiple\r\n\t * formatted blocks.\r\n\t */\r\n\t\"complex\"?: boolean,\r\n\r\n\t\"text\"?: string,\r\n\r\n\t\"style\"?: string\r\n};\r\n\r\n/**\r\n * Defines events for [[Text]].\r\n */\r\nexport interface ILabelEvents extends IContainerEvents { }\r\n\r\n/**\r\n * Adapters for [[Text]].\r\n *\r\n * Includes both the [[Adapter]] definitions and properties.\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface ILabelAdapters extends IContainerAdapters, ILabelProperties {\r\n\r\n\t/**\r\n\t * Applied to the final formatted label text.\r\n\t */\r\n\ttextOutput: string;\r\n\r\n\t/**\r\n\t * Applied to the final formatted label HTML.\r\n\t */\r\n\thtmlOutput: string;\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Text is used to display highly configurable, data-enabled textual elements.\r\n *\r\n * ## Data Binding\r\n *\r\n * A Text element can dynamically parse and populate its contents with values\r\n * from a [[DataItem]].\r\n *\r\n * To activate such binding, set element's `dataItem` property.\r\n *\r\n * When activated, text contents will be parsed for special tags, e.g.:\r\n *\r\n * ```TypeScript\r\n * label.dataItem = myDataItem;\r\n * label.text = \"The title is: {title}\";\r\n * ```\r\n * ```JavaScript\r\n * label.dataItem = myDataItem;\r\n * label.text = \"The title is: {title}\";\r\n * ```\r\n *\r\n * The above will automatically replace \"{title}\" in the string with the\r\n * actual data value from `myDataItem`.\r\n *\r\n * Note, that most often dataItem is set by the Component.\r\n *\r\n *\r\n * @see {@link ILabelEvents} for a list of available events\r\n * @see {@link ILabelAdapters} for a list of available Adapters\r\n * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-strings/} for info on string formatting and data binding\r\n * @todo Vertical align\r\n * @important\r\n */\r\nexport class Label extends Container {\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: ILabelProperties;\r\n\r\n\t/**\r\n\t * Defines Adapter type.\r\n\t */\r\n\tpublic _adapter!: ILabelAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: ILabelEvents;\r\n\r\n\t/**\r\n\t * Indicates if the whole text does not fit into max dimenstions set for it.\r\n\t */\r\n\tpublic isOversized: boolean = false;\r\n\r\n\t/**\r\n\t * Currently formatted text, read only.\r\n\t */\r\n\tpublic currentText: string;\r\n\r\n\t/**\r\n\t * Current format to be used for outputing text.\r\n\t */\r\n\tprotected _currentFormat: string;\r\n\r\n\t/**\r\n\t * [_sourceDataItemEvents description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _sourceDataItemEvents: MultiDisposer;\r\n\r\n\r\n\tprotected _prevStatus: string;\r\n\r\n\t/**\r\n\t * SVG path element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic pathElement: $type.Optional<AMElement>;\r\n\r\n\t/**\r\n\t * SVG textpath element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic textPathElement: $type.Optional<Group>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Execute super's constructor\r\n\t\tsuper();\r\n\r\n\t\t// Set this class name\r\n\t\tthis.className = \"Label\";\r\n\r\n\t\tthis.fill = new InterfaceColorSet().getFor(\"text\");\r\n\r\n\t\t// not good to set this, as then these will appear on each label and values set on container won't be applied.\r\n\t\t//this.textDecoration = \"none\";\r\n\t\t//this.fontWeight = \"normal\";\r\n\r\n\r\n\t\t// Set defaults\r\n\t\tthis.wrap = false;\r\n\t\tthis.truncate = false;\r\n\t\tthis.fullWords = true;\r\n\t\tthis.ellipsis = \"…\";\r\n\t\tthis.textAlign = \"start\";\r\n\t\tthis.textValign = \"top\";\r\n\r\n\t\tthis.layout = \"absolute\";\r\n\t\tthis.baseLineRatio = -0.27;\r\n\t\t//this.pixelPerfect = true;\r\n\t\tthis._positionPrecision = 1;\r\n\r\n\t\t// Add events to watch for maxWidth/maxHeight changes so that we can\r\n\t\t// invalidate this\r\n\t\tthis.events.on(\"maxsizechanged\", () => {\r\n\t\t\tif (this.inited) {\r\n\t\t\t\tthis.handleMaxSize()\r\n\t\t\t}\r\n\t\t}, this, false);\r\n\r\n\t\t// this solves strange bug when text just added to svg is 0x0\r\n\t\tthis.events.once(\"validated\", this.handleValidate, this, false);\r\n\r\n\t\t// Aply theme\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * A placeholder method that is called **after** element finishes drawing\r\n\t * itself.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected afterDraw(): void {\r\n\t\t// since we removed validatePosition from sprite, we still need it here to handle rotated text\r\n\t\tsuper.afterDraw();\r\n\t\tthis.validatePosition();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Sets [[Paper]] instance to use to draw elements.\r\n\t * @ignore\r\n\t * @param paper Paper\r\n\t * @return true if paper was changed, false, if it's the same\r\n\t */\r\n\tpublic setPaper(paper: Paper): boolean {\r\n\r\n\t\tlet changed = super.setPaper(paper);\r\n\r\n\t\tif (changed) {\r\n\t\t\tthis.hardInvalidate();\r\n\t\t}\r\n\t\treturn changed;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected handleValidate() {\r\n\t\tif ((this.currentText || this.text) && (this.bbox.width == 0 || this.bbox.height == 0)) {\r\n\t\t\tregistry.events.once(\"exitframe\", this.hardInvalidate, this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected handleMaxSize() {\r\n\t\tif (\r\n\t\t\t(this.bbox.width > this.availableWidth)\r\n\t\t\t|| ((this.bbox.width < this.availableWidth) && (this.isOversized || this.truncate))\r\n\t\t\t|| (this.bbox.height > this.availableHeight)\r\n\t\t\t|| ((this.bbox.height < this.availableHeight) && this.isOversized)\r\n\t\t) {\r\n\t\t\tthis.invalidate();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.alignSVGText();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [arrange description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tpublic arrange(): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Updates current text according to data item and supported features.\r\n\t * Returns `true` if current text has changed.\r\n\t *\r\n\t * @return Text changed?\r\n\t */\r\n\tprotected updateCurrentText(): boolean {\r\n\t\t// Determine output format\r\n\t\tlet output: string, text: string;\r\n\r\n\t\tif ($utils.isNotEmpty(this.html) && this.paper.supportsForeignObject()) {\r\n\r\n\t\t\t// We favor HTML text if it's set and browser supports `foreignObject`\r\n\t\t\toutput = \"html\";\r\n\t\t\ttext = this.html;\r\n\t\t}\r\n\t\telse {\r\n\t\t\toutput = \"svg\";\r\n\t\t\ttext = this.text;\r\n\t\t}\r\n\r\n\t\t// Need to toString source?\r\n\t\tif ($type.isObject(text as any)) {\r\n\t\t\ttext = text.toString();\r\n\t\t}\r\n\r\n\t\t// Need to format text all the time\r\n\t\tif ($type.hasValue(text) && text !== \"\") {\r\n\t\t\ttext = this.populateString(text, this.dataItem);\r\n\t\t}\r\n\r\n\t\tif (output == \"html\") {\r\n\t\t\tif (this._adapterO) {\r\n\t\t\t\ttext = this._adapterO.apply(\"htmlOutput\", text);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (this._adapterO) {\r\n\t\t\t\ttext = this._adapterO.apply(\"textOutput\", text);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Update the text\r\n\t\tlet changed = text != this.currentText || output != this._currentFormat;\r\n\t\tthis.currentText = text;\r\n\t\tthis._currentFormat = output;\r\n\r\n\t\treturn changed;\r\n\t}\r\n\r\n\t/**\r\n\t * Hard invalidate means the text will be redrawn even if it hasn't changed.\r\n\t * This is used when we change `fontSize`, `fontFamily`, or for some other\r\n\t * reasons.\r\n\t */\r\n\tpublic hardInvalidate() {\r\n\t\tthis._prevStatus = \"\";\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * Gets line bbox, uses caching to save cpu\r\n\t * @ignore\r\n\t */\r\n\tprotected getLineBBox(lineInfo: ITextLineInfo) {\r\n\t\t//let cacheKey = lineInfo.text + lineInfo.style;\r\n\r\n\t\t//let lineBBox = this.getCache(cacheKey);\r\n\t\t//if (!lineBBox) {\r\n\t\t//lineBBox = lineInfo.element.getBBox();\r\n\t\t//if (lineBBox.width != 0 && lineBBox.height != 0) {\r\n\t\t//\tthis.setCache(cacheKey, lineBBox, 5000);\r\n\t\t//}\r\n\t\t//}\r\n\r\n\t\tlet element = lineInfo && lineInfo.element;\r\n\t\tlet node = element && element.node;\r\n\r\n\t\t// Check for the parent Node to avoid FF from throwing errors\r\n\t\tif (node && node.parentNode) {\r\n\t\t\tlineInfo.bbox = element.getBBox();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the textual label.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic draw(): void {\r\n\r\n\t\t// Draw super\r\n\t\tsuper.draw();\r\n\r\n\t\tlet oldW = this.bbox.width;\r\n\t\tlet oldH = this.bbox.height;\r\n\r\n\t\tlet topParent = this.topParent;\r\n\t\tif (topParent) {\r\n\t\t\tif (!topParent.maxWidth || !topParent.maxHeight) {\r\n\t\t\t\ttopParent.events.once(\"maxsizechanged\", this.hardInvalidate, this, false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Calculate max width and height\r\n\t\tlet maxWidth: number = $math.max(this.availableWidth - this.pixelPaddingLeft - this.pixelPaddingRight, 0);\r\n\t\tlet maxHeight: number = $math.max(this.availableHeight - this.pixelPaddingTop - this.pixelPaddingBottom, 0);\r\n\r\n\t\t// save\r\n\t\tlet status = maxHeight + \",\" + maxWidth + this.wrap + this.truncate + this.fullWords + this.rtl + this.ellipsis;\r\n\r\n\t\t// Update text\r\n\t\tif (!this.updateCurrentText() && this.inited && this._prevStatus == status) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._measuredWidth = 0;\r\n\t\tthis._measuredHeight = 0;\r\n\r\n\t\t// Reset\r\n\t\tthis.isOversized = false;\r\n\r\n\t\t// Determine output format\r\n\t\tlet output = this._currentFormat;\r\n\t\tlet text = this.currentText;\r\n\r\n\t\t// Empty string\r\n\t\tif (!$type.hasValue(text) || text == \"\") {\r\n\t\t\tthis.element.attr({ display: \"none\" });\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Chop up text into lines\r\n\t\t// We're still processing SVG and HTML in the same way for now\r\n\t\tlet lines: string[] = text.split(\"\\n\");\r\n\r\n\t\t// Do we need to go through the trouble of measuring lines\r\n\t\t//let measure: boolean = true;// (lines.length > 1) || this.wrap;\r\n\r\n\t\tthis._prevStatus = status;\r\n\r\n\t\tthis.textAlign = this.textAlign;\r\n\r\n\t\t// need this to measure\r\n\t\tlet display = this.group.getAttr(\"display\");\r\n\t\tif (display == \"none\") {\r\n\t\t\tthis.group.removeAttr(\"display\");\r\n\t\t}\r\n\r\n\t\tif (this.textPathElement) {\r\n\t\t\tthis.textPathElement.removeChildren();\r\n\t\t}\r\n\r\n\t\t// SVG or HTML?\r\n\t\tif (output === \"svg\") {\r\n\t\t\t/**\r\n\t\t\t * SVG\r\n\t\t\t */\r\n\r\n\t\t\tthis.element.removeAttr(\"display\");\r\n\r\n\t\t\t// Clear the element\r\n\t\t\tlet group: Group = <Group>this.element;\r\n\r\n\t\t\tthis.resetBBox();\r\n\r\n\t\t\t// Init state variables\r\n\t\t\tlet currentHeight: number = 0;\r\n\t\t\tlet currentFormat: string = \"\";\r\n\r\n\t\t\t// Process each line\r\n\t\t\tfor (let i = 0; i < lines.length; i++) {\r\n\r\n\t\t\t\t// Get line\r\n\t\t\t\tlet line: string = lines[i];\r\n\r\n\t\t\t\t// Check if line is empty\r\n\t\t\t\tif (line == \"\") {\r\n\t\t\t\t\t// It is, let's just update currentHeight and go to the next one\r\n\t\t\t\t\t// If it's the first line, we'll have to use arbirary line height,\r\n\t\t\t\t\t// since there's nothing to measure. For subsequent lines we can take\r\n\t\t\t\t\t// previous line's height\r\n\t\t\t\t\tlet tempElement = this.getSVGLineElement(\"\", 0);\r\n\t\t\t\t\ttempElement.add(\r\n\t\t\t\t\t\tthis.getSvgElement(\r\n\t\t\t\t\t\t\t\".\",\r\n\t\t\t\t\t\t\tgetTextFormatter().translateStyleShortcuts(currentFormat)\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tgroup.add(tempElement);\r\n\t\t\t\t\tlet offset = Math.ceil(tempElement.getBBox().height);\r\n\t\t\t\t\tif (offset > 0) {\r\n\t\t\t\t\t\tcurrentHeight += offset;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgroup.removeElement(tempElement);\r\n\r\n\t\t\t\t\t// Clear cache if necessary\r\n\t\t\t\t\tlet lineInfo = this.getLineInfo(i);\r\n\t\t\t\t\tif (lineInfo) {\r\n\t\t\t\t\t\tlineInfo.text = \"\";\r\n\t\t\t\t\t\tlineInfo.element.textContent = \"\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Chunk up the line and process each chunk\r\n\t\t\t\tlet chunks: ITextChunk[] = getTextFormatter().chunk(line, null, this.ignoreFormatting);\r\n\t\t\t\tlet currentLineHeight: number = 0;\r\n\t\t\t\tlet firstChunk: boolean = true;\r\n\t\t\t\tlet skipTextChunks: boolean = false;\r\n\r\n\t\t\t\t// Create line element or grab it from cache\r\n\t\t\t\tlet lineInfo = this.getLineInfo(i);\r\n\r\n\t\t\t\tif (lineInfo) {\r\n\t\t\t\t\t// Empty line\r\n\t\t\t\t\tlineInfo.text = \"\";\r\n\t\t\t\t\tlineInfo.element.textContent = \"\";\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Init new line info\r\n\t\t\t\t\tlineInfo = {\r\n\t\t\t\t\t\t\"text\": \"\",\r\n\t\t\t\t\t\t\"element\": this.getSVGLineElement(\"\", 0),\r\n\t\t\t\t\t\t\"complex\": false\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// Create the line element\r\n\t\t\t\t\t//lineInfo.element = this.getSVGLineElement(\"\", 0);\r\n\t\t\t\t\t//lineElement = this.getSVGLineElement(\"\", 0);\r\n\t\t\t\t\tgroup.add(lineInfo.element);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlineInfo.element.removeAttr(\"display\");\r\n\t\t\t\tlineInfo.element.removeChildren(); // memory leak without this\r\n\r\n\t\t\t\tif (this.textPathElement) {\r\n\t\t\t\t\tlineInfo.element.add(this.textPathElement);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t/*// @todo not needed anymore\r\n\t\t\t\tif (this.rtl) {\r\n\t\t\t\t\tchunks.reverse();\r\n\t\t\t\t}*/\r\n\r\n\t\t\t\t// Process each chunk\r\n\t\t\t\tfor (let x: number = 0; x < chunks.length; x++) {\r\n\r\n\t\t\t\t\t// If there's more than one chunk, means the line is \"complex\"\r\n\t\t\t\t\tif (x) {\r\n\t\t\t\t\t\tlineInfo.complex = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Get chunk\r\n\t\t\t\t\tlet chunk = chunks[x];\r\n\r\n\t\t\t\t\t// Is this chunk format or text?\r\n\t\t\t\t\tif (chunk.type === \"format\") {\r\n\r\n\t\t\t\t\t\t// Log current format, so that we can apply it to multiple lines if\r\n\t\t\t\t\t\t// necessary\r\n\t\t\t\t\t\tcurrentFormat = chunk.text;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t\t// It's text block\r\n\r\n\t\t\t\t\t\t// Need to skip?\r\n\t\t\t\t\t\t// We do this when truncating. We can't just simply go ahead and\r\n\t\t\t\t\t\t// abandon chunk processing as they might have formatting\r\n\t\t\t\t\t\t// instructions in them that are relevant for subsequent lines\r\n\t\t\t\t\t\tif (skipTextChunks) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Add chunk to the current element\r\n\t\t\t\t\t\t//lineInfo.element.content += $utils.trim(getTextFormatter().format(currentFormat + chunk.text, output));\r\n\r\n\t\t\t\t\t\tlineInfo.text = chunk.text;\r\n\t\t\t\t\t\tlineInfo.style = getTextFormatter().translateStyleShortcuts(currentFormat);\r\n\r\n\r\n\t\t\t\t\t\tif (this.textPathElement) {\r\n\t\t\t\t\t\t\tthis.getSvgElement(lineInfo.text, lineInfo.style, this.textPathElement);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tthis.getSvgElement(lineInfo.text, lineInfo.style, lineInfo.element);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.getLineBBox(lineInfo);\r\n\t\t\t\t\t\tlineInfo.bbox.width = Math.ceil(lineInfo.bbox.width);\r\n\r\n\t\t\t\t\t\t// Updated current line height\r\n\t\t\t\t\t\tif (currentLineHeight < lineInfo.bbox.height) {\r\n\t\t\t\t\t\t\tcurrentLineHeight = lineInfo.bbox.height;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Wrapping?\r\n\t\t\t\t\t\tif ((this.wrap || this.truncate) && (lineInfo.bbox.width > maxWidth)) {\r\n\r\n\t\t\t\t\t\t\t// Set oversized\r\n\t\t\t\t\t\t\tthis.isOversized = true;\r\n\r\n\t\t\t\t\t\t\t// Take temporary measurements\r\n\t\t\t\t\t\t\tlet lineText: string = lineInfo.element.textContent;\r\n\t\t\t\t\t\t\tlet avgCharWidth: number = (lineInfo.bbox.width / lineText.length); // * .9;\r\n\r\n\t\t\t\t\t\t\t// Calculate average number of symbols / width\r\n\t\t\t\t\t\t\tlet excessChars: number = $math.min(Math.ceil((lineInfo.bbox.width - maxWidth) / avgCharWidth), lineText.length);\r\n\r\n\t\t\t\t\t\t\t// Are we truncating or auto-wrapping text?\r\n\t\t\t\t\t\t\tif (this.truncate) {\r\n\r\n\t\t\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t\t\t * Processing line truncation\r\n\t\t\t\t\t\t\t\t * With the addition of each text chunk we measure if current\r\n\t\t\t\t\t\t\t\t * line does not exceed maxWidth. If it does, we will stop\r\n\t\t\t\t\t\t\t\t * addition of further chunks as well as try to truncate\r\n\t\t\t\t\t\t\t\t * current or any number of previous chunks with an added\r\n\t\t\t\t\t\t\t\t * ellipsis\r\n\t\t\t\t\t\t\t\t */\r\n\r\n\t\t\t\t\t\t\t\t// Indicator whether we need to add ellipsis to the current\r\n\t\t\t\t\t\t\t\t// element, even if it fits. This is needed to indicate\r\n\t\t\t\t\t\t\t\t// whether we have already removed some subsequent chunks in\r\n\t\t\t\t\t\t\t\t// which case we need to add ellipsis.\r\n\t\t\t\t\t\t\t\tlet addEllipsis: boolean = false;\r\n\r\n\t\t\t\t\t\t\t\t// Process each child in the temporary line, until the whole\r\n\t\t\t\t\t\t\t\t// line fits, preferably with an ellipsis\r\n\t\t\t\t\t\t\t\t// TODO use iterator instead\r\n\t\t\t\t\t\t\t\tlet node = lineInfo.element.node;\r\n\t\t\t\t\t\t\t\tif (node && node.childNodes) {\r\n\t\t\t\t\t\t\t\t\tfor (let e = lineInfo.element.node.childNodes.length - 1; e >= 0; e--) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Get current element\r\n\t\t\t\t\t\t\t\t\t\tlet node = lineInfo.element.node.childNodes[e];\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Add ellipsis only if previous chunk was removed in full\r\n\t\t\t\t\t\t\t\t\t\t// and this chunk already fits\r\n\t\t\t\t\t\t\t\t\t\t//if (addEllipsis && (bbox.width <= maxWidth)) {\r\n\t\t\t\t\t\t\t\t\t\tif (addEllipsis && (lineInfo.bbox.width <= maxWidth)) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Add ellipsis\r\n\t\t\t\t\t\t\t\t\t\t\tnode.textContent += \" \" + this.ellipsis;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Measure again (we need to make sure ellipsis fits)\r\n\t\t\t\t\t\t\t\t\t\t\tlineInfo.bbox = lineInfo.element.getBBox();\r\n\t\t\t\t\t\t\t\t\t\t\tlineInfo.bbox.width = Math.floor(lineInfo.bbox.width);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// If it fits, we're done here\r\n\t\t\t\t\t\t\t\t\t\t\t// If it doesn't we continue rolling\r\n\t\t\t\t\t\t\t\t\t\t\tif (lineInfo.bbox.width <= maxWidth) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\taddEllipsis = false;\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Get element text\r\n\t\t\t\t\t\t\t\t\t\tlet elementText = node.textContent;\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Calculate average number of symbols / width\r\n\t\t\t\t\t\t\t\t\t\tlineText = lineInfo.element.textContent;\r\n\t\t\t\t\t\t\t\t\t\texcessChars = $math.min(Math.ceil((lineInfo.bbox.width - maxWidth) / avgCharWidth), lineText.length);\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Do this until we fit\r\n\t\t\t\t\t\t\t\t\t\twhile ((lineInfo.bbox.width > maxWidth) && (excessChars <= lineText.length) && (excessChars > 0)) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Calculate max available chars\r\n\t\t\t\t\t\t\t\t\t\t\tlet maxChars: number = $math.max(lineText.length - excessChars - this.ellipsis.length, 1);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Is there anything left?\r\n\t\t\t\t\t\t\t\t\t\t\tif (maxChars <= 1) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Nope, let's jump to the previous item\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Set excess characters to zero so that this loop does\r\n\t\t\t\t\t\t\t\t\t\t\t\t// not repeat when it over\r\n\t\t\t\t\t\t\t\t\t\t\t\texcessChars = 0;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Add ellipsis to previous item\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Subsequent iterations will check if the ellipsis fits\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (e > 0) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Indicating to add ellipsis to previous item\r\n\t\t\t\t\t\t\t\t\t\t\t\t\taddEllipsis = true;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Removing this node\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlineInfo.element.node.removeChild(node);\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Truncate the text\r\n\t\t\t\t\t\t\t\t\t\t\telementText = $utils.truncateWithEllipsis(elementText, maxChars, this.ellipsis, this.fullWords, this.rtl);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\tif ((elementText.length > maxChars) && this.fullWords) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Still too long?\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Let's try truncating breaking words anyway\r\n\t\t\t\t\t\t\t\t\t\t\t\telementText = $utils.truncateWithEllipsis(elementText, maxChars, this.ellipsis, false, this.rtl);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Set truncated text\r\n\t\t\t\t\t\t\t\t\t\t\tnode.textContent = elementText;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Measure again\r\n\t\t\t\t\t\t\t\t\t\t\tlineInfo.bbox = lineInfo.element.getBBox();\r\n\t\t\t\t\t\t\t\t\t\t\tlineInfo.bbox.width = Math.floor(lineInfo.bbox.width);\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Increase excess characters count, just in case it still\r\n\t\t\t\t\t\t\t\t\t\t\t// doesn't fit and we have to go at it again\r\n\t\t\t\t\t\t\t\t\t\t\texcessChars = Math.ceil(excessChars * 1.1);\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Do not process further chunks\r\n\t\t\t\t\t\t\t\t\t\tskipTextChunks = true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t\t\t * Processign auto-wrap\r\n\t\t\t\t\t\t\t\t * In this case we're going to be adding text chunks until\r\n\t\t\t\t\t\t\t\t * they don't fit into current line. Once that happens we will\r\n\t\t\t\t\t\t\t\t * inject the rest of the chunks to the next line\r\n\t\t\t\t\t\t\t\t */\r\n\t\t\t\t\t\t\t\t// Get last node added and measure it\r\n\t\t\t\t\t\t\t\tlet node = lineInfo.element.node;\r\n\t\t\t\t\t\t\t\tif (node) {\r\n\t\t\t\t\t\t\t\t\tlet lastNode = lineInfo.element.node.lastChild;\r\n\r\n\t\t\t\t\t\t\t\t\t// Init split lines\r\n\t\t\t\t\t\t\t\t\tlet splitLines: string[];\r\n\t\t\t\t\t\t\t\t\twhile ((lineInfo.bbox.width > maxWidth) && (excessChars <= lineText.length) && (excessChars > 0)) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Calculate max available chars\r\n\t\t\t\t\t\t\t\t\t\tlet maxChars: number = $math.max(chunk.text.length - excessChars, 1);\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Don't split the words mid-word if it's not the first chunk\r\n\t\t\t\t\t\t\t\t\t\t// in the line\r\n\t\t\t\t\t\t\t\t\t\tif (firstChunk) {\r\n\t\t\t\t\t\t\t\t\t\t\t// Split mid-word if necessary\r\n\t\t\t\t\t\t\t\t\t\t\tsplitLines = $utils.splitTextByCharCount(chunk.text, maxChars, true, this.rtl);\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Don't split mid-word\r\n\t\t\t\t\t\t\t\t\t\t\tsplitLines = $utils.splitTextByCharCount(chunk.text, maxChars, true, this.rtl, false);\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t// Check if the first word is too long\r\n\t\t\t\t\t\t\t\t\t\t\tif ((splitLines[0].length > maxChars) || maxChars === 1) {\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Yes - move the whole chunk to the next line\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Remove the element we just added\r\n\t\t\t\t\t\t\t\t\t\t\t\tlineInfo.element.node.removeChild(lastNode)\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t// Break out of the while on next cycle\r\n\t\t\t\t\t\t\t\t\t\t\t\texcessChars = 0;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Use the first line to update last item\r\n\t\t\t\t\t\t\t\t\t\tif (excessChars > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet lineText = splitLines.shift();\r\n\t\t\t\t\t\t\t\t\t\t\tif (firstChunk) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tlineText = $utils.trim(lineText);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tlastNode.textContent = getTextFormatter().cleanUp(lineText);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Measure again, just in case\r\n\t\t\t\t\t\t\t\t\t\tlineInfo.bbox = lineInfo.element.getBBox();\r\n\t\t\t\t\t\t\t\t\t\tlineInfo.bbox.width = Math.floor(lineInfo.bbox.width);\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Increase excess characters count, just in case it still\r\n\t\t\t\t\t\t\t\t\t\t// doesn't fit and we have to go at it again\r\n\t\t\t\t\t\t\t\t\t\t//excessChars = Math.ceil(excessChars * 1.05);\r\n\t\t\t\t\t\t\t\t\t\texcessChars++;\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\t\t\t\t// Construct the rest of the line\r\n\t\t\t\t\t\t\t\t\tif (splitLines.length > 0) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tlet restOfLine: string = \"\";\r\n\t\t\t\t\t\t\t\t\t\t// Add leftovers from splitting the current chunk\r\n\t\t\t\t\t\t\t\t\t\tif ($type.hasValue(splitLines)) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (this.rtl) {\r\n\t\t\t\t\t\t\t\t\t\t\t\trestOfLine += splitLines.join(\"\") + currentFormat;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\t\t\trestOfLine += currentFormat + splitLines.join(\"\").replace(/([\\[\\]]{1})/g, \"$1$1\");\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Add the rest of the chunks\r\n\t\t\t\t\t\t\t\t\t\tfor (let c: number = x + 1; c < chunks.length; c++) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (chunks[c].type == \"value\") {\r\n\t\t\t\t\t\t\t\t\t\t\t\t// We're escaping single square brackets that were\r\n\t\t\t\t\t\t\t\t\t\t\t\t// cleaned up by chunk() back to double square brackets\r\n\t\t\t\t\t\t\t\t\t\t\t\t// so that they are not being treated as format on\r\n\t\t\t\t\t\t\t\t\t\t\t\t// next pass.\r\n\t\t\t\t\t\t\t\t\t\t\t\trestOfLine += chunks[c].text.replace(/([\\[\\]]{1})/g, \"$1$1\");\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\t\t\trestOfLine += chunks[c].text;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\t// Inject the rest of the lines as chunks for subsequent\r\n\r\n\t\t\t\t\t\t\t\t\t\tlines.splice(i + 1, 0, restOfLine);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t// Skip processing the rest of the chunks\r\n\t\t\t\t\t\t\t\t\tskipTextChunks = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Let's update the text's bbox with the line's one\r\n\t\t\t\t\t\tif (this.bbox.width < lineInfo.bbox.width) {\r\n\t\t\t\t\t\t\tthis.bbox.width = lineInfo.bbox.width;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// commented to avoid bug (seen on sankey link) where text is incorrectly aligned\r\n\t\t\t\t\t\t//if (this.bbox.x > lineInfo.bbox.x) {\r\n\t\t\t\t\t\t//this.bbox.x = lineInfo.bbox.x;\r\n\t\t\t\t\t\t//}\r\n\r\n\t\t\t\t\t\tthis.bbox.height = currentHeight + currentLineHeight;\r\n\r\n\t\t\t\t\t\t// Position current line\r\n\t\t\t\t\t\tif (!this.textPathElement) {\r\n\t\t\t\t\t\t\tlineInfo.element.attr({\r\n\t\t\t\t\t\t\t\t\"x\": \"0\",\r\n\t\t\t\t\t\t\t\t\"y\": currentHeight + currentLineHeight,\r\n\t\t\t\t\t\t\t\t\"dy\": $math.round((this.baseLineRatio * currentLineHeight), 3).toString()\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tlineInfo.element.attr({\r\n\t\t\t\t\t\t\t\t\"dy\": -this.paddingBottom.toString()\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfirstChunk = false;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Trim the last item\r\n\t\t\t\tlet node = lineInfo.element.node;\r\n\t\t\t\tif (node) {\r\n\t\t\t\t\tlet lastNode = node.lastChild;\r\n\t\t\t\t\tif (lastNode) {\r\n\t\t\t\t\t\tlastNode.textContent = this.rtl ?\r\n\t\t\t\t\t\t\t$utils.ltrim(lastNode.textContent) :\r\n\t\t\t\t\t\t\t$utils.rtrim(lastNode.textContent);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Increment collective height\r\n\t\t\t\tcurrentHeight += currentLineHeight;\r\n\r\n\t\t\t\t// Save line cache\r\n\t\t\t\tthis.addLineInfo(lineInfo, i);\r\n\t\t\t}\r\n\r\n\t\t\t// Check if maybe we need to hide the whole label if it doesn't fit\r\n\t\t\tthis.maybeHideOversized();\r\n\r\n\t\t\tthis.measureFailed = false;\r\n\t\t\tif (this.bbox.width == 0 || this.bbox.height == 0) {\r\n\t\t\t\tthis.measureFailed = true;\r\n\t\t\t}\r\n\r\n\t\t\t// Updated measured dims\r\n\t\t\tthis._measuredWidth = $math.round($math.max(this.bbox.width, this.pixelWidth - this.pixelPaddingLeft - this.pixelPaddingRight));\r\n\t\t\tthis._measuredHeight = $math.round($math.max(this.bbox.height, this.pixelHeight - this.pixelPaddingTop - this.pixelPaddingBottom));\r\n\r\n\t\t\t// Align the lines\r\n\t\t\tthis.alignSVGText();\r\n\r\n\t\t\tthis.bbox.width = this._measuredWidth;\r\n\t\t\tthis.bbox.height = this._measuredHeight;\r\n\r\n\t\t\tif (oldH != this._measuredHeight || oldW != this._measuredWidth) {\r\n\t\t\t\tthis.dispatch(\"transformed\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.hideUnused(lines.length);\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\t/**\r\n\t\t\t * HTML\r\n\t\t\t */\r\n\r\n\t\t\tthis.element.removeAttr(\"display\");\r\n\t\t\tthis.resetBBox();\r\n\r\n\t\t\t// Clear the element\r\n\t\t\tlet group: Group = <Group>this.element;\r\n\t\t\tgroup.removeChildren();\r\n\r\n\t\t\t// Create a ForeignObject to use as HTML container\r\n\t\t\tlet fo = this.paper.foreignObject();\r\n\t\t\tgroup.add(fo);\r\n\r\n\t\t\t// Set widths on foreignObject so that autosizing measurements work\r\n\t\t\t// This will bet reset to actual content width/height\r\n\t\t\tif (this.maxWidth) {\r\n\t\t\t\tfo.attr({\r\n\t\t\t\t\twidth: this.maxWidth - this.pixelPaddingLeft - this.pixelPaddingRight\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (this.maxHeight) {\r\n\t\t\t\tfo.attr({\r\n\t\t\t\t\theight: this.maxHeight - this.pixelPaddingTop - this.pixelPaddingBottom\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Create line element\r\n\t\t\t//let lineElement: HTMLElement = this.getHTMLLineElement(getTextFormatter().format(this.html, output));\r\n\t\t\tlet lineElement: HTMLElement = this.getHTMLLineElement(text);\r\n\t\t\tfo.node.appendChild(lineElement);\r\n\r\n\t\t\t// Temporarily set to inline-block so we can measure real width and height\r\n\t\t\tlineElement.style.display = \"inline-block\";\r\n\t\t\tconst clientWidth = lineElement.clientWidth;\r\n\t\t\tconst clientHeight = lineElement.clientHeight;\r\n\r\n\t\t\tlineElement.style.display = \"block\";\r\n\t\t\tthis._bbox = {\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0,\r\n\t\t\t\twidth: clientWidth,\r\n\t\t\t\theight: clientHeight\r\n\t\t\t};\r\n\r\n\t\t\t// Set exact dimensions of foreignObject so it is sized exactly as\r\n\t\t\t// the content within (add one pixel to width so it does not wrap)\r\n\t\t\tfo.attr({\r\n\t\t\t\twidth: clientWidth + 1,\r\n\t\t\t\theight: clientHeight\r\n\t\t\t});\r\n\r\n\t\t\t// Check if maybe we need to hide the whole label if it doesn't fit\r\n\t\t\tthis.maybeHideOversized();\r\n\r\n\t\t\t// Set measurements and update bbox\r\n\t\t\tthis._measuredWidth = $math.max(this.bbox.width, this.pixelWidth - this.pixelPaddingLeft - this.pixelPaddingRight);\r\n\t\t\tthis._measuredHeight = $math.max(this.bbox.height, this.pixelHeight - this.pixelPaddingTop - this.pixelPaddingBottom);\r\n\r\n\t\t\tthis.bbox.width = this._measuredWidth;\r\n\t\t\tthis.bbox.height = this._measuredHeight;\r\n\r\n\t\t\t// Don't let labels bleed out of the alotted area\r\n\t\t\tif (this.truncate) {\r\n\t\t\t\tlineElement.style.overflow = \"hidden\";\r\n\t\t\t}\r\n\r\n\t\t\tif ((clientWidth > maxWidth) || (clientHeight > maxHeight)) {\r\n\t\t\t\tthis.isOversized = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\t// Set applicable styles\r\n\t\tthis.setStyles();\r\n\t\tthis.updateCenter();\r\n\t\tthis.updateBackground();\r\n\r\n\t\tif (display == \"none\") {\r\n\t\t\tthis.group.attr({ display: \"none\" });\r\n\t\t}\r\n\r\n\t\tif (this.pathElement) {\r\n\t\t\tthis.paper.appendDef(this.pathElement);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hides element if it does not fit into available space\r\n\t */\r\n\tprivate maybeHideOversized(): void {\r\n\t\tif (this.hideOversized) {\r\n\t\t\tif ((this.availableWidth < this.bbox.width) || (this.availableHeight < this.bbox.height)) {\r\n\t\t\t\tthis.element.attr({ display: \"none\" });\r\n\t\t\t\tthis.isOversized = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.element.removeAttr(\"display\");\r\n\t\t\t\tthis.isOversized = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Aligns the lines horizontally ant vertically, based on properties.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic alignSVGText(): void {\r\n\t\t// Get Group\r\n\t\tlet group: Group = <Group>this.element;\r\n\t\tlet children = group.node.children || group.node.childNodes;\r\n\r\n\t\t// Is there anything to align?\r\n\t\tif (!children || (children && children.length == 0)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet width = this._measuredWidth;\r\n\t\tlet height = this._measuredHeight;\r\n\r\n\t\t// TODO maybe these aren't needed ?\r\n\t\t$utils.used(this.pixelPaddingLeft);\r\n\t\t$utils.used(this.pixelPaddingRight);\r\n\t\t$utils.used(this.pixelPaddingTop);\r\n\t\t$utils.used(this.pixelPaddingBottom);\r\n\r\n\t\tif (this.rtl) {\r\n\t\t\tgroup.attr({\r\n\t\t\t\t\"direction\": \"rtl\"\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tgroup.removeAttr(\"direction\");\r\n\t\t}\r\n\r\n\t\t// Process each line\r\n\t\t//$iter.each(group.children.backwards().iterator(), (element) => {\r\n\t\tfor (let i = children.length - 1; i >= 0; i--) {\r\n\t\t\t// Align horizontally\r\n\t\t\t// Since we are using `text-anchor` for horizontal alignment, all we need\r\n\t\t\t// to do here is move the `x` position\r\n\t\t\tlet node = <SVGElement>children[i];\r\n\r\n\t\t\tnode.setAttribute(\"text-anchor\", this.textAlign);\r\n\r\n\t\t\tif (this.textPathElement) {\r\n\t\t\t\tnode.removeAttribute(\"x\");\r\n\t\t\t\tnode.removeAttribute(\"y\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tswitch (this.textAlign) {\r\n\t\t\t\t\tcase \"middle\":\r\n\t\t\t\t\t\tnode.setAttribute(\"x\", (width / 2).toString() + \"px\");\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"end\":\r\n\t\t\t\t\t\tif (this.rtl) {\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tnode.setAttribute(\"x\", width.toString());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tif (this.rtl) {\r\n\t\t\t\t\t\t\tnode.setAttribute(\"x\", width.toString());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tnode.removeAttribute(\"text-anchor\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet y = $type.toNumber(node.getAttribute(\"y\"));\r\n\r\n\t\t\t\tswitch (this.textValign) {\r\n\t\t\t\t\tcase \"middle\":\r\n\t\t\t\t\t\tnode.setAttribute(\"y\", ((y || 0) + (height - this.bbox.height) / 2).toString());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"bottom\":\r\n\t\t\t\t\t\tnode.setAttribute(\"y\", ((y || 0) + height - this.bbox.height).toString());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tnode.setAttribute(\"y\", (y || 0).toString());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Produces an SVG line element with formatted text.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text    Text to wrap into line\r\n\t * @param y       Current line vertical position\r\n\t * @return A DOM element\r\n\t * @todo Implement HTML support\r\n\t */\r\n\tpublic getSVGLineElement(text: string, y?: number): Group {\r\n\r\n\t\t// Create a <text> node and set text\r\n\t\tlet element: Group = this.paper.addGroup(\"text\");\r\n\t\telement.textContent = text;\r\n\r\n\t\t// Set parameters\r\n\t\telement.attr({\r\n\t\t\t\"x\": \"0\"\r\n\t\t\t//\"alignment-baseline\": \"hanging\",\r\n\t\t\t//\"baseline-shift\": \"-20%\",\r\n\t\t\t//\"text-anchor\": \"center\"\r\n\t\t});\r\n\r\n\t\t// Set `y` position\r\n\t\tif ($type.hasValue(y)) {\r\n\t\t\telement.attr({\r\n\t\t\t\t\"y\": y.toString()\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Don't let labels blled out of the alotted area\r\n\t\tif (this.truncate || this.wrap) {\r\n\t\t\telement.attr({ \"overflow\": \"hidden\" });\r\n\t\t}\r\n\r\n\t\t// Add RTL?\r\n\t\t// This has now been moved to this.alignSVGText()\r\n\t\t// if (this.rtl) {\r\n\t\t// \telement.attr({\r\n\t\t// \t\t\"direction\": \"rtl\",\r\n\t\t// \t\t//\"unicode-bidi\": \"bidi-override\"\r\n\t\t// \t});\r\n\t\t// }\r\n\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * An RTL (right-to-left) setting.\r\n\t *\r\n\t * RTL may affect alignment, text, and other visual properties.\r\n\t *\r\n\t * If you set this on a top-level chart object, it will be used for all\r\n\t * child elements, e.g. labels, unless they have their own `rtl` setting\r\n\t * set directly on them.\r\n\t *\r\n\t * @param value  `true` for to use RTL\r\n\t */\r\n\tpublic set rtl(value: boolean) {\r\n\t\tvalue = $type.toBoolean(value);\r\n\t\tthis._rtl = value;\r\n\t\tif (this.element) {\r\n\t\t\tthis.alignSVGText();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return RTL?\r\n\t */\r\n\tpublic get rtl(): boolean {\r\n\t\tif ($type.hasValue(this._rtl)) {\r\n\t\t\treturn this._rtl;\r\n\t\t}\r\n\t\telse if (this._topParent) {\r\n\t\t\treturn this._topParent.rtl;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Resets cached BBox.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic resetBBox(): void {\r\n\t\tthis._bbox = { x: 0, y: 0, width: 0, height: 0 };\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Creates and returns an HTML line element (`<div>`).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text  Text to add\r\n\t * @return `<div>` element reference\r\n\t */\r\n\tpublic getHTMLLineElement(text: string): HTMLElement {\r\n\r\n\t\t// Create the <div> element\r\n\t\tlet div: HTMLElement = document.createElement(\"div\");\r\n\t\tdiv.innerHTML = text;\r\n\r\n\t\t// Set text alignment\r\n\t\tswitch (this.textAlign) {\r\n\t\t\tcase \"middle\":\r\n\t\t\t\tdiv.style.textAlign = \"center\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"end\":\r\n\t\t\t\tdiv.style.textAlign = \"right\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t// Disable or enable wrapping\r\n\t\tif (this.wrap) {\r\n\t\t\tdiv.style.wordWrap = \"break-word\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdiv.style.whiteSpace = \"nowrap\";\r\n\t\t}\r\n\r\n\t\t// Don't let labels bleed out of the alotted area\r\n\t\t// Moved to `draw()` because setting \"hidden\" kills all measuring\r\n\t\t/*if (this.truncate) {\r\n\t\t\tdiv.style.overflow = \"hidden\";\r\n\t\t}*/\r\n\r\n\t\t// Set RTL-related styles\r\n\t\tif (this.rtl) {\r\n\t\t\tdiv.style.direction = \"rtl\";\r\n\t\t\t//div.style.unicodeBidi = \"bidi-override\";\r\n\t\t}\r\n\r\n\t\t// Translate some of the SVG styles into CSS\r\n\t\tif ($type.hasValue(this.fill)) {\r\n\t\t\tdiv.style.color = this.fill.toString();\r\n\t\t}\r\n\r\n\t\treturn div;\r\n\t}\r\n\r\n\t/**\r\n\t * Applies specific styles to text to make it not selectable, unless it is\r\n\t * explicitly set as `selectable`.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Set styles via AMElement\r\n\t */\r\n\tpublic setStyles(): void {\r\n\t\tlet group: Group = <Group>this.element;\r\n\t\tif (!this.selectable || this.draggable || this.resizable || this.swipeable) {\r\n\t\t\tgroup.addStyle({\r\n\t\t\t\t\"webkitUserSelect\": \"none\",\r\n\t\t\t\t\"msUserSelect\": \"none\"\r\n\t\t\t});\r\n\t\t}\r\n\t\telse if (this.selectable) {\r\n\t\t\tgroup.removeStyle(\"webkitUserSelect\");\r\n\t\t\tgroup.removeStyle(\"msUserSelect\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hides unused lines\r\n\t */\r\n\tprotected hideUnused(index: number) {\r\n\t\tthis.initLineCache();\r\n\t\tlet lines: ITextLineInfo[] = this.getCache(\"lineInfo\");\r\n\t\tif (lines.length >= index) {\r\n\t\t\tfor (let i = index; i < lines.length; i++) {\r\n\t\t\t\tlet line = lines[i];\r\n\t\t\t\tif (line && line.element) {\r\n\t\t\t\t\tline.element.attr({ \"display\": \"none\" });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * An SVG text.\r\n\t *\r\n\t * Please note that setting `html` will override this setting if browser\r\n\t * supports `foreignObject` in SGV, such as most modern browsers excluding\r\n\t * IEs.\r\n\t *\r\n\t * @param value  SVG Text\r\n\t */\r\n\tpublic set text(value: string) {\r\n\t\t//this.setPropertyValue(\"html\", undefined);\r\n\t\tthis.setPropertyValue(\"text\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return SVG text\r\n\t */\r\n\tpublic get text(): string {\r\n\t\treturn this.getPropertyValue(\"text\");\r\n\t}\r\n\r\n\t/**\r\n\t * An SVG path string to position text along. If set, the text will follow\r\n\t * the curvature of the path.\r\n\t *\r\n\t * Location along the path can be set using `locationOnPath`.\r\n\t *\r\n\t * IMPORTANT: Only SVG text can be put on path. If you are using HTML text\r\n\t * this setting will be ignored.\r\n\t *\r\n\t * @since 4.1.2\r\n\t * @param  value  Path\r\n\t */\r\n\tpublic set path(value: string) {\r\n\t\tif (this.setPropertyValue(\"path\", value, true)) {\r\n\t\t\tif (this.pathElement) {\r\n\t\t\t\tthis.pathElement.dispose();\r\n\t\t\t}\r\n\r\n\t\t\tif (this.textPathElement) {\r\n\t\t\t\tthis.textPathElement.dispose();\r\n\t\t\t}\r\n\r\n\t\t\tthis.pathElement = this.paper.add(\"path\");\r\n\t\t\tthis.pathElement.attr({ \"d\": value });\r\n\t\t\tthis.pathElement.attr({ \"id\": \"text-path-\" + this.uid });\r\n\t\t\tthis._disposers.push(this.pathElement);\r\n\r\n\t\t\tthis.textPathElement = this.paper.addGroup(\"textPath\");\r\n\t\t\tthis.textPathElement.attrNS($dom.XLINK, \"xlink:href\", \"#text-path-\" + this.uid);\r\n\t\t\t// TODO remove after https://bugzilla.mozilla.org/show_bug.cgi?id=455986 is fixed\r\n\t\t\tthis.textPathElement.attr({ \"path\": value });\r\n\t\t\tthis._disposers.push(this.textPathElement);\r\n\t\t\tthis.hardInvalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Path\r\n\t */\r\n\tpublic get path(): string {\r\n\t\treturn this.getPropertyValue(\"path\");\r\n\t}\r\n\r\n\t/**\r\n\t * Relative label location on `path`. Value range is from 0 (beginning)\r\n\t * to 1 (end).\r\n\t *\r\n\t * Works only if you set `path` setting to an SVG path.\r\n\t *\r\n\t * @since 4.1.2\r\n\t * @default 0\r\n\t * @param  value  Relatvie location on path\r\n\t */\r\n\tpublic set locationOnPath(value: number) {\r\n\t\tthis.setPropertyValue(\"locationOnPath\", value);\r\n\t\tif (this.textPathElement) {\r\n\t\t\tthis.textPathElement.attr({ \"startOffset\": (value * 100) + \"%\" })\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Relatvie location on path\r\n\t */\r\n\tpublic get locationOnPath(): number {\r\n\t\treturn this.getPropertyValue(\"locationOnPath\");\r\n\t}\r\n\r\n\t/**\r\n\t * A ratio to calculate text baseline. Ralative distance from the bottom of\r\n\t * the label.\r\n\t *\r\n\t * @since 4.4.2\r\n\t * @default -0.27\r\n\t * @param  value  Base line ratio\r\n\t */\r\n\tpublic set baseLineRatio(value: number) {\r\n\t\tthis.setPropertyValue(\"baseLineRatio\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Base line ratio\r\n\t */\r\n\tpublic get baseLineRatio(): number {\r\n\t\treturn this.getPropertyValue(\"baseLineRatio\");\r\n\t}\r\n\r\n\t/**\r\n\t * Enables or disables autowrapping of text.\r\n\t *\r\n\t * @param value  Auto-wrapping enabled\r\n\t */\r\n\tpublic set wrap(value: boolean) {\r\n\t\tthis.resetBBox();\r\n\t\tthis.setPropertyValue(\"wrap\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Auto-wrap enabled or not\r\n\t */\r\n\tpublic get wrap(): boolean {\r\n\t\treturn this.getPropertyValue(\"wrap\");\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if text lines need to be truncated if they do not fit, using\r\n\t * configurable `ellipsis` string.\r\n\t *\r\n\t * `truncate` overrides `wrap` if both are set to `true`.\r\n\t *\r\n\t * NOTE: For HTML text, this setting **won't** trigger a parser and actual\r\n\t * line truncation with ellipsis. It will just hide everything that goes\r\n\t * outside the label.\r\n\t *\r\n\t * @param value  trincate text?\r\n\t */\r\n\tpublic set truncate(value: boolean) {\r\n\t\tthis.resetBBox();\r\n\t\tthis.setPropertyValue(\"truncate\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Truncate text?\r\n\t */\r\n\tpublic get truncate(): boolean {\r\n\t\treturn this.getPropertyValue(\"truncate\");\r\n\t}\r\n\r\n\t/**\r\n\t * If `truncate` is enabled, should Label try to break only on full words\r\n\t * (`true`), or whenever needed, including middle of the word. (`false`)\r\n\t *\r\n\t * @default true\r\n\t * @param value  Truncate on full words?\r\n\t */\r\n\tpublic set fullWords(value: boolean) {\r\n\t\tthis.setPropertyValue(\"fullWords\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Truncate on full words?\r\n\t */\r\n\tpublic get fullWords(): boolean {\r\n\t\treturn this.getPropertyValue(\"fullWords\");\r\n\t}\r\n\r\n\t/**\r\n\t * Ellipsis character to use if `truncate` is enabled.\r\n\t *\r\n\t * @param value Ellipsis string\r\n\t * @default \"...\"\r\n\t */\r\n\tpublic set ellipsis(value: string) {\r\n\t\tthis.setPropertyValue(\"ellipsis\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Ellipsis string\r\n\t */\r\n\tpublic get ellipsis(): string {\r\n\t\treturn this.getPropertyValue(\"ellipsis\");\r\n\t}\r\n\r\n\t/**\r\n\t * Forces the text to be selectable. This setting will be ignored if the\r\n\t * object has some kind of interaction attached to it, such as it is\r\n\t * `draggable`, `swipeable`, `resizable`.\r\n\t *\r\n\t * @param value  Text selectable?\r\n\t * @default false\r\n\t */\r\n\tpublic set selectable(value: boolean) {\r\n\t\tthis.setPropertyValue(\"selectable\", value, true);\r\n\t\tthis.setStyles();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Text selectable?\r\n\t */\r\n\tpublic get selectable(): boolean {\r\n\t\treturn this.getPropertyValue(\"selectable\");\r\n\t}\r\n\r\n\t/**\r\n\t * Horizontal text alignment.\r\n\t *\r\n\t * Available choices:\r\n\t * * \"start\"\r\n\t * * \"middle\"\r\n\t * * \"end\"\r\n\t *\r\n\t * @param value  Alignment\r\n\t */\r\n\tpublic set textAlign(value: TextAlign) {\r\n\t\tthis.setPropertyValue(\"textAlign\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Alignment\r\n\t */\r\n\tpublic get textAlign(): TextAlign {\r\n\t\treturn this.getPropertyValue(\"textAlign\");\r\n\t}\r\n\r\n\t/**\r\n\t * Vertical text alignment.\r\n\t *\r\n\t * @ignore Exclude from docs (not used)\r\n\t * @param value  Alignment\r\n\t * @deprecated\r\n\t */\r\n\tpublic set textValign(value: TextValign) {\r\n\t\tthis.setPropertyValue(\"textValign\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs (not used)\r\n\t * @return Alignment\r\n\t * @deprecated\r\n\t */\r\n\tpublic get textValign(): TextValign {\r\n\t\treturn this.getPropertyValue(\"textValign\");\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Raw HTML to be used as text.\r\n\t *\r\n\t * NOTE: HTML text is subject to browser support. It relies on browsers\r\n\t * supporting SVG `foreignObject` nodes. Some browsers (read IEs) do not\r\n\t * support it. On those browsers, the text will fall back to basic SVG text,\r\n\t * striping out all HTML markup and styling that goes with it.\r\n\t *\r\n\t * For more information about `foreignObject` and its browser compatibility\r\n\t * refer to [this page](https://developer.mozilla.org/en/docs/Web/SVG/Element/foreignObject#Browser_compatibility).\r\n\t *\r\n\t * @param value HTML text\r\n\t */\r\n\tpublic set html(value: string) {\r\n\t\tthis.setPropertyValue(\"html\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return HTML content\r\n\t */\r\n\tpublic get html(): string {\r\n\t\treturn this.getPropertyValue(\"html\");\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether the whole text should be hidden if it does not fit into\r\n\t * its allotted space.\r\n\t *\r\n\t * @param value  Hide if text does not fit?\r\n\t */\r\n\tpublic set hideOversized(value: boolean) {\r\n\t\tthis.setPropertyValue(\"hideOversized\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Hide if text does not fit?\r\n\t */\r\n\tpublic get hideOversized(): boolean {\r\n\t\treturn this.getPropertyValue(\"hideOversized\");\r\n\t}\r\n\r\n\t/**\r\n\t * If set to `true` square-bracket formatting blocks will be treated as\r\n\t * regular text.\r\n\t *\r\n\t * @default false\r\n\t * @param value  Ignore formatting?\r\n\t */\r\n\tpublic set ignoreFormatting(value: boolean) {\r\n\t\tthis.setPropertyValue(\"ignoreFormatting\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Ignore formatting?\r\n\t */\r\n\tpublic get ignoreFormatting(): boolean {\r\n\t\treturn this.getPropertyValue(\"ignoreFormatting\");\r\n\t}\r\n\r\n\t/**\r\n\t * Override `mesaureElement` so it does not get measure again, because\r\n\t * internal `_bbox` is being updated by measuring routines in Text itself.\r\n\t */\r\n\tpublic measureElement(): void { }\r\n\r\n\t/**\r\n\t * Returns information about a line element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param index  Line index\r\n\t * @return Line info object\r\n\t */\r\n\tpublic getLineInfo(index: number): ITextLineInfo {\r\n\t\tthis.initLineCache();\r\n\t\tlet lines = this.getCache(\"lineInfo\");\r\n\t\treturn lines.length > index ? lines[index] : undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a line to line info cache.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param line     Line info object\r\n\t * @param index    Insert at specified index\r\n\t */\r\n\tpublic addLineInfo(line: ITextLineInfo, index: number): void {\r\n\t\tthis.initLineCache();\r\n\t\tthis.getCache(\"lineInfo\")[index] = line;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if line cache is initialized and initializes it.\r\n\t */\r\n\tprivate initLineCache(): void {\r\n\t\tif (!$type.hasValue(this.getCache(\"lineInfo\"))) {\r\n\t\t\tthis.setCache(\"lineInfo\", [], 0);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a [[DataItem]] to use for populating dynamic sections of the text.\r\n\t *\r\n\t * Check the description for [[Text]] class, for data binding.\r\n\t *\r\n\t * @param dataItem Data item\r\n\t */\r\n\tpublic setDataItem(dataItem: DataItem): void {\r\n\t\tif (this._sourceDataItemEvents) {\r\n\t\t\tthis._sourceDataItemEvents.dispose();\r\n\t\t}\r\n\t\tif (dataItem) {\r\n\t\t\tthis._sourceDataItemEvents = new MultiDisposer([\r\n\t\t\t\tdataItem.events.on(\"valuechanged\", this.invalidate, this, false),\r\n\t\t\t\tdataItem.events.on(\"workingvaluechanged\", this.invalidate, this, false),\r\n\t\t\t\tdataItem.events.on(\"calculatedvaluechanged\", this.invalidate, this, false),\r\n\t\t\t\tdataItem.events.on(\"propertychanged\", this.invalidate, this, false)\r\n\t\t\t]);\r\n\t\t}\r\n\t\tsuper.setDataItem(dataItem);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns available horizontal space.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Available width (px)\r\n\t */\r\n\tpublic get availableWidth(): number {\r\n\t\treturn $type.hasValue(this.maxWidth) ? this.maxWidth : this.pixelWidth;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns available vertical space.\r\n\t *\r\n\t * @return Available height (px)\r\n\t */\r\n\tpublic get availableHeight(): number {\r\n\t\treturn $type.hasValue(this.maxHeight) ? this.maxHeight : this.pixelHeight;\r\n\t}\r\n\r\n\t// temp, replacing textFormatter method\r\n\tpublic getSvgElement(text: string, style?: string, parent?: Group): AMElement {\r\n\t\tlet element = this.paper.add(\"tspan\");\r\n\t\telement.textContent = text;\r\n\t\tif (style) {\r\n\r\n\t\t\tif (options.nonce && parent) {\r\n\t\t\t\t//element.node.setAttribute(\"nonce\", \"test123\");\r\n\t\t\t\tconst classid = \"amcharts_element_style_\" + btoa(style).replace(/[^\\w]*/g, \"\");\r\n\t\t\t\telement.node.setAttribute(\"class\", classid);\r\n\r\n\t\t\t\tconst defs = <SVGDefsElement>document.createElementNS($dom.SVGNS, \"defs\");\r\n\t\t\t\tparent.node.appendChild(defs);\r\n\r\n\t\t\t\tconst e = document.createElement(\"style\");\r\n\t\t\t\te.type = \"text/css\";\r\n\t\t\t\te.innerHTML = \".\" + classid + \" { \" + style + \"}\";\r\n\t\t\t\te.setAttribute(\"nonce\", options.nonce)\r\n\t\t\t\tdefs.appendChild(e);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\telement.node.setAttribute(\"style\", style);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (parent) {\r\n\t\t\tparent.add(element);\r\n\t\t}\r\n\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates the whole element, including layout AND all its child\r\n\t * elements.\r\n\t */\r\n\tpublic deepInvalidate() {\r\n\t\tsuper.deepInvalidate();\r\n\t\tthis.hardInvalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * Screen reader title of the element.\r\n\t *\r\n\t * @param value Title\r\n\t */\r\n\tpublic set readerTitle(value: string) {\r\n\t\tvalue = $type.toText(value);\r\n\t\tif (this.setPropertyValue(\"readerTitle\", value)) {\r\n\t\t\tthis.applyAccessibility();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Title\r\n\t */\r\n\tpublic get readerTitle(): string {\r\n\t\tlet title = this.getPropertyValue(\"readerTitle\");\r\n\t\tif (!title) {\r\n\t\t\ttitle = this.populateString(\r\n\t\t\t\t$utils.plainText(\r\n\t\t\t\t\t$utils.isNotEmpty(this.html)\r\n\t\t\t\t\t\t? this.html\r\n\t\t\t\t\t\t: this.text\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t}\r\n\t\telse if (this.dataItem) {\r\n\t\t\ttitle = this.populateString(title);\r\n\t\t}\r\n\t\treturn title;\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Label\"] = Label;\r\n\r\n/**\r\n * Add default responsive rules\r\n */\r\n\r\n/**\r\n * Hide labels added directly to chart, like titles if chart is short.\r\n */\r\ndefaultRules.push({\r\n\trelevant: ResponsiveBreakpoints.heightXS,\r\n\tstate: function(target, stateId) {\r\n\t\tif (target instanceof Label && target.parent && target.parent.isBaseSprite) {\r\n\t\t\tlet state = target.states.create(stateId);\r\n\t\t\tstate.properties.disabled = true;\r\n\t\t\treturn state;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n});\r\n","/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { registry, is } from \"./Registry\";\r\nimport { Sprite } from \"./Sprite\";\r\nimport { Container } from \"./Container\";\r\nimport { Component } from \"./Component\";\r\nimport { Label } from \"./elements/Label\";\r\nimport { raf } from \"./utils/AsyncPending\";\r\nimport { IAnimationObject } from \"./utils/Animation\";\r\nimport { triggerIdle } from \"./utils/AsyncPending\";\r\nimport * as $array from \"./utils/Array\";\r\nimport * as $object from \"./utils/Object\";\r\nimport * as $type from \"./utils/Type\";\r\nimport * as $log from \"./utils/Log\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * The main class that handles system-wide tasks, like caching, heartbeats, etc.\r\n * @important\r\n */\r\nexport class System {\r\n\t/**\r\n\t * A flag indicating if the system is on pause.\r\n\t */\r\n\tprotected _isPaused: boolean = false;\r\n\r\n\t/**\r\n\t * Holds the list of currently playing animations.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic animations: Array<IAnimationObject> = [];\r\n\r\n\t/**\r\n\t * Unique ID of the object.\r\n\t */\r\n\tpublic uid: string = registry.getUniqueId();\r\n\r\n\t/**\r\n\t * amCharts Version.\r\n\t *\r\n\t * This follows npm's semver specification.\r\n\t *\r\n\t * @see {@link https://docs.npmjs.com/misc/semver}\r\n\t */\r\n\tstatic VERSION: string = \"4.10.22\";\r\n\r\n\t/**\r\n\t * @todo Description\r\n\t * @todo Needed?\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic dummyCounter: number = 0;\r\n\r\n\t/**\r\n\t * @todo Description\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic time: number;\r\n\r\n\r\n\tprotected _frameRequested: boolean = false;\r\n\r\n\tpublic updateStepDuration: number = 45;\r\n\r\n\t/**\r\n\t * Performs initialization of the System object.\r\n\t *\r\n\t * Called when the first [[Sprite]] object is created.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic constructor() {\r\n\t\tthis.time = Date.now();\r\n\t}\r\n\r\n\t/**\r\n\t * Reports time elapsed since timer was reset.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Needed?\r\n\t * @param msg    Message to report in console\r\n\t * @param reset  Reset time counter\r\n\t */\r\n\tpublic reportTime(msg: string, reset?: boolean): void {\r\n\t\tif (this.dummyCounter < 6) {\r\n\t\t\t//console.log(Date.now() - this.time, msg, this.dummyCounter2);\r\n\t\t}\r\n\t\tif (reset) {\r\n\t\t\tthis.time = Date.now();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Performs \"heartbeat\" operations `frameRate` number of times per second.\r\n\t *\r\n\t * When the chart element is invalidated, it is not immediately redrawn.\r\n\t *\r\n\t * Instead it waits for the next `update()` cycle to be re-validated.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Maybe should be private?\r\n\t */\r\n\tpublic update(): void {\r\n\r\n\t\tif (this._isPaused) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._frameRequested = false;\r\n\r\n\t\tlet time = Date.now();\r\n\r\n\t\tregistry.dispatchImmediately(\"enterframe\");\r\n\r\n\t\t//this.validateLayouts();\r\n\t\t//this.validatePositions();\r\n\t\t/*\r\n\t\t\t\tfor (let key in registry.invalidLayouts) {\r\n\t\t\t\t\tthis.validateLayouts(key);\r\n\t\t\t\t}\r\n\t\t\t\tfor (let key in registry.invalidPositions) {\r\n\t\t\t\t\tthis.validatePositions(key);\r\n\t\t\t\t}\r\n\t\t*/\r\n\r\n\t\tlet skippedComponents: Component[] = [];\r\n\r\n\t\t// data objects first - do all calculations\r\n\t\t// only data is parsed in chunks, thats why we do for loop instead of a while like with other invalid items.\r\n\t\t// important to go backwards, as items are removed!\r\n\t\t// TODO use iterator instead\r\n\r\n\t\tfor (let key in registry.invalidDatas) {\r\n\t\t\tif ($object.hasKey(registry.invalidDatas, key)) {\r\n\t\t\t\tlet invalidData = registry.invalidDatas[key];\r\n\r\n\t\t\t\twhile (invalidData.length > 0) {\r\n\t\t\t\t\tlet component: Component = invalidData[0];\r\n\t\t\t\t\tlet dataProvider: $type.Optional<Component> = component.dataProvider;\r\n\r\n\t\t\t\t\tif (!component.isDisposed()) {\r\n\r\n\t\t\t\t\t\tif (dataProvider && dataProvider.dataInvalid) {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tdataProvider.validateData();\r\n\t\t\t\t\t\t\t\tif (dataProvider.dataValidationProgress < 1) {\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcatch (e) {\r\n\t\t\t\t\t\t\t\t$array.remove(invalidData, dataProvider);\r\n\t\t\t\t\t\t\t\tdataProvider.raiseCriticalError(e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tcomponent.validateData();\r\n\t\t\t\t\t\t\t\tif (component.dataValidationProgress < 1) {\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcatch (e) {\r\n\t\t\t\t\t\t\t\t$array.remove(invalidData, component);\r\n\t\t\t\t\t\t\t\tcomponent.raiseCriticalError(e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t$array.remove(invalidData, component);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (Date.now() - time > this.updateStepDuration) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twhile (registry.invalidRawDatas.length > 0) {\r\n\t\t\tlet component: Component = registry.invalidRawDatas[0];\r\n\t\t\tif (!component.isDisposed()) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcomponent.validateRawData();\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\t$array.remove(registry.invalidRawDatas, component);\r\n\t\t\t\t\tcomponent.raiseCriticalError(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t$array.remove(registry.invalidRawDatas, component);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// TODO use iterator instead\r\n\t\twhile (registry.invalidDataItems.length > 0) {\r\n\t\t\tlet component: Component = registry.invalidDataItems[0];\r\n\r\n\t\t\tlet dataProvider: $type.Optional<Component> = component.dataProvider;\r\n\r\n\t\t\t// this is needed to avoid partial value validation when data is parsed in chunks\r\n\t\t\tif (component.isDisposed() || component.dataInvalid || (dataProvider && dataProvider.dataInvalid)) {\r\n\t\t\t\t// void\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcomponent.validateDataItems();\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\t$array.remove(registry.invalidDataItems, component);\r\n\t\t\t\t\tcomponent.raiseCriticalError(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// this might seem too much, as validateValues removes from invalidDataItems aswell, but just to be sure (in case validateData is overriden and no super is called)\r\n\t\t\t$array.remove(registry.invalidDataItems, component);\r\n\t\t}\r\n\r\n\t\t// TODO use iterator instead\r\n\t\twhile (registry.invalidDataRange.length > 0) {\r\n\t\t\tlet component: Component = registry.invalidDataRange[0];\r\n\r\n\t\t\tlet dataProvider: $type.Optional<Component> = component.dataProvider;\r\n\r\n\t\t\tif (component.isDisposed() || component.dataInvalid || (dataProvider && dataProvider.dataInvalid)) {\r\n\t\t\t\t// void\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcomponent.validateDataRange();\r\n\t\t\t\t\tif (!component.skipRangeEvent) {\r\n\t\t\t\t\t\tcomponent.dispatchImmediately(\"datarangechanged\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcomponent.skipRangeEvent = false;\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\t$array.remove(registry.invalidDataRange, component);\r\n\t\t\t\t\tcomponent.raiseCriticalError(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// this might seem too much, as validateDataRange removes from invalidDataRange aswell, but just to be sure (in case validateData is overriden and no super is called)\r\n\t\t\t$array.remove(registry.invalidDataRange, component);\r\n\t\t}\r\n\r\n\t\tlet skippedSprites: Sprite[] = [];\r\n\r\n\t\t// display objects later\r\n\t\t// TODO use iterator instead\r\n\r\n\t\t$object.each(registry.invalidLayouts, (key) => {\r\n\t\t\tthis.validateLayouts(key);\r\n\t\t});\r\n\r\n\t\t$object.each(registry.invalidPositions, (key) => {\r\n\t\t\tthis.validatePositions(key);\r\n\t\t});\r\n\r\n\r\n\t\tlet hasSkipped: boolean = false;\r\n\r\n\t\ttime = Date.now();\r\n\r\n\t\t$object.each(registry.invalidSprites, (key, invalidSprites) => {\r\n\t\t\tlet count = 0;\r\n\r\n\t\t\twhile (invalidSprites.length > 0) {\r\n\t\t\t\tthis.validateLayouts(key);\r\n\t\t\t\tthis.validatePositions(key);\r\n\r\n\t\t\t\tcount++;\r\n\r\n\t\t\t\tif (count == 5) {\r\n\t\t\t\t\tif (Date.now() - time > this.updateStepDuration) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcount = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet sprite: Sprite = invalidSprites[invalidSprites.length - 1];\r\n\r\n\t\t\t\t// we need to check this, as validateLayout might validate sprite\r\n\t\t\t\tif (sprite && !sprite.isDisposed()) {\r\n\t\t\t\t\tif (!sprite._systemCheckIfValidate()) {\r\n\t\t\t\t\t\t// void\r\n\t\t\t\t\t\tskippedSprites.push(sprite);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (!this.checkIfValidate2(sprite)) {\r\n\t\t\t\t\t\t\t// void\r\n\t\t\t\t\t\t\tskippedSprites.push(sprite);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\tsprite._systemUpdate(skippedSprites);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcatch (e) {\r\n\t\t\t\t\t\t\t\tsprite.invalid = false;\r\n\t\t\t\t\t\t\t\t$array.remove(invalidSprites, sprite);\r\n\t\t\t\t\t\t\t\tsprite.raiseCriticalError(e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// this might seem too much, but it's ok\r\n\t\t\t\t\tsprite.invalid = false;\r\n\t\t\t\t}\r\n\t\t\t\t$array.remove(invalidSprites, sprite);\r\n\t\t\t}\r\n\r\n\t\t\tregistry.invalidSprites[key] = registry.invalidSprites[key].concat(skippedSprites);\r\n\t\t});\r\n\r\n\t\t$object.each(registry.invalidSprites, (key, value) => {\r\n\t\t\tif (value.length > 0) {\r\n\t\t\t\thasSkipped = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$object.each(registry.invalidDatas, (key, value) => {\r\n\t\t\tif (value.length > 0) {\r\n\t\t\t\thasSkipped = true;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// TODO make this more efficient\r\n\t\t// TODO don't copy the array\r\n\t\t$array.each($array.copy(this.animations), (x) => {\r\n\t\t\tx.update();\r\n\t\t});\r\n\r\n\t\t//if(!hasSkipped){\r\n\t\t$object.each(registry.invalidLayouts, (key) => {\r\n\t\t\tthis.validateLayouts(key);\r\n\t\t});\r\n\r\n\t\t$object.each(registry.invalidPositions, (key) => {\r\n\t\t\tthis.validatePositions(key);\r\n\t\t});\r\n\t\t//}\r\n\r\n\t\ttriggerIdle();\r\n\r\n\t\t$object.each(registry.invalidLayouts, (key) => {\r\n\t\t\tthis.validateLayouts(key);\r\n\t\t});\r\n\r\n\t\t$object.each(registry.invalidPositions, (key) => {\r\n\t\t\tthis.validatePositions(key);\r\n\t\t});\r\n\r\n\r\n\t\tregistry.dispatchImmediately(\"exitframe\");\r\n\r\n\t\tif (hasSkipped || this.animations.length > 0 || skippedComponents.length > 0) {\r\n\t\t\tthis.requestFrame();\r\n\t\t}\r\n\r\n\t\tif (this.updateStepDuration < 200) {\r\n\t\t\tlet all0 = true;\r\n\r\n\t\t\t$object.each(registry.invalidDatas, (key, value) => {\r\n\t\t\t\tif (value.length > 0) {\r\n\t\t\t\t\tall0 = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$object.each(registry.invalidSprites, (key, value) => {\r\n\t\t\t\tif (value.length > 0) {\r\n\t\t\t\t\tall0 = false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (all0) {\r\n\t\t\t\tthis.updateStepDuration = 200;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic checkIfValidate2(sprite: Sprite): boolean {\r\n\t\tif (sprite.dataItem && sprite.dataItem.component && sprite.dataItem.component.dataInvalid && !sprite.dataItem.component.isTemplate) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Requests new animation frame\r\n\t */\r\n\tpublic requestFrame() {\r\n\t\tif (!this._frameRequested) {\r\n\r\n\t\t\traf(() => {\r\n\t\t\t\tthis.update();\r\n\t\t\t});\r\n\t\t\tthis._frameRequested = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Call this method if you update data or config of a chart that is in\r\n\t * hidden container, after revealing the container, so that labels and\r\n\t * possibly other elements can correctly arrange themselves.\r\n\t *\r\n\t * @since 4.7.10\r\n\t * @param  container  Target container\r\n\t */\r\n\tpublic softInvalidate(container: Container) {\r\n\t\tcontainer.children.each((child) => {\r\n\t\t\tif (child instanceof Container) {\r\n\t\t\t\tthis.softInvalidate(child);\r\n\t\t\t}\r\n\t\t\tif (child.measureFailed) {\r\n\t\t\t\tif (is<Label>(child, \"Label\")) {\r\n\t\t\t\t\tchild.hardInvalidate();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tchild.invalidate();\r\n\t\t\t\t}\r\n\t\t\t\tchild.measureFailed = false;\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * Triggers position re-validation on all [[Sprite]] elements that have\r\n\t * invalid(ated) positions.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Maybe should be private?\r\n\t */\r\n\tpublic validatePositions(id: string): void {\r\n\t\t// invalid positions\r\n\t\t// TODO use iterator instead\r\n\t\tlet invalidPositions = registry.invalidPositions[id];\r\n\r\n\t\twhile (invalidPositions.length > 0) {\r\n\t\t\tlet sprite: Sprite = invalidPositions[invalidPositions.length - 1];\r\n\t\t\tif (!sprite.isDisposed()) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tsprite._systemValidatePositions();\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tsprite.positionInvalid = false;\r\n\t\t\t\t\t$array.remove(invalidPositions, sprite);\r\n\t\t\t\t\tsprite.raiseCriticalError(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t$array.remove(invalidPositions, sprite);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Triggers position re-validation on all [[Container]] elements that have\r\n\t * invalid(ated) layouts.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Maybe should be private?\r\n\t */\r\n\tpublic validateLayouts(id: string): void {\r\n\t\t// invalid positions\r\n\t\t// TODO use iterator instead\r\n\t\tlet invalidLayouts = registry.invalidLayouts[id];\r\n\t\twhile (invalidLayouts.length > 0) {\r\n\t\t\tlet container: Container = invalidLayouts[invalidLayouts.length - 1];\r\n\t\t\tif (!container.isDisposed()) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcontainer.children.each((sprite) => {\r\n\t\t\t\t\t\tsprite._systemValidateLayouts();\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tcontainer.validateLayout();\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tcontainer.layoutInvalid = false;\r\n\t\t\t\t\t$array.remove(invalidLayouts, container);\r\n\t\t\t\t\tcontainer.raiseCriticalError(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t$array.remove(invalidLayouts, container);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Outputs string to console if `verbose` is `true`.\r\n\t *\r\n\t * @param value Message to output to console\r\n\t */\r\n\tpublic log(value: any): void {\r\n\t\t$log.log(value);\r\n\t}\r\n\r\n\t/**\r\n\t * Pauses all the processes of all the amCharts objects on the page\r\n\t *\r\n\t * @return is paused?\r\n\t */\r\n\tpublic set isPaused(value: boolean) {\r\n\t\tthis._isPaused = value;\r\n\t\tif (!value) {\r\n\t\t\tthis._frameRequested = false;\r\n\t\t\tthis.requestFrame();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Is system on pause?\r\n\t */\r\n\tpublic get isPaused(): boolean {\r\n\t\treturn this._isPaused;\r\n\t}\r\n\r\n}\r\n\r\n\r\n/**\r\n * A singleton global instance of [[System]].\r\n *\r\n * All code should use this, rather than instantiating their\r\n * own System objects.\r\n */\r\nexport const system: System = new System();\r\n","/**\r\n * A collection of keyboard-related utilities accessible via `keyboard`\r\n * instance.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport * as $type from \"./Type\";\r\n\r\n/**\r\n * Represents named (usually frequently used) keyboard keys for easy referece.\r\n */\r\nexport type KeyboardKeys =\r\n\t\"up\"\r\n\t| \"down\"\r\n\t| \"left\"\r\n\t| \"right\"\r\n\t| \"enter\"\r\n\t| \"esc\"\r\n\t| \"home\"\r\n\t| \"tab\"\r\n\t| \"end\"\r\n\t| \"ctrl\"\r\n\t| \"alt\"\r\n\t| \"shift\"\r\n\t| \"space\"\r\n\t| \"home\"\r\n\t| \"end\"\r\n\t| \"pgup\"\r\n\t| \"pgdn\"\r\n\t| \"ins\"\r\n\t| \"del\"\r\n\t| \"plus\"\r\n\t| \"minus\"\r\n\t| \"other\";\r\n\r\n/**\r\n * A class that represents collection of keyboard-related utilities.\r\n *\r\n * Do not instantiate this class directly, but rather use `keyboard` variable.\r\n */\r\nexport class Keyboard {\r\n\r\n\t/**\r\n\t * Returns a named key based on information contained in the event or\r\n\t * \"other\".\r\n\t *\r\n\t * @param ev  A keyboard event\r\n\t * @return Keyboard named key\r\n\t */\r\n\tpublic getEventKey(ev: KeyboardEvent): KeyboardKeys {\r\n\r\n\t\t// Get the key code\r\n\t\tlet code: number = ev.keyCode || ev.which,\r\n\t\t\tkey: KeyboardKeys;\r\n\r\n\t\t// Map to internal key\r\n\t\tswitch (code) {\r\n\t\t\tcase 38:  key = \"up\";    break;\r\n\t\t\tcase 40:  key = \"down\";  break;\r\n\t\t\tcase 37:  key = \"left\";  break;\r\n\t\t\tcase 39:  key = \"right\"; break;\r\n\t\t\tcase 13:  key = \"enter\"; break;\r\n\t\t\tcase 27:  key = \"esc\";   break;\r\n\t\t\tcase 36:  key = \"home\";  break;\r\n\t\t\tcase 35:  key = \"end\";   break;\r\n\t\t\tcase 9:   key = \"tab\";   break;\r\n\t\t\tcase 17:  key = \"ctrl\";  break;\r\n\t\t\tcase 18:  key = \"alt\";   break;\r\n\t\t\tcase 16:  key = \"shift\"; break;\r\n\t\t\tcase 32:  key = \"space\"; break;\r\n\t\t\tcase 36:  key = \"home\";  break;\r\n\t\t\tcase 35:  key = \"end\";   break;\r\n\t\t\tcase 33:  key = \"pgup\";  break;\r\n\t\t\tcase 34:  key = \"pgdn\";  break;\r\n\t\t\tcase 45:  key = \"ins\";   break;\r\n\t\t\tcase 46:  key = \"del\";   break;\r\n\t\t\tcase 107: key = \"plus\";  break;\r\n\t\t\tcase 109: key = \"minus\"; break;\r\n\t\t\tdefault:  key = \"other\"; break;\r\n\t\t}\r\n\r\n\t\treturn key;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if event key is one or more of the selected named keys.\r\n\t *\r\n\t * @param ev   Keyboard event\r\n\t * @param key  Named key or array of keys\r\n\t * @return Is event key one of the list?\r\n\t */\r\n\tpublic isKey(ev: KeyboardEvent, key: string | string[]): boolean {\r\n\t\tlet eventKey = this.getEventKey(ev);\r\n\t\tif ($type.isString(key)) {\r\n\t\t\tkey = [key];\r\n\t\t}\r\n\t\treturn key.indexOf(eventKey) !== -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if shift key was presset at the moment of the event.\r\n\t *\r\n\t * @param ev  Event object\r\n\t * @return Was shift pressed?\r\n\t */\r\n\tpublic shiftKey(ev: KeyboardEvent | MouseEvent): boolean {\r\n\t\treturn ev.shiftKey;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if ctrl key was presset at the moment of the event.\r\n\t *\r\n\t * @param ev  Event object\r\n\t * @return Was ctrl pressed?\r\n\t */\r\n\tpublic ctrlKey(ev: KeyboardEvent | MouseEvent): boolean {\r\n\t\treturn ev.ctrlKey;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if alt key was presset at the moment of the event\r\n\t * @param ev  Event object\r\n\t * @return Was alt pressed?\r\n\t */\r\n\tpublic altKey(ev: KeyboardEvent | MouseEvent): boolean {\r\n\t\treturn ev.altKey;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if meta key was presset at the moment of the event\r\n\t * @param ev  Event object\r\n\t * @return Was meta pressed?\r\n\t */\r\n\tpublic metaKey(ev: KeyboardEvent | MouseEvent): boolean {\r\n\t\treturn ev.metaKey;\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * A single [[Keyboard]] instance to be reused across all elements so that\r\n * they don't need to instantiate their own.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport let keyboard = new Keyboard();\r\n","/**\r\n * Functionality for drawing simple buttons.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Container, IContainerProperties, IContainerAdapters, IContainerEvents } from \"../Container\";\r\nimport { Sprite } from \"../Sprite\";\r\nimport { Label } from \"./Label\";\r\nimport { RoundedRectangle } from \"../elements/RoundedRectangle\";\r\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $type from \"../../core/utils/Type\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[Button]].\r\n */\r\nexport interface IButtonProperties extends IContainerProperties {\r\n\r\n\t/**\r\n\t * Icon (if available) position - left or right.\r\n\t */\r\n\ticonPosition?: \"left\" | \"right\";\r\n\r\n\t/**\r\n\t * Icon sprite\r\n\t */\r\n\ticon?: Sprite;\r\n}\r\n\r\n/**\r\n * Defines events for [[Button]].\r\n */\r\nexport interface IButtonEvents extends IContainerEvents { }\r\n\r\n/**\r\n * Defines adapters for [[Button]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IButtonAdapters extends IContainerAdapters, IButtonProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Button class is capable of drawing a simple rectangular button with\r\n * optionally rounded corners and an icon in it.\r\n *\r\n * @see {@link IButtonEvents} for a list of available events\r\n * @see {@link IButtonAdapters} for a list of available Adapters\r\n */\r\nexport class Button extends Container {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IButtonProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IButtonAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IButtonEvents;\r\n\r\n\t/**\r\n\t * Icon reference.\r\n\t */\r\n\tprotected _icon: Sprite;\r\n\r\n\t/**\r\n\t * [[Label]] element for button content.\r\n\t */\r\n\tprotected _label: $type.Optional<Label>;\r\n\r\n\t/**\r\n\t * A type for background.\r\n\t */\r\n\tpublic _background: RoundedRectangle;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"Button\";\r\n\r\n\t\tthis.tooltipY = 0;\r\n\r\n\t\t// Set defaults\r\n\t\tthis.iconPosition = \"left\";\r\n\t\tthis.layout = \"horizontal\";\r\n\t\tthis.contentAlign = \"center\";\r\n\t\tthis.contentValign = \"middle\";\r\n\t\tthis.padding(8, 16, 8, 16);\r\n\t\tthis.setStateOnChildren = true;\r\n\r\n\t\tlet interfaceColors = new InterfaceColorSet();\r\n\r\n\t\t// Create background\r\n\t\tlet background = this.background;\r\n\t\tbackground.fill = interfaceColors.getFor(\"secondaryButton\");\r\n\t\tbackground.stroke = interfaceColors.getFor(\"secondaryButtonStroke\");\r\n\t\tbackground.fillOpacity = 1;\r\n\t\tbackground.strokeOpacity = 1;\r\n\t\tbackground.cornerRadius(3, 3, 3, 3);\r\n\r\n\t\t// Create the label element\r\n\t\tthis.label = new Label();\r\n\t\tthis.label.fill = interfaceColors.getFor(\"secondaryButtonText\");;\r\n\t\tthis.label.shouldClone = false;\r\n\r\n\t\t// Create default states\r\n\t\tlet hoverState = background.states.create(\"hover\");\r\n\t\thoverState.properties.fillOpacity = 1;\r\n\t\thoverState.properties.fill = interfaceColors.getFor(\"secondaryButtonHover\");\r\n\r\n\t\tlet downState = background.states.create(\"down\");\r\n\t\tdownState.transitionDuration = 100;\r\n\t\tdownState.properties.fill = interfaceColors.getFor(\"secondaryButtonDown\");\r\n\t\tdownState.properties.fillOpacity = 1;\r\n\t\t// Set up accessibility\r\n\t\t// A button should be always focusable\r\n\t\tthis.role = \"button\";\r\n\t\tthis.focusable = true;\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Sprite]] to be used as an icon on button.\r\n\t *\r\n\t * @param icon Icon Sprite\r\n\t */\r\n\tpublic set icon(icon: Sprite) {\r\n\t\tlet currentIcon = this._icon;\r\n\t\tif (currentIcon) {\r\n\t\t\t//this._icon.dispose();\r\n\t\t\t//this.removeDispose(currentIcon);\r\n\t\t\tcurrentIcon.parent = undefined;\r\n\t\t}\r\n\t\tif (icon) {\r\n\t\t\tthis._icon = icon;\r\n\t\t\ticon.parent = this;\r\n\t\t\ticon.interactionsEnabled = false;\r\n\t\t\ticon.shouldClone = false;\r\n\t\t\tthis.iconPosition = this.iconPosition;\r\n\t\t\tthis._disposers.push(icon);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Icon Sprite\r\n\t */\r\n\tpublic get icon(): Sprite {\r\n\t\treturn this._icon;\r\n\t}\r\n\r\n\t/**\r\n\t * Icon position: \"left\" or \"right\".\r\n\t *\r\n\t * @default \"left\"\r\n\t * @param position  Icon position\r\n\t */\r\n\tpublic set iconPosition(position: \"left\" | \"right\") {\r\n\t\tthis.setPropertyValue(\"iconPosition\", position);\r\n\r\n\t\tif (this.icon) {\r\n\t\t\tif (position == \"left\") {\r\n\t\t\t\tthis.icon.toBack();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.icon.toFront();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Icon position\r\n\t */\r\n\tpublic get iconPosition(): \"left\" | \"right\" {\r\n\t\treturn this.getPropertyValue(\"iconPosition\");\r\n\t}\r\n\r\n\t/**\r\n\t * [[Label]] element to be used for text.\r\n\t *\r\n\t * @param label element\r\n\t */\r\n\tpublic set label(label: $type.Optional<Label>) {\r\n\t\tif (this._label) {\r\n\t\t\t//this._label.dispose();\r\n\t\t\tthis.removeDispose(this._label);\r\n\t\t}\r\n\t\tthis._label = label;\r\n\t\tif (label) {\r\n\t\t\tlabel.parent = this;\r\n\t\t\tlabel.interactionsEnabled = false;\r\n\t\t\tthis._disposers.push(this._label);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Label element\r\n\t */\r\n\tpublic get label(): $type.Optional<Label> {\r\n\t\treturn this._label;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a background element for the button.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Background element\r\n\t */\r\n\tpublic createBackground(): this[\"_background\"] {\r\n\t\treturn new RoundedRectangle();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Copies properties and other attributes.\r\n\t *\r\n\t * @param source  Source\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\tsuper.copyFrom(source);\r\n\t\tif (source.label) {\r\n\t\t\tthis.label.copyFrom(source.label)\r\n\t\t}\r\n\t\tif (source.icon) {\r\n\t\t\tthis.icon = source.icon.clone();\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Button\"] = Button;\r\n","/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { EventDispatcher, AMEvent } from \"./EventDispatcher\";\r\nimport { Ordering } from \"./Order\";\r\nimport { IClone } from \"./Clone\";\r\nimport * as $array from \"./Array\";\r\nimport * as $iter from \"./Iterator\";\r\nimport * as $type from \"./Type\";\r\n\r\n/**\r\n * Defines evends for [[SortedList]].\r\n */\r\nexport interface ISortedListEvents<A> {\r\n\r\n\t/**\r\n\t * Invoked when new value is inserted into the list.\r\n\t */\r\n\tinserted: {\r\n\t\t/**\r\n\t\t * Index where the element was inserted.\r\n\t\t */\r\n\t\tindex: number;\r\n\r\n\t\t/**\r\n\t\t * Inserted value.\r\n\t\t */\r\n\t\tnewValue: A;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when a value is removed from the list.\r\n\t */\r\n\tremoved: {\r\n\t\t/**\r\n\t\t * Index of the element which was removed.\r\n\t\t */\r\n\t\tindex: number;\r\n\r\n\t\t/**\r\n\t\t * Removed value.\r\n\t\t */\r\n\t\toldValue: A;\r\n\t};\r\n\r\n}\r\n\r\n/**\r\n * Ordered list contains values of any type in an indexed array.\r\n */\r\nexport class OrderedList<T> {\r\n\r\n\t/**\r\n\t * Holds list values.\r\n\t */\r\n\tprotected _values: Array<T> = [];\r\n\r\n\t/**\r\n\t * Event dispatcher.\r\n\t */\r\n\tpublic events: EventDispatcher<AMEvent<OrderedList<T>, ISortedListEvents<T>>> = new EventDispatcher();\r\n\r\n\t/**\r\n\t * Constructor\r\n\t *\r\n\t * @param initial  Inital list of values to add to list\r\n\t */\r\n\tconstructor(initial?: Array<T>) {\r\n\t\tif (initial != null) {\r\n\t\t\tthis.setAll(initial);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * All items of the list.\r\n\t *\r\n\t * Do not modify the list directly. Rather use `insert()` and `remove()`\r\n\t * methods.\r\n\t *\r\n\t * @return List values\r\n\t */\r\n\tpublic get values(): Array<T> {\r\n\t\treturn this._values;\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts a value into list item array.\r\n\t *\r\n\t * @param value  Value\r\n\t */\r\n\tprotected _insert(value: T): number {\r\n\t\tthis._values.push(value);\r\n\t\treturn this._values.length - 1;\r\n\t}\r\n\r\n\t/**\r\n\t * Number of items in the list.\r\n\t *\r\n\t * @readonly\r\n\t * @return Length\r\n\t */\r\n\tpublic get length(): number {\r\n\t\treturn this._values.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the index of the specific `value`.\r\n\t *\r\n\t * -1 if not found.\r\n\t *\r\n\t * @param value  Value\r\n\t * @return Index\r\n\t */\r\n\tpublic indexOf(value: T): number {\r\n\t\treturn $array.indexOf(this._values, value);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if list contains the `value`.\r\n\t *\r\n\t * @param value  Value\r\n\t * @return In the list?\r\n\t */\r\n\tpublic contains(value: T): boolean {\r\n\t\treturn this.indexOf(value) !== -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an item at specific `index`.\r\n\t *\r\n\t * @param index  Index\r\n\t * @return Item\r\n\t */\r\n\tpublic getIndex(index: number): T | undefined {\r\n\t\treturn this._values[index];\r\n\t}\r\n\r\n\t/**\r\n\t * First item in the list.\r\n\t *\r\n\t * @return Item\r\n\t */\r\n\tpublic get first(): T | undefined {\r\n\t\treturn this._values[0];\r\n\t}\r\n\r\n\t/**\r\n\t * Last item in the list.\r\n\t *\r\n\t * @return Item\r\n\t */\r\n\tpublic get last(): T | undefined {\r\n\t\treturn this._values[this._values.length - 1];\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts a value into list.\r\n\t *\r\n\t * @param value  Value\r\n\t */\r\n\tpublic insert(value: T): void {\r\n\t\tconst index = this._insert(value);\r\n\r\n\t\tif (this.events.isEnabled(\"inserted\")) {\r\n\t\t\tthis.events.dispatchImmediately(\"inserted\", {\r\n\t\t\t\ttype: \"inserted\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tindex: index,\r\n\t\t\t\tnewValue: value\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes an item with the `value` from the list.\r\n\t *\r\n\t * @param value  Value\r\n\t */\r\n\tpublic remove(value: T): void {\r\n\t\tconst index = this.indexOf(value);\r\n\r\n\t\tif (index !== -1) {\r\n\t\t\tconst oldValue = this._values[index];\r\n\r\n\t\t\t$array.removeIndex(this._values, index);\r\n\r\n\t\t\tif (this.events.isEnabled(\"removed\")) {\r\n\t\t\t\tthis.events.dispatchImmediately(\"removed\", {\r\n\t\t\t\t\ttype: \"removed\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tindex: index,\r\n\t\t\t\t\toldValue: oldValue,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets multiple items to the list.\r\n\t *\r\n\t * All current items are removed.\r\n\t *\r\n\t * @param newArray  New items\r\n\t */\r\n\tpublic setAll(newArray: Array<T>): void {\r\n\t\t$array.eachReverse(this._values, (x, i) => {\r\n\t\t\tthis._values.pop();\r\n\r\n\t\t\tif (this.events.isEnabled(\"removed\")) {\r\n\t\t\t\tthis.events.dispatchImmediately(\"removed\", {\r\n\t\t\t\t\ttype: \"removed\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tindex: i,\r\n\t\t\t\t\toldValue: x\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$array.each(newArray, (value) => {\r\n\t\t\tthis.insert(value);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all items from the list.\r\n\t */\r\n\tpublic clear(): void {\r\n\t\tthis.setAll([]);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns part of the list between `start` and `end` indexes, as a new\r\n\t * [[OrderedList]].\r\n\t *\r\n\t * @param start  Start index\r\n\t * @param end    End index\r\n\t * @return Items in range\r\n\t */\r\n\tpublic slice(start: number, end: number): OrderedList<T> {\r\n\t\tconst out = new OrderedList<T>();\r\n\r\n\t\tout._values = this._values.slice(start, end);\r\n\r\n\t\treturn out;\r\n\t}\r\n\r\n\t/**\r\n\t * Finds a closest available index to the `value` in specified direction.\r\n\t *\r\n\t * @ignore exclude from docs\r\n\t * @param value      value to search for\r\n\t * @param fn         A callback function that returns value of the item\r\n\t * @param direction  Direciton\r\n\t * @return Index\r\n\t */\r\n\tpublic findClosestIndex(value: number, fn: (value: T) => number, direction: \"left\" | \"right\" | \"any\" = \"any\"): number {\r\n\t\t// Init temporary values\r\n\t\tlet closestIndex: number = -1;\r\n\t\tlet closestValue: number;\r\n\t\tlet closestDifference: number;\r\n\r\n\t\tlet i = 0;\r\n\r\n\t\t$iter.eachContinue(this.iterator(), (element) => {\r\n\t\t\tconst item: number = fn(element);\r\n\r\n\t\t\t// Calc difference\r\n\t\t\tif (direction === \"any\") {\r\n\r\n\t\t\t\t// Exact match?\r\n\t\t\t\tif (item === value) {\r\n\t\t\t\t\t// Found exact value - don't bother searching further\r\n\t\t\t\t\tclosestIndex = i;\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet difference = Math.abs(value - item);\r\n\t\t\t\tif (!$type.hasValue(closestDifference) || (closestDifference > difference)) {\r\n\t\t\t\t\tclosestIndex = i;\r\n\t\t\t\t\tclosestValue = item;\r\n\t\t\t\t\tclosestDifference = difference;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (direction === \"left\" && (item < value)) {\r\n\t\t\t\tif (!$type.hasValue(closestValue) || (closestValue < item)) {\r\n\t\t\t\t\tclosestIndex = i;\r\n\t\t\t\t\tclosestValue = item;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (direction === \"right\" && (item >= value)) {\r\n\t\t\t\tif (!$type.hasValue(closestValue) || (closestValue >= item)) {\r\n\t\t\t\t\tclosestIndex = i;\r\n\t\t\t\t\tclosestValue = item;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t++i;\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\t// Found nothing?\r\n\t\tif (closestIndex === -1) {\r\n\t\t\tif (direction === \"left\") {\r\n\t\t\t\t// Use First one\r\n\t\t\t\tclosestIndex = 0;\r\n\t\t\t}\r\n\t\t\telse if (direction === \"right\") {\r\n\t\t\t\t// Use last item\r\n\t\t\t\tclosestIndex = this.length - 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn closestIndex;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a list iterator.\r\n\t *\r\n\t * @return Iterator\r\n\t */\r\n\tpublic iterator(): $iter.Iterator<T> {\r\n\t\treturn $iter.fromArray(this._values);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an ES6 iterator for the list.\r\n\t */\r\n\tpublic *[Symbol.iterator](): Iterator<T> {\r\n\t\tconst length = this._values.length;\r\n\r\n\t\tfor (let i = 0; i < length; ++i) {\r\n\t\t\tyield this._values[i];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Calls `f` for each element in the list.\r\n\t */\r\n\tpublic each(f: (value: T, index: number) => void): void {\r\n\t\t$array.each(this._values, f);\r\n\t}\r\n}\r\n\r\n/**\r\n * A list where all items are ordered according to specific ordering function,\r\n * which is passed in via constructor parameter, when creating an instance of\r\n * [[SortedList]].\r\n */\r\nexport class SortedList<T> extends OrderedList<T> {\r\n\r\n\t/**\r\n\t * A reference to the ordering function.\r\n\t */\r\n\tprivate _ordering: any;\r\n\r\n\t/**\r\n\t * Constructor.\r\n\t *\r\n\t * @param sort  Ordering function\r\n\t */\r\n\tconstructor(sort: (left: T, right: T) => Ordering) {\r\n\t\tsuper();\r\n\t\tthis._ordering = sort;\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts item into the list.\r\n\t *\r\n\t * @param value  Item\r\n\t */\r\n\tprotected _insert(value: T): number {\r\n\t\tconst { index } = $array.getSortedIndex(this._values, this._ordering, value);\r\n\r\n\t\t$array.insertIndex(this._values, index, value);\r\n\r\n\t\treturn index;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns index of the item in list if found.\r\n\t *\r\n\t * -1 if item is not in the list.\r\n\t *\r\n\t * @param value  Item to search for\r\n\t * @return Index\r\n\t */\r\n\tpublic indexOf(value: T): number {\r\n\t\tconst { found, index } = $array.getSortedIndex(this._values, this._ordering, value);\r\n\r\n\t\tif (found) {\r\n\t\t\treturn index;\r\n\r\n\t\t} else {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [udpate description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t * @param value [description]\r\n\t */\r\n\tpublic update(value: T): void {\r\n\t\t// @todo test this\r\n\t\tconst index = $array.indexOf(this._values, value);\r\n\r\n\t\t// @todo throw an error if it doesn't exist ?\r\n\t\tif (index !== -1) {\r\n\t\t\tconst last = this._values.length - 1;\r\n\r\n\t\t\t// Check if the current ordering is correct\r\n\t\t\tif (!((index === 0 || this._ordering(this._values[index - 1], value) < 0) &&\r\n\t\t\t\t(index === last || this._ordering(value, this._values[index + 1]) < 0))) {\r\n\t\t\t\t// TODO send remove/insert/move events\r\n\t\t\t\t$array.removeIndex(this._values, index);\r\n\t\t\t\tthis._insert(value);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n\r\n/**\r\n * A version of a [[OrderedList]] that has a \"template\".\r\n *\r\n * A template is an instance of an object, that can be used to create new\r\n * elements in the list without actually needing to create instances for those.\r\n *\r\n * When new element is created in the list, e.g. by calling its `create()`\r\n * method, an exact copy of the element is created (including properties and\r\n * other attributes), inserted into the list and returned.\r\n */\r\nexport class OrderedListTemplate<T extends IClone<T> & { isTemplate: boolean }> extends OrderedList<T> {\r\n\r\n\t/**\r\n\t * A template object.\r\n\t *\r\n\t * @todo Make this private\r\n\t */\r\n\tpublic _template!: T;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t *\r\n\t * @param t Template object\r\n\t */\r\n\tpublic constructor(t: T) {\r\n\t\tsuper();\r\n\t\tthis.template = t;\r\n\t}\r\n\r\n\t/**\r\n\t * A \"template\" object to copy all properties from when creating new list\r\n\t * items.\r\n\t *\r\n\t * @param v  Template object\r\n\t */\r\n\tpublic set template(v: T) {\r\n\t\tv.isTemplate = true;\r\n\t\tthis._template = v;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Template object\r\n\t */\r\n\tpublic get template(): T {\r\n\t\treturn this._template;\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all elements from other list.\r\n\t *\r\n\t * @param source  Source list\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\t$iter.each(source.iterator(), (value) => {\r\n\t\t\tthis.insert(value.clone());\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Returns part of the list, starting at `start` and ending at `end` indexes,\r\n\t * as a new [[OrderedListTemplate]].\r\n\t *\r\n\t * @param start  Start index\r\n\t * @param end    End index\r\n\t * @return New list\r\n\t */\r\n\tpublic slice(start: number, end: number): OrderedListTemplate<T> {\r\n\t\tconst out = new OrderedListTemplate<T>(this.template);\r\n\r\n\t\tout._values = this._values.slice(start, end);\r\n\r\n\t\treturn out;\r\n\t}\r\n\r\n\t/**\r\n\t * Instantiates a new object of the specified type, adds it to the end of\r\n\t * the list, and returns it.\r\n\t *\r\n\t * @param make  Item type to use. Will use the default type for the list if not specified.\r\n\t * @return      Newly created item\r\n\t */\r\n\tpublic create<T>(make: { new(): T; }): T;\r\n\tpublic create(): T;\r\n\tpublic create(make?: { new(): T; }): T {\r\n\t\tconst clone =\r\n\t\t\t(make != null\r\n\t\t\t\t? new make()\r\n\t\t\t\t: this.template.clone());\r\n\r\n\t\tthis.insert(clone);\r\n\r\n\t\treturn clone;\r\n\t}\r\n}\r\n\r\n/**\r\n * A version of a [[SortedList]] that has a \"template\".\r\n *\r\n * A template is an instance of an object, that can be used to create new\r\n * elements in the list without actually needing to create instances for those.\r\n *\r\n * When new element is created in the list, e.g. by calling its `create()`\r\n * method, an exact copy of the element is created (including properties and\r\n * other attributes), inserted into the list and returned.\r\n */\r\nexport class SortedListTemplate<T extends IClone<T> & { isTemplate: boolean }> extends SortedList<T> {\r\n\r\n\t// @todo code duplication\r\n\r\n\t/**\r\n\t * A template object.\r\n\t *\r\n\t * @todo Make this private\r\n\t */\r\n\tpublic _template!: T;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t *\r\n\t * @param t     Template object\r\n\t * @param sort  Ordering function\r\n\t */\r\n\tpublic constructor(t: T, sort: (left: T, right: T) => Ordering) {\r\n\t\tsuper(sort);\r\n\t\tthis.template = t;\r\n\t}\r\n\r\n\t/**\r\n\t * A \"template\" object to copy all properties from when creating new list\r\n\t * items.\r\n\t *\r\n\t * @param v  Template object\r\n\t */\r\n\tpublic set template(v: T) {\r\n\t\tv.isTemplate = true;\r\n\t\tthis._template = v;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Template object\r\n\t */\r\n\tpublic get template(): T {\r\n\t\treturn this._template;\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all elements from other list.\r\n\t *\r\n\t * @param source  Source list\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\t$iter.each(source.iterator(), (value) => {\r\n\t\t\tthis.insert(value.clone());\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Instantiates a new object of the specified type, adds it to the end of\r\n\t * the list, and returns it.\r\n\t *\r\n\t * @param make  Item type to use. Will use the default type for the list if not specified.\r\n\t * @return      Newly created item\r\n\t */\r\n\tpublic create<T>(make: { new(): T; }): T;\r\n\tpublic create(): T;\r\n\tpublic create(make?: { new(): T; }): T {\r\n\t\tconst clone =\r\n\t\t\t(make != null\r\n\t\t\t\t? new make()\r\n\t\t\t\t: this.template.clone());\r\n\r\n\t\tthis.insert(clone);\r\n\r\n\t\treturn clone;\r\n\t}\r\n\r\n}\r\n","/**\r\n * A collection of color-related functions\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport * as $math from \"./Math\";\r\nimport * as $type from \"./Type\";\r\n\r\n/**\r\n * Define named colors for easy resolution to RGB.\r\n */\r\nlet namedColors = {\r\n\taliceblue: { r: 240, g: 248, b: 255 },\r\n\tantiquewhite: { r: 250, g: 235, b: 215 },\r\n\taqua: { r: 0, g: 255, b: 255 },\r\n\taquamarine: { r: 127, g: 255, b: 212 },\r\n\tazure: { r: 240, g: 255, b: 255 },\r\n\tbeige: { r: 245, g: 245, b: 220 },\r\n\tbisque: { r: 255, g: 228, b: 196 },\r\n\tblack: { r: 0, g: 0, b: 0 },\r\n\tblanchedalmond: { r: 255, g: 235, b: 205 },\r\n\tblue: { r: 0, g: 0, b: 255 },\r\n\tblueviolet: { r: 138, g: 43, b: 226 },\r\n\tbrown: { r: 165, g: 42, b: 42 },\r\n\tburlywood: { r: 222, g: 184, b: 135 },\r\n\tcadetblue: { r: 95, g: 158, b: 160 },\r\n\tchartreuse: { r: 127, g: 255, b: 0 },\r\n\tchocolate: { r: 210, g: 105, b: 30 },\r\n\tcoral: { r: 255, g: 127, b: 80 },\r\n\tcornflowerblue: { r: 100, g: 149, b: 237 },\r\n\tcornsilk: { r: 255, g: 248, b: 220 },\r\n\tcrimson: { r: 220, g: 20, b: 60 },\r\n\tcyan: { r: 0, g: 255, b: 255 },\r\n\tdarkblue: { r: 0, g: 0, b: 139 },\r\n\tdarkcyan: { r: 0, g: 139, b: 139 },\r\n\tdarkgoldenrod: { r: 184, g: 134, b: 11 },\r\n\tdarkgray: { r: 169, g: 169, b: 169 },\r\n\tdarkgrey: { r: 169, g: 169, b: 169 },\r\n\tdarkgreen: { r: 0, g: 100, b: 0 },\r\n\tdarkkhaki: { r: 189, g: 183, b: 107 },\r\n\tdarkmagenta: { r: 139, g: 0, b: 139 },\r\n\tdarkolivegreen: { r: 85, g: 107, b: 47 },\r\n\tdarkorange: { r: 255, g: 140, b: 0 },\r\n\tdarkorchid: { r: 153, g: 50, b: 204 },\r\n\tdarkred: { r: 139, g: 0, b: 0 },\r\n\tdarksalmon: { r: 233, g: 150, b: 122 },\r\n\tdarkseagreen: { r: 143, g: 188, b: 143 },\r\n\tdarkslateblue: { r: 72, g: 61, b: 139 },\r\n\tdarkslategray: { r: 47, g: 79, b: 79 },\r\n\tdarkslategrey: { r: 47, g: 79, b: 79 },\r\n\tdarkturquoise: { r: 0, g: 206, b: 209 },\r\n\tdarkviolet: { r: 148, g: 0, b: 211 },\r\n\tdeeppink: { r: 255, g: 20, b: 147 },\r\n\tdeepskyblue: { r: 0, g: 191, b: 255 },\r\n\tdimgray: { r: 105, g: 105, b: 105 },\r\n\tdimgrey: { r: 105, g: 105, b: 105 },\r\n\tdodgerblue: { r: 30, g: 144, b: 255 },\r\n\tfirebrick: { r: 178, g: 34, b: 34 },\r\n\tfloralwhite: { r: 255, g: 250, b: 240 },\r\n\tforestgreen: { r: 34, g: 139, b: 34 },\r\n\tfuchsia: { r: 255, g: 0, b: 255 },\r\n\tgainsboro: { r: 220, g: 220, b: 220 },\r\n\tghostwhite: { r: 248, g: 248, b: 255 },\r\n\tgold: { r: 255, g: 215, b: 0 },\r\n\tgoldenrod: { r: 218, g: 165, b: 32 },\r\n\tgray: { r: 128, g: 128, b: 128 },\r\n\tgrey: { r: 128, g: 128, b: 128 },\r\n\tgreen: { r: 0, g: 128, b: 0 },\r\n\tgreenyellow: { r: 173, g: 255, b: 47 },\r\n\thoneydew: { r: 240, g: 255, b: 240 },\r\n\thotpink: { r: 255, g: 105, b: 180 },\r\n\tindianred: { r: 205, g: 92, b: 92 },\r\n\tindigo: { r: 75, g: 0, b: 130 },\r\n\tivory: { r: 255, g: 255, b: 240 },\r\n\tkhaki: { r: 240, g: 230, b: 140 },\r\n\tlavender: { r: 230, g: 230, b: 250 },\r\n\tlavenderblush: { r: 255, g: 240, b: 245 },\r\n\tlawngreen: { r: 124, g: 252, b: 0 },\r\n\tlemonchiffon: { r: 255, g: 250, b: 205 },\r\n\tlightblue: { r: 173, g: 216, b: 230 },\r\n\tlightcoral: { r: 240, g: 128, b: 128 },\r\n\tlightcyan: { r: 224, g: 255, b: 255 },\r\n\tlightgoldenrodyellow: { r: 250, g: 250, b: 210 },\r\n\tlightgray: { r: 211, g: 211, b: 211 },\r\n\tlightgrey: { r: 211, g: 211, b: 211 },\r\n\tlightgreen: { r: 144, g: 238, b: 144 },\r\n\tlightpink: { r: 255, g: 182, b: 193 },\r\n\tlightsalmon: { r: 255, g: 160, b: 122 },\r\n\tlightseagreen: { r: 32, g: 178, b: 170 },\r\n\tlightskyblue: { r: 135, g: 206, b: 250 },\r\n\tlightslategray: { r: 119, g: 136, b: 153 },\r\n\tlightslategrey: { r: 119, g: 136, b: 153 },\r\n\tlightsteelblue: { r: 176, g: 196, b: 222 },\r\n\tlightyellow: { r: 255, g: 255, b: 224 },\r\n\tlime: { r: 0, g: 255, b: 0 },\r\n\tlimegreen: { r: 50, g: 205, b: 50 },\r\n\tlinen: { r: 250, g: 240, b: 230 },\r\n\tmagenta: { r: 255, g: 0, b: 255 },\r\n\tmaroon: { r: 128, g: 0, b: 0 },\r\n\tmediumaquamarine: { r: 102, g: 205, b: 170 },\r\n\tmediumblue: { r: 0, g: 0, b: 205 },\r\n\tmediumorchid: { r: 186, g: 85, b: 211 },\r\n\tmediumpurple: { r: 147, g: 112, b: 219 },\r\n\tmediumseagreen: { r: 60, g: 179, b: 113 },\r\n\tmediumslateblue: { r: 123, g: 104, b: 238 },\r\n\tmediumspringgreen: { r: 0, g: 250, b: 154 },\r\n\tmediumturquoise: { r: 72, g: 209, b: 204 },\r\n\tmediumvioletred: { r: 199, g: 21, b: 133 },\r\n\tmidnightblue: { r: 25, g: 25, b: 112 },\r\n\tmintcream: { r: 245, g: 255, b: 250 },\r\n\tmistyrose: { r: 255, g: 228, b: 225 },\r\n\tmoccasin: { r: 255, g: 228, b: 181 },\r\n\tnavajowhite: { r: 255, g: 222, b: 173 },\r\n\tnavy: { r: 0, g: 0, b: 128 },\r\n\toldlace: { r: 253, g: 245, b: 230 },\r\n\tolive: { r: 128, g: 128, b: 0 },\r\n\tolivedrab: { r: 107, g: 142, b: 35 },\r\n\torange: { r: 255, g: 165, b: 0 },\r\n\torangered: { r: 255, g: 69, b: 0 },\r\n\torchid: { r: 218, g: 112, b: 214 },\r\n\tpalegoldenrod: { r: 238, g: 232, b: 170 },\r\n\tpalegreen: { r: 152, g: 251, b: 152 },\r\n\tpaleturquoise: { r: 175, g: 238, b: 238 },\r\n\tpalevioletred: { r: 219, g: 112, b: 147 },\r\n\tpapayawhip: { r: 255, g: 239, b: 213 },\r\n\tpeachpuff: { r: 255, g: 218, b: 185 },\r\n\tperu: { r: 205, g: 133, b: 63 },\r\n\tpink: { r: 255, g: 192, b: 203 },\r\n\tplum: { r: 221, g: 160, b: 221 },\r\n\tpowderblue: { r: 176, g: 224, b: 230 },\r\n\tpurple: { r: 128, g: 0, b: 128 },\r\n\trebeccapurple: { r: 102, g: 51, b: 153 },\r\n\tred: { r: 255, g: 0, b: 0 },\r\n\trosybrown: { r: 188, g: 143, b: 143 },\r\n\troyalblue: { r: 65, g: 105, b: 225 },\r\n\tsaddlebrown: { r: 139, g: 69, b: 19 },\r\n\tsalmon: { r: 250, g: 128, b: 114 },\r\n\tsandybrown: { r: 244, g: 164, b: 96 },\r\n\tseagreen: { r: 46, g: 139, b: 87 },\r\n\tseashell: { r: 255, g: 245, b: 238 },\r\n\tsienna: { r: 160, g: 82, b: 45 },\r\n\tsilver: { r: 192, g: 192, b: 192 },\r\n\tskyblue: { r: 135, g: 206, b: 235 },\r\n\tslateblue: { r: 106, g: 90, b: 205 },\r\n\tslategray: { r: 112, g: 128, b: 144 },\r\n\tslategrey: { r: 112, g: 128, b: 144 },\r\n\tsnow: { r: 255, g: 250, b: 250 },\r\n\tspringgreen: { r: 0, g: 255, b: 127 },\r\n\tsteelblue: { r: 70, g: 130, b: 180 },\r\n\ttan: { r: 210, g: 180, b: 140 },\r\n\tteal: { r: 0, g: 128, b: 128 },\r\n\tthistle: { r: 216, g: 191, b: 216 },\r\n\ttomato: { r: 255, g: 99, b: 71 },\r\n\tturquoise: { r: 64, g: 224, b: 208 },\r\n\tviolet: { r: 238, g: 130, b: 238 },\r\n\twheat: { r: 245, g: 222, b: 179 },\r\n\twhite: { r: 255, g: 255, b: 255 },\r\n\twhitesmoke: { r: 245, g: 245, b: 245 },\r\n\tyellow: { r: 255, g: 255, b: 0 },\r\n\tyellowgreen: { r: 154, g: 205, b: 50 }\r\n};\r\n\r\n\r\n/**\r\n * Tries to resolve a named color into a hex color representation.\r\n *\r\n * @ignore Exclude from docs\r\n * @param value  Color name\r\n * @return Color\r\n * @deprecated\r\n * @hidden\r\n */\r\n/*export function resolveNamedColor(value: string): Color {\r\n\treturn (<any>namedColors)[value] ? (<any>namedColors)[value] : undefined;\r\n}*/\r\n\r\n/**\r\n * Converts a proper color hex code (i.e. \"#FF5500\") or named color (i.e. \"red\")\r\n * into an {iRGB} object. If the code is not correctly formatted, an RGB of\r\n * black is returned.\r\n *\r\n * @ignore Exclude from docs\r\n * @param color  Color code\r\n * @param alpha  Alpha (0-1)\r\n * @return RGB\r\n */\r\nexport function rgb(color: string, alpha?: number): iRGB {\r\n\r\n\t// Init return value\r\n\tlet rgb: $type.Optional<iRGB>;\r\n\r\n\t// Try resolving color format\r\n\r\n\t// Named color?\r\n\tif ((<any>namedColors)[color]) {\r\n\t\trgb = (<any>namedColors)[color];\r\n\t}\r\n\r\n\t// Hex code?\r\n\telse if (color.charAt(0) === \"#\") {\r\n\t\trgb = hexToRgb(color);\r\n\t}\r\n\r\n\t// rgb() format?\r\n\telse if (color.match(/^rgba?\\(/)) {\r\n\t\trgb = rgbaToRgb(color);\r\n\t}\r\n\r\n\t// Was not able to resolve?\r\n\tif (!rgb) {\r\n\t\trgb = { r: 0, g: 0, b: 0, a: 1 };\r\n\t}\r\n\r\n\t// Set alpha\r\n\tif ($type.hasValue(alpha)) {\r\n\t\trgb.a = alpha;\r\n\t}\r\n\r\n\treturn rgb;\r\n}\r\n\r\n/**\r\n * Converts a hex color code (i.e. \"#FF5500\") to an [[iRGB]] object.\r\n *\r\n * @ignore Exclude from docs\r\n * @param hex  Hex color code\r\n * @return RGB\r\n */\r\nexport function hexToRgb(hex: string): $type.Optional<iRGB> {\r\n\t// Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\r\n\tlet shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n\thex = hex.replace(shorthandRegex, function(m, r, g, b) {\r\n\t\treturn r + r + g + g + b + b;\r\n\t});\r\n\r\n\tlet result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n\treturn result ? {\r\n\t\tr: parseInt(result[1], 16),\r\n\t\tg: parseInt(result[2], 16),\r\n\t\tb: parseInt(result[3], 16)\r\n\t} : hexToRgbWithAlpha(hex);\r\n}\r\n\r\n/**\r\n * Converts a hex color code with alpha (i.e. \"#FF5500128\") to an [[iRGB]] object.\r\n *\r\n * @ignore Exclude from docs\r\n * @param hex  Hex color code\r\n * @return RGB\r\n */\r\nexport function hexToRgbWithAlpha(hex: string): $type.Optional<iRGB> {\r\n\t// Expand shorthand form (e.g. \"03FA\") to full form (e.g. \"0033FFAA\")\r\n\tlet shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n\thex = hex.replace(shorthandRegex, function(m, r, g, b, a) {\r\n\t\treturn r + r + g + g + b + b + a + a;\r\n\t});\r\n\r\n\tlet result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n\treturn result ? {\r\n\t\tr: parseInt(result[1], 16),\r\n\t\tg: parseInt(result[2], 16),\r\n\t\tb: parseInt(result[3], 16),\r\n\t\ta: parseInt(result[4], 16) / 256\r\n\t} : undefined;\r\n}\r\n\r\n/**\r\n * Converts color strings in format like `rgb()` and `rgba()` to [[iRGB]].\r\n *\r\n * @ignore Exclude from docs\r\n * @param color  Color code\r\n * @return RGB\r\n */\r\nexport function rgbaToRgb(color: string): $type.Optional<iRGB> {\r\n\tcolor = color.replace(/[ ]/g, \"\");\r\n\r\n\t// Init\r\n\tlet matches: string[] | null = color.match(/^rgb\\(([0-9]*),([0-9]*),([0-9]*)\\)/i);\r\n\r\n\t// Try rgb() format\r\n\tif (matches) {\r\n\t\tmatches.push(\"1\");\r\n\r\n\t} else {\r\n\t\tmatches = color.match(/^rgba\\(([0-9]*),([0-9]*),([0-9]*),([.0-9]*)\\)/i);\r\n\r\n\t\tif (!matches) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\treturn {\r\n\t\tr: parseInt(matches[1]),\r\n\t\tg: parseInt(matches[2]),\r\n\t\tb: parseInt(matches[3]),\r\n\t\ta: parseFloat(matches[4])\r\n\t};\r\n}\r\n\r\n/**\r\n * Converts an [[iRGB]] object into a hex color code.\r\n *\r\n * @ignore Exclude from docs\r\n * @param rgb  RGB\r\n * @return Hex color code\r\n */\r\nexport function rgbToHex(rgb: iRGB): string {\r\n\treturn \"#\" + pad2(rgb.r.toString(16)) + pad2(rgb.g.toString(16)) + pad2(rgb.b.toString(16));\r\n}\r\n\r\n/**\r\n * Converts an [[iRGB]] object into its `rgb()` or `rgba()` representation.\r\n *\r\n * @ignore Exclude from docs\r\n * @param rgb  RGB\r\n * @return `rgba()` syntax\r\n */\r\nexport function rgbToRGBA(rgb: iRGB): string {\r\n\tif ($type.hasValue(rgb.a) && rgb.a !== 1) {\r\n\t\treturn \"rgba(\" + rgb.r + \",\" + rgb.g + \",\" + rgb.b + \",\" + rgb.a + \")\";\r\n\t}\r\n\telse {\r\n\t\treturn \"rgb(\" + rgb.r + \",\" + rgb.g + \",\" + rgb.b + \")\";\r\n\t}\r\n}\r\n\r\n/**\r\n * Pads a 1-digit string with a zero.\r\n *\r\n * @ignore Exclude from docs\r\n * @param c  Input string\r\n * @return Padded string\r\n */\r\nexport function pad2(c: string): string {\r\n\treturn c.length == 1 ? \"0\" + c : \"\" + c;\r\n}\r\n\r\n/**\r\n * Returns an intermediate color between two colors based on the relative\r\n * position. Position needs to be in range between 0 and 1. Zero meaning the\r\n * resulting color will be closest to the first reference color.\r\n *\r\n * @ignore Exclude from docs\r\n * @param color1   First reference color\r\n * @param color2   Second reference color\r\n * @param percent  Relative position (0-1)\r\n * @return Interpolated color\r\n */\r\nexport function interpolate(rgb1: $type.Optional<iRGB>, rgb2: $type.Optional<iRGB>, percent: number): $type.Optional<iRGB> {\r\n\tpercent = $math.fitToRange(percent, 0, 1);\r\n\r\n\tif (rgb1) {\r\n\t\tif (rgb2) {\r\n\t\t\treturn {\r\n\t\t\t\tr: rgb1.r + Math.round((rgb2.r - rgb1.r) * percent),\r\n\t\t\t\tg: rgb1.g + Math.round((rgb2.g - rgb1.g) * percent),\r\n\t\t\t\tb: rgb1.b + Math.round((rgb2.b - rgb1.b) * percent),\r\n\t\t\t\ta: (rgb1.a || 1) + Math.round(((rgb2.a || 1) - (rgb1.a || 1)) * percent)\r\n\t\t\t};\r\n\r\n\t\t} else {\r\n\t\t\treturn rgb1;\r\n\t\t}\r\n\r\n\t} else if (rgb2) {\r\n\t\treturn rgb2;\r\n\r\n\t} else {\r\n\t\treturn rgb1;\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns a color that is `percent` brighter than the reference color.\r\n *\r\n * @ignore Exclude from docs\r\n * @param color    Reference color\r\n * @param percent  Brightness percent\r\n * @return Hex code of the new color\r\n */\r\nexport function lighten(rgb: $type.Optional<iRGB>, percent: number): $type.Optional<iRGB> {\r\n\tif (rgb) {\r\n\t\treturn {\r\n\t\t\tr: Math.max(0, Math.min(255, rgb.r + getLightnessStep(rgb.r, percent))),\r\n\t\t\tg: Math.max(0, Math.min(255, rgb.g + getLightnessStep(rgb.g, percent))),\r\n\t\t\tb: Math.max(0, Math.min(255, rgb.b + getLightnessStep(rgb.b, percent))),\r\n\t\t\ta: rgb.a\r\n\t\t};\r\n\r\n\t} else {\r\n\t\t// TODO is this correct ?\r\n\t\treturn rgb;\r\n\t}\r\n};\r\n\r\n/**\r\n * Gets lightness step.\r\n *\r\n * @ignore Exclude from docs\r\n * @param value    Value\r\n * @param percent  Percent\r\n * @return Step\r\n */\r\nexport function getLightnessStep(value: number, percent: number): number {\r\n\tlet base = percent > 0 ? 255 - value : value;\r\n\treturn Math.round(base * percent);\r\n}\r\n\r\n/**\r\n * Returns a color that is `percent` brighter than the source `color`.\r\n *\r\n * @ignore Exclude from docs\r\n * @param color    Source color\r\n * @param percent  Brightness percent\r\n * @return New color\r\n */\r\nexport function brighten(rgb: $type.Optional<iRGB>, percent: number): $type.Optional<iRGB> {\r\n\tif (rgb) {\r\n\t\tlet base = Math.min(Math.max(rgb.r, rgb.g, rgb.b), 230);\r\n\t\t//let base = Math.max(rgb.r, rgb.g, rgb.b);\r\n\t\tlet step = getLightnessStep(base, percent);\r\n\t\treturn {\r\n\t\t\tr: Math.max(0, Math.min(255, Math.round(rgb.r + step))),\r\n\t\t\tg: Math.max(0, Math.min(255, Math.round(rgb.g + step))),\r\n\t\t\tb: Math.max(0, Math.min(255, Math.round(rgb.b + step))),\r\n\t\t\ta: rgb.a\r\n\t\t};\r\n\r\n\t} else {\r\n\t\t// TODO is this correct ?\r\n\t\treturn rgb;\r\n\t}\r\n};\r\n\r\n/**\r\n * Returns brightness step.\r\n *\r\n * @ignore Exclude from docs\r\n * @param value    Value\r\n * @param percent  Percent\r\n * @return Step\r\n */\r\nexport function getBrightnessStep(value: number, percent: number): number {\r\n\tlet base = 255; //percent > 0 ? 255 - value : value;\r\n\treturn Math.round(base * percent);\r\n}\r\n\r\n/**\r\n * Returns a new [[iRGB]] object based on `rgb` parameter with specific\r\n * saturation applied.\r\n *\r\n * `saturation` can be in the range of 0 (fully desaturated) to 1 (fully\r\n * saturated).\r\n *\r\n * @ignore Exclude from docs\r\n * @param color       Base color\r\n * @param saturation  Saturation (0-1)\r\n * @return New color\r\n */\r\nexport function saturate(rgb: $type.Optional<iRGB>, saturation: number): $type.Optional<iRGB> {\r\n\tif (rgb == null || saturation == 1) {\r\n\t\treturn rgb;\r\n\t}\r\n\r\n\tlet hsl = rgbToHsl(rgb);\r\n\thsl.s = saturation;\r\n\treturn hslToRgb(hsl);\r\n}\r\n\r\n/*\r\n// not used\r\nexport function rgbToMatrix(rgb: iRGB): string {\r\n\tlet r = $type.toText($math.round((rgb.r || 0) / 255, 10));\r\n\tlet g = $type.toText($math.round((rgb.g || 0) / 255, 10));\r\n\tlet b = $type.toText($math.round((rgb.b || 0) / 255, 10));\r\n\tlet a = $type.toText(rgb.a || 1);\r\n\treturn\t      r + \" 0 0 0 0\" +\r\n\t\t\t\t\t\" 0 \" + g + \" 0 0 0\" +\r\n\t\t\t\t\t\" 0 0 \" + b + \" 0 0\" +\r\n\t\t\t\t\t\" 0 0 0 \" + a + \" 0\";\r\n}\r\n*/\r\n\r\n/**\r\n * The functions below are taken and adapted from Garry Tan's blog post:\r\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\r\n *\r\n * The further attributions go mjijackson.com, which now seems to be defunct.\r\n */\r\n\r\n/**\r\n * Converts an HSL color value to RGB. Conversion formula\r\n * adapted from http://en.wikipedia.org/wiki/HSL_color_space.\r\n * Assumes h, s, and l are contained in the set [0, 1] and\r\n * returns r, g, and b in the set [0, 255].\r\n *\r\n * Function adapted from:\r\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\r\n *\r\n * @ignore Exclude from docs\r\n * @param h       The hue\r\n * @param s       The saturation\r\n * @param l       The lightness\r\n * @return The RGB representation\r\n */\r\nexport function hslToRgb(color: iHSL): iRGB {\r\n\tlet r, g, b;\r\n\tlet h = color.h;\r\n\tlet s = color.s;\r\n\tlet l = color.l;\r\n\r\n\tif (s == 0) {\r\n\t\tr = g = b = l; // achromatic\r\n\t} else {\r\n\t\tlet hue2rgb = function hue2rgb(p: number, q: number, t: number) {\r\n\t\t\tif (t < 0) { t += 1; }\r\n\t\t\tif (t > 1) { t -= 1; }\r\n\t\t\tif (t < 1 / 6) { return p + (q - p) * 6 * t; }\r\n\t\t\tif (t < 1 / 2) { return q; }\r\n\t\t\tif (t < 2 / 3) { return p + (q - p) * (2 / 3 - t) * 6; }\r\n\t\t\treturn p;\r\n\t\t}\r\n\r\n\t\tlet q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n\t\tlet p = 2 * l - q;\r\n\t\tr = hue2rgb(p, q, h + 1 / 3);\r\n\t\tg = hue2rgb(p, q, h);\r\n\t\tb = hue2rgb(p, q, h - 1 / 3);\r\n\t}\r\n\r\n\treturn {\r\n\t\tr: Math.round(r * 255),\r\n\t\tg: Math.round(g * 255),\r\n\t\tb: Math.round(b * 255)\r\n\t};\r\n}\r\n\r\n/**\r\n * Converts an RGB color value to HSL. Conversion formula\r\n * adapted from http://en.wikipedia.org/wiki/HSL_color_space.\r\n * Assumes r, g, and b are contained in the set [0, 255] and\r\n * returns h, s, and l in the set [0, 1].\r\n *\r\n * Function adapted from:\r\n * http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c\r\n *\r\n * @ignore Exclude from docs\r\n * @param r       The red color value\r\n * @param g       The green color value\r\n * @param b       The blue color value\r\n * @return The HSL representation\r\n */\r\nexport function rgbToHsl(color: iRGB): iHSL {\r\n\tlet r = color.r / 255;\r\n\tlet g = color.g / 255;\r\n\tlet b = color.b / 255;\r\n\tlet max = Math.max(r, g, b);\r\n\tlet min = Math.min(r, g, b);\r\n\tlet h = 0;\r\n\tlet s = 0;\r\n\tlet l = (max + min) / 2;\r\n\r\n\tif (max === min) {\r\n\t\th = s = 0; // achromatic\r\n\r\n\t} else {\r\n\t\tlet d = max - min;\r\n\r\n\t\ts = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n\r\n\t\tswitch (max) {\r\n\t\t\tcase r: h = (g - b) / d + (g < b ? 6 : 0); break;\r\n\t\t\tcase g: h = (b - r) / d + 2; break;\r\n\t\t\tcase b: h = (r - g) / d + 4; break;\r\n\t\t}\r\n\r\n\t\th /= 6;\r\n\t}\r\n\r\n\treturn {\r\n\t\th: h,\r\n\t\ts: s,\r\n\t\tl: l\r\n\t};\r\n}\r\n\r\n/**\r\n * Converts an RGB color value to HSV. Conversion formula\r\n * adapted from http://en.wikipedia.org/wiki/HSV_color_space.\r\n * Assumes r, g, and b are contained in the set [0, 255] and\r\n * returns h, s, and v in the set [0, 1].\r\n *\r\n * @ignore Exclude from docs\r\n * @param   Number  r       The red color value\r\n * @param   Number  g       The green color value\r\n * @param   Number  b       The blue color value\r\n * @return  Array           The HSV representation\r\n */\r\nexport function rgbToHsv(color: iRGB): iHSV {\r\n\tlet r = color.r / 255;\r\n\tlet g = color.g / 255;\r\n\tlet b = color.b / 255;\r\n\tlet max = Math.max(r, g, b), min = Math.min(r, g, b);\r\n\tlet h = 0;\r\n\tlet s = 0;\r\n\tlet v = max;\r\n\r\n\tlet d = max - min;\r\n\ts = max == 0 ? 0 : d / max;\r\n\r\n\tif (max == min) {\r\n\t\th = 0; // achromatic\r\n\r\n\t} else {\r\n\t\tswitch (max) {\r\n\t\t\tcase r: h = (g - b) / d + (g < b ? 6 : 0); break;\r\n\t\t\tcase g: h = (b - r) / d + 2; break;\r\n\t\t\tcase b: h = (r - g) / d + 4; break;\r\n\t\t}\r\n\t\th /= 6;\r\n\t}\r\n\r\n\treturn {\r\n\t\th: h,\r\n\t\ts: s,\r\n\t\tv: v\r\n\t};\r\n}\r\n\r\n/**\r\n * Converts an HSV color value to RGB. Conversion formula\r\n * adapted from http://en.wikipedia.org/wiki/HSV_color_space.\r\n * Assumes h, s, and v are contained in the set [0, 1] and\r\n * returns r, g, and b in the set [0, 255].\r\n *\r\n * @ignore Exclude from docs\r\n * @param   Number  h       The hue\r\n * @param   Number  s       The saturation\r\n * @param   Number  v       The value\r\n * @return  Array           The RGB representation\r\n */\r\nexport function hsvToRgb(color: iHSV): iRGB {\r\n\tlet r = 0;\r\n\tlet g = 0;\r\n\tlet b = 0;\r\n\tlet h = color.h;\r\n\tlet s = color.s;\r\n\tlet v = color.v;\r\n\r\n\tlet i = Math.floor(h * 6);\r\n\tlet f = h * 6 - i;\r\n\tlet p = v * (1 - s);\r\n\tlet q = v * (1 - f * s);\r\n\tlet t = v * (1 - (1 - f) * s);\r\n\r\n\tswitch (i % 6) {\r\n\t\tcase 0:\r\n\t\t\tr = v;\r\n\t\t\tg = t;\r\n\t\t\tb = p;\r\n\t\t\tbreak;\r\n\t\tcase 1:\r\n\t\t\tr = q;\r\n\t\t\tg = v;\r\n\t\t\tb = p;\r\n\t\t\tbreak;\r\n\t\tcase 2:\r\n\t\t\tr = p;\r\n\t\t\tg = v;\r\n\t\t\tb = t;\r\n\t\t\tbreak;\r\n\t\tcase 3:\r\n\t\t\tr = p;\r\n\t\t\tg = q;\r\n\t\t\tb = v;\r\n\t\t\tbreak;\r\n\t\tcase 4:\r\n\t\t\tr = t;\r\n\t\t\tg = p;\r\n\t\t\tb = v;\r\n\t\t\tbreak;\r\n\t\tcase 5:\r\n\t\t\tr = v;\r\n\t\t\tg = p;\r\n\t\t\tb = q;\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\treturn {\r\n\t\tr: Math.round(r * 255),\r\n\t\tg: Math.round(g * 255),\r\n\t\tb: Math.round(b * 255)\r\n\t};\r\n}\r\n\r\n/**\r\n * Returns `true` if color is \"light\". Useful indetermining which contrasting\r\n * color to use for elements over this color. E.g.: you would want to use\r\n * black text over light background, and vice versa.\r\n *\r\n * @ignore Exclude from docs\r\n * @param color  Source color\r\n * @return Light?\r\n */\r\nexport function isLight(color: iRGB): boolean {\r\n\treturn ((color.r * 299) + (color.g * 587) + (color.b * 114)) / 1000 >= 128;\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * COLOR CONVERSION\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Represents an interface for an object that represents an RGB color.\r\n */\r\nexport interface iRGB {\r\n\tr: number;\r\n\tg: number;\r\n\tb: number;\r\n\ta?: number;\r\n}\r\n\r\n/**\r\n * Represents an interface for an object that represents an HSL color.\r\n */\r\nexport interface iHSL {\r\n\th: number;\r\n\ts: number;\r\n\tl: number;\r\n\ta?: number;\r\n}\r\n\r\n/**\r\n * Represents an interface for an object that represents an HSV color.\r\n */\r\nexport interface iHSV {\r\n\th: number;\r\n\ts: number;\r\n\tv: number;\r\n\ta?: number;\r\n}\r\n","/**\r\n * Paper class just like the white sheet of pressed fiber it draws its name\r\n * inspiration from is used as a starting point to start a drawing.\r\n *\r\n * Before we can start adding elements (drawing) we need to take out a new sheet\r\n * of paper, or in this instance create a blank SVG element.\r\n *\r\n * This class creates such element, as well as implements methods needed to\r\n * start adding elements to it.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { AMElement } from \"./AMElement\";\r\nimport { Group } from \"./Group\";\r\nimport { SVGContainer } from \"./SVGContainer\";\r\nimport * as $dom from \"../utils/DOM\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Represents available SVG elements that can be added to paper.\r\n *\r\n * @todo Review if we can remove commented out methods\r\n */\r\nexport type SVGElementNames = \"a\" | \"altGlyph\" | \"altGlyphDef\" | \"altGlyphItem\" | \"animate\" | \"animateColor\" | \"animateMotion\" | \"animateTransform\" | \"circle\" | \"clipPath\" | \"color-profile\" | \"cursor\" | \"defs\" | \"desc\" | \"ellipse\" | \"feBlend\" | \"feColorMatrix\" | \"feComponentTransfer\" | \"feComposite\" | \"feConvolveMatrix\" | \"feDiffuseLighting\" | \"feDisplacementMap\" | \"feDistantLight\" | \"feFlood\" | \"feFuncA\" | \"feFuncB\" | \"feFuncG\" | \"feFuncR\" | \"feGaussianBlur\" | \"feImage\" | \"feMerge\" | \"feMergeNode\" | \"feMorphology\" | \"feOffset\" | \"fePointLight\" | \"feSpecularLighting\" | \"feSpotLight\" | \"feTile\" | \"feTurbulence\" | \"feConvolveMatrix\" | \"filter\" | \"font\" | \"font-face\" | \"font-face-format\" | \"font-face-name\" | \"font-face-src\" | \"font-face-uri\" | \"foreignObject\" | \"g\" | \"glyph\" | \"glyphRef\" | \"hkern\" | \"image\" | \"line\" | \"linearGradient\" | \"marker\" | \"mask\" | \"metadata\" | \"missing-glyph\" | \"mpath\" | \"path\" | \"pattern\" | \"polygon\" | \"polyline\" | \"radialGradient\" | \"rect\" | \"script\" | \"set\" | \"stop\" | \"style\" | \"svg\" | \"switch\" | \"symbol\" | \"text\" | \"textPath\" | \"title\" | \"tref\" | \"tspan\" | \"use\" | \"view\" | \"vkern\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Paper class which when instantiated will create an SVG element as well as\r\n * some of the sub-elements like `<desc>`, `<defs>`.\r\n *\r\n * Use its methods like `addGroup` and `append` to add elements to the paper.\r\n */\r\nexport class Paper {\r\n\r\n\t/**\r\n\t * A reference `<svg>` element.\r\n\t */\r\n\tpublic svg: SVGSVGElement;\r\n\r\n\t/**\r\n\t * A reference to the HTML container the `<svg>` element is placed in.\r\n\t */\r\n\tpublic container: HTMLElement;\r\n\r\n\t/**\r\n\t * A reference to the `<defs>` element.\r\n\t */\r\n\tpublic defs: SVGDefsElement;\r\n\r\n\t/**\r\n\t * An id of the element.\r\n\t */\r\n\tpublic id: string;\r\n\r\n\t/**\r\n\t * Creates main `<svg>` container and related elements.\r\n\t *\r\n\t * @param container A reference to HTML element to create `<svg>` in\r\n\t */\r\n\tconstructor(container: HTMLElement, id: string) {\r\n\r\n\t\t// Store container reference\r\n\t\tthis.container = container;\r\n\t\tthis.id = id;\r\n\r\n\t\t// Create SVG element\r\n\t\tlet svg = <SVGSVGElement>document.createElementNS($dom.SVGNS, \"svg\");\r\n\t\tsvg.setAttribute(\"version\", \"1.1\");\r\n\t\tsvg.setAttributeNS($dom.XMLNS, \"xmlns\", $dom.SVGNS);\r\n\t\tsvg.setAttributeNS($dom.XMLNS, \"xmlns:xlink\", $dom.XLINK);\r\n\t\tsvg.setAttribute(\"role\", \"group\");\r\n\t\tthis.container.appendChild(svg);\r\n\r\n\t\t// Add description\r\n\t\t//let desc: SVGElement = <SVGElement>document.createElementNS($dom.SVGNS, \"desc\");\r\n\t\t//desc.appendChild(document.createTextNode(\"JavaScript chart by amCharts\"));\r\n\t\t//svg.appendChild(desc);\r\n\r\n\t\t// Add defs\r\n\t\tthis.defs = <SVGDefsElement>document.createElementNS($dom.SVGNS, \"defs\");\r\n\t\tsvg.appendChild(this.defs);\r\n\r\n\t\t// Set width and height to fit container\r\n\t\tsvg.style.width = \"100%\";\r\n\t\tsvg.style.height = \"100%\";\r\n\t\tsvg.style.overflow = \"visible\";\r\n\r\n\t\t// Store variable\r\n\t\tthis.svg = svg;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns a new element. Does not attach it to Paper yet.\r\n\t *\r\n\t * @param elementName  Element name\r\n\t * @return New element\r\n\t */\r\n\tpublic add(elementName: SVGElementNames): AMElement {\r\n\t\treturn new AMElement(elementName);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns a new Group element. Does not attach it to Paper.\r\n\t *\r\n\t * @param groupName  Element name\r\n\t * @return New Group\r\n\t */\r\n\tpublic addGroup(groupName: SVGElementNames): Group {\r\n\t\treturn new Group(groupName);\r\n\t}\r\n\r\n\t/**\r\n\t * Appends an element to Paper.\r\n\t *\r\n\t * @param element Element to append\r\n\t */\r\n\tpublic append(element: AMElement): void {\r\n\t\tif (element) {\r\n\t\t\tthis.svg.appendChild(element.node);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Appends an element to `<defs>` block of the Paper.\r\n\t *\r\n\t * @param element  Element\r\n\t */\r\n\tpublic appendDef(element: AMElement): void {\r\n\t\tif (element) {\r\n\t\t\tthis.defs.appendChild(element.node);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and returns new `<foreignObject>` element. Does not append it to\r\n\t * Paper.\r\n\t *\r\n\t * @return A foreignObject element\r\n\t */\r\n\tpublic foreignObject(): AMElement {\r\n\t\tlet element = new AMElement(\"foreignObject\");\r\n\t\t//this.append(element);\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if browser supports `<foreignObject>` elements.\r\n\t *\r\n\t * @return Supports `foreignObject`?\r\n\t */\r\n\tpublic supportsForeignObject(): boolean {\r\n\t\treturn document.implementation.hasFeature(\"http://www.w3.org/TR/SVG11/feature#Extensibility\", \"1.1\");\r\n\t}\r\n\r\n}\r\n\r\n\r\nlet ghostPaper: Paper | null = null;\r\n\r\n/**\r\n * A [[Paper]] instance to create elements, that are not yet ready to be\r\n * placed in visible DOM.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport function getGhostPaper(): Paper {\r\n\tif (ghostPaper === null) {\r\n\t\t// ghost is used to draw elements while real paper is not yet created or Sprite doesn't know parent yet\r\n\t\tlet ghostDiv: HTMLDivElement = document.createElement(\"div\");\r\n\t\tghostDiv.hidden = true;\r\n\t\tghostDiv.style.width = \"1px\";\r\n\t\tghostDiv.style.height = \"1px\";\r\n\t\tghostDiv.style.position = \"absolute\";\r\n\t\tghostDiv.style.zIndex = \"-1000000\";\r\n\t\tdocument.body.appendChild(ghostDiv);\r\n\t\tlet ghostSvgContainer = new SVGContainer(ghostDiv, true);\r\n\t\tghostPaper = new Paper(ghostSvgContainer.SVGContainer, \"ghost\");\r\n\r\n\t}\r\n\r\n\treturn ghostPaper;\r\n}\r\n","/**\r\n * Contains code and logic for generating linear gradients.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObject } from \"../../Base\";\r\nimport { List } from \"../../utils/List\";\r\nimport { Group } from \"../Group\";\r\nimport { AMElement } from \"../AMElement\";\r\nimport { Paper, getGhostPaper } from \"../Paper\";\r\nimport { Color } from \"../../utils/Color\";\r\nimport { registry } from \"../../Registry\";\r\nimport * as $iter from \"../../utils/Iterator\";\r\nimport * as $math from \"../../utils/Math\";\r\nimport * as $type from \"../../utils/Type\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Represents an object describing color switching point in a gradiend.\r\n */\r\nexport interface IGradientStop {\r\n\r\n\t/**\r\n\t * Color.\r\n\t */\r\n\tcolor: Color;\r\n\r\n\t/**\r\n\t * Offset defines where in the gradient the color should kick in. Values\r\n\t * from 0 to 1 are possible with 0 meaning start, 0.5 half-way through the\r\n\t * gradient, etc.\r\n\t */\r\n\toffset?: number;\r\n\r\n\t/**\r\n\t * Transparency of the color. 0 - completely transparent, 1 - fully opaque.\r\n\t */\r\n\topacity?: number;\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Linear gradient class.\r\n */\r\nexport class LinearGradient extends BaseObject {\r\n\r\n\t/**\r\n\t * List of colors switch definitions in a gradient.\r\n\t */\r\n\tprotected _stops: List<IGradientStop> = new List<IGradientStop>();\r\n\r\n\t/**\r\n\t * An SVG `<group>` element used to draw gradient.\r\n\t */\r\n\tpublic element: Group;\r\n\r\n\t/**\r\n\t * Reference to Paper to add element to.\r\n\t */\r\n\tprotected _paper: $type.Optional<Paper>;\r\n\r\n\t/**\r\n\t * Gradient direction.\r\n\t */\r\n\tprotected _rotation: number = 0;\r\n\r\n\t/**\r\n\t * Constructor.\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"LinearGradient\";\r\n\r\n\t\tthis._stops.events.on(\"setIndex\", this.validate, this);\r\n\t\tthis._stops.events.on(\"inserted\", this.validate, this);\r\n\t\t// Create element\r\n\t\tthis.element = this.paper.addGroup(\"linearGradient\");\r\n\t\tthis.id = \"gradient-\" + registry.getUniqueId();\r\n\t\tthis.element.attr({ \"id\": this.id });\r\n\t\tthis._disposers.push(this.element);\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Draws gradient.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate(): void {\r\n\r\n\t\tlet rotation = (this._rotation + 90) * $math.RADIANS;\r\n\r\n\t\tlet x1: string = Math.round(50 + Math.sin(rotation + Math.PI) * 50) + '%';\r\n\t\tlet y1: string = Math.round(50 + Math.cos(rotation) * 50) + '%';\r\n\r\n\t\tlet x2: string = Math.round(50 + Math.sin(rotation) * 50) + '%';\r\n\t\tlet y2: string = Math.round(50 + Math.cos(rotation + Math.PI) * 50) + '%';\r\n\r\n\r\n\t\tlet gradientElement: Group = this.element;\r\n\t\tgradientElement.removeChildNodes();\r\n\t\tgradientElement.attr({\"x1\": x1, \"x2\":x2, \"y1\": y1, \"y2\":y2});\r\n\r\n\t\t$iter.each($iter.indexed(this._stops.iterator()), (a) => {\r\n\t\t\tlet i = a[0];\r\n\t\t\tlet stop = a[1];\r\n\t\t\tlet offset: $type.Optional<number> = stop.offset;\r\n\r\n\t\t\tif (!$type.isNumber(offset)) {\r\n\t\t\t\toffset = i / (this._stops.length - 1)\r\n\t\t\t}\r\n\r\n\t\t\tlet gradientStop: AMElement = this.paper.add(\"stop\");\r\n\t\t\tif ($type.hasValue(stop.color)) {\r\n\t\t\t\tgradientStop.attr({ \"stop-color\": stop.color.toString() });\r\n\t\t\t}\r\n\t\t\tif ($type.isNumber(stop.opacity)) {\r\n\t\t\t\tgradientStop.attr({ \"stop-opacity\": stop.opacity });\r\n\t\t\t}\r\n\r\n\t\t\tif ($type.isNumber(offset)) {\r\n\t\t\t\tgradientStop.attr({ \"offset\": offset });\r\n\t\t\t}\r\n\r\n\t\t\tgradientElement.add(gradientStop);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Clears the gradient.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic clear(): void {\r\n\t\tthis._stops.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a color step to the gradient.\r\n\t *\r\n\t * @param color    Color (hex code or named color)\r\n\t * @param opacity  Opacity (value from 0 to 1; 0 completely transaprent, 1 fully opaque)\r\n\t * @param offset   Position of color in the gradient (value 0 to 1; 0 meaning start of the gradient and 1 end)\r\n\t */\r\n\tpublic addColor(color: Color, opacity?: number, offset?: number): void {\r\n\t\tthis._stops.push({ color: color, opacity: opacity, offset: offset });\r\n\t}\r\n\r\n\t/**\r\n\t * A list of color stops in the gradient.\r\n\t *\r\n\t * @return Stops\r\n\t */\r\n\tpublic get stops(): List<IGradientStop> {\r\n\t\treturn this._stops;\r\n\t}\r\n\r\n\t/**\r\n\t * [[Paper]] instace to use for the gradient.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param paper  Paper\r\n\t */\r\n\tpublic set paper(paper: Paper) {\r\n\t\tif (this._paper != paper) {\r\n\t\t\tthis._paper = paper;\r\n\t\t\tthis.validate();\r\n\t\t\tpaper.appendDef(this.element);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Paper\r\n\t */\r\n\tpublic get paper(): Paper {\r\n\t\tif (this._paper) {\r\n\t\t\treturn this._paper;\r\n\t\t}\r\n\t\treturn getGhostPaper();\r\n\t}\r\n\r\n\t/**\r\n\t * Rotation (direction) of the gradient in degrees.\r\n\t *\r\n\t * @param value  Rotation\r\n\t */\r\n\tpublic set rotation(value: number) {\r\n\t\t//this.element.attr({ \"gradientTransform\": \"rotate(\" + value + \" 10 100)\" });\r\n\t\tthis._rotation = value;\r\n\t\tthis.validate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Rotation\r\n\t */\r\n\tpublic get rotation(): number {\r\n\t\treturn this._rotation;\r\n\t}\r\n\r\n\r\n\tpublic copyFrom(source:this){\r\n\t\tsuper.copyFrom(source);\r\n\r\n\t\tthis.stops.copyFrom(source.stops);\r\n\r\n\t\tthis._rotation = source.rotation;\r\n\t}\r\n\r\n\t/**\r\n\t * Which units are used when drawing gradient filter.\r\n\t *\r\n\t * Use `\"userSpaceOnUse\"` when applying gradient on a perfectly straight line.\r\n\t *\r\n\t * @since 4.9.17\r\n\t * @default objectBoundingBox\r\n\t * @param value Filter units\r\n\t */\r\n\tpublic set gradientUnits(value: \"objectBoundingBox\" | \"userSpaceOnUse\") {\r\n\t\tthis.element.attr({gradientUnits:value});\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"LinearGradient\"] = LinearGradient;\r\n","/**\n * amCharts 4 locale\n * \n * Locale: en\n * Language: International English\n * Author: Martynas Majeris\n *\n * Follow instructions in [on this page](https://www.amcharts.com/docs/v4/tutorials/creating-translations/) to make corrections or add new translations.\n *\n * ---\n * Edit but leave the header section above this line. You can remove any\n * subsequent comment sections.\n * ---\n *\n * Use this file as a template to create translations. Leave the key part in\n * English intact. Fill the value with a translation.\n *\n * Empty string means no translation, so default \"International English\"\n * will be used.\n *\n * If you need the translation to literally be an empty string, use `null`\n * instead.\n *\n * IMPORTANT:\n * When translating make good effort to keep the translation length\n * at least the same chartcount as the English, especially for short prompts.\n *\n * Having significantly longer prompts may distort the actual charts.\n *\n * NOTE:\n * Some prompts - like months or weekdays - come in two versions: full and\n * shortened.\n *\n * If there's no official shortened version of these in your language, and it\n * would not be possible to invent such short versions that don't seem weird\n * to native speakers of that language, fill those with the same as full\n * version.\n *\n * PLACEHOLDERS:\n * Some prompts have placeholders like \"%1\". Those will be replaced by actual\n * values during translation and should be retained in the translated prompts.\n *\n * Placeholder positions may be changed to better suit structure of the\n * sentence.\n *\n * For example \"From %1 to %2\", when actually used will replace \"%1\" with an\n * actual value representing range start, and \"%2\" will be replaced by end\n * value.\n *\n * E.g. in a Scrollbar for Value axis \"From %1 to %2\" will become\n * \"From 100 to 200\". You may translate \"From\" and \"to\", as well as re-arrange\n * the order of the prompt itself, but make sure the \"%1\" and \"%2\" remain, in\n * places where they will make sense.\n *\n * Save the file as language_LOCALE, i.e. `en_GB.ts`, `fr_FR.ts`, etc.\n */\nexport default {\n\t// Number formatting options.\n\t// \n\t// Please check with the local standards which separator is accepted to be\n\t// used for separating decimals, and which for thousands.\n\t\"_decimalSeparator\": \".\",\n\t\"_thousandSeparator\": \",\",\n\n\t// Suffixes for numbers\n\t// When formatting numbers, big or small numers might be reformatted to\n\t// shorter version, by applying a suffix.\n\t// \n\t// For example, 1000000 might become \"1m\".\n\t// Or 1024 might become \"1KB\" if we're formatting byte numbers.\n\t// \n\t// This section defines such suffixes for all such cases.\n\t\"_big_number_suffix_3\": \"k\",\n\t\"_big_number_suffix_6\": \"M\",\n\t\"_big_number_suffix_9\": \"G\",\n\t\"_big_number_suffix_12\": \"T\",\n\t\"_big_number_suffix_15\": \"P\",\n\t\"_big_number_suffix_18\": \"E\",\n\t\"_big_number_suffix_21\": \"Z\",\n\t\"_big_number_suffix_24\": \"Y\",\n\n\t\"_small_number_suffix_3\": \"m\",\n\t\"_small_number_suffix_6\": \"μ\",\n\t\"_small_number_suffix_9\": \"n\",\n\t\"_small_number_suffix_12\": \"p\",\n\t\"_small_number_suffix_15\": \"f\",\n\t\"_small_number_suffix_18\": \"a\",\n\t\"_small_number_suffix_21\": \"z\",\n\t\"_small_number_suffix_24\": \"y\",\n\n\t\"_byte_suffix_B\": \"B\",\n\t\"_byte_suffix_KB\": \"KB\",\n\t\"_byte_suffix_MB\": \"MB\",\n\t\"_byte_suffix_GB\": \"GB\",\n\t\"_byte_suffix_TB\": \"TB\",\n\t\"_byte_suffix_PB\": \"PB\",\n\n\t// Default date formats for various periods.\n\t// \n\t// This should reflect official or de facto formatting universally accepted\n\t// in the country translation is being made for\n\t// Available format codes here:\n\t// https://www.amcharts.com/docs/v4/concepts/formatters/formatting-date-time/#Format_codes\n\t// \n\t// This will be used when formatting date/time for particular granularity,\n\t// e.g. \"_date_hour\" will be shown whenever we need to show time as hours.\n\t// \n\t// \"date\" is used as in default date format when showing standalone dates.\n\t\"_date\": \"yyyy-MM-dd\",\n\t\"_date_millisecond\": \"mm:ss SSS\",\n\t\"_date_second\": \"HH:mm:ss\",\n\t\"_date_minute\": \"HH:mm\",\n\t\"_date_hour\": \"HH:mm\",\n\t\"_date_day\": \"MMM dd\",\n\t\"_date_week\": \"ww\",\n\t\"_date_month\": \"MMM\",\n\t\"_date_year\": \"yyyy\",\n\n\t// Default duration formats for various base units.\n\t// \n\t// This will be used by DurationFormatter to format numeric values into\n\t// duration.\n\t// \n\t// Notice how each duration unit comes in several versions. This is to ensure\n\t// that each base unit is shown correctly.\n\t// \n\t// For example, if we have baseUnit set to \"second\", meaning our duration is\n\t// in seconds.\n\t// \n\t// If we pass in `50` to formatter, it will know that we have just 50 seconds\n\t// (less than a minute) so it will use format in `\"_duration_second\"` (\"ss\"),\n\t// and the formatted result will be in like `\"50\"`.\n\t// \n\t// If we pass in `70`, which is more than a minute, the formatter will switch\n\t// to `\"_duration_second_minute\"` (\"mm:ss\"), resulting in \"01:10\" formatted\n\t// text.\n\t// \n\t// Available codes here:\n\t// https://www.amcharts.com/docs/v4/concepts/formatters/formatting-duration/#Available_Codes\n\t\"_duration_millisecond\": \"SSS\",\n\t\"_duration_millisecond_second\": \"ss.SSS\",\n\t\"_duration_millisecond_minute\": \"mm:ss SSS\",\n\t\"_duration_millisecond_hour\": \"hh:mm:ss SSS\",\n\t\"_duration_millisecond_day\": \"d'd' mm:ss SSS\",\n\t\"_duration_millisecond_week\": \"d'd' mm:ss SSS\",\n\t\"_duration_millisecond_month\": \"M'm' dd'd' mm:ss SSS\",\n\t\"_duration_millisecond_year\": \"y'y' MM'm' dd'd' mm:ss SSS\",\n\n\t\"_duration_second\": \"ss\",\n\t\"_duration_second_minute\": \"mm:ss\",\n\t\"_duration_second_hour\": \"hh:mm:ss\",\n\t\"_duration_second_day\": \"d'd' hh:mm:ss\",\n\t\"_duration_second_week\": \"d'd' hh:mm:ss\",\n\t\"_duration_second_month\": \"M'm' dd'd' hh:mm:ss\",\n\t\"_duration_second_year\": \"y'y' MM'm' dd'd' hh:mm:ss\",\n\n\t\"_duration_minute\": \"mm\",\n\t\"_duration_minute_hour\": \"hh:mm\",\n\t\"_duration_minute_day\": \"d'd' hh:mm\",\n\t\"_duration_minute_week\": \"d'd' hh:mm\",\n\t\"_duration_minute_month\": \"M'm' dd'd' hh:mm\",\n\t\"_duration_minute_year\": \"y'y' MM'm' dd'd' hh:mm\",\n\n\t\"_duration_hour\": \"hh'h'\",\n\t\"_duration_hour_day\": \"d'd' hh'h'\",\n\t\"_duration_hour_week\": \"d'd' hh'h'\",\n\t\"_duration_hour_month\": \"M'm' dd'd' hh'h'\",\n\t\"_duration_hour_year\": \"y'y' MM'm' dd'd' hh'h'\",\n\n\t\"_duration_day\": \"d'd'\",\n\t\"_duration_day_week\": \"d'd'\",\n\t\"_duration_day_month\": \"M'm' dd'd'\",\n\t\"_duration_day_year\": \"y'y' MM'm' dd'd'\",\n\n\t\"_duration_week\": \"w'w'\",\n\t\"_duration_week_month\": \"w'w'\",\n\t\"_duration_week_year\": \"w'w'\",\n\n\t\"_duration_month\": \"M'm'\",\n\t\"_duration_month_year\": \"y'y' MM'm'\",\n\n\t\"_duration_year\": \"y'y'\",\n\n\t// Era translations\n\t\"_era_ad\": \"AD\",\n\t\"_era_bc\": \"BC\",\n\n\t// Day part, used in 12-hour formats, e.g. 5 P.M.\n\t// Please note that these come in 3 variants:\n\t// * one letter (e.g. \"A\")\n\t// * two letters (e.g. \"AM\")\n\t// * two letters with dots (e.g. \"A.M.\")\n\t// \n\t// All three need to to be translated even if they are all the same. Some\n\t// users might use one, some the other.\n\t\"A\": \"\",\n\t\"P\": \"\",\n\t\"AM\": \"\",\n\t\"PM\": \"\",\n\t\"A.M.\": \"\",\n\t\"P.M.\": \"\",\n\n\t// Date-related stuff.\n\t// \n\t// When translating months, if there's a difference, use the form which is\n\t// best for a full date, e.g. as you would use it in \"2018 January 1\".\n\t// \n\t// Note that May is listed twice. This is because in English May is the same\n\t// in both long and short forms, while in other languages it may not be the\n\t// case. Translate \"May\" to full word, while \"May(short)\" to shortened\n\t// version.\n\t// \n\t// Should month names and weekdays be capitalized or not?\n\t// \n\t// Rule of thumb is this: if the names should always be capitalized,\n\t// regardless of name position within date (\"January\", \"21st January 2018\",\n\t// etc.) use capitalized names. Otherwise enter all lowercase.\n\t// \n\t// The date formatter will automatically capitalize names if they are the\n\t// first (or only) word in resulting date.\n\t\"January\": \"\",\n\t\"February\": \"\",\n\t\"March\": \"\",\n\t\"April\": \"\",\n\t\"May\": \"\",\n\t\"June\": \"\",\n\t\"July\": \"\",\n\t\"August\": \"\",\n\t\"September\": \"\",\n\t\"October\": \"\",\n\t\"November\": \"\",\n\t\"December\": \"\",\n\t\"Jan\": \"\",\n\t\"Feb\": \"\",\n\t\"Mar\": \"\",\n\t\"Apr\": \"\",\n\t\"May(short)\": \"May\",\n\t\"Jun\": \"\",\n\t\"Jul\": \"\",\n\t\"Aug\": \"\",\n\t\"Sep\": \"\",\n\t\"Oct\": \"\",\n\t\"Nov\": \"\",\n\t\"Dec\": \"\",\n\n\t// Weekdays.\n\t\"Sunday\": \"\",\n\t\"Monday\": \"\",\n\t\"Tuesday\": \"\",\n\t\"Wednesday\": \"\",\n\t\"Thursday\": \"\",\n\t\"Friday\": \"\",\n\t\"Saturday\": \"\",\n\t\"Sun\": \"\",\n\t\"Mon\": \"\",\n\t\"Tue\": \"\",\n\t\"Wed\": \"\",\n\t\"Thu\": \"\",\n\t\"Fri\": \"\",\n\t\"Sat\": \"\",\n\n\t// Date ordinal function.\n\t// \n\t// This is used when adding number ordinal when formatting days in dates.\n\t// \n\t// E.g. \"January 1st\", \"February 2nd\".\n\t// \n\t// The function accepts day number, and returns a string to be added to the\n\t// day, like in default English translation, if we pass in 2, we will receive\n\t// \"nd\" back.\n\t\"_dateOrd\": function(day: number): string {\n\t\tlet res = \"th\";\n\t\tif ((day < 11) || (day > 13)) {\n\t\t\tswitch (day % 10) {\n\t\t\t\tcase 1:\n\t\t\t\t\tres = \"st\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tres = \"nd\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tres = \"rd\"\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn res;\n\t},\n\n\t// Various chart controls.\n\t// Shown as a tooltip on zoom out button.\n\t\"Zoom Out\": \"\",\n\n\t// Timeline buttons\n\t\"Play\": \"\",\n\t\"Stop\": \"\",\n\n\t// Chart's Legend screen reader title.\n\t\"Legend\": \"\",\n\n\t// Legend's item screen reader indicator.\n\t\"Click, tap or press ENTER to toggle\": \"\",\n\n\t// Shown when the chart is busy loading something.\n\t\"Loading\": \"\",\n\n\t// Shown as the first button in the breadcrumb navigation, e.g.:\n\t// Home > First level > ...\n\t\"Home\": \"\",\n\n\t// Chart types.\n\t// Those are used as default screen reader titles for the main chart element\n\t// unless developer has set some more descriptive title.\n\t\"Chart\": \"\",\n\t\"Serial chart\": \"\",\n\t\"X/Y chart\": \"\",\n\t\"Pie chart\": \"\",\n\t\"Gauge chart\": \"\",\n\t\"Radar chart\": \"\",\n\t\"Sankey diagram\": \"\",\n\t\"Flow diagram\": \"\",\n\t\"Chord diagram\": \"\",\n\t\"TreeMap chart\": \"\",\n\t\"Force directed tree\": \"\",\n\t\"Sliced chart\": \"\",\n\n\t// Series types.\n\t// Used to name series by type for screen readers if they do not have their\n\t// name set.\n\t\"Series\": \"\",\n\t\"Candlestick Series\": \"\",\n\t\"OHLC Series\": \"\",\n\t\"Column Series\": \"\",\n\t\"Line Series\": \"\",\n\t\"Pie Slice Series\": \"\",\n\t\"Funnel Series\": \"\",\n\t\"Pyramid Series\": \"\",\n\t\"X/Y Series\": \"\",\n\n\t// Map-related stuff.\n\t\"Map\": \"\",\n\t\"Press ENTER to zoom in\": \"\",\n\t\"Press ENTER to zoom out\": \"\",\n\t\"Use arrow keys to zoom in and out\": \"\",\n\t\"Use plus and minus keys on your keyboard to zoom in and out\": \"\",\n\n\t// Export-related stuff.\n\t// These prompts are used in Export menu labels.\n\t// \n\t// \"Export\" is the top-level menu item.\n\t// \n\t// \"Image\", \"Data\", \"Print\" as second-level indicating type of export\n\t// operation.\n\t// \n\t// Leave actual format untranslated, unless you absolutely know that they\n\t// would convey more meaning in some other way.\n\t\"Export\": \"\",\n\t\"Image\": \"\",\n\t\"Data\": \"\",\n\t\"Print\": \"\",\n\t\"Press ENTER or use arrow keys to navigate\": \"\",\n\t\"Click, tap or press ENTER to open\": \"\",\n\t\"Click, tap or press ENTER to print.\": \"\",\n\t\"Click, tap or press ENTER to export as %1.\": \"\",\n\t'To save the image, right-click this link and choose \"Save picture as...\"': \"\",\n\t'To save the image, right-click thumbnail on the left and choose \"Save picture as...\"': \"\",\n\t\"(Press ESC to close this message)\": \"\",\n\t\"Image Export Complete\": \"\",\n\t\"Export operation took longer than expected. Something might have gone wrong.\": \"\",\n\t\"Saved from\": \"\",\n\t\"PNG\": \"\",\n\t\"JPG\": \"\",\n\t\"GIF\": \"\",\n\t\"SVG\": \"\",\n\t\"PDF\": \"\",\n\t\"JSON\": \"\",\n\t\"CSV\": \"\",\n\t\"XLSX\": \"\",\n\n\t// Scrollbar-related stuff.\n\t// \n\t// Scrollbar is a control which can zoom and pan the axes on the chart.\n\t// \n\t// Each scrollbar has two grips: left or right (for horizontal scrollbar) or\n\t// upper and lower (for vertical one).\n\t// \n\t// Prompts change in relation to whether Scrollbar is vertical or horizontal.\n\t// \n\t// The final section is used to indicate the current range of selection.\n\t\"Use TAB to select grip buttons or left and right arrows to change selection\": \"\",\n\t\"Use left and right arrows to move selection\": \"\",\n\t\"Use left and right arrows to move left selection\": \"\",\n\t\"Use left and right arrows to move right selection\": \"\",\n\t\"Use TAB select grip buttons or up and down arrows to change selection\": \"\",\n\t\"Use up and down arrows to move selection\": \"\",\n\t\"Use up and down arrows to move lower selection\": \"\",\n\t\"Use up and down arrows to move upper selection\": \"\",\n\t\"From %1 to %2\": \"\",\n\t\"From %1\": \"\",\n\t\"To %1\": \"\",\n\n\t// Data loader-related.\n\t\"No parser available for file: %1\": \"\",\n\t\"Error parsing file: %1\": \"\",\n\t\"Unable to load file: %1\": \"\",\n\t\"Invalid date\": \"\",\n\n\t// Common actions\n\t\"Close\": \"\",\n\t\"Minimize\": \"\"\n\n};","/**\r\n * Language module contains everything related to language-specific operations:\r\n * * Translating prompts\r\n * * Translating functions\r\n * * Date format localizations\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObjectEvents, IBaseObjectEvents } from \"../Base\";\r\nimport { Adapter } from \"./Adapter\";\r\nimport { AMEvent } from \"./EventDispatcher\";\r\nimport * as $array from \"./Array\";\r\nimport * as $type from \"./Type\";\r\nimport en from \"../../../lang/en\";\r\nimport { options } from \"../Options\";\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines events for [[Language]].\r\n */\r\nexport interface ILanguageEvents extends IBaseObjectEvents {\r\n\r\n\t/**\r\n\t * Invoked when locale is changed by user.\r\n\t */\r\n\tlocalechanged: {\r\n\t\tlocale: ILocale;\r\n\t};\r\n\r\n};\r\n\r\n\r\n/**\r\n * Defines properties that exist for the locale.\r\n */\r\nexport interface ILocaleProperties {\r\n\t// number formatter related\r\n\t\"_decimalSeparator\"?: string;\r\n\t\"_thousandSeparator\"?: string;\r\n\r\n\t\"_big_number_suffix_3\"?: string;\r\n\t\"_big_number_suffix_6\"?: string;\r\n\t\"_big_number_suffix_9\"?: string;\r\n\t\"_big_number_suffix_12\"?: string;\r\n\t\"_big_number_suffix_15\"?: string;\r\n\t\"_big_number_suffix_18\"?: string;\r\n\t\"_big_number_suffix_21\"?: string;\r\n\t\"_big_number_suffix_24\"?: string;\r\n\r\n\t\"_small_number_suffix_24\"?: string;\r\n\t\"_small_number_suffix_21\"?: string;\r\n\t\"_small_number_suffix_18\"?: string;\r\n\t\"_small_number_suffix_15\"?: string;\r\n\t\"_small_number_suffix_12\"?: string;\r\n\t\"_small_number_suffix_9\"?: string;\r\n\t\"_small_number_suffix_6\"?: string;\r\n\t\"_small_number_suffix_3\"?: string;\r\n\r\n\t\"_byte_suffix_B\"?: string;\r\n\t\"_byte_suffix_KB\"?: string;\r\n\t\"_byte_suffix_MB\"?: string;\r\n\t\"_byte_suffix_GB\"?: string;\r\n\t\"_byte_suffix_TB\"?: string;\r\n\t\"_byte_suffix_PB\"?: string;\r\n\r\n\t// Default date formats for various periods\r\n\t\"_date\"?: string;\r\n\t\"_date_millisecond\"?: string;\r\n\t\"_date_second\"?: string;\r\n\t\"_date_minute\"?: string;\r\n\t\"_date_hour\"?: string;\r\n\t\"_date_day\"?: string;\r\n\t\"_date_week\"?: string;\r\n\t\"_date_month\"?: string;\r\n\t\"_date_year\"?: string;\r\n\r\n\t// Default duration formats for various base units\r\n\t\"_duration_millisecond\"?: string;\r\n\t\"_duration_millisecond_second\"?: string;\r\n\t\"_duration_millisecond_minute\"?: string;\r\n\t\"_duration_millisecond_hour\"?: string;\r\n\t\"_duration_millisecond_day\"?: string;\r\n\t\"_duration_millisecond_week\"?: string;\r\n\t\"_duration_millisecond_month\"?: string;\r\n\t\"_duration_millisecond_year\"?: string;\r\n\r\n\t\"_duration_second\"?: string;\r\n\t\"_duration_second_minute\"?: string;\r\n\t\"_duration_second_hour\"?: string;\r\n\t\"_duration_second_day\"?: string;\r\n\t\"_duration_second_week\"?: string;\r\n\t\"_duration_second_month\"?: string;\r\n\t\"_duration_second_year\"?: string;\r\n\r\n\t\"_duration_minute\"?: string;\r\n\t\"_duration_minute_hour\"?: string;\r\n\t\"_duration_minute_day\"?: string;\r\n\t\"_duration_minute_week\"?: string;\r\n\t\"_duration_minute_month\"?: string;\r\n\t\"_duration_minute_year\"?: string;\r\n\r\n\t\"_duration_hour\"?: string;\r\n\t\"_duration_hour_day\"?: string;\r\n\t\"_duration_hour_week\"?: string;\r\n\t\"_duration_hour_month\"?: string;\r\n\t\"_duration_hour_year\"?: string;\r\n\r\n\t\"_duration_day\"?: string;\r\n\t\"_duration_day_week\"?: string;\r\n\t\"_duration_day_month\"?: string;\r\n\t\"_duration_day_year\"?: string;\r\n\r\n\t\"_duration_week\"?: string;\r\n\t\"_duration_week_month\"?: string;\r\n\t\"_duration_week_year\"?: string;\r\n\r\n\t\"_duration_month\"?: string;\r\n\t\"_duration_month_year\"?: string;\r\n\r\n\t\"_duration_year\"?: string;\r\n\r\n\t// Era\r\n\t\"_era_ad\"?: string;\r\n\t\"_era_bc\"?: string;\r\n\r\n\t// Period\r\n\t\"A\"?: string;\r\n\t\"P\"?: string;\r\n\t\"AM\"?: string;\r\n\t\"PM\"?: string;\r\n\t\"A.M.\"?: string;\r\n\t\"P.M.\"?: string;\r\n\r\n\t// Dates\r\n\t\"January\"?: string;\r\n\t\"February\"?: string;\r\n\t\"March\"?: string;\r\n\t\"April\"?: string;\r\n\t\"May\"?: string;\r\n\t\"June\"?: string;\r\n\t\"July\"?: string;\r\n\t\"August\"?: string;\r\n\t\"September\"?: string;\r\n\t\"October\"?: string;\r\n\t\"November\"?: string;\r\n\t\"December\"?: string;\r\n\t\"Jan\"?: string;\r\n\t\"Feb\"?: string;\r\n\t\"Mar\"?: string;\r\n\t\"Apr\"?: string;\r\n\t\"May(short)\"?: string;\r\n\t\"Jun\"?: string;\r\n\t\"Jul\"?: string;\r\n\t\"Aug\"?: string;\r\n\t\"Sep\"?: string;\r\n\t\"Oct\"?: string;\r\n\t\"Nov\"?: string;\r\n\t\"Dec\"?: string;\r\n\t\"Sunday\"?: string;\r\n\t\"Monday\"?: string;\r\n\t\"Tuesday\"?: string;\r\n\t\"Wednesday\"?: string;\r\n\t\"Thursday\"?: string;\r\n\t\"Friday\"?: string;\r\n\t\"Saturday\"?: string;\r\n\t\"Sun\"?: string;\r\n\t\"Mon\"?: string;\r\n\t\"Tue\"?: string;\r\n\t\"Wed\"?: string;\r\n\t\"Thu\"?: string;\r\n\t\"Fri\"?: string;\r\n\t\"Sat\"?: string;\r\n\r\n\t// Chart elements\r\n\t\"Zoom Out\"?: string;\r\n\t\"Play\"?: string;\r\n\t\"Stop\"?: string;\r\n\t\"Legend\"?: string;\r\n\t\"Click, tap or press ENTER to toggle\"?: string;\r\n\t\"Loading\"?: string;\r\n\t\"%1 shown\"?: string;\r\n\t\"%1 hidden\"?: string;\r\n\r\n\t// Chart types\r\n\t\"Chart\"?: string;\r\n\t\"Serial chart\"?: string;\r\n\t\"X/Y chart\"?: string;\r\n\t\"Pie chart\"?: string;\r\n\t\"Sunburst chart\"?: string;\r\n\t\"Gauge chart\"?: string;\r\n\t\"Radar chart\"?: string;\r\n\t\"Sankey diagram\"?: string;\r\n\t\"Flow diagram\"?: string;\r\n\t\"Chord diagram\"?: string;\r\n\t\"TreeMap chart\"?: string;\r\n\t\"Force directed tree\"?: string;\r\n\t\"Sliced chart\"?: string;\r\n\r\n\t// Series types\r\n\t\"Series\"?: string;\r\n\t\"Candlestick Series\"?: string;\r\n\t\"OHLC Series\"?: string;\r\n\t\"Column Series\"?: string;\r\n\t\"Line Series\"?: string;\r\n\t\"Pie Slice Series\"?: string;\r\n\t\"Funnel Series\"?: string;\r\n\t\"Pyramid Series\"?: string;\r\n\t\"X/Y Series\"?: string;\r\n\r\n\t// Map-related\r\n\t\"Map\"?: string;\r\n\t\"Press ENTER to zoom in\"?: string;\r\n\t\"Press ENTER to zoom out\"?: string;\r\n\t\"Use arrow keys to zoom in and out\"?: string;\r\n\t\"Use plus and minus keys on your keyboard to zoom in and out\"?: string;\r\n\t\"Home\"?: string;\r\n\t\"Zoom level changed to %1\"?: string;\r\n\r\n\t// Export-related\r\n\t\"Export\"?: string;\r\n\t\"Image\"?: string;\r\n\t\"Data\"?: string;\r\n\t\"Print\"?: string;\r\n\t\"Press ENTER or use arrow keys to navigate\"?: string;\r\n\t\"Click, tap or press ENTER to open\"?: string;\r\n\t\"Click, tap or press ENTER to print.\"?: string;\r\n\t\"Click, tap or press ENTER to export as %1.\"?: string;\r\n\t'To save the image, right-click this link and choose \"Save picture as...\"': string;\r\n\t'To save the image, right-click thumbnail on the left and choose \"Save picture as...\"': string;\r\n\t\"(Press ESC to close this message)\"?: string;\r\n\t\"Image Export Complete\"?: string;\r\n\t\"Export operation took longer than expected. Something might have gone wrong.\"?: string;\r\n\t\"Saved from\"?: string;\r\n\t\"PNG\"?: string;\r\n\t\"JPG\"?: string;\r\n\t\"GIF\"?: string;\r\n\t\"SVG\"?: string;\r\n\t\"PDF\"?: string;\r\n\t\"JSON\"?: string;\r\n\t\"CSV\"?: string;\r\n\t\"XLSX\"?: string;\r\n\r\n\t// Scrollbar-related\r\n\t\"Use TAB to select grip buttons or left and right arrows to change selection\"?: string;\r\n\t\"Use left and right arrows to move selection\"?: string;\r\n\t\"Use left and right arrows to move left selection\"?: string;\r\n\t\"Use left and right arrows to move right selection\"?: string;\r\n\t\"Use TAB select grip buttons or up and down arrows to change selection\"?: string;\r\n\t\"Use up and down arrows to move selection\"?: string;\r\n\t\"Use up and down arrows to move lower selection\"?: string;\r\n\t\"Use up and down arrows to move upper selection\"?: string;\r\n\t\"From %1 to %2\"?: string;\r\n\t\"From %1\"?: string;\r\n\t\"To %1\"?: string;\r\n\r\n\t// Data loader-related\r\n\t\"No parser available for file: %1\"?: string;\r\n\t\"Error parsing file: %1\"?: string;\r\n\t\"Unable to load file: %1\"?: string;\r\n\t\"Invalid date\"?: string;\r\n\r\n\t// Common actions\r\n\t\"Close\"?: string;\r\n\t\"Minimize\"?: string;\r\n\r\n\t\"Venn Series\"?: string;\r\n\t\"Venn Diagram\"?: string;\r\n}\r\n\r\n/**\r\n * Defines functions that exist for the locale.\r\n */\r\nexport interface ILocaleFunctions {\r\n\t// ordinal function\r\n\t\"_dateOrd\": (day: number) => string;\r\n}\r\n\r\n/**\r\n * Defines all of the defaults for locale properties.\r\n */\r\nexport interface ILocaleDefault extends ILocaleProperties, ILocaleFunctions { }\r\n\r\n/**\r\n * Defines locale interface.\r\n */\r\nexport interface ILocale extends Partial<ILocaleDefault> { };\r\n\r\n/**\r\n * Represents a list of available adapters for Language.\r\n */\r\nexport interface ILanguageAdapters {\r\n\r\n\t/**\r\n\t * Applied to result whenever retrieving currently set locale.\r\n\t */\r\n\tlocale: {\r\n\t\tlocale: ILocale\r\n\t},\r\n\r\n\t/**\r\n\t * Applied to a translation.\r\n\t */\r\n\ttranslate: {\r\n\t\ttranslation: string,\r\n\t\tlocale?: ILocale\r\n\t},\r\n\r\n\t/**\r\n\t * Applied to all of the locale translations.\r\n\t */\r\n\ttranslations: {\r\n\t\ttranslations: any,\r\n\t\tlocale?: ILocale\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Handles all language-related tasks, like loading and storing translations,\r\n * translating prompts, lists of prompts and even functions.\r\n *\r\n * Almost every object in amCharts4 universe will have a `language` property,\r\n * which can be accessed for prompt translation.\r\n *\r\n * @see {@link ILanguageAdapters} for a list of available Adapters\r\n * @todo Make prompt keys case-insensitive\r\n * @important\r\n */\r\nexport class Language extends BaseObjectEvents {\r\n\t/**\r\n\t * Defines type used in the Sprite.\r\n\t */\r\n\tpublic _adapter!: ILanguageAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: ILanguageEvents;\r\n\r\n\t/**\r\n\t * Adapter.\r\n\t */\r\n\tpublic adapter: Adapter<this, this[\"_adapter\"]> = new Adapter(this);\r\n\r\n\t/**\r\n\t * Current locale.\r\n\t */\r\n\tprotected _locale: ILocale = en;\r\n\r\n\t/**\r\n\t * Default locale. A locale to fall back to if none is specified, or\r\n\t * if there's no translation for the prompt for the current language.\r\n\t */\r\n\tprotected _defaultLocale: ILocaleDefault = en;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"Language\";\r\n\r\n\t\t// Set default language if necessary\r\n\t\tif ($type.hasValue(options.defaultLocale)) {\r\n\t\t\tthis.locale = options.defaultLocale;\r\n\t\t}\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns locale that is currently used.\r\n\t *\r\n\t * @param locale  Force locale. Will use current language if not set.\r\n\t * @return Locale\r\n\t */\r\n\tprotected getLocale(locale?: ILocale): ILocale {\r\n\t\tif (locale == null) {\r\n\t\t\tlocale = this._locale;\r\n\t\t}\r\n\r\n\t\treturn this.adapter.apply(\"locale\", {\r\n\t\t\tlocale: locale\r\n\t\t}).locale;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the translation of the string.\r\n\t *\r\n\t * If the translation is empty, it will return untranslated prompt.\r\n\t *\r\n\t * Third parameter and up are strings that can be used to replace \"%X\"\r\n\t * placeholders in prompt.\r\n\t *\r\n\t * E.g.:\r\n\t *\r\n\t * ```TypeScript\r\n\t * // Results in \"This is a first translation test\"\r\n\t * chart.language.translate(\"This is a %1 translation %2\", null, \"first\", \"test\");\r\n\t * ```\r\n\t * ```JavaScriptScript\r\n\t * // Results in \"This is a first translation test\"\r\n\t * chart.language.translate(\"This is a %1 translation %2\", null, \"first\", \"test\");\r\n\t * ```\r\n\t *\r\n\t * @param  prompt   A string to translate\r\n\t * @param  locale   Force translation into specific locale, e.g. fr_FR\r\n\t * @param  rest     Parameters to replace in string\r\n\t * @return          Translation\r\n\t */\r\n\tpublic translate<Key extends keyof ILocaleProperties>(prompt: Key, locale?: ILocale, ...rest: Array<string>): string {\r\n\r\n\t\t// Get langauge\r\n\t\tlocale = this.getLocale(locale);\r\n\r\n\t\t// Init translation\r\n\t\tlet translation: string = prompt;\r\n\r\n\t\t// Get translations for the locale\r\n\t\tlet translations = this.getTranslations(locale);\r\n\r\n\t\tlet value: $type.Optional<ILocaleDefault[Key]> = translations[prompt];\r\n\r\n\t\t// Try to look for the translation\r\n\t\tif (value === null) {\r\n\t\t\tvalue = \"\";\r\n\t\t}\r\n\t\telse if ($type.hasValue(value)) {\r\n\t\t\t// It might be an empty string\r\n\t\t\tif (value) {\r\n\t\t\t\ttranslation = value!;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (locale !== this._defaultLocale) {\r\n\t\t\t// Try to look in default language\r\n\t\t\treturn this.translate(prompt, this._defaultLocale, ...rest);\r\n\t\t}\r\n\r\n\t\t// Replace %1, %2, etc params\r\n\t\tif (rest.length) {\r\n\t\t\tfor (let len = rest.length, i = 0; i < len; ++i) {\r\n\t\t\t\ttranslation = translation.split(\"%\" + (i + 1)).join(rest[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Return the translation\r\n\t\treturn this.adapter.apply(\"translate\", {\r\n\t\t\ttranslation: translation,\r\n\t\t\tlocale: locale\r\n\t\t}).translation;\r\n\t}\r\n\r\n\t/**\r\n\t * Non-type-checked translation.\r\n\t *\r\n\t * Can be used by plugins and other code that may have their own non-standard\r\n\t * translation prompts.\r\n\t *\r\n\t * @since 4.5.5\r\n\t * @param  prompt   A string to translate\r\n\t * @param  locale   Force translation into specific locale, e.g. fr_FR\r\n\t * @param  rest     Parameters to replace in string\r\n\t * @return          Translation\r\n\t */\r\n\tpublic translateAny(prompt: string, locale?: ILocale, ...rest: Array<string>): string {\r\n\t\treturn this.translate(<any>prompt, locale, ...rest);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a prompt translation.\r\n\t *\r\n\t * @since 4.9.35\r\n\t * @param  prompt       Prompt in English\r\n\t * @param  translation  Translation\r\n\t * @param  locale       Locale\r\n\t */\r\n\tpublic setTranslationAny(prompt: string, translation: string, locale?: ILocale): void {\r\n\t\tconst localeTarget = locale || this.locale;\r\n\t\t(<any>localeTarget)[prompt] = translation;\r\n\t}\r\n\r\n\t/**\r\n\t * Translates prompt.\r\n\t *\r\n\t * If translation is empty, it will return empty string, which is a different\r\n\t * behavior than that of regular `translate`.\r\n\t *\r\n\t * @param prompt   A string to translate\r\n\t * @param locale   Force translation into specific locale, e.g. fr_FR\r\n\t * @param ...rest  Parameters to replace in string\r\n\t * @return Translation\r\n\t */\r\n\tpublic translateEmpty<Key extends keyof ILocaleProperties>(prompt: Key, locale?: ILocale, ...rest: Array<string>): string {\r\n\t\tlet translation = this.translate(prompt, locale, ...rest);\r\n\t\treturn translation == prompt ? \"\" : translation;\r\n\t}\r\n\r\n\t/**\r\n\t * Translates a function.\r\n\t *\r\n\t * This method will return a function reference, but will not run it. It's\r\n\t * up to the caller script to run the function.\r\n\t *\r\n\t * @param prompt  A function id to translate\r\n\t * @param locale  Force translation into specific locale. e.g. fr_FR\r\n\t * @return A language-specific version of the function\r\n\t * @todo Apply adapter\r\n\t */\r\n\tpublic translateFunc<Key extends keyof ILocaleFunctions>(prompt: Key, locale?: ILocale): ILocaleFunctions[Key] {\r\n\r\n\t\t// Get langauge\r\n\t\tlocale = this.getLocale(locale);\r\n\r\n\t\t// Get translations for the locale\r\n\t\tlet translations = this.getTranslations(locale);\r\n\r\n\t\tlet value: $type.Optional<ILocaleFunctions[Key]> = translations[prompt];\r\n\r\n\t\t// Try to look for the translation\r\n\t\tif (value != null) {\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Try to look in default language\r\n\t\tif (locale !== this._defaultLocale) {\r\n\t\t\treturn this.translateFunc(prompt, this._defaultLocale);\r\n\t\t}\r\n\r\n\t\t// Fail - return empty function\r\n\t\treturn (): string => {\r\n\t\t\treturn \"\";\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Translates a list of prompts in one go.\r\n\t *\r\n\t * @param list    An array of strings to translate\r\n\t * @param locale  Force translation into specific locale. e.g. fr_FR\r\n\t * @return An array of translated strings in the same order as source list\r\n\t */\r\n\tpublic translateAll<Key extends keyof ILocaleProperties>(list: Array<Key>, locale?: ILocale): Array<string> {\r\n\t\t// Translate all items in the list\r\n\t\tif (!this.isDefault()) {\r\n\t\t\treturn $array.map(list, (x) => this.translate(x, locale));\r\n\r\n\t\t} else {\r\n\t\t\treturn list;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if the currently selected locale is a default locale.\r\n\t *\r\n\t * @return `true` if locale is default; `false` if it is not.\r\n\t */\r\n\tpublic isDefault(): boolean {\r\n\t\treturn this._defaultLocale === this._locale;\r\n\t}\r\n\r\n\t/**\r\n\t * Current locale.\r\n\t *\r\n\t * @param value  Locale definition (translations)\r\n\t */\r\n\tpublic set locale(value: ILocale) {\r\n\t\tif (this._locale != value) {\r\n\t\t\tthis._locale = value;\r\n\r\n\r\n\t\t\tif (this.events.isEnabled(\"localechanged\")) {\r\n\t\t\t\tconst event: AMEvent<this, ILanguageEvents>[\"localechanged\"] = {\r\n\t\t\t\t\ttype: \"localechanged\",\r\n\t\t\t\t\tlocale: value,\r\n\t\t\t\t\ttarget: this\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"localechanged\", event);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Locale definition\r\n\t */\r\n\tpublic get locale(): ILocale {\r\n\t\treturn this._locale;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns translations for a given locale.\r\n\t *\r\n\t * @ignore\r\n\t * @deprecated\r\n\t * @param locale  Locale\r\n\t * @return Translations\r\n\t */\r\n\tpublic getTranslations(locale: ILocale): ILocale {\r\n\t\treturn this.adapter.apply(\"translations\", {\r\n\t\t\ttranslations: locale,\r\n\t\t\tlocale: locale\r\n\t\t}).translations;\r\n\t}\r\n\r\n}\r\n","/**\r\n * Handles formatting of pseudo-markup in text.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObject } from \"../Base\";\r\nimport { AMElement } from \"../rendering/AMElement\";\r\nimport { Adapter } from \"../utils/Adapter\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $strings from \"../utils/Strings\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n/**\r\n * Defines an interface for an object that holds a chunk of text.\r\n */\r\nexport interface ITextChunk {\r\n\r\n\t/**\r\n\t * Type of the chunk.\r\n\t */\r\n\t\"type\": \"value\" | \"text\" | \"format\" | \"image\",\r\n\r\n\t/**\r\n\t * Text.\r\n\t */\r\n\t\"text\": string\r\n\r\n}\r\n\r\n/**\r\n * A list of Adapters for [[TextFormatter]].\r\n */\r\nexport interface ITextFormatterAdapters {\r\n\r\n\t/**\r\n\t * Applied to each chunk of text when it is parsed and added to chunk list.\r\n\t */\r\n\tchunk: string\r\n\r\n}\r\n\r\n/**\r\n * Handles formatting of pseudo-markdown in text.\r\n *\r\n * @todo Encode < > in output\r\n * @todo Add more adapters\r\n * @important\r\n */\r\nexport class TextFormatter extends BaseObject {\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: ITextFormatterAdapters;\r\n\r\n\t/**\r\n\t * Adapter.\r\n\t */\r\n\tpublic adapter = new Adapter<TextFormatter, ITextFormatterAdapters>(this);\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"TextFormatter\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\tprotected debug(): void { }\r\n\r\n\t/**\r\n\t * Formats the text according to specifications passed in.\r\n\t *\r\n\t * @param text    Text to format\r\n\t * @param output  Output format (svg, html)\r\n\t * @return Formatted text\r\n\t */\r\n\tpublic format(text: string, output?: string): string {\r\n\r\n\t\t// Apply default\r\n\t\tif (!$type.hasValue(output)) {\r\n\t\t\toutput = \"svg\";\r\n\t\t}\r\n\r\n\t\t// Init return value\r\n\t\tlet formatted: string = \"\";\r\n\r\n\t\t// Replace double (escaped) square spaces with remporary codes\r\n\t\ttext = this.escape(text);\r\n\r\n\t\t// Divvy up the string by style tags\r\n\t\tlet styles: string[] | null = text.match(/\\[([^\\]]*?)\\]/gm);\r\n\r\n\t\tif (!styles) {\r\n\t\t\t// Nothing to do here - no formatting elements\r\n\t\t\treturn this.wrap(text, \"\", output);\r\n\t\t}\r\n\r\n\t\t// Get pure text - no style tags\r\n\t\tlet texts: string[] = text.split(/\\[[^\\[\\]]*\\]/);\r\n\r\n\t\t// Go through each of the texts and wrap it in style tags\r\n\t\tfor (let i = 0, len = texts.length; i < len; i++) {\r\n\r\n\t\t\t// Get text bit\r\n\t\t\tlet t: string = texts[i];\r\n\r\n\t\t\t// Check if string is empty\r\n\t\t\tif (t === \"\") {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// Run through an adapter\r\n\t\t\tt = this.adapter.apply(\"chunk\", t);\r\n\r\n\t\t\t// Get related style\r\n\t\t\tlet s: string = \"\";\r\n\t\t\tif (i > 0) {\r\n\t\t\t\ts = styles[i - 1].replace('[', '').replace(']', '');\r\n\t\t\t}\r\n\r\n\t\t\t// Wrap text in tag\r\n\t\t\tformatted += this.wrap(t, s, output);\r\n\t\t}\r\n\r\n\t\t// Replace placeholders back\r\n\t\tformatted = this.unescape(formatted);\r\n\r\n\t\t// Return result\r\n\t\treturn this.cleanUp(formatted);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Replaces brackets with temporary placeholders.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text  Input text\r\n\t * @return Escaped text\r\n\t */\r\n\tpublic escape(text: string): string {\r\n\t\treturn text.\r\n\t\t\treplace(/\\[\\[/g, registry.getPlaceholder(\"1\")).\r\n\t\t\treplace(/([^\\/]{1})\\]\\]/g, \"$1\" + registry.getPlaceholder(\"2\")).\r\n\t\t\treplace(/\\]\\]/g, registry.getPlaceholder(\"2\")).\r\n\t\t\treplace(/\\{\\{/g, registry.getPlaceholder(\"3\")).\r\n\t\t\treplace(/\\}\\}/g, registry.getPlaceholder(\"4\")).\r\n\t\t\treplace(/\\'\\'/g, registry.getPlaceholder(\"5\"));\r\n\t}\r\n\r\n\t/**\r\n\t * Replaces placeholders back to brackets.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text  Escaped text\r\n\t * @return Unescaped text\r\n\t */\r\n\tpublic unescape(text: string): string {\r\n\t\treturn text.\r\n\t\t\treplace(new RegExp(registry.getPlaceholder(\"1\"), \"g\"), \"[[\").\r\n\t\t\treplace(new RegExp(registry.getPlaceholder(\"2\"), \"g\"), \"]]\").\r\n\t\t\treplace(new RegExp(registry.getPlaceholder(\"3\"), \"g\"), \"{{\").\r\n\t\t\treplace(new RegExp(registry.getPlaceholder(\"4\"), \"g\"), \"}}\").\r\n\t\t\treplace(new RegExp(registry.getPlaceholder(\"5\"), \"g\"), \"'\");\r\n\t}\r\n\r\n\t/**\r\n\t * Cleans up the text text for leftover double square brackets.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text  Input text\r\n\t * @return Cleaned up text\r\n\t */\r\n\tpublic cleanUp(text: string): string {\r\n\t\treturn text.\r\n\t\t\treplace(/\\[\\[/g, \"[\").\r\n\t\t\treplace(/\\]\\]/g, \"]\").\r\n\t\t\treplace(/\\{\\{/g, \"{\").\r\n\t\t\treplace(/\\}\\}/g, \"}\").\r\n\t\t\treplace(/\\'\\'/g, \"'\");\r\n\t}\r\n\r\n\t/**\r\n\t * Wraps text into corresponding tags.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text   Text to wrap\r\n\t * @param style  Styles\r\n\t * @param output  Format to output in (svg, html)\r\n\t * @return Formatted string\r\n\t */\r\n\tpublic wrap(text: string, style: string, output: string): string {\r\n\r\n\t\tif (style === \"\" || style === \"/\") {\r\n\t\t\t//return text;\r\n\t\t\tstyle = \"\";\r\n\t\t}\r\n\r\n\t\tswitch (output) {\r\n\t\t\tcase \"html\":\r\n\t\t\t\treturn this.wrapHtml(text, this.translateStyleShortcuts(style));\r\n\t\t\tdefault:\r\n\t\t\t\treturn this.wrapSvg(text, this.translateStyleShortcuts(style));\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Wraps text in styled SVG tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text   Text to wrap\r\n\t * @param style  Style property\r\n\t * @return Formatted tag\r\n\t */\r\n\tpublic wrapSvg(text: string, style: string): string {\r\n\t\tif (style === \"\") {\r\n\t\t\treturn \"<tspan>\" + text + \"</tspan>\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn \"<tspan style='\" + style + \"'>\" + text + \"</tspan>\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an SVG `<tspan>` element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text   Text\r\n\t * @param style  Style\r\n\t * @return Element\r\n\t */\r\n\tpublic getSvgElement(text: string, style?: string): AMElement {\r\n\t\tlet element = new AMElement(\"tspan\");\r\n\t\telement.textContent = text;\r\n\t\tif (style) {\r\n\t\t\telement.node.setAttribute(\"style\", style);\r\n\t\t}\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Wraps text in HTML <span> tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text   Text to wrap\r\n\t * @param style  Style property\r\n\t * @return Formatted tag\r\n\t * @todo Translate SVG styles into HTML ones\r\n\t */\r\n\tpublic wrapHtml(text: string, style: string): string {\r\n\t\tif (style === \"\") {\r\n\t\t\treturn \"<span>\" + text + \"</span>\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn \"<span style='\" + this.styleSvgToHtml(style) + \"'>\" + text + \"</span>\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an HTML `<span>` element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text   Text/HTML\r\n\t * @param style  Style definition\r\n\t * @return HTML element\r\n\t */\r\n\tpublic getHtmlElement(text: string, style?: string): HTMLElement {\r\n\t\tlet element = document.createElement(\"span\");\r\n\t\telement.innerHTML = text;\r\n\t\tif (style) {\r\n\t\t\telement.setAttribute(\"style\", style);\r\n\t\t}\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Trabslates SVG CSS into HTML CSS.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param style  SVG CSS\r\n\t * @return HTML CSS\r\n\t * @todo Implement actual translation\r\n\t */\r\n\tpublic styleSvgToHtml(style: string): string {\r\n\t\tstyle = style.replace(/fill:/, \"color:\");\r\n\t\treturn style;\r\n\t}\r\n\r\n\t/**\r\n\t * Translates style shortcuts into full styles, i.e.:\r\n\t * \"bold\" => \"font-weight: bold\"\r\n\t * \"#f00\" => \"fill: #f00\"\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param style  Untranslated style\r\n\t * @return Translated style\r\n\t * @todo Implement actual translation\r\n\t */\r\n\tpublic translateStyleShortcuts(style: string): string {\r\n\r\n\r\n\t\tif (style == \"\" || style == \"[ ]\") {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\r\n\t\tlet cached = registry.getCache(\"translateStyleShortcuts_\" + style);\r\n\t\tif (cached) {\r\n\t\t\treturn cached;\r\n\t\t}\r\n\r\n\t\t// Pre-process quoted text\r\n\t\tconst q = style.match(/('[^']*')|(\"[^\"]*\")/gi);\r\n\t\tif (q) {\r\n\t\t\tfor (let i: number = 0; i < q.length; i++) {\r\n\t\t\t\tstyle = style.replace(q[i], q[i].replace(/['\"]*/g, \"\").replace(/[ ]+/g, \"+\"));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Get style parts\r\n\t\tlet b: string[] | null = style.match(/([\\w\\-]*:[\\s]?[^;\\s\\]]*)|(\\#[\\w]{1,6})|([\\w]+)|(\\/)/gi);\r\n\r\n\t\t// Empty?\r\n\t\tif (!b) {\r\n\t\t\treturn style;\r\n\t\t}\r\n\r\n\t\t// Check each part\r\n\t\tfor (let i: number = 0; i < b.length; i++) {\r\n\r\n\t\t\tif (b[i].match(/^bold$/i)) {\r\n\t\t\t\t// Bold\r\n\t\t\t\tb[i] = \"font-weight:\" + b[i];\r\n\t\t\t}\r\n\t\t\telse if (b[i] == \"/\") {\r\n\t\t\t\t// Just closing tag\r\n\t\t\t\t// Do nothing\r\n\t\t\t\tb[i] = \"\";\r\n\t\t\t}\r\n\t\t\telse if (!b[i].match(/:/)) {\r\n\t\t\t\t// Color\r\n\t\t\t\tb[i] = \"fill:\" + b[i];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tb[i] = b[i].replace(/\\+/g, \" \");\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tlet res = b.join(';');\r\n\t\tregistry.setCache(\"translateStyleShortcuts_\" + style, res);\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Splits string into chunks. (style blocks, quoted blocks, regular blocks)\r\n\t *\r\n\t * If the second parameter `quotedBlocks` is set to `true` this method will\r\n\t * also single out text blocks enclosed within single quotes that no\r\n\t * formatting should be applied to, and they should be displayed as is.\r\n\t *\r\n\t * Default for the above is `false`, so that you can use single quote in text\r\n\t * without escaping it.\r\n\t *\r\n\t * If enabled, single quotes can be escaped by doubling it - adding two\r\n\t * single quotes, which will be replaced by a one single quote in the final\r\n\t * output.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text          Text to chunk\r\n\t * @param quotedBlocks  Use quoted blocks\r\n\t * @param noFormatting  Formatting blocks will be treated as regular text\r\n\t * @return Array of string chunks\r\n\t */\r\n\tpublic chunk(text: string, quotedBlocks: boolean = false, noFormatting: boolean = false): ITextChunk[] {\r\n\r\n\t\t// Init result\r\n\t\tlet res: ITextChunk[] = [];\r\n\r\n\t\t// Replace double (escaped) square spaces and quotes with temporary codes\r\n\t\ttext = this.escape(text);\r\n\r\n\t\t// Deal with style blocks\r\n\t\tlet chunks = quotedBlocks ? text.split(\"'\") : [text];\r\n\t\tfor (let i: number = 0; i < chunks.length; i++) {\r\n\t\t\tlet chunk = chunks[i];\r\n\r\n\t\t\t// Empty?\r\n\t\t\tif (chunk === \"\") {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif ((i % 2) === 0) {\r\n\r\n\t\t\t\t// Text outside quotes\r\n\t\t\t\t// Parse for style blocks which are \"text\" chunks, the rest chunks are\r\n\t\t\t\t// \"value\"\r\n\r\n\t\t\t\tchunk = chunk.replace(/\\]\\[/g, \"]\" + $strings.PLACEHOLDER + \"[\");\r\n\t\t\t\tchunk = chunk.replace(/\\[\\]/g, \"[ ]\");\r\n\t\t\t\tlet chunks2 = chunk.split(/[\\[\\]]+/);\r\n\t\t\t\tfor (let i2: number = 0; i2 < chunks2.length; i2++) {\r\n\t\t\t\t\tlet chunk2 = this.cleanUp(this.unescape(chunks2[i2]));\r\n\r\n\t\t\t\t\t// Placeholder?\r\n\t\t\t\t\tif (chunk2 === $strings.PLACEHOLDER) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Empty?\r\n\t\t\t\t\tif (chunk2 === \"\") {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Block or value\r\n\t\t\t\t\tif ((i2 % 2) === 0) {\r\n\t\t\t\t\t\tres.push({\r\n\t\t\t\t\t\t\t\"type\": \"value\",\r\n\t\t\t\t\t\t\t\"text\": this.adapter.apply(\"chunk\", chunk2)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tres.push({\r\n\t\t\t\t\t\t\t\"type\": noFormatting ? \"value\" : \"format\",\r\n\t\t\t\t\t\t\t\"text\": \"[\" + chunk2 + \"]\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\r\n\t\t\t\t// A text within doublequotes\r\n\t\t\t\t// All chunks are \"text\"\r\n\r\n\t\t\t\tlet chunks2 = chunk.split(/[\\[\\]]+/);\r\n\t\t\t\tfor (let i2: number = 0; i2 < chunks2.length; i2++) {\r\n\t\t\t\t\tlet chunk2 = this.cleanUp(this.unescape(chunks2[i2]));\r\n\r\n\t\t\t\t\t// Empty?\r\n\t\t\t\t\tif (chunk2 === \"\") {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Block or text\r\n\t\t\t\t\tif ((i2 % 2) === 0) {\r\n\t\t\t\t\t\tres.push({\r\n\t\t\t\t\t\t\t\"type\": \"text\",\r\n\t\t\t\t\t\t\t\"text\": chunk2\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (this.isImage(chunk2)) {\r\n\t\t\t\t\t\tres.push({\r\n\t\t\t\t\t\t\t\"type\": \"image\",\r\n\t\t\t\t\t\t\t\"text\": \"[\" + chunk2 + \"]\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tres.push({\r\n\t\t\t\t\t\t\t\"type\": \"format\",\r\n\t\t\t\t\t\t\t\"text\": \"[\" + chunk2 + \"]\"\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if supplied format contains image information and should be\r\n\t * formatted as such.\r\n\t * I.e.: `[img: myImage.png]`\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text  Format\r\n\t * @return `true` if it is an image\r\n\t */\r\n\tpublic isImage(text: string): boolean {\r\n\t\treturn text.match(/img[ ]?:/) ? true : false;\r\n\t}\r\n\r\n}\r\n\r\n\r\nlet formatter: TextFormatter;\r\n\r\n/**\r\n * Returns the global instance of [[TextFormatter]].\r\n *\r\n * All classes and instances should reuse this universal text formatter,\r\n * rather than create their own instance of it.\r\n */\r\nexport function getTextFormatter(): TextFormatter {\r\n\tif (formatter == null) {\r\n\t\tformatter = new TextFormatter();\r\n\t}\r\n\r\n\treturn formatter;\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"TextFormatter\"] = TextFormatter;\r\n","/**\r\n * Rounded rectangle module.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite, ISpriteProperties, ISpriteAdapters, ISpriteEvents } from \"../Sprite\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $math from \"../utils/Math\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport { Percent } from \"../utils/Percent\";\r\nimport { IRectangle } from \"../defs/IRectangle\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[RoundedRectangle]].\r\n */\r\nexport interface IRoundedRectangleProperties extends ISpriteProperties {\r\n\r\n\t/**\r\n\t * Radius of the top-left corner in pixels.\r\n\t *\r\n\t * @default 3\r\n\t */\r\n\tcornerRadiusTopLeft?: number;\r\n\r\n\t/**\r\n\t * Radius of the top-right corner in pixels.\r\n\t *\r\n\t * @default 3\r\n\t */\r\n\tcornerRadiusTopRight?: number;\r\n\r\n\t/**\r\n\t * Radius of the bottom-right corner in pixels.\r\n\t *\r\n\t * @default 3\r\n\t */\r\n\tcornerRadiusBottomRight?: number;\r\n\r\n\t/**\r\n\t * Radius of the bottom-left corner in pixels.\r\n\t *\r\n\t * @default 3\r\n\t */\r\n\tcornerRadiusBottomLeft?: number;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[RoundedRectangle]].\r\n */\r\nexport interface IRoundedRectangleEvents extends ISpriteEvents { }\r\n\r\n/**\r\n * Defines adapters for [[RoundedRectangle]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IRoundedRectangleAdapters extends ISpriteAdapters, IRoundedRectangleProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Draws a rectangle with rounded corners.\r\n *\r\n * @see {@link IRoundedRectangleEvents} for a list of available events\r\n * @see {@link IRoundedRectangleAdapters} for a list of available Adapters\r\n */\r\nexport class RoundedRectangle extends Sprite {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IRoundedRectangleProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IRoundedRectangleAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IRoundedRectangleEvents;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"RoundedRectangle\";\r\n\r\n\t\tthis.element = this.paper.add(\"path\");\r\n\r\n\t\tthis.cornerRadius(3, 3, 3, 3);\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic draw(): void {\r\n\t\tsuper.draw();\r\n\r\n\t\tlet w: number = this.innerWidth;\r\n\t\tlet h: number = this.innerHeight;\r\n\r\n\t\tif ($type.isNumber(w) && $type.isNumber(h)) {\r\n\r\n\t\t\tlet minSide = $math.min(w, h) / 2;\r\n\r\n\t\t\tlet cornerRadiusTopLeft = $utils.relativeToValue(this.cornerRadiusTopLeft, minSide);\r\n\t\t\tlet cornerRadiusTopRight = $utils.relativeToValue(this.cornerRadiusTopRight, minSide);\r\n\t\t\tlet cornerRadiusBottomRight = $utils.relativeToValue(this.cornerRadiusBottomRight, minSide);\r\n\t\t\tlet cornerRadiusBottomLeft = $utils.relativeToValue(this.cornerRadiusBottomLeft, minSide);\r\n\r\n\t\t\tlet maxcr: number = $math.min(Math.abs(w / 2), Math.abs(h / 2));\r\n\t\t\tlet crtl: number = $math.fitToRange(cornerRadiusTopLeft, 0, maxcr);\r\n\t\t\tlet crtr: number = $math.fitToRange(cornerRadiusTopRight, 0, maxcr);\r\n\t\t\tlet crbr: number = $math.fitToRange(cornerRadiusBottomRight, 0, maxcr);\r\n\t\t\tlet crbl: number = $math.fitToRange(cornerRadiusBottomLeft, 0, maxcr);\r\n\r\n\t\t\tlet lineT: string = \"M\" + crtl + \",0 L\" + (w - crtr) + \",0\";\r\n\t\t\tlet lineB: string = \" L\" + crbl + \",\" + h;\r\n\t\t\tlet lineL: string = \" L0,\" + crtl;\r\n\t\t\tlet lineR: string = \" L\" + w + \",\" + (h - crbr);\r\n\r\n\t\t\tlet arcTR: string = \" a\" + crtr + \",\" + crtr + \" 0 0 1 \" + crtr + \",\" + crtr;\r\n\t\t\tlet arcBR: string = \" a\" + crbr + \",\" + crbr + \" 0 0 1 -\" + crbr + \",\" + crbr;\r\n\t\t\tlet arcBL: string = \" a\" + crbl + \",\" + crbl + \" 0 0 1 -\" + crbl + \",-\" + crbl;\r\n\t\t\tlet arcTL: string = \" a\" + crtl + \",\" + crtl + \" 0 0 1 \" + crtl + \",-\" + crtl;\r\n\r\n\r\n\t\t\tlet path: string = lineT + arcTR + lineR + arcBR + lineB + arcBL + lineL + arcTL + \" Z\";\r\n\r\n\t\t\tthis.path = path;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets radius for all four corners at ones.\r\n\t *\r\n\t * All numbers are in pixels.\r\n\t *\r\n\t * @param tl  Top-left corner\r\n\t * @param tr  Top-right corner\r\n\t * @param bl  Bottom-left corner\r\n\t * @param br  Bottom-right corner\r\n\t */\r\n\tpublic cornerRadius(tl: number | Percent, tr: number | Percent, bl: number | Percent, br: number | Percent) {\r\n\t\tthis.cornerRadiusTopLeft = tl;\r\n\t\tthis.cornerRadiusTopRight = tr;\r\n\t\tthis.cornerRadiusBottomLeft = bl;\r\n\t\tthis.cornerRadiusBottomRight = br;\r\n\t}\r\n\r\n\t/**\r\n\t * Radius of the top-left corner in pixels.\r\n\t *\r\n\t * @default 3\r\n\t * @param value  Radius (px or Percent)\r\n\t */\r\n\tpublic set cornerRadiusTopLeft(value: number | Percent) {\r\n\t\tthis.setPercentProperty(\"cornerRadiusTopLeft\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Radius (px or Percent)\r\n\t */\r\n\tpublic get cornerRadiusTopLeft(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"cornerRadiusTopLeft\");\r\n\t}\r\n\r\n\t/**\r\n\t * Radius of the top-right corner in pixels.\r\n\t *\r\n\t * @default 3\r\n\t * @param value  Radius (px or Percent)\r\n\t */\r\n\tpublic set cornerRadiusTopRight(value: number | Percent) {\r\n\t\tthis.setPercentProperty(\"cornerRadiusTopRight\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Radius (px or Percent)\r\n\t */\r\n\tpublic get cornerRadiusTopRight(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"cornerRadiusTopRight\");\r\n\t}\r\n\r\n\t/**\r\n\t * Radius of the bottom-right corner in pixels.\r\n\t *\r\n\t * @default 3\r\n\t * @param value  Radius (px or Percent)\r\n\t */\r\n\tpublic set cornerRadiusBottomRight(value: number | Percent) {\r\n\t\tthis.setPercentProperty(\"cornerRadiusBottomRight\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Radius (px or Percent)\r\n\t */\r\n\tpublic get cornerRadiusBottomRight(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"cornerRadiusBottomRight\");\r\n\t}\r\n\r\n\t/**\r\n\t * Radius of the bottom-left corner in pixels.\r\n\t *\r\n\t * @default 3\r\n\t * @param value  Radius (px or Percent)\r\n\t */\r\n\tpublic set cornerRadiusBottomLeft(value: number | Percent) {\r\n\t\tthis.setPercentProperty(\"cornerRadiusBottomLeft\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Radius (px or Percent)\r\n\t */\r\n\tpublic get cornerRadiusBottomLeft(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"cornerRadiusBottomLeft\");\r\n\t}\r\n\r\n\t/**\r\n\t * Measures the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic measureElement(): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns bounding box (square) for this element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic get bbox(): IRectangle {\r\n\t\tif (this.definedBBox) {\r\n\t\t\treturn this.definedBBox;\r\n\t\t}\r\n\r\n\t\tif (this.isMeasured) {\r\n\t\t\treturn {\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0,\r\n\t\t\t\twidth: this.innerWidth,\r\n\t\t\t\theight: this.innerHeight\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn { x: 0, y: 0, width: 0, height: 0 };\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"RoundedRectangle\"] = RoundedRectangle;\r\n","/**\r\n * This module contains a base class for an SVG filter.\r\n *\r\n * Filters can be used to decorate, change and transform just about any DOM\r\n * element.\r\n *\r\n * A Filter works by applying one or more effects (primitives) to SVG element.\r\n *\r\n * For more information on how SVG filters work, refer to\r\n * [this MDN tutorial](https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/SVG_Filters_Tutorial).\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObject } from \"../../Base\";\r\nimport { Paper, getGhostPaper } from \"../Paper\";\r\nimport { Group } from \"../Group\";\r\nimport { AMElement } from \"../AMElement\";\r\nimport { Animation, IAnimatable, IAnimationOptions, AnimationDisposer } from \"../../utils/Animation\";\r\nimport { List } from \"../../utils/List\";\r\nimport { Sprite } from \"../../Sprite\";\r\nimport * as $object from \"../../utils/Object\";\r\nimport * as $iter from \"../../utils/Iterator\";\r\nimport * as $type from \"../../utils/Type\";\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for a base filter\r\n */\r\nexport interface FilterProperties {\r\n\r\n\t/**\r\n\t * Width of the filter in percent.\r\n\t *\r\n\t * @default 120\r\n\t */\r\n\twidth: number;\r\n\r\n\t/**\r\n\t * Height of the filter in percent.\r\n\t *\r\n\t * @default 120\r\n\t */\r\n\theight: number;\r\n\r\n  /**\r\n   * https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/filterUnits\r\n   */\r\n\tfilterUnits: \"userSpaceOnUse\" | \"objectBoundingBox\";\r\n\r\n};\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Base filter class.\r\n *\r\n * This class while can be instantiated will not do anything. It is just a base\r\n * functionality for any other \"real\" filters to extend.\r\n *\r\n * Filters can be used to decorate, change and transform just about any DOM\r\n * element.\r\n *\r\n * A Filter works by applying one or more effects (primitives) to SVG element.\r\n *\r\n * For more information on how SVG filters work, refer to\r\n * [this MDN tutorial](https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/SVG_Filters_Tutorial).\r\n *\r\n * @todo Example\r\n */\r\nexport class Filter extends BaseObject implements IAnimatable {\r\n\r\n\t/**\r\n\t * List of animations currently running for the filter.\r\n\t */\r\n\tprotected _animations: $type.Optional<Array<Animation>>;\r\n\r\n\t/**\r\n\t * Contains a list of filter primitives (effects) applied by the filter.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic filterPrimitives: List<AMElement>;\r\n\r\n\t/**\r\n\t * Defines property types.\r\n\t */\r\n\tpublic _properties!: FilterProperties;\r\n\r\n\t/**\r\n\t * A storage for Filter property/value pairs.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @see {@link FilterProperties}\r\n\t */\r\n\tpublic properties: this[\"_properties\"] = <any>{};\r\n\t//public propertyValues = new Dictionary<FilterProperties, any>();\r\n\r\n\t/**\r\n\t * An SVG `<group>` element hold primitive (effect) definitions.\r\n\t */\r\n\tpublic filterElement: $type.Optional<Group>;\r\n\r\n\t/**\r\n\t * Identifies if this object is a \"template\" and should not be treated as\r\n\t * real object that is drawn or actually used in the chart.\r\n\t */\r\n\tpublic isTemplate: boolean = false;\r\n\r\n\t/**\r\n\t * A Paper instance to add element to.\r\n\t */\r\n\tprotected _paper: $type.Optional<Paper>;\r\n\r\n\t/**\r\n\t * [_scale description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _scale: number = 1;\r\n\r\n\t/**\r\n\t * [_nonScaling description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _nonScaling: boolean = true;\r\n\r\n\t/**\r\n\t * A target element this filter is currently attached to.\r\n\t *\r\n\t * We need to keep track of it because one filter can be used for just one\r\n\t * element, so we have to remove it from the old \"parent\" when attaching to\r\n\t * the new one.\r\n\t */\r\n\tprotected _sprite: $type.Optional<Sprite>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"Filter\";\r\n\r\n\t\t// Create a list to hold primitives (effect elements)\r\n\t\tthis.filterPrimitives = new List<any>();\r\n\t\tthis.properties.filterUnits = \"objectBoundingBox\";\r\n\r\n\t\t// Automatically add added primitives to `_disposers` so they are discarded\r\n\t\t// when Filter object is destroyed (disposed)\r\n\t\tthis.filterPrimitives.events.on(\"inserted\", (ev) => {\r\n\t\t\tthis._disposers.push(ev.newValue);\r\n\t\t});\r\n\r\n\t\t// Set default dimensions\r\n\t\tthis.width = 120;\r\n\t\tthis.height = 120;\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Appends actual filter elements to the filter group.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param filterElement An SVG `<group>` element to add filter element to\r\n\t */\r\n\tpublic appendPrimitives(filterElement: Group): void {\r\n\t\t$iter.each(this.filterPrimitives.iterator(), (filterPrimitive) => {\r\n\t\t\tfilterElement.add(filterPrimitive);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Uses Transitions filter's values from current to target. This is used to\r\n\t * smoothly appear filter, rather than it pop into effect.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param animationOptions  Animation options\r\n\t * @param duration          Duration in milliseconds\r\n\t * @param easing            Easing function\r\n\t * @return Animation instance\r\n\t */\r\n\tpublic animate(animationOptions: IAnimationOptions[] | IAnimationOptions, duration: number, easing?: (value: number) => number): Animation {\r\n\t\tlet animation: Animation = new Animation(this, animationOptions, duration, easing).start();\r\n\t\treturn animation;\r\n\t}\r\n\r\n\t/**\r\n\t * Width of the filter element in percent.\r\n\t *\r\n\t * If the filter is designed to \"bleed out\" of the original target element,\r\n\t * like for example a shadow, you need this bigger than 100, or the\r\n\t * non-fitting parts will be clipped.\r\n\t *\r\n\t * @default 120\r\n\t * @param value Width (px)\r\n\t */\r\n\tpublic set width(value: number) {\r\n\t\tthis.properties[\"width\"] = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Width (%)\r\n\t */\r\n\tpublic get width(): number {\r\n\t\treturn this.properties[\"width\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Height of the filter element in percent.\r\n\t *\r\n\t * If the filter is designed to \"bleed out\" of the original target element,\r\n\t * like for example a shadow, you need this bigger than 100, or the\r\n\t * non-fitting parts will be clipped.\r\n\t *\r\n\t * @default 120\r\n\t * @param value Height (%)\r\n\t */\r\n\tpublic set height(value: number) {\r\n\t\tthis.properties[\"height\"] = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Height\r\n\t */\r\n\tpublic get height(): number {\r\n\t\treturn this.properties[\"height\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Copies properties from another [[Filter]] object.\r\n\t *\r\n\t * @param filter Source [[Filter]] object\r\n\t */\r\n\tpublic copyFrom(filter: this): void {\r\n\t\tsuper.copyFrom(filter);\r\n\t\t$object.each(filter.properties, (key, value) => {\r\n\t\t\t(<any>this)[key] = value;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Sets [[Paper]] instance to create filter's elements in.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param paper  Paper\r\n\t */\r\n\tpublic set paper(paper: Paper) {\r\n\t\tif (this._paper != paper) {\r\n\t\t\tthis._paper = paper;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Paper\r\n\t */\r\n\tpublic get paper(): Paper {\r\n\t\tif (this._paper) {\r\n\t\t\treturn this._paper;\r\n\t\t}\r\n\t\treturn getGhostPaper();\r\n\t}\r\n\r\n\t/**\r\n\t * All animations currently in play.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return List of animations\r\n\t */\r\n\tpublic get animations(): Array<Animation> {\r\n\t\tif (!this._animations) {\r\n\t\t\tthis._animations = [];\r\n\t\t\tthis._disposers.push(new AnimationDisposer(this._animations));\r\n\t\t}\r\n\t\treturn this._animations;\r\n\t}\r\n\r\n\t/**\r\n\t * [[Sprite]] uses this method to inform filter about it's scale.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic set scale(value: number) {\r\n\t\tthis._scale = value;\r\n\t\tthis.updateScale();\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic get scale(): number {\r\n\t\treturn this._scale;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates filter properties which depend on scale.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected updateScale() {\r\n\t\t// Dummy method for extending classes to override.\r\n\t}\r\n\r\n\t/**\r\n\t * Which units are used when drawing filter.\r\n\t *\r\n\t * Use `\"userSpaceOnUse\"` when applying filters on a perfectly straight line.\r\n\t *\r\n\t * @since 4.9.17\r\n\t * @default objectBoundingBox\r\n\t * @param value Filter units\r\n\t */\r\n\tpublic set filterUnits(value: \"objectBoundingBox\" | \"userSpaceOnUse\") {\r\n\t\tthis.properties.filterUnits = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Filter units\r\n\t */\r\n\tpublic get filterUnits(): \"objectBoundingBox\" | \"userSpaceOnUse\" {\r\n\t\treturn this.properties.filterUnits;\r\n\t}\r\n\r\n\t/**\r\n\t * If a filter is non scaling, it will look the same even if the sprite is\r\n\t * scaled, otherwise filter will scale together with a [[Sprite]].\r\n\t *\r\n\t * @default false\r\n\t * @param value  Non scaling?\r\n\t */\r\n\tpublic set nonScaling(value: boolean) {\r\n\t\tthis._nonScaling = value;\r\n\t\tif (!value) {\r\n\t\t\tthis._scale = 1;\r\n\t\t}\r\n\t\tthis.updateScale();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Non scaling?\r\n\t */\r\n\tpublic get nonScaling(): boolean {\r\n\t\treturn this._nonScaling;\r\n\t}\r\n\r\n\t/**\r\n\t * A target element this filter is currently attached to.\r\n\t *\r\n\t * We need to keep track of it because one filter can be used for just one\r\n\t * element, so we have to remove it from the old \"parent\" when attaching to\r\n\t * the new one.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value  Target element\r\n\t */\r\n\tpublic set sprite(value: Sprite) {\r\n\t\tthis.setSprite(value);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets filter's target element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value  Element filter is being attached to\r\n\t */\r\n\tprotected setSprite(value: Sprite): void {\r\n\t\tif (this._sprite && this._sprite != value) {\r\n\t\t\tthis._sprite.filters.removeValue(this);\r\n\t\t}\r\n\t\tthis._sprite = value;\r\n\t}\r\n}\r\n","/**\r\n * Contains code and logic for generating radial gradients.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObject } from \"../../Base\";\r\nimport { List } from \"../../utils/List\";\r\nimport { Group } from \"../Group\";\r\nimport { AMElement } from \"../AMElement\";\r\nimport { Paper, getGhostPaper } from \"../Paper\";\r\nimport { registry } from \"../../Registry\";\r\nimport { IGradientStop } from \"./LinearGradient\";\r\nimport { Color } from \"../../utils/Color\";\r\nimport * as $iter from \"../../utils/Iterator\";\r\nimport * as $type from \"../../utils/Type\";\r\nimport { Percent } from \"../../utils/Percent\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Radial gradient class.\r\n */\r\nexport class RadialGradient extends BaseObject {\r\n\r\n\t/**\r\n\t * List of colors switch definitions in a gradient.\r\n\t */\r\n\tprotected _stops: List<IGradientStop> = new List<IGradientStop>();\r\n\r\n\t/**\r\n\t * An SVG `<group>` element used to draw gradient.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic element: Group;\r\n\r\n\t/**\r\n\t * Reference to Paper to add element to.\r\n\t */\r\n\tprotected _paper: $type.Optional<Paper>;\r\n\r\n\t/**\r\n\t * A center x coordinate for the radial gradient, can be set in pixels or as Percent\r\n\t */\r\n\tprotected _cx: $type.Optional<number | Percent>;\r\n\r\n\t/**\r\n\t * A center y coordinate for the radial gradient, can be set in pixels or as Percent\r\n\t */\r\n\tprotected _cy: $type.Optional<number | Percent>;\r\n\r\n\t/**\r\n\t * A y coordinate of the focal point of a gradient, can be set in pixels or as Percent\r\n\t */\r\n\tprotected _fx: $type.Optional<number | Percent>;\r\n\r\n\t/**\r\n\t * A y coordinate of the focal point of a gradient, can be set in pixels or as Percent\r\n\t */\r\n\tprotected _fy: $type.Optional<number | Percent>;\r\n\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.element = this.paper.addGroup(\"radialGradient\");\r\n\t\tthis.id = \"gradient-\" + registry.getUniqueId();\r\n\t\tthis.element.attr({ \"id\": this.id });\r\n\t\tthis._disposers.push(this.element);\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Draws gradient.\r\n\t */\r\n\tprotected draw(): void {\r\n\r\n\t\tlet gradientElement = this.element;\r\n\r\n\t\tif ($type.isNumber(this.cx)) {\r\n\t\t\tlet value:any = this.cx;\r\n\t\t\tif(value instanceof Percent){\r\n\t\t\t\tvalue = value.percent + \"%\";\r\n\t\t\t}\r\n\t\t\tgradientElement.attr({ \"cx\": value });\r\n\t\t}\r\n\r\n\t\tif ($type.isNumber(this.cy)) {\r\n\t\t\tlet value:any = this.cy;\r\n\t\t\tif(value instanceof Percent){\r\n\t\t\t\tvalue = value.percent + \"%\";\r\n\t\t\t}\r\n\t\t\tgradientElement.attr({ \"cy\": value });\r\n\t\t}\r\n\r\n\t\tif (this.fx) {\r\n\t\t\tlet value:any = this.fx;\r\n\t\t\tif(value instanceof Percent){\r\n\t\t\t\tvalue = value.percent + \"%\";\r\n\t\t\t}\r\n\t\t\tgradientElement.attr({ \"fx\": value});\r\n\t\t}\r\n\r\n\t\tif (this.fy) {\r\n\t\t\tlet value:any = this.fy;\r\n\t\t\tif(value instanceof Percent){\r\n\t\t\t\tvalue = value.percent + \"%\";\r\n\t\t\t}\r\n\t\t\tgradientElement.attr({ \"fy\": value});\r\n\t\t}\r\n\r\n\t\tgradientElement.removeChildNodes();\r\n\r\n\t\t$iter.each($iter.indexed(this._stops.iterator()), (a) => {\r\n\t\t\tlet i = a[0];\r\n\t\t\tlet stop = a[1];\r\n\t\t\tlet offset: $type.Optional<number> = stop.offset;\r\n\r\n\t\t\tif (!$type.isNumber(offset)) {\r\n\t\t\t\toffset = i / (this._stops.length - 1)\r\n\t\t\t}\r\n\r\n\t\t\tlet gradientStop: AMElement = this.paper.add(\"stop\");\r\n\t\t\tif ($type.hasValue(stop.color)) {\r\n\t\t\t\tgradientStop.attr({ \"stop-color\": stop.color.toString() });\r\n\t\t\t}\r\n\t\t\tif ($type.isNumber(stop.opacity)) {\r\n\t\t\t\tgradientStop.attr({ \"stop-opacity\": stop.opacity });\r\n\t\t\t}\r\n\r\n\t\t\tif ($type.isNumber(offset)) {\r\n\t\t\t\tgradientStop.attr({ \"offset\": offset });\r\n\t\t\t}\r\n\r\n\t\t\tgradientElement.add(gradientStop);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a color step to the gradient.\r\n\t *\r\n\t * @param color    Color (hex code or named color)\r\n\t * @param opacity  Opacity (value from 0 to 1; 0 completely transaprent, 1 fully opaque)\r\n\t * @param offset   Position of color in the gradient (value 0 to 1; 0 meaning start of the gradient and 1 end)\r\n\t */\r\n\tpublic addColor(color: Color, opacity?: number, offset?: number): void {\r\n\t\tthis._stops.push({ color: color, opacity: opacity, offset: offset });\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Paper]] instace to use for the gradient.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param paper  Paper\r\n\t */\r\n\tpublic set paper(paper: Paper) {\r\n\t\tif (this._paper != paper) {\r\n\t\t\tthis._paper = paper;\r\n\t\t\tthis.draw();\r\n\t\t\tpaper.appendDef(this.element);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Paper\r\n\t */\r\n\tpublic get paper(): Paper {\r\n\t\tif (this._paper) {\r\n\t\t\treturn this._paper;\r\n\t\t}\r\n\t\treturn getGhostPaper();\r\n\t}\r\n\r\n\t/**\r\n\t * Center x coordinate of the gradient, can be set as number or Percent\r\n\t *\r\n\t * @param point  Center point\r\n\t */\r\n\tpublic set cx(value: $type.Optional<number | Percent>) {\r\n\t\tthis._cx = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\tpublic get cx(): $type.Optional<number | Percent> {\r\n\t\treturn this._cx;\r\n\t}\r\n\r\n\t/**\r\n\t * Center y coordinate of the gradient, can be set as number or Percent\r\n\t *\r\n\t * @param point  Center point\r\n\t */\r\n\tpublic set cy(value: $type.Optional<number | Percent>) {\r\n\t\tthis._cy = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\tpublic get cy(): $type.Optional<number | Percent> {\r\n\t\treturn this._cy;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * y coordinate of the focal point of a gradient, can be set in pixels or as Percent\r\n\t *\r\n\t * @param point  Center point\r\n\t */\r\n\tpublic set fx(value: $type.Optional<number | Percent>) {\r\n\t\tthis._fx = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\tpublic get fx(): $type.Optional<number | Percent> {\r\n\t\treturn this._fx;\r\n\t}\r\n\r\n\t/**\r\n\t * y coordinate of the focal point of a gradient, can be set in pixels or as Percent\r\n\t *\r\n\t * @param point  Center point\r\n\t */\r\n\tpublic set fy(value: $type.Optional<number | Percent>) {\r\n\t\tthis._fy = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\tpublic get fy(): $type.Optional<number | Percent> {\r\n\t\treturn this._fy;\r\n\t}\r\n\r\n\r\n\r\n\tpublic copyFrom(source:this){\r\n\t\tsuper.copyFrom(source);\r\n\r\n\t\tthis.stops.copyFrom(source.stops);\r\n\r\n\t\tthis.cx = source.cx;\r\n\t\tthis.cy = source.cy;\r\n\r\n\t\tthis.fx = source.fx;\r\n\t\tthis.fy = source.fy;\r\n\t}\r\n\r\n\t/**\r\n\t * A list of color stops in the gradient.\r\n\t *\r\n\t * @return Stops\r\n\t */\r\n\tpublic get stops(): List<IGradientStop> {\r\n\t\treturn this._stops;\r\n\t}\r\n\r\n\t/**\r\n\t * Clears the gradient.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic clear(): void {\r\n\t\tthis._stops.clear();\r\n\t}\r\n\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"RadialGradient\"] = RadialGradient;\r\n","/**\r\n * Mouse-related functionality\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { IStyleProperty } from \"../defs/IStyleProperty\";\r\n\r\n/**\r\n * Defines static methods that hold style list for various mouse cursor styles,\r\n * maintaining browser compatibility.\r\n */\r\nexport class MouseCursorStyle {\r\n\r\n\t/**\r\n\t * Styles for \"grab\" mouse cursor.\r\n\t */\r\n\tstatic grab: Array<IStyleProperty> = [{\r\n\t\t\"property\": \"cursor\",\r\n\t\t\"value\": \"move\"\r\n\t}, {\r\n\t\t\"property\": \"cursor\",\r\n\t\t\"value\": \"grab\"\r\n\t}, {\r\n\t\t\"property\": \"cursor\",\r\n\t\t\"value\": \"-webkit-grab\"\r\n\t}];\r\n\r\n\t/**\r\n\t * Styles for \"grabbing\" mouse cursor.\r\n\t */\r\n\tstatic grabbing: Array<IStyleProperty> = [{\r\n\t\t\"property\": \"cursor\",\r\n\t\t\"value\": \"move\"\r\n\t}, {\r\n\t\t\"property\": \"cursor\",\r\n\t\t\"value\": \"grabbing\"\r\n\t}, {\r\n\t\t\"property\": \"cursor\",\r\n\t\t\"value\": \"-webkit-grabbing\"\r\n\t}];\r\n\r\n\t/**\r\n\t * Styles for \"pointer\" mouse cursor. (usually used for links)\r\n\t */\r\n\tstatic pointer: Array<IStyleProperty> = [{\r\n\t\t\"property\": \"cursor\",\r\n\t\t\"value\": \"pointer\"\r\n\t}];\r\n\r\n\t/**\r\n\t * Styles for default mouse cursor. (browser determines style)\r\n\t */\r\n\tstatic default: Array<IStyleProperty> = [{\r\n\t\t\"property\": \"cursor\",\r\n\t\t\"value\": \"default\"\r\n\t}];\r\n\r\n\t/**\r\n\t * Styles for horizontal bi-directional resize mouse cursor.\r\n\t */\r\n\tstatic horizontalResize: Array<IStyleProperty> = [{\r\n\t\t\"property\": \"cursor\",\r\n\t\t\"value\": \"ew-resize\"\r\n\t}];\r\n\r\n\t/**\r\n\t * Styles for vertical bi-directional mouse cursor.\r\n\t */\r\n\tstatic verticalResize: Array<IStyleProperty> = [{\r\n\t\t\"property\": \"cursor\",\r\n\t\t\"value\": \"ns-resize\"\r\n\t}];\r\n\r\n\t/**\r\n\t * Styles for \"no-allowed\" cursor.\r\n\t * @since 4.7.15\r\n\t */\r\n\tstatic notAllowed: Array<IStyleProperty> = [{\r\n\t\t\"property\": \"cursor\",\r\n\t\t\"value\": \"not-allowed\"\r\n\t}];\r\n\r\n\t/**\r\n\t * Styles for \"text\" cursor.\r\n\t * @since 4.9.12\r\n\t */\r\n\tstatic text: Array<IStyleProperty> = [{\r\n\t\t\"property\": \"cursor\",\r\n\t\t\"value\": \"text\"\r\n\t}];\r\n\r\n}\r\n","/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Container, IContainerProperties, IContainerAdapters, IContainerEvents } from \"./Container\";\r\nimport { List, IListEvents, ListDisposer } from \"./utils/List\";\r\nimport { OrderedListTemplate, ISortedListEvents } from \"./utils/SortedList\";\r\nimport { Animation } from \"./utils/Animation\";\r\nimport { Dictionary } from \"./utils/Dictionary\";\r\nimport { IDisposer, Disposer, MultiDisposer } from \"./utils/Disposer\";\r\nimport { Export, IExportAdapters } from \"./export/Export\";\r\nimport { DataSource } from \"./data/DataSource\";\r\nimport { Responsive } from \"./utils/Responsive\";\r\nimport { system } from \"./System\";\r\n\r\nimport { DataItem } from \"./DataItem\";\r\nimport { registry } from \"./Registry\";\r\nimport { Preloader } from \"./elements/Preloader\";\r\nimport { IRange } from \"./defs/IRange\";\r\n\r\nimport * as $math from \"./utils/Math\";\r\nimport * as $array from \"./utils/Array\";\r\nimport * as $ease from \"./utils/Ease\";\r\nimport * as $utils from \"./utils/Utils\";\r\nimport * as $iter from \"./utils/Iterator\";\r\nimport * as $object from \"./utils/Object\";\r\nimport * as $type from \"./utils/Type\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * A list of available types for calculated values.\r\n */\r\nexport type CalculatedValue =\r\n\t\"value\" |\r\n\t\"percent\" |\r\n\t\"change\" |\r\n\t\"changePercent\" |\r\n\t\"startChangePercent\" |\r\n\t\"startChange\" |\r\n\t\"previousChangePercent\" |\r\n\t\"previousChange\" |\r\n\t\"sum\" |\r\n\t\"absoluteSum\" |\r\n\t\"average\" |\r\n\t\"open\" |\r\n\t\"close\" |\r\n\t\"low\" |\r\n\t\"high\" |\r\n\t\"count\" |\r\n\t\"total\" |\r\n\t\"totalPercent\" |\r\n\t\"stack\";\r\n\r\n/**\r\n * Defines properties for [[Component]].\r\n */\r\nexport interface IComponentProperties extends IContainerProperties {\r\n\r\n\t/**\r\n\t * Maximum zoom factor of a component.\r\n\t */\r\n\tmaxZoomFactor?: number;\r\n\r\n\t/**\r\n\t * Maximum zoom declination (how much out of 0-1 range it will allow to step out)\r\n\t *\r\n\t * @ignore\r\n\t * @default 0.5\r\n\t */\r\n\tmaxZoomDeclination?: number;\r\n\r\n\t/**\r\n\t * Use this for [[CategoryAxis]] or [[DateAxis]].\r\n\t *\r\n\t * Allows restricting zoom in beyond certain number of categories or base\r\n\t * intervals.\r\n\t *\r\n\t * The chart will not zoom in beyond this number of items.\r\n\t *\r\n\t * @default 1\r\n\t */\r\n\tminZoomCount?: number;\r\n\r\n\t/**\r\n\t * Use this for [[CategoryAxis]] or [[DateAxis]].\r\n\t *\r\n\t * Limits how many categories or base intervals can be shown at the same\r\n\t * time.\r\n\t *\r\n\t * If there are more items in the chart, the chart will auto-zoom.\r\n\t *\r\n\t * @default 0 (no limit)\r\n\t */\r\n\tmaxZoomCount?: number;\r\n\r\n}\r\n\r\n/**\r\n * Defines data fields for [[Component]].\r\n */\r\nexport interface IComponentDataFields {\r\n\r\n\t/**\r\n\t * Data.\r\n\t */\r\n\tdata?: string;\r\n\r\n\t/**\r\n\t * ID.\r\n\t */\r\n\tid?: string;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[Component]].\r\n */\r\nexport interface IComponentEvents extends IContainerEvents {\r\n\r\n\t/**\r\n\t * Invoked when range of the currently selected data is validated.\r\n\t *\r\n\t * @todo: change to datarangevalidated?\r\n\t */\r\n\tdatarangechanged: {};\r\n\r\n\t/**\r\n\t * Invoked when the raw data for the component changes.\r\n\t */\r\n\tdatavalidated: {};\r\n\r\n\t/**\r\n\t * Invoked when value(s) of the element's data items are validated.\r\n\t */\r\n\tdataitemsvalidated: {};\r\n\r\n\t/**\r\n\t * Invoked just before element is validated (after changes).\r\n\t */\r\n\tbeforedatavalidated: {};\r\n\r\n\t/**\r\n\t * Invoked when range change animation starts\r\n\t */\r\n\trangechangestarted: {};\r\n\r\n\t/**\r\n\t * Invoked when range change animation ends\r\n\t */\r\n\trangechangeended: {};\r\n\r\n\t/**\r\n\t * Invoked when start position changes.\r\n\t *\r\n\t * Please note that `startchanged` event is dispatched immediately after\r\n\t * zoom occurs, so some related properties (e.g. `minZoomed` on [[ValueAxis]])\r\n\t * might not be yet updated.\r\n\t *\r\n\t * Use `startendchanged` event instead if you need to rely on updated\r\n\t * zoom-related values.\r\n\t */\r\n\tstartchanged: {};\r\n\r\n\t/**\r\n\t * Invoked when end position changes\r\n\t *\r\n\t * Please note that `endhanged` event is dispatched immediately after\r\n\t * zoom occurs, so some related properties (e.g. `maxZoomed` on [[ValueAxis]])\r\n\t * might not be yet updated.\r\n\t *\r\n\t * Use `startendchanged` event instead if you need to rely on updated\r\n\t * zoom-related values.\r\n\t */\r\n\tendchanged: {};\r\n\r\n\t/**\r\n\t * Invoked when start or end position changes, unlike startchanged/endchanged\r\n\t * this event is fired not immediately but at the end of a cycle.\r\n\t */\r\n\tstartendchanged: {};\r\n}\r\n\r\n/**\r\n * Defines adapters\r\n * Includes both the [[Adapter]] definitions and properties\r\n * @see {@link Adapter}\r\n */\r\nexport interface IComponentAdapters extends IContainerAdapters, IComponentProperties {\r\n\r\n\t/**\r\n\t * Applied after [[Component]] retrieves data value from data context\r\n\t * (raw data), but before it is provided to [[DataItem]].\r\n\t */\r\n\tdataContextValue: {\r\n\t\tvalue: any,\r\n\t\tfield: string,\r\n\t\tdataItem: DataItem\r\n\t};\r\n\r\n\t/**\r\n\t * Applied to chart's data before it is retrieved for use.\r\n\t */\r\n\tdata: any[];\r\n\r\n\tstart: number;\r\n\r\n\tend: number;\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * A Component represents an independent functional element or control, that\r\n * can have it's own behavior, children, data, etc.\r\n *\r\n * A few examples of a Component: [[Legend]], [[Series]], [[Scrollbar]].\r\n *\r\n * @see {@link IComponentEvents} for a list of available events\r\n * @see {@link IComponentAdapters} for a list of available Adapters\r\n * @important\r\n */\r\nexport class Component extends Container {\r\n\r\n\t/**\r\n\t * Defines available data fields.\r\n\t */\r\n\tpublic _dataFields!: IComponentDataFields;\r\n\r\n\t/**\r\n\t * Holds data field names.\r\n\t *\r\n\t * Data fields define connection beween [[DataItem]] and actual properties\r\n\t * in raw data.\r\n\t */\r\n\tpublic dataFields: this[\"_dataFields\"] = {};\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IComponentProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IComponentAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IComponentEvents;\r\n\r\n\t/**\r\n\t * Holds the data for the component.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _data: $type.Optional<any[]>;\r\n\r\n\t/**\r\n\t * A [[Component]] which provides data to this component (like Chart provides\r\n\t * data for Series).\r\n\t */\r\n\tpublic dataProvider: $type.Optional<Component>;\r\n\r\n\t/**\r\n\t * A list of [[DataSource]] definitions of external data source.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _dataSources: { [index: string]: DataSource } = {};\r\n\r\n\t/**\r\n\t * An instance of [[Responsive]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _responsive: $type.Optional<Responsive>;\r\n\r\n\t/**\r\n\t * This is used when only new data is invalidated (if added using `addData`\r\n\t * method).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _parseDataFrom: number = 0;\r\n\r\n\t/**\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tprotected _dataUsers: $type.Optional<List<Component>>;\r\n\r\n\t/**\r\n\t * Holds the disposers for the dataItems and dataUsers\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _dataDisposers: Array<IDisposer> = [];\r\n\r\n\r\n\t/**\r\n\t * Identifies the type of the [[DataItem]] used in this element.\r\n\t */\r\n\tpublic _dataItem!: DataItem;\r\n\r\n\t/**\r\n\t * List of element's source data items.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _dataItems: $type.Optional<OrderedListTemplate<this[\"_dataItem\"]>>;\r\n\r\n\t/**\r\n\t * Holds aggregated data items.\r\n\t *\r\n\t * @ignore\r\n\t */\r\n\tpublic _dataSets: Dictionary<string, OrderedListTemplate<this[\"_dataItem\"]>>;\r\n\r\n\t/**\r\n\t * Currently selected \"data set\".\r\n\t *\r\n\t * If it's set to `\"\"`, main data set (unaggregated data) is used.\r\n\t */\r\n\tprotected _currentDataSetId: string = \"\";\r\n\r\n\t/**\r\n\t * [_startIndex description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _startIndex: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * [_endIndex description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _endIndex: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * [_start description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _start: number = 0;\r\n\r\n\t/**\r\n\t * [_end description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _end: number = 1;\r\n\r\n\t/**\r\n\t * [_finalStart description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _finalStart: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * [_finalEnd description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _finalEnd: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * If set to `true`, changing data range in element will not trigger\r\n\t * `daterangechanged` event.\r\n\t */\r\n\tpublic skipRangeEvent: boolean = false;\r\n\r\n\t/**\r\n\t * Whenever selected scope changes (chart is zoomed or panned), for example\r\n\t * by interaction from a Scrollbar, or API, a chart needs to reposition\r\n\t * its contents.\r\n\t *\r\n\t * `rangeChangeDuration` influences how this is performed.\r\n\t *\r\n\t * If set to zero (0), the change will happen instantenously.\r\n\t *\r\n\t * If set to non-zero value, the chart will gradually animate into new\r\n\t * position for the set amount of milliseconds.\r\n\t *\r\n\t * @default 0\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/animations/} for more info about animations\r\n\t */\r\n\tpublic rangeChangeDuration: number = 0;\r\n\r\n\t/**\r\n\t * An easing function to use for range change animation.\r\n\t *\r\n\t * @see {@link Ease}\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/animations/} for more info about animations\r\n\t */\r\n\tpublic rangeChangeEasing: (value: number) => number = $ease.cubicOut;\r\n\r\n\t/**\r\n\t * A reference to a currently playing range change [[Animation]] object.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic rangeChangeAnimation: $type.Optional<Animation>;\r\n\r\n\t/**\r\n\t * A duration (ms) of each data parsing step. A Component parses its data in\r\n\t * chunks in order to avoid completely freezing the machine when large data\r\n\t * sets are used. This setting will control how many milliseconds should pass\r\n\t * when parsing data until parser stops for a brief moment to let other\r\n\t * processes catch up.\r\n\t */\r\n\tpublic parsingStepDuration: number = 50;\r\n\r\n\t/**\r\n\t * [dataInvalid description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tpublic dataInvalid: boolean = false;\r\n\r\n\r\n\t/**\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic rawDataInvalid: boolean = false;\r\n\r\n\t/**\r\n\t * [dataRangeInvalid description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tpublic dataRangeInvalid: boolean = false;\r\n\r\n\t/**\r\n\t * [dataItemsInvalid description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tpublic dataItemsInvalid: boolean = false;\r\n\r\n\t/**\r\n\t * If set to a non-zero number the element will \"animate\" data values of its\r\n\t * children.\r\n\t *\r\n\t * This will happen on first load and whenever data values change.\r\n\t *\r\n\t * Enabling interpolation will mean that elements will transit smoothly into\r\n\t * new values rather than updating instantly.\r\n\t *\r\n\t * @default 0\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/animations/} for more info about animations\r\n\t */\r\n\tpublic interpolationDuration: number = 0;\r\n\r\n\t/**\r\n\t * An easing function to use for interpolating values when transiting from\r\n\t * one source value to another.\r\n\t *\r\n\t * @default cubicOut\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/animations/} for more info about animations\r\n\t * @see {@link Ease}\r\n\t */\r\n\tpublic interpolationEasing: (value: number) => number = $ease.cubicOut;\r\n\r\n\t/**\r\n\t * Indicates whether transition between data item's values should start and\r\n\t * play out all at once, or with a small delay (as defined by\r\n\t * `sequencedInterpolationDelay`) for each subsequent data item.\r\n\t *\r\n\t * @default true\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/animations/} for more info about animations\r\n\t */\r\n\tpublic sequencedInterpolation: boolean = true;\r\n\r\n\t/**\r\n\t * A delay (ms) to wait between animating each subsequent data item's\r\n\t * interpolation animation.\r\n\t *\r\n\t * Relative only if `sequencedInterpolation = true`.\r\n\t *\r\n\t * @default 0\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/animations/} for more info about animations\r\n\t */\r\n\tpublic sequencedInterpolationDelay: number = 0;\r\n\r\n\t/**\r\n\t * A progress (0-1) for the data validation process.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic dataValidationProgress: number = 0;\r\n\r\n\t/**\r\n\t * [_prevStartIndex description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tprotected _prevStartIndex: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * [_prevEndIndex description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tprotected _prevEndIndex: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * Sometimes we need to process more dataItems then actually is\r\n\t * selected (for example, not to cut lines at the end/beginning).\r\n\t * However when calculating averages, min, max, etc we need not to include\r\n\t * them. So we store `workingStartIndex` and `workingEndIndex` to know which\r\n\t * dataItems should be included and which should not.\r\n\t */\r\n\r\n\t/**\r\n\t * [_workingStartIndex description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tprotected _workingStartIndex: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * [_workingEndIndex description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tprotected _workingEndIndex: $type.Optional<number>;\r\n\r\n\tprotected _addAllDataItems: boolean = true;\r\n\r\n\tprotected _showOnInitDisposer2: IDisposer;\r\n\r\n\tprotected _usesData: boolean = true;\r\n\r\n\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"Component\";\r\n\r\n\t\tthis.minZoomCount = 1;\r\n\t\tthis.maxZoomCount = 0;\r\n\r\n\t\tthis._dataItems = new OrderedListTemplate<DataItem>(this.createDataItem());\r\n\t\tthis._dataItems.events.on(\"inserted\", this.handleDataItemAdded, this, false);\r\n\t\tthis._dataItems.events.on(\"removed\", this.handleDataItemRemoved, this, false);\r\n\t\tthis._disposers.push(new ListDisposer(this._dataItems));\r\n\t\tthis._disposers.push(this._dataItems.template);\r\n\r\n\t\tthis.invalidateData();\r\n\r\n\t\t// TODO what about remove ?\r\n\t\tthis.dataUsers.events.on(\"inserted\", this.handleDataUserAdded, this, false);\r\n\r\n\t\t// Set up disposers\r\n\t\tthis._disposers.push(new MultiDisposer(this._dataDisposers));\r\n\r\n\t\tthis._start = 0;\r\n\t\tthis._end = 1;\r\n\r\n\t\tthis.maxZoomDeclination = 1;\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new/empty DataItem of the type appropriate for this object.\r\n\t *\r\n\t * @see {@link DataItem}\r\n\t * @return Data Item\r\n\t */\r\n\tprotected createDataItem(): this[\"_dataItem\"] {\r\n\t\treturn new DataItem();\r\n\t}\r\n\r\n\t/**\r\n\t * [handleDataUserAdded description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t * @param event Event object\r\n\t */\r\n\tprotected handleDataUserAdded(event: IListEvents<Component>[\"inserted\"]) {\r\n\t\tlet dataUser = event.newValue;\r\n\t\tdataUser.dataProvider = this;\r\n\t}\r\n\r\n\t/**\r\n\t * [handleDataItemValueChange description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tpublic handleDataItemValueChange(dataItem?: this[\"_dataItem\"], name?: string): void {\r\n\t\tif (!this.dataItemsInvalid) {\r\n\t\t\tthis.invalidateDataItems();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [handleDataItemWorkingValueChange description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic handleDataItemWorkingValueChange(dataItem?: this[\"_dataItem\"], name?: string): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * [handleDataItemWorkingLocationChange description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic handleDataItemWorkingLocationChange(dataItem?: this[\"_dataItem\"], name?: string): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * [handleDataItemCalculatedValueChange description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic handleDataItemCalculatedValueChange(dataItem?: this[\"_dataItem\"], name?: string) {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * [handleDataItemPropertyChange description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic handleDataItemPropertyChange(dataItem?: this[\"_dataItem\"], name?: string): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Populates a [[DataItem]] width data from data source.\r\n\t *\r\n\t * Loops through all the fields and if such a field is found in raw data\r\n\t * object, a corresponding value on passed in `dataItem` is set.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param item\r\n\t */\r\n\tprotected processDataItem(dataItem: this[\"_dataItem\"], dataContext?: Object): void {\r\n\t\tif (dataItem) {\r\n\t\t\tif (!dataContext) {\r\n\t\t\t\tdataContext = {};\r\n\t\t\t}\r\n\r\n\t\t\t// store reference to original data item\r\n\t\t\tdataItem.dataContext = dataContext;\r\n\r\n\t\t\tlet hasSomeValues = false;\r\n\r\n\t\t\t$object.each(this.dataFields, (key, fieldValue) => {\r\n\t\t\t\tconst fieldName: string = <string>key;\r\n\r\n\t\t\t\tlet value: any = (<any>dataContext)[fieldValue];\r\n\t\t\t\t// Apply adapters to a retrieved value\r\n\t\t\t\tif (this._adapterO) {\r\n\t\t\t\t\tif (this._adapterO.isEnabled(\"dataContextValue\")) {\r\n\t\t\t\t\t\tvalue = this._adapterO.apply(\"dataContextValue\", {\r\n\t\t\t\t\t\t\tfield: fieldName,\r\n\t\t\t\t\t\t\tvalue: value,\r\n\t\t\t\t\t\t\tdataItem: dataItem\r\n\t\t\t\t\t\t}).value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($type.hasValue(value)) {\r\n\t\t\t\t\thasSomeValues = true;\r\n\r\n\t\t\t\t\tif (dataItem.hasChildren[fieldName]) {\r\n\t\t\t\t\t\tlet template = this.createDataItem();\r\n\t\t\t\t\t\ttemplate.copyFrom(this.mainDataSet.template);\r\n\t\t\t\t\t\tlet children = new OrderedListTemplate<DataItem>(template);\r\n\t\t\t\t\t\tchildren.events.on(\"inserted\", this.handleDataItemAdded, this, false);\r\n\t\t\t\t\t\tchildren.events.on(\"removed\", this.handleDataItemRemoved, this, false);\r\n\t\t\t\t\t\tthis._dataDisposers.push(new ListDisposer(children));\r\n\t\t\t\t\t\tlet count = value.length;\r\n\t\t\t\t\t\tfor (let i = 0; i < count; i++) {\r\n\t\t\t\t\t\t\tlet rawDataItem = value[i];\r\n\t\t\t\t\t\t\tlet childDataItem: this[\"_dataItem\"] = children.create();\r\n\t\t\t\t\t\t\tchildDataItem.parent = dataItem;\r\n\t\t\t\t\t\t\tthis.processDataItem(childDataItem, rawDataItem);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet anyDataItem = <any>dataItem;\r\n\t\t\t\t\t\tanyDataItem[fieldName] = <any>children;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// data is converted to numbers/dates in each dataItem\r\n\t\t\t\t\t\t(<any>dataItem)[fieldName] = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$object.each(this.propertyFields, (key, fieldValue) => {\r\n\t\t\t\tconst f: string = <string>key;\r\n\t\t\t\tlet value: any = (<any>dataContext)[fieldValue];\r\n\r\n\t\t\t\tif ($type.hasValue(value)) {\r\n\t\t\t\t\thasSomeValues = true;\r\n\t\t\t\t\tdataItem.setProperty(f, value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// @todo we might need some flag which would tell whether we should create empty data items or not.\r\n\t\t\tif (!this._addAllDataItems && !hasSomeValues) {\r\n\t\t\t\tthis.mainDataSet.remove(dataItem);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * When validating raw data, instead of processing data item, we update it\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param item\r\n\t */\r\n\tprotected updateDataItem(dataItem: this[\"_dataItem\"]): void {\r\n\t\tif (dataItem) {\r\n\r\n\t\t\tlet dataContext = dataItem.dataContext;\r\n\r\n\t\t\t$object.each(this.dataFields, (key, fieldValue) => {\r\n\t\t\t\tconst fieldName: string = <string>key;\r\n\r\n\t\t\t\tlet value: any = (<any>dataContext)[fieldValue];\r\n\t\t\t\t// Apply adapters to a retrieved value\r\n\t\t\t\tif (this._adapterO) {\r\n\t\t\t\t\tvalue = this._adapterO.apply(\"dataContextValue\", {\r\n\t\t\t\t\t\tfield: fieldName,\r\n\t\t\t\t\t\tvalue: value,\r\n\t\t\t\t\t\tdataItem: dataItem\r\n\t\t\t\t\t}).value;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($type.hasValue(value)) {\r\n\t\t\t\t\tif (dataItem.hasChildren[fieldName]) {\r\n\t\t\t\t\t\tlet anyDataItem = <any>dataItem;\r\n\t\t\t\t\t\tlet children = <OrderedListTemplate<this[\"_dataItem\"]>><any>(anyDataItem[fieldName]);\r\n\t\t\t\t\t\tchildren.each((child) => {\r\n\t\t\t\t\t\t\tthis.updateDataItem(child);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// data is converted to numbers/dates in each dataItem\t\t\t\t\t\r\n\t\t\t\t\t\t(<any>dataItem)[fieldName] = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$object.each(this.propertyFields, (key, fieldValue) => {\r\n\t\t\t\tconst f: string = <string>key;\r\n\t\t\t\tlet value: any = (<any>dataContext)[fieldValue];\r\n\t\t\t\tif ($type.hasValue(value)) {\r\n\t\t\t\t\tdataItem.setProperty(f, value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * [validateDataElements description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tprotected validateDataElements() {\r\n\t\tlet count = this.endIndex;\r\n\r\n\t\tfor (let i = this.startIndex; i < count; i++) {\r\n\t\t\tconst dataItem = this.dataItems.getIndex(i);\r\n\r\n\t\t\t// TODO is this correct\r\n\t\t\tif (dataItem) {\r\n\t\t\t\tthis.validateDataElement(dataItem);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Validates this element and its related elements.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate(): void {\r\n\t\tthis.validateDataElements();\r\n\t\tsuper.validate();\r\n\t}\r\n\r\n\t/**\r\n\t * [validateDataElement description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param dataItem [description]\r\n\t */\r\n\tpublic validateDataElement(dataItem: this[\"_dataItem\"]): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Adds one or several (array) of data items to the existing data.\r\n\t *\r\n\t * @param rawDataItem One or many raw data item objects\r\n\t */\r\n\tpublic addData(rawDataItem: Object | Object[], removeCount?: number, skipRaw?: boolean): void {\r\n\r\n\t\t// need to check if data is invalid, as addData might be called multiple times\r\n\t\tif (!this.dataInvalid && this.inited) {\r\n\t\t\tthis._parseDataFrom = this.data.length; // save length of parsed data\r\n\t\t}\r\n\r\n\t\tif (!skipRaw) {\r\n\t\t\tif (rawDataItem instanceof Array) {\r\n\t\t\t\t// can't use concat because new array is returned\r\n\t\t\t\t$array.each(rawDataItem, (dataItem) => {\r\n\t\t\t\t\tthis.data.push(dataItem);\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.data.push(rawDataItem); // add to raw data array\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.inited) {\r\n\t\t\tthis.removeData(removeCount, skipRaw);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif ($type.isNumber(removeCount)) {\r\n\t\t\t\twhile (removeCount > 0) {\r\n\t\t\t\t\tthis.data.shift();\r\n\t\t\t\t\tremoveCount--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.invalidateData();\r\n\t}\r\n\r\n\t/**\r\n\t * Removes elements from the beginning of data\r\n\t *\r\n\t * @param count number of elements to remove\r\n\t */\r\n\tpublic removeData(count: $type.Optional<number>, skipRaw?: boolean) {\r\n\t\tif ($type.isNumber(count) && count > 0) {\r\n\t\t\twhile (count > 0) {\r\n\t\t\t\tlet dataItem = this.mainDataSet.getIndex(0);\r\n\t\t\t\tif (dataItem) {\r\n\t\t\t\t\tthis.mainDataSet.remove(dataItem);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.dataUsers.each((dataUser) => {\r\n\t\t\t\t\tif (!dataUser.data || dataUser.data.length == 0) {\r\n\t\t\t\t\t\tlet dataItem = dataUser.mainDataSet.getIndex(0);\r\n\t\t\t\t\t\tif (dataItem) {\r\n\t\t\t\t\t\t\tdataUser.mainDataSet.remove(dataItem);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (!skipRaw) {\r\n\t\t\t\t\tthis.data.shift();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._parseDataFrom > 0) {\r\n\t\t\t\t\tthis._parseDataFrom--;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcount--;\r\n\t\t\t}\r\n\t\t\t// changed from invalidateData since 4.7.19 to solve #51551\r\n\t\t\tthis.invalidateDataItems();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Triggers a data (re)parsing.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic invalidateData(): void {\r\n\t\tif (this.disabled || this.isTemplate) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//if(!this.dataInvalid){\r\n\t\tregistry.addToInvalidComponents(this);\r\n\t\tsystem.requestFrame();\r\n\t\tthis.dataInvalid = true;\r\n\r\n\t\t$iter.each(this.dataUsers.iterator(), (x) => {\r\n\t\t\tx.invalidateDataItems();\r\n\t\t});\r\n\t\t//}\r\n\t}\r\n\r\n\t/**\r\n\t * [invalidateDataUsers description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tpublic invalidateDataUsers(): void {\r\n\t\t$iter.each(this.dataUsers.iterator(), (x) => {\r\n\t\t\tx.invalidate();\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates data values. When data array is not changed, but values within\r\n\t * it changes, we invalidate data so that component would process changes.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic invalidateDataItems(): void {\r\n\t\tif (this.disabled || this.isTemplate) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//if(!this.dataItemsInvalid){\r\n\t\t$array.move(registry.invalidDataItems, this);\r\n\t\tsystem.requestFrame();\r\n\r\n\t\tthis.dataItemsInvalid = true;\r\n\r\n\t\t$iter.each(this.dataUsers.iterator(), (x) => {\r\n\t\t\tx.invalidateDataItems();\r\n\t\t});\r\n\t\t//}\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates data range. This is done when data which must be shown\r\n\t * changes (chart is zoomed for example).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic invalidateDataRange(): void {\r\n\t\tif (this.disabled || this.isTemplate) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//if(!this.dataRangeInvalid){\r\n\t\tthis.dataRangeInvalid = true;\r\n\t\t$array.move(registry.invalidDataRange, this);\r\n\t\tsystem.requestFrame();\r\n\t\t//}\r\n\t}\r\n\r\n\t/**\r\n\t * Processes data range.\r\n\t *\r\n\t * @todo Description\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validateDataRange(): void {\r\n\t\t$array.remove(registry.invalidDataRange, this);\r\n\t\tthis.dataRangeInvalid = false;\r\n\r\n\t\tif (this.startIndex != this._prevStartIndex || this.endIndex != this._prevEndIndex) {\r\n\t\t\tthis.rangeChangeUpdate();\r\n\t\t\tthis.appendDataItems();\r\n\t\t\tthis.invalidate();\r\n\t\t\tthis.dispatchImmediately(\"datarangechanged\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [sliceData description]\r\n\t *\r\n\t * @todo Description\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected sliceData() {\r\n\t\tthis._workingStartIndex = this.startIndex;\r\n\t\tthis._workingEndIndex = this.endIndex;\r\n\t}\r\n\r\n\t/**\r\n\t * [rangeChangeUpdate description]\r\n\t *\r\n\t * @todo Description\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected rangeChangeUpdate() {\r\n\t\tthis.sliceData();\r\n\t\tthis._prevStartIndex = this.startIndex;\r\n\t\tthis._prevEndIndex = this.endIndex;\r\n\t}\r\n\r\n\t/**\r\n\t * [appendDataItems description]\r\n\t *\r\n\t * @todo Description\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected appendDataItems() {\r\n\t\t// TODO use an iterator instead\r\n\t\tlet count = this.endIndex;\r\n\t\tfor (let i: number = this.startIndex; i < count; i++) {\r\n\r\n\t\t\t// data item\r\n\t\t\tlet dataItem = this.dataItems.getIndex(i);\r\n\t\t\tif (dataItem) {\r\n\t\t\t\tdataItem.__disabled = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < this.startIndex; i++) {\r\n\t\t\tlet dataItem = this.dataItems.getIndex(i);\r\n\t\t\tif (dataItem) {\r\n\t\t\t\tdataItem.__disabled = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let i = this.endIndex; i < this.dataItems.length; i++) {\r\n\t\t\tlet dataItem = this.dataItems.getIndex(i);\r\n\t\t\tif (dataItem) {\r\n\t\t\t\tdataItem.__disabled = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * If you want to have a smooth transition from one data values to another, you change your raw data and then you must call this method.\r\n\t * then instead of redrawing everything, the chart will check raw data and smoothly transit from previous to new data\r\n\t */\r\n\tpublic invalidateRawData(): void {\r\n\t\tif (this.disabled || this.isTemplate) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//if(!this.rawDataInvalid){\r\n\t\t$array.move(registry.invalidRawDatas, this);\r\n\t\tsystem.requestFrame();\r\n\r\n\t\tthis.rawDataInvalid = true;\r\n\r\n\t\t$iter.each(this.dataUsers.iterator(), (x) => {\r\n\t\t\tx.invalidateRawData();\r\n\t\t});\r\n\t\t//}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic validateRawData() {\r\n\t\t$array.remove(registry.invalidRawDatas, this);\r\n\t\t$iter.each(this.mainDataSet.iterator(), (dataItem) => {\r\n\t\t\tif (dataItem) {\r\n\t\t\t\tthis.updateDataItem(dataItem);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys this object and all related data.\r\n\t */\r\n\tpublic dispose() {\r\n\t\tthis.mainDataSet.template.clones.clear();\r\n\t\t$object.each(this._dataSources, (key, source) => {\r\n\t\t\tthis.removeDispose(source);\r\n\t\t});\r\n\t\tsuper.dispose();\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic disposeData() {\r\n\t\tthis.mainDataSet.template.clones.clear();\r\n\r\n\t\t$array.each(this._dataDisposers, (x) => {\r\n\t\t\tx.dispose();\r\n\t\t});\r\n\r\n\t\t// and for all components\r\n\t\t$iter.each(this.dataUsers.iterator(), (dataUser) => {\r\n\t\t\tdataUser.disposeData();\r\n\t\t});\r\n\r\n\t\tthis._dataDisposers.length = 0;\r\n\r\n\t\tthis._startIndex = undefined;\r\n\t\tthis._endIndex = undefined;\r\n\r\n\t\t// dispose old\r\n\t\tthis.mainDataSet.clear();\r\n\r\n\t\tthis.mainDataSet.template.clones.clear();\r\n\r\n\t\tif (this._dataSets) {\r\n\t\t\tthis._dataSets.clear();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tprotected getDataItem(dataContext?: any): this[\"_dataItem\"] {\r\n\t\treturn this.mainDataSet.create();\r\n\t}\r\n\r\n\t/**\r\n\t * Validates (processes) data.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validateData(): void {\r\n\t\tthis.dispatchImmediately(\"beforedatavalidated\");\r\n\r\n\t\tthis.dataInvalid = false;\r\n\r\n\t\tregistry.removeFromInvalidComponents(this);\r\n\r\n\t\tif (this.__disabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.dataValidationProgress = 0;\r\n\t\t// need this to slice new data\r\n\t\tthis._prevStartIndex = undefined;\r\n\t\tthis._prevEndIndex = undefined;\r\n\r\n\t\t// todo: this needs some overthinking, maybe some extra settings like zoomOotonDataupdate like in v3 or so. some charts like pie chart probably should act like this always\r\n\t\tthis._startIndex = undefined;\r\n\t\tthis._endIndex = undefined;\r\n\r\n\t\tif (this.dataFields.data && this.dataItem) {\r\n\t\t\tlet dataContext = <any>this.dataItem.dataContext;\r\n\t\t\tthis._data = dataContext[this.dataFields.data];\r\n\t\t}\r\n\r\n\t\t// data items array is reset only if all data is validated, if _parseDataFrom is not 0, we append new data only\r\n\t\t// check heatmap demo if uncommented\r\n\t\t// fixed both issues by adding && this.data.length > 0\r\n\t\t// check adding series example if changed\r\n\t\tif (this._parseDataFrom === 0 && this.data.length > 0) {\r\n\t\t\tthis.disposeData();\r\n\t\t}\r\n\r\n\t\tif (this.data.length > 0) {\r\n\t\t\tlet preloader: $type.Optional<Preloader> = this.preloader;\r\n\r\n\t\t\t// and for all components\r\n\t\t\t$iter.each(this.dataUsers.iterator(), (dataUser) => {\r\n\t\t\t\t// todo: this needs some overthinking, maybe some extra settings like zoomOUtonDataupdate like in v3 or so. some charts like pie chart probably should act like this always\r\n\t\t\t\tdataUser._startIndex = undefined;\r\n\t\t\t\tdataUser._endIndex = undefined;\r\n\t\t\t});\r\n\r\n\t\t\tlet counter: number = 0;\r\n\t\t\tlet startTime: number = Date.now();\r\n\t\t\t// parse data\r\n\t\t\tlet i = this._parseDataFrom;\r\n\t\t\tlet n = this.data.length;\r\n\r\n\t\t\tfor (i; i < n; i++) {\r\n\t\t\t\tlet rawDataItem = this.data[i];\r\n\t\t\t\tif (this._usesData) {\r\n\t\t\t\t\tlet dataItem: this[\"_dataItem\"] = this.getDataItem(rawDataItem);\r\n\t\t\t\t\tthis.processDataItem(dataItem, rawDataItem);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.dataUsers.each((dataUser) => {\r\n\t\t\t\t\tif (dataUser.data.length == 0) { // checking if data is not set directly\r\n\t\t\t\t\t\tlet dataUserDataItem: DataItem = dataUser.getDataItem(rawDataItem);\r\n\t\t\t\t\t\tdataUser.processDataItem(dataUserDataItem, rawDataItem);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcounter++;\r\n\r\n\t\t\t\t// show preloader if this takes too many time\r\n\t\t\t\tif (counter == 100) { // no need to check it on each data item\r\n\t\t\t\t\tcounter = 0;\r\n\t\t\t\t\tlet elapsed: number = Date.now() - startTime;\r\n\r\n\t\t\t\t\tif (elapsed > this.parsingStepDuration) {\r\n\t\t\t\t\t\tif (i < this.data.length - 10) {\r\n\t\t\t\t\t\t\tthis._parseDataFrom = i + 1;\r\n\r\n\t\t\t\t\t\t\t// update preloader\r\n\t\t\t\t\t\t\tif (preloader) {\r\n\t\t\t\t\t\t\t\tif (i / this.data.length > 0.5 && !preloader.visible) {\r\n\t\t\t\t\t\t\t\t\t// do not start showing\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tpreloader.progress = i / this.data.length;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis.dataValidationProgress = i / this.data.length;\r\n\r\n\t\t\t\t\t\t\ti = this.data.length; // stops cycle\r\n\t\t\t\t\t\t\tthis.invalidateData();\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (preloader) {\r\n\t\t\t\tpreloader.progress = 1;\r\n\t\t\t}\r\n\r\n\t\t\tthis.dataUsers.each((dataUser) => {\r\n\t\t\t\tif (dataUser.hidden) {\r\n\t\t\t\t\tdataUser.hide(0);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.dataValidationProgress = 1;\r\n\t\tthis._parseDataFrom = 0; // reset this index, it is set to dataItems.length if addData() method was used.\r\n\r\n\t\tthis.invalidateDataItems();\r\n\r\n\t\tif (!this._internalDefaultsApplied) {\r\n\t\t\tthis.applyInternalDefaults();\r\n\t\t}\r\n\r\n\t\tthis.dispatch(\"datavalidated\"); // can't zoom chart if dispatched immediately\r\n\t}\r\n\r\n\t/**\r\n\t * Validates (processes) data items.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validateDataItems(): void {\r\n\t\t$array.remove(registry.invalidDataItems, this);\r\n\r\n\t\tthis.dataItemsInvalid = false;\r\n\r\n\t\tthis.invalidateDataRange();\r\n\t\tthis.invalidate();\r\n\t\tthis.dispatch(\"dataitemsvalidated\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets source (raw) data for the element. The \"data\" is always an `Array`\r\n\t * of objects.\r\n\t *\r\n\t * IMPORTANT: The order of data items in `data` array is important as it\r\n\t * might affect chart look and behavior. [More details](https://www.amcharts.com/docs/v4/concepts/data/#Order_of_data_items).\r\n\t *\r\n\t * @param value Data\r\n\t */\r\n\tpublic set data(value: any[]) {\r\n\t\tthis.setData(value);\r\n\t}\r\n\r\n\tprotected setData(value: any[]) {\r\n\t\t// array might be the same, but there might be items added\r\n\t\t// todo: check if array changed, toString maybe?\r\n\t\tif (!this.isDisposed()) {\r\n\t\t\tthis._parseDataFrom = 0;\r\n\t\t\tthis.disposeData();\r\n\t\t\tthis._data = value;\r\n\t\t\tif (value && value.length > 0) {\r\n\t\t\t\tthis.invalidateData();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.dispatchImmediately(\"beforedatavalidated\");\r\n\t\t\t\tthis.dispatch(\"datavalidated\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's source (raw) data.\r\n\t *\r\n\t * @return Data\r\n\t */\r\n\tpublic get data(): any[] {\r\n\t\tif (!this._data) {\r\n\t\t\tthis._data = [];\r\n\t\t}\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn this._data;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"data\", this._data);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns (creates if necessary) a [[DataSource]] bound to any specific\r\n\t * property.\r\n\t *\r\n\t * For example if I want to bind `data` to an external JSON file, I'd create\r\n\t * a DataSource for it.\r\n\t *\r\n\t * @param property  Property to bind external data to\r\n\t * @return A DataSource for property\r\n\t */\r\n\tpublic getDataSource(property: string): DataSource {\r\n\t\tif (!$type.hasValue(this._dataSources[property])) {\r\n\t\t\tthis._dataSources[property] = new DataSource();\r\n\t\t\tthis._dataSources[property].component = this;\r\n\t\t\tthis.setDataSourceEvents(this._dataSources[property], property);\r\n\t\t\tthis._dataSources[property].adapter.add(\"dateFields\", (val) => {\r\n\t\t\t\treturn this.dataSourceDateFields(val);\r\n\t\t\t});\r\n\t\t\tthis._dataSources[property].adapter.add(\"numberFields\", (val) => {\r\n\t\t\t\treturn this.dataSourceNumberFields(val);\r\n\t\t\t});\r\n\t\t\tthis.events.on(\"inited\", () => {\r\n\t\t\t\tthis.loadData(property);\r\n\t\t\t}, this, false);\r\n\t\t}\r\n\t\treturn this._dataSources[property];\r\n\t}\r\n\r\n\t/**\r\n\t *A [[DataSource]] to be used for loading Component's data.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/loading-external-data/} for more on loading external data\r\n\t * @param value  Data source\r\n\t */\r\n\tpublic set dataSource(value: DataSource) {\r\n\t\tif (this._dataSources[\"data\"]) {\r\n\t\t\tthis.removeDispose(this._dataSources[\"data\"]);\r\n\t\t}\r\n\t\tthis._dataSources[\"data\"] = value;\r\n\t\tthis._dataSources[\"data\"].component = this;\r\n\t\tthis.events.on(\"inited\", () => {\r\n\t\t\tthis.loadData(\"data\")\r\n\t\t}, this, false);\r\n\t\tthis.setDataSourceEvents(value, \"data\");\r\n\t}\r\n\r\n\t/**\r\n\t * @return Data source\r\n\t */\r\n\tpublic get dataSource(): DataSource {\r\n\t\tif (!this._dataSources[\"data\"]) {\r\n\t\t\tthis.getDataSource(\"data\");\r\n\t\t}\r\n\t\treturn this._dataSources[\"data\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Initiates loading of the external data via [[DataSource]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected loadData(property: string): void {\r\n\t\tthis._dataSources[property].load();\r\n\t}\r\n\r\n\t/**\r\n\t * This function is called by the [[DataSource]]'s `dateFields` adapater\r\n\t * so that particular chart types can popuplate this setting with their\r\n\t * own type-specific data fields so they are parsed properly.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value  Array of date fields\r\n\t * @return Array of date fields populated with chart's date fields\r\n\t */\r\n\tprotected dataSourceDateFields(value: string[]): string[] {\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * This function is called by the [[DataSource]]'s `numberFields` adapater\r\n\t * so that particular chart types can popuplate this setting with their\r\n\t * own type-specific data fields so they are parsed properly.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value  Array of number fields\r\n\t * @return Array of number fields populated with chart's number fields\r\n\t */\r\n\tprotected dataSourceNumberFields(value: string[]): string[] {\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t * @param list        [description]\r\n\t * @param dataFields  [description]\r\n\t * @param targetList  [description]\r\n\t * @return [description]\r\n\t */\r\n\tprotected populateDataSourceFields(list: string[], dataFields: { [index: string]: string }, targetList: string[]): string[] {\r\n\t\t$array.each(targetList, (value: string) => {\r\n\t\t\tif (dataFields[value] && $array.indexOf(list, dataFields[value]) === -1) {\r\n\t\t\t\tlist.push(dataFields[value]);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn list;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets events on a [[DataSource]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected setDataSourceEvents(ds: DataSource, property?: string): void {\r\n\t\tds.events.on(\"started\", (ev) => {\r\n\t\t\tconst preloader = this.preloader;\r\n\t\t\tif (preloader) {\r\n\t\t\t\tpreloader.progress = 0;\r\n\t\t\t\t//preloader.label.text = this.language.translate(\"Loading\");\r\n\t\t\t}\r\n\t\t}, undefined, false);\r\n\t\tds.events.on(\"loadstarted\", (ev) => {\r\n\t\t\tconst preloader = this.preloader;\r\n\t\t\tif (preloader) {\r\n\t\t\t\tpreloader.progress = 0.25;\r\n\t\t\t}\r\n\t\t}, undefined, false);\r\n\t\tds.events.on(\"loadended\", (ev) => {\r\n\t\t\tconst preloader = this.preloader;\r\n\t\t\tif (preloader) {\r\n\t\t\t\tpreloader.progress = 0.5;\r\n\t\t\t}\r\n\t\t}, undefined, false);\r\n\t\tds.events.on(\"parseended\", (ev) => {\r\n\t\t\tconst preloader = this.preloader;\r\n\t\t\tif (preloader) {\r\n\t\t\t\tpreloader.progress = 0.75;\r\n\t\t\t}\r\n\t\t}, undefined, false);\r\n\t\tds.events.on(\"ended\", (ev) => {\r\n\t\t\tconst preloader = this.preloader;\r\n\t\t\tif (preloader) {\r\n\t\t\t\tpreloader.progress = 1;\r\n\t\t\t}\r\n\t\t}, undefined, false);\r\n\t\tds.events.on(\"error\", (ev) => {\r\n\t\t\tconst preloader = this.preloader;\r\n\t\t\tif (preloader) {\r\n\t\t\t\tpreloader.progress = 1;\r\n\t\t\t}\r\n\t\t\tthis.openModal(ev.message);\r\n\t\t}, undefined, false);\r\n\r\n\t\tif (property) {\r\n\t\t\tds.events.on(\"done\", (ev) => {\r\n\t\t\t\tconst preloader = this.preloader;\r\n\t\t\t\tif (preloader) {\r\n\t\t\t\t\tpreloader.progress = 1;\r\n\t\t\t\t}\r\n\t\t\t\tif (property == \"data\" && !$type.isArray(ev.data)) {\r\n\t\t\t\t\tev.data = [ev.data];\r\n\t\t\t\t}\r\n\t\t\t\tif (ds.incremental && property == \"data\" && this.data.length) {\r\n\t\t\t\t\tthis.addData(ev.data, ds.keepCount ? ev.data.length : 0);\r\n\t\t\t\t}\r\n\t\t\t\telse if (ds.updateCurrentData && property == \"data\" && this.data.length) {\r\n\t\t\t\t\t// cycle through existing data items\r\n\t\t\t\t\t$array.each(this.data, (item, index) => {\r\n\t\t\t\t\t\tif ($type.hasValue(ev.data[index])) {\r\n\t\t\t\t\t\t\t$object.each(item, (key, val) => {\r\n\t\t\t\t\t\t\t\tif ($type.hasValue(ev.data[index][key])) {\r\n\t\t\t\t\t\t\t\t\titem[key] = ev.data[index][key];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.invalidateRawData();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t(<any>this)[property] = ev.data;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Responsive]] instance to be used when applying conditional\r\n\t * property values.\r\n\t *\r\n\t * NOTE: Responsive features are currently in development and may not work\r\n\t * as expected, if at all.\r\n\t *\r\n\t * @param value  Responsive rules handler\r\n\t */\r\n\tpublic set responsive(value: Responsive) {\r\n\t\tthis._responsive = value;\r\n\t\tthis._responsive.component = this;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Responsive rules handler\r\n\t */\r\n\tpublic get responsive(): Responsive {\r\n\t\tif (!this._responsive) {\r\n\t\t\tthis._responsive = new Responsive();\r\n\t\t\tthis._responsive.component = this;\r\n\t\t}\r\n\t\treturn this._responsive;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets current zoom.\r\n\t *\r\n\t * The range uses relative values from 0 to 1, with 0 marking beginning and 1\r\n\t * marking end of the available data range.\r\n\t *\r\n\t * This method will not have any effect when called on a chart object.\r\n\t * Since the chart can have a number of axes and series, each with its own\r\n\t * data, the meaning of \"range\" is very ambiguous.\r\n\t *\r\n\t * To zoom the chart use `zoom*` methods on its respective axes.\r\n\t *\r\n\t * @param range          Range\r\n\t * @param skipRangeEvent Should rangechanged event not be triggered?\r\n\t * @param instantly      Do not animate?\r\n\t * @return Actual modidied range (taking `maxZoomFactor` into account)\r\n\t */\r\n\tpublic zoom(range: IRange, skipRangeEvent: boolean = false, instantly: boolean = false, declination?: number): IRange {\r\n\t\tlet start: $type.Optional<number> = range.start;\r\n\t\tlet end = range.end;\r\n\t\tlet priority = range.priority;\r\n\r\n\t\tif (range.start == range.end) {\r\n\t\t\trange.start = range.start - 0.5 / this.maxZoomFactor;\r\n\t\t\trange.end = range.end + 0.5 / this.maxZoomFactor;\r\n\t\t}\r\n\r\n\t\tif (priority == \"end\" && end == 1 && start != 0) {\r\n\t\t\tif (start < this.start) {\r\n\t\t\t\tpriority = \"start\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (priority == \"start\" && start == 0) {\r\n\t\t\tif (end > this.end) {\r\n\t\t\t\tpriority = \"end\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(declination)) {\r\n\t\t\tdeclination = this.maxZoomDeclination;\r\n\t\t}\r\n\r\n\t\tif (!$type.isNumber(start) || !$type.isNumber(end)) {\r\n\t\t\treturn { start: this.start, end: this.end };\r\n\t\t}\r\n\r\n\t\tif (this._finalStart != start || this._finalEnd != end) {\r\n\r\n\t\t\tlet maxZoomFactor: number = this.maxZoomFactor / this.minZoomCount;\r\n\t\t\tlet minZoomFactor: number = this.maxZoomFactor / this.maxZoomCount;\r\n\r\n\t\t\t// most likely we are dragging left scrollbar grip here, so we tend to modify end\r\n\r\n\t\t\tif (priority == \"start\") {\r\n\r\n\t\t\t\tif (this.maxZoomCount > 0) {\r\n\t\t\t\t\t// add to the end\r\n\t\t\t\t\tif (1 / (end - start) < minZoomFactor) {\r\n\t\t\t\t\t\tend = start + 1 / minZoomFactor;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// add to the end\r\n\t\t\t\tif (1 / (end - start) > maxZoomFactor) {\r\n\t\t\t\t\tend = start + 1 / maxZoomFactor;\r\n\t\t\t\t}\r\n\t\t\t\t//unless end is > 0\r\n\t\t\t\tif (end > 1 && end - start < 1 / maxZoomFactor) {\r\n\t\t\t\t\t//end = 1;\r\n\t\t\t\t\tstart = end - 1 / maxZoomFactor;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// most likely we are dragging right, so we modify left\r\n\t\t\telse {\r\n\r\n\t\t\t\tif (this.maxZoomCount > 0) {\r\n\t\t\t\t\t// add to the end\r\n\t\t\t\t\tif (1 / (end - start) < minZoomFactor) {\r\n\t\t\t\t\t\tstart = end - 1 / minZoomFactor;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// remove from start\r\n\t\t\t\tif (1 / (end - start) > maxZoomFactor) {\r\n\t\t\t\t\tstart = end - 1 / maxZoomFactor;\r\n\t\t\t\t}\r\n\t\t\t\tif (start < 0 && end - start < 1 / maxZoomFactor) {\r\n\t\t\t\t\t//start = 0;\r\n\t\t\t\t\tend = start + 1 / maxZoomFactor;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (start < - declination) {\r\n\t\t\t\tstart = - declination;\r\n\t\t\t}\r\n\r\n\t\t\tif (1 / (end - start) > maxZoomFactor) {\r\n\t\t\t\tend = start + 1 / maxZoomFactor;\r\n\t\t\t}\r\n\r\n\t\t\tif (end > 1 + declination) {\r\n\t\t\t\tend = 1 + declination;\r\n\t\t\t}\r\n\r\n\t\t\tif (1 / (end - start) > maxZoomFactor) {\r\n\t\t\t\tstart = end - 1 / maxZoomFactor;\r\n\t\t\t}\r\n\r\n\t\t\tthis._finalEnd = end;\r\n\t\t\tthis._finalStart = start;\r\n\r\n\t\t\tthis.skipRangeEvent = skipRangeEvent;\r\n\r\n\t\t\tthis.dispatchImmediately(\"rangechangestarted\");\r\n\r\n\t\t\tif (this.rangeChangeDuration > 0 && !instantly) {\r\n\r\n\t\t\t\t// todo: maybe move this to Animation\r\n\t\t\t\tlet rangeChangeAnimation: $type.Optional<Animation> = this.rangeChangeAnimation;\r\n\t\t\t\tif (rangeChangeAnimation && rangeChangeAnimation.progress < 1) {\r\n\t\t\t\t\tlet options = rangeChangeAnimation.animationOptions;\r\n\t\t\t\t\tif (options.length > 1) {\r\n\t\t\t\t\t\tif (options[0].to == start && options[1].to == end) {\r\n\t\t\t\t\t\t\treturn { start: start, end: end };\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tif (!rangeChangeAnimation.isDisposed()) {\r\n\t\t\t\t\t\t\t\trangeChangeAnimation.stop();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.rangeChangeAnimation) {\r\n\t\t\t\t\tthis.rangeChangeAnimation.kill();\r\n\t\t\t\t}\r\n\r\n\t\t\t\trangeChangeAnimation = this.animate([{ property: \"start\", to: start }, { property: \"end\", to: end }], this.rangeChangeDuration, this.rangeChangeEasing);\r\n\t\t\t\tthis.rangeChangeAnimation = rangeChangeAnimation;\r\n\r\n\t\t\t\tif (rangeChangeAnimation && !rangeChangeAnimation.isFinished()) {\r\n\t\t\t\t\trangeChangeAnimation.events.on(\"animationended\", () => {\r\n\t\t\t\t\t\tthis.dispatchImmediately(\"rangechangeended\");\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.dispatchImmediately(\"rangechangeended\");\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.start = start;\r\n\t\t\t\tthis.end = end;\r\n\t\t\t\tthis.dispatch(\"rangechangeended\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn { start: start, end: end };\r\n\t}\r\n\r\n\t/**\r\n\t * Zooms to specific data items using their index in data.\r\n\t *\r\n\t * This method will not have any effect when called on a chart object.\r\n\t * Since the chart can have a number of axes and series, each with its own\r\n\t * data, the meaning of \"index\" is very ambiguous.\r\n\t *\r\n\t * To zoom the chart use `zoom*` methods on its respective axes.\r\n\t *\r\n\t * @param startIndex     Index of the starting data item\r\n\t * @param endIndex       Index of the ending data item\r\n\t * @param skipRangeEvent Should rangechanged event not be triggered?\r\n\t * @param instantly      Do not animate?\r\n\t */\r\n\tpublic zoomToIndexes(startIndex: number, endIndex: number, skipRangeEvent?: boolean, instantly?: boolean) {\r\n\t\tif (!$type.isNumber(startIndex) || !$type.isNumber(endIndex)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet start: number = startIndex / this.dataItems.length;\r\n\t\tlet end: number = endIndex / this.dataItems.length;\r\n\r\n\t\tthis.zoom({ start: start, end: end }, skipRangeEvent, instantly);\r\n\t}\r\n\r\n\t/**\r\n\t * A current zoom factor (0-1). 1 meaning fully zoomed out. (showing all of\r\n\t * the available data)\r\n\t *\r\n\t * @return Zoom factor\r\n\t */\r\n\tpublic get zoomFactor(): number {\r\n\t\treturn $math.fitToRange(1 / (this.end - this.start), 1, this.maxZoomFactor);\r\n\t}\r\n\r\n\t/**\r\n\t * Max available `zoomFactor`.\r\n\t *\r\n\t * The element will not allow zoom to occur beyond this factor.\r\n\t *\r\n\t * [[DateAxis]] and [[CategoryAxis]] calculate this atutomatically so that\r\n\t * category axis could be zoomed to one category and date axis allows to be\r\n\t * zoomed up to one base interval.\r\n\t *\r\n\t * In case you want to restrict category or date axis to be zoomed to more\r\n\t * than one category or more than one base interval, use `minZoomCount`\r\n\t * property (set it to `> 1`).\r\n\t *\r\n\t * Default value of [[ValueAxis]]'s `maxZoomFactor` is `1000`.\r\n\t *\r\n\t * Feel free to modify it to allow bigger zoom or to restrict zooming.\r\n\t *\r\n\t * @param value  Maximum zoomFactor\r\n\t */\r\n\tpublic set maxZoomFactor(value: number) {\r\n\t\tif (this.setPropertyValue(\"maxZoomFactor\", value)) {\r\n\t\t\tif (value == 1) {\r\n\t\t\t\tthis.maxZoomDeclination = 0;\r\n\t\t\t}\r\n\r\n\t\t\tthis.invalidateDataRange();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Maximum zoomFactor\r\n\t */\r\n\tpublic get maxZoomFactor(): number {\r\n\t\treturn this.getPropertyValue(\"maxZoomFactor\");\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Max zoom declination.\r\n\t *\r\n\t * @ignore\r\n\t * @default 1\r\n\t * @param value  Maximum zoom declination\r\n\t */\r\n\tpublic set maxZoomDeclination(value: number) {\r\n\t\tif (this.setPropertyValue(\"maxZoomDeclination\", value)) {\r\n\t\t\tthis.invalidateDataRange();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * @return Maximum zoom declination\r\n\t */\r\n\tpublic get maxZoomDeclination(): number {\r\n\t\treturn this.getPropertyValue(\"maxZoomDeclination\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets current starting index.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value Start index\r\n\t */\r\n\tpublic set startIndex(value: number) {\r\n\t\tthis._startIndex = $math.fitToRange(Math.round(value), 0, this.dataItems.length);\r\n\t\t//this._workingStartIndex = this._startIndex; // not good, breaks adjusted working start index of line series\r\n\t\tthis.start = this.indexToPosition(this._startIndex);\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * @todo:review description\r\n\t * returns item's relative position by the index of the item\r\n\t * @param index\r\n\t */\r\n\tpublic indexToPosition(index: number) {\r\n\t\treturn index / this.dataItems.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Current starting index.\r\n\t *\r\n\t * @return Start index\r\n\t */\r\n\tpublic get startIndex(): number {\r\n\t\tif (!$type.isNumber(this._startIndex)) {\r\n\t\t\tthis._startIndex = 0;\r\n\t\t}\r\n\r\n\t\treturn this._startIndex;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets current ending index.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value End index\r\n\t */\r\n\tpublic set endIndex(value: number) {\r\n\t\tthis._endIndex = $math.fitToRange(Math.round(value), 0, this.dataItems.length);\r\n\t\t//this._workingEndIndex = this._endIndex; // not good, breaks adjusted workingend index of line series\r\n\t\tthis.end = this.indexToPosition(this._endIndex);\r\n\t}\r\n\r\n\t/**\r\n\t * Current ending index.\r\n\t *\r\n\t * @return End index\r\n\t */\r\n\tpublic get endIndex(): number {\r\n\t\tlet count = this.dataItems.length;\r\n\t\tif (!$type.isNumber(this._endIndex) || this._endIndex > count) {\r\n\t\t\tthis._endIndex = count;\r\n\t\t}\r\n\t\treturn this._endIndex;\r\n\t}\r\n\r\n\t/**\r\n\t * Start of the current data range (zoom).\r\n\t *\r\n\t * These are relative values from 0 (beginning) to 1 (end).\r\n\t *\r\n\t * @param value Start (0-1)\r\n\t */\r\n\tpublic set start(value: number) {\r\n\t\t// value = $math.round(value, 10); not good\r\n\r\n\t\t//if (1 / (this.end - value) > this.maxZoomFactor) {\r\n\t\t//\tvalue = this.end - 1 / this.maxZoomFactor;\r\n\t\t//}\r\n\t\tif (this._start != value) {\r\n\t\t\tthis._start = value;\r\n\t\t\tlet startIndex = Math.max(0, Math.floor(this.dataItems.length * value) || 0);\r\n\t\t\tthis._startIndex = Math.min(startIndex, this.dataItems.length);\r\n\t\t\tthis.invalidateDataRange();\r\n\t\t\tthis.invalidate();\r\n\t\t\tthis.dispatchImmediately(\"startchanged\");\r\n\t\t\tthis.dispatch(\"startendchanged\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Start (0-1)\r\n\t */\r\n\tpublic get start(): number {\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn this._start;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"start\", this._start);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * End of the current data range (zoom).\r\n\t *\r\n\t * These are relative values from 0 (beginning) to 1 (end).\r\n\t *\r\n\t * @param value End (0-1)\r\n\t */\r\n\tpublic set end(value: number) {\r\n\t\t// value = $math.round(value, 10); // not good\r\n\r\n\t\t//if (1 / (value - this.start) > this.maxZoomFactor) {\r\n\t\t//\tvalue = 1 / this.maxZoomFactor + this.start;\r\n\t\t//}\r\n\r\n\t\tif (this._end != value) {\r\n\t\t\tthis._end = value;\r\n\t\t\tthis._endIndex = Math.min(this.dataItems.length, Math.ceil(this.dataItems.length * value) || 0);\r\n\t\t\tthis.invalidateDataRange();\r\n\t\t\tthis.invalidate();\r\n\t\t\tthis.dispatchImmediately(\"endchanged\");\r\n\t\t\tthis.dispatch(\"startendchanged\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return End (0-1)\r\n\t */\r\n\tpublic get end(): number {\r\n\t\tif (!this._adapterO) {\r\n\t\t\treturn this._end;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._adapterO.apply(\"end\", this._end);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * [removeFromInvalids description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tprotected removeFromInvalids(): void {\r\n\t\tsuper.removeFromInvalids();\r\n\t\tregistry.removeFromInvalidComponents(this);\r\n\t\t$array.remove(registry.invalidDataItems, this);\r\n\t\t$array.remove(registry.invalidDataRange, this);\r\n\t\t$array.remove(registry.invalidRawDatas, this);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a list of source [[DataItem]] objects currently used in the chart.\r\n\t *\r\n\t * @return List of data items\r\n\t */\r\n\tpublic get dataItems(): OrderedListTemplate<this[\"_dataItem\"]> {\r\n\t\tif (this._currentDataSetId != \"\") {\r\n\t\t\tlet dataItems = this.dataSets.getKey(this._currentDataSetId);\r\n\t\t\tif (dataItems) {\r\n\t\t\t\treturn dataItems;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._dataItems;\r\n\t}\r\n\r\n\t/**\r\n\t * Holds data items for data sets (usually aggregated data).\r\n\t *\r\n\t * @ignore\r\n\t * @since 4.7.0\r\n\t * @return  Data sets\r\n\t */\r\n\tpublic get dataSets(): Dictionary<string, OrderedListTemplate<this[\"_dataItem\"]>> {\r\n\t\tif (!this._dataSets) {\r\n\t\t\tthis._dataSets = new Dictionary();\r\n\t\t}\r\n\t\treturn this._dataSets;\r\n\t}\r\n\r\n\t/**\r\n\t * Makes the chart use particular data set.\r\n\t *\r\n\t * If `id` is not provided or there is no such data set, main data will be\r\n\t * used.\r\n\t *\r\n\t * @ignore\r\n\t * @since 4.7.0\r\n\t * @param  id  Data set id\r\n\t */\r\n\tpublic setDataSet(id: string): boolean {\r\n\r\n\t\tif (this._currentDataSetId != id) {\r\n\t\t\tlet dataSet = this.dataSets.getKey(id);\r\n\t\t\tif (!dataSet) {\r\n\t\t\t\tif (this._currentDataSetId != \"\") {\r\n\t\t\t\t\tthis.dataItems.each((dataItem) => {\r\n\t\t\t\t\t\tdataItem.__disabled = true;\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tthis._currentDataSetId = \"\";\r\n\r\n\t\t\t\t\tthis.invalidateDataRange();\r\n\r\n\t\t\t\t\tthis._prevStartIndex = undefined;\r\n\r\n\t\t\t\t\tthis.dataItems.each((dataItem) => {\r\n\t\t\t\t\t\tdataItem.__disabled = false;\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.dataItems.each((dataItem) => {\r\n\t\t\t\t\tdataItem.__disabled = true;\r\n\t\t\t\t})\r\n\r\n\t\t\t\tthis._currentDataSetId = id;\r\n\r\n\t\t\t\tthis.invalidateDataRange();\r\n\r\n\t\t\t\tthis._prevStartIndex = undefined;\r\n\r\n\t\t\t\tthis.dataItems.each((dataItem) => {\r\n\t\t\t\t\tdataItem.__disabled = false;\r\n\t\t\t\t})\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false\r\n\t}\r\n\r\n\t/**\r\n\t * Returns id of the currently used data set, or `undefined` if main data set\r\n\t * is in use.\r\n\t *\r\n\t * @since 4.7.0\r\n\t * @return Current data set id\r\n\t */\r\n\tpublic get currentDataSetId(): string {\r\n\t\treturn this._currentDataSetId;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns reference to \"main\" data set (unaggregated data as it was supplied\r\n\t * in `data`).\r\n\t *\r\n\t * @since 4.7.0\r\n\t * @return Main data set\r\n\t */\r\n\tpublic get mainDataSet(): OrderedListTemplate<this[\"_dataItem\"]> {\r\n\t\treturn this._dataItems;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the indexes for the dataItems\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _updateDataItemIndexes(startIndex: number): void {\r\n\t\tconst dataItems = this.mainDataSet.values;\r\n\t\tconst length = dataItems.length;\r\n\r\n\t\tfor (let i = startIndex; i < length; ++i) {\r\n\t\t\tdataItems[i]._index = i;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Processes newly added [[DataItem]] as well as triggers data re-validation.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param event [description]\r\n\t */\r\n\tprotected handleDataItemAdded(event: ISortedListEvents<DataItem>[\"inserted\"]) {\r\n\t\tevent.newValue.component = this;\r\n\r\n\t\tthis._updateDataItemIndexes(event.index);\r\n\r\n\t\tif (!this.dataItemsInvalid) {\r\n\t\t\tthis.invalidateDataItems();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * removes [[DataItem]] as well as triggers data re-validation.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param event [description]\r\n\t */\r\n\tprotected handleDataItemRemoved(event: ISortedListEvents<DataItem>[\"removed\"]) {\r\n\t\t//\t\tevent.oldValue.component = undefined; // not good, as some items might be not removed from component lists\r\n\r\n\t\tthis._updateDataItemIndexes(event.index);\r\n\r\n\t\tif (!this.dataItemsInvalid) {\r\n\t\t\tthis.invalidateDataItems();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Binds a data element's field to a specific field in raw data.\r\n\t * For example, for the very basic column chart you'd want to bind a `value`\r\n\t * field to a field in data, such as `price`.\r\n\t *\r\n\t * Some more advanced Components, like [[CandlestickSeries]] need several\r\n\t * data fields bound to data, such as ones for open, high, low and close\r\n\t * values.\r\n\t *\r\n\t * @todo Example\r\n\t * @param field  Field name\r\n\t * @param value  Field name in data\r\n\t */\r\n\tpublic bindDataField<Key extends keyof this[\"_dataFields\"]>(field: Key, value: this[\"_dataFields\"][Key]) {\r\n\t\tthis.dataFields[field] = value;\r\n\t\tthis.invalidateDataRange();\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates processed data.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic invalidateProcessedData(): void {\r\n\t\tthis.resetProcessedRange();\r\n\t\tthis.invalidateDataRange();\r\n\t}\r\n\r\n\t/**\r\n\t * [resetProcessedRange description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t */\r\n\tpublic resetProcessedRange(): void {\r\n\t\tthis._prevEndIndex = null;\r\n\t\tthis._prevStartIndex = null;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns all other [[Component]] objects that are using this element's\r\n\t * data.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description (review)\r\n\t * @return [description]\r\n\t */\r\n\tpublic get dataUsers(): List<Component> {\r\n\t\tif (!this._dataUsers) {\r\n\t\t\tthis._dataUsers = new List<Component>();\r\n\r\n\t\t\t//this._disposers.push(new ListDisposer(this._dataUsers));\r\n\r\n\t\t\t// TODO better way of handling this? e.g. move into another module ?\r\n\t\t\tthis._disposers.push(new Disposer(() => {\r\n\t\t\t\t// TODO clear the list ?\r\n\t\t\t\t$iter.each(this._dataUsers.iterator(), (x) => {\r\n\t\t\t\t\tx.dispose();\r\n\t\t\t\t});\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\treturn this._dataUsers;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a clone of this element.\r\n\t *\r\n\t * @return Clone\r\n\t */\r\n\tpublic clone(): this {\r\n\t\tlet component: this = super.clone();\r\n\t\tcomponent.dataFields = $utils.copyProperties(this.dataFields, {});\r\n\t\treturn component;\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all parameters from another [[Component]].\r\n\t *\r\n\t * @param source Source Component\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\tsuper.copyFrom(source);\r\n\t\tthis.data = source.data;\r\n\t\tthis.sequencedInterpolation = source.sequencedInterpolation;\r\n\t\tthis.sequencedInterpolationDelay = source.sequencedInterpolationDelay;\r\n\t\tthis.interpolationDuration = source.interpolationDuration;\r\n\t\tthis.interpolationEasing = source.interpolationEasing;\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates the whole element, including all its children, causing\r\n\t * complete re-parsing of data and redraw.\r\n\t *\r\n\t * Use sparingly!\r\n\t */\r\n\tpublic reinit(): void {\r\n\t\tthis._inited = false;\r\n\t\tthis.deepInvalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * Add an adapter for data.\r\n\t *\r\n\t * @return Exporting\r\n\t */\r\n\tprotected getExporting(): Export {\r\n\t\tconst _export = super.getExporting();\r\n\t\tif (!_export.adapter.has(\"data\", this._exportData, -1, this)) {\r\n\t\t\t_export.adapter.add(\"data\", this._exportData, -1, this);\r\n\t\t\tthis.events.on(\"datavalidated\", (ev) => {\r\n\t\t\t\t_export.handleDataUpdated();\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn _export;\r\n\t}\r\n\r\n\tprivate _exportData(arg: IExportAdapters[\"data\"]): IExportAdapters[\"data\"] {\r\n\t\targ.data = this.data;\r\n\t\treturn arg;\r\n\t}\r\n\r\n\tprotected setDisabled(value: boolean): boolean {\r\n\t\tlet changed = super.setDisabled(value);\r\n\t\tif (changed) {\r\n\t\t\tthis.invalidateData();\r\n\t\t}\r\n\t\treturn changed;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected setShowOnInit(value: boolean) {\r\n\t\tif (value != this.getPropertyValue(\"showOnInit\")) {\r\n\t\t\tif (value && !this.inited && !this.hidden) {\r\n\t\t\t\tthis._showOnInitDisposer2 = this.events.once(\"dataitemsvalidated\", this.hideInitially, this, false);\r\n\t\t\t\tthis._disposers.push(this._showOnInitDisposer2);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (this._showOnInitDisposer2) {\r\n\t\t\t\t\tthis.removeDispose(this._showOnInitDisposer2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// important order here\r\n\t\tsuper.setShowOnInit(value);\r\n\t}\r\n\r\n\tprotected setBaseId(value: string) {\r\n\t\tif (value != this._baseId) {\r\n\t\t\tif (this.dataInvalid) {\r\n\t\t\t\tthis.dataInvalid = false;\r\n\t\t\t\tregistry.removeFromInvalidComponents(this);\r\n\t\t\t\tthis._baseId = value;\r\n\t\t\t\tthis.invalidateData();\r\n\t\t\t}\r\n\t\t}\r\n\t\tsuper.setBaseId(value);\r\n\t}\r\n\r\n\t/**\r\n\t * Use this for [[CategoryAxis]] or [[DateAxis]].\r\n\t *\r\n\t * Allows restricting zoom in beyond certain number of categories or base\r\n\t * intervals.\r\n\t *\r\n\t * @default 1\r\n\t * @param value  Min zoom count\r\n\t */\r\n\tpublic set minZoomCount(value: number) {\r\n\t\tthis.setPropertyValue(\"minZoomCount\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Min zoom count\r\n\t */\r\n\tpublic get minZoomCount(): number {\r\n\t\treturn this.getPropertyValue(\"minZoomCount\");\r\n\t}\r\n\r\n\t/**\r\n\t * Use this for [[CategoryAxis]] or [[DateAxis]].\r\n\t *\r\n\t * Limits how many categories or base intervals can be shown at the same\r\n\t * time.\r\n\t *\r\n\t * If there are more items in the chart, the chart will auto-zoom.\r\n\t *\r\n\t * @default 0 (no limit)\r\n\t * @since 4.6.2\r\n\t * @param value  Max zoom count\r\n\t */\r\n\tpublic set maxZoomCount(value: number) {\r\n\t\tthis.setPropertyValue(\"maxZoomCount\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Max zoom count\r\n\t */\r\n\tpublic get maxZoomCount(): number {\r\n\t\treturn this.getPropertyValue(\"maxZoomCount\");\r\n\t}\r\n\r\n\t/**\r\n\t * Called during the System.update method\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic _systemCheckIfValidate(): boolean {\r\n\t\tif (this.dataInvalid || (this.dataProvider && this.dataProvider.dataInvalid)) {\r\n\t\t\treturn false;\r\n\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adds easing functions to \"function\" fields.\r\n\t *\r\n\t * @param field  Field name\r\n\t * @return Assign as function?\r\n\t */\r\n\tprotected asFunction(field: string): boolean {\r\n\t\treturn field == \"interpolationEasing\" || field == \"rangeChangeEasing\" || super.asIs(field);\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Component\"] = Component;\r\n","/**\r\n * Defines functionality for \"Data Item\"\r\n *\r\n * A Data Item can be any object that can hold data. For example [[LineSeries]]\r\n * holds a number of values, that comprise a line graph. Each of those values\r\n * (data points) is a {DataItem}.\r\n *\r\n * Furthermore the [[LineSeries]] itself can be represented as a entry in the\r\n * legend. Since legend needs access to Line Series' value, a DataItem is\r\n * created for the series.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObjectEvents, IBaseObjectEvents } from \"./Base\";\r\nimport { AMEvent } from \"./utils/EventDispatcher\";\r\nimport { Adapter } from \"./utils/Adapter\";\r\nimport { Component, CalculatedValue } from \"./Component\";\r\nimport { IAnimatable, Animation, IAnimationOptions, IAnimationEvents, AnimationDisposer } from \"./utils/Animation\";\r\nimport { Sprite } from \"./Sprite\";\r\nimport { IDisposer } from \"./utils/Disposer\";\r\nimport * as $utils from \"./utils/Utils\";\r\nimport * as $array from \"./utils/Array\";\r\n//import * as $object from \"./utils/Object\";\r\nimport * as $type from \"./utils/Type\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n *\r\n * @todo Description\r\n  */\r\nexport interface IValues { }\r\n\r\n/**\r\n * Defines data events for [[DataItem]]\r\n */\r\nexport interface IDataItemEvents extends IBaseObjectEvents {\r\n\r\n\t/**\r\n\t * Invoked when the visibility of the Data Item changes, i.e. Series is\r\n\t * hidden\r\n\t */\r\n\tvisibilitychanged: {\r\n\t\tvisible: boolean;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when the value is changed\r\n\t */\r\n\tvaluechanged: {\r\n\t\tproperty: string;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when the internal/intermediate value has changed\r\n\t */\r\n\tworkingvaluechanged: {\r\n\t\tproperty: string;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when the calculated value has changed\r\n\t */\r\n\tcalculatedvaluechanged: {\r\n\t\tproperty: string;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when the location of Data Item changes\r\n\t */\r\n\tlocationchanged: {\r\n\t\tproperty: string;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when working location of Data Item changes\r\n\t */\r\n\tworkinglocationchanged: {\r\n\t\tproperty: string;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when a property of the Data Item changes\r\n\t */\r\n\tpropertychanged: {\r\n\t\tproperty: string;\r\n\t\tvalue: any; // TODO don't make this any\r\n\t};\r\n\r\n}\r\n\r\n/**\r\n * Defines adapters for [[DataItem]]\r\n * Includes both the [[Adapter]] definitions and properties\r\n * @see {@link Adapter}\r\n */\r\nexport interface IDataItemAdapters {\r\n\r\n\tduration: number;\r\n\r\n\tvalue: {\r\n\t\tvalue: number,\r\n\t\tfield: string\r\n\t};\r\n\r\n\tworkingValue: {\r\n\t\tworkingValue: number,\r\n\t\tfield: string\r\n\t};\r\n\r\n\tdate: {\r\n\t\tdate: Date,\r\n\t\tfield: string\r\n\t};\r\n\r\n}\r\n\r\n/**\r\n * ============================================================================\r\n * DATA ITEM\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * DataItem represents single element in data, for example a data point in a\r\n * Serial Chart Series, e.g. a column.\r\n *\r\n * DataItem defines relationship between structured data, required for specific\r\n * chart type or task, and raw source data.\r\n *\r\n * It also implements required calculations, updates related visual elements,\r\n * etc.\r\n *\r\n * @todo Description\r\n * @important\r\n */\r\nexport class DataItem extends BaseObjectEvents implements IAnimatable {\r\n\r\n\t/**\r\n\t * When we are using a nested data structure, like for example in a TreeMap,\r\n\t * this property points to a parent Data Item of this one.\r\n\t */\r\n\tpublic parent: $type.Optional<this>;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IDataItemEvents;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IDataItemAdapters;\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic _adapterO: Adapter<this, this[\"_adapter\"]>;\r\n\r\n\t/**\r\n\t * Holds Adapter.\r\n\t */\r\n\tpublic get adapter(): Adapter<this, this[\"_adapter\"]> {\r\n\t\tif (!this._adapterO) {\r\n\t\t\tthis._adapterO = new Adapter<this, this[\"_adapter\"]>(this);\r\n\t\t}\r\n\t\treturn this._adapterO;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines a type of [[Component]] this Data Item is used for.\r\n\t */\r\n\tpublic _component!: Component;\r\n\r\n\t/**\r\n\t * A reference to a [[Component]] this Data Item belongs to.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic component: $type.Optional<this[\"_component\"]>;\r\n\r\n\t/**\r\n\t * A reference to the original Data Item in raw data.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _dataContext: Object;\r\n\r\n\t/**\r\n\t * This Data Item is currently disabled.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _disabled: boolean = false;\r\n\r\n\t/**\r\n\t * Indicates whether Data Item has any properties set.\r\n\t *\r\n\t * If it does not have any, the code can use this property to check whether\r\n\t * they need to apply costly operation of re-applying properties, whenever\r\n\t * Data Item-related element is redrawn, e.g. series.\r\n\t */\r\n\tpublic hasProperties: boolean = false;\r\n\r\n\t/**\r\n\t * An object containing calculated values.\r\n\t */\r\n\tpublic readonly values: { [index: string]: { [index: string]: number } } = {};\r\n\r\n\t/**\r\n\t * An object container current working values.\r\n\t */\r\n\t//public readonly workingValues: { [index: string]: { [index: string]: number } } = {};\r\n\r\n\t/**\r\n\t * An object containing categories.\r\n\t */\r\n\tpublic readonly categories: { [index: string]: string } = {};\r\n\r\n\t/**\r\n\t * An object containing dates.\r\n\t */\r\n\tpublic readonly dates: { [index: string]: Date } = {};\r\n\r\n\t/**\r\n\t * An object containing locations for the Data Item.\r\n\t *\r\n\t * A location is a position within date or category, or, in some other cases,\r\n\t * where there is no single point but rather some period.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/series/#Data_item_locations} for info how data item locations work\r\n\t */\r\n\tpublic readonly locations: { [index: string]: number } = {};\r\n\r\n\t/**\r\n\t * Current working locations.\r\n\t */\r\n\tpublic readonly workingLocations: { [index: string]: number } = {};\r\n\r\n\t/**\r\n\t * An object containing Data Item specific appearance properties in key-value\r\n\t * pairs.\r\n\t *\r\n\t * Sometimes a single Data Item needs to apply different properties than the\r\n\t * rest of the data [[Series]] it is part of. E.g. a single column,\r\n\t * represented by a Data Item needs to be filled with a different color than\r\n\t * the reset of the [[ColumnSeries]] it belongs to.\r\n\t *\r\n\t * That's where Data Item's `properties` come into play.\r\n\t *\r\n\t * Please note that you should set Data Item-specific properties using\r\n\t * `setProperty()` method, rather than access `properties` object directly.\r\n\t */\r\n\tpublic readonly properties: { [index: string]: any } = {};\r\n\r\n\t/**\r\n\t * A list of [[Sprite]] elements that are associated with this Data Item.\r\n\t *\r\n\t * E.g. an [[Axis]] Data Item has several separate elements associated with\r\n\t * it, like [[AxisTick]], [[AxisLabel]], and [[Grid]].\r\n\t *\r\n\t * Data Item keeps track of all of them, so it can toggle all related visual\r\n\t * elements when it itself is toggled.\r\n\t */\r\n\tpublic sprites: Sprite[] = [];\r\n\r\n\t/**\r\n\t * Identifies if this object is a \"template\" and should not be treated as\r\n\t * real object that is drawn or actually used in the chart.\r\n\t */\r\n\tpublic isTemplate: boolean = false;\r\n\r\n\t/**\r\n\t * List of animations currently animating Data Item's values.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _animations: $type.Optional<Array<Animation>>;\r\n\r\n\t/**\r\n\t * The current index within the dataItems\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic _index: number | null = null;\r\n\r\n\t/**\r\n\t * Is Data Item currently visible?\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _visible: boolean = true;\r\n\r\n\t/**\r\n\t * Is Data Item currently hidden?\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _hidden: boolean = false;\r\n\r\n\t/**\r\n\t * Should this Data Item be used when calculating data ranges and scales?\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _ignoreMinMax: boolean = false;\r\n\r\n\t/**\r\n\t * Some of the Data Item's data fields may contain an array of children. This\r\n\t * property contains an object indicating which fields hold an array, so that\r\n\t * they can be processed properly.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic hasChildren: { [index: string]: boolean } = {};\r\n\r\n\t/**\r\n\t * Indicates whether Data Item is currently animiting from visible to hidden\r\n\t * state.\r\n\t */\r\n\tpublic isHiding: boolean = false;\r\n\r\n\t/**\r\n\t * Holds a Disposer reference to hiding [[Animation]] currently playing.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _hideDisposer: $type.Optional<IDisposer>;\r\n\r\n\t/**\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _valueAnimations: { [key: string]: Animation } = {};\r\n\r\n\t/**\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _locationAnimations: { [key: string]: Animation } = {};\r\n\r\n\t/**\r\n\t * Constructor\r\n\t * @todo Adding events to disposers produces errors in some cases, which means that chart is using disposed Data Items which is not right\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"DataItem\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Data Item's position index in Component's data.\r\n\t *\r\n\t * @return Index\r\n\t */\r\n\tpublic get index(): number {\r\n\t\tif (this.component) {\r\n\t\t\tif (this._index != null) {\r\n\t\t\t\treturn this._index;\r\n\t\t\t} else {\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A list of [[Animations]] objects currently mutating Data Item's values.\r\n\t *\r\n\t * @return [description]\r\n\t */\r\n\tpublic get animations(): Array<Animation> {\r\n\t\tif (!this._animations) {\r\n\t\t\tthis._animations = [];\r\n\t\t\tthis._disposers.push(new AnimationDisposer(this._animations));\r\n\t\t}\r\n\t\treturn this._animations;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets visibility of the Data Item.\r\n\t *\r\n\t * @param value Visible?\r\n\t */\r\n\tpublic set visible(value: boolean) {\r\n\t\tif (value) {\r\n\t\t\tthis.hidden = false;\r\n\t\t}\r\n\t\tif (this._visible != value) {\r\n\t\t\tthis.setVisibility(value);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets hidden flag for data item. Mostly used to initially hide data item.\r\n\t *\r\n\t * @param value Hidden?\r\n\t */\r\n\tpublic set hidden(value: boolean) {\r\n\t\tif (this._hidden != value) {\r\n\t\t\tthis._hidden = value;\r\n\t\t\tif (value) {\r\n\t\t\t\tthis.setVisibility(false);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.setVisibility(true, true);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if this Data Item is currently hidden.\r\n\t *\r\n\t * @return Hidden?\r\n\t */\r\n\tpublic get hidden(): boolean {\r\n\t\treturn this._hidden;\r\n\t}\r\n\r\n\t/**\r\n\t * Disables all Sprites associated with this Data Item.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param {boolean}\r\n\t */\r\n\tpublic set __disabled(value: boolean) {\r\n\t\t//\tif (this._disabled != value) { // not good\r\n\t\tthis._disabled = value;\r\n\r\n\t\t$array.each(this.sprites, (sprite) => {\r\n\t\t\tsprite.__disabled = value;\r\n\t\t});\r\n\t\t//\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Is this Data Item currently disabled?\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param {boolean}\r\n\t */\r\n\tpublic get __disabled(): boolean {\r\n\t\treturn this._disabled;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets visibility of the Data Item.\r\n\t *\r\n\t * @param value Data Item\r\n\t */\r\n\tpublic setVisibility(value: boolean, noChangeValues?: boolean): void {\r\n\t\t$array.each(this.sprites, (sprite) => {\r\n\t\t\tif (value) {\r\n\t\t\t\tsprite.visible = sprite.defaultState.properties.visible;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (sprite.hiddenState) {\r\n\t\t\t\t\tsprite.visible = sprite.hiddenState.properties.visible;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tsprite.visible = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._visible = value;\r\n\t\tif (this._eventDispatcher && !this.__disabled) {\r\n\t\t\tif (this.events.isEnabled(\"visibilitychanged\")) {\r\n\t\t\t\tconst event: AMEvent<this, IDataItemEvents>[\"visibilitychanged\"] = {\r\n\t\t\t\t\ttype: \"visibilitychanged\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tvisible: value\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"visibilitychanged\", event);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if this Data Item is currently visible.\r\n\t *\r\n\t * @return Visible?\r\n\t */\r\n\tpublic get visible(): boolean {\r\n\t\tif (this._hidden) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn this._visible;\r\n\t}\r\n\r\n\t/**\r\n\t * Shows the Data Item and related visual elements.\r\n\t *\r\n\t * @param duration  Animation duration (ms)\r\n\t * @param delay     Delay animation (ms)\r\n\t * @param fields    A list of fields to set values of\r\n\t */\r\n\tpublic show(duration?: number, delay?: number, fields?: string[]): $type.Optional<Animation> {\r\n\t\tif (!this.hidden) {\r\n\t\t\tthis.setVisibility(true, true);\r\n\r\n\t\t\tthis.isHiding = false;\r\n\r\n\t\t\tif (this._hideDisposer) {\r\n\t\t\t\tthis.removeDispose(this._hideDisposer);\r\n\t\t\t}\r\n\r\n\t\t\tlet animation: $type.Optional<Animation>;\r\n\r\n\t\t\tif (fields) {\r\n\t\t\t\t$array.each(fields, (field) => {\r\n\t\t\t\t\tanimation = this.setWorkingValue(field, this.values[field].value, duration, delay);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t$array.each(this.sprites, (sprite) => {\r\n\t\t\t\tlet animation = sprite.show(duration);\r\n\r\n\t\t\t\tif (animation != null && !animation.isFinished()) {\r\n\t\t\t\t\tthis._disposers.push(animation);\r\n\r\n\t\t\t\t\tif (delay != null && delay > 0) {\r\n\t\t\t\t\t\tanimation.delay(delay);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn animation;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys this object and all related data.\r\n\t */\r\n\tpublic dispose() {\r\n\t\tsuper.dispose();\r\n\r\n\t\t$array.each(this.sprites, (sprite) => {\r\n\t\t\tsprite.dispose();\r\n\t\t});\r\n\r\n\t\tthis.sprites = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Hides the Data Item and related visual elements.\r\n\t *\r\n\t * @param duration  Animation duration (ms)\r\n\t * @param delay     Delay animation (ms)\r\n\t * @param toValue   A value to set to `fields` when hiding\r\n\t * @param fields    A list of data fields to set value to `toValue`\r\n\t */\r\n\tpublic hide(duration?: number, delay?: number, toValue?: number, fields?: string[]): $type.Optional<Animation> {\r\n\t\tthis.isHiding = true;\r\n\r\n\t\t$array.each(this.sprites, (sprite) => {\r\n\r\n\t\t\tlet animation = sprite.hide(duration);\r\n\r\n\t\t\tif (animation != null && !animation.isFinished()) {\r\n\t\t\t\tthis._disposers.push(animation);\r\n\r\n\t\t\t\tif (delay != null && delay > 0) {\r\n\t\t\t\t\tanimation.delay(delay);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif ($type.isNumber(toValue) && fields) {\r\n\t\t\tlet animation: $type.Optional<Animation>;\r\n\r\n\t\t\t$array.each(fields, (field) => {\r\n\t\t\t\tlet anim = this.setWorkingValue(field, toValue, duration, delay);\r\n\t\t\t\tif (anim) {\r\n\t\t\t\t\tanimation = anim;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (animation && !animation.isFinished()) {\r\n\t\t\t\tthis._hideDisposer = animation.events.on(\"animationended\", () => {\r\n\t\t\t\t\tthis.setVisibility(false, true);\r\n\t\t\t\t\tthis.isHiding = false;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis._disposers.push(this._hideDisposer);\r\n\t\t\t\treturn animation;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.isHiding = false;\r\n\t\t\t\tthis.setVisibility(false, true);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.isHiding = false;\r\n\t\t\tthis.setVisibility(false);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a duration (ms) the Data Item should take to animate from one\r\n\t * value to another.\r\n\t *\r\n\t * If the duration is not specified via parameter, this method will try to\r\n\t * request a default duration from the related `Component`.\r\n\t *\r\n\t * @param duration  Default duration (ms)\r\n\t * @return Duration (ms)\r\n\t */\r\n\tpublic getDuration(duration?: number): $type.Optional<number> {\r\n\t\tif (!$type.isNumber(duration)) {\r\n\t\t\tlet component: $type.Optional<Component> = this.component;\r\n\t\t\tif (component) {\r\n\t\t\t\tduration = component.interpolationDuration;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (duration != null) {\r\n\t\t\tif (!this._adapterO) {\r\n\t\t\t\treturn duration;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn this._adapterO.apply(\"duration\", duration);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a numeric value for specific data field.\r\n\t *\r\n\t * If `calculated` is not set, it will return a raw value, as it is in\r\n\t * source data.\r\n\t *\r\n\t * If `calculated` is set, it will return a pre-calculated specific value.\r\n\t *\r\n\t * @param name        Data field name\r\n\t * @param calculated  A calculated value name\r\n\t * @return Value\r\n\t */\r\n\tpublic getValue(name: string, calculated?: CalculatedValue): $type.Optional<number> {\r\n\t\tif (name && this.component) {\r\n\t\t\tif (!calculated) {\r\n\t\t\t\tcalculated = (<any>this.component.dataFields)[name + \"Show\"];\r\n\t\t\t\tif (!calculated) {\r\n\t\t\t\t\tcalculated = \"value\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst value = this.values[name][calculated];\r\n\r\n\t\t\tif (this._adapterO && this._adapterO.isEnabled(\"value\")) {\r\n\t\t\t\treturn this._adapterO.apply(\"value\", {\r\n\t\t\t\t\tvalue: value,\r\n\t\t\t\t\tfield: name\r\n\t\t\t\t}).value;\r\n\r\n\t\t\t} else {\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a current working value for a specific data field.\r\n\t *\r\n\t * The actual value may differ from the one returned by `getValue()`. The\r\n\t * latter returns static values from the data source.\r\n\t *\r\n\t * `getWorkingValue()` returns current value, which is usually different if\r\n\t * Data Item is animating from one state to another.\r\n\t *\r\n\t * @param name        Data field name\r\n\t * @return Value\r\n\t */\r\n\tpublic getWorkingValue(name: string): $type.Optional<number> {\r\n\t\tif (name && this.component) {\r\n\t\t\tlet realName = (<any>this.component.dataFields)[name + \"Show\"];\r\n\r\n\t\t\tif (!realName) {\r\n\t\t\t\trealName = \"workingValue\";\r\n\t\t\t}\r\n\t\t\tif (this._adapterO) {\r\n\t\t\t\treturn this._adapterO.apply(\"workingValue\", {\r\n\t\t\t\t\tworkingValue: this.values[name][realName],\r\n\t\t\t\t\tfield: name\r\n\t\t\t\t}).workingValue;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn this.values[name][realName];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * @return Value\r\n\t */\r\n\tpublic getActualWorkingValue(name: string): $type.Optional<number> {\r\n\t\treturn this.values[name].workingValue;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Sets a numeric value for specific data field.\r\n\t *\r\n\t * @param name        Data field name\r\n\t * @param value       Value\r\n\t * @param calculated  Calculated data field name\r\n\t * @param duration    Duration (ms) to animate to new value to\r\n\t * @param delay       Delay animation (ms)\r\n\t */\r\n\tpublic setValue(name: string, value: number, duration?: number, delay?: number): void {\r\n\t\tlet currentValue: number = this.values[name].value;\r\n\t\tlet newDuration: $type.Optional<number> = this.getDuration(duration);\r\n\t\tvalue = $type.toNumber(value);\r\n\t\tif (currentValue !== value) {\r\n\t\t\tthis.values[name].value = value;\r\n\t\t\tif (this._eventDispatcher && !this.__disabled) {\r\n\t\t\t\tif (this.events.isEnabled(\"valuechanged\")) {\r\n\t\t\t\t\tconst event: AMEvent<this, IDataItemEvents>[\"valuechanged\"] = {\r\n\t\t\t\t\t\ttype: \"valuechanged\",\r\n\t\t\t\t\t\ttarget: this,\r\n\t\t\t\t\t\tproperty: name\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.events.dispatchImmediately(\"valuechanged\", event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.component) {\r\n\t\t\t\tthis.component.handleDataItemValueChange(this, name);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.setWorkingValue(name, value, newDuration, delay);\r\n\t}\r\n\r\n\tsetCalculatedValue(name: string, value: number, calculated: CalculatedValue): void {\r\n\t\tlet currentValue: number = this.values[name][calculated];\r\n\r\n\t\tif (currentValue !== value && $type.isNumber(value)) {\r\n\t\t\tthis.values[name][calculated] = value;\r\n\r\n\t\t\tif (this._eventDispatcher && !this.__disabled) {\r\n\t\t\t\tif (this.events.isEnabled(\"calculatedvaluechanged\")) {\r\n\t\t\t\t\tconst event: AMEvent<this, IDataItemEvents>[\"calculatedvaluechanged\"] = {\r\n\t\t\t\t\t\ttype: \"calculatedvaluechanged\",\r\n\t\t\t\t\t\ttarget: this,\r\n\t\t\t\t\t\tproperty: name\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.events.dispatchImmediately(\"calculatedvaluechanged\", event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.component) {\r\n\t\t\t\tthis.component.handleDataItemCalculatedValueChange(this, name);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Set current working numeric value for a specific data field.\r\n\t *\r\n\t * @param name        Data field name\r\n\t * @param value       Value\r\n\t * @param calculated  Calculated data field name\r\n\t * @param duration    Duration (ms) to animate to new value to\r\n\t * @param delay       Delay animation (ms)\r\n\t * @return An [[Animation]] object used for transition to new values\r\n\t */\r\n\tpublic setWorkingValue(name: string, value: number, duration?: number, delay?: number): $type.Optional<Animation> {\r\n\t\tif ($type.isNumber(this.values[name].value)) {\r\n\t\t\tlet newDuration: $type.Optional<number> = this.getDuration(duration);\r\n\r\n\t\t\tlet workingValue: number = this.values[name].workingValue;\r\n\r\n\t\t\tif (newDuration != null && newDuration > 0 && $type.isNumber(workingValue) && this.component) { // sometimes NaN is passed, so only change this to != null if all cases of NaN are handled, otherwise animation won't stop\r\n\r\n\t\t\t\tif (workingValue != value) {\r\n\t\t\t\t\tlet animation: Animation = this.animate({ childObject: this.values[name], property: \"workingValue\", from: workingValue, to: value, dummyData: name }, newDuration, this.component.interpolationEasing);\r\n\t\t\t\t\tif (delay != null) {\r\n\t\t\t\t\t\tanimation.delay(delay);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tanimation.events.on(\"animationstarted\", this.handleInterpolationProgress, this);\r\n\t\t\t\t\tanimation.events.on(\"animationprogress\", this.handleInterpolationProgress, this);\r\n\t\t\t\t\tanimation.events.on(\"animationended\", this.handleInterpolationProgress, this);\r\n\t\t\t\t\tthis._valueAnimations[name] = animation;\r\n\t\t\t\t\treturn animation;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlet valueAnimation = this._valueAnimations[name];\r\n\t\t\t\t\tif (valueAnimation) {\r\n\t\t\t\t\t\tvalueAnimation.stop();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.values[name].workingValue = value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\r\n\t\t\t\tlet valueAnimation = this._valueAnimations[name];\r\n\t\t\t\tif (valueAnimation) {\r\n\t\t\t\t\tvalueAnimation.stop();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.values[name].workingValue = value;\r\n\t\t\t\tif (this._eventDispatcher && !this.__disabled) {\r\n\t\t\t\t\tif (this.events.isEnabled(\"workingvaluechanged\")) {\r\n\t\t\t\t\t\tconst event: AMEvent<this, IDataItemEvents>[\"workingvaluechanged\"] = {\r\n\t\t\t\t\t\t\ttype: \"workingvaluechanged\",\r\n\t\t\t\t\t\t\ttarget: this,\r\n\t\t\t\t\t\t\tproperty: name\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.events.dispatchImmediately(\"workingvaluechanged\", event);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.component) {\r\n\t\t\t\t\tthis.component.handleDataItemWorkingValueChange(this, name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a relative location for a data field.\r\n\t *\r\n\t * A location is always relative on a 0 to 1 scale, with 0 being beginning,\r\n\t * 0.5 middle and 1 end.\r\n\t *\r\n\t * @todo Rewiew description\r\n\t * @param name      Data field name\r\n\t * @param value     Location (0-1)\r\n\t * @param duration  Duration (ms) to animate to new value to\r\n\t * @param delay     Delay animation (ms)\r\n\t */\r\n\tpublic setLocation(name: string, value: number, duration?: number, delay?: number) {\r\n\t\tlet currentLocation: number = this.locations[name];\r\n\r\n\t\tif (currentLocation !== value) {\r\n\t\t\tthis.locations[name] = value;\r\n\t\t\tif (this._eventDispatcher && !this.__disabled) {\r\n\t\t\t\tif (this.events.isEnabled(\"locationchanged\")) {\r\n\t\t\t\t\tconst event: AMEvent<this, IDataItemEvents>[\"locationchanged\"] = {\r\n\t\t\t\t\t\ttype: \"locationchanged\",\r\n\t\t\t\t\t\ttarget: this,\r\n\t\t\t\t\t\tproperty: name\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.events.dispatchImmediately(\"locationchanged\", event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.component) {\r\n\t\t\t\tthis.component.handleDataItemValueChange(this, name); // correct\r\n\t\t\t}\r\n\r\n\t\t\tthis.setWorkingLocation(name, value, duration, delay);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a current working location for a data field.\r\n\t *\r\n\t * @todo Rewiew description\r\n\t * @param name      Data field name\r\n\t * @param value     Location (0-1)\r\n\t * @param duration  Duration (ms) to animate to new value to\r\n\t * @param delay     Delay animation (ms)\r\n\t */\r\n\tpublic setWorkingLocation(name: string, value: number, duration?: number, delay?: number): $type.Optional<Animation> {\r\n\t\tlet newDuration: $type.Optional<number> = this.getDuration(duration);\r\n\t\tlet workingLocation: number = this.workingLocations[name];\r\n\r\n\t\tif (newDuration != null && newDuration > 0 && $type.isNumber(workingLocation) && this.component) { // sometimes NaN is passed, so only change this to != null if all cases of NaN are handled, otherwise animation won't stop\r\n\t\t\tif (workingLocation != value) {\r\n\t\t\t\tlet animation: Animation = this.animate({ childObject: this.workingLocations, property: name, from: workingLocation, to: value, dummyData: name }, newDuration, this.component.interpolationEasing);\r\n\t\t\t\tif (delay != null) {\r\n\t\t\t\t\tanimation.delay(delay);\r\n\t\t\t\t}\r\n\t\t\t\tanimation.events.on(\"animationstarted\", this.handleInterpolationProgress, this);\r\n\t\t\t\tanimation.events.on(\"animationprogress\", this.handleInterpolationProgress, this);\r\n\t\t\t\tanimation.events.on(\"animationended\", this.handleInterpolationProgress, this);\r\n\t\t\t\tthis._locationAnimations[name] = animation;\r\n\t\t\t\treturn animation;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet locationAnimation = this._locationAnimations[name];\r\n\t\t\t\tif (locationAnimation) {\r\n\t\t\t\t\tlocationAnimation.stop();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.workingLocations[name] = value;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet locationAnimation = this._locationAnimations[name];\r\n\t\t\tif (locationAnimation) {\r\n\t\t\t\tlocationAnimation.stop();\r\n\t\t\t}\r\n\r\n\t\t\tthis.workingLocations[name] = value;\r\n\r\n\t\t\tif (this._eventDispatcher && !this.__disabled) {\r\n\t\t\t\tif (this.events.isEnabled(\"workinglocationchanged\")) {\r\n\t\t\t\t\tconst event: AMEvent<this, IDataItemEvents>[\"workinglocationchanged\"] = {\r\n\t\t\t\t\t\ttype: \"workinglocationchanged\",\r\n\t\t\t\t\t\ttarget: this,\r\n\t\t\t\t\t\tproperty: name\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.events.dispatchImmediately(\"workinglocationchanged\", event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.component) {\r\n\t\t\t\tthis.component.handleDataItemWorkingLocationChange(this, name);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Sets Date value to a data field.\r\n\t *\r\n\t * @param name      Data field name\r\n\t * @param date      Date object\r\n\t * @param duration  Duration (ms) to animate to new value to\r\n\t */\r\n\tpublic setDate(name: string, date: Date, duration?: number) {\r\n\r\n\t\tif (!$type.isDate(date) && this.component) {\r\n\t\t\tdate = this.component.dateFormatter.parse(date);\r\n\t\t}\r\n\r\n\t\tlet currentDate: Date = this.dates[name];\r\n\t\tif (currentDate !== date) {\r\n\t\t\tthis.dates[name] = date;\r\n\t\t\tthis.setValue(name, date.getTime(), duration);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a Date value of the data field.\r\n\t *\r\n\t * @param name  Data field name\r\n\t * @return Date object\r\n\t */\r\n\tpublic getDate(name: string): Date {\r\n\t\tif (this._adapterO) {\r\n\t\t\treturn this._adapterO.apply(\"date\", {\r\n\t\t\t\tdate: this.dates[name],\r\n\t\t\t\tfield: name\r\n\t\t\t}).date;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this.dates[name];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a Data Item-specific visual properties to apply to related elements.\r\n\t *\r\n\t * @param name   Property name\r\n\t * @param value  Property value\r\n\t */\r\n\tpublic setProperty(name: string, value: any) {\r\n\t\tif (this.properties[name] !== value) {\r\n\t\t\tthis.hasProperties = true;\r\n\t\t\tthis.properties[name] = value;\r\n\t\t\tif (this._eventDispatcher && !this.__disabled) {\r\n\t\t\t\tif (this.events.isEnabled(\"propertychanged\")) {\r\n\t\t\t\t\tconst event: AMEvent<this, IDataItemEvents>[\"propertychanged\"] = {\r\n\t\t\t\t\t\ttype: \"propertychanged\",\r\n\t\t\t\t\t\ttarget: this,\r\n\t\t\t\t\t\tproperty: name,\r\n\t\t\t\t\t\tvalue: value\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.events.dispatchImmediately(\"propertychanged\", event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.component) {\r\n\t\t\t\tthis.component.handleDataItemPropertyChange(this, name);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a related category for this Data Item.\r\n\t *\r\n\t * @todo Review description\r\n\t * @param name   Data field name\r\n\t * @param value  Category\r\n\t */\r\n\tpublic setCategory(name: string, value: string) {\r\n\t\tif (!$type.isString(value)) {\r\n\t\t\tvalue = $type.castString(value);\r\n\t\t}\r\n\r\n\t\tif (this.categories[name] !== value) {\r\n\t\t\tthis.categories[name] = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Clones the Data Item, including all related data.\r\n\t *\r\n\t * @return New Data Item clone\r\n\t */\r\n\t//public clone(cloneId?: string): this {\r\n\t//\tlet dataItem: this = super.clone(cloneId);\r\n\t//\tdataItem.copyFrom(this);\r\n\t//\treturn dataItem;\r\n\t//}\r\n\r\n\t/**\r\n\t * Copies all properties and related data from different data item.\r\n\t *\r\n\t * @param object Source data item\r\n\t */\r\n\tpublic copyFrom(source: this) {\r\n\r\n\t\tsuper.copyFrom(source);\r\n\r\n\t\tif (source.dataContext) {\r\n\t\t\tthis.dataContext = $utils.copy(source.dataContext, {});\r\n\t\t}\r\n\r\n\t\t$utils.copyProperties(source.locations, this.locations);\r\n\t\t/*\r\n\t\t$utils.copyProperties(source.properties, this.properties);\r\n\t\t$utils.copyProperties(source.categories, this.categories);\r\n\t\t$utils.copyProperties(source.values, this.values);\r\n\t\t$utils.copyProperties(source.dates, this.dates);\r\n\r\n\t\t$object.each(source.values, (name, value) => {\r\n\t\t\tthis.values[name] = $object.copy(value);\r\n\t\t});*/\r\n\t\tif (source._adapterO) {\r\n\t\t\tthis.adapter.copyFrom(source._adapterO);\r\n\t\t}\r\n\t\t//this.events.copyFrom(source.events); // because copied in Base\r\n\t\tthis.component = source.component;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets opacity for all Data Item's related elements (Sprites).\r\n\t *\r\n\t * @param value Opacity (0-1)\r\n\t */\r\n\tpublic set opacity(value: number) {\r\n\t\t$array.each(this.sprites, (sprite) => {\r\n\t\t\tsprite.opacity = value;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Sets whether this data point should not be included in the scale and\r\n\t * minimum/maximum calculations.\r\n\t *\r\n\t * E.g. some we may want to exclude a particular data point from influencing\r\n\t * [[ValueAxis]] scale.\r\n\t *\r\n\t * @param value  Exclude from min/max calculations?\r\n\t */\r\n\tpublic set ignoreMinMax(value: boolean) {\r\n\t\tthis._ignoreMinMax = value;\r\n\t\tif (this._eventDispatcher && !this.__disabled) {\r\n\t\t\tif (this.events.isEnabled(\"propertychanged\")) {\r\n\t\t\t\tconst event: AMEvent<this, IDataItemEvents>[\"propertychanged\"] = {\r\n\t\t\t\t\ttype: \"propertychanged\",\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\tproperty: \"ignoreMinMax\",\r\n\t\t\t\t\tvalue: value\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"propertychanged\", event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.component) {\r\n\t\t\tthis.component.handleDataItemPropertyChange(this, \"ignoreMinMax\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Exclude from min/max calculations?\r\n\t * @return Exclude from min/max calculations?\r\n\t */\r\n\tpublic get ignoreMinMax(): boolean {\r\n\t\treturn this._ignoreMinMax;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates and starts an [[Animation]] to interpolate (morph) Data Item's\r\n\t * properties and/or values.\r\n\t *\r\n\t * @see {@link Animation}\r\n\t * @param animationOptions  Animation options\r\n\t * @param duration          Animation duration (ms)\r\n\t * @param easing            Easing function\r\n\t * @return Animation\r\n\t */\r\n\tpublic animate(animationOptions: IAnimationOptions[] | IAnimationOptions, duration: number, easing?: (value: number) => number): Animation {\r\n\t\treturn new Animation(this, animationOptions, duration, easing).start();\r\n\t}\r\n\r\n\t/**\r\n\t * Handles intermediate steps when Data Item is interpolating (morphing) from\r\n\t * one value to another.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param event Event object\r\n\t */\r\n\tpublic handleInterpolationProgress(event: AMEvent<Animation, IAnimationEvents>[\"animationstarted\" | \"animationended\" | \"animationprogress\"]) {\r\n\t\tlet animation: Animation = event.target;\r\n\r\n\t\t// it's always only one options, no need cycle\r\n\t\tlet animationOptions: IAnimationOptions = animation.animationOptions[0];\r\n\t\tif (animationOptions) {\r\n\t\t\tif (this._eventDispatcher && !this.__disabled) {\r\n\t\t\t\tif (this.events.isEnabled(\"workingvaluechanged\")) {\r\n\t\t\t\t\tconst event: AMEvent<this, IDataItemEvents>[\"workingvaluechanged\"] = {\r\n\t\t\t\t\t\ttype: \"workingvaluechanged\",\r\n\t\t\t\t\t\ttarget: this,\r\n\t\t\t\t\t\tproperty: animationOptions.dummyData\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tthis.events.dispatchImmediately(\"workingvaluechanged\", event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.component) {\r\n\t\t\t\tthis.component.handleDataItemWorkingValueChange(this, animationOptions.dummyData);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether Data Item has values set for all of the data fields,\r\n\t * supplied via argument.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param fields  Field list to check\r\n\t * @return Has values for all fields?\r\n\t */\r\n\tpublic hasValue(fields: string[]): boolean {\r\n\t\t// todo: what about categories?\r\n\t\tfor (let i = 0, len = fields.length; i < len; i++) {\r\n\t\t\tlet values = this.values[fields[i]];\r\n\t\t\tif (!values || !$type.hasValue(values.value)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Depth of the Data Item.\r\n\t *\r\n\t * In nested data structures, like TreeMap, this indicates the level this\r\n\t * data point is at, in relation to the parent Data Item.\r\n\t *\r\n\t * @return Depth\r\n\t */\r\n\tpublic get depth(): number {\r\n\t\tif (!this.parent) {\r\n\t\t\treturn 0;\r\n\r\n\t\t} else {\r\n\t\t\treturn this.parent.depth + 1;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets to a reference to an original object from Component's data.\r\n\t *\r\n\t * @return [description]\r\n\t */\r\n\tpublic get dataContext(): Object {\r\n\t\treturn this._dataContext;\r\n\t}\r\n\r\n\t/**\r\n\t * A reference to an original object in Component's data, that this Data Item\r\n\t * is derived from.\r\n\t *\r\n\t * @param value Original data object\r\n\t */\r\n\tpublic set dataContext(value: Object) {\r\n\t\tthis._dataContext = value;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * adds a sprite to dataItem.sprites array\r\n\t * @ignore\r\n\t */\r\n\taddSprite(sprite: Sprite) {\r\n\t\tif (sprite.dataItem && sprite.dataItem != this) {\r\n\t\t\t$array.remove(sprite.dataItem.sprites, sprite);\r\n\t\t}\r\n\t\tif (!this.visible) {\r\n\t\t\tsprite.hide(0);\r\n\t\t}\r\n\r\n\t\tif (this.isHiding) {\r\n\t\t\tsprite.hide();\r\n\t\t}\r\n\t\tthis.sprites.push(sprite);\r\n\t\tsprite.dataItem = this;\r\n\t}\r\n}\r\n","/**\r\n * Pattern module.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObject } from \"../../Base\";\r\nimport { Group } from \"../Group\";\r\nimport { AMElement } from \"../AMElement\";\r\nimport { Paper, getGhostPaper } from \"../Paper\";\r\nimport { ShapeRendering } from \"../../defs/ShapeRendering\";\r\nimport { List, ListDisposer } from \"../../utils/List\";\r\nimport { Animation, IAnimatable, IAnimationOptions, AnimationDisposer } from \"../../utils/Animation\";\r\nimport { registry } from \"../../Registry\";\r\nimport { Color } from \"../../utils/Color\";\r\nimport { InterfaceColorSet } from \"../../utils/InterfaceColorSet\";\r\nimport * as $iter from \"../../utils/Iterator\";\r\nimport * as $object from \"../../utils/Object\";\r\nimport * as $type from \"../../utils/Type\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines available units to measure patterns.\r\n */\r\nexport type PatternUnits = \"userSpaceOnUse\" | \"objectBoundingBox\";\r\n\r\n/**\r\n * Defines properties for [[Pattern]].\r\n */\r\nexport interface PatternProperties {\r\n\tx: number;\r\n\ty: number;\r\n\twidth: number;\r\n\theight: number;\r\n\tbackgroundOpacity: number;\r\n\tbackgroundFill: Color;\r\n\tfillOpacity: number;\r\n\tfill: Color;\r\n\tstroke: Color;\r\n\tstrokeOpacity: number;\r\n\tstrokeWidth: number;\r\n\tshapeRendering: ShapeRendering;\r\n\trotation: number;\r\n\trotationX: number;\r\n\trotationY: number;\r\n\tpatternUnits: PatternUnits;\r\n\tstrokeDashArray:string;\r\n};\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Base class to define patterns.\r\n */\r\nexport class Pattern extends BaseObject implements IAnimatable {\r\n\r\n\t/**\r\n\t * List of available animations currently running on a pattern.\r\n\t */\r\n\tprotected _animations: $type.Optional<Array<Animation>>;\r\n\r\n\t/**\r\n\t * An SVG `<group>` element to put sub-elements into.\r\n\t */\r\n\tpublic element: Group;\r\n\r\n\t/**\r\n\t * Reference to [[Paper]] instance.\r\n\t */\r\n\tprotected _paper: $type.Optional<Paper>;\r\n\r\n\t/**\r\n\t * List of elements the pattern consists of.\r\n\t */\r\n\tprotected _elements: List<AMElement> = new List<AMElement>();\r\n\r\n\t/**\r\n\t * Defines property types.\r\n\t */\r\n\tpublic _properties!: PatternProperties;\r\n\r\n\t/**\r\n\t * A storage for Filter property/value pairs.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @see {@link PatternProperties}\r\n\t */\r\n\tpublic properties: this[\"_properties\"] = <any>{};\r\n\t//public propertyValues = new Dictionary<PatternProperties, any>();\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"Pattern\";\r\n\r\n\t\t// Set defaults\r\n\t\tthis.width = 10;\r\n\t\tthis.height = 10;\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\t\tthis.patternUnits = \"userSpaceOnUse\";\r\n\r\n\t\tlet interfaceColors = new InterfaceColorSet();\r\n\r\n\t\tthis.backgroundFill = interfaceColors.getFor(\"background\");\r\n\t\tthis.backgroundOpacity = 0;\r\n\r\n\t\tthis.fillOpacity = 1;\r\n\t\tthis.fill = interfaceColors.getFor(\"alternativeBackground\");\r\n\t\tthis.stroke = interfaceColors.getFor(\"alternativeBackground\");\r\n\t\tthis.strokeOpacity = 1;\r\n\t\tthis.strokeWidth = 1;\r\n\t\tthis.shapeRendering = \"crispEdges\";\r\n\t\tthis.rotation = 0;\r\n\r\n\t\t// Create main group to store pattern elements inelements\r\n\t\tthis.element = this.paper.addGroup(\"pattern\");\r\n\t\tthis.id = \"pattern-\" + registry.getUniqueId();\r\n\t\tthis.element.attr({ \"id\": this.id });\r\n\t\tthis._disposers.push(this.element);\r\n\r\n\t\t// Make elements disposable\r\n\t\tthis._disposers.push(new ListDisposer(this._elements));\r\n\r\n\t\t// Request again to trigger getter/setter code\r\n\t\tthis.patternUnits = this.patternUnits;\r\n\t\tthis.width = this.width;\r\n\t\tthis.height = this.height;\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the pattern.\r\n\t */\r\n\tprotected draw(): void {\r\n\r\n\t\tlet patternElement: Group = this.element;\r\n\t\tif (patternElement) {\r\n\r\n\t\t\tpatternElement.removeChildNodes();\r\n\r\n\t\t\tlet background = this.paper.add(\"rect\");\r\n\t\t\tbackground.attr({ \"width\": this.width, \"height\": this.height, \"shape-rendering\": \"crispEdges\", \"fill\": this.backgroundFill.hex, \"fill-opacity\": this.backgroundOpacity, \"stroke\": this.backgroundFill.hex, \"stroke-opacity\": 0 });\r\n\t\t\tpatternElement.add(background);\r\n\r\n\t\t\tpatternElement.attr({ \"x\": this.x, \"y\": this.y, \"width\": this.width, \"height\": this.height, \"stroke\": this.stroke.hex, \"fill\": this.fill.hex, \"fill-opacity\": this.fillOpacity, \"stroke-opacity\": this.strokeOpacity, \"stroke-width\": this.strokeWidth, \"shape-rendering\": this.shapeRendering, \"patternUnits\": this.patternUnits, \"stroke-dasharray\":this.strokeDasharray });\r\n\r\n\t\t\t$iter.each(this._elements.iterator(), (element) => {\r\n\t\t\t\telement.rotation = this.rotation;\r\n\t\t\t\telement.rotationX = this.properties[\"rotationX\"];\r\n\t\t\t\telement.rotationY = this.properties[\"rotationY\"];\r\n\t\t\t\tthis.element.add(element);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Animate pattern properties.\r\n\t *\r\n\t * @see {@link Animation}\r\n\t * @param animationOptions  Animation options\r\n\t * @param duration          Duration (ms)\r\n\t * @param easing            Easing function\r\n\t * @return Animation instance\r\n\t */\r\n\tpublic animate(animationOptions: IAnimationOptions[] | IAnimationOptions, duration: number, easing?: (value: number) => number): Animation {\r\n\t\treturn new Animation(this, animationOptions, duration, easing).start();\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an element to the pattern.\r\n\t *\r\n\t * @param element  Element\r\n\t */\r\n\tpublic addElement(element: AMElement): void {\r\n\t\tthis._elements.push(element);\r\n\t\tthis._disposers.push(element);\r\n\t}\r\n\r\n\t/**\r\n\t * Remove an element from the pattern.\r\n\t *\r\n\t * @param element  Element\r\n\t */\r\n\tpublic removeElement(element: AMElement): void {\r\n\t\tthis._elements.removeValue(element);\r\n\t\tthis.removeDispose(element);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the list of SVG elements comprising the pattern.\r\n\t *\r\n\t * @return Pattern elements\r\n\t */\r\n\tpublic get elements(): List<AMElement> {\r\n\t\treturn this._elements;\r\n\t}\r\n\r\n\t/**\r\n\t * Pattern fill opacity. (0-1)\r\n\t *\r\n\t * @param value  Opacity (0-1)\r\n\t */\r\n\tpublic set fillOpacity(value: number) {\r\n\t\tthis.properties[\"fillOpacity\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Opacity (0-1)\r\n\t */\r\n\tpublic get fillOpacity(): number {\r\n\t\treturn this.properties[\"fillOpacity\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Fill color of the pattern.\r\n\t *\r\n\t * @param value  Fill color\r\n\t */\r\n\tpublic set fill(value: Color) {\r\n\t\tthis.properties[\"fill\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Fill color\r\n\t */\r\n\tpublic get fill(): Color {\r\n\t\treturn this.properties[\"fill\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Pattern background fill color.\r\n\t *\r\n\t * @param value  Background color\r\n\t */\r\n\tpublic set backgroundFill(value: Color) {\r\n\t\tthis.properties[\"backgroundFill\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Background color\r\n\t */\r\n\tpublic get backgroundFill(): Color {\r\n\t\treturn this.properties[\"backgroundFill\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Pattern backgorund opacity. (0-1)\r\n\t *\r\n\t * @param value  Background opacity (0-1)\r\n\t */\r\n\tpublic set backgroundOpacity(value: number) {\r\n\t\tthis.properties[\"backgroundOpacity\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Background opacity (0-1)\r\n\t */\r\n\tpublic get backgroundOpacity(): number {\r\n\t\treturn this.properties[\"backgroundOpacity\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Pattern stroke (border) color.\r\n\t *\r\n\t * @param value  Color\r\n\t */\r\n\tpublic set stroke(value: Color) {\r\n\t\tthis.properties[\"stroke\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Color\r\n\t */\r\n\tpublic get stroke(): Color {\r\n\t\treturn this.properties[\"stroke\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Pattern stroke opacity. (0-1)\r\n\t *\r\n\t * @param value  Opacity (0-1)\r\n\t */\r\n\tpublic set strokeOpacity(value: number) {\r\n\t\tthis.properties[\"strokeOpacity\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Opacity (0-1)\r\n\t */\r\n\tpublic get strokeOpacity(): number {\r\n\t\treturn this.properties[\"strokeOpacity\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Pattern stroke thickness in pixels.\r\n\t *\r\n\t * @param value  Stroke thickness (px)\r\n\t */\r\n\tpublic set strokeWidth(value: number) {\r\n\t\tthis.properties[\"strokeWidth\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Stroke thickness (px)\r\n\t */\r\n\tpublic get strokeWidth(): number {\r\n\t\treturn this.properties[\"strokeWidth\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Shape rendering\r\n\t * @param value [description]\r\n\t */\r\n\tpublic set shapeRendering(value: ShapeRendering) {\r\n\t\tthis.properties[\"shapeRendering\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\tpublic get shapeRendering(): ShapeRendering {\r\n\t\treturn this.properties[\"shapeRendering\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Pattern rotation in degrees.\r\n\t *\r\n\t * @param value  Rotation\r\n\t */\r\n\tpublic set rotation(value: number) {\r\n\t\tthis.properties[\"rotation\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Rotation\r\n\t */\r\n\tpublic get rotation(): number {\r\n\t\treturn this.properties[\"rotation\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Pattern measuring units.\r\n\t *\r\n\t * Available options: \"userSpaceOnUse\" | \"objectBoundingBox\".\r\n\t *\r\n\t * @param value  Units\r\n\t */\r\n\tpublic set patternUnits(value: \"userSpaceOnUse\" | \"objectBoundingBox\") {\r\n\t\tthis.properties[\"patternUnits\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Units\r\n\t */\r\n\tpublic get patternUnits(): \"userSpaceOnUse\" | \"objectBoundingBox\" {\r\n\t\treturn this.properties[\"patternUnits\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Pattern width in pixels.\r\n\t *\r\n\t * @param value  Width (px)\r\n\t */\r\n\tpublic set width(value: number) {\r\n\t\tthis.properties[\"width\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Width (px)\r\n\t */\r\n\tpublic get width(): number {\r\n\t\treturn this.properties[\"width\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Pattern height in pixels.\r\n\t *\r\n\t * @param value Height (px)\r\n\t */\r\n\tpublic set height(value: number) {\r\n\t\tthis.properties[\"height\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Height (px)\r\n\t */\r\n\tpublic get height(): number {\r\n\t\treturn this.properties[\"height\"];\r\n\t}\r\n\r\n\t/**\r\n\t * X position. (pixels)\r\n\t *\r\n\t * @param value X (px)\r\n\t */\r\n\tpublic set x(value: number) {\r\n\t\tthis.properties[\"x\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return X (px)\r\n\t */\r\n\tpublic get x(): number {\r\n\t\treturn this.properties[\"x\"];\r\n\t}\r\n\r\n\t/**\r\n\t * Y position (px).\r\n\t *\r\n\t * @param value Y (px)\r\n\t */\r\n\tpublic set y(value: number) {\r\n\t\tthis.properties[\"y\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Y (px)\r\n\t */\r\n\tpublic get y(): number {\r\n\t\treturn this.properties[\"y\"];\r\n\t}\r\n\r\n\t/**\r\n\t * [[Paper]] instance to draw pattern in.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param paper  Paper\r\n\t */\r\n\tpublic set paper(paper: Paper) {\r\n\t\tif (this._paper != paper) {\r\n\t\t\tthis._paper = paper;\r\n\t\t\tthis.draw();\r\n\t\t\tpaper.appendDef(this.element);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Paper\r\n\t */\r\n\tpublic get paper(): Paper {\r\n\t\tif (this._paper) {\r\n\t\t\treturn this._paper;\r\n\t\t}\r\n\t\treturn getGhostPaper();\r\n\t}\r\n\r\n\t/**\r\n\t * Copies properties from another Pattern instance.\r\n\t *\r\n\t * @param source  Source pattern\r\n\t */\r\n\tpublic copyFrom(source: this) {\r\n\t\tsuper.copyFrom(source);\r\n\t\t$object.each(source.properties, (key, value) => {\r\n\t\t\t(<any>this)[key] = value;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * A list of animations currently running on the patter.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Animation list\r\n\t */\r\n\tpublic get animations(): Array<Animation> {\r\n\t\tif (!this._animations) {\r\n\t\t\tthis._animations = [];\r\n\t\t\tthis._disposers.push(new AnimationDisposer(this._animations));\r\n\t\t}\r\n\t\treturn this._animations;\r\n\t}\r\n\r\n\t/**\r\n\t * A `stroke-dasharray` for the stroke (outline).\r\n\t *\r\n\t * \"Dasharray\" allows setting rules to make lines dashed, dotted, etc.\r\n\t *\r\n\t * @see {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-dasharray} for more info on `stroke-dasharray`\r\n\t * @param value  `stroke-dasharray`\r\n\t */\r\n\tpublic set strokeDasharray(value: string) {\r\n\t\tthis.properties[\"strokeDashArray\"] = value;\r\n\t\tthis.draw();\r\n\t}\r\n\r\n\t/**\r\n\t * @return `stroke-dasharray`\r\n\t */\r\n\tpublic get strokeDasharray(): string {\r\n\t\treturn this.properties[\"strokeDashArray\"];\r\n\t}\t\t\r\n\r\n\r\n\t/**\r\n\t * Processes JSON-based config before it is applied to the object.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param config  Config\r\n\t */\r\n\tpublic processConfig(config?: { [index: string]: any }): void {\r\n\r\n\t\tif (config) {\r\n\r\n\t\t\t// Set up series\r\n\t\t\tif ($type.hasValue(config.elements) && $type.isArray(config.elements)) {\r\n\t\t\t\tfor (let i = 0, len = config.elements.length; i < len; i++) {\r\n\t\t\t\t\tlet element = config.elements[i];\r\n\t\t\t\t\tif ($type.hasValue(element[\"type\"])) {\r\n\t\t\t\t\t\tlet sprite = this.createEntryInstance(element);\r\n\t\t\t\t\t\tif (sprite instanceof BaseObject) {\r\n\t\t\t\t\t\t\tsprite.config = element;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.addElement(\r\n\t\t\t\t\t\t\t$type.hasValue(element[\"typeProperty\"])\r\n\t\t\t\t\t\t\t? sprite[element[\"typeProperty\"]]\r\n\t\t\t\t\t\t\t: sprite.element\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tsuper.processConfig(config);\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Pattern\"] = Pattern;\r\n","/**\r\n * Handles date and time formatting\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite } from \"../Sprite\";\r\nimport { Language, ILocaleProperties } from \"../utils/Language\";\r\nimport { BaseObject } from \"../Base\";\r\nimport { ITextChunk, getTextFormatter } from \"../formatters/TextFormatter\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $strings from \"../utils/Strings\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $time from \"../utils/Time\";\r\n\r\n/**\r\n * Interface describing parsed date format definition.\r\n */\r\nexport interface DateFormatInfo {\r\n\t\"template\": string;\r\n\t\"parts\": any[];\r\n}\r\n\r\n/**\r\n * Month names.\r\n */\r\nexport type MonthNames = \"January\" | \"February\" | \"March\" | \"April\" | \"May\" | \"June\" | \"July\" | \"August\" | \"September\" | \"October\" | \"November\" | \"December\";\r\n\r\n/**\r\n * Short month names.\r\n *\r\n * @param {string}\r\n */\r\nexport type ShortMonthNames = \"Jan\" | \"Feb\" | \"Mar\" | \"Apr\" | \"May(short)\" | \"Jun\" | \"Jul\" | \"Aug\" | \"Sep\" | \"Oct\" | \"Nov\" | \"Dec\";\r\n\r\n/**\r\n * Weekedays.\r\n */\r\nexport type Weekdays = \"Sunday\" | \"Monday\" | \"Tuesday\" | \"Wednesday\" | \"Thursday\" | \"Friday\" | \"Saturday\";\r\n\r\n/**\r\n * Short weekday names.\r\n */\r\nexport type ShortWeekdays = \"Sun\" | \"Mon\" | \"Tue\" | \"Wed\" | \"Thu\" | \"Fri\" | \"Sat\";\r\n\r\n/**\r\n * Handles date and time formatting.\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-date-time/} Tutorial on date/time formatting\r\n * @todo Better type casting of passed in date?\r\n * @todo Quarter support?\r\n * @todo When parsing named months make the search case-insensitive\r\n * @todo Escape a.m./p.m. properly when used in RegEx\r\n */\r\nexport class DateFormatter extends BaseObject {\r\n\r\n\t/**\r\n\t * Date format.\r\n\t */\r\n\tprotected _dateFormat: string | Intl.DateTimeFormatOptions = \"yyyy-MM-dd\";\r\n\r\n\t/**\r\n\t * Locales to use when formatting using Intl.DateFormatter\r\n\t */\r\n\tprotected _intlLocales: string;\r\n\r\n\t/**\r\n\t * Input date format.\r\n\t */\r\n\tprotected _inputDateFormat: string = \"yyyy-MM-dd\";\r\n\r\n\t/**\r\n\t * Assume UTC time zone.\r\n\t */\r\n\tprotected _utc: boolean = false;\r\n\r\n\t/**\r\n\t * Timezone offset.\r\n\t */\r\n\tprotected _timezoneOffset: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * Timezone.\r\n\t */\r\n\tprotected _timezone: $type.Optional<string>;\r\n\r\n\t/**\r\n\t * If `timezone` is set, this will hold minute fraction of the timezone.\r\n\t * \r\n\t * @readonly\r\n\t * @ignore\r\n\t */\r\n\tpublic timezoneMinutes: number = 0;\r\n\r\n\t/**\r\n\t * First day of week.\r\n\t *\r\n\t * 0 - Sunday\r\n\t * 1 - Monday\r\n\t *\r\n\t * Etc.\r\n\t */\r\n\tprotected _firstDayOfWeek: number = 1;\r\n\r\n\t/**\r\n\t * A list of month names.\r\n\t */\r\n\tpublic months: Array<MonthNames> = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\r\n\r\n\t/**\r\n\t * A list of short month names.\r\n\t */\r\n\tpublic monthsShort: Array<ShortMonthNames> = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May(short)\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\r\n\r\n\t/**\r\n\t * A list of weekday names.\r\n\t */\r\n\tpublic weekdays: Array<Weekdays> = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\r\n\r\n\t/**\r\n\t * A list of short weekday names.\r\n\t */\r\n\tpublic weekdaysShort: Array<ShortWeekdays> = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\r\n\r\n\t/**\r\n\t * Output format to produce. If the format calls for applying color to the\r\n\t * formatted value, this setting will determine what markup to use: SVG or\r\n\t * HTML.\r\n\t *\r\n\t * Available options: svg, html.\r\n\t *\r\n\t * @default \"svg\"\r\n\t */\r\n\tprotected _outputFormat: string = \"svg\";\r\n\r\n\t/**\r\n\t * Holds reference to parent [[Sprite]] object.\r\n\t */\r\n\tpublic sprite: $type.Optional<Sprite>;\r\n\r\n\t/**\r\n\t * Holds reference to [[Language]] object.\r\n\t */\r\n\tpublic _language: $type.Optional<Language>;\r\n\r\n\t/**\r\n\t * Should the first letter of the formatted date be capitalized?\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tpublic capitalize: boolean = true;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"DateFormatter\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * A reference to [[Language]] object.\r\n\t *\r\n\t * @param  value  Language\r\n\t */\r\n\tpublic set language(value: $type.Optional<Language>) {\r\n\t\tthis._language = value;\r\n\t\tthis.dateFormat = this._language.translate(\"_date\");\r\n\t}\r\n\r\n\t/**\r\n\t * @return Language\r\n\t */\r\n\tpublic get language(): $type.Optional<Language> {\r\n\t\treturn this._language;\r\n\t}\r\n\r\n\t/**\r\n\t * Formats the date value according to specified format.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-date-time/} Tutorial on date/time formatting\r\n\t * @param source  Date value\r\n\t * @param format  Format\r\n\t * @return Formatted date string\r\n\t */\r\n\tpublic format(source: any, format?: string | Intl.DateTimeFormatOptions, applyTimezone?: boolean): string {\r\n\r\n\t\t// No language?\r\n\t\tif (!this.language) {\r\n\t\t\tif (this.sprite) {\r\n\t\t\t\tthis.language = this.sprite.language;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.language = new Language();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// No format passed in or it's empty\r\n\t\tif (typeof format === \"undefined\" || format === \"\") {\r\n\t\t\tformat = this._dateFormat;\r\n\t\t}\r\n\r\n\t\t// Init return value\r\n\t\tlet formatted;\r\n\r\n\t\t// Do casting if required\r\n\t\t// This will take care of timestamps as well as Date objects\r\n\t\tlet date: Date;\r\n\t\tif ($type.isString(source)) {\r\n\t\t\t// If it's a string, let's try parsing it using our own functionality\r\n\t\t\tdate = this.parse(source);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdate = $utils.anyToDate(source);\r\n\t\t}\r\n\r\n\t\t// Is it a built-in format or Intl.DateTimeFormat\r\n\t\tif ($type.isObject(format)) {\r\n\r\n\t\t\ttry {\r\n\t\t\t\tif (this.intlLocales) {\r\n\t\t\t\t\treturn new Intl.DateTimeFormat(this.intlLocales, <Intl.DateTimeFormatOptions>format).format(date);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn new Intl.DateTimeFormat(undefined, <Intl.DateTimeFormatOptions>format).format(date);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\treturn \"Invalid\";\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\t// Clean format\r\n\t\t\tformat = $utils.cleanFormat(format);\r\n\r\n\t\t\t// get format info (it will also deal with parser caching)\r\n\t\t\tlet info = this.parseFormat(format);\r\n\r\n\t\t\t// Should we apply custom time zone?\r\n\t\t\tif ($type.hasValue(this.timezoneOffset)) {\r\n\t\t\t\tdate.setMinutes(date.getMinutes() + date.getTimezoneOffset() - this.timezoneOffset);\r\n\t\t\t}\r\n\t\t\telse if ($type.hasValue(this.timezone) && applyTimezone !== false) {\r\n\t\t\t\tdate = $time.setTimezone(date, this.timezone);\r\n\t\t\t}\r\n\r\n\t\t\t// Check if it's a valid date\r\n\t\t\tif (!$type.isNumber(date.getTime())) {\r\n\t\t\t\treturn this.language.translate(\"Invalid date\");\r\n\t\t\t}\r\n\r\n\t\t\t// Apply format\r\n\t\t\tformatted = this.applyFormat(date, info, this.language);\r\n\r\n\t\t\t// Capitalize\r\n\t\t\tif (this.capitalize) {\r\n\t\t\t\tformatted = formatted.replace(\r\n\t\t\t\t\t/^.{1}/, formatted.substr(0, 1).toUpperCase()\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// We're done\r\n\t\treturn formatted;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses format into structured infromation.\r\n\t *\r\n\t * @param format Format template\r\n\t */\r\n\tprotected parseFormat(format: string): DateFormatInfo {\r\n\r\n\t\t// Check cache\r\n\t\tlet cached = this.getCache(format);\r\n\t\tif ($type.hasValue(cached)) {\r\n\t\t\treturn cached;\r\n\t\t}\r\n\r\n\t\t// Init format parse info holder\r\n\t\tlet info: DateFormatInfo = {\r\n\t\t\t\"template\": \"\",\r\n\t\t\t\"parts\": <any>[]\r\n\t\t};\r\n\r\n\t\t// Let TextFormatter split into chunks\r\n\t\tlet chunks: ITextChunk[] = getTextFormatter().chunk(format, true);\r\n\t\tfor (let i: number = 0; i < chunks.length; i++) {\r\n\t\t\tlet chunk: ITextChunk = chunks[i];\r\n\r\n\t\t\tif (chunk.type === \"value\") {\r\n\r\n\t\t\t\t// Just \"Date\"?\r\n\t\t\t\tif (chunk.text.match(/^date$/i) && $type.isString(this._dateFormat)) {\r\n\t\t\t\t\tchunk.text = this._dateFormat;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find all possible parts\r\n\t\t\t\tlet matches = chunk.text.match(/G|yyyy|yyy|yy|y|YYYY|YYY|YY|Y|u|q|MMMMM|MMMM|MMM|MM|M|ww|w|W|dd|d|DDD|DD|D|F|g|EEEEE|EEEE|EEE|EE|E|eeeee|eeee|eee|ee|e|aaa|aa|a|hh|h|HH|H|KK|K|kk|k|mm|m|ss|s|SSS|SS|S|A|zzzz|zzz|zz|z|ZZ|Z|t|x|nnn|nn|n|i|I/g);\r\n\r\n\t\t\t\t// Found?\r\n\t\t\t\tif (matches) {\r\n\r\n\t\t\t\t\t// Populate template\r\n\t\t\t\t\tfor (let x = 0; x < matches.length; x++) {\r\n\t\t\t\t\t\tinfo.parts.push(matches[x]);\r\n\t\t\t\t\t\tchunk.text = chunk.text.replace(matches[x], $strings.PLACEHOLDER);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Apply to template\r\n\t\t\tinfo.template += chunk.text;\r\n\t\t}\r\n\r\n\t\t// Apply style formatting\r\n\t\t//info.template = getTextFormatter().format(info.template, this.outputFormat);\r\n\r\n\t\t// Save cache\r\n\t\tthis.setCache(format, info);\r\n\r\n\t\treturn info;\r\n\t}\r\n\r\n\t/**\r\n\t * Applies format to Date.\r\n\t *\r\n\t * @param date      Date object\r\n\t * @param info      Parsed format information\r\n\t * @param language  Language\r\n\t * @return Formatted date string\r\n\t */\r\n\tprotected applyFormat(date: Date, info: DateFormatInfo, language: Language): string {\r\n\r\n\t\t// Init return value\r\n\t\tlet res = info.template;\r\n\r\n\t\t// Get values\r\n\t\tlet fullYear: number,\r\n\t\t\tmonth: number,\r\n\t\t\tweekday: number,\r\n\t\t\tday: number,\r\n\t\t\thours: number,\r\n\t\t\tminutes: number,\r\n\t\t\tseconds: number,\r\n\t\t\tmilliseconds: number,\r\n\t\t\toffset: number = date.getTimezoneOffset(),\r\n\t\t\ttimestamp: number = date.getTime();\r\n\t\tif (this.utc) {\r\n\t\t\tfullYear = date.getUTCFullYear();\r\n\t\t\tmonth = date.getUTCMonth();\r\n\t\t\tweekday = date.getUTCDay();\r\n\t\t\tday = date.getUTCDate();\r\n\t\t\thours = date.getUTCHours();\r\n\t\t\tminutes = date.getUTCMinutes();\r\n\t\t\tseconds = date.getUTCSeconds();\r\n\t\t\tmilliseconds = date.getUTCMilliseconds();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfullYear = date.getFullYear();\r\n\t\t\tmonth = date.getMonth();\r\n\t\t\tweekday = date.getDay();\r\n\t\t\tday = date.getDate();\r\n\t\t\thours = date.getHours();\r\n\t\t\tminutes = date.getMinutes();\r\n\t\t\tseconds = date.getSeconds();\r\n\t\t\tmilliseconds = date.getMilliseconds();\r\n\t\t}\r\n\r\n\t\t// Go through each part and format/replace it in template\r\n\t\tfor (let i = 0, len = info.parts.length; i < len; i++) {\r\n\t\t\tlet value: string = \"\";\r\n\t\t\tswitch (info.parts[i]) {\r\n\r\n\t\t\t\tcase \"G\":\r\n\t\t\t\t\tvalue = language.translate(\r\n\t\t\t\t\t\tfullYear < 0\r\n\t\t\t\t\t\t\t? \"_era_bc\"\r\n\t\t\t\t\t\t\t: \"_era_ad\"\r\n\t\t\t\t\t);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"yyyy\":\r\n\t\t\t\t\tvalue = Math.abs(fullYear).toString();\r\n\t\t\t\t\tif (fullYear < 0) {\r\n\t\t\t\t\t\tvalue += language.translate(\"_era_bc\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"yyy\":\r\n\t\t\t\tcase \"yy\":\r\n\t\t\t\tcase \"y\":\r\n\t\t\t\t\tvalue = Math.abs(fullYear).toString().substr(-info.parts[i].length);\r\n\t\t\t\t\tif (fullYear < 0) {\r\n\t\t\t\t\t\tvalue += language.translate(\"_era_bc\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"YYYY\":\r\n\t\t\t\tcase \"YYY\":\r\n\t\t\t\tcase \"YY\":\r\n\t\t\t\tcase \"Y\":\r\n\t\t\t\t\tlet week = $utils.getWeek(date);\r\n\t\t\t\t\tlet year = fullYear;\r\n\t\t\t\t\tif (week == 1 && (weekday > 4)) {\r\n\t\t\t\t\t\tyear--;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (info.parts[i] == \"YYYY\") {\r\n\t\t\t\t\t\tvalue = Math.abs(year).toString();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tvalue = Math.abs(year).toString().substr(-info.parts[i].length);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (year < 0) {\r\n\t\t\t\t\t\tvalue += language.translate(\"_era_bc\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"u\":\r\n\t\t\t\t\t// @todo\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"q\":\r\n\t\t\t\t\tvalue = \"\" + Math.ceil((date.getMonth() + 1) / 3);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"MMMMM\":\r\n\t\t\t\t\tvalue = language.translate(this.months[month]).substr(0, 1);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"MMMM\":\r\n\t\t\t\t\tvalue = language.translate(this.months[month]);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"MMM\":\r\n\t\t\t\t\tvalue = language.translate(this.monthsShort[month]);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"MM\":\r\n\t\t\t\t\tvalue = $utils.padString(month + 1, 2, \"0\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"M\":\r\n\t\t\t\t\tvalue = (month + 1).toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"ww\":\r\n\t\t\t\t\tvalue = $utils.padString($utils.getWeek(date, this.utc), 2, \"0\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"w\":\r\n\t\t\t\t\tvalue = $utils.getWeek(date, this.utc).toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"W\":\r\n\t\t\t\t\tvalue = $utils.getMonthWeek(date, this.utc).toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"dd\":\r\n\t\t\t\t\tvalue = $utils.padString(day, 2, \"0\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"d\":\r\n\t\t\t\t\tvalue = day.toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"DD\":\r\n\t\t\t\tcase \"DDD\":\r\n\t\t\t\t\tvalue = $utils.padString($utils.getYearDay(date, this.utc).toString(), info.parts[i].length, \"0\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"D\":\r\n\t\t\t\t\tvalue = $utils.getYearDay(date, this.utc).toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"F\":\r\n\t\t\t\t\t// @todo\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"g\":\r\n\t\t\t\t\t// @todo\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"t\":\r\n\t\t\t\t\tvalue = language.translateFunc(\"_dateOrd\").call(this, day);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"E\":\r\n\t\t\t\t\tvalue = (weekday || 7).toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"EE\":\r\n\t\t\t\t\tvalue = $utils.padString((weekday || 7).toString(), 2, \"0\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"EEE\":\r\n\t\t\t\tcase \"eee\":\r\n\t\t\t\t\tvalue = language.translate(this.weekdaysShort[weekday]);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"EEEE\":\r\n\t\t\t\tcase \"eeee\":\r\n\t\t\t\t\tvalue = language.translate(this.weekdays[weekday]);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"EEEEE\":\r\n\t\t\t\tcase \"eeeee\":\r\n\t\t\t\t\tvalue = language.translate(this.weekdays[weekday]).substr(0, 1);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"e\":\r\n\t\t\t\tcase \"ee\":\r\n\t\t\t\t\tvalue = (weekday - this.firstDayOfWeek + 1).toString();\r\n\t\t\t\t\tif (info.parts[i] == \"ee\") {\r\n\t\t\t\t\t\tvalue = $utils.padString(value, 2, \"0\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"a\":\r\n\t\t\t\t\tif (hours >= 12) {\r\n\t\t\t\t\t\tvalue = language.translate(\"PM\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tvalue = language.translate(\"AM\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"aa\":\r\n\t\t\t\t\tif (hours >= 12) {\r\n\t\t\t\t\t\tvalue = language.translate(\"P.M.\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tvalue = language.translate(\"A.M.\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"aaa\":\r\n\t\t\t\t\tif (hours >= 12) {\r\n\t\t\t\t\t\tvalue = language.translate(\"P\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tvalue = language.translate(\"A\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"h\":\r\n\t\t\t\t\tvalue = $utils.get12Hours(hours).toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"hh\":\r\n\t\t\t\t\tvalue = $utils.padString($utils.get12Hours(hours), 2, \"0\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"H\":\r\n\t\t\t\t\tvalue = hours.toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"HH\":\r\n\t\t\t\t\tvalue = $utils.padString(hours, 2, \"0\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"K\":\r\n\t\t\t\t\tvalue = $utils.get12Hours(hours, 0).toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"KK\":\r\n\t\t\t\t\tvalue = $utils.padString($utils.get12Hours(hours, 0), 2, \"0\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"k\":\r\n\t\t\t\t\tvalue = (hours + 1).toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"kk\":\r\n\t\t\t\t\tvalue = $utils.padString(hours + 1, 2, \"0\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"m\":\r\n\t\t\t\t\tvalue = minutes.toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"mm\":\r\n\t\t\t\t\tvalue = $utils.padString(minutes, 2, \"0\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"s\":\r\n\t\t\t\t\tvalue = seconds.toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"ss\":\r\n\t\t\t\t\tvalue = $utils.padString(seconds, 2, \"0\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"S\":\r\n\t\t\t\tcase \"SS\":\r\n\t\t\t\tcase \"SSS\":\r\n\t\t\t\t\tvalue = Math.round((milliseconds / 1000) * Math.pow(10, info.parts[i].length)).toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"x\":\r\n\t\t\t\t\tvalue = timestamp.toString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"n\":\r\n\t\t\t\tcase \"nn\":\r\n\t\t\t\tcase \"nnn\":\r\n\t\t\t\t\tvalue = $utils.padString(milliseconds, info.parts[i].length, \"0\");\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"z\":\r\n\t\t\t\t\tvalue = $utils.getTimeZone(date, false, false, this.utc);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"zz\":\r\n\t\t\t\t\tvalue = $utils.getTimeZone(date, true, false, this.utc);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"zzz\":\r\n\t\t\t\t\tvalue = $utils.getTimeZone(date, false, true, this.utc);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"zzzz\":\r\n\t\t\t\t\tvalue = $utils.getTimeZone(date, true, true, this.utc);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"Z\":\r\n\t\t\t\tcase \"ZZ\":\r\n\t\t\t\t\tlet tz = Math.abs(offset) / 60;\r\n\t\t\t\t\tlet tzh = Math.floor(tz);\r\n\t\t\t\t\tlet tzm = tz * 60 - tzh * 60;\r\n\r\n\t\t\t\t\tif (this.utc) {\r\n\t\t\t\t\t\ttzh = 0;\r\n\t\t\t\t\t\ttzm = 0;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (info.parts[i] == \"Z\") {\r\n\t\t\t\t\t\tvalue = \"GMT\";\r\n\t\t\t\t\t\tvalue += offset > 0 ? \"-\" : \"+\";\r\n\t\t\t\t\t\tvalue += $utils.padString(tzh, 2) + \":\" + $utils.padString(tzm, 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tvalue = offset > 0 ? \"-\" : \"+\";\r\n\t\t\t\t\t\tvalue += $utils.padString(tzh, 2) + $utils.padString(tzm, 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"i\":\r\n\t\t\t\t\tvalue = date.toISOString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"I\":\r\n\t\t\t\t\tvalue = date.toUTCString();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\tres = res.replace($strings.PLACEHOLDER, value);\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses any input value into Date object.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-date-time/#Parsing_Dates} Tutorial on date/time parsing\r\n\t * @param source  Source value\r\n\t * @param format  Source format\r\n\t * @return Date object\r\n\t */\r\n\tpublic parse(source: any, format?: string): Date {\r\n\r\n\t\t// Format set?\r\n\t\tif (!$type.hasValue(format)) {\r\n\t\t\tformat = this.inputDateFormat;\r\n\t\t}\r\n\r\n\t\t// Is it already a Date\r\n\t\tif (source instanceof Date) {\r\n\t\t\treturn source;\r\n\t\t}\r\n\r\n\t\t// Is it a numeric timestamp\r\n\t\tif (typeof source === \"number\") {\r\n\t\t\treturn new Date(source);\r\n\t\t}\r\n\r\n\t\t// No? Let's check if it's string, and try converting to it if nec\r\n\t\tif (typeof source !== \"string\") {\r\n\t\t\tsource = source.toString();\r\n\t\t}\r\n\r\n\t\t// no language?\r\n\t\tif (!this.language) {\r\n\t\t\tif (this.sprite) {\r\n\t\t\t\tthis.language = this.sprite.language;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.language = new Language;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Init return value\r\n\t\tlet res: Date;\r\n\r\n\t\t// Init RegEx for parsing\r\n\t\tlet reg: string = \"\";\r\n\r\n\t\t// Clean format\r\n\t\tformat = $utils.cleanFormat(format);\r\n\r\n\t\t// Clip format to length of the source string\r\n\t\tformat = format.substr(0, source.length);\r\n\r\n\t\t// Parse format\r\n\t\tlet info = this.parseFormat(format);\r\n\r\n\t\t// Init parsed items holder\r\n\t\tlet parsedIndexes = {\r\n\t\t\t\"year\": -1,\r\n\t\t\t\"year3\": -1,\r\n\t\t\t\"year2\": -1,\r\n\t\t\t\"year1\": -1,\r\n\t\t\t\"month\": -1,\r\n\t\t\t\"monthShort\": -1,\r\n\t\t\t\"monthLong\": -1,\r\n\t\t\t\"weekdayShort\": -1,\r\n\t\t\t\"weekdayLong\": -1,\r\n\t\t\t\"day\": -1,\r\n\t\t\t\"yearDay\": -1,\r\n\t\t\t\"week\": -1,\r\n\t\t\t\"hourBase0\": -1,\r\n\t\t\t\"hour12Base0\": -1,\r\n\t\t\t\"hourBase1\": -1,\r\n\t\t\t\"hour12Base1\": -1,\r\n\t\t\t\"minute\": -1,\r\n\t\t\t\"second\": -1,\r\n\t\t\t\"millisecond\": -1,\r\n\t\t\t\"millisecondDigits\": -1,\r\n\t\t\t\"am\": -1,\r\n\t\t\t\"zone\": -1,\r\n\t\t\t\"timestamp\": -1,\r\n\t\t\t\"iso\": -1\r\n\t\t};\r\n\r\n\t\t// Init values\r\n\t\tlet resValues = {\r\n\t\t\t\"year\": 1970,\r\n\t\t\t\"month\": 0,\r\n\t\t\t\"day\": 1,\r\n\t\t\t\"hour\": 0,\r\n\t\t\t\"minute\": 0,\r\n\t\t\t\"second\": 0,\r\n\t\t\t\"millisecond\": 0,\r\n\t\t\t\"timestamp\": <any>null,\r\n\t\t\t\"offset\": 0,\r\n\t\t\t\"utc\": this.utc\r\n\t\t}\r\n\r\n\t\t// Index adjuster\r\n\t\tlet indexAdjust: number = 0,\r\n\t\t\tindex: number = 0;\r\n\r\n\t\t// Iterate through all of the parts\r\n\t\tfor (let i: number = 0; i < info.parts.length; i++) {\r\n\r\n\t\t\t// Set current match index\r\n\t\t\tindex = i + indexAdjust + 1;\r\n\r\n\t\t\tswitch (info.parts[i]) {\r\n\r\n\t\t\t\tcase \"yyyy\":\r\n\t\t\t\tcase \"YYYY\":\r\n\t\t\t\t\treg += \"([0-9]{4})\";\r\n\t\t\t\t\tparsedIndexes.year = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"yyy\":\r\n\t\t\t\tcase \"YYY\":\r\n\t\t\t\t\treg += \"([0-9]{3})\";\r\n\t\t\t\t\tparsedIndexes.year3 = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"yy\":\r\n\t\t\t\tcase \"YY\":\r\n\t\t\t\t\treg += \"([0-9]{2})\";\r\n\t\t\t\t\tparsedIndexes.year2 = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"y\":\r\n\t\t\t\tcase \"Y\":\r\n\t\t\t\t\treg += \"([0-9]{1})\";\r\n\t\t\t\t\tparsedIndexes.year1 = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"MMMM\":\r\n\t\t\t\t\treg += \"(\" + this.getStringList(this.months).join(\"|\") + \")\";\r\n\t\t\t\t\tparsedIndexes.monthLong = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"MMM\":\r\n\t\t\t\t\treg += \"(\" + this.getStringList(this.monthsShort).join(\"|\") + \")\";\r\n\t\t\t\t\tparsedIndexes.monthShort = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"MM\":\r\n\t\t\t\tcase \"M\":\r\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\r\n\t\t\t\t\tparsedIndexes.month = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"ww\":\r\n\t\t\t\tcase \"w\":\r\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\r\n\t\t\t\t\tparsedIndexes.week = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"dd\":\r\n\t\t\t\tcase \"d\":\r\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\r\n\t\t\t\t\tparsedIndexes.day = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"DDD\":\r\n\t\t\t\tcase \"DD\":\r\n\t\t\t\tcase \"D\":\r\n\t\t\t\t\treg += \"([0-9]{3}|[0-9]{2}|[0-9]{1})\";\r\n\t\t\t\t\tparsedIndexes.yearDay = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\r\n\t\t\t\tcase \"dddd\":\r\n\t\t\t\t\treg += \"(\" + this.getStringList(this.weekdays).join(\"|\") + \")\";\r\n\t\t\t\t\tparsedIndexes.weekdayLong = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"ddd\":\r\n\t\t\t\t\treg += \"(\" + this.getStringList(this.weekdaysShort).join(\"|\") + \")\";\r\n\t\t\t\t\tparsedIndexes.weekdayShort = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"aaa\":\r\n\t\t\t\tcase \"aa\":\r\n\t\t\t\tcase \"a\":\r\n\t\t\t\t\t// TODO: fix (escape regex)\r\n\t\t\t\t\treg += \"(\" + this.getStringList([\"AM\", \"PM\", \"A\\.M\\.\", \"P\\.M\\.\", \"A\", \"P\"]).join(\"|\") + \")\";\r\n\t\t\t\t\tparsedIndexes.am = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"hh\":\r\n\t\t\t\tcase \"h\":\r\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\r\n\t\t\t\t\tparsedIndexes.hour12Base1 = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"HH\":\r\n\t\t\t\tcase \"H\":\r\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\r\n\t\t\t\t\tparsedIndexes.hourBase0 = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"KK\":\r\n\t\t\t\tcase \"K\":\r\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\r\n\t\t\t\t\tparsedIndexes.hour12Base0 = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"kk\":\r\n\t\t\t\tcase \"k\":\r\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\r\n\t\t\t\t\tparsedIndexes.hourBase1 = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"mm\":\r\n\t\t\t\tcase \"m\":\r\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\r\n\t\t\t\t\tparsedIndexes.minute = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"ss\":\r\n\t\t\t\tcase \"s\":\r\n\t\t\t\t\treg += \"([0-9]{2}|[0-9]{1})\";\r\n\t\t\t\t\tparsedIndexes.second = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"SSS\":\r\n\t\t\t\tcase \"SS\":\r\n\t\t\t\tcase \"S\":\r\n\t\t\t\t\treg += \"([0-9]{3}|[0-9]{2}|[0-9]{1})\";\r\n\t\t\t\t\tparsedIndexes.millisecond = index;\r\n\t\t\t\t\tparsedIndexes.millisecondDigits = info.parts[i].length;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"nnn\":\r\n\t\t\t\tcase \"nn\":\r\n\t\t\t\tcase \"n\":\r\n\t\t\t\t\treg += \"([0-9]{3}|[0-9]{2}|[0-9]{1})\";\r\n\t\t\t\t\tparsedIndexes.millisecond = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"x\":\r\n\t\t\t\t\treg += \"([0-9]{1,})\";\r\n\t\t\t\t\tparsedIndexes.timestamp = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"Z\":\r\n\t\t\t\t\treg += \"GMT([-+]+[0-9]{2}:[0-9]{2})\";\r\n\t\t\t\t\tparsedIndexes.zone = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"ZZ\":\r\n\t\t\t\t\treg += \"([\\\\-+]+[0-9]{2}[0-9]{2})\";\r\n\t\t\t\t\tparsedIndexes.zone = index;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"i\":\r\n\t\t\t\t\treg += \"([0-9]{4})-?([0-9]{2})-?([0-9]{2})T?([0-9]{2}):?([0-9]{2}):?([0-9]{2})\\.?([0-9]{0,3})([zZ]|[+\\-][0-9]{2}:?[0-9]{2}|$)\";\r\n\t\t\t\t\tparsedIndexes.iso = index;\r\n\t\t\t\t\tindexAdjust += 7;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"G\":\r\n\t\t\t\tcase \"YYYY\":\r\n\t\t\t\tcase \"YYY\":\r\n\t\t\t\tcase \"YY\":\r\n\t\t\t\tcase \"Y\":\r\n\t\t\t\tcase \"MMMMM\":\r\n\t\t\t\tcase \"W\":\r\n\t\t\t\tcase \"EEEEE\":\r\n\t\t\t\tcase \"EEEE\":\r\n\t\t\t\tcase \"EEE\":\r\n\t\t\t\tcase \"EE\":\r\n\t\t\t\tcase \"E\":\r\n\t\t\t\tcase \"eeeee\":\r\n\t\t\t\tcase \"eeee\":\r\n\t\t\t\tcase \"eee\":\r\n\t\t\t\tcase \"ee\":\r\n\t\t\t\tcase \"e\":\r\n\t\t\t\tcase \"zzzz\":\r\n\t\t\t\tcase \"zzz\":\r\n\t\t\t\tcase \"zz\":\r\n\t\t\t\tcase \"z\":\r\n\t\t\t\tcase \"t\":\r\n\t\t\t\t\t// Ignore\r\n\t\t\t\t\tindexAdjust--;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\treg += \"[^0-9]*\";\r\n\t\t}\r\n\r\n\t\t// Try matching\r\n\t\tlet regex = new RegExp(reg);\r\n\t\tlet matches: RegExpMatchArray = source.match(regex);\r\n\r\n\t\tif (matches) {\r\n\t\t\t// Populate the date object\r\n\r\n\t\t\t// Full year\r\n\t\t\tif (parsedIndexes.year > -1) {\r\n\t\t\t\tresValues.year = parseInt(matches[parsedIndexes.year]);\r\n\t\t\t}\r\n\r\n\t\t\t// 3-digit year\r\n\t\t\tif (parsedIndexes.year3 > -1) {\r\n\t\t\t\tlet val = parseInt(matches[parsedIndexes.year3]);\r\n\t\t\t\tval += 1000;\r\n\t\t\t\tresValues.year = val;\r\n\t\t\t}\r\n\r\n\t\t\t// 2-digit year\r\n\t\t\tif (parsedIndexes.year2 > -1) {\r\n\t\t\t\tlet val = parseInt(matches[parsedIndexes.year2]);\r\n\t\t\t\tif (val > 50) {\r\n\t\t\t\t\tval += 1000;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tval += 2000;\r\n\t\t\t\t}\r\n\t\t\t\tresValues.year = val;\r\n\t\t\t}\r\n\r\n\t\t\t// 1-digit year\r\n\t\t\tif (parsedIndexes.year1 > -1) {\r\n\t\t\t\tlet val = parseInt(matches[parsedIndexes.year1]);\r\n\t\t\t\tval = Math.floor((new Date().getFullYear()) / 10) * 10 + val;\r\n\t\t\t\tresValues.year = val;\r\n\t\t\t}\r\n\r\n\t\t\t// Full month\r\n\t\t\tif (parsedIndexes.monthLong > -1) {\r\n\t\t\t\tresValues.month = this.resolveMonth(<any>matches[parsedIndexes.monthLong]);\r\n\t\t\t}\r\n\r\n\t\t\t// Short month\r\n\t\t\tif (parsedIndexes.monthShort > -1) {\r\n\t\t\t\tresValues.month = this.resolveShortMonth(<any>matches[parsedIndexes.monthShort]);\r\n\t\t\t}\r\n\r\n\t\t\t// Numeric month\r\n\t\t\tif (parsedIndexes.month > -1) {\r\n\t\t\t\tresValues.month = parseInt(matches[parsedIndexes.month]) - 1;\r\n\t\t\t}\r\n\r\n\t\t\t// Weekday\r\n\t\t\t// @todo\r\n\r\n\t\t\t// Week\r\n\t\t\tif ((parsedIndexes.week > -1) && (parsedIndexes.day === -1)) {\r\n\t\t\t\t// We parse weeks ONLY if day is not explicitly set\r\n\t\t\t\t// TODO: this needs work\r\n\t\t\t\t// (but maybe later - I can hardly imagine anyone passing their dates in weeks)\r\n\t\t\t\tresValues.month = 0;\r\n\t\t\t\tresValues.day = $utils.getDayFromWeek(\r\n\t\t\t\t\tparseInt(matches[parsedIndexes.week]),\r\n\t\t\t\t\tresValues.year,\r\n\t\t\t\t\t1,\r\n\t\t\t\t\tthis.utc\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// Day\r\n\t\t\tif (parsedIndexes.day > -1) {\r\n\t\t\t\tresValues.day = parseInt(matches[parsedIndexes.day]);\r\n\t\t\t}\r\n\r\n\t\t\t// Year day\r\n\t\t\tif (parsedIndexes.yearDay > -1) {\r\n\t\t\t\tresValues.month = 0;\r\n\t\t\t\tresValues.day = parseInt(matches[parsedIndexes.yearDay]);\r\n\t\t\t}\r\n\r\n\t\t\t// 24 Hour (0-23)\r\n\t\t\tif (parsedIndexes.hourBase0 > -1) {\r\n\t\t\t\tresValues.hour = parseInt(matches[parsedIndexes.hourBase0]);\r\n\t\t\t}\r\n\r\n\t\t\t// 24 Hour (1-24)\r\n\t\t\tif (parsedIndexes.hourBase1 > -1) {\r\n\t\t\t\tresValues.hour = parseInt(matches[parsedIndexes.hourBase1]) - 1;\r\n\t\t\t}\r\n\r\n\t\t\t// 12 Hour (0-11)\r\n\t\t\tif (parsedIndexes.hour12Base0 > -1) {\r\n\t\t\t\tlet val = parseInt(matches[parsedIndexes.hour12Base0]);\r\n\t\t\t\tif (val == 11) {\r\n\t\t\t\t\tval = 0;\r\n\t\t\t\t}\r\n\t\t\t\tif ((parsedIndexes.am > -1) && !this.isAm(matches[parsedIndexes.am])) {\r\n\t\t\t\t\tval += 12;\r\n\t\t\t\t}\r\n\t\t\t\tresValues.hour = val;\r\n\t\t\t}\r\n\r\n\t\t\t// 12 Hour (1-12)\r\n\t\t\tif (parsedIndexes.hour12Base1 > -1) {\r\n\t\t\t\tlet val = parseInt(matches[parsedIndexes.hour12Base1]);\r\n\t\t\t\tif (val == 12) {\r\n\t\t\t\t\tval = 0;\r\n\t\t\t\t}\r\n\t\t\t\tif ((parsedIndexes.am > -1) && !this.isAm(matches[parsedIndexes.am])) {\r\n\t\t\t\t\tval += 12;\r\n\t\t\t\t}\r\n\t\t\t\tresValues.hour = val;\r\n\t\t\t}\r\n\r\n\t\t\t// Minute\r\n\t\t\tif (parsedIndexes.minute > -1) {\r\n\t\t\t\tresValues.minute = parseInt(matches[parsedIndexes.minute]);\r\n\t\t\t}\r\n\r\n\t\t\t// Second\r\n\t\t\tif (parsedIndexes.second > -1) {\r\n\t\t\t\tresValues.second = parseInt(matches[parsedIndexes.second]);\r\n\t\t\t}\r\n\r\n\t\t\t// Millisecond\r\n\t\t\tif (parsedIndexes.millisecond > -1) {\r\n\t\t\t\tlet val = parseInt(matches[parsedIndexes.millisecond]);\r\n\t\t\t\tif (parsedIndexes.millisecondDigits == 2) {\r\n\t\t\t\t\tval *= 10;\r\n\t\t\t\t}\r\n\t\t\t\telse if (parsedIndexes.millisecondDigits == 1) {\r\n\t\t\t\t\tval *= 100;\r\n\t\t\t\t}\r\n\t\t\t\tresValues.millisecond = val;\r\n\t\t\t}\r\n\r\n\t\t\t// Timestamp\r\n\t\t\tif (parsedIndexes.timestamp > -1) {\r\n\t\t\t\tresValues.timestamp = parseInt(matches[parsedIndexes.timestamp]);\r\n\r\n\t\t\t\tconst ts = new Date(resValues.timestamp);\r\n\t\t\t\tresValues.year = ts.getUTCFullYear();\r\n\t\t\t\tresValues.month = ts.getUTCMonth();\r\n\t\t\t\tresValues.day = ts.getUTCDate();\r\n\t\t\t\tresValues.hour = ts.getUTCHours();\r\n\t\t\t\tresValues.minute = ts.getUTCMinutes();\r\n\t\t\t\tresValues.second = ts.getUTCSeconds();\r\n\t\t\t\tresValues.millisecond = ts.getUTCMilliseconds();\r\n\t\t\t}\r\n\r\n\t\t\t// Adjust time zone\r\n\t\t\tif (parsedIndexes.zone > -1) {\r\n\t\t\t\tresValues.offset = this.resolveTimezoneOffset(new Date(resValues.year, resValues.month, resValues.day), matches[parsedIndexes.zone]);\r\n\t\t\t}\r\n\r\n\t\t\t// ISO\r\n\t\t\tif (parsedIndexes.iso > -1) {\r\n\r\n\t\t\t\tresValues.year = $type.toNumber(matches[parsedIndexes.iso + 0]);\r\n\t\t\t\tresValues.month = $type.toNumber(matches[parsedIndexes.iso + 1]) - 1;\r\n\t\t\t\tresValues.day = $type.toNumber(matches[parsedIndexes.iso + 2]);\r\n\t\t\t\tresValues.hour = $type.toNumber(matches[parsedIndexes.iso + 3]);\r\n\t\t\t\tresValues.minute = $type.toNumber(matches[parsedIndexes.iso + 4]);\r\n\t\t\t\tresValues.second = $type.toNumber(matches[parsedIndexes.iso + 5]);\r\n\t\t\t\tresValues.millisecond = $type.toNumber(matches[parsedIndexes.iso + 6]);\r\n\r\n\t\t\t\tif (matches[parsedIndexes.iso + 7] == \"Z\" || matches[parsedIndexes.iso + 7] == \"z\") {\r\n\t\t\t\t\tresValues.utc = true;\r\n\t\t\t\t}\r\n\t\t\t\telse if (matches[parsedIndexes.iso + 7] != \"\") {\r\n\t\t\t\t\tresValues.offset = this.resolveTimezoneOffset(new Date(resValues.year, resValues.month, resValues.day), matches[parsedIndexes.iso + 7]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Create Date object\r\n\t\t\tif (resValues.utc) {\r\n\t\t\t\tres = new Date(Date.UTC(\r\n\t\t\t\t\tresValues.year,\r\n\t\t\t\t\tresValues.month,\r\n\t\t\t\t\tresValues.day,\r\n\t\t\t\t\tresValues.hour,\r\n\t\t\t\t\tresValues.minute,\r\n\t\t\t\t\tresValues.second,\r\n\t\t\t\t\tresValues.millisecond\r\n\t\t\t\t));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tres = new Date(\r\n\t\t\t\t\tresValues.year,\r\n\t\t\t\t\tresValues.month,\r\n\t\t\t\t\tresValues.day,\r\n\t\t\t\t\tresValues.hour,\r\n\t\t\t\t\tresValues.minute + resValues.offset,\r\n\t\t\t\t\tresValues.second,\r\n\t\t\t\t\tresValues.millisecond\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Didn't match anything\r\n\t\t\t// Let's try dropping it into Date constructor and hope for the best\r\n\t\t\tres = new Date(source);\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\tprotected resolveTimezoneOffset(date: Date, zone: string): number {\r\n\t\tlet value = zone.match(/([+\\-]?)([0-9]{2}):?([0-9]{2})/);\r\n\t\tif (value) {\r\n\t\t\tlet match = $type.getValue(zone.match(/([+\\-]?)([0-9]{2}):?([0-9]{2})/));\r\n\t\t\tlet dir = match[1];\r\n\t\t\tlet hour = match[2];\r\n\t\t\tlet minute = match[3];\r\n\t\t\tlet offset = parseInt(hour) * 60 + parseInt(minute);\r\n\r\n\t\t\t// Adjust offset\r\n\t\t\t// Making it negative does not seem to make sense, but it's right\r\n\t\t\t// because of how JavaScript calculates GMT offsets\r\n\t\t\tif (dir == \"+\") {\r\n\t\t\t\toffset *= -1;\r\n\t\t\t}\r\n\r\n\t\t\t// Check the difference in offset\r\n\t\t\tlet originalOffset = (date || new Date()).getTimezoneOffset();\r\n\t\t\tlet diff = offset - originalOffset;\r\n\t\t\treturn diff;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Resolves month name (i.e. \"December\") into a month number (11).\r\n\t *\r\n\t * @param value  Month name\r\n\t * @return Month number\r\n\t */\r\n\tprotected resolveMonth(value: MonthNames): number {\r\n\r\n\t\t// Let's try English first\r\n\t\tlet month: number = this.months.indexOf(value);\r\n\t\tif (month > -1) {\r\n\t\t\treturn month;\r\n\t\t}\r\n\r\n\t\t// Try the translation\r\n\t\tif (this.language && !this.language.isDefault()) {\r\n\t\t\tmonth = this.language.translateAll(this.months).indexOf(value);\r\n\t\t\tif (month > -1) {\r\n\t\t\t\treturn month\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Resolves short month name (i.e. \"Dec\") into a month number.\r\n\t *\r\n\t * @param value  Short month name\r\n\t * @return Month number\r\n\t */\r\n\tprotected resolveShortMonth(value: ShortMonthNames): number {\r\n\r\n\t\t// Let's try English first\r\n\t\tlet month: number = this.monthsShort.indexOf(value);\r\n\t\tif (month > -1) {\r\n\t\t\treturn month;\r\n\t\t}\r\n\r\n\t\t// Maybe long month (workaround for May)\r\n\t\tmonth = this.months.indexOf(<any>value);\r\n\t\tif (month > -1) {\r\n\t\t\treturn month;\r\n\t\t}\r\n\r\n\t\t// Try the translation\r\n\t\tif (this.language && !this.language.isDefault()) {\r\n\t\t\tmonth = this.language.translateAll(this.monthsShort).indexOf(value);\r\n\t\t\tif (month > -1) {\r\n\t\t\t\treturn month\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if passed in string represents AM/PM notation in many of its\r\n\t * versions.\r\n\t *\r\n\t * @param value  Source string\r\n\t * @return Is it AM/PM?\r\n\t */\r\n\tprotected isAm(value: string): boolean {\r\n\t\tlet list = this.getStringList([\"AM\", \"A.M.\", \"A\"]);\r\n\t\treturn list.indexOf(value.toUpperCase()) > -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates related [[Sprite]] causing it to redraw.\r\n\t */\r\n\tprotected invalidateSprite(): void {\r\n\t\tif (this.sprite) {\r\n\t\t\tthis.sprite.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Translates list of strings.\r\n\t *\r\n\t * @param list  Source strings\r\n\t * @return Translated strings\r\n\t */\r\n\tprotected getStringList(list: Array<keyof ILocaleProperties>): Array<string> {\r\n\t\tlet res: string[] = [];\r\n\t\tfor (let i: number = 0; i < list.length; i++) {\r\n\t\t\t// translate?\r\n\t\t\tif (this.language) {\r\n\t\t\t\tres.push($utils.escapeForRgex(this.language.translate(list[i])));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tres.push($utils.escapeForRgex(list[i]));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Date format to use.\r\n\t *\r\n\t * If format is not supplied in-line in the string, this setting will be\r\n\t * used.\r\n\t *\r\n\t * @default \"yyyy-MM-dd\"\r\n\t * @param value Date format\r\n\t */\r\n\tpublic set dateFormat(value: string | Intl.DateTimeFormatOptions) {\r\n\t\tthis._dateFormat = value;\r\n\t\tthis.invalidateSprite();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Date format\r\n\t */\r\n\tpublic get dateFormat(): string | Intl.DateTimeFormatOptions {\r\n\t\treturn this._dateFormat;\r\n\t}\r\n\r\n\t/**\r\n\t * Date format to use when parsing dates.\r\n\t *\r\n\t * @default \"yyyy-MM-dd\"\r\n\t * @param value Date format\r\n\t */\r\n\tpublic set inputDateFormat(value: string) {\r\n\t\tthis._inputDateFormat = value;\r\n\t\tthis.invalidateSprite();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Date format\r\n\t */\r\n\tpublic get inputDateFormat(): string {\r\n\t\treturn this._inputDateFormat;\r\n\t}\r\n\r\n\t/**\r\n\t * Locales if you are using date formats in `Intl.DateTimeFormatOptions` syntax.\r\n\t *\r\n\t * @param value Locales\r\n\t */\r\n\tpublic set intlLocales(value: string) {\r\n\t\tthis._intlLocales = value;\r\n\t\tthis.invalidateSprite();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Date format\r\n\t */\r\n\tpublic get intlLocales(): string {\r\n\t\treturn this._intlLocales;\r\n\t}\r\n\r\n\t/**\r\n\t * Should formatter use UTC functions?\r\n\t *\r\n\t * If UTC is used, all date/time values will be independent on client's\r\n\t * time zone.\r\n\t *\r\n\t * @param value Use UTC?\r\n\t */\r\n\tpublic set utc(value: boolean) {\r\n\t\tthis._utc = value;\r\n\t\tthis.invalidateSprite();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Use UTC?\r\n\t */\r\n\tpublic get utc(): boolean {\r\n\t\treturn this._utc;\r\n\t}\r\n\r\n\t/**\r\n\t * If set, will apply specific offset in minutes before formatting the date\r\n\t * text.\r\n\t *\r\n\t * The value is a number of minutes from target time zone to UTC.\r\n\t *\r\n\t * E.g. `300` will recalculate Dates in \"GMT-5\" time zone.\r\n\t *\r\n\t * @param  value  Offset (minutes)\r\n\t */\r\n\tpublic set timezoneOffset(value: $type.Optional<number>) {\r\n\t\tif (this._timezoneOffset != value) {\r\n\t\t\tthis._timezoneOffset = value;\r\n\t\t\tthis.invalidateSprite();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Offset (minutes)\r\n\t */\r\n\tpublic get timezoneOffset(): $type.Optional<number> {\r\n\t\treturn this._timezoneOffset;\r\n\t}\r\n\r\n\t/**\r\n\t * If set, will format date/time in specific time zone.\r\n\t *\r\n\t * The value should be named time zone, e.g.:\r\n\t * `\"America/Vancouver\"`, `\"Australia/Sydney\"`, `\"UTC\"`.\r\n\t *\r\n\t * @since 4.10.1\r\n\t * @param  value  Timezone\r\n\t */\r\n\tpublic set timezone(value: $type.Optional<string>) {\r\n\t\tif (this._timezone != value) {\r\n\t\t\tthis._timezone = value;\r\n\t\t\tthis.timezoneMinutes = $time.getTimezoneMinutes(value);\r\n\t\t\tthis.invalidateSprite();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Timezone\r\n\t */\r\n\tpublic get timezone(): $type.Optional<string> {\r\n\t\treturn this._timezone;\r\n\t}\r\n\r\n\t/**\r\n\t * First day of the week:\r\n\t *\r\n\t * * 0 - Sunday\r\n\t * * 1 - Monday\r\n\t * * 2 - Tuesday\r\n\t *\r\n\t * Etc.\r\n\t *\r\n\t * @param value First day of week\r\n\t */\r\n\tpublic set firstDayOfWeek(value: number) {\r\n\t\tthis._firstDayOfWeek = value;\r\n\t\tthis.invalidateSprite();\r\n\t}\r\n\r\n\t/**\r\n\t * @return First day of week\r\n\t */\r\n\tpublic get firstDayOfWeek(): number {\r\n\t\treturn this._firstDayOfWeek;\r\n\t}\r\n\r\n\t/**\r\n\t * Output format for the formatted date.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value  Format\r\n\t */\r\n\tpublic set outputFormat(value: string) {\r\n\t\tthis._outputFormat = value.toLowerCase();\r\n\t\tthis.invalidateSprite();\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Format\r\n\t */\r\n\tpublic get outputFormat(): string {\r\n\t\treturn this._outputFormat;\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"DateFormatter\"] = DateFormatter;\r\n","/**\r\n * Functionality for drawing circles.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite, ISpriteProperties, ISpriteAdapters, ISpriteEvents } from \"../Sprite\";\r\nimport { percent, Percent } from \"../utils/Percent\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport * as $math from \"../utils/Math\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[Circle]].\r\n */\r\nexport interface ICircleProperties extends ISpriteProperties {\r\n\r\n\t/**\r\n\t * Radius of the circle.\r\n\t *\r\n\t * Can be either absolute (pixels) or relative ([Percent]).\r\n\t */\r\n\tradius?: number | Percent;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[Circle]].\r\n */\r\nexport interface ICircleEvents extends ISpriteEvents { }\r\n\r\n/**\r\n * Defines adapters for [[Circle]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface ICircleAdapters extends ISpriteAdapters, ICircleProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Used to create a circle\r\n * @see {@link ICircleEvents} for a list of available events\r\n * @see {@link ICircleAdapters} for a list of available Adapters\r\n */\r\nexport class Circle extends Sprite {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: ICircleProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: ICircleAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: ICircleEvents;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.className = \"Circle\";\r\n\t\tthis.element = this.paper.add(\"circle\");\r\n\r\n\t\tthis.setPercentProperty(\"radius\", percent(100));\r\n\t\tthis.setPropertyValue(\"horizontalCenter\", \"middle\");\r\n\t\tthis.setPropertyValue(\"verticalCenter\", \"middle\");\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the circle.\r\n\t */\r\n\tprotected draw(): void {\r\n\t\tsuper.draw();\r\n\t\tthis.element.attr({ \"r\": this.pixelRadius });\r\n\t}\r\n\r\n\t/**\r\n\t * Radius of the circle.\r\n\t *\r\n\t * Can be either absolute (pixels) or relative ([Percent]).\r\n\t *\r\n\t * @param value  Radius\r\n\t */\r\n\tpublic set radius(value: number | Percent) {\r\n\t\tthis.setPercentProperty(\"radius\", value, true, false, 10, false);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Radius\r\n\t */\r\n\tpublic get radius(): number | Percent {\r\n\t\treturn this.getPropertyValue(\"radius\");\r\n\t}\r\n\r\n\t/**\r\n\t * Radius of the circle in pixels.\r\n\t *\r\n\t * This is a read-only property. To set radius in pixels, use `radius`\r\n\t * property.\r\n\t *\r\n\t * @readonly\r\n\t * @return Radius (px)\r\n\t */\r\n\tpublic get pixelRadius(): number {\r\n\t\treturn $utils.relativeToValue(this.radius, $math.min(this.innerWidth / 2, this.innerHeight / 2));\r\n\t}\r\n\r\n\t/**\r\n\t * Updates bounding box.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic measureElement(): void {\r\n\t\tlet pixelRadius = this.pixelRadius;\r\n\t\tthis._bbox = {\r\n\t\t\tx: -pixelRadius,\r\n\t\t\ty: -pixelRadius,\r\n\t\t\twidth: pixelRadius * 2,\r\n\t\t\theight: pixelRadius * 2\r\n\t\t};\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Circle\"] = Circle;\r\n","/**\n * ============================================================================\n * IMPORTS\n * ============================================================================\n * @hidden\n */\nimport { registry } from \"../Registry\";\nimport * as $path from \"./Path\";\nimport * as $array from \"../utils/Array\";\nimport * as $utils from \"../utils/Utils\";\nimport * as $math from \"../utils/Math\";\nimport { IPoint } from \"../defs/IPoint\";\n\n\n/**\n * ============================================================================\n * PATH FUNCTIONS\n * ============================================================================\n * @hidden\n */\n\n/**\n * @ignore Exclude from docs\n * @todo Description\n */\nexport interface ISmoothing {\n\tsmooth(points: Array<IPoint>): string;\n}\n\n/**\n * @ignore Exclude from docs\n * @todo Description\n */\nexport class Tension implements ISmoothing {\n\n\t/**\n\t * [_tensionX description]\n\t *\n\t * @todo Description\n\t */\n\tprivate _tensionX: number;\n\n\t/**\n\t * [_tensionY description]\n\t *\n\t * @todo Description\n\t */\n\tprivate _tensionY: number;\n\n\t/**\n\t * Constructor.\n\t *\n\t * @param tensionX [description]\n\t * @param tensionY [description]\n\t */\n\tconstructor(tensionX: number, tensionY: number) {\n\t\tthis._tensionX = tensionX;\n\t\tthis._tensionY = tensionY;\n\t}\n\n\t/**\n\t * [smooth description]\n\t *\n\t * @ignore Exclude from docs\n\t * @todo Description\n\t * @param points  [description]\n\t * @return [description]\n\t */\n\tpublic smooth(points: Array<IPoint>): string {\n\n\t\tfor (let i = points.length - 1; i > 0; i--) {\n\t\t\tlet p0 = points[i];\n\t\t\tlet p1 = points[i - 1];\n\n\t\t\tif (Math.abs(p0.x - p1.x) < 0.1 && Math.abs(p0.y - p1.y) < 0.1) {\n\t\t\t\tpoints.splice(i - 1, 1);\n\t\t\t}\n\t\t}\n\n\n\t\tlet tensionX = this._tensionX;\n\t\tlet tensionY = this._tensionY;\n\n\t\tif (points.length < 3 || (tensionX >= 1 && tensionY >= 1)) {\n\t\t\treturn $path.polyline(points);\n\t\t}\n\n\t\tlet first: IPoint = points[0];\n\t\tlet last: IPoint = points[points.length - 1];\n\n\t\tlet closed: boolean = false;\n\n\t\tif ($math.round(first.x, 3) == $math.round(last.x) && $math.round(first.y) == $math.round(last.y)) {\n\t\t\tclosed = true;\n\t\t}\n\n\t\t// Can't moveTo here, as it wont be possible to have fill then.\n\t\tlet path: string = \"\";\n\n\t\tfor (let i = 0, len = points.length - 1; i < len; i++) {\n\t\t\tlet p0: IPoint = points[i - 1];\n\n\t\t\tlet p1: IPoint = points[i];\n\n\t\t\tlet p2: IPoint = points[i + 1];\n\n\t\t\tlet p3: IPoint = points[i + 2];\n\n\t\t\tif (i === 0) {\n\t\t\t\tif (closed) {\n\t\t\t\t\tp0 = points[points.length - 2];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tp0 = points[i];\n\t\t\t\t}\n\t\t\t} else if (i == points.length - 2) {\n\t\t\t\tif (closed) {\n\t\t\t\t\tp3 = points[1];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tp3 = points[i + 1];\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\tlet controlPointA: IPoint = $math.getCubicControlPointA(p0, p1, p2, p3, tensionX, tensionY);\n\t\t\tlet controlPointB: IPoint = $math.getCubicControlPointB(p0, p1, p2, p3, tensionX, tensionY);\n\n\t\t\tpath += $path.cubicCurveTo(p2, controlPointA, controlPointB);\n\t\t}\n\n\t\treturn path;\n\t}\n}\n\n\n/**\n * Returns a waved line SVG path between two points.\n *\n * @ignore Exclude from docs\n * @param point1            Starting point\n * @param point2            Ending point\n * @param waveLength        Wave length\n * @param waveHeight        Wave height\n * @param adjustWaveLength  Adjust wave length based on the actual line length\n * @return SVG path\n */\nexport function wavedLine(point1: IPoint, point2: IPoint, waveLength: number, waveHeight: number, tension: number, adjustWaveLength?: boolean): string {\n\n\tlet x1: number = point1.x;\n\tlet y1: number = point1.y;\n\n\tlet x2: number = point2.x;\n\tlet y2: number = point2.y;\n\n\tlet distance: number = $math.getDistance(point1, point2);\n\n\tif (adjustWaveLength) {\n\t\twaveLength = distance / Math.round(distance / waveLength);\n\t}\n\n\tlet d: string = registry.getCache($utils.stringify([\"wavedLine\", point1.x, point2.x, point1.y, point2.y, waveLength, waveHeight]));\n\tif (!d) {\n\t\tif (distance > 0) {\n\t\t\tlet angle: number = Math.atan2(y2 - y1, x2 - x1);\n\n\t\t\tlet cos: number = Math.cos(angle);\n\t\t\tlet sin: number = Math.sin(angle);\n\n\t\t\tlet waveLengthX: number = waveLength * cos;\n\t\t\tlet waveLengthY: number = waveLength * sin;\n\n\t\t\tif (waveLength <= 1 || waveHeight <= 1) {\n\t\t\t\td = $path.lineTo(point2);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlet halfWaveCount: number = Math.round(2 * distance / waveLength);\n\n\t\t\t\tlet points: IPoint[] = [];\n\t\t\t\tlet sign: number = 1;\n\n\t\t\t\tif (x2 < x1) {\n\t\t\t\t\tsign *= -1;\n\t\t\t\t}\n\n\t\t\t\tif (y2 < y1) {\n\t\t\t\t\tsign *= -1;\n\t\t\t\t}\n\n\t\t\t\tfor (let i: number = 0; i <= halfWaveCount; i++) {\n\t\t\t\t\tsign *= -1;\n\t\t\t\t\tlet x: number = x1 + i * waveLengthX / 2 + sign * waveHeight / 2 * sin;\n\t\t\t\t\tlet y: number = y1 + i * waveLengthY / 2 - sign * waveHeight / 2 * cos;\n\t\t\t\t\tpoints.push({ x: x, y: y });\n\t\t\t\t}\n\n\t\t\t\td = new Tension(tension, tension).smooth(points);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\td = \"\";\n\t\t}\n\n\t\tregistry.setCache($utils.stringify([\"wavedLine\", point1.x, point2.x, point1.y, point2.y, waveLength, waveHeight]), d);\n\t}\n\n\treturn d;\n}\n\n\nexport class Monotone implements ISmoothing {\n\tprivate _reversed: boolean;\n\tprivate _closed: boolean;\n\n\tconstructor(reversed: boolean, info: { closed: boolean }) {\n\t\tthis._reversed = reversed;\n\t\tthis._closed = info.closed;\n\t}\n\n\t// According to https://en.wikipedia.org/wiki/Cubic_Hermite_spline#Representations\n\t// \"you can express cubic Hermite interpolation in terms of cubic Bézier curves\n\t// with respect to the four values p0, p0 + m0 / 3, p1 - m1 / 3, p1\".\n\tprivate _curve(x0: number, x1: number, y0: number, y1: number, t0: number, t1: number): string {\n\t\tconst dx = (x1 - x0) / 3;\n\n\t\tif (this._reversed) {\n\t\t\treturn $path.cubicCurveTo(\n\t\t\t\t{ x: y1, y: x1 },\n\t\t\t\t{ x: y0 + dx * t0, y: x0 + dx },\n\t\t\t\t{ x: y1 - dx * t1, y: x1 - dx }\n\t\t\t);\n\n\t\t} else {\n\t\t\treturn $path.cubicCurveTo(\n\t\t\t\t{ x: x1, y: y1 },\n\t\t\t\t{ x: x0 + dx, y: y0 + dx * t0 },\n\t\t\t\t{ x: x1 - dx, y: y1 - dx * t1 }\n\t\t\t);\n\t\t}\n\t}\n\n\tpublic smooth(points: Array<IPoint>): string {\n\t\tlet x0: number = NaN;\n\t\tlet x1: number = NaN;\n\t\tlet y0: number = NaN;\n\t\tlet y1: number = NaN;\n\t\tlet t0: number = NaN;\n\t\tlet point: number = 0;\n\n\t\tlet output = \"\";\n\n\t\t$array.each(points, ({ x, y }) => {\n\t\t\tif (this._reversed) {\n\t\t\t\tlet temp = x;\n\t\t\t\tx = y;\n\t\t\t\ty = temp;\n\t\t\t}\n\n\t\t\tlet t1 = NaN;\n\n\t\t\tif (!(x === x1 && y === y1)) {\n\t\t\t\tswitch (point) {\n\t\t\t\tcase 0:\n\t\t\t\t\tpoint = 1;\n\n\t\t\t\t\tif (this._reversed) {\n\t\t\t\t\t\toutput += $path.lineTo({ x: y, y: x });\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput += $path.lineTo({ x, y });\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tpoint = 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tpoint = 3;\n\t\t\t\t\toutput += this._curve(x0, x1, y0, y1, slope2(x0, x1, y0, y1, t1 = slope3(x0, x1, y0, y1, x, y)), t1);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\toutput += this._curve(x0, x1, y0, y1, t0, t1 = slope3(x0, x1, y0, y1, x, y));\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tx0 = x1;\n\t\t\t\tx1 = x;\n\t\t\t\ty0 = y1;\n\t\t\t\ty1 = y;\n\t\t\t\tt0 = t1;\n\t\t\t}\n\t\t});\n\n\t\tswitch (point) {\n\t\tcase 2:\n\t\t\tif (this._reversed) {\n\t\t\t\toutput += $path.lineTo({ x: y1, y: x1 });\n\n\t\t\t} else {\n\t\t\t\toutput += $path.lineTo({ x: x1, y: y1 });\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\toutput += this._curve(x0, x1, y0, y1, t0, slope2(x0, x1, y0, y1, t0));\n\t\t\tbreak;\n\t\t}\n\n\t\tif (this._closed) {\n\t\t\toutput += $path.closePath();\n\t\t}\n\n\t\treturn output;\n\t}\n}\n\n\n// TODO move this someplace else\nfunction sign(x: number): -1 | 1 {\n\treturn x < 0 ? -1 : 1;\n}\n\n\nfunction slope2(x0: number, x1: number, y0: number, y1: number, t: number): number {\n\tconst h = x1 - x0;\n\treturn h ? (3 * (y1 - y0) / h - t) / 2 : t;\n}\n\n\nfunction slope3(x0: number, x1: number, y0: number, y1: number, x2: number, y2: number): number {\n\tconst h0 = x1 - x0;\n\tconst h1 = x2 - x1;\n\tconst s0 = (y1 - y0) / (h0 || h1 < 0 && -0);\n\tconst s1 = (y2 - y1) / (h1 || h0 < 0 && -0);\n\tconst p = (s0 * h1 + s1 * h0) / (h0 + h1);\n\treturn (sign(s0) + sign(s1)) * Math.min(Math.abs(s0), Math.abs(s1), 0.5 * Math.abs(p)) || 0;\n}\n\n\nexport class MonotoneX extends Monotone {\n\tconstructor(info: { closed: boolean }) {\n\t\tsuper(false, info);\n\t}\n}\n\nexport class MonotoneY extends Monotone {\n\tconstructor(info: { closed: boolean }) {\n\t\tsuper(true, info);\n\t}\n}\n\n\n/**\n * @ignore Exclude from docs\n * @todo Description\n */\nexport class Basis implements ISmoothing {\n\n\t/**\n\t * [_closed description]\n\t *\n\t * @ignore Exclude from docs\n\t * @todo Description\n\t */\n\tprivate _closed: boolean;\n\n\t/**\n\t * Constructor.\n\t *\n\t * @param info  [description]\n\t */\n\tconstructor(info: { closed: boolean }) {\n\t\tthis._closed = info.closed;\n\t}\n\n\t/**\n\t * [smooth description]\n\t *\n\t * @ignore Exclude from docs\n\t * @todo Description\n\t * @param points  [description]\n\t * @return [description]\n\t */\n\tpublic smooth(points: Array<IPoint>): string {\n\t\tlet x0: number = NaN;\n\t\tlet x1: number = NaN;\n\t\tlet x2: number = NaN;\n\t\tlet x3: number = NaN;\n\t\tlet x4: number = NaN;\n\t\tlet y0: number = NaN;\n\t\tlet y1: number = NaN;\n\t\tlet y2: number = NaN;\n\t\tlet y3: number = NaN;\n\t\tlet y4: number = NaN;\n\t\tlet point: number = 0;\n\n\t\tlet output = \"\";\n\n\t\tconst pushCurve = (x: number, y: number): void => {\n\t\t\toutput += $path.cubicCurveTo(\n\t\t\t\t{\n\t\t\t\t\tx: (x0 + 4 * x1 + x) / 6\n\t\t\t\t\t, y: (y0 + 4 * y1 + y) / 6\n\t\t\t\t},\n\n\t\t\t\t{\n\t\t\t\t\tx: (2 * x0 + x1) / 3\n\t\t\t\t\t, y: (2 * y0 + y1) / 3\n\t\t\t\t},\n\n\t\t\t\t{\n\t\t\t\t\tx: (x0 + 2 * x1) / 3\n\t\t\t\t\t, y: (y0 + 2 * y1) / 3\n\t\t\t\t}\n\t\t\t);\n\t\t};\n\n\t\tconst pushPoint = ({ x, y }: IPoint): void => {\n\t\t\tswitch (point) {\n\t\t\t\tcase 0:\n\t\t\t\t\tpoint = 1;\n\n\t\t\t\t\tif (this._closed) {\n\t\t\t\t\t\tx2 = x;\n\t\t\t\t\t\ty2 = y;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput += $path.lineTo({ x, y });\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 1:\n\t\t\t\t\tpoint = 2;\n\n\t\t\t\t\tif (this._closed) {\n\t\t\t\t\t\tx3 = x;\n\t\t\t\t\t\ty3 = y;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\tpoint = 3;\n\n\t\t\t\t\tif (this._closed) {\n\t\t\t\t\t\tx4 = x;\n\t\t\t\t\t\ty4 = y;\n\t\t\t\t\t\toutput += $path.moveTo({ x: (x0 + 4 * x1 + x) / 6, y: (y0 + 4 * y1 + y) / 6 });\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput += $path.lineTo({ x: (5 * x0 + x1) / 6, y: (5 * y0 + y1) / 6 });\n\t\t\t\t\t\t// fall-through\n\t\t\t\t\t}\n\n\t\t\t\tdefault:\n\t\t\t\t\tpushCurve(x, y);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tx0 = x1;\n\t\t\tx1 = x;\n\t\t\ty0 = y1;\n\t\t\ty1 = y;\n\t\t};\n\n\t\t$array.each(points, pushPoint);\n\n\t\tif (this._closed) {\n\t\t\tswitch (point) {\n\t\t\t\tcase 1:\n\t\t\t\t\toutput += $path.moveTo({ x: x2, y: y2 });\n\t\t\t\t\toutput += $path.closePath();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\toutput += $path.moveTo({ x: (x2 + 2 * x3) / 3, y: (y2 + 2 * y3) / 3 });\n\t\t\t\t\toutput += $path.lineTo({ x: (x3 + 2 * x2) / 3, y: (y3 + 2 * y2) / 3 });\n\t\t\t\t\toutput += $path.closePath();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tpushPoint({ x: x2, y: y2 });\n\t\t\t\t\tpushPoint({ x: x3, y: y3 });\n\t\t\t\t\tpushPoint({ x: x4, y: y4 });\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t} else {\n\t\t\tswitch (point) {\n\t\t\t\tcase 3:\n\t\t\t\t\tpushCurve(x1, y1);\n\t\t\t\t// fall-through\n\t\t\t\tcase 2:\n\t\t\t\t\toutput += $path.lineTo({ x: x1, y: y1 });\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\toutput += $path.closePath();\n\t\t}\n\n\t\treturn output;\n\t}\n\n}\n","/**\r\n * [[AMElement]] represents any SVG element and related functionality.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { IRectangle } from \"../defs/IRectangle\";\r\nimport { IDisposer } from \"../utils/Disposer\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport * as $dom from \"../utils/DOM\";\r\nimport * as $object from \"../utils/Object\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines available SVG attributes.\r\n */\r\nexport type SVGAttribute =\r\n\t\"accent-height\" | \"accumulate\" | \"additive\" | \"alignment-baseline\" | \"allowReorder\" | \"alphabetic\" | \"amplitude\" | \"arabic-form\" | \"aria-checked\" | \"aria-describedby\" | \"aria-hidden\" | \"aria-label\" | \"aria-labelledby\" | \"aria-live\" | \"aria-controls\" | \"aria-orientation\" | \"aria-valuemax\" | \"aria-valuemin\" | \"aria-valuenow\" | \"aria-valuetext\" | \"ascent\" | \"attributeName\" | \"attributeType\" | \"autoReverse\" | \"azimuth\" | \"baseFrequency\" | \"baseline-shift\" | \"baseProfile\" | \"bbox\" | \"begin\" | \"bias\" | \"by\" | \"calcMode\" | \"cap-height\" | \"class\" | \"clip\" | \"clipPathUnits\" | \"clip-path\" | \"clip-rule\" | \"color\" | \"color-interpolation\" | \"color-interpolation-filters\" | \"color-profile\" | \"color-rendering\" | \"contentScriptType\" | \"contentStyleType\" | \"cursor\" | \"cx\" | \"cy\" | \"d\" | \"decelerate\" | \"descent\" | \"diffuseConstant\" | \"direction\" | \"display\" | \"divisor\" | \"dominant-baseline\" | \"dur\" | \"dx\" | \"dy\" | \"edgeMode\" | \"elevation\" | \"enable-background\" | \"end\" | \"exponent\" | \"externalResourcesRequired\" | \"fill\" | \"fill-opacity\" | \"fill-rule\" | \"filter\" | \"filterRes\" | \"filterUnits\" | \"flood-color\" | \"flood-opacity\" | \"focusable\" | \"font-family\" | \"font-size\" | \"font-size-adjust\" | \"font-stretch\" | \"font-style\" | \"font-variant\" | \"font-weight\" | \"format\" | \"from\" | \"fx\" | \"fy\" | \"g1\" | \"g2\" | \"glyph-name\" | \"glyph-orientation-horizontal\" | \"glyph-orientation-vertical\" | \"glyphRef\" | \"gradientTransform\" | \"gradientUnits\" | \"hanging\" | \"height\" | \"href\" | \"horiz-adv-x\" | \"horiz-origin-x\" | \"id\" | \"ideographic\" | \"image-rendering\" | \"in\" | \"in2\" | \"intercept\" | \"k\" | \"k1\" | \"k2\" | \"k3\" | \"k4\" | \"kernelMatrix\" | \"kernelUnitLength\" | \"kerning\" | \"keyPoints\" | \"keySplines\" | \"keyTimes\" | \"lang\" | \"lengthAdjust\" | \"letter-spacing\" | \"lighting-color\" | \"limitingConeAngle\" | \"local\" | \"marker-end\" | \"marker-mid\" | \"marker-start\" | \"markerHeight\" | \"markerUnits\" | \"markerWidth\" | \"mask\" | \"maskContentUnits\" | \"maskUnits\" | \"mathematical\" | \"max\" | \"media\" | \"method\" | \"min\" | \"mode\" | \"name\" | \"numOctaves\" | \"offset\" | \"onabort\" | \"onactivate\" | \"onbegin\" | \"onclick\" | \"onend\" | \"onerror\" | \"onfocusin\" | \"onfocusout\" | \"onload\" | \"onmousedown\" | \"onmousemove\" | \"onmouseout\" | \"onmouseover\" | \"onmouseup\" | \"onrepeat\" | \"onresize\" | \"onscroll\" | \"onunload\" | \"onzoom\" | \"opacity\" | \"operator\" | \"order\" | \"orient\" | \"orientation\" | \"origin\" | \"overflow\" | \"overline-position\" | \"overline-thickness\" | \"panose-1\" | \"paint-order\" | \"pathLength\" | \"patternContentUnits\" | \"patternTransform\" | \"patternUnits\" | \"pointer-events\" | \"points\" | \"pointsAtX\" | \"pointsAtY\" | \"pointsAtZ\" | \"preserveAlpha\" | \"preserveAspectRatio\" | \"primitiveUnits\" | \"r\" | \"radius\" | \"refX\" | \"refY\" | \"rendering-intent\" | \"repeatCount\" | \"repeatDur\" | \"requiredExtensions\" | \"requiredFeatures\" | \"restart\" | \"result\" | \"role\" | \"rotate\" | \"rx\" | \"ry\" | \"scale\" | \"seed\" | \"shape-rendering\" | \"slope\" | \"spacing\" | \"specularConstant\" | \"specularExponent\" | \"speed\" | \"spreadMethod\" | \"startOffset\" | \"stdDeviation\" | \"stemh\" | \"stemv\" | \"stitchTiles\" | \"stop-color\" | \"stop-opacity\" | \"strikethrough-position\" | \"strikethrough-thickness\" | \"string\" | \"stroke\" | \"stroke-dasharray\" | \"stroke-dashoffset\" | \"stroke-linecap\" | \"stroke-linejoin\" | \"stroke-miterlimit\" | \"stroke-opacity\" | \"stroke-width\" | \"style\" | \"surfaceScale\" | \"systemLanguage\" | \"tabindex\" | \"tableValues\" | \"target\" | \"targetX\" | \"targetY\" | \"text-anchor\" | \"text-decoration\" | \"text-rendering\" | \"textLength\" | \"to\" | \"transform\" | \"type\" | \"u1\" | \"u2\" | \"underline-position\" | \"underline-thickness\" | \"unicode\" | \"unicode-bidi\" | \"unicode-range\" | \"units-per-em\" | \"v-alphabetic\" | \"v-hanging\" | \"v-ideographic\" | \"v-mathematical\" | \"values\" | \"version\" | \"vert-adv-y\" | \"vert-origin-x\" | \"vert-origin-y\" | \"viewBox\" | \"viewTarget\" | \"visibility\" | \"width\" | \"widths\" | \"word-spacing\" | \"writing-mode\" | \"x\" | \"x-height\" | \"x1\" | \"x2\" | \"xChannelSelector\" | \"xlink:actuate\" | \"xlink:arcrole\" | \"xlink:href\" | \"xlink:role\" | \"xlink:show\" | \"xlink:title\" | \"xlink:type\" | \"xml:base\" | \"xml:lang\" | \"xml:space\" | \"y\" | \"y1\" | \"y2\" | \"yChannelSelector\" | \"z\" | \"zoomAndPan\";\r\n\r\n/**\r\n * Represents an interface for SVG attributes.\r\n *\r\n * This is a collection of all properties that an SVG element can have.\r\n */\r\nexport interface ISVGAttribute {\r\n\t\"accent-height\"?: any;\r\n\t\"accumulate\"?: any;\r\n\t\"additive\"?: any;\r\n\t\"alignment-baseline\"?: any;\r\n\t\"allowReorder\"?: any;\r\n\t\"alphabetic\"?: any;\r\n\t\"amplitude\"?: any;\r\n\t\"arabic-form\"?: any;\r\n\t\"aria-checked\"?: any;\r\n\t\"aria-describedby\"?: any;\r\n\t\"aria-hidden\"?: any;\r\n\t\"aria-label\"?: any;\r\n\t\"aria-labelledby\"?: any;\r\n\t\"aria-live\"?: any;\r\n\t\"aria-controls\"?: any;\r\n\t\"aria-orientation\"?: any;\r\n\t\"aria-valuemax\"?: any;\r\n\t\"aria-valuemin\"?: any;\r\n\t\"aria-valuenow\"?: any;\r\n\t\"aria-valuetext\"?: any;\r\n\t\"ascent\"?: any;\r\n\t\"attributeName\"?: any;\r\n\t\"attributeType\"?: any;\r\n\t\"autoReverse\"?: any;\r\n\t\"azimuth\"?: any;\r\n\t\"baseFrequency\"?: any;\r\n\t\"baseline-shift\"?: any;\r\n\t\"baseProfile\"?: any;\r\n\t\"bbox\"?: any;\r\n\t\"begin\"?: any;\r\n\t\"bias\"?: any;\r\n\t\"by\"?: any;\r\n\t\"calcMode\"?: any;\r\n\t\"cap-height\"?: any;\r\n\t\"class\"?: any;\r\n\t\"clip\"?: any;\r\n\t\"clipPathUnits\"?: any;\r\n\t\"clip-path\"?: any;\r\n\t\"clip-rule\"?: any;\r\n\t\"color\"?: any;\r\n\t\"color-interpolation\"?: any;\r\n\t\"color-interpolation-filters\"?: any;\r\n\t\"color-profile\"?: any;\r\n\t\"color-rendering\"?: any;\r\n\t\"contentScriptType\"?: any;\r\n\t\"contentStyleType\"?: any;\r\n\t\"cursor\"?: any;\r\n\t\"cx\"?: any;\r\n\t\"cy\"?: any;\r\n\t\"d\"?: any;\r\n\t\"decelerate\"?: any;\r\n\t\"descent\"?: any;\r\n\t\"diffuseConstant\"?: any;\r\n\t\"direction\"?: any;\r\n\t\"display\"?: any;\r\n\t\"divisor\"?: any;\r\n\t\"dominant-baseline\"?: any;\r\n\t\"dur\"?: any;\r\n\t\"dx\"?: any;\r\n\t\"dy\"?: any;\r\n\t\"edgeMode\"?: any;\r\n\t\"elevation\"?: any;\r\n\t\"enable-background\"?: any;\r\n\t\"end\"?: any;\r\n\t\"exponent\"?: any;\r\n\t\"externalResourcesRequired\"?: any;\r\n\t\"fill\"?: any;\r\n\t\"fill-opacity\"?: any;\r\n\t\"fill-rule\"?: any;\r\n\t\"filter\"?: any;\r\n\t\"filterRes\"?: any;\r\n\t\"filterUnits\"?: any;\r\n\t\"flood-color\"?: any;\r\n\t\"flood-opacity\"?: any;\r\n\t\"focusable\"?: any;\r\n\t\"font-family\"?: any;\r\n\t\"font-size\"?: any;\r\n\t\"font-size-adjust\"?: any;\r\n\t\"font-stretch\"?: any;\r\n\t\"font-style\"?: any;\r\n\t\"font-variant\"?: any;\r\n\t\"font-weight\"?: any;\r\n\t\"format\"?: any;\r\n\t\"from\"?: any;\r\n\t\"fx\"?: any;\r\n\t\"fy\"?: any;\r\n\t\"g1\"?: any;\r\n\t\"g2\"?: any;\r\n\t\"glyph-name\"?: any;\r\n\t\"glyph-orientation-horizontal\"?: any;\r\n\t\"glyph-orientation-vertical\"?: any;\r\n\t\"glyphRef\"?: any;\r\n\t\"gradientTransform\"?: any;\r\n\t\"gradientUnits\"?: any;\r\n\t\"hanging\"?: any;\r\n\t\"height\"?: any;\r\n\t\"href\"?: any;\r\n\t\"horiz-adv-x\"?: any;\r\n\t\"horiz-origin-x\"?: any;\r\n\t\"id\"?: any;\r\n\t\"ideographic\"?: any;\r\n\t\"image-rendering\"?: any;\r\n\t\"in\"?: any;\r\n\t\"in2\"?: any;\r\n\t\"intercept\"?: any;\r\n\t\"k\"?: any;\r\n\t\"k1\"?: any;\r\n\t\"k2\"?: any;\r\n\t\"k3\"?: any;\r\n\t\"k4\"?: any;\r\n\t\"kernelMatrix\"?: any;\r\n\t\"kernelUnitLength\"?: any;\r\n\t\"kerning\"?: any;\r\n\t\"keyPoints\"?: any;\r\n\t\"keySplines\"?: any;\r\n\t\"keyTimes\"?: any;\r\n\t\"lang\"?: any;\r\n\t\"lengthAdjust\"?: any;\r\n\t\"letter-spacing\"?: any;\r\n\t\"lighting-color\"?: any;\r\n\t\"limitingConeAngle\"?: any;\r\n\t\"local\"?: any;\r\n\t\"marker-end\"?: any;\r\n\t\"marker-mid\"?: any;\r\n\t\"marker-start\"?: any;\r\n\t\"markerHeight\"?: any;\r\n\t\"markerUnits\"?: any;\r\n\t\"markerWidth\"?: any;\r\n\t\"mask\"?: any;\r\n\t\"maskContentUnits\"?: any;\r\n\t\"maskUnits\"?: any;\r\n\t\"mathematical\"?: any;\r\n\t\"max\"?: any;\r\n\t\"media\"?: any;\r\n\t\"method\"?: any;\r\n\t\"min\"?: any;\r\n\t\"mode\"?: any;\r\n\t\"name\"?: any;\r\n\t\"numOctaves\"?: any;\r\n\t\"offset\"?: any;\r\n\t\"onabort\"?: any;\r\n\t\"onactivate\"?: any;\r\n\t\"onbegin\"?: any;\r\n\t\"onclick\"?: any;\r\n\t\"onend\"?: any;\r\n\t\"onerror\"?: any;\r\n\t\"onfocusin\"?: any;\r\n\t\"onfocusout\"?: any;\r\n\t\"onload\"?: any;\r\n\t\"onmousedown\"?: any;\r\n\t\"onmousemove\"?: any;\r\n\t\"onmouseout\"?: any;\r\n\t\"onmouseover\"?: any;\r\n\t\"onmouseup\"?: any;\r\n\t\"onrepeat\"?: any;\r\n\t\"onresize\"?: any;\r\n\t\"onscroll\"?: any;\r\n\t\"onunload\"?: any;\r\n\t\"onzoom\"?: any;\r\n\t\"opacity\"?: any;\r\n\t\"operator\"?: any;\r\n\t\"order\"?: any;\r\n\t\"orient\"?: any;\r\n\t\"orientation\"?: any;\r\n\t\"origin\"?: any;\r\n\t\"overflow\"?: any;\r\n\t\"overline-position\"?: any;\r\n\t\"overline-thickness\"?: any;\r\n\t\"panose-1\"?: any;\r\n\t\"paint-order\"?: any;\r\n\t\"path\"?: any;\r\n\t\"pathLength\"?: any;\r\n\t\"patternContentUnits\"?: any;\r\n\t\"patternTransform\"?: any;\r\n\t\"patternUnits\"?: any;\r\n\t\"pointer-events\"?: any;\r\n\t\"points\"?: any;\r\n\t\"pointsAtX\"?: any;\r\n\t\"pointsAtY\"?: any;\r\n\t\"pointsAtZ\"?: any;\r\n\t\"preserveAlpha\"?: any;\r\n\t\"preserveAspectRatio\"?: any;\r\n\t\"primitiveUnits\"?: any;\r\n\t\"r\"?: any;\r\n\t\"radius\"?: any;\r\n\t\"refX\"?: any;\r\n\t\"refY\"?: any;\r\n\t\"rendering-intent\"?: any;\r\n\t\"repeatCount\"?: any;\r\n\t\"repeatDur\"?: any;\r\n\t\"requiredExtensions\"?: any;\r\n\t\"requiredFeatures\"?: any;\r\n\t\"restart\"?: any;\r\n\t\"result\"?: any;\r\n\t\"role\"?: any;\r\n\t\"rotate\"?: any;\r\n\t\"rx\"?: any;\r\n\t\"ry\"?: any;\r\n\t\"scale\"?: any;\r\n\t\"seed\"?: any;\r\n\t\"shape-rendering\"?: any;\r\n\t\"slope\"?: any;\r\n\t\"spacing\"?: any;\r\n\t\"specularConstant\"?: any;\r\n\t\"specularExponent\"?: any;\r\n\t\"speed\"?: any;\r\n\t\"spreadMethod\"?: any;\r\n\t\"startOffset\"?: any;\r\n\t\"stdDeviation\"?: any;\r\n\t\"stemh\"?: any;\r\n\t\"stemv\"?: any;\r\n\t\"stitchTiles\"?: any;\r\n\t\"stop-color\"?: any;\r\n\t\"stop-opacity\"?: any;\r\n\t\"strikethrough-position\"?: any;\r\n\t\"strikethrough-thickness\"?: any;\r\n\t\"string\"?: any;\r\n\t\"stroke\"?: any;\r\n\t\"stroke-dasharray\"?: any;\r\n\t\"stroke-dashoffset\"?: any;\r\n\t\"stroke-linecap\"?: any;\r\n\t\"stroke-linejoin\"?: any;\r\n\t\"stroke-miterlimit\"?: any;\r\n\t\"stroke-opacity\"?: any;\r\n\t\"stroke-width\"?: any;\r\n\t\"style\"?: any;\r\n\t\"surfaceScale\"?: any;\r\n\t\"systemLanguage\"?: any;\r\n\t\"tabindex\"?: any;\r\n\t\"tableValues\"?: any;\r\n\t\"target\"?: any;\r\n\t\"targetX\"?: any;\r\n\t\"targetY\"?: any;\r\n\t\"text-anchor\"?: any;\r\n\t\"text-decoration\"?: any;\r\n\t\"text-rendering\"?: any;\r\n\t\"textLength\"?: any;\r\n\t\"to\"?: any;\r\n\t\"transform\"?: any;\r\n\t\"type\"?: any;\r\n\t\"u1\"?: any;\r\n\t\"u2\"?: any;\r\n\t\"underline-position\"?: any;\r\n\t\"underline-thickness\"?: any;\r\n\t\"unicode\"?: any;\r\n\t\"unicode-bidi\"?: any;\r\n\t\"unicode-range\"?: any;\r\n\t\"units-per-em\"?: any;\r\n\t\"v-alphabetic\"?: any;\r\n\t\"v-hanging\"?: any;\r\n\t\"v-ideographic\"?: any;\r\n\t\"v-mathematical\"?: any;\r\n\t\"values\"?: any;\r\n\t\"version\"?: any;\r\n\t\"vert-adv-y\"?: any;\r\n\t\"vert-origin-x\"?: any;\r\n\t\"vert-origin-y\"?: any;\r\n\t\"viewBox\"?: any;\r\n\t\"viewTarget\"?: any;\r\n\t\"visibility\"?: any;\r\n\t\"width\"?: any;\r\n\t\"widths\"?: any;\r\n\t\"word-spacing\"?: any;\r\n\t\"writing-mode\"?: any;\r\n\t\"x\"?: any;\r\n\t\"x-height\"?: any;\r\n\t\"x1\"?: any;\r\n\t\"x2\"?: any;\r\n\t\"xChannelSelector\"?: any;\r\n\t\"xlink:actuate\"?: any;\r\n\t\"xlink:arcrole\"?: any;\r\n\t\"xlink:href\"?: any;\r\n\t\"xlink:role\"?: any;\r\n\t\"xlink:show\"?: any;\r\n\t\"xlink:title\"?: any;\r\n\t\"xlink:type\"?: any;\r\n\t\"xml:base\"?: any;\r\n\t\"xml:lang\"?: any;\r\n\t\"xml:space\"?: any;\r\n\t\"y\"?: any;\r\n\t\"y1\"?: any;\r\n\t\"y2\"?: any;\r\n\t\"yChannelSelector\"?: any;\r\n\t\"z\"?: any;\r\n\t\"zoomAndPan\"?: any;\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * A base class for all SVG elements. Provides low-level DOM functionality.\r\n *\r\n * All visual elements extend this class.\r\n */\r\nexport class AMElement implements IDisposer {\r\n\r\n\t/**\r\n\t * Indicates if the element was already disposed.\r\n\t */\r\n\tprotected _isDisposed: boolean = false;\r\n\r\n\t/**\r\n\t * An SVG node of the element.\r\n\t */\r\n\tpublic node: SVGSVGElement;\r\n\r\n\t/**\r\n\t * Current X coordinate.\r\n\t */\r\n\tprivate _x: number = 0;\r\n\r\n\t/**\r\n\t * Current Y coordinate.\r\n\t */\r\n\tprivate _y: number = 0;\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tprivate _rotationY: number = 0;\t\r\n\r\n\t/**\r\n\t * \r\n\t */\r\n\tprivate _rotationX: number = 0;\t\t\r\n\r\n\t/**\r\n\t * Current rotation.\r\n\t */\r\n\tprivate _rotation: number = 0;\r\n\r\n\t/**\r\n\t * Current scale.\r\n\t */\r\n\tprivate _scale: number = 1;\r\n\r\n\t/**\r\n\t * current value of transfrom string\r\n\t */\r\n\tprivate _transformString:string;\r\n\r\n\t/**\r\n\t * Constructor creates a new element or uses the one that was passed in.\r\n\t *\r\n\t * @param element Element reference node type\r\n\t */\r\n\tconstructor(element: string | SVGSVGElement) {\r\n\t\tif (typeof element === \"string\") {\r\n\t\t\tthis.node = <SVGSVGElement>document.createElementNS($dom.SVGNS, element);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.node = element;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes element's node from DOM.\r\n\t */\r\n\tpublic removeNode(): void {\r\n\t\tif (this.node) {\r\n\t\t\tif (this.node.parentNode) {\r\n\t\t\t\tthis.node.parentNode.removeChild(this.node);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `transform` attribute of the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Transform attribute value\r\n\t */\r\n\tpublic get transformString(): $type.Optional<string> {\r\n\t\tif (this.node) {\r\n\r\n\t\t\treturn this._transformString;\r\n\t\t\t/*\r\n\t\t\tconst value = this.node.getAttribute(\"transform\");\r\n\r\n\t\t\tif (value !== null) {\r\n\t\t\t\treturn value;\r\n\t\t\t}*/\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Appply position, rotation and scale properties via elemen's `transform`\r\n\t * property\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic transform(): void {\r\n\r\n\t\tlet transfromString = \"translate(\" + this._x + \",\" + this._y + \")\";\r\n\r\n\t\tif (this._scale != 1) {\r\n\t\t\ttransfromString += ((transfromString ? \" \" : \"\") + \"scale(\" + this._scale + \")\");\r\n\t\t}\r\n\r\n\t\tif (this._rotation != 0) {\r\n\t\t\tlet rotateString = \"rotate(\" + this._rotation + \")\";\r\n\r\n\t\t\tif(this._rotationX && this._rotationY){\r\n\t\t\t\trotateString = \"rotate(\" + this._rotation + \" \" + this._rotationX + \" \" + this._rotationY + \")\";\r\n\t\t\t}\r\n\r\n\t\t\ttransfromString += ((transfromString ? \" \" : \"\") + rotateString);\r\n\t\t}\r\n\r\n\t\tthis._transformString = transfromString;\r\n\r\n\t\tthis.node.setAttribute(\"transform\", transfromString);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns bounding box of the element.\r\n\t *\r\n\t * ATTENTION: Bounding box calculations are extremely costly so should be\r\n\t * used sparingly and cached whenever possible.\r\n\t *\r\n\t * @return Bounding rectangle\r\n\t */\r\n\tpublic getBBox(): IRectangle {\r\n\t\tlet bbox: IRectangle = {\r\n\t\t\twidth: 0,\r\n\t\t\theight: 0,\r\n\t\t\tx: 0,\r\n\t\t\ty: 0\r\n\t\t};\r\n\r\n\t\t// FF would fail if getBBox() is called without node added to parent\r\n\t\tif (this.node && this.node.parentNode) {\r\n\t\t\t\r\n\t\t\ttry { // again for ff. TODO: check if this doesn't slow down\r\n\t\t\t\tlet svgbbox = this.node.getBBox();\r\n\t\t\t\tbbox.x = svgbbox.x;\r\n\t\t\t\tbbox.y = svgbbox.y;\r\n\t\t\t\tbbox.width = svgbbox.width;\r\n\t\t\t\tbbox.height = svgbbox.height;\r\n\t\t\t} catch (err) { }\r\n\t\t}\r\n\r\n\t\treturn bbox;\r\n\t}\r\n\r\n\t/**\r\n\t * Moves the element to new coordinates.\r\n\t *\r\n\t * @param x  Target X\r\n\t * @param y  Target Y\r\n\t */\r\n\tpublic moveTo(point: IPoint): void {\r\n\t\tif (point) {\r\n\t\t\tlet x: number = point.x;\r\n\t\t\tlet y: number = point.y;\r\n\t\t\tif (this._x != x || this._y != y) {\r\n\t\t\t\tthis._x = x;\r\n\t\t\t\tthis._y = y;\r\n\t\t\t\tthis.transform();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Element's SVG contents.\r\n\t *\r\n\t * @param value Contents\r\n\t */\r\n\tpublic set content(value: string) {\r\n\t\t// @todo Do not use `innerHTML` as this is not reliable and will not work on all browsers\r\n\t\tthis.node.innerHTML = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns element's contents as SVG markup.\r\n\t *\r\n\t * @return Contents\r\n\t */\r\n\tpublic get content(): string {\r\n\t\t// @todo Do not use `innerHTML` as this is not reliable and will not work on all browsers\r\n\t\treturn this.node.innerHTML || \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Text contents of the SVG element.\r\n\t *\r\n\t * @param value Text contents\r\n\t */\r\n\tpublic set textContent(value: string) {\r\n\t\tthis.node.textContent = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Text contents\r\n\t */\r\n\tpublic get textContent(): string {\r\n\t\treturn this.node.textContent || \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Element's X position in pixels.\r\n\t *\r\n\t * @param value  X coordinate (px)\r\n\t */\r\n\tpublic set x(value: number) {\r\n\t\tif (this._x != value) {\r\n\t\t\tthis._x = value;\r\n\t\t\tthis.transform();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return X coordinate (px)\r\n\t */\r\n\tpublic get x(): number {\r\n\t\treturn this._x;\r\n\t}\r\n\r\n\t/**\r\n\t * Element's Y position in pixels.\r\n\t *\r\n\t * @param value Y coordinate (px)\r\n\t */\r\n\tpublic set y(value: number) {\r\n\t\tif (this._y != value) {\r\n\t\t\tthis._y = value;\r\n\t\t\tthis.transform();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Y coordinate (px)\r\n\t */\r\n\tpublic get y(): number {\r\n\t\treturn this._y;\r\n\t}\r\n\r\n\t/**\r\n\t * Element's rotation in degrees.\r\n\t *\r\n\t * @param value Rotation\r\n\t */\r\n\tpublic set rotation(angle: number) {\r\n\t\tif (this._rotation != angle) {\r\n\t\t\tthis._rotation = angle;\r\n\t\t\tthis.transform();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Rotation\r\n\t */\r\n\tpublic get rotation(): number {\r\n\t\treturn this._rotation;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic set rotationX(x: number) {\r\n\t\tif (this._rotationX != x) {\r\n\t\t\tthis._rotationX = x;\r\n\t\t\tthis.transform();\r\n\t\t}\r\n\t}\t\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic get rotationX():number{\r\n\t\treturn this._rotationX;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic set rotationY(y: number) {\r\n\t\tif (this._rotationY != y) {\r\n\t\t\tthis._rotationY = y;\r\n\t\t\tthis.transform();\r\n\t\t}\r\n\t}\t\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic get rotationY():number{\r\n\t\treturn this._rotationY;\r\n\t}\t\r\n\r\n\t/**\r\n\t * Element's scale where 1 is original size.\r\n\t *\r\n\t * Setting to 0.5 will reduce element's size by 50%, 2 will make element\r\n\t * twice as large, etc.\r\n\t *\r\n\t * @param value Scale\r\n\t */\r\n\tpublic set scale(value: number) {\r\n\t\tif (this._scale != value) {\r\n\t\t\tthis._scale = value;\r\n\t\t\tthis.transform();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Scale\r\n\t */\r\n\tpublic get scale(): number {\r\n\t\treturn this._scale;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes an attribute from element.\r\n\t *\r\n\t * @param attribute  Attribute to remove\r\n\t */\r\n\tpublic removeAttr(attribute: string): void {\r\n\t\tthis.node.removeAttribute(attribute);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a set of attributes on a element.\r\n\t *\r\n\t * @param attributes  An object with attribute names (key) and values\r\n\t * @return The same element\r\n\t */\r\n\tpublic attr(attributes: ISVGAttribute): AMElement {\r\n\t\t$object.each(attributes, (attributeName, attributeValue) => {\r\n\t\t\tif (!$type.hasValue(attributeValue)) {\r\n\t\t\t\tthis.node.removeAttribute(attributeName);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// this is for performance testing\r\n\t\t\t\t//if(attributeValue == this.node.getAttribute(attributeName)){\r\n\t\t\t\t//\tconsole.log(attributeName, attributeValue)\r\n\t\t\t\t//}\r\n\t\t\t\tthis.node.setAttribute(attributeName, attributeValue);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a value of a node attribute.\r\n\t *\r\n\t * @param attribute  Attribute name\r\n\t * @return Attribute value\r\n\t */\r\n\tpublic getAttr(attribute: string): string | null {\r\n\t\treturn this.node.getAttribute(attribute);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a single attribute of the element's node using namesspace.\r\n\t *\r\n\t * @param ns         Namespace\r\n\t * @param attribute  Attribute\r\n\t * @param value      Value\r\n\t * @return The same element\r\n\t */\r\n\tpublic attrNS(ns: string, attribute: string, value: string): AMElement {\r\n\t\tthis.node.setAttributeNS(ns, attribute, value);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a namespaced attribute value from node.\r\n\t *\r\n\t * @param ns         Namespace\r\n\t * @param attribute  Attribute\r\n\t * @return Attribute value\r\n\t */\r\n\tpublic getAttrNS(ns: string, attribute: string): string {\r\n\t\treturn this.node.getAttributeNS(ns, attribute);\r\n\t}\r\n\r\n\t/**\r\n\t * Removes `style` attribute from node.\r\n\t *\r\n\t * @param attribute  Attribute to remove\r\n\t */\r\n\tpublic removeStyle(attribute: string): void {\r\n\t\t// @todo Review because it's a bit messy and maybe not needed (pratically not used)\r\n\t\t(<any>this.node.style)[attribute] = null;\r\n\t\tdelete (<any>this.node.style)[attribute];\r\n\t}\r\n\r\n\t/**\r\n\t * Returns style attribute value.\r\n\t *\r\n\t * @param attribute  Style attribute value\r\n\t * @return Attribute value\r\n\t */\r\n\tpublic getStyle(attribute: string): string {\r\n\t\t// @todo Review because it's a bit messy and maybe not needed (pratically not used)\r\n\t\treturn (<any>this.node.style)[attribute];\r\n\t}\r\n\r\n\t/**\r\n\t * Adds style attributes to element's node.\r\n\t *\r\n\t * @param attributes  Object containing attribute: value pairs\r\n\t * @return The same element\r\n\t */\r\n\tpublic addStyle(attributes: Object): AMElement {\r\n\t\t// @todo Review because it's a bit messy and maybe not needed (pratically not used)\r\n\t\t$object.each(attributes, (attributeName, attributeValue) => {\r\n\t\t\tif (!$type.hasValue(attributeValue)) {\r\n\t\t\t\tthis.removeStyle(attributeName);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t(<any>this.node.style)[attributeName] = attributeValue;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a class to element.\r\n\t *\r\n\t * @param name  Class name\r\n\t */\r\n\tpublic addClass(name: string): void {\r\n\t\t$dom.addClass(this.node, name);\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a class from element.\r\n\t *\r\n\t * @param name Class name\r\n\t */\r\n\tpublic removeClass(name: string): void {\r\n\t\t$dom.removeClass(this.node, name);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a class name on element.\r\n\t *\r\n\t * @param name  Class name\r\n\t */\r\n\tpublic setClass(name: string): void {\r\n\t\tthis.node.setAttribute(\"class\", name);\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all element's child nodes, basically leaving it empty.\r\n\t */\r\n\tpublic removeChildNodes(): void {\r\n\t\t// remove all children\r\n\t\twhile (this.node.childNodes.length > 0) {\r\n\t\t\tthis.node.removeChild(this.node.firstChild!);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Was this element already been disposed?\r\n\t *\r\n\t * @return Disposed?\r\n\t */\r\n\tpublic isDisposed(): boolean {\r\n\t\treturn this._isDisposed;\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes element.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tthis.removeNode();\r\n\t}\r\n\r\n}\r\n","/**\r\n * Functionality for drawing rectangles.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite, ISpriteProperties, ISpriteAdapters, ISpriteEvents } from \"../Sprite\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $math from \"../utils/Math\";\r\nimport { IRectangle } from \"../defs/IRectangle\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[Rectangle]].\r\n */\r\nexport interface IRectangleProperties extends ISpriteProperties { }\r\n\r\n/**\r\n * Defines events for [[Rectangle]].\r\n */\r\nexport interface IRectangleEvents extends ISpriteEvents { }\r\n\r\n/**\r\n * Defines adapters for [[Rectangle]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IRectangleAdapters extends ISpriteAdapters, IRectangleProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Used to draw a rectangle.\r\n *\r\n * @see {@link IRectangleEvents} for a list of available events\r\n * @see {@link IRectangleAdapters} for a list of available Adapters\r\n */\r\nexport class Rectangle extends Sprite {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IRectangleProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IRectangleAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IRectangleEvents;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t * * Creates a `<rect>` element\r\n\t * * Creates default state\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"Rectangle\";\r\n\t\tthis.element = this.paper.add(\"rect\");\r\n\t\t//this.pixelPerfect = false;\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic draw(): void {\r\n\t\tsuper.draw();\r\n\r\n\t\tlet precision: number = this._positionPrecision;\r\n\t\tif (this.pixelPerfect) {\r\n\t\t\tprecision = 0;\r\n\t\t}\r\n\r\n\t\tlet w: number = $math.round(this.innerWidth, precision);\r\n\t\tlet h: number = $math.round(this.innerHeight, precision);\r\n\r\n\t\tthis.element.attr({\r\n\t\t\t\"width\": w,\r\n\t\t\t\"height\": h\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Measures the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic measureElement(): void {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns bounding box (square) for this element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic get bbox(): IRectangle {\r\n\t\tif (this.definedBBox) {\r\n\t\t\treturn this.definedBBox;\r\n\t\t}\r\n\r\n\t\tif (this.isMeasured) {\r\n\t\t\treturn {\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0,\r\n\t\t\t\twidth: this.innerWidth,\r\n\t\t\t\theight: this.innerHeight\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn { x: 0, y: 0, width: 0, height: 0 };\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Rectangle\"] = Rectangle;\r\n","/**\r\n * Polyline module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite, ISpriteProperties, ISpriteAdapters, ISpriteEvents } from \"../Sprite\";\r\nimport { IPoint, IOrientationPoint } from \"../defs/IPoint\";\r\nimport { color } from \"../utils/Color\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $path from \"../rendering/Path\";\r\nimport * as $math from \"../utils/Math\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[Polyline]].\r\n */\r\nexport interface IPolylineProperties extends ISpriteProperties {\r\n\r\n\t/**\r\n\t * A list of segment coordinates for the multi-part line.\r\n\t */\r\n\tsegments?: Array<Array<IPoint>>;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[Polyline]].\r\n */\r\nexport interface IPolylineEvents extends ISpriteEvents { }\r\n\r\n/**\r\n * Defines adapters for [[Polyline]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IPolylineAdapters extends ISpriteAdapters, IPolylineProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Draws a polyline.\r\n *\r\n * @see {@link IPolylineEvents} for a list of available events\r\n * @see {@link IPolylineAdapters} for a list of available Adapters\r\n */\r\nexport class Polyline extends Sprite {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IPolylineProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IPolylineAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IPolylineEvents;\r\n\r\n\t/**\r\n\t * [_distance description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _distance: number = 0;\r\n\r\n\t/**\r\n\t * [_realSegments]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _realSegments: $type.Optional<Array<Array<IPoint>>>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"Polyline\";\r\n\t\tthis.element = this.paper.add(\"path\");\r\n\t\tthis.shapeRendering = \"auto\";\r\n\t\tthis.fill = color();\r\n\t\tthis.strokeOpacity = 1;\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Creats and adds an SVG path for the arc.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic makePath(): void {\r\n\t\tthis._distance = 0;\r\n\t\tlet segments = this.segments;\r\n\r\n\t\tif (segments && segments.length > 0) {\r\n\t\t\tlet path: string = \"\";\r\n\r\n\t\t\tfor (let i = 0, len = segments.length; i < len; i++) {\r\n\t\t\t\tlet points: IPoint[] = segments[i];\r\n\t\t\t\tif (points.length > 0) {\r\n\t\t\t\t\tpath += $path.moveTo(points[0]);\r\n\r\n\t\t\t\t\tfor (let p = 1; p < points.length; p++) {\r\n\t\t\t\t\t\tlet point: IPoint = points[p];\r\n\t\t\t\t\t\tpath += $path.lineTo(point);\r\n\t\t\t\t\t\tthis._distance += $math.getDistance(points[p - 1], point);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.path = path;\r\n\t\t}\r\n\r\n\t\tthis._realSegments = segments;\r\n\t}\r\n\r\n\t/**\r\n\t * A list of segment coordinates for the multi-part line.\r\n\t *\r\n\t * @todo Example\r\n\t * @param segments  Segments\r\n\t */\r\n\tpublic set segments(segments: $type.Optional<Array<Array<IPoint>>>) {\r\n\t\tthis.setPropertyValue(\"segments\", segments);\r\n\t\tthis.makePath();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Segments\r\n\t */\r\n\tpublic get segments(): $type.Optional<Array<Array<IPoint>>> {\r\n\t\treturn this.getPropertyValue(\"segments\");\r\n\t}\r\n\r\n\t/**\r\n\t * [distance description]\r\n\t *\r\n\t * @todo Description\r\n\t * @return [description]\r\n\t */\r\n\tpublic get distance(): number {\r\n\t\treturn this._distance;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts relative position along the line (0-1) into pixel coordinates.\r\n\t *\r\n\t * @param position  Position (0-1)\r\n\t * @return Coordinates\r\n\t */\r\n\tpublic positionToPoint(position: number): IOrientationPoint {\r\n\r\n\t\tlet deltaAngle: number = 0;\r\n\r\n\t\tif (position < 0) {\r\n\t\t\tposition = Math.abs(position);\r\n\t\t\tdeltaAngle = 180;\r\n\t\t}\r\n\r\n\t\tlet segments: $type.Optional<Array<Array<IPoint>>> = this._realSegments;\r\n\t\tif (segments) {\r\n\t\t\tlet totalDistance: number = this.distance;\r\n\t\t\tlet currentDistance: number = 0;\r\n\r\n\t\t\tlet distanceAB: number;\r\n\t\t\tlet positionA: number = 0;\r\n\t\t\tlet positionB: number = 0;\r\n\t\t\tlet pointA: IPoint;\r\n\t\t\tlet pointB: IPoint;\r\n\r\n\t\t\tfor (let s = 0; s < segments.length; s++) {\r\n\t\t\t\tlet points: IPoint[] = segments[s];\r\n\t\t\t\tif (points.length > 1) {\r\n\t\t\t\t\tfor (let p = 1; p < points.length; p++) {\r\n\t\t\t\t\t\tpointA = points[p - 1];\r\n\t\t\t\t\t\tpointB = points[p];\r\n\r\n\t\t\t\t\t\tpositionA = currentDistance / totalDistance;\r\n\t\t\t\t\t\tdistanceAB = $math.getDistance(pointA, pointB);\r\n\t\t\t\t\t\tcurrentDistance += distanceAB;\r\n\t\t\t\t\t\tpositionB = currentDistance / totalDistance;\r\n\r\n\t\t\t\t\t\tif (positionA <= position && positionB > position) {\r\n\t\t\t\t\t\t\ts = segments.length;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (points.length == 1) {\r\n\t\t\t\t\tpointA = points[0];\r\n\t\t\t\t\tpointB = points[0];\r\n\t\t\t\t\tpositionA = 0;\r\n\t\t\t\t\tpositionB = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (pointA && pointB) {\r\n\t\t\t\tlet positionAB: number = (position - positionA) / (positionB - positionA);\r\n\t\t\t\tlet midPoint: IPoint = $math.getMidPoint(pointA, pointB, positionAB);\r\n\t\t\t\treturn { x: midPoint.x, y: midPoint.y, angle: deltaAngle + $math.getAngle(pointA, pointB) };\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn { x: 0, y: 0, angle: 0 };\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic get realSegments():IPoint[][]{\r\n\t\treturn this._realSegments;\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Polyline\"] = Polyline;\r\n","/**\r\n * Provides functionality used to creating and showing tooltips (balloons).\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Container, IContainerProperties, IContainerAdapters, IContainerEvents } from \"../Container\";\r\nimport { registry } from \"../../core/Registry\";\r\nimport { Sprite } from \"../../core/Sprite\";\r\nimport { PointedRectangle } from \"./PointedRectangle\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { Label } from \"../elements/Label\";\r\nimport { Animation } from \"../utils/Animation\";\r\nimport { color } from \"../utils/Color\";\r\nimport { DropShadowFilter } from \"../rendering/filters/DropShadowFilter\";\r\nimport { IRectangle } from \"../defs/IRectangle\";\r\nimport * as $math from \"../utils/Math\";\r\nimport * as $ease from \"../utils/Ease\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport * as $type from \"../utils/Type\";\r\nimport { IDisposer } from \"../utils/Disposer\";\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Represents options for tooltip pointer (arrow) orientation.\r\n */\r\nexport type PointerOrientation = \"horizontal\" | \"vertical\" | \"left\" | \"right\" | \"up\" | \"down\";\r\n\r\n/**\r\n * Defines properties for [[Tooltip]].\r\n */\r\nexport interface ITooltipProperties extends IContainerProperties {\r\n\r\n\t/**\r\n\t * Pointer orientation: \"horizontal\", \"vertical\", \"left\", \"right\", \"up\", \"down\".\r\n\t *\r\n\t * @default \"vertical\"\r\n\t */\r\n\tpointerOrientation?: PointerOrientation;\r\n\r\n\t/**\r\n\t * Duration (ms) that takes for a Tooltip to move from one place to another.\r\n\t *\r\n\t * If set to a zero value, the Tooltop will jump to a new location\r\n\t * instantenously.\r\n\t *\r\n\t * If set to a non-zero value, the Tooltip will \"glide\" to a new location at\r\n\t * a speed determined by this setting.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/animations/} for more info about animations\r\n\t */\r\n\tanimationDuration?: number;\r\n\r\n\t/**\r\n\t * An easing function to use when animating Tooltip position.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/animations/} for more info about animations\r\n\t */\r\n\tanimationEasing?: (value: number) => number;\r\n\r\n\t/**\r\n\t * Specifies if tooltip background should get stroke color from the sprite\r\n\t * it is pointing to.\r\n\t */\r\n\tgetStrokeFromObject?: boolean;\r\n\r\n\t/**\r\n\t * Specifies if tooltip background should get fill color from the sprite it\r\n\t * is pointing to.\r\n\t */\r\n\tgetFillFromObject?: boolean;\r\n\r\n\t/**\r\n\t * Specifies if text color should be chosen automatically for a better\r\n\t * readability.\r\n\t */\r\n\tautoTextColor?: boolean;\r\n\r\n\t/**\r\n\t * If this tooltip is displayed on hover on some other object, keep that\r\n\t * element hovered if hovering on the tooltip.\r\n\t *\r\n\t * @since 4.1.13\r\n\t */\r\n\tkeepTargetHover?: boolean;\r\n\r\n\t/**\r\n\t * Normally, a tooltip will hide itself if it is pointing to a coordinate\r\n\t * that is outside viewport.\r\n\t *\r\n\t * Setting this setting to `true` will override that and make tooltip\r\n\t * appear next to the viewport edge closest to the target point.\r\n\t *\r\n\t * @since 4.5.7\r\n\t */\r\n\tshowInViewport?: boolean\r\n\r\n\t/**\r\n\t * Normally, a tooltip's position will be adjusted so it always fits into\r\n\t * chart's coundaries.\r\n\t *\r\n\t * Setting this to `false` will disable such checks and will allow tooltip\r\n\t * to \"bleed over\" the edge of the chart.\r\n\t *\r\n\t * @default false\r\n\t * @since 4.10.8\r\n\t */\r\n\tignoreBounds?: boolean;\r\n}\r\n\r\n/**\r\n * Defines events for [[Tooltip]].\r\n */\r\nexport interface ITooltipEvents extends IContainerEvents { }\r\n\r\n/**\r\n * Defines adapters for [[Tooltip]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface ITooltipAdapters extends IContainerAdapters, ITooltipProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Tooltip displays text and/or multimedia information in a balloon over chart\r\n * area.\r\n * @see {@link ITooltipEvents} for a list of available events\r\n * @see {@link ITooltipAdapters} for a list of available Adapters\r\n */\r\nexport class Tooltip extends Container {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: ITooltipProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: ITooltipAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: ITooltipEvents;\r\n\r\n\t/**\r\n\t * A type for the background element.\r\n\t */\r\n\tpublic _background: PointedRectangle;\r\n\r\n\t/**\r\n\t * Text element that represents tooltip contents.\r\n\t */\r\n\tpublic label: Label;\r\n\r\n\t/**\r\n\t * A container that should be considered a \"boundary\" for the tooltip. A\r\n\t * bounding container is used to calculate numeric boundaries\r\n\t * (`boundingRect`). It is used to constrain the Tooltip to specific area on\r\n\t * the chart, like for example cursor tooltip in plot area.\r\n\t */\r\n\tprotected _boundingContainer: Container;\r\n\r\n\t/**\r\n\t * Holds numeric boundary values. Calculated from the `boundingContainer`.\r\n\t * @ignore\r\n\t */\r\n\tpublic _boundingRect: IRectangle = { x: -40000, y: -40000, width: 80000, height: 80000 };\r\n\r\n\t/**\r\n\t * Coordinates tooltip's pointer (stem) should point to.\r\n\t */\r\n\tprotected _pointTo: IPoint = { x: 0, y: 0 };\r\n\r\n\t/**\r\n\t * If set to `true` the pointer/stem of the Tooltip will not go outside\r\n\t * Tooltip's width or height depending on pointer's orientation.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tpublic fitPointerToBounds: boolean = false;\r\n\r\n\t/**\r\n\t * If `tooltipOrientation` is vertical, it can be drawn below or above point\r\n\t * We need to know this when solving overlapping.\r\n\t */\r\n\tprotected _verticalOrientation: \"up\" | \"down\" = \"up\";\r\n\r\n\t/**\r\n\t * Position animation of a tooltip\r\n\t */\r\n\tprotected _animation: $type.Optional<Animation>;\r\n\r\n\t/**\r\n\t * A [[Sprite]] element this tooltip is displayed for, if any.\r\n\t *\r\n\t * @since 4.1.13\r\n\t */\r\n\tpublic targetSprite: $type.Optional<Sprite>;\r\n\r\n\t/**\r\n\t * reference to a sprite which now shows this tooltip instance.\r\n\t */\r\n\tpublic currentSprite: Sprite;\r\n\r\n\tprotected _pointToDisposer: IDisposer;\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic fixDoc: boolean = true;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"Tooltip\";\r\n\t\tthis.isMeasured = false;\r\n\r\n\t\tthis.getFillFromObject = true;\r\n\t\tthis.margin(5, 5, 5, 5);\r\n\r\n\t\tthis.defaultState.transitionDuration = 1;\r\n\t\tthis.hiddenState.transitionDuration = 1;\r\n\r\n\t\t// Create chrome/background\r\n\t\tlet background = this.background;\r\n\t\tbackground.interactionsEnabled = false;\r\n\t\tbackground.fillOpacity = 0.9;\r\n\t\tbackground.strokeWidth = 1;\r\n\t\tbackground.strokeOpacity = 1;\r\n\t\tbackground.stroke = color(\"#ffffff\");\r\n\t\tbackground.cornerRadius = 3;\r\n\t\tbackground.pointerLength = 6;\r\n\t\tbackground.pointerBaseWidth = 10;\r\n\r\n\t\tlet dropShadow = new DropShadowFilter();\r\n\t\tdropShadow.dy = 1;\r\n\t\tdropShadow.dx = 1;\r\n\t\tdropShadow.opacity = 0.5;\r\n\t\tbackground.filters.push(dropShadow);\r\n\r\n\t\tthis.autoTextColor = true;\r\n\r\n\t\t// Create text element\r\n\t\tlet label = this.createChild(Label);\r\n\t\tlabel.shouldClone = false;\r\n\t\tthis.label = label;\r\n\t\tlabel.padding(7, 12, 4, 12);\r\n\t\tlabel.interactionsEnabled = false;\r\n\t\tlabel.horizontalCenter = \"middle\";\r\n\t\tlabel.fill = color(\"#ffffff\");\r\n\t\tthis._disposers.push(label);\r\n\r\n\t\tthis.label.events.on(\"sizechanged\", this.drawBackground, this);\r\n\r\n\t\tthis.label.zIndex = 1; // @todo remove this line when bg sorting is solved\r\n\r\n\t\t// Set defaults\r\n\t\tthis.pointerOrientation = \"vertical\";\r\n\r\n\t\tthis.animationDuration = 0;\r\n\t\tthis.animationEasing = $ease.cubicOut;\r\n\r\n\t\tthis.setPropertyValue(\"showInViewport\", false);\r\n\r\n\t\t// Set accessibility options\r\n\t\tthis.role = \"tooltip\";\r\n\r\n\t\tthis.visible = false;\r\n\t\tthis.opacity = 0;\r\n\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\r\n\t\tthis.events.on(\"visibilitychanged\", this.handleVisibility, this);\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\tprotected handleVisibility() {\r\n\t\tif (this.visible) {\r\n\t\t\tthis.label.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Specifies if tooltip background should get stroke color from the sprite it is pointing to.\r\n\t *\r\n\t * @return {boolean}\r\n\t * @default false\r\n\t */\r\n\tpublic get getStrokeFromObject(): boolean {\r\n\t\treturn this.getPropertyValue(\"getStrokeFromObject\");\r\n\t}\r\n\r\n\t/**\r\n\t * Specifies if tooltip background should get stroke color from the sprite it is pointing to.\r\n\t *\r\n\t * @param value boolean\r\n\t */\r\n\tpublic set getStrokeFromObject(value: boolean) {\r\n\t\tthis.setPropertyValue(\"getStrokeFromObject\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * Specifies if text color should be chosen automatically for a better\r\n\t * readability.\r\n\t *\r\n\t * IMPORTANT: this feature is generally ignored, if `getFillFromObject = false`.\r\n\t *\r\n\t * If inheriting of `fill` color from object tooltip is displayed for is\r\n\t * disabled, this feature will not work. If you are explicitly setting a\r\n\t * color for tooltip background, you may set a color for its label as well\r\n\t * using `tooltip.label.fill` property.\r\n\t *\r\n\t *\r\n\t * @param value boolean\r\n\t */\r\n\tpublic set autoTextColor(value: boolean) {\r\n\t\tthis.setPropertyValue(\"autoTextColor\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return {boolean}\r\n\t */\r\n\tpublic get autoTextColor(): boolean {\r\n\t\treturn this.getPropertyValue(\"autoTextColor\");\r\n\t}\r\n\r\n\t/**\r\n\t * If this tooltip is displayed on hover on some other object, keep that\r\n\t * element hovered if hovering on the tooltip.\r\n\t *\r\n\t * @default false\r\n\t * @since 4.1.13\r\n\t * @param  value  Keep target hovered?\r\n\t */\r\n\tpublic set keepTargetHover(value: boolean) {\r\n\t\tif (this.setPropertyValue(\"keepTargetHover\", value, true)) {\r\n\t\t\tif (value) {\r\n\t\t\t\tthis.hoverable = true;\r\n\t\t\t\tthis.background.interactionsEnabled = true;\r\n\t\t\t\tthis._disposers.push(this.events.on(\"over\", (ev) => {\r\n\t\t\t\t\tif (this.targetSprite && this.targetSprite.hoverable) {\r\n\t\t\t\t\t\tthis.targetSprite.isHover = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tthis._disposers.push(this.events.on(\"out\", (ev) => {\r\n\t\t\t\t\tif (this.targetSprite && this.targetSprite.hoverable) {\r\n\t\t\t\t\t\t//this.hideTooltip();\r\n\t\t\t\t\t\t//this.targetSprite.handleOut();\r\n\t\t\t\t\t\tthis.targetSprite.isHover = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Normally, a tooltip will hide itself if it is pointing to a coordinate\r\n\t * that is outside viewport.\r\n\t *\r\n\t * Setting this setting to `true` will override that and make tooltip\r\n\t * appear next to the viewport edge closest to the target point.\r\n\t *\r\n\t * @default false\r\n\t * @since 4.5.7\r\n\t * @param  value  Force showing tooltip?\r\n\t */\r\n\tpublic set showInViewport(value: boolean) {\r\n\t\tthis.setPropertyValue(\"showInViewport\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Force showing tooltip?\r\n\t */\r\n\tpublic get showInViewport(): boolean {\r\n\t\treturn this.getPropertyValue(\"showInViewport\");\r\n\t}\r\n\r\n\t/**\r\n\t * @return Keep target hovered?\r\n\t */\r\n\tpublic get keepTargetHover(): boolean {\r\n\t\treturn this.getPropertyValue(\"keepTargetHover\");\r\n\t}\r\n\r\n\t/**\r\n\t * Specifies if tooltip background should get fill color from the sprite it is pointing to.\r\n\t *\r\n\t * @return {boolean}\r\n\t * @default true\r\n\t */\r\n\tpublic get getFillFromObject(): boolean {\r\n\t\treturn this.getPropertyValue(\"getFillFromObject\");\r\n\t}\r\n\r\n\t/**\r\n\t * @param value boolean\r\n\t */\r\n\tpublic set getFillFromObject(value: boolean) {\r\n\t\tthis.setPropertyValue(\"getFillFromObject\", value, true);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Creates and returns a background element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Background\r\n\t */\r\n\tpublic createBackground(): this[\"_background\"] {\r\n\t\treturn new PointedRectangle();\r\n\t}\r\n\r\n\t/**\r\n\t * Pointer orientation: `\"horizontal\"`, `\"vertical\"`, `\"up\"`, `\"down\"`,\r\n\t * `\"right\"`, or `\"left\"`.\r\n\t *\r\n\t * Options`\"horizontal\"` or `\"vertical\"` are location-aware, meaning they\r\n\t * will change position of the Tooltip based on the target point's position\r\n\t * in relation to chart center.\r\n\t *\r\n\t * Options `\"up\"`, `\"down\"`, `\"right\"`, `\"left\"` are static and will point\r\n\t * in the specified direction regardless of the position, even if that means\r\n\t * going out of chart/screen bounds.\r\n\t *\r\n\t * IMPORTANT: in some situations, like having multiple tooltips stacked for\r\n\t * multiple series, the `\"up\"` and `\"down\"` values might be ignored in order\r\n\t * to make tooltip overlap algorithm work.\r\n\t *\r\n\t * @default \"vertical\"\r\n\t * @param  value  Orientation\r\n\t */\r\n\tpublic set pointerOrientation(value: PointerOrientation) {\r\n\t\tthis.setPropertyValue(\"pointerOrientation\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Orientation\r\n\t */\r\n\tpublic get pointerOrientation(): PointerOrientation {\r\n\t\treturn this.getPropertyValue(\"pointerOrientation\");\r\n\t}\r\n\r\n\t/**\r\n\t * Duration in milliseconds for the animation to take place when the tooltip\r\n\t * is moving from one place to another.\r\n\t *\r\n\t * @default 0\r\n\t * @param value  number\r\n\t */\r\n\tpublic set animationDuration(value: number) {\r\n\t\tthis.setPropertyValue(\"animationDuration\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Orientation\r\n\t */\r\n\tpublic get animationDuration(): number {\r\n\t\treturn this.getPropertyValue(\"animationDuration\");\r\n\t}\r\n\r\n\t/**\r\n\t * Tooltip animation (moving from one place to another) easing function.\r\n\t *\r\n\t * @default $ease.cubicOut\r\n\t * @param value (value: number) => number\r\n\t */\r\n\tpublic set animationEasing(value: (value: number) => number) {\r\n\t\tthis.setPropertyValue(\"animationEasing\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return {Function}\r\n\t */\r\n\tpublic get animationEasing(): (value: number) => number {\r\n\t\treturn this.getPropertyValue(\"animationEasing\");\r\n\t}\r\n\r\n\t/**\r\n\t * HTML content for the Tooltip.\r\n\t *\r\n\t * Provided value will be used as is, without applying any further\r\n\t * formatting to it.\r\n\t *\r\n\t * @param value  HTML content\r\n\t */\r\n\tpublic set html(value: string) {\r\n\t\tif (this.label.html != value) {\r\n\t\t\tthis.label.html = value;\r\n\t\t\tthis.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return HTML content\r\n\t */\r\n\tpublic get html(): string {\r\n\t\treturn this.label.html;\r\n\t}\r\n\r\n\t/**\r\n\t * SVG text content for the Tooltip.\r\n\t *\r\n\t * Text can have a number of formatting options supported by\r\n\t * [[TextFormatter]].\r\n\t *\r\n\t * @param value  SVG text\r\n\t */\r\n\tpublic set text(value: string) {\r\n\t\tif (this.label.text != value) {\r\n\t\t\tthis.label.text = value;\r\n\t\t\tthis.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return SVG text\r\n\t */\r\n\tpublic get text(): string {\r\n\t\treturn this.label.text;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates the Tooltip.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic draw(): void {\r\n\t\tsuper.draw();\r\n\r\n\t\tlet label = this.label;\r\n\r\n\t\tif (label.invalid) {\r\n\t\t\tlabel.validate();\r\n\t\t}\r\n\r\n\t\tlet x: number = this._pointTo.x;\r\n\t\tlet y: number = this._pointTo.y;\r\n\r\n\t\tlet boundingRect: IRectangle = this._boundingRect;\r\n\r\n\t\tlet textW: number = label.measuredWidth;\r\n\t\tlet textH: number = label.measuredHeight;\r\n\r\n\t\tlet pointerLength = this.background.pointerLength;\r\n\r\n\t\tlet textX: number;\r\n\t\tlet textY: number;\r\n\r\n\t\tif (this.ignoreBounds) {\r\n\t\t\tboundingRect = undefined;\r\n\t\t}\r\n\r\n\t\t// try to handle if text is wider than br\r\n\t\tif (boundingRect && this.fixDoc && textW > boundingRect.width) {\r\n\t\t\t// TODO maybe this isn't needed ?\r\n\t\t\t$utils.spritePointToDocument({ x: boundingRect.x, y: boundingRect.y }, this.parent);\r\n\t\t\tlet p1 = $utils.spritePointToDocument({ x: boundingRect.x + boundingRect.width, y: boundingRect.y + boundingRect.height }, this.parent);\r\n\r\n\t\t\tlet documentWidth = document.body.offsetWidth;\r\n\t\t\t// TODO maybe this isn't needed ?\r\n\t\t\t$utils.used(document.body.offsetHeight);\r\n\r\n\t\t\tif (p1.x > documentWidth / 2) {\r\n\t\t\t\tboundingRect.x = boundingRect.width - textW;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tboundingRect.width = boundingRect.x + textW;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet pointerOrientation = this.pointerOrientation;\r\n\r\n\t\t// horizontal\r\n\t\tif (pointerOrientation == \"horizontal\" || pointerOrientation == \"left\" || pointerOrientation == \"right\") {\r\n\t\t\ttextY = - textH / 2;\r\n\t\t\tif (pointerOrientation == \"horizontal\") {\r\n\t\t\t\tif (boundingRect && x > boundingRect.x + boundingRect.width / 2) {\r\n\t\t\t\t\ttextX = - textW / 2 - pointerLength;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttextX = textW / 2 + pointerLength;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (pointerOrientation == \"left\") {\r\n\t\t\t\ttextX = textW / 2 + pointerLength;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttextX = -textW / 2 - pointerLength;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// vertical pointer\r\n\t\telse {\r\n\t\t\tif (boundingRect) {\r\n\t\t\t\ttextX = $math.fitToRange(0, boundingRect.x - x + textW / 2, boundingRect.x - x + boundingRect.width - textW / 2);\r\n\t\t\t}\r\n\r\n\t\t\tif (pointerOrientation == \"vertical\") {\r\n\t\t\t\tif (boundingRect && y > boundingRect.y + textH + pointerLength) {\r\n\t\t\t\t\ttextY = - textH - pointerLength;\r\n\t\t\t\t\tthis._verticalOrientation = \"up\";\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttextY = pointerLength;\r\n\t\t\t\t\tthis._verticalOrientation = \"down\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (pointerOrientation == \"down\") {\r\n\t\t\t\ttextY = - textH - pointerLength;\r\n\t\t\t\tthis._verticalOrientation = \"up\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttextY = pointerLength;\r\n\t\t\t\tthis._verticalOrientation = \"down\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (boundingRect) {\r\n\t\t\ttextY = $math.fitToRange(textY, boundingRect.y - y, boundingRect.y + boundingRect.height - textH - y);\r\n\t\t}\r\n\r\n\t\tlabel.x = textX;\r\n\t\tlabel.y = textY;\r\n\r\n\t\tthis.drawBackground();\r\n\t}\r\n\r\n\t/**\r\n\t * Overrides functionality from the superclass.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic updateBackground(): void {\r\n\t\tthis.group.addToBack(this.background.group);\r\n\t}\r\n\r\n\t/**\r\n\t * Draws Tooltip background (chrome, background and pointer/stem).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic drawBackground(): void {\r\n\t\tlet label = this.label;\r\n\t\tlet background: PointedRectangle = this.background;\r\n\r\n\t\tlet textWidth: number = label.measuredWidth;\r\n\t\tlet textHeight: number = label.measuredHeight;\r\n\r\n\t\tlet boundingRect: IRectangle = this._boundingRect;\r\n\r\n\t\tlet bgWidth: number = textWidth;\r\n\t\tlet bgX: number = label.pixelX - textWidth / 2;\r\n\r\n\t\tlet bgHeight: number = textHeight;\r\n\t\tlet bgY: number = label.pixelY;\r\n\r\n\t\tlet x: number = this._pointTo.x;\r\n\t\tlet y: number = this._pointTo.y;\r\n\r\n\t\tlet boundX1: number = boundingRect.x - x;\r\n\t\tlet boundX2: number = boundX1 + boundingRect.width;\r\n\t\tlet boundY1: number = boundingRect.y - y;\r\n\t\tlet boundY2: number = boundY1 + boundingRect.height;\r\n\r\n\t\tbackground.x = bgX;\r\n\t\tbackground.y = bgY;\r\n\r\n\t\tbackground.width = bgWidth;\r\n\t\tbackground.height = bgHeight;\r\n\r\n\t\tif (this.fitPointerToBounds) {\r\n\t\t\tbackground.pointerX = $math.fitToRange(- background.x, boundX1 - background.x, boundX2 - background.x);\r\n\t\t\tbackground.pointerY = $math.fitToRange(- background.y, boundY1 - background.y, boundY2 - background.y);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tbackground.pointerX = - background.x;\r\n\t\t\tbackground.pointerY = - background.y;\r\n\t\t}\r\n\r\n\t\tbackground.validate();\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic delayedPointTo(point: IPoint, instantly?: boolean) {\r\n\t\tif (this._pointToDisposer) {\r\n\t\t\tthis._pointToDisposer.dispose();\r\n\t\t}\r\n\t\tthis._pointToDisposer = registry.events.once(\"exitframe\", () => {\r\n\t\t\tthis.pointTo(point, instantly);\r\n\t\t})\r\n\r\n\t\tthis.addDisposer(this._pointToDisposer);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Set nes tooltip's anchor point and moves whole tooltip.\r\n\t *\r\n\t * @param x  X coordinate\r\n\t * @param y  Y coordinate\r\n\t */\r\n\tpublic pointTo(point: IPoint, instantly?: boolean): void {\r\n\t\tif (this._pointTo.x != point.x || this._pointTo.y != point.y) {\r\n\t\t\tthis._pointTo = point;\r\n\t\t\tthis.invalidate();\r\n\r\n\t\t\t// this helps to avoid strange animation from nowhere on initial show or when balloon was hidden already\r\n\t\t\tif (!this.visible || instantly) {\r\n\t\t\t\tthis.moveTo(this._pointTo);\r\n\t\t\t\tif (this._animation) {\r\n\t\t\t\t\tthis._animation.kill();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// helps to avoid flicker on top/left corner\r\n\t\t\t\tif (this.pixelX == 0 && this.pixelY == 0) {\r\n\t\t\t\t\tthis.moveTo(this._pointTo);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (this._animation) {\r\n\t\t\t\t\t\tthis._animation.kill();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._animation = new Animation(this, [{ property: \"x\", to: point.x, from: this.pixelX }, { property: \"y\", to: point.y, from: this.pixelY }], this.animationDuration, this.animationEasing).start();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets numeric boundaries Tooltip needs to obey (so it does not go outside\r\n\t * specific area).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param rectangle Boundary rectangle\r\n\t */\r\n\tpublic setBounds(rectangle: IRectangle): void {\r\n\t\tlet oldRect = this._boundingRect;\r\n\t\tif (oldRect.x != rectangle.x || oldRect.y != rectangle.y || oldRect.width != rectangle.width || oldRect.height != rectangle.height) {\r\n\t\t\tthis._boundingRect = rectangle;\r\n\t\t\tthis.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a [[Container]] instance to be used when calculating numeric\r\n\t * boundaries for the Tooltip.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param container  Boundary container\r\n\t */\r\n\tpublic set boundingContainer(container: Container) {\r\n\t\tthis._boundingContainer = container;\r\n\t\t// TODO remove closures ?\r\n\t\tcontainer.events.on(\"sizechanged\", this.updateBounds, this);\r\n\t\tcontainer.events.on(\"positionchanged\", this.updateBounds, this);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates numeric boundaries for the Tooltip, based on the\r\n\t * `boundingCountrainer`.\r\n\t */\r\n\tprotected updateBounds(): void {\r\n\t\tlet boundingContainer: Container = this._boundingContainer;\r\n\t\t// to global\r\n\t\tlet rect: IRectangle = $utils.spriteRectToSvg({\r\n\t\t\tx: boundingContainer.pixelX,\r\n\t\t\ty: boundingContainer.pixelY,\r\n\t\t\twidth: boundingContainer.maxWidth,\r\n\t\t\theight: boundingContainer.maxHeight\r\n\t\t}, boundingContainer);\r\n\t\tthis.setBounds(rect);\r\n\t}\r\n\r\n\t/**\r\n\t * Normally, a tooltip's position will be adjusted so it always fits into\r\n\t * chart's coundaries.\r\n\t *\r\n\t * Setting this to `false` will disable such checks and will allow tooltip\r\n\t * to \"bleed over\" the edge of the chart.\r\n\t *\r\n\t * @default false\r\n\t * @since 4.10.8\r\n\t * @param  value  Ignore chart bounds?\r\n\t */\r\n\tpublic set ignoreBounds(value: boolean) {\r\n\t\tthis.setPropertyValue(\"ignoreBounds\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Ignore chart bounds?\r\n\t */\r\n\tpublic get ignoreBounds(): boolean {\r\n\t\treturn this.getPropertyValue(\"ignoreBounds\");\r\n\t}\r\n\r\n\t/**\r\n\t * If tooltipOrientation is vertical, it can be drawn below or above point.\r\n\t * We need to know this when solving overlapping.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return \"up\" | \"down\"\r\n\t */\r\n\tpublic get verticalOrientation(): \"up\" | \"down\" {\r\n\t\treturn this._verticalOrientation;\r\n\t}\r\n\r\n\t/**\r\n\t * To avoid stackoverflow\r\n\t * @ignore\r\n\t */\r\n\tpublic get tooltip(): Tooltip {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Copies properties and other attributes.\r\n\t *\r\n\t * @param source  Source\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\tsuper.copyFrom(source);\r\n\t\tthis.label.copyFrom(source.label);\r\n\r\n\t\tif (source._boundingRect) {\r\n\t\t\tthis._boundingRect = source._boundingRect;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adds easing functions to \"function\" fields.\r\n\t *\r\n\t * @param field  Field name\r\n\t * @return Assign as function?\r\n\t */\r\n\tprotected asFunction(field: string): boolean {\r\n\t\treturn field == \"animationEasing\" || super.asIs(field);\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Tooltip\"] = Tooltip;\r\n","/**\r\n * Functionality for drawing waved lines.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Line, ILineProperties, ILineAdapters, ILineEvents } from \"./Line\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { IWavedShape } from \"../defs/IWavedShape\";\r\nimport { color } from \"../utils/Color\";\r\nimport { wavedLine } from \"../rendering/Smoothing\";\r\nimport * as $path from \"../rendering/Path\";\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines available properties for [[WavedLine]].\r\n */\r\nexport interface IWavedLineProperties extends ILineProperties {\r\n\r\n\t/**\r\n\t * Wave length in pixels.\r\n\t *\r\n\t * @default 16\r\n\t */\r\n\twaveLength?: number;\r\n\r\n\t/**\r\n\t * Wave height in pixels.\r\n\t *\r\n\t * @default 4\r\n\t */\r\n\twaveHeight?: number;\r\n\r\n\t/**\r\n\t * Wave tension.\r\n\t *\r\n\t * @default 0.8\r\n\t */\r\n\ttension?: number;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[WavedLine]].\r\n */\r\nexport interface IWavedLineEvents extends ILineEvents { }\r\n\r\n/**\r\n * Defines adapters for [[WavedLine]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IWavedLineAdapters extends ILineAdapters, IWavedLineProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Draws a waved line.\r\n *\r\n * @see {@link IWavedLineEvents} for a list of available events\r\n * @see {@link IWavedLineAdapters} for a list of available Adapters\r\n */\r\nexport class WavedLine extends Line implements IWavedShape {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IWavedLineProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IWavedLineAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IWavedLineEvents;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"WavedLine\";\r\n\t\tthis.element = this.paper.add(\"path\");\r\n\t\tthis.waveLength = 16;\r\n\t\tthis.waveHeight = 4;\r\n\t\tthis.tension = 0.8;\r\n\t\tthis.pixelPerfect = false;\r\n\r\n\t\tthis.fill = color();\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the waved line.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic draw(): void {\r\n\t\t//super.draw();\r\n\t\tlet p1: IPoint = { x: this.x1, y: this.y1 };\r\n\t\tlet p2: IPoint = { x: this.x2, y: this.y2 };\r\n\r\n\t\tthis.path = $path.moveTo(p1) + wavedLine(p1, p2, this.waveLength, this.waveHeight, this.tension, true);\r\n\t}\r\n\r\n\t/**\r\n\t * Wave length in pixels.\r\n\t *\r\n\t * @default 16\r\n\t * @param value  Wave length (px)\r\n\t */\r\n\tpublic set waveLength(value: number) {\r\n\t\tthis.setPropertyValue(\"waveLength\", value);\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Wave length (px)\r\n\t */\r\n\tpublic get waveLength(): number {\r\n\t\treturn this.getPropertyValue(\"waveLength\");\r\n\t}\r\n\r\n\t/**\r\n\t * Wave height in pixels.\r\n\t *\r\n\t * @default 4\r\n\t * @param value  Wave height (px)\r\n\t */\r\n\tpublic set waveHeight(value: number) {\r\n\t\tthis.setPropertyValue(\"waveHeight\", value);\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Wave height (px)\r\n\t */\r\n\tpublic get waveHeight(): number {\r\n\t\treturn this.getPropertyValue(\"waveHeight\");\r\n\t}\r\n\r\n\t/**\r\n\t * Tension of the wave.\r\n\t *\r\n\t * @default 0.8\r\n\t * @param value  Tension\r\n\t */\r\n\tpublic set tension(value: number) {\r\n\t\tthis.setPropertyValue(\"tension\", value);\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tension\r\n\t */\r\n\tpublic get tension(): number {\r\n\t\treturn this.getPropertyValue(\"tension\");\r\n\t}\r\n\r\n}\r\n","/**\r\n * Module contains functionality related to [[Sprite]] states.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObject } from \"./Base\";\r\nimport { registry } from \"./Registry\";\r\nimport { Adapter } from \"./utils/Adapter\";\r\nimport { List, ListDisposer } from \"./utils/List\";\r\nimport { Filter } from \"./rendering/filters/Filter\";\r\nimport { Sprite } from \"./Sprite\";\r\n\r\nimport { toColor } from \"./utils/Color\";\r\nimport { percent } from \"./utils/Percent\";\r\nimport * as $utils from \"./utils/Utils\";\r\nimport * as $ease from \"./utils/Ease\";\r\nimport * as $object from \"./utils/Object\";\r\nimport * as $type from \"./utils/Type\";\r\n\r\n/**\r\n * Defines a state for [[Sprite]].\r\n *\r\n * A \"state\" is a special object that has all the same properties as the\r\n * [[Sprite]] of the same type, and which can be used to quickly apply a set\r\n * of property values. (set state)\r\n *\r\n * When [[Sprite]] (or any object that extends Sprite) is created it creates a\r\n * \"default\" state. You can modify the \"default\" state so that when the Sprite\r\n * returns to default state certain properties are added.\r\n *\r\n * Default state can be accessed using Sprite's `defaultState` getter.\r\n *\r\n * ```TypeScript\r\n * sprite.defaultState.properties.fillOpacity = 0.5;\r\n * ```\r\n * ```JavaScript\r\n * sprite.defaultState.properties.fillOpacity = 0.5;\r\n * ```\r\n * ```JSON\r\n * {\r\n *   // ...\r\n *   \"defaultState\": {\r\n *     \"properties\": {\r\n *       \"fillOpacity\": 0.5\r\n *     }\r\n *   }\r\n * }\r\n * ```\r\n *\r\n * If Sprite is \"hoverable\", it automatically adds a \"hover\" state, which is\r\n * applied when it has a cursor over it.\r\n *\r\n * ```TypeScript\r\n * let hoverstate = sprite.states.create(\"hover\");\r\n * hoverstate.properties.fillOpacity = 1;\r\n * ```\r\n * ```JavaScript\r\n * var hoverstate = sprite.states.create(\"hover\");\r\n * hoverstate.properties.fillOpacity = 1;\r\n * ```\r\n * ```JSON\r\n * {\r\n *   // ...\r\n *   \"states\": {\r\n *     \"hover\": {\r\n *       \"properties\": {\r\n *         \"fillOpacity\": 0.5\r\n *       }\r\n *     }\r\n *   }\r\n * }\r\n * ```\r\n *\r\n * The above will automatically apply \"hover\" state when the Sprite is hovered,\r\n * thus will set its `fillOpacity` property to 1, and will reset it to 0.5 when\r\n * it's no longer hovered.\r\n *\r\n * Every object that inherits from [[Sprite]] can and will add their own\r\n * properties to the available list.\r\n *\r\n * User can create their own states, and apply them as needed:\r\n *\r\n * ```TypeScript\r\n * let myCustomState = sprite.states.create(\"mystate\");\r\n * myCustomState.properties.fillOpacity = 0.5;\r\n * myCustomState.properties.strokeOpacity = 0.8;\r\n * sprite.setState(\"mystate\");\r\n * ```\r\n * ```JavaScript\r\n * var myCustomState = sprite.states.create(\"mystate\");\r\n * myCustomState.properties.fillOpacity = 0.5;\r\n * myCustomState.properties.strokeOpacity = 0.8;\r\n * sprite.setState(\"mystate\");\r\n * ```\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v4/concepts/states/}\r\n * @important\r\n */\r\nexport class SpriteState<P, A> extends BaseObject {\r\n\r\n\t/**\r\n\t * Defines property types.\r\n\t */\r\n\tpublic _properties!: P;\r\n\r\n\t/**\r\n\t * Defines adapter types.\r\n\t */\r\n\tpublic _adapter!: A;\r\n\r\n\t/**\r\n\t * Title of the state, i.e. \"default\", \"hidden\", etc.\r\n\t */\r\n\tpublic name: string;\r\n\r\n\t/**\r\n\t * Reference to [[Sprite]] element this State is for.\r\n\t */\r\n\tpublic sprite: $type.Optional<Sprite>;\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tpublic _adapterO: Adapter<this, A>;\r\n\r\n\t/**\r\n\t * Holds Adapter.\r\n\t */\r\n\tpublic get adapter(): Adapter<this, A> {\r\n\t\tif (!this._adapterO) {\r\n\t\t\tthis._adapterO = new Adapter<this, A>(this);\r\n\r\n\t\t\t// Decorate adapter with events so that we can apply its settings whenever\r\n\t\t\t// it is modified\r\n\t\t\tthis._adapterO.events.on(\"inserted\", (ev: any) => {\r\n\t\t\t\t(<any>this)[ev.newValue.key] = (<any>this)[ev.newValue.key];\r\n\t\t\t}, undefined, false);\r\n\t\t\tthis._adapterO.events.on(\"removed\", (ev: any) => {\r\n\t\t\t\t(<any>this)[ev.newValue.key] = (<any>this)[ev.newValue.key];\r\n\t\t\t}, undefined, false);\r\n\t\t}\r\n\t\treturn this._adapterO;\r\n\t}\r\n\r\n\t/**\r\n\t * Duration of the transition to this state. 0 means instantenous transition.\r\n\t * Any number means the [[Sprite]] will transit smoothly to this state,\r\n\t * animating all animatable properties.\r\n\t *\r\n\t * @default 0\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/animations/} for more info about animations\r\n\t */\r\n\tpublic transitionDuration: number = 0;\r\n\r\n\t/**\r\n\t * Easing function to use when transitioning to this state.\r\n\t *\r\n\t * @default cubicOut\r\n\t * @see {@link Ease}\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/animations/} for more info about animations\r\n\t */\r\n\tpublic transitionEasing: (value: number) => number = $ease.cubicOut;\r\n\r\n\t/**\r\n\t * Collection of properties and their values that should be applied to [[Sprite]]\r\n\t * when switching to this State.\r\n\t *\r\n\t * The property values set on a [[SpriteState]] will override the ones set\r\n\t * directly on a [[Sprite]].\r\n\t */\r\n\tpublic properties: P = <P>{};\r\n\r\n\t/**\r\n\t * A collection of key/value pairs that can be used to bind specific Sprite\r\n\t * properties to [[DataItem]].\r\n\t *\r\n\t * For example: `fill` property can be bound to `myCustomColor` field in\r\n\t * DataItem. The Sprite will automatically get the value for `fill` from its\r\n\t * DataItem.\r\n\t *\r\n\t * SpriteState-specific binding will override binding set directly on\r\n\t * [[Sprite]]. I.e. you can make Sprite use different fill color on hover by\r\n\t * adding a `fill` binding to a different DataItem key for Sprite's \"hover\"\r\n\t * state object.\r\n\t *\r\n\t * @see {@link Sprite}\r\n\t */\r\n\tpublic propertyFields: { [index in keyof this[\"_properties\"]]?: string } = {};\r\n\t//public propertyFields: Dictionary<keyof this[\"_properties\"], string> = new Dictionary<keyof this[\"_properties\"], string>();;\r\n\r\n\t/**\r\n\t * A list of [[Filter]] elements to be applied to the relative [[Sprite]]\r\n\t * when switching to this State.\r\n\t *\r\n\t * @param {List}\r\n\t */\r\n\tpublic filters = new List<Filter>();\r\n\r\n\t/**\r\n\t * Identifies if this object is a \"template\" and should not be treated as\r\n\t * real object that is drawn or actually used in the chart.\r\n\t */\r\n\tpublic isTemplate: boolean = false;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"SpriteState\";\r\n\r\n\t\t// Make filter list disposable\r\n\t\tthis._disposers.push(new ListDisposer(this.filters));\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns [[Sprite]] element's property value.\r\n\t *\r\n\t * Will check if there are any bindings with [[DataItem]] and if there are\r\n\t * any method callbacks set up for the specific property.\r\n\t *\r\n\t * @param propertyName  Property name\r\n\t * @return Property value\r\n\t */\r\n\tpublic getPropertyValue<Key extends keyof P>(propertyName: Key): P[Key] {\r\n\t\tlet propValue: any = this.properties[propertyName];\r\n\t\tlet sprite: $type.Optional<Sprite> = this.sprite;\r\n\r\n\t\tif (sprite) {\r\n\t\t\tlet fieldName: string = this.propertyFields[propertyName];\r\n\r\n\t\t\tif ($type.hasValue(fieldName)) {\r\n\t\t\t\tif (sprite.dataItem) {\r\n\t\t\t\t\tpropValue = (<any>sprite.dataItem.dataContext)[fieldName];\r\n\t\t\t\t}\r\n\t\t\t\tif(propValue == undefined){\r\n\t\t\t\t\tpropValue = \"__unset\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Apply adapters\r\n\t\t\t// If the value itself is undefined, we're going to pass in Sprite's\r\n\t\t\t// value to adapters\r\n\t\t\t// @todo get rid of <any>\r\n\t\t\tif (!$type.hasValue(propValue)) {\r\n\t\t\t\tlet spriteValue = sprite.getPropertyValue(<any>propertyName);\r\n\t\t\t\tif (this._adapterO) {\r\n\t\t\t\t\tpropValue = this._adapterO.apply(<any>propertyName, spriteValue);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tpropValue = spriteValue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (propValue == spriteValue) {\r\n\t\t\t\t\tpropValue = undefined;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this._adapterO) {\r\n\t\t\t\t\tpropValue = this._adapterO.apply(<any>propertyName, propValue)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t/*let method = this.propertyMethods.getKey(propertyName);\r\n\t\t\tif (method) {\r\n\t\t\t\tpropValue = method(sprite, propertyName);\r\n\t\t\t}*/\r\n\r\n\t\t}\r\n\r\n\t\treturn propValue;\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all property and style values from another [[SpriteState]] object.\r\n\t *\r\n\t * @param source  Source [[SpriteState]]\r\n\t */\r\n\tpublic copyFrom(source: this) {\r\n\t\tif (source && source != this) {\r\n\t\t\tthis.transitionDuration = source.transitionDuration;\r\n\t\t\tthis.transitionEasing = source.transitionEasing;\r\n\r\n\t\t\t$utils.copyProperties(source.properties, this.properties);\r\n\t\t\t$utils.copyProperties(source.propertyFields, this.propertyFields);\r\n\t\t\tthis.filters.copyFrom(source.filters);\r\n\t\t\tif(source._adapterO){\r\n\t\t\t\tthis.adapter.copyFrom(source._adapterO);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns all values that should be applied by the SpriteState.\r\n\t *\r\n\t * It takes adapters into account.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Properties\r\n\t * @todo Add adapter values\r\n\t * @todo proper type this[\"_properties\"]\r\n\t */\r\n\tpublic get allValues(): P {\r\n\r\n\t\t// Init return value\r\n\t\tlet res: P = <P>{};\r\n\r\n\t\t// Apply adapters to all values\r\n\t\t$object.each(this.properties, (prop, value) => {\r\n\t\t\tres[prop] = this.getPropertyValue(prop);\r\n\t\t});\r\n\r\n\t\t// Cycle through all adapters and add values for missing properties\r\n\t\tif(this._adapterO){\r\n\t\t\tlet keys = this._adapterO.keys();\r\n\r\n\t\t\t$object.each(keys, (_x, prop) => {\r\n\t\t\t\tlet value = this.getPropertyValue<any>(prop);\r\n\t\t\t\t(<any>res)[prop] = value;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Cycle through all property fileds and add values for missing properties\r\n\t\tlet propertyFields = this.propertyFields;\r\n\r\n\t\t$object.each(propertyFields, (prop) => {\r\n\t\t\tlet value = this.getPropertyValue<any>(prop);\r\n\t\t\t(<any>res)[prop] = value;\r\n\t\t});\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Resets the State to initial state - no values or Filters applied.\r\n\t */\r\n\tpublic reset(): void {\r\n\t\tthis.properties = <P>{};\r\n\t\tthis.filters.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * Processes JSON-based config before it is applied to the object.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param config  Config\r\n\t */\r\n\tpublic processConfig(config?: { [index: string]: any }): void {\r\n\r\n\t\tif ($type.hasValue(config) && $type.hasValue(config[\"properties\"])) {\r\n\t\t\t$object.each(config[\"properties\"], (key, value) => {\r\n\t\t\t\tif ($type.isString(value)) {\r\n\t\t\t\t\tif (value.match(/^[0-9.\\-]+\\%$/)) {\r\n\t\t\t\t\t\tconfig[\"properties\"][key] = percent($type.toNumber(value));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (value.match(/^\\#[0-9abcdef]{3,}$/i)) {\r\n\t\t\t\t\t\tconfig[\"properties\"][key] = toColor(value);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tsuper.processConfig(config);\r\n\t}\r\n\r\n\t/**\r\n\t * Adds easing functions to \"function\" fields.\r\n\t *\r\n\t * @param field  Field name\r\n\t * @return Assign as function?\r\n\t */\r\n\tprotected asFunction(field: string): boolean {\r\n\t\treturn field == \"transitionEasing\" || super.asIs(field);\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"SpriteState\"] = SpriteState;\r\n","/**\n * ============================================================================\n * IMPORTS\n * ============================================================================\n * @hidden\n */\nimport { Ordering } from \"./Order\";\n\n\n/**\n * ============================================================================\n * COMPARING FUNCTIONS\n * ============================================================================\n * @hidden\n */\n\n/**\n * Comparing function used for ordering.\n *\n * @ignore Exclude from docs\n * @param a  Number 1\n * @param b  Number 2\n * @return Result\n */\nexport function order(a: number, b: number): Ordering {\n\tif (a === b) {\n\t\treturn 0;\n\n\t} else if (a < b) {\n\t\treturn -1;\n\n\t} else {\n\t\treturn 1;\n\t}\n}\n","/**\n * A collection of functions for ordering.\n */\n\n/**\n * ============================================================================\n * UTILITY FUNCTIONS\n * ============================================================================\n * @hidden\n */\n\n/**\n * Defines values that ordering functions can return.\n */\nexport type Ordering = -1 | 0 | 1;\n\n/**\n * [reverse description]\n *\n * @ignore Exclude from docs\n * @todo Description\n * @param a  [description]\n * @return [description]\n */\nexport function reverse(a: Ordering): Ordering {\n\tswitch (a) {\n\t\tcase 0:\n\t\t\treturn 0;\n\t\tcase -1:\n\t\t\treturn 1;\n\t\tcase 1:\n\t\t\treturn -1;\n\t}\n}\n\n/**\n * [or description]\n *\n * @ignore Exclude from docs\n * @todo Description\n * @param a  Item 1\n * @param b  Item 2\n * @return [description]\n */\nexport function or(a: Ordering, b: Ordering): Ordering {\n\tif (a === 0) {\n\t\treturn b;\n\n\t} else {\n\t\treturn a;\n\t}\n}\n","/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite } from \"./Sprite\";\r\nimport { Dictionary } from \"./utils/Dictionary\";\r\nimport { EventListener, TargetedEventDispatcher, AMEvent } from \"./utils/EventDispatcher\";\r\nimport { InteractionObject, IInteractionObjectEvents } from \"./interaction/InteractionObject\";\r\nimport { IPointer } from \"./interaction/Pointer\";\r\nimport { MultiDisposer, IDisposer, CounterDisposer } from \"./utils/Disposer\";\r\nimport { IPoint } from \"./defs/IPoint\";\r\nimport * as $utils from \"./utils/Utils\";\r\nimport * as $object from \"./utils/Object\";\r\n\r\n/**\r\n * ============================================================================\r\n * RE-EXPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nexport { AMEvent };\r\n\r\n/**\r\n * An [[EventDispatcher]] for [[Sprite]].\r\n *\r\n * @important\r\n */\r\nexport class SpriteEventDispatcher<T extends AMEvent<Sprite, ISpriteEvents>> extends TargetedEventDispatcher<Sprite, T> {\r\n\r\n\t/**\r\n\t * [_interactionEvents description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprivate _interactionEvents = new Dictionary<string, CounterDisposer>();\r\n\r\n\t/**\r\n\t * [_dispatchSpriteEvent description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprivate _dispatchSpriteEvent<Key extends keyof IInteractionObjectEvents>(ev: AMEvent<InteractionObject, IInteractionObjectEvents>[Key]): void {\r\n\t\tif (this.target.disabled || this.target.isTemplate) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// TODO remove this <any> later\r\n\t\tif (this.target.events.isEnabled(ev.type)) {\r\n\t\t\tlet imev: AMEvent<Sprite, ISpriteEvents>[Key] = <any>$object.merge(ev, {\r\n\t\t\t\ttarget: this.target\r\n\t\t\t});\r\n\t\t\tthis.target.events.dispatchImmediately(imev.type, imev);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [_dispatchSpritePointEvent description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprivate _dispatchSpritePointEvent<Key extends \"hit\" | \"track\">(ev: AMEvent<InteractionObject, IInteractionObjectEvents>[Key]): void {\r\n\t\tif (this.target.disabled || this.target.isTemplate) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// TODO remove this <any> later\r\n\t\tif (this.target.events.isEnabled(ev.type)) {\r\n\r\n\t\t\tlet imev: AMEvent<Sprite, ISpriteEvents>[Key] = <any>$object.merge(ev, {\r\n\t\t\t\ttarget: this.target,\r\n\t\t\t\tspritePoint: ev.point ? $utils.documentPointToSprite(ev.point, this.target) : undefined,\r\n\t\t\t\tsvgPoint: this.target.getSvgPoint(ev.point)\r\n\t\t\t});\r\n\t\t\tthis.target.events.dispatchImmediately(imev.type, imev);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [_addInteractionObjectEvent description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprivate _addInteractionObjectEvent<C, Key extends keyof IInteractionObjectEvents>(type: Key, callback: (this: C, ev: AMEvent<InteractionObject, IInteractionObjectEvents>[Key]) => void, context: C, shouldClone: boolean): IDisposer {\r\n\t\tconst key = shouldClone + \"-\" + type;\r\n\r\n\t\tconst counter = this._interactionEvents.insertKeyIfEmpty(key, () => {\r\n\t\t\tconst disposer = this.target.interactions.events.on(type, callback, context, shouldClone);\r\n\r\n\t\t\treturn new CounterDisposer(() => {\r\n\t\t\t\tthis._interactionEvents.removeKey(key);\r\n\t\t\t\tdisposer.dispose();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn counter.increment();\r\n\t}\r\n\r\n\t/**\r\n\t * [_on description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _on<A, B, Key extends keyof T>(once: boolean, type: Key | null, callback: A, context: B, shouldClone: boolean, dispatch: (type: Key, event: T[Key]) => void): EventListener<T> {\r\n\t\tconst info = super._on(once, type, callback, context, shouldClone, dispatch);\r\n\r\n\t\tconst disposers = [info.disposer];\r\n\r\n\t\t/**\r\n\t\t * Catching Sprite-related events, converting them to [[SpriteEvent]] and\r\n\t\t * triggering them on sprite\r\n\t\t */\r\n\t\tswitch (type) {\r\n\t\t\tcase \"hit\":\r\n\t\t\tcase \"track\":\r\n\t\t\tcase \"doublehit\":\r\n\t\t\tcase \"wheel\":\r\n\t\t\tcase \"wheelup\":\r\n\t\t\tcase \"wheeldown\":\r\n\t\t\tcase \"wheelleft\":\r\n\t\t\tcase \"wheelright\":\r\n\t\t\t\tdisposers.push(this._addInteractionObjectEvent(<any>type, this._dispatchSpritePointEvent, this, shouldClone));\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"rightclick\":\r\n\t\t\tcase \"down\":\r\n\t\t\t//case \"hold\":\r\n\t\t\tcase \"up\":\r\n\t\t\tcase \"drag\":\r\n\t\t\tcase \"dragged\":\r\n\t\t\tcase \"dragstart\":\r\n\t\t\tcase \"dragstop\":\r\n\t\t\tcase \"over\":\r\n\t\t\tcase \"out\":\r\n\t\t\tcase \"swipe\":\r\n\t\t\tcase \"swipeleft\":\r\n\t\t\tcase \"swiperight\":\r\n\t\t\tcase \"resize\":\r\n\t\t\t//case \"rotate\":\r\n\t\t\tcase \"focus\":\r\n\t\t\tcase \"blur\":\r\n\t\t\tcase \"toggled\":\r\n\t\t\t\tdisposers.push(this._addInteractionObjectEvent(<any>type, this._dispatchSpriteEvent, this, shouldClone));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Set functional properties based on events. For example if we add a\r\n\t\t * \"drag\" event handler, we want to make the Sprite draggable, even if we\r\n\t\t * don't explicitly set \"draggable\"\r\n\t\t */\r\n\t\tswitch (type) {\r\n\t\t\tcase \"hit\":\r\n\t\t\tcase \"doublehit\":\r\n\t\t\tcase \"rightclick\":\r\n\t\t\tcase \"down\":\r\n\t\t\tcase \"up\":\r\n\t\t\t\tthis.target.clickable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"toggled\":\r\n\t\t\t\tthis.target.togglable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"drag\":\r\n\t\t\tcase \"dragstart\":\r\n\t\t\tcase \"dragstop\":\r\n\t\t\t\tthis.target.draggable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"track\":\r\n\t\t\t\tthis.target.trackable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"resize\":\r\n\t\t\t\tthis.target.resizable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"swipe\":\r\n\t\t\tcase \"swipeleft\":\r\n\t\t\tcase \"swiperight\":\r\n\t\t\t\tthis.target.swipeable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"wheel\":\r\n\t\t\tcase \"wheelup\":\r\n\t\t\tcase \"wheeldown\":\r\n\t\t\tcase \"wheelleft\":\r\n\t\t\tcase \"wheelright\":\r\n\t\t\t\tthis.target.wheelable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"over\":\r\n\t\t\t\tthis.target.hoverable = true;\r\n\t\t\tcase \"out\":\r\n\t\t\t\tthis.target.hoverable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"focus\":\r\n\t\t\tcase \"blur\":\r\n\t\t\t\tthis.target.focusable = true;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tinfo.disposer = new MultiDisposer(disposers);\r\n\r\n\t\treturn info;\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * Defines a type of event that has a single point of reference.\r\n */\r\nexport type SpritePointerTypeEvent = {\r\n\r\n\t/**\r\n\t * Is event originated by touch pointer?\r\n\t */\r\n\ttouch: boolean;\r\n\r\n};\r\n\r\n/**\r\n * Defines property set for a [[Sprite]] event that contains point information.\r\n */\r\nexport type SpritePointEvent = {\r\n\t/**\r\n\t * Event point in global (document) coordinates.\r\n\t */\r\n\tpoint: IPoint;\r\n\r\n\t/**\r\n\t * Event point in local Sprite coordinates.\r\n\t */\r\n\tspritePoint: IPoint;\r\n\r\n\t/**\r\n\t * Event point with chart (svg) coodinates.\r\n\t */\r\n\tsvgPoint: IPoint;\r\n};\r\n\r\n\r\n/**\r\n * Defines a type of event that has a related Pointer.\r\n */\r\nexport type SpritePointerEvent = {\r\n\r\n\t/**\r\n\t * Coordinates of the primary cursor position.\r\n\t */\r\n\tpointer: IPointer;\r\n\r\n};\r\n\r\n\r\n/**\r\n * Defines property set for a [[Sprite]] event that contains mouse or touch\r\n * event.\r\n */\r\nexport type SpriteMouseTouchEvent = {\r\n\r\n\t/**\r\n\t * Original mouse/touch event.\r\n\t */\r\n\tevent: MouseEvent | TouchEvent;\r\n\r\n};\r\n\r\n/**\r\n * Defines property set for a [[Sprite]] event that contains coordinate shift\r\n * information, such as drag events.\r\n */\r\nexport type SpriteShiftEvent = {\r\n\r\n\t/**\r\n\t * Shift in coordinates after dragging.\r\n\t */\r\n\tshift: IPoint;\r\n\r\n};\r\n\r\n/**\r\n * Defines available events available for [[Sprite]].\r\n */\r\nexport interface ISpriteEvents extends IInteractionObjectEvents {\r\n\r\n\t/**\r\n\t * Invoked when Sprite completes transition to a [[SpriteState]].\r\n\t */\r\n\ttransitionended: {};\r\n\r\n\t/**\r\n\t * Invoked when size of the Sprite changes.\r\n\t */\r\n\tsizechanged: {};\r\n\r\n\t/**\r\n\t * Invoked when maximum available size of the Sprite changes, i.e. when the\r\n\t * size of parent container changes.\r\n\t */\r\n\tmaxsizechanged: {\r\n\t\tpreviousWidth: number,\r\n\t\tpreviousHeight: number\r\n\t};\r\n\r\n\t/**\r\n\t * @todo Description\r\n\t */\r\n\ttransformed: {\r\n\r\n\t\t/**\r\n\t\t * [string description]\r\n\t\t * @todo Needs description\r\n\t\t */\r\n\t\tdummyData?: string;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when position of the [[Sprite]] changes.\r\n\t */\r\n\tpositionchanged: {};\r\n\r\n\t/**\r\n\t * Invoked when [[Sprite]] is initialized.\r\n\t */\r\n\tinited: {};\r\n\r\n\t/**\r\n\t * Invoked when [[Sprite]] appears. Sprite appears when `sprite.appear()` method\r\n\t * is called and show animation is finished.\r\n\t */\r\n\tappeared: {};\r\n\r\n\t/**\r\n\t * Invoked when chart is shown if `am4core.options.queue = true` or/and `am4core.options.onlyShowOnViewport = true`.\r\n\t */\r\n\tremovedfromqueue: {};\r\n\r\n\t/**\r\n\t * Invoked when [[Sprite]] is becomes ready, that is it has finished all\r\n\t * calculations and building itself.\r\n\t *\r\n\t * For [[Container]] object (and all those inheriting it, including charts)\r\n\t * this event will fire when all children become ready.\r\n\t */\r\n\tready: {};\r\n\r\n\t/**\r\n\t * Invoked before [[Sprite]] is validated.\r\n\t *\r\n\t * @todo Description (check)\r\n\t */\r\n\tbeforevalidated: {};\r\n\r\n\t/**\r\n\t * Invoked when [[Sprite]] is validated. (on init or after update)\r\n\t *\r\n\t * @todo Description (check)\r\n\t */\r\n\tvalidated: {};\r\n\r\n\t/**\r\n\t * Invoked when visibility of the [[Sprite]] changes. (from visible to hidden,\r\n\t * and vice versa)\r\n\t */\r\n\tvisibilitychanged: {\r\n\t\tvisible: boolean;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when hidden [[Sprite]] is shown.\r\n\t */\r\n\tshown: {};\r\n\r\n\t/**\r\n\t * Invoked when visible [[Sprite]] is hidden.\r\n\t */\r\n\thidden: {};\r\n\r\n\t/**\r\n\t * Invoked when zIndex of a sprite is changed\r\n\t */\r\n\tzIndexChanged: {};\r\n\r\n\t/**\r\n\t * Invoked when property of the [[Sprite]] changes.\r\n\t */\r\n\tpropertychanged: {\r\n\r\n\t\t/**\r\n\t\t * Property key.\r\n\t\t */\r\n\t\tproperty: string;\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when the global scale changed, meaning that scale of [[Sprite]]\r\n\t * or any of its ascendants changed.\r\n\t */\r\n\tglobalscalechanged: {};\r\n\r\n\t/**\r\n\t * Invoked when [[Sprite]] is clicked or touched.\r\n\t */\r\n\thit: SpritePointerTypeEvent & SpritePointEvent & SpriteMouseTouchEvent;\r\n\r\n\t/**\r\n\t * Invoked when [[Sprite]] is clicked or touched twice in rapid succession.\r\n\t */\r\n\tdoublehit: SpritePointerTypeEvent & SpritePointEvent & SpriteMouseTouchEvent;\r\n\r\n\t/**\r\n\t * Invoked when pointer (mouse cursor or touch point) moves over `trackable`\r\n\t * [[Sprite]].\r\n\t */\r\n\ttrack:  SpritePointerTypeEvent & SpritePointEvent & SpritePointerEvent & SpriteMouseTouchEvent;\r\n\r\n\t/**\r\n\t * Invoked when user turns mouse wheel while over the [[Sprite]].\r\n\t */\r\n\twheel: SpritePointEvent & SpriteShiftEvent & {\r\n\r\n\t\t/**\r\n\t\t * Original JavaScript event.\r\n\t\t */\r\n\t\tevent: WheelEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when user turns mouse wheel upwards while over the [[Sprite]].\r\n\t */\r\n\twheelup: SpritePointEvent & SpriteShiftEvent & {\r\n\r\n\t\t/**\r\n\t\t * Original JavaScript event\r\n\t\t */\r\n\t\tevent: WheelEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when user turns mouse wheel downwards while over the [[Sprite]].\r\n\t */\r\n\twheeldown: SpritePointEvent & SpriteShiftEvent & {\r\n\r\n\t\t/**\r\n\t\t * Original JavaScript event.\r\n\t\t */\r\n\t\tevent: WheelEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when user turns mouse wheel leftwards while over the [[Sprite]].\r\n\t */\r\n\twheelleft: SpritePointEvent & SpriteShiftEvent & {\r\n\r\n\t\t/**\r\n\t\t * Original JavaScript event\r\n\t\t */\r\n\t\tevent: WheelEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when user turns mouse wheel rightwards while over the [[Sprite]].\r\n\t */\r\n\twheelright: SpritePointEvent & SpriteShiftEvent & {\r\n\r\n\t\t/**\r\n\t\t * Original JavaScript event.\r\n\t\t */\r\n\t\tevent: WheelEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when `togglable` Sprite is being toggled on and off. (its\r\n\t * `isActive` property is being changed)\r\n\t */\r\n\ttoggled: {};\r\n\r\n\t/**\r\n\t * Invoked just before Sprite is disposed.\r\n\t */\r\n\tbeforedisposed: {};\r\n\r\n\t/**\r\n\t * Invoked when sprite is disabled\r\n\t */\r\n\tdisabled: {};\r\n\r\n\t/**\r\n\t * Invoked when sprite is enabled\r\n\t */\r\n\tenabled: {};\r\n\r\n\t/**\r\n\t * Invoked when `draggable` object is being dragged. (using mouse, touch or\r\n\t * keyboard).\r\n\t *\r\n\t * This is simmilar but different then `\"drag\"` event in that it kicks in\r\n\t * after `\"drag\"` which modifies [[Sprite]] coordinates. This allows doing\r\n\t * own manipulations and corrections to element positions.\r\n\t */\r\n\tdragged: SpritePointerTypeEvent & SpriteShiftEvent & SpritePointEvent & {\r\n\r\n\t\t/**\r\n\t\t * Original coordinates of the pointer's position when the dragging started.\r\n\t\t */\r\n\t\tstartPoint: IPoint,\r\n\r\n\t\t/**\r\n\t\t * An original JavaScript event that triggered dragging.\r\n\t\t */\r\n\t\tevent?: MouseEvent | TouchEvent | KeyboardEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when a sprite is added to a parent\r\n\t */\r\n\tparentset: {};\r\n\r\n}\r\n","/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { IBaseObjectEvents } from \"../Base\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { IPointer } from \"../interaction/Pointer\";\r\nimport { InteractionObject } from \"../interaction/InteractionObject\";\r\nimport { EventListener, TargetedEventDispatcher, AMEvent } from \"../utils/EventDispatcher\";\r\nimport { MultiDisposer, IDisposer, CounterDisposer } from \"../utils/Disposer\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines a type of event that has a single point of reference.\r\n */\r\nexport type PointerTypeEvent = {\r\n\r\n\t/**\r\n\t * Is event originated by touch pointer?\r\n\t */\r\n\ttouch: boolean;\r\n\r\n};\r\n\r\n/**\r\n * Defines a type of event that has a single point of reference.\r\n */\r\nexport type PointEvent = {\r\n\r\n\t/**\r\n\t * Event point in global (document) coordinates.\r\n\t */\r\n\tpoint: IPoint;\r\n\r\n};\r\n\r\n/**\r\n * Defines a type of event that has a related Pointer.\r\n */\r\nexport type PointerEvent = {\r\n\r\n\t/**\r\n\t * Coordinates of the primary cursor position.\r\n\t */\r\n\tpointer: IPointer;\r\n\r\n};\r\n\r\n/**\r\n * Defines a type of event that represents some kind of shift in coordinates,\r\n * like draging an element.\r\n */\r\nexport type ShiftEvent = {\r\n\r\n\t/**\r\n\t * Shift in coordinates after dragging.\r\n\t */\r\n\tshift: IPoint;\r\n\r\n};\r\n\r\n/**\r\n * Defines a type of event that represents change in angle, like rotation.\r\n */\r\nexport type AngleEvent = {\r\n\r\n\t/**\r\n\t * Angle to apply to the element.\r\n\t */\r\n\tangle: number;\r\n};\r\n\r\n\r\n/**\r\n * Defines a type of event that represents change in element's scale, like\r\n * resize.\r\n */\r\nexport type ScaleEvent = {\r\n\r\n\t/**\r\n\t * Scale to apply to the element.\r\n\t */\r\n\tscale: number;\r\n\r\n};\r\n\r\n/**\r\n * Defines an event that contains event center coordindates.\r\n */\r\nexport type CenterEvent = {\r\n\r\n\t/**\r\n\t * A center point for specific operation.\r\n\t */\r\n\tcenter?: IPoint;\r\n\r\n};\r\n\r\n/**\r\n * Defines an event that can be triggered either by touch device or mouse.\r\n */\r\nexport type MouseTouchEvent = {\r\n\r\n\t/**\r\n\t * An original mouse or touch event.\r\n\t */\r\n\tevent: MouseEvent | TouchEvent;\r\n\r\n};\r\n\r\n/**\r\n * Defines an event that was not generated by keyboard directly, but rather\r\n * was simulated to trigger require keyboard-related handlers.\r\n */\r\nexport type SimulatedKeyboardEvent = {\r\n\r\n\t/**\r\n\t * A keyboard event.\r\n\t */\r\n\tevent: KeyboardEvent;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[InteractionObject]].\r\n */\r\nexport interface IInteractionObjectEvents extends IBaseObjectEvents {\r\n\r\n\t/**\r\n\t * Invoked when object is clicked or touched.\r\n\t */\r\n\thit: PointerTypeEvent & PointEvent & MouseTouchEvent;\r\n\r\n\t/**\r\n\t * Invoked when object is clicked or touched twice in rapid succession.\r\n\t *\r\n\t * Check [[IHitOptions]] for settings about double hit.\r\n\t */\r\n\tdoublehit: PointerTypeEvent & PointEvent & MouseTouchEvent;\r\n\r\n\t/**\r\n\t * Invoked when right mouse button is clicked on the object.\r\n\t */\r\n\trightclick: MouseTouchEvent;\r\n\r\n\t/**\r\n\t * Invoked when mouse or touch pointer is held down over object for some time.\r\n\t * @ignore\r\n\t * @deprecated\r\n\t */\r\n\thold: PointerTypeEvent & PointerEvent & MouseTouchEvent;\r\n\r\n\t/**\r\n\t * Invoked when the mouse button is pressed or touch starts.\r\n\t */\r\n\tdown: PointerTypeEvent & PointerEvent & MouseTouchEvent;\r\n\r\n\t/**\r\n\t * Invoked when the mouse button is released or touch ends.\r\n\t */\r\n\tup: PointerTypeEvent & PointerEvent & MouseTouchEvent;\r\n\r\n\t/**\r\n\t * Invoked when `draggable` object is being dragged. (using mouse, touch or\r\n\t * keyboard)\r\n\t */\r\n\tdrag: PointerTypeEvent & ShiftEvent & PointEvent & {\r\n\r\n\t\t/**\r\n\t\t * Original coordinates of the pointer's position when the dragging started.\r\n\t\t */\r\n\t\tstartPoint: IPoint,\r\n\r\n\t\t/**\r\n\t\t * An original JavaScript event that triggered dragging.\r\n\t\t */\r\n\t\tevent?: MouseEvent | TouchEvent | KeyboardEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when `draggable` object dragging starts. This event is not\r\n\t * invoked immediatelly after `down`, but only if there's a movement of the\r\n\t * pointer.\r\n\t */\r\n\tdragstart: PointerTypeEvent & {\r\n\r\n\t\t/**\r\n\t\t * An original JavaScript event that triggered dragging.\r\n\t\t */\r\n\t\tevent?: MouseEvent | TouchEvent | KeyboardEvent\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Invoked when `draggable` object is released. This event will not fire if\r\n\t * position of the object did not change.\r\n\t */\r\n\tdragstop: PointerTypeEvent & {\r\n\r\n\t\t/**\r\n\t\t * An original JavaScript event that triggered dragging.\r\n\t\t */\r\n\t\tevent?: MouseTouchEvent | KeyboardEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when pointer (mouse cursor or touch point) moves over `trackable`\r\n\t * object.\r\n\t */\r\n\ttrack: PointerTypeEvent & PointEvent & PointerEvent & MouseTouchEvent;\r\n\r\n\t/**\r\n\t * Invoked when `resizable` object is being resized either by mouse or touch\r\n\t * pinch gesture.\r\n\t */\r\n\tresize: PointerTypeEvent & ScaleEvent & MouseTouchEvent & {\r\n\r\n\t\t/**\r\n\t\t * The starting coordinates of the first reference point.\r\n\t\t */\r\n\t\tstartPoint1: IPoint,\r\n\r\n\t\t/**\r\n\t\t * Current coordinates of the first reference point.\r\n\t\t */\r\n\t\tpoint1: IPoint,\r\n\r\n\t\t/**\r\n\t\t * The starting coordinates of the second reference point.\r\n\t\t */\r\n\t\tstartPoint2: IPoint,\r\n\r\n\t\t/**\r\n\t\t * Current coordinates of the second reference point.\r\n\t\t */\r\n\t\tpoint2: IPoint\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when user performs \"swiping\" gesture (quick horizontal movement)\r\n\t * on the object, either using mouse or touch.\r\n\t */\r\n\tswipe: PointerTypeEvent & MouseTouchEvent;\r\n\r\n\t/**\r\n\t * Invoked when user performs \"swiping\" gesture towards left.\r\n\t */\r\n\tswipeleft: PointerTypeEvent & MouseTouchEvent;\r\n\r\n\t/**\r\n\t * Invoked when user performs \"swiping\" gesture towards right.\r\n\t */\r\n\tswiperight: PointerTypeEvent & MouseTouchEvent;\r\n\r\n\t/**\r\n\t * Invoked when user turns mouse wheel while over the object.\r\n\t */\r\n\twheel: PointEvent & ShiftEvent & {\r\n\r\n\t\t/**\r\n\t\t * Original JavaScript event.\r\n\t\t */\r\n\t\tevent: WheelEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when user turns mouse wheel upwards while over the object.\r\n\t */\r\n\twheelup: PointEvent & ShiftEvent & {\r\n\r\n\t\t/**\r\n\t\t * Original JavaScript event.\r\n\t\t */\r\n\t\tevent: WheelEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when user turns mouse wheel downwards while over the object.\r\n\t */\r\n\twheeldown: PointEvent & ShiftEvent & {\r\n\r\n\t\t/**\r\n\t\t * Original JavaScript event.\r\n\t\t */\r\n\t\tevent: WheelEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when user turns mouse wheel leftwards while over the object.\r\n\t */\r\n\twheelleft: PointEvent & ShiftEvent & {\r\n\r\n\t\t/**\r\n\t\t * Original JavaScript event.\r\n\t\t */\r\n\t\tevent: WheelEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when user turns mouse wheel rightwards while over the object.\r\n\t */\r\n\twheelright: PointEvent & ShiftEvent & {\r\n\r\n\t\t/**\r\n\t\t * Original JavaScript event.\r\n\t\t */\r\n\t\tevent: WheelEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when mouse cursor moves over `hoverable` object or it is touched.\r\n\t *\r\n\t * NOTE: this event might not always contains `pointer` parameter as\r\n\t * event might be triggered by API?\r\n\t */\r\n\tover: PointerTypeEvent & MouseTouchEvent & PointerEvent;\r\n\r\n\t/**\r\n\t * Invoked when mouse cursor moves out of `hoverable` object or it is no\r\n\t * longer touched.\r\n\t *\r\n\t * NOTE: this event might not always contains `pointer` parameter as\r\n\t * event might be triggered by API?\r\n\t */\r\n\tout: PointerTypeEvent & MouseTouchEvent & PointerEvent;\r\n\r\n\t/**\r\n\t * Invoked when `focusable` object gains focus, e.g. by using TAB button.\r\n\t */\r\n\tfocus: {\r\n\r\n\t\t/**\r\n\t\t * Original JavaScript `FocusEvent`.\r\n\t\t */\r\n\t\tevent: FocusEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when `focusable` object loses focus, e.g. by clicking outside\r\n\t * it or pressing TAB button to focus on the next focusable object.\r\n\t */\r\n\tblur: {\r\n\r\n\t\t/**\r\n\t\t * Original JavaScript `FocusEvent`.\r\n\t\t */\r\n\t\tevent: FocusEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when the key is pressed on the keyboard.\r\n\t */\r\n\tkeydown: {\r\n\r\n\t\t/**\r\n\t\t * Orginal JavaScript `KeyboardEvent`.\r\n\t\t */\r\n\t\tevent: KeyboardEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when the key is released on the keyboard.\r\n\t */\r\n\tkeyup: {\r\n\r\n\t\t/**\r\n\t\t * Orginal JavaScript `KeyboardEvent`.\r\n\t\t */\r\n\t\tevent: KeyboardEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when the key generates a \"press\", e.g. pressing and holding a\r\n\t * letter key will generate repeated \"keypress\" events.\r\n\t */\r\n\tkeypress: {\r\n\r\n\t\t/**\r\n\t\t * Orginal JavaScript `KeyboardEvent`.\r\n\t\t */\r\n\t\tevent: KeyboardEvent\r\n\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked whenever information changes in the textual input elements, like\r\n\t * `<input>`, `<textarea>`, etc.\r\n\t */\r\n\tinput: {\r\n\r\n\t\t/**\r\n\t\t * Orginal JavaScript `KeyboardEvent`.\r\n\t\t */\r\n\t\tevent: KeyboardEvent\r\n\r\n\t};\r\n}\r\n\r\n/**\r\n * Represents an Event Dispatcher for [[InteractionObject]].\r\n *\r\n * Besides regular [[EventDispatcher]] functionality it adds new events with\r\n * direct application to DOM nodes. Primarily used to handle keyboard events,\r\n * but can turn into something else moving forward.\r\n */\r\nexport class InteractionObjectEventDispatcher<T extends AMEvent<InteractionObject, IInteractionObjectEvents>> extends TargetedEventDispatcher<InteractionObject, T> {\r\n\r\n\t/**\r\n\t * Holds a list of Disposers for DOM events added.\r\n\t */\r\n\tprivate _domEvents: { [key: string]: CounterDisposer } = {};\r\n\r\n\t/**\r\n\t * Adds a DOM event and returns Disposer.\r\n\t *\r\n\t * @return Disposer\r\n\t */\r\n\tprivate _addDOMEvent<E extends Event, Key extends keyof IInteractionObjectEvents, C>(\r\n\t\ttype: string,\r\n\t\tkey: Key,\r\n\t\tlistener: (this: C, key: Key, evt: E) => void,\r\n\t\tcontext: C\r\n\t): IDisposer {\r\n\t\tif (!this._domEvents[type]) {\r\n\t\t\tconst callback = function (e: Event): void {\r\n\t\t\t\tlistener.call(context, key, e as any);\r\n\t\t\t};\r\n\r\n\t\t\tthis.target.element.addEventListener(type, callback, false);\r\n\r\n\t\t\tthis._domEvents[type] = new CounterDisposer(() => {\r\n\t\t\t\tdelete this._domEvents[type];\r\n\r\n\t\t\t\tthis.target.element.removeEventListener(type, callback, false);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this._domEvents[type].increment();\r\n\t}\r\n\r\n\tprivate _dispatchKeyboardEvent<Key extends \"keydown\" | \"keyup\" | \"keypress\" | \"input\">(key: Key, ev: KeyboardEvent): void {\r\n\t\t// TODO use this.dispatchImmediately ?\r\n\t\tif (this.target.events.isEnabled(key)) {\r\n\t\t\tthis.target.events.dispatchImmediately(key, {\r\n\t\t\t\ttype: key as any,\r\n\t\t\t\ttarget: this.target,\r\n\t\t\t\tevent: ev\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _on<A, B, Key extends keyof T>(once: boolean, type: Key | null, callback: A, context: B, shouldClone: boolean, dispatch: (type: Key, event: T[Key]) => void): EventListener<T> {\r\n\t\tconst info = super._on(once, type, callback, context, shouldClone, dispatch);\r\n\r\n\t\tconst disposers = [info.disposer];\r\n\r\n\t\tswitch (type) {\r\n\t\t\tcase \"hit\":\r\n\t\t\tcase \"doublehit\":\r\n\t\t\tcase \"rightclick\":\r\n\t\t\tcase \"down\":\r\n\t\t\tcase \"up\":\r\n\t\t\t\tthis.target.clickable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"drag\":\r\n\t\t\tcase \"dragstart\":\r\n\t\t\tcase \"dragstop\":\r\n\t\t\t\tthis.target.draggable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"track\":\r\n\t\t\t\tthis.target.trackable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"resize\":\r\n\t\t\t\tthis.target.resizable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"swipe\":\r\n\t\t\tcase \"swipeleft\":\r\n\t\t\tcase \"swiperight\":\r\n\t\t\t\tthis.target.swipeable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"wheel\":\r\n\t\t\tcase \"wheelup\":\r\n\t\t\tcase \"wheeldown\":\r\n\t\t\tcase \"wheelleft\":\r\n\t\t\tcase \"wheelright\":\r\n\t\t\t\tthis.target.wheelable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"over\":\r\n\t\t\tcase \"out\":\r\n\t\t\t\tthis.target.hoverable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"focus\":\r\n\t\t\tcase \"blur\":\r\n\t\t\tcase \"focusin\":\r\n\t\t\tcase \"focusout\":\r\n\t\t\t\tthis.target.focusable = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"keydown\":\r\n\t\t\t\tdisposers.push(this._addDOMEvent<KeyboardEvent, \"keydown\", this>(<any>type, <any>type, this._dispatchKeyboardEvent, this));\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"keyup\":\r\n\t\t\t\tdisposers.push(this._addDOMEvent<KeyboardEvent, \"keyup\", this>(<any>type, <any>type, this._dispatchKeyboardEvent, this));\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"keypress\":\r\n\t\t\t\tdisposers.push(this._addDOMEvent<KeyboardEvent, \"keypress\", this>(<any>type, <any>type, this._dispatchKeyboardEvent, this));\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"input\":\r\n\t\t\t\tdisposers.push(this._addDOMEvent<KeyboardEvent, \"input\", this>(<any>type, <any>type, this._dispatchKeyboardEvent, this));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tinfo.disposer = new MultiDisposer(disposers);\r\n\r\n\t\treturn info;\r\n\t}\r\n\r\n}\r\n","/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { TimeUnit } from \"../defs/TimeUnit\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n/**\r\n * Maps time period names to their numeric representations in milliseconds.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport let timeUnitDurations: { [Key in TimeUnit]: number } = {\r\n\tmillisecond: 1,\r\n\tsecond: 1000,\r\n\tminute: 60000,\r\n\thour: 3600000,\r\n\tday: 86400000,\r\n\tweek: 604800000,\r\n\tmonth: 2592000000,\r\n\tyear: 31536000000\r\n};\r\n\r\n/**\r\n * Returns the next time unit that goes after source `unit`.\r\n *\r\n * E.g. \"hour\" is the next unit after \"minute\", etc.\r\n *\r\n * @ignore Exclude from docs\r\n * @param unit  Source time unit\r\n * @return Next time unit\r\n */\r\nexport function getNextUnit(unit: TimeUnit): $type.Optional<TimeUnit> {\r\n\tswitch (unit) {\r\n\t\tcase \"year\":\r\n\t\t\treturn\r\n\r\n\t\tcase \"month\":\r\n\t\t\treturn \"year\";\r\n\r\n\t\tcase \"week\":\r\n\t\t\treturn \"month\";\r\n\r\n\t\tcase \"day\":\r\n\t\t\treturn \"month\"; // not a mistake\r\n\r\n\t\tcase \"hour\":\r\n\t\t\treturn \"day\";\r\n\r\n\t\tcase \"minute\":\r\n\t\t\treturn \"hour\";\r\n\r\n\t\tcase \"second\":\r\n\t\t\treturn \"minute\"\r\n\r\n\t\tcase \"millisecond\":\r\n\t\t\treturn \"second\";\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns number of milliseconds in the `count` of time `unit`.\r\n *\r\n * Available units: \"millisecond\", \"second\", \"minute\", \"hour\", \"day\", \"week\",\r\n * \"month\", and \"year\".\r\n *\r\n * @ignore Exclude from docs\r\n * @param unit   Time unit\r\n * @param count  Number of units\r\n * @return Milliseconds\r\n */\r\nexport function getDuration(unit: TimeUnit, count?: number): number {\r\n\tif (!$type.hasValue(count)) {\r\n\t\tcount = 1;\r\n\t}\r\n\treturn timeUnitDurations[unit] * count;\r\n}\r\n\r\n/**\r\n * Returns current `Date` object.\r\n *\r\n * @return Current date\r\n */\r\nexport function now(): Date {\r\n\treturn new Date();\r\n}\r\n\r\n/**\r\n * Returns current timestamp.\r\n *\r\n * @return Current timestamp\r\n */\r\nexport function getTime(): number {\r\n\treturn now().getTime();\r\n}\r\n\r\n/**\r\n * Returns a copy of the `Date` object.\r\n *\r\n * @ignore Exclude from docs\r\n * @param date  Source date\r\n * @return Copy\r\n */\r\nexport function copy(date: Date): Date {\r\n\treturn new Date(date.getTime()); // todo: check if this is ok. new Date(date) used to strip milliseconds on FF in v3\r\n}\r\n\r\n/**\r\n * Checks if the `unit` part of two `Date` objects do not match. Two dates\r\n * represent a \"range\" of time, rather the same time date.\r\n *\r\n * @ignore Exclude from docs\r\n * @param dateOne  Date 1\r\n * @param dateTwo  Date 2\r\n * @param unit     Time unit to check\r\n * @return Range?\r\n */\r\nexport function checkChange(dateOne: Date, dateTwo: Date, unit: TimeUnit, utc?: boolean): boolean {\r\n\r\n\tdateOne = new Date(dateOne.getTime());\r\n\tdateTwo = new Date(dateTwo.getTime());\r\n\r\n\tlet timeZoneOffset1 = 0;\r\n\tlet timeZoneOffset2 = 0;\r\n\r\n\tif (!utc && unit != \"millisecond\") {\r\n\t\ttimeZoneOffset1 = dateOne.getTimezoneOffset();\r\n\t\tdateOne.setUTCMinutes(dateOne.getUTCMinutes() - timeZoneOffset1);\r\n\r\n\t\ttimeZoneOffset2 = dateTwo.getTimezoneOffset();\r\n\t\tdateTwo.setUTCMinutes(dateTwo.getUTCMinutes() - timeZoneOffset2);\r\n\t}\r\n\r\n\tlet changed = false;\r\n\tswitch (unit) {\r\n\t\tcase \"year\":\r\n\t\t\tif (dateOne.getUTCFullYear() != dateTwo.getUTCFullYear()) {\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"month\":\r\n\t\t\tif (dateOne.getUTCFullYear() != dateTwo.getUTCFullYear()) {\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\t\t\telse if (dateOne.getUTCMonth() != dateTwo.getUTCMonth()) {\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"day\":\r\n\t\t\tif (dateOne.getUTCMonth() != dateTwo.getUTCMonth()) {\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\t\t\telse if (dateOne.getUTCDate() != dateTwo.getUTCDate()) {\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"hour\":\r\n\t\t\tif (dateOne.getUTCHours() != dateTwo.getUTCHours()) {\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"minute\":\r\n\t\t\tif (dateOne.getUTCMinutes() != dateTwo.getUTCMinutes()) {\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"second\":\r\n\t\t\tif (dateOne.getUTCSeconds() != dateTwo.getUTCSeconds()) {\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"millisecond\":\r\n\t\t\tif (dateOne.getTime() != dateTwo.getTime()) {\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\tif (changed) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tlet nextUnit: $type.Optional<TimeUnit> = getNextUnit(unit);\r\n\tif (nextUnit) {\r\n\t\tdateOne.setUTCMinutes(dateOne.getUTCMinutes() + timeZoneOffset1);\r\n\t\tdateTwo.setUTCMinutes(dateTwo.getUTCMinutes() + timeZoneOffset2);\r\n\t\treturn checkChange(dateOne, dateTwo, nextUnit, utc);\r\n\t}\r\n\telse {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n/**\r\n * Adds `count` of time `unit` to the source date. Returns a modified `Date` object.\r\n *\r\n * @ignore Exclude from docs\r\n * @param date   Source date\r\n * @param unit   Time unit\r\n * @param count  Number of units to add\r\n * @return Modified date\r\n */\r\nexport function add(date: Date, unit: TimeUnit, count: number, utc?: boolean): Date {\r\n\tlet timeZoneOffset = 0;\r\n\r\n\tif (!utc && unit != \"millisecond\") {\r\n\t\ttimeZoneOffset = date.getTimezoneOffset();\r\n\t\tdate.setUTCMinutes(date.getUTCMinutes() - timeZoneOffset);\r\n\t}\r\n\r\n\tswitch (unit) {\r\n\t\tcase \"day\":\r\n\t\t\tlet day: number = date.getUTCDate();\r\n\t\t\tdate.setUTCDate(day + count);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"second\":\r\n\t\t\tlet seconds: number = date.getUTCSeconds();\r\n\t\t\tdate.setUTCSeconds(seconds + count);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"millisecond\":\r\n\t\t\tlet milliseconds: number = date.getUTCMilliseconds();\r\n\t\t\tdate.setUTCMilliseconds(milliseconds + count);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"hour\":\r\n\t\t\tlet hours: number = date.getUTCHours();\r\n\t\t\tdate.setUTCHours(hours + count);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"minute\":\r\n\t\t\tlet minutes: number = date.getUTCMinutes();\r\n\t\t\tdate.setUTCMinutes(minutes + count);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"year\":\r\n\t\t\tlet year: number = date.getUTCFullYear();\r\n\t\t\tdate.setUTCFullYear(year + count);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"month\":\r\n\t\t\tlet month: number = date.getUTCMonth();\r\n\t\t\tdate.setUTCMonth(month + count);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"week\":\r\n\t\t\tlet wday: number = date.getUTCDate();\r\n\t\t\tdate.setUTCDate(wday + count * 7);\r\n\t\t\tbreak;\r\n\t}\r\n\tif (!utc && unit != \"millisecond\") {\r\n\t\tdate.setUTCMinutes(date.getUTCMinutes() + timeZoneOffset);\r\n\r\n\t\tif (unit == \"day\" || unit == \"week\" || unit == \"month\" || unit == \"year\") {\r\n\t\t\tlet newTimeZoneOffset = date.getTimezoneOffset();\r\n\t\t\tif (newTimeZoneOffset != timeZoneOffset) {\r\n\t\t\t\tlet diff = newTimeZoneOffset - timeZoneOffset;\r\n\r\n\t\t\t\tdate.setUTCMinutes(date.getUTCMinutes() + diff);\r\n\t\t\t\t// solves issues if newe time falls back to old time zone\r\n\t\t\t\tif (date.getTimezoneOffset() != newTimeZoneOffset) {\r\n\t\t\t\t\tdate.setUTCMinutes(date.getUTCMinutes() - diff);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn date;\r\n}\r\n\r\n/**\r\n * \"Rounds\" the date to specific time unit.\r\n *\r\n * @ignore Exclude from docs\r\n * @param date             Source date\r\n * @param unit             Time unit\r\n * @param count            Number of units to round to\r\n * @param firstDateOfWeek  First day of week\r\n * @param roundMinutes     Minutes to round to (some timezones use non-whole hour)\r\n * @param timezone         Use specific named timezone when rounding\r\n * @return New date\r\n */\r\nexport function round(date: Date, unit: TimeUnit, count: number, firstDateOfWeek?: number, utc?: boolean, firstDate?: Date, roundMinutes: number = 0, timezone?: string): Date {\r\n\r\n\tif (!$type.isNumber(count)) {\r\n\t\tcount = 1;\r\n\t}\r\n\r\n\tlet timeZoneOffset = 0;\r\n\r\n\tif (timezone && [\"day\", \"month\", \"week\", \"year\"].indexOf(unit) != -1) {\r\n\t\tdate = setTimezone(date, timezone);\r\n\t}\r\n\r\n\tif (!utc && unit != \"millisecond\") {\r\n\t\ttimeZoneOffset = date.getTimezoneOffset();\r\n\t\tdate.setUTCMinutes(date.getUTCMinutes() - timeZoneOffset);\r\n\t}\r\n\r\n\tswitch (unit) {\r\n\r\n\t\tcase \"day\":\r\n\t\t\tlet day = date.getUTCDate();\r\n\r\n\t\t\tif (count > 1) {\r\n\t\t\t\t//\tday = Math.floor(day / count) * count;\r\n\t\t\t\tif (firstDate) {\r\n\t\t\t\t\tfirstDate = round(firstDate, \"day\", 1);\r\n\r\n\t\t\t\t\tlet difference = date.getTime() - firstDate.getTime();\r\n\t\t\t\t\tlet unitCount = Math.floor(difference / getDuration(\"day\") / count);\r\n\t\t\t\t\tlet duration = getDuration(\"day\", unitCount * count);\r\n\t\t\t\t\tdate.setTime(firstDate.getTime() + duration - timeZoneOffset * getDuration(\"minute\"));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdate.setUTCDate(day);\r\n\t\t\t}\r\n\t\t\tdate.setUTCHours(0, 0, 0, 0);\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"second\":\r\n\t\t\tlet seconds = date.getUTCSeconds();\r\n\t\t\tif (count > 1) {\r\n\t\t\t\tseconds = Math.floor(seconds / count) * count;\r\n\t\t\t}\r\n\t\t\tdate.setUTCSeconds(seconds, 0);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"millisecond\":\r\n\t\t\tif (count == 1) {\r\n\t\t\t\treturn date; // much better for perf!\r\n\t\t\t}\r\n\r\n\t\t\tlet milliseconds = date.getUTCMilliseconds();\r\n\t\t\tmilliseconds = Math.floor(milliseconds / count) * count;\r\n\t\t\tdate.setUTCMilliseconds(milliseconds);\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"hour\":\r\n\r\n\t\t\tlet hours = date.getUTCHours();\r\n\t\t\tif (count > 1) {\r\n\t\t\t\thours = Math.floor(hours / count) * count;\r\n\t\t\t}\r\n\t\t\tdate.setUTCHours(hours, roundMinutes, 0, 0);\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"minute\":\r\n\r\n\t\t\tlet minutes = date.getUTCMinutes();\r\n\t\t\tmilliseconds = date.getUTCMilliseconds();\r\n\t\t\tif (count > 1) {\r\n\t\t\t\tminutes = Math.floor(minutes / count) * count;\r\n\t\t\t}\r\n\r\n\t\t\tdate.setUTCMinutes(minutes, 0, 0);\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"month\":\r\n\r\n\t\t\tlet month = date.getUTCMonth();\r\n\t\t\tif (count > 1) {\r\n\t\t\t\tmonth = Math.floor(month / count) * count;\r\n\t\t\t}\r\n\r\n\t\t\tdate.setUTCMonth(month, 1);\r\n\t\t\tdate.setUTCHours(0, roundMinutes, 0, 0);\r\n\r\n\t\t\tbreak;\r\n\r\n\t\tcase \"year\":\r\n\r\n\t\t\tlet year = date.getUTCFullYear();\r\n\t\t\tif (count > 1) {\r\n\t\t\t\tyear = Math.floor(year / count) * count;\r\n\t\t\t}\r\n\t\t\tdate.setUTCFullYear(year, 0, 1);\r\n\t\t\tdate.setUTCHours(0, roundMinutes, 0, 0);\r\n\r\n\t\t\t//let nonUTCDateY = new Date(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds(), date.getMilliseconds());\r\n\t\t\t//timeZoneOffset = nonUTCDateY.getTimezoneOffset();\r\n\r\n\t\t\tbreak;\r\n\r\n\r\n\t\tcase \"week\":\r\n\r\n\t\t\tlet wday = date.getUTCDate();\r\n\t\t\tlet weekDay = date.getUTCDay();\r\n\r\n\t\t\tif (!$type.isNumber(firstDateOfWeek)) {\r\n\t\t\t\tfirstDateOfWeek = 1;\r\n\t\t\t}\r\n\r\n\t\t\t// todo: rounding when count is not 1\r\n\t\t\tif (weekDay >= firstDateOfWeek) {\r\n\t\t\t\twday = wday - weekDay + firstDateOfWeek;\r\n\t\t\t} else {\r\n\t\t\t\twday = wday - (7 + weekDay) + firstDateOfWeek;\r\n\t\t\t}\r\n\r\n\t\t\tdate.setUTCDate(wday);\r\n\t\t\tdate.setUTCHours(0, roundMinutes, 0, 0);\r\n\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\tif (!utc && unit != \"millisecond\") {\r\n\t\tdate.setUTCMinutes(date.getUTCMinutes() + timeZoneOffset);\r\n\r\n\t\tif (unit == \"day\" || unit == \"week\" || unit == \"month\" || unit == \"year\") {\r\n\t\t\tlet newTimeZoneOffset = date.getTimezoneOffset();\r\n\t\t\tif (newTimeZoneOffset != timeZoneOffset) {\r\n\t\t\t\tlet diff = newTimeZoneOffset - timeZoneOffset;\r\n\r\n\t\t\t\tdate.setUTCMinutes(date.getUTCMinutes() + diff);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn date;\r\n}\r\n\r\n/**\r\n * Returns a new `Date` object which corresponds to the source date in a\r\n * specific timezone.\r\n *\r\n * @since 4.10.1\r\n * @param   date      Source date\r\n * @param   timezone  Timezone identifier\r\n * @return            Recalculated new Date\r\n */\r\nexport function setTimezone(date: Date, timezone: string): Date {\r\n\tconst d = new Date(date.toLocaleString(\"en-US\", { timeZone: timezone }));\r\n\treturn d;\r\n}\r\n\r\n/**\r\n * Returns minute fraction of the set timezone.\r\n *\r\n * @since 4.10.12\r\n * @param  timezone  Timezone identifier\r\n * @return           Minutes\r\n */\r\nexport function getTimezoneMinutes(timezone: string): number {\r\n\tlet d = new Date();\r\n\td.setHours(0, 0, 0, 0);\r\n\tlet d2 = setTimezone(d, timezone);\r\n\treturn d2.getMinutes();\r\n}","/**\r\n * Modal class is used to display information over chart area.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Popup, IPopupAdapters } from \"./Popup\";\r\nimport { Adapter } from \"../utils/Adapter\";\r\n\r\n/**\r\n * Represents a list of available adapters for Export.\r\n */\r\nexport interface IModalAdapters extends IPopupAdapters {}\r\n\r\n/**\r\n * Shows an HTML modal which covers window or a chart area.\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v4/concepts/popups-and-modals/} For examples and docs on Popups and Modals.\r\n */\r\nexport class Modal extends Popup {\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IModalAdapters;\r\n\r\n\t/**\r\n\t * Adapter.\r\n\t */\r\n\tpublic adapter: Adapter<Modal, IModalAdapters> = new Adapter<Modal, IModalAdapters>(this);\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"Modal\";\r\n\t\tthis.showCurtain = true;\r\n\t\tthis.draggable = false;\r\n\t}\r\n\r\n}\r\n","import { options } from \"../Options\";\n\n/**\n * Outputs string to console if `verbose` is `true`.\n */\nexport function log(...messages: Array<any>): void {\n\tif (options.verbose) {\n\t\tif (console) {\n\t\t\tconsole.log(...messages);\n\t\t}\n\t}\n}\n\n/**\n * Outputs a warning to the console.\n */\nexport function warn(...messages: Array<any>): void {\n\tif (!options.suppressWarnings) {\n\t\tif (console) {\n\t\t\tconsole.warn(...messages);\n\t\t}\n\t}\n}\n","/**\r\n * Number formatting-related functionality.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite } from \"../Sprite\";\r\nimport { Language } from \"../utils/Language\";\r\nimport { BaseObject } from \"../Base\";\r\nimport { ITextChunk, getTextFormatter } from \"../formatters/TextFormatter\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $strings from \"../utils/Strings\";\r\nimport * as $object from \"../utils/Object\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $math from \"../utils/Math\";\r\n\r\n/**\r\n * @ignore\r\n */\r\nexport interface INumberSuffix {\r\n\tnumber: number;\r\n\tsuffix: string;\r\n}\r\n\r\n/**\r\n * NumberFormatter class. Formats numbers according to specified formats.\r\n *\r\n * @todo Apply translations to suffixes/prefixes\r\n */\r\nexport class NumberFormatter extends BaseObject {\r\n\r\n\t/**\r\n\t * A base value for negative numbers. Will treat all numbers below this value\r\n\t * as negative numbers.\r\n\t */\r\n\tprotected _negativeBase: number = 0;\r\n\r\n\t/**\r\n\t * Holds number format.\r\n\t *\r\n\t * @default #,###.#####\r\n\t */\r\n\tprotected _numberFormat: string | Intl.NumberFormatOptions = \"#,###.#####\";\r\n\r\n\t/**\r\n\t * Locales to use when formatting using Intl.NumberFormatter\r\n\t */\r\n\tprotected _intlLocales: string;\r\n\r\n\t/**\r\n\t * Output format to produce. If the format calls for applying color to the\r\n\t * formatted value, this setting will determine what markup to use: SVG or\r\n\t * HTML.\r\n\t *\r\n\t * Available options: svg, html.\r\n\t *\r\n\t * @default \"svg\"\r\n\t */\r\n\tprotected _outputFormat: string = \"svg\";\r\n\r\n\t/**\r\n\t * Holds big number prefixes to apply to numbers if `a` modifier is used in\r\n\t * format.\r\n\t */\r\n\tprotected _bigNumberPrefixes: INumberSuffix[];\r\n\r\n\t/**\r\n\t * Holds small number prefixes to apply to numbers if `a` modifier is used in\r\n\t * format.\r\n\t */\r\n\tprotected _smallNumberPrefixes: INumberSuffix[];\r\n\r\n\t/**\r\n\t * Any number smaller than this will be considered \"small\" number, which will\r\n\t * trigger special formatting if \"a\" format modifier is used.\r\n\t */\r\n\tprotected _smallNumberThreshold: number = 1.00;\r\n\r\n\t/**\r\n\t * Holds prefixes to apply to data size numbers if `b` modifier is used in\r\n\t * format.\r\n\t */\r\n\tprotected _bytePrefixes: INumberSuffix[];\r\n\r\n\t/**\r\n\t * Holds reference to parent [[Sprite]] object.\r\n\t */\r\n\tpublic sprite: $type.Optional<Sprite>;\r\n\r\n\t/**\r\n\t * Holds reference to [[Language]] object.\r\n\t */\r\n\tprivate _language: $type.Optional<Language>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"NumberFormatter\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\tpublic dispose(): void {\r\n\t\tsuper.dispose();\r\n\r\n\t\tif (this.language) {\r\n\t\t\tthis.language.dispose();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A reference to [[Language]] instance.\r\n\t *\r\n\t * Formatter will use language to translate various items, like number\r\n\t * suffixes, etc.\r\n\t *\r\n\t * @param value  Language\r\n\t */\r\n\tpublic set language(value: Language) {\r\n\t\tthis._language = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Language\r\n\t */\r\n\tpublic get language(): Language {\r\n\t\tif (!this._language) {\r\n\t\t\tif (this.sprite) {\r\n\t\t\t\tthis._language = this.sprite.language;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._language = new Language;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._language;\r\n\t}\r\n\r\n\t/**\r\n\t * Formats the number according to specific format.\r\n\t *\r\n\t * @param value   Value to format\r\n\t * @param format  Format to apply\r\n\t * @return Formatted number\r\n\t */\r\n\tpublic format(value: number | string, format?: string | Intl.NumberFormatOptions, precision?: number): string {\r\n\r\n\t\t// no format passed in or \"Number\"\r\n\t\tif (typeof format === \"undefined\" || ($type.isString(format) && format.toLowerCase() === \"number\")) {\r\n\t\t\tformat = this._numberFormat;\r\n\t\t}\r\n\r\n\t\t// Init return value\r\n\t\tlet formatted;\r\n\r\n\t\t// Cast to number just in case\r\n\t\t// TODO: maybe use better casting\r\n\t\tlet source: number = Number(value);\r\n\r\n\t\t// Is it a built-in format or Intl.NumberFormatOptions\r\n\t\tif ($type.isObject(format)) {\r\n\t\t\ttry {\r\n\t\t\t\tif (this.intlLocales) {\r\n\t\t\t\t\treturn new Intl.NumberFormat(this.intlLocales, <Intl.NumberFormatOptions>format).format(source);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn new Intl.NumberFormat(undefined, <Intl.NumberFormatOptions>format).format(source);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\treturn \"Invalid\";\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\t// Clean format\r\n\t\t\tformat = $utils.cleanFormat(format);\r\n\r\n\t\t\t// Get format info (it will also deal with parser caching)\r\n\t\t\tlet info = this.parseFormat(format, this.language);\r\n\r\n\r\n\t\t\t// format and replace the number\r\n\t\t\tlet details;\r\n\t\t\tif (source > this._negativeBase) {\r\n\t\t\t\tdetails = info.positive;\r\n\t\t\t}\r\n\t\t\telse if (source < this._negativeBase) {\r\n\t\t\t\tdetails = info.negative;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdetails = info.zero;\r\n\t\t\t}\r\n\r\n\t\t\t// Adjust precision\r\n\t\t\tif ($type.hasValue(precision) && !details.mod) {\r\n\t\t\t\tdetails = $object.clone(details);\r\n\t\t\t\tdetails.decimals.active = source == 0 ? 0: precision;\r\n\t\t\t}\r\n\r\n\t\t\t// Format\r\n\t\t\tformatted = details.template.split($strings.PLACEHOLDER).join(this.applyFormat(source, details));\r\n\r\n\t\t}\r\n\r\n\t\treturn formatted;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses supplied format into structured object which can be used to format\r\n\t * the number.\r\n\t *\r\n\t * @param format Format string, i.e. \"#,###.00\"\r\n\t * @param language Language\r\n\t */\r\n\tprotected parseFormat(format: string, language: Language): any {\r\n\r\n\t\t// Check cache\r\n\t\tlet cached = this.getCache(format);\r\n\t\tif ($type.hasValue(cached)) {\r\n\t\t\treturn cached;\r\n\t\t}\r\n\r\n\t\t// init format parse info holder\r\n\t\tlet info: any = {\r\n\t\t\t\"positive\": {\r\n\t\t\t\t\"thousands\": {\r\n\t\t\t\t\t\"active\": -1,\r\n\t\t\t\t\t\"passive\": -1,\r\n\t\t\t\t\t\"interval\": -1,\r\n\t\t\t\t\t\"separator\": language.translateEmpty(\"_thousandSeparator\")\r\n\t\t\t\t},\r\n\t\t\t\t\"decimals\": {\r\n\t\t\t\t\t\"active\": -1,\r\n\t\t\t\t\t\"passive\": -1,\r\n\t\t\t\t\t\"separator\": language.translateEmpty(\"_decimalSeparator\")\r\n\t\t\t\t},\r\n\t\t\t\t\"template\": \"\",\r\n\t\t\t\t\"source\": \"\",\r\n\t\t\t\t\"parsed\": false\r\n\t\t\t},\r\n\t\t\t\"negative\": {\r\n\t\t\t\t\"thousands\": {\r\n\t\t\t\t\t\"active\": -1,\r\n\t\t\t\t\t\"passive\": -1,\r\n\t\t\t\t\t\"interval\": -1,\r\n\t\t\t\t\t\"separator\": language.translateEmpty(\"_thousandSeparator\")\r\n\t\t\t\t},\r\n\t\t\t\t\"decimals\": {\r\n\t\t\t\t\t\"active\": -1,\r\n\t\t\t\t\t\"passive\": -1,\r\n\t\t\t\t\t\"separator\": language.translateEmpty(\"_decimalSeparator\")\r\n\t\t\t\t},\r\n\t\t\t\t\"template\": \"\",\r\n\t\t\t\t\"source\": \"\",\r\n\t\t\t\t\"parsed\": false\r\n\t\t\t},\r\n\t\t\t\"zero\": {\r\n\t\t\t\t\"thousands\": {\r\n\t\t\t\t\t\"active\": -1,\r\n\t\t\t\t\t\"passive\": -1,\r\n\t\t\t\t\t\"interval\": -1,\r\n\t\t\t\t\t\"separator\": language.translateEmpty(\"_thousandSeparator\")\r\n\t\t\t\t},\r\n\t\t\t\t\"decimals\": {\r\n\t\t\t\t\t\"active\": -1,\r\n\t\t\t\t\t\"passive\": -1,\r\n\t\t\t\t\t\"separator\": language.translateEmpty(\"_decimalSeparator\")\r\n\t\t\t\t},\r\n\t\t\t\t\"template\": \"\",\r\n\t\t\t\t\"source\": \"\",\r\n\t\t\t\t\"parsed\": false\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Escape double vertical bars (that mean display one vertical bar)\r\n\t\tformat = format.replace(\"||\", $strings.PLACEHOLDER2);\r\n\r\n\t\t// Split it up and deal with different formats\r\n\t\tlet parts = format.split(\"|\");\r\n\t\tinfo.positive.source = parts[0];\r\n\r\n\t\tif (typeof parts[2] === \"undefined\") {\r\n\t\t\tinfo.zero = info.positive;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinfo.zero.source = parts[2];\r\n\t\t}\r\n\r\n\t\tif (typeof parts[1] === \"undefined\") {\r\n\t\t\tinfo.negative = info.positive;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinfo.negative.source = parts[1];\r\n\t\t}\r\n\r\n\t\t// Parse each\r\n\t\t$object.each(info, (part, item) => {\r\n\t\t\t// Already parsed\r\n\t\t\tif (item.parsed) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Check cached\r\n\t\t\tif (typeof this.getCache(item.source) !== \"undefined\") {\r\n\t\t\t\tinfo[part] = this.getCache(item.source);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Begin parsing\r\n\t\t\tlet partFormat: string = item.source;\r\n\r\n\t\t\t// Just \"Number\"?\r\n\t\t\tif (partFormat.toLowerCase() === \"number\") {\r\n\t\t\t\tpartFormat = $type.isString(this._numberFormat) ? this._numberFormat : \"#,###.#####\";\r\n\t\t\t}\r\n\r\n\t\t\t// Let TextFormatter split into chunks\r\n\t\t\tlet chunks: ITextChunk[] = getTextFormatter().chunk(partFormat, true);\r\n\t\t\tfor (let i: number = 0; i < chunks.length; i++) {\r\n\t\t\t\tlet chunk: ITextChunk = chunks[i];\r\n\r\n\t\t\t\t// replace back double vertical bar\r\n\t\t\t\tchunk.text = chunk.text.replace($strings.PLACEHOLDER2, \"|\");\r\n\r\n\t\t\t\tif (chunk.type === \"value\") {\r\n\t\t\t\t\t// Parse format\r\n\r\n\t\t\t\t\t// Look for codes\r\n\t\t\t\t\tlet matches: string[] | null = chunk.text.match(/[#0.,]+[ ]?[abesABES%!]?[abesABES‰!]?/);\r\n\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\tif (matches === null || matches[0] === \"\") {\r\n\t\t\t\t\t\t\t// no codes here - assume string\r\n\t\t\t\t\t\t\t// nothing to do here\r\n\t\t\t\t\t\t\titem.template += chunk.text;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\r\n\t\t\t\t\t\t\t// look for the format modifiers at the end\r\n\t\t\t\t\t\t\tlet mods: string[] | null = matches[0].match(/[abesABES%‰!]{2}|[abesABES%‰]{1}$/);\r\n\r\n\t\t\t\t\t\t\tif (mods) {\r\n\t\t\t\t\t\t\t\titem.mod = mods[0].toLowerCase();\r\n\t\t\t\t\t\t\t\titem.modSpacing = matches[0].match(/[ ]{1}[abesABES%‰!]{1}$/) ? true : false;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// break the format up\r\n\t\t\t\t\t\t\tlet a = matches[0].split(\".\");\r\n\r\n\t\t\t\t\t\t\t// Deal with thousands\r\n\t\t\t\t\t\t\tif (a[0] === \"\") {\r\n\t\t\t\t\t\t\t\t// No directives for thousands\r\n\t\t\t\t\t\t\t\t// Leave default settings (no formatting)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t// Counts\r\n\t\t\t\t\t\t\t\titem.thousands.active = (a[0].match(/0/g) || []).length;\r\n\t\t\t\t\t\t\t\titem.thousands.passive = (a[0].match(/\\#/g) || []).length + item.thousands.active;\r\n\r\n\t\t\t\t\t\t\t\t// Separator interval\r\n\t\t\t\t\t\t\t\tlet b = a[0].split(\",\");\r\n\t\t\t\t\t\t\t\tif (b.length === 1) {\r\n\t\t\t\t\t\t\t\t\t// No thousands separators\r\n\t\t\t\t\t\t\t\t\t// Do nothing\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t// Use length fo the last chunk as thousands length\r\n\t\t\t\t\t\t\t\t\titem.thousands.interval = $type.getValue(b.pop()).length;\r\n\r\n\t\t\t\t\t\t\t\t\tif (item.thousands.interval === 0) {\r\n\t\t\t\t\t\t\t\t\t\titem.thousands.interval = -1;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Deal with decimals\r\n\t\t\t\t\t\t\tif (typeof (a[1]) === \"undefined\") {\r\n\t\t\t\t\t\t\t\t// No directives for decimals\r\n\t\t\t\t\t\t\t\t// Leave at defaults (no formatting)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t// Counts\r\n\t\t\t\t\t\t\t\titem.decimals.active = (a[1].match(/0/g) || []).length;\r\n\t\t\t\t\t\t\t\titem.decimals.passive = (a[1].match(/\\#/g) || []).length + item.decimals.active;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Add special code to template\r\n\t\t\t\t\t\t\titem.template += chunk.text.split(matches[0]).join($strings.PLACEHOLDER);\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Quoted string - take it as it is\r\n\t\t\t\t\titem.template += chunk.text;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Apply style formatting\r\n\t\t\t//item.template = getTextFormatter().format(item.template, this.outputFormat);\r\n\r\n\t\t\t// Save cache\r\n\t\t\tthis.setCache(item.source, item);\r\n\r\n\t\t\t// Mark this as parsed\r\n\t\t\titem.parsed = true;\r\n\r\n\t\t});\r\n\r\n\t\t// Save cache (the whole thing)\r\n\t\tthis.setCache(format, info);\r\n\r\n\t\treturn info;\r\n\t}\r\n\r\n\t/**\r\n\t * Applies parsed format to a numeric value.\r\n\t *\r\n\t * @param value    Value\r\n\t * @param details  Parsed format as returned by parseFormat()\r\n\t * @return Formatted number\r\n\t */\r\n\tprotected applyFormat(value: number, details: any): string {\r\n\r\n\t\t// Use absolute values\r\n\t\tlet negative: boolean = value < 0;\r\n\t\tvalue = Math.abs(value);\r\n\r\n\t\t// Recalculate according to modifier\r\n\t\tlet prefix: string = \"\", suffix: string = \"\";\r\n\t\tlet mods: string[] = details.mod ? details.mod.split(\"\") : [];\r\n\t\tif (mods.indexOf(\"b\") !== -1) {\r\n\t\t\tlet a = this.applyPrefix(value, this.bytePrefixes, mods.indexOf(\"!\") !== -1);\r\n\t\t\tvalue = a[0];\r\n\t\t\tprefix = a[1];\r\n\t\t\tsuffix = a[2];\r\n\t\t\tif (details.modSpacing) {\r\n\t\t\t\tsuffix = \" \" + suffix;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (mods.indexOf(\"a\") !== -1) {\r\n\t\t\tlet a = this.applyPrefix(value, value < this.smallNumberThreshold ? this.smallNumberPrefixes : this.bigNumberPrefixes, mods.indexOf(\"!\") !== -1);\r\n\t\t\tvalue = a[0];\r\n\t\t\tprefix = a[1];\r\n\t\t\tsuffix = a[2];\r\n\t\t\tif (details.modSpacing) {\r\n\t\t\t\tsuffix = \" \" + suffix;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (mods.indexOf(\"%\") !== -1) {\r\n\t\t\tlet ol = $math.min(value.toString().length + 2, 21);\r\n\t\t\tvalue *= 100;\r\n\t\t\tvalue = parseFloat(value.toPrecision(ol));\r\n\t\t\tsuffix = \"%\";\r\n\t\t}\r\n\t\telse if (mods.indexOf(\"‰\") !== -1) {\r\n\t\t\tlet ol = $math.min(value.toString().length + 3, 21);\r\n\t\t\tvalue *= 1000;\r\n\t\t\tvalue = parseFloat(value.toPrecision(ol));\r\n\t\t\tsuffix = \"‰\";\r\n\t\t}\r\n\r\n\t\t// Round to passive\r\n\t\tif (mods.indexOf(\"e\") !== -1) {\r\n\t\t\t// convert the value to exponential\r\n\t\t\tlet exp: string[];\r\n\t\t\tif (details.decimals.passive >= 0) {\r\n\t\t\t\texp = value.toExponential(details.decimals.passive).split(\"e\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\texp = value.toExponential().split(\"e\");\r\n\t\t\t}\r\n\t\t\tvalue = Number(exp[0]);\r\n\t\t\tsuffix = \"e\" + exp[1];\r\n\t\t\tif (details.modSpacing) {\r\n\t\t\t\tsuffix = \" \" + suffix;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (details.decimals.passive === 0) {\r\n\t\t\tvalue = Math.round(value);\r\n\t\t}\r\n\t\telse if (details.decimals.passive > 0) {\r\n\t\t\tlet d: number = Math.pow(10, details.decimals.passive);\r\n\t\t\tvalue = Math.round(value * d) / d;\r\n\t\t}\r\n\r\n\t\t// Init return value\r\n\t\tlet res: string = \"\";\r\n\r\n\t\t// Calc integer and decimal parts\r\n\t\tlet a = $utils.numberToString(value).split(\".\");\r\n\r\n\t\t// Format integers\r\n\t\tlet ints = a[0];\r\n\r\n\t\t// Pad integers to active length\r\n\t\tif (ints.length < details.thousands.active) {\r\n\t\t\tints = Array(details.thousands.active - ints.length + 1).join(\"0\") + ints;\r\n\t\t}\r\n\r\n\t\t// Insert thousands separators\r\n\t\tif (details.thousands.interval > 0) {\r\n\t\t\tlet ip: string[] = [];\r\n\t\t\tlet intsr: string = ints.split(\"\").reverse().join(\"\");\r\n\t\t\tfor (let i = 0, len = ints.length; i <= len; i += details.thousands.interval) {\r\n\t\t\t\tlet c: string = intsr.substr(i, details.thousands.interval).split(\"\").reverse().join(\"\");\r\n\t\t\t\tif (c !== \"\") {\r\n\t\t\t\t\tip.unshift(c);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tints = ip.join(details.thousands.separator);\r\n\t\t}\r\n\r\n\t\t// Add integers\r\n\t\tres += ints;\r\n\r\n\t\t// Add decimals\r\n\t\tif (a.length === 1) {\r\n\t\t\ta.push(\"\");\r\n\t\t}\r\n\t\tlet decs: string = a[1];\r\n\r\n\t\t// Fill zeros?\r\n\t\tif (decs.length < details.decimals.active) {\r\n\t\t\tdecs += Array(details.decimals.active - decs.length + 1).join(\"0\");\r\n\t\t}\r\n\r\n\t\tif (decs !== \"\") {\r\n\t\t\tres += details.decimals.separator + decs;\r\n\t\t}\r\n\r\n\t\t// Can't have empty return value\r\n\t\tif (res === \"\") {\r\n\t\t\tres = \"0\";\r\n\t\t}\r\n\r\n\t\t// Add minus sign back\r\n\t\tif (value !== 0 && negative && (mods.indexOf(\"s\") === -1)) {\r\n\t\t\tres = \"-\" + res;\r\n\t\t}\r\n\r\n\t\t// Add suffixes/prefixes\r\n\t\tif (prefix) {\r\n\t\t\tres = prefix + res;\r\n\t\t}\r\n\t\tif (suffix) {\r\n\t\t\tres += suffix;\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Chooses appropriate prefix and suffix based on the passed in rules.\r\n\t *\r\n\t * @param  value     Value\r\n\t * @param  prefixes  Prefix array\r\n\t * @param  force     Force application of a first prefix (@sice 4.5.4)\r\n\t * @return Result\r\n\t */\r\n\tprotected applyPrefix(value: number, prefixes: any[], force: boolean = false): any[] {\r\n\t\tlet newvalue = value;\r\n\t\tlet prefix = \"\";\r\n\t\tlet suffix = \"\";\r\n\t\tlet applied = false;\r\n\t\tlet k = 1;\r\n\r\n\t\tfor (let i = 0, len = prefixes.length; i < len; i++) {\r\n\t\t\tif (prefixes[i].number <= value) {\r\n\t\t\t\tif (prefixes[i].number === 0) {\r\n\t\t\t\t\tnewvalue = 0;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tnewvalue = value / prefixes[i].number;\r\n\t\t\t\t\tk = prefixes[i].number;\r\n\t\t\t\t}\r\n\t\t\t\tprefix = prefixes[i].prefix;\r\n\t\t\t\tsuffix = prefixes[i].suffix;\r\n\t\t\t\tapplied = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (!applied && force && prefixes.length && value != 0) {\r\n\t\t\t// Prefix was not applied. Use the first prefix.\r\n\t\t\tnewvalue = value / prefixes[0].number;\r\n\t\t\tprefix = prefixes[0].prefix;\r\n\t\t\tsuffix = prefixes[0].suffix;\r\n\t\t\tapplied = true;\r\n\t\t}\r\n\r\n\t\tif (applied) {\r\n\t\t\tnewvalue = parseFloat(\r\n\t\t\t\tnewvalue.toPrecision(\r\n\t\t\t\t\t$math.min(k.toString().length + Math.floor(newvalue).toString().replace(/[^0-9]*/g, \"\").length, 21)\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn [newvalue, prefix, suffix];\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates the parent [[Sprite]] object.\r\n\t */\r\n\tprotected invalidateSprite(): void {\r\n\t\tif (this.sprite) {\r\n\t\t\tthis.sprite.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Number format.\r\n\t *\r\n\t * @default \"#,###.#####\"\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-numbers/} Tutorial on number formatting\r\n\t * @param format  A format to use for number formatting\r\n\t */\r\n\tpublic set numberFormat(format: string | Intl.NumberFormatOptions) {\r\n\t\tthis._numberFormat = format;\r\n\t}\r\n\r\n\t/**\r\n\t * @return A format to use for number formatting\r\n\t */\r\n\tpublic get numberFormat(): string | Intl.NumberFormatOptions {\r\n\t\treturn this._numberFormat;\r\n\t}\r\n\r\n\t/**\r\n\t * Locales if you are using date formats in `Intl.NumberFormatOptions` syntax.\r\n\t * \r\n\t * @see (@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/NumberFormat) about using Intl for number formatting\r\n\t * @param value Locales\r\n\t */\r\n\tpublic set intlLocales(value: string) {\r\n\t\tthis._intlLocales = value;\r\n\t\tthis.invalidateSprite();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Date format\r\n\t */\r\n\tpublic get intlLocales(): string {\r\n\t\treturn this._intlLocales;\r\n\t}\r\n\r\n\t/**\r\n\t * Negative base for negative numbers.\r\n\t *\r\n\t * @default 0\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-numbers/} Tutorial on number formatting\r\n\t * @param format  A format to use for number formatting\r\n\t */\r\n\tpublic set negativeBase(value: number) {\r\n\t\tthis._negativeBase = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return A format to use for number formatting\r\n\t */\r\n\tpublic get negativeBase(): number {\r\n\t\treturn this._negativeBase;\r\n\t}\r\n\r\n\t/**\r\n\t * Prefixes for big numbers.\r\n\t *\r\n\t * It's an array of objects of number/prefix pairs.\r\n\t *\r\n\t * ```JSON\r\n\t * [\r\n\t *   { \"number\": 1e+3, \"suffix\": \"K\" },\r\n\t *   { \"number\": 1e+6, \"suffix\": \"M\" },\r\n\t *   { \"number\": 1e+9, \"suffix\": \"G\" },\r\n\t *   { \"number\": 1e+12, \"suffix\": \"T\" },\r\n\t *   { \"number\": 1e+15, \"suffix\": \"P\" },\r\n\t *   { \"number\": 1e+18, \"suffix\": \"E\" },\r\n\t *   { \"number\": 1e+21, \"suffix\": \"Z\" },\r\n\t *   { \"number\": 1e+24, \"suffix\": \"Y\" }\r\n\t * ]\r\n\t * ```\r\n\t *\r\n\t * If the number is bigger than the `number` ir will be converted to the\r\n\t * appropriate bigger number with prefix.\r\n\t *\r\n\t * E.g. as per above `1500` will be converted to `1.5K`.\r\n\t *\r\n\t * Please note that for this transformation to be enabled, you need to\r\n\t * enable it specific modifier in your format setting.\r\n\t *\r\n\t * The modifier for big/small number modification is \"a\":\r\n\t *\r\n\t * ```Text\r\n\t * {myfield.formatNumber(\"#,###.00a\")}\r\n\t * ```\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-numbers/} Tutorial on number formatting\r\n\t * @param prefixes  Prefixes for big numbers\r\n\t */\r\n\tpublic set bigNumberPrefixes(prefixes: INumberSuffix[]) {\r\n\t\tthis._bigNumberPrefixes = prefixes;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Prefixes for big numbers\r\n\t */\r\n\tpublic get bigNumberPrefixes(): INumberSuffix[] {\r\n\t\tif (!$type.hasValue(this._bigNumberPrefixes)) {\r\n\t\t\tthis._bigNumberPrefixes = [\r\n\t\t\t\t{ \"number\": 1e+3, \"suffix\": this.language.translate(\"_big_number_suffix_3\") },\r\n\t\t\t\t{ \"number\": 1e+6, \"suffix\": this.language.translate(\"_big_number_suffix_6\") },\r\n\t\t\t\t{ \"number\": 1e+9, \"suffix\": this.language.translate(\"_big_number_suffix_9\") },\r\n\t\t\t\t{ \"number\": 1e+12, \"suffix\": this.language.translate(\"_big_number_suffix_12\") },\r\n\t\t\t\t{ \"number\": 1e+15, \"suffix\": this.language.translate(\"_big_number_suffix_15\") },\r\n\t\t\t\t{ \"number\": 1e+18, \"suffix\": this.language.translate(\"_big_number_suffix_18\") },\r\n\t\t\t\t{ \"number\": 1e+21, \"suffix\": this.language.translate(\"_big_number_suffix_21\") },\r\n\t\t\t\t{ \"number\": 1e+24, \"suffix\": this.language.translate(\"_big_number_suffix_24\") }\r\n\t\t\t]\r\n\t\t}\r\n\t\treturn this._bigNumberPrefixes;\r\n\t}\r\n\r\n\t/**\r\n\t * Prefixes for big numbers.\r\n\t *\r\n\t * It's an array of objects of number/prefix pairs.\r\n\t *\r\n\t * ```JSON\r\n\t * [\r\n\t *   { \"number\": 1e-24, \"suffix\": \"y\" },\r\n\t *   { \"number\": 1e-21, \"suffix\": \"z\" },\r\n\t *   { \"number\": 1e-18, \"suffix\": \"a\" },\r\n\t *   { \"number\": 1e-15, \"suffix\": \"f\" },\r\n\t *   { \"number\": 1e-12, \"suffix\": \"p\" },\r\n\t *   { \"number\": 1e-9, \"suffix\": \"n\" },\r\n\t *   { \"number\": 1e-6, \"suffix\": \"μ\" },\r\n\t *   { \"number\": 1e-3, \"suffix\": \"m\" }\r\n\t * ]\r\n\t * ```\r\n\t *\r\n\t * If the number is smaller than the `number` ir will be converted to the\r\n\t * appropriate smaller number with prefix.\r\n\t *\r\n\t * E.g. as per above `0.0015` will be converted to `1.5m`.\r\n\t *\r\n\t * Please note that for this transformation to be enabled, you need to\r\n\t * enable it specific modifier in your format setting.\r\n\t *\r\n\t * The modifier for big/small number modification is \"a\":\r\n\t *\r\n\t * ```Text\r\n\t * {myfield.formatNumber(\"#,###.00a\")}\r\n\t * ```\r\n\t *\r\n\t * IMPORTANT: The order of the suffixes is important. The list must start\r\n\t * from the smallest number and work towards bigger ones.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-numbers/} Tutorial on number formatting\r\n\t * @param prefixes  Prefixes for small numbers\r\n\t */\r\n\tpublic set smallNumberPrefixes(prefixes: INumberSuffix[]) {\r\n\t\tthis._smallNumberPrefixes = prefixes;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Prefixes for small numbers\r\n\t */\r\n\tpublic get smallNumberPrefixes(): INumberSuffix[] {\r\n\t\tif (!$type.hasValue(this._smallNumberPrefixes)) {\r\n\t\t\tthis._smallNumberPrefixes = [\r\n\t\t\t\t{ \"number\": 1e-24, \"suffix\": this.language.translate(\"_small_number_suffix_24\") },\r\n\t\t\t\t{ \"number\": 1e-21, \"suffix\": this.language.translate(\"_small_number_suffix_21\") },\r\n\t\t\t\t{ \"number\": 1e-18, \"suffix\": this.language.translate(\"_small_number_suffix_18\") },\r\n\t\t\t\t{ \"number\": 1e-15, \"suffix\": this.language.translate(\"_small_number_suffix_15\") },\r\n\t\t\t\t{ \"number\": 1e-12, \"suffix\": this.language.translate(\"_small_number_suffix_12\") },\r\n\t\t\t\t{ \"number\": 1e-9, \"suffix\": this.language.translate(\"_small_number_suffix_9\") },\r\n\t\t\t\t{ \"number\": 1e-6, \"suffix\": this.language.translate(\"_small_number_suffix_6\") },\r\n\t\t\t\t{ \"number\": 1e-3, \"suffix\": this.language.translate(\"_small_number_suffix_3\") }\r\n\t\t\t]\r\n\t\t}\r\n\t\treturn this._smallNumberPrefixes;\r\n\t}\r\n\r\n\t/**\r\n\t * Any number smaller than this will be considered \"small\" number, which will\r\n\t * trigger special formatting if \"a\" format modifier is used.\r\n\t *\r\n\t * @since 4.6.8\r\n\t * @param  value  Small number threshold\r\n\t */\r\n\tpublic set smallNumberThreshold(value: number) {\r\n\t\tthis._smallNumberThreshold = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Small number threshold\r\n\t */\r\n\tpublic get smallNumberThreshold(): number {\r\n\t\treturn this._smallNumberThreshold;\r\n\t}\r\n\r\n\t/**\r\n\t * Basically the same as `bigNumberPrefixes`, except base for calculation\r\n\t * is not thousand but byte (1024).\r\n\t *\r\n\t * The modifier is \"b\".\r\n\t *\r\n\t *  ```Text\r\n\t * {myfield.formatNumber(\"#,###.00b\")}\r\n\t * ```\r\n\t *\r\n\t * The above `2048` will change to `2K`.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-numbers/} Tutorial on number formatting\r\n\t * @param prefixes  Prefixes for byte-size formatting\r\n\t */\r\n\tpublic set bytePrefixes(prefixes: INumberSuffix[]) {\r\n\t\tthis._bytePrefixes = prefixes;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Prefixes for byte-size formatting\r\n\t */\r\n\tpublic get bytePrefixes(): INumberSuffix[] {\r\n\t\tif (!$type.hasValue(this._bytePrefixes)) {\r\n\t\t\tthis._bytePrefixes = [\r\n\t\t\t\t{ \"number\": 1, suffix: this.language.translate(\"_byte_suffix_B\") },\r\n\t\t\t\t{ \"number\": 1024, suffix: this.language.translate(\"_byte_suffix_KB\") },\r\n\t\t\t\t{ \"number\": 1048576, suffix: this.language.translate(\"_byte_suffix_MB\") },\r\n\t\t\t\t{ \"number\": 1073741824, suffix: this.language.translate(\"_byte_suffix_GB\") },\r\n\t\t\t\t{ \"number\": 1099511627776, suffix: this.language.translate(\"_byte_suffix_TB\") },\r\n\t\t\t\t{ \"number\": 1125899906842624, suffix: this.language.translate(\"_byte_suffix_PB\") }\r\n\t\t\t]\r\n\t\t}\r\n\t\treturn this._bytePrefixes;\r\n\t}\r\n\r\n\t/**\r\n\t * Ooutput format: \"svg\" or \"html\".\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value  Output format\r\n\t */\r\n\tpublic set outputFormat(outputFormat: string) {\r\n\t\tthis._outputFormat = outputFormat.toLowerCase();\r\n\t\tthis.invalidateSprite();\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Output format\r\n\t */\r\n\tpublic get outputFormat(): string {\r\n\t\treturn this._outputFormat;\r\n\t}\r\n\r\n\t/**\r\n\t * Replaces brackets with temporary placeholders.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text  Input text\r\n\t * @return Escaped text\r\n\t */\r\n\tpublic escape(text: string): string {\r\n\t\treturn text.replace(\"||\", $strings.PLACEHOLDER2);\r\n\t}\r\n\r\n\t/**\r\n\t * Replaces placeholders back to brackets.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text  Escaped text\r\n\t * @return Unescaped text\r\n\t */\r\n\tpublic unescape(text: string): string {\r\n\t\treturn text.replace($strings.PLACEHOLDER2, \"|\");\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"NumberFormatter\"] = NumberFormatter;\r\n","/**\r\n * Duration formatting functionality.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite } from \"../Sprite\";\r\nimport { Language } from \"../utils/Language\";\r\nimport { BaseObject } from \"../Base\";\r\nimport { ITextChunk, getTextFormatter } from \"../formatters/TextFormatter\";\r\nimport { registry } from \"../Registry\";\r\nimport { TimeUnit } from \"../defs/TimeUnit\";\r\nimport { Optional } from \"../utils/Type\";\r\nimport * as $strings from \"../utils/Strings\";\r\nimport * as $object from \"../utils/Object\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $math from \"../utils/Math\";\r\n\r\n/**\r\n * DurationFormatter class. Formats numbers as durations.\r\n *\r\n * `1000` as `16:40`\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-duration/} Tutorial on duration formatting\r\n */\r\nexport class DurationFormatter extends BaseObject {\r\n\r\n\t/**\r\n\t * If set will force this format to be used, regardless of the scale.\r\n\t */\r\n\tprotected _durationFormat: string;\r\n\r\n\t/**\r\n\t * Holds duration formats for various possible scenarios.\r\n\t */\r\n\tprotected _durationFormats: Partial<Record<TimeUnit, Partial<Record<TimeUnit, string>>>>;\r\n\r\n\t/**\r\n\t * A base value for negative numbers. Will treat all numbers below this value\r\n\t * as negative numbers.\r\n\t */\r\n\tprotected _negativeBase: number = 0;\r\n\r\n\t/**\r\n\t * A base unit to consider values are in.\r\n\t *\r\n\t * @default \"s\"\r\n\t */\r\n\tprotected _baseUnit: TimeUnit = \"second\";\r\n\r\n\t/**\r\n\t * Output format to produce. If the format calls for applying color to the\r\n\t * formatted value, this setting will determine what markup to use: SVG or\r\n\t * HTML.\r\n\t *\r\n\t * Available options: svg, html.\r\n\t *\r\n\t * @default \"svg\"\r\n\t */\r\n\tprotected _outputFormat: string = \"svg\";\r\n\r\n\r\n\t/**\r\n\t * How many milliseconds each unit represents.\r\n\t */\r\n\tprotected _unitValues: Record<TimeUnit, number> = {\r\n\t\t\"millisecond\": 1,\r\n\t\t\"second\": 1000,\r\n\t\t\"minute\": 60000,\r\n\t\t\"hour\": 3600000,\r\n\t\t\"day\": 86400000,\r\n\t\t\"week\": 604800000,\r\n\t\t\"month\": 2592000000,\r\n\t\t\"year\": 31536000000,\r\n\t};\r\n\r\n\t/**\r\n\t * Collection of aliases for units.\r\n\t */\r\n\tprotected _unitAliases: { [index: string]: string } = {\r\n\t\t\"Y\": \"y\",\r\n\t\t\"D\": \"d\",\r\n\t\t\"H\": \"h\",\r\n\t\t\"K\": \"h\",\r\n\t\t\"k\": \"h\",\r\n\t\t\"n\": \"S\"\r\n\t};\r\n\r\n\t/**\r\n\t * Holds reference to parent [[Sprite]] object.\r\n\t */\r\n\tpublic sprite: $type.Optional<Sprite>;\r\n\r\n\t/**\r\n\t * Holds reference to [[Language]] object.\r\n\t */\r\n\tpublic language: $type.Optional<Language>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"DurationFormatter\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Formats the number according as duration.\r\n\t *\r\n\t * For example `1000` (base unit seconds) would be converted to `16:40` as in\r\n\t * 16 minutes and 40 seconds.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-duration/} Tutorial on duration formatting\r\n\t * @param value   Value to format\r\n\t * @param format  Format to apply\r\n\t * @param base    Override base unit\r\n\t * @return Formatted number\r\n\t */\r\n\tpublic format(value: number | string, format?: string, base?: TimeUnit): string {\r\n\r\n\t\t// no language?\r\n\t\tif (!this.language) {\r\n\t\t\tif (this.sprite) {\r\n\t\t\t\tthis.language = this.sprite.language;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.language = new Language;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// no base unit?\r\n\t\tlet baseUnit = base || this._baseUnit;\r\n\r\n\t\t// no format passed in or empty\r\n\t\tif (typeof format === \"undefined\" || format === \"\") {\r\n\t\t\tif ($type.hasValue(this.durationFormat)) {\r\n\t\t\t\tformat = this.durationFormat;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tformat = this.getFormat($type.toNumber(value), null, baseUnit);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Clean format\r\n\t\tformat = $utils.cleanFormat(format);\r\n\r\n\t\t// get format info (it will also deal with parser caching)\r\n\t\tlet info = this.parseFormat(format, baseUnit);\r\n\r\n\t\t// cast to number just in case\r\n\t\t// TODO: maybe use better casting\r\n\t\tlet source: number = Number(value);\r\n\r\n\t\t// format and replace the number\r\n\t\tlet details;\r\n\t\tif (source > this._negativeBase) {\r\n\t\t\tdetails = info.positive;\r\n\t\t}\r\n\t\telse if (source < this._negativeBase) {\r\n\t\t\tdetails = info.negative;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdetails = info.zero;\r\n\t\t}\r\n\r\n\r\n\t\t// Format\r\n\t\tlet formatted = this.applyFormat(source, details);\r\n\r\n\t\t// Apply color?\r\n\t\tif (details.color !== \"\") {\r\n\t\t\tif (this._outputFormat === \"svg\") {\r\n\t\t\t\tformatted = \"<tspan fill='\" + details.color + \"'>\" + formatted + \"</tspan>\";\r\n\t\t\t}\r\n\t\t\telse if (this._outputFormat === \"html\") {\r\n\t\t\t\tformatted = \"<span style='color: \" + details.color + \";'>\" + formatted + \"</span>\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn formatted;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses supplied format into structured object which can be used to format\r\n\t * the number.\r\n\t *\r\n\t * @param format  Format string, i.e. \"#,###.00\"\r\n\t * @param base    Override base unit\r\n\t * @return Parsed information\r\n\t */\r\n\tprotected parseFormat(format: string, base?: TimeUnit): any {\r\n\r\n\t\t// Check cache\r\n\t\tlet cached = this.getCache(format);\r\n\t\tif ($type.hasValue(cached)) {\r\n\t\t\treturn cached;\r\n\t\t}\r\n\r\n\t\t// no base unit?\r\n\t\tlet baseUnit = base || this._baseUnit;\r\n\r\n\t\t// Initialize duration parsing info\r\n\t\tlet info = {\r\n\t\t\t\"positive\": {\r\n\t\t\t\t\"color\": \"\",\r\n\t\t\t\t\"template\": \"\",\r\n\t\t\t\t\"parts\": <any>[],\r\n\t\t\t\t\"source\": \"\",\r\n\t\t\t\t\"baseUnit\": baseUnit,\r\n\t\t\t\t\"parsed\": false,\r\n\t\t\t\t\"absolute\": false\r\n\t\t\t},\r\n\t\t\t\"negative\": {\r\n\t\t\t\t\"color\": \"\",\r\n\t\t\t\t\"template\": \"\",\r\n\t\t\t\t\"parts\": <any>[],\r\n\t\t\t\t\"source\": \"\",\r\n\t\t\t\t\"baseUnit\": baseUnit,\r\n\t\t\t\t\"parsed\": false,\r\n\t\t\t\t\"absolute\": false\r\n\t\t\t},\r\n\t\t\t\"zero\": {\r\n\t\t\t\t\"color\": \"\",\r\n\t\t\t\t\"template\": \"\",\r\n\t\t\t\t\"parts\": <any>[],\r\n\t\t\t\t\"source\": \"\",\r\n\t\t\t\t\"baseUnit\": baseUnit,\r\n\t\t\t\t\"parsed\": false,\r\n\t\t\t\t\"absolute\": false\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Escape double vertical bars (that mean display one vertical bar)\r\n\t\tformat = format.replace(\"||\", $strings.PLACEHOLDER2);\r\n\r\n\t\t// Split it up and deal with different formats\r\n\t\tlet parts = format.split(\"|\");\r\n\t\tinfo.positive.source = parts[0];\r\n\r\n\t\tif (typeof parts[2] === \"undefined\") {\r\n\t\t\tinfo.zero = info.positive;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinfo.zero.source = parts[2];\r\n\t\t}\r\n\r\n\t\tif (typeof parts[1] === \"undefined\") {\r\n\t\t\tinfo.negative = info.positive;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinfo.negative.source = parts[1];\r\n\t\t}\r\n\r\n\t\t// Parse each\r\n\t\t$object.each(info, (part, item) => {\r\n\t\t\t// Already parsed\r\n\t\t\tif (item.parsed) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Check cached\r\n\t\t\tif (typeof this.getCache(item.source) !== \"undefined\") {\r\n\t\t\t\tinfo[part] = this.getCache(item.source);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Begin parsing\r\n\t\t\tlet partFormat: string = item.source;\r\n\r\n\t\t\t// Check for [] directives\r\n\t\t\tlet dirs: string[] | null = [];\r\n\t\t\tdirs = item.source.match(/^\\[([^\\]]*)\\]/);\r\n\t\t\tif (dirs && dirs.length && dirs[0] !== \"\") {\r\n\t\t\t\tpartFormat = item.source.substr(dirs[0].length);\r\n\t\t\t\titem.color = dirs[1];\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// Let TextFormatter split into chunks\r\n\t\t\tlet chunks: ITextChunk[] = getTextFormatter().chunk(partFormat, true);\r\n\t\t\tfor (let i: number = 0; i < chunks.length; i++) {\r\n\t\t\t\tlet chunk: ITextChunk = chunks[i];\r\n\r\n\t\t\t\t// replace back double vertical bar\r\n\t\t\t\tchunk.text = chunk.text.replace($strings.PLACEHOLDER2, \"|\");\r\n\r\n\t\t\t\tif (chunk.type === \"value\") {\r\n\r\n\t\t\t\t\t// Just \"Duration\"?\r\n\t\t\t\t\t// if (chunk.text.toLowerCase() === \"duration\") {\r\n\t\t\t\t\t// \tchunk.text = durationFormat;\r\n\t\t\t\t\t// }\r\n\r\n\t\t\t\t\t// Check for \"a\" (absolute) modifier\r\n\t\t\t\t\tif (chunk.text.match(/[yYMdDwhHKkmsSn]+a/)) {\r\n\t\t\t\t\t\titem.absolute = true;\r\n\t\t\t\t\t\tchunk.text = chunk.text.replace(/([yYMdDwhHKkmsSn]+)a/, \"$1\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Find all possible parts\r\n\t\t\t\t\tlet matches = chunk.text.match(/y+|Y+|M+|d+|D+|w+|h+|H+|K+|k+|m+|s+|S+|n+/g);\r\n\r\n\t\t\t\t\tif (matches) {\r\n\t\t\t\t\t\t// Populate template\r\n\t\t\t\t\t\tfor (let x = 0; x < matches.length; x++) {\r\n\t\t\t\t\t\t\t// Is it an alias?\r\n\t\t\t\t\t\t\tif (!$type.hasValue(matches[x])) {\r\n\t\t\t\t\t\t\t\tmatches[x] = this._unitAliases[matches[x]];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\titem.parts.push(matches[x]);\r\n\t\t\t\t\t\t\tchunk.text = chunk.text.replace(matches[x], $strings.PLACEHOLDER);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Apply to template\r\n\t\t\t\titem.template += chunk.text;\r\n\t\t\t}\r\n\r\n\t\t\t// Apply style formatting\r\n\t\t\t//item.template = getTextFormatter().format(item.template, this.outputFormat);\r\n\r\n\t\t\t// Save cache\r\n\t\t\tthis.setCache(item.source, item);\r\n\r\n\t\t\t// Mark this as parsed\r\n\t\t\titem.parsed = true;\r\n\t\t});\r\n\r\n\t\t// Save cache (the whole thing)\r\n\t\tthis.setCache(format, info);\r\n\r\n\t\treturn info;\r\n\t}\r\n\r\n\t/**\r\n\t * Applies parsed format to a numeric value.\r\n\t *\r\n\t * @param value    Value\r\n\t * @param details  Parsed format as returned by {parseFormat}\r\n\t * @return Formatted duration\r\n\t */\r\n\tprotected applyFormat(value: number, details: any): string {\r\n\r\n\t\t// Use absolute values\r\n\t\tlet negative: boolean = !details.absolute && (value < this._negativeBase);\r\n\t\tvalue = Math.abs(value);\r\n\r\n\t\t// Recalculate to milliseconds\r\n\t\tlet tstamp: number = this.toTimeStamp(value, details.baseUnit);\r\n\r\n\t\t// Init return value\r\n\t\tlet res: string = details.template;\r\n\r\n\t\t// Iterate through duration parts\r\n\t\tfor (let i = 0, len = details.parts.length; i < len; i++) {\r\n\r\n\t\t\t// Gather the part\r\n\t\t\tlet part: string = details.parts[i];\r\n\t\t\tlet unit: TimeUnit = this.toTimeUnit(part.substr(0, 1));\r\n\t\t\tlet digits: number = part.length;\r\n\r\n\t\t\t// Calculate current unit value\r\n\t\t\tlet ints: number = Math.floor(tstamp / this._unitValues[unit]);\r\n\t\t\tres = res.replace($strings.PLACEHOLDER, $utils.padString(ints, digits, \"0\"));\r\n\r\n\t\t\t// Reduce timestamp\r\n\t\t\ttstamp -= ints * this._unitValues[unit];\r\n\t\t}\r\n\r\n\t\t// Reapply negative sign\r\n\t\tif (negative) {\r\n\t\t\tres = \"-\" + res;\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts numeric value to timestamp in milliseconds.\r\n\t *\r\n\t * @param value     A source value\r\n\t * @param baseUnit  Base unit the source value is in: \"q\", \"s\", \"i\", \"h\", \"d\", \"w\", \"m\", \"y\"\r\n\t * @return Value representation as a timestamp in milliseconds\r\n\t */\r\n\tpublic toTimeStamp(value: number, baseUnit: TimeUnit): number {\r\n\t\treturn value * this._unitValues[baseUnit];\r\n\t}\r\n\r\n\tprotected toTimeUnit(code: string): Optional<TimeUnit> {\r\n\t\tswitch (code) {\r\n\t\t\tcase \"S\":\r\n\t\t\t\treturn \"millisecond\";\r\n\t\t\tcase \"s\":\r\n\t\t\t\treturn \"second\";\r\n\t\t\tcase \"m\":\r\n\t\t\t\treturn \"minute\";\r\n\t\t\tcase \"h\":\r\n\t\t\t\treturn \"hour\";\r\n\t\t\tcase \"d\":\r\n\t\t\t\treturn \"day\";\r\n\t\t\tcase \"w\":\r\n\t\t\t\treturn \"week\";\r\n\t\t\tcase \"M\":\r\n\t\t\t\treturn \"month\";\r\n\t\t\tcase \"y\":\r\n\t\t\t\treturn \"year\";\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Invalidates the parent [[Sprite]] object.\r\n\t */\r\n\tprotected invalidateSprite(): void {\r\n\t\tif (this.sprite) {\r\n\t\t\tthis.sprite.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Base unit the values are in.\r\n\t *\r\n\t * A base unit will be used to recalculate the numeric value to millisecond\r\n\t * timestamps.\r\n\t *\r\n\t * Available options:\r\n\t *\r\n\t * * \"millisecond\"\r\n\t * * \"second\"\r\n\t * * \"minute\"\r\n\t * * \"hour\"\r\n\t * * \"day\"\r\n\t * * \"week\"\r\n\t * * \"month\"\r\n\t * * \"year\"\r\n\t *\r\n\t * @default \"s\"\r\n\t * @param baseUnit  A base unit\r\n\t */\r\n\tpublic set baseUnit(baseUnit: TimeUnit) {\r\n\t\tthis._baseUnit = baseUnit;\r\n\t\tthis.invalidateSprite();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Base unit\r\n\t */\r\n\tpublic get baseUnit(): TimeUnit {\r\n\t\treturn this._baseUnit;\r\n\t}\r\n\r\n\t/**\r\n\t * Setter for output format: \"svg\" or \"html.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value  Output format\r\n\t */\r\n\tpublic set outputFormat(outputFormat: string) {\r\n\t\tthis._outputFormat = outputFormat.toLowerCase();\r\n\t\tthis.invalidateSprite();\r\n\t}\r\n\r\n\t/**\r\n\t * Getter for output format.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Output format\r\n\t */\r\n\tpublic get outputFormat(): string {\r\n\t\treturn this._outputFormat;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns appropriate default format for the value.\r\n\t *\r\n\t * If `maxValue` is sepcified, it will use that value to determine the time\r\n\t * unit for the format.\r\n\t *\r\n\t * For example if your `baseUnit` is `\"second\"` and you pass in `10`, you\r\n\t * will get `\"10\"`.\r\n\t *\r\n\t * However, you might want it to be formatted in the context of bigger scale,\r\n\t * say 10 minutes (600 seconds). If you pass in `600` as `maxValue`, all\r\n\t * values, including small ones will use format with minutes, e.g.:\r\n\t * `00:10`, `00:50`, `12: 30`, etc.\r\n\t *\r\n\t * @param value     Value to format\r\n\t * @param maxValue  Maximum value to be used to determine format\r\n\t * @param baseUnit  Base unit of the value\r\n\t * @return Format\r\n\t */\r\n\tpublic getFormat(value: number, maxValue?: number, baseUnit?: TimeUnit): string {\r\n\r\n\t\t// Is format override set?\r\n\t\tif ($type.hasValue(this.durationFormat)) {\r\n\t\t\treturn this.durationFormat;\r\n\t\t}\r\n\r\n\t\t// Get base unit\r\n\t\tif (!baseUnit) {\r\n\t\t\tbaseUnit = this.baseUnit;\r\n\t\t}\r\n\r\n\t\tif ($type.hasValue(maxValue) && value != maxValue) {\r\n\t\t\tvalue = Math.abs(value);\r\n\t\t\tmaxValue = Math.abs(maxValue);\r\n\t\t\tlet maxUnit = this.getValueUnit($math.max(value, maxValue), baseUnit);\r\n\t\t\t//let diffUnit = this.getValueUnit(Math.abs(maxValue - value), baseUnit);\r\n\t\t\t//console.log(maxUnit, diffUnit);\r\n\t\t\treturn this.durationFormats[baseUnit][maxUnit];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet unit = this.getValueUnit(value, baseUnit);\r\n\t\t\treturn this.durationFormats[baseUnit][unit];\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns value's closest denominator time unit, e.g 100 seconds is\r\n\t * `\"minute\"`, while 59 seconds would still be `second`.\r\n\t *\r\n\t * @param value     Source duration value\r\n\t * @param baseUnit  Base unit\r\n\t * @return Denominator\r\n\t */\r\n\tpublic getValueUnit(value: number, baseUnit?: TimeUnit): TimeUnit {\r\n\r\n\t\t// Get base unit\r\n\t\tif (!baseUnit) {\r\n\t\t\tbaseUnit = this.baseUnit;\r\n\t\t}\r\n\r\n\t\t// Convert to milliseconds\r\n\t\tlet currentUnit: TimeUnit;\r\n\t\tlet ms = this.getMilliseconds(value, baseUnit);\r\n\t\t$object.eachContinue(this._unitValues, (key, val) => {\r\n\t\t\tif (key == baseUnit || currentUnit) {\r\n\t\t\t\tlet num = ms / val;\r\n\t\t\t\tif (num <= 1) {\r\n\t\t\t\t\tif (!currentUnit) {\r\n\t\t\t\t\t\tcurrentUnit = key;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tcurrentUnit = key;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\treturn currentUnit;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts value to milliseconds according to `baseUnit`.\r\n\t *\r\n\t * @param value     Source duration value\r\n\t * @param baseUnit  Base unit\r\n\t * @return Value in milliseconds\r\n\t */\r\n\tpublic getMilliseconds(value: number, baseUnit?: TimeUnit): number {\r\n\r\n\t\t// Get base unit\r\n\t\tif (!baseUnit) {\r\n\t\t\tbaseUnit = this.baseUnit;\r\n\t\t}\r\n\r\n\t\treturn value * this._unitValues[baseUnit];\r\n\t}\r\n\r\n\t/**\r\n\t * If set, this format will be used instead of the one determined dynamically\r\n\t * based on the basedUnit and range of values.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-duration/} Available fomatting codes\r\n\t * @param value  Format\r\n\t */\r\n\tpublic set durationFormat(value: string) {\r\n\t\tif (this._durationFormat != value) {\r\n\t\t\tthis._durationFormat = value;\r\n\t\t\tthis.invalidateSprite();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Format\r\n\t */\r\n\tpublic get durationFormat(): Optional<string> {\r\n\t\treturn this._durationFormat;\r\n\t}\r\n\r\n\t/**\r\n\t * Duration formats for various combination of base units.\r\n\t *\r\n\t * @param value  Formats\r\n\t */\r\n\tpublic set durationFormats(value: Partial<Record<TimeUnit, Partial<Record<TimeUnit, string>>>>) {\r\n\t\tthis._durationFormats = value;\r\n\t\tthis.invalidateSprite();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Formats\r\n\t */\r\n\tpublic get durationFormats(): Partial<Record<TimeUnit, Partial<Record<TimeUnit, string>>>> {\r\n\t\tif (!this._durationFormats) {\r\n\t\t\tthis._durationFormats = {\r\n\t\t\t\t\"millisecond\": {\r\n\t\t\t\t\t\"millisecond\": this.language.translate(\"_duration_millisecond\"),\r\n\t\t\t\t\t\"second\": this.language.translate(\"_duration_millisecond_second\"),\r\n\t\t\t\t\t\"minute\": this.language.translate(\"_duration_millisecond_minute\"),\r\n\t\t\t\t\t\"hour\": this.language.translate(\"_duration_millisecond_hour\"),\r\n\t\t\t\t\t\"day\": this.language.translate(\"_duration_millisecond_day\"),\r\n\t\t\t\t\t\"week\": this.language.translate(\"_duration_millisecond_week\"),\r\n\t\t\t\t\t\"month\": this.language.translate(\"_duration_millisecond_month\"),\r\n\t\t\t\t\t\"year\": this.language.translate(\"_duration_millisecond_year\")\r\n\t\t\t\t},\r\n\t\t\t\t\"second\": {\r\n\t\t\t\t\t\"second\": this.language.translate(\"_duration_second\"),\r\n\t\t\t\t\t\"minute\": this.language.translate(\"_duration_second_minute\"),\r\n\t\t\t\t\t\"hour\": this.language.translate(\"_duration_second_hour\"),\r\n\t\t\t\t\t\"day\": this.language.translate(\"_duration_second_day\"),\r\n\t\t\t\t\t\"week\": this.language.translate(\"_duration_second_week\"),\r\n\t\t\t\t\t\"month\": this.language.translate(\"_duration_second_month\"),\r\n\t\t\t\t\t\"year\": this.language.translate(\"_duration_second_year\")\r\n\t\t\t\t},\r\n\t\t\t\t\"minute\": {\r\n\t\t\t\t\t\"minute\": this.language.translate(\"_duration_minute\"),\r\n\t\t\t\t\t\"hour\": this.language.translate(\"_duration_minute_hour\"),\r\n\t\t\t\t\t\"day\": this.language.translate(\"_duration_minute_day\"),\r\n\t\t\t\t\t\"week\": this.language.translate(\"_duration_minute_week\"),\r\n\t\t\t\t\t\"month\": this.language.translate(\"_duration_minute_month\"),\r\n\t\t\t\t\t\"year\": this.language.translate(\"_duration_minute_year\")\r\n\t\t\t\t},\r\n\t\t\t\t\"hour\": {\r\n\t\t\t\t\t\"hour\": this.language.translate(\"_duration_hour\"),\r\n\t\t\t\t\t\"day\": this.language.translate(\"_duration_hour_day\"),\r\n\t\t\t\t\t\"week\": this.language.translate(\"_duration_hour_week\"),\r\n\t\t\t\t\t\"month\": this.language.translate(\"_duration_hour_month\"),\r\n\t\t\t\t\t\"year\": this.language.translate(\"_duration_hour_year\")\r\n\t\t\t\t},\r\n\t\t\t\t\"day\": {\r\n\t\t\t\t\t\"day\": this.language.translate(\"_duration_day\"),\r\n\t\t\t\t\t\"week\": this.language.translate(\"_duration_day_week\"),\r\n\t\t\t\t\t\"month\": this.language.translate(\"_duration_day_month\"),\r\n\t\t\t\t\t\"year\": this.language.translate(\"_duration_day_year\")\r\n\t\t\t\t},\r\n\t\t\t\t\"week\": {\r\n\t\t\t\t\t\"week\": this.language.translate(\"_duration_week\"),\r\n\t\t\t\t\t\"month\": this.language.translate(\"_duration_week_month\"),\r\n\t\t\t\t\t\"year\": this.language.translate(\"_duration_week_year\")\r\n\t\t\t\t},\r\n\t\t\t\t\"month\": {\r\n\t\t\t\t\t\"month\": this.language.translate(\"_duration_month\"),\r\n\t\t\t\t\t\"year\": this.language.translate(\"_duration_month_year\")\r\n\t\t\t\t},\r\n\t\t\t\t\"year\": {\r\n\t\t\t\t\t\"year\": this.language.translate(\"_duration_year\")\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn this._durationFormats;\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"DurationFormatter\"] = DurationFormatter;\r\n","/**\r\n * This module defines a [[Validatable]] class which can be used by all\r\n * non-[[Sprite]] classes to use system beats to revalidate themselves.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObjectEvents, IBaseObjectEvents } from \"../Base\";\r\nimport { IDisposer } from \"../utils/Disposer\";\r\nimport { registry } from \"../Registry\";\r\n\r\n/**\r\n * Events.\r\n */\r\nexport interface IValidatableEvents extends IBaseObjectEvents { }\r\n\r\n\r\n/**\r\n * This module defines a [[Validatable]] class which can be used by all\r\n * non-[[Sprite]] classes to use system update cycle to revalidate themselves.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport class Validatable extends BaseObjectEvents {\r\n\r\n\t/**\r\n\t * Is invalid and should be revalidated?\r\n\t */\r\n\tprivate _validateDisposer: IDisposer | null = null;\r\n\r\n\t/**\r\n\t * Invalidates the element, so that it can re-validate/redraw itself in the\r\n\t * next cycle.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic invalidate(): void {\r\n\t\tif (this._validateDisposer === null) {\r\n\t\t\tthis._validateDisposer = registry.events.on(\"exitframe\", this.validate, this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Validates itself.\r\n\t *\r\n\t * Most probably the extending class will have an overriding `validate()`\r\n\t * method which will do actual work, as well as call this method using\r\n\t * `super.validate()`.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate(): void {\r\n\t\tif (this._validateDisposer !== null) {\r\n\t\t\tthis._validateDisposer.dispose();\r\n\t\t\tthis._validateDisposer = null;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic dispose(): void {\r\n\t\tif (this._validateDisposer !== null) {\r\n\t\t\tthis._validateDisposer.dispose();\r\n\t\t\tthis._validateDisposer = null;\r\n\t\t}\r\n\r\n\t\tsuper.dispose();\r\n\t}\r\n}\r\n","/**\r\n * A collection of network-related functions\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport * as $type from \"./Type\";\r\n\r\n/**\r\n * Defines an interface for objects that hold a net request result.\r\n */\r\nexport interface INetLoadResult<A> {\r\n\r\n\t/**\r\n\t * A reference to original [[XMLHttpRequest]].\r\n\t */\r\n\txhr: XMLHttpRequest;\r\n\r\n\t/**\r\n\t * Request response body.\r\n\t */\r\n\tresponse?: string;\r\n\r\n\t/**\r\n\t * Request response as Blob. (if set `responseType = \"blob\"`)\r\n\t */\r\n\tblob?: Blob;\r\n\r\n\t/**\r\n\t * Response `Content-Type`.\r\n\t */\r\n\ttype: string | null;\r\n\r\n\t/**\r\n\t * Was there an error?\r\n\t */\r\n\terror: boolean;\r\n\r\n\t/**\r\n\t * A target object that made the net load request.\r\n\t */\r\n\ttarget?: A;\r\n\r\n}\r\n\r\nexport interface INetRequestOptions {\r\n\r\n\t/**\r\n\t * Custom request headers to be added to HTTP(S) request.\r\n\t */\r\n\trequestHeaders?: { key: string, value: string }[];\r\n\r\n\t/**\r\n\t * Specify expected response type.\r\n\t *\r\n\t * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseType} for more info\r\n\t */\r\n\tresponseType?: XMLHttpRequestResponseType;\r\n\r\n\t/**\r\n\t * Specify whether to send CORS credentials (defaults to `false`).\r\n\t *\r\n\t * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/withCredentials} for more info\r\n\t */\r\n\twithCredentials?: boolean;\r\n}\r\n\r\n/**\r\n * Loads an external file via its URL.\r\n *\r\n * Please note that this is an asynchronous function.\r\n *\r\n * It will not return the result, but rather a `Promise`.\r\n *\r\n * You can use the `await` notion, or `then()`.\r\n *\r\n * ```TypeScript\r\n * // Using await\r\n * let response = await Net.load( \"http://www.my.com/data.json\" );\r\n * console.log( response.response );\r\n *\r\n * // Using then()\r\n * Net.load( \"http://www.my.com/data.json\" ).then( ( response ) => {\r\n *   console.log( response.response );\r\n * } );\r\n * ```\r\n * ```JavaScript\r\n * // Using then()\r\n * Net.load( \"http://www.my.com/data.json\" ).then( function( response ) {\r\n *   console.log( response.response );\r\n * } );\r\n * ```\r\n *\r\n * @async\r\n * @param url      URL for the file to load\r\n * @param target   A target element that is requesting the net load\r\n * @param options  Request options\r\n * @return Result (Promise)\r\n */\r\nexport function load<A>(url: string, target?: A, options?: INetRequestOptions): Promise<INetLoadResult<A>> {\r\n\treturn new Promise<INetLoadResult<A>>((success, error) => {\r\n\r\n\t\t// Is return type Blob?\r\n\t\tlet isBlob = $type.hasValue(options) && options.responseType == \"blob\";\r\n\r\n\t\t// Create request and set up handlers\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\t\txhr.onload = () => {\r\n\t\t\tif (xhr.status === 200) {\r\n\r\n\t\t\t\tlet response: $type.Optional<string>;\r\n\t\t\t\tlet blob: $type.Optional<Blob>;\r\n\r\n\t\t\t\tif (isBlob) {\r\n\t\t\t\t\tblob = xhr.response;\r\n\t\t\t\t\treadBlob(blob).then((response) => {\r\n\t\t\t\t\t\tlet output: INetLoadResult<A> = {\r\n\t\t\t\t\t\t\txhr: xhr,\r\n\t\t\t\t\t\t\terror: false,\r\n\t\t\t\t\t\t\tresponse: response,\r\n\t\t\t\t\t\t\tblob: blob,\r\n\t\t\t\t\t\t\ttype: xhr.getResponseHeader(\"Content-Type\"),\r\n\t\t\t\t\t\t\ttarget: target\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tsuccess(output);\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tresponse = xhr.responseText || xhr.response\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet output: INetLoadResult<A> = {\r\n\t\t\t\t\txhr: xhr,\r\n\t\t\t\t\terror: false,\r\n\t\t\t\t\tresponse: response,\r\n\t\t\t\t\tblob: blob,\r\n\t\t\t\t\ttype: xhr.getResponseHeader(\"Content-Type\"),\r\n\t\t\t\t\ttarget: target\r\n\t\t\t\t};\r\n\t\t\t\tsuccess(output);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\terror({\r\n\t\t\t\t\txhr: xhr,\r\n\t\t\t\t\terror: true,\r\n\t\t\t\t\ttype: xhr.getResponseHeader(\"Content-Type\"),\r\n\t\t\t\t\ttarget: target\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t\txhr.onerror = () => {\r\n\t\t\terror({\r\n\t\t\t\txhr: xhr,\r\n\t\t\t\terror: true,\r\n\t\t\t\ttype: xhr.getResponseHeader(\"Content-Type\"),\r\n\t\t\t\ttarget: target\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Open request\r\n\t\txhr.open(\"GET\", url, true);\r\n\r\n\t\tif (options && options.withCredentials) {\r\n\t\t\txhr.withCredentials = true;\r\n\t\t}\r\n\r\n\t\t// Process options\r\n\t\tif ($type.hasValue(options)) {\r\n\r\n\t\t\tif ($type.hasValue(options.requestHeaders)) {\r\n\t\t\t\tfor (let i = 0; i < options.requestHeaders.length; i++) {\r\n\t\t\t\t\tlet header = options.requestHeaders[i];\r\n\t\t\t\t\txhr.setRequestHeader(header.key, header.value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ($type.hasValue(options.responseType)) {\r\n\t\t\t\txhr.responseType = options.responseType;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Send request\r\n\t\txhr.send();\r\n\r\n\t});\r\n\r\n}\r\n\r\n/**\r\n * Returns textual representation of a Blob object.\r\n *\r\n * @param   blob  Target blob\r\n * @return        Text promise\r\n */\r\nexport function readBlob(blob: Blob): Promise<string> {\r\n\treturn new Promise<string>((success, error) => {\r\n\t\tconst reader = new FileReader()\r\n\r\n\t\treader.onload = event => {\r\n\t\t\tsuccess(<string>reader.result);\r\n\t\t}\r\n\r\n\t\treader.onerror = (e) => {\r\n\t\t\terror(e);\r\n\t\t}\r\n\r\n\t\treader.readAsText(blob);\r\n\t});\r\n}\r\n","/**\r\n * Data Loader is responsible for loading and parsing external data\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { DataSource } from \"./DataSource\";\r\nimport { DataParser } from \"./DataParser\";\r\nimport { CSVParser } from \"./CSVParser\";\r\nimport { JSONParser } from \"./JSONParser\";\r\nimport { Adapter } from \"../utils/Adapter\";\r\nimport * as $net from \"../utils/Net\";\r\nimport * as $array from \"../utils/Array\";\r\n\r\n/**\r\n * Represents a list of available adapters for Sprite\r\n */\r\nexport interface IDataLoaderAdapters {\r\n\r\n\t/**\r\n\t * Applied after the Data Loader determines suitable parser type by data\r\n\t * source's URL extension.\r\n\t */\r\n\tgetParserByType: {\r\n\t\tparser: DataParser,\r\n\t\ttype?: string\r\n\t},\r\n\r\n\t/**\r\n\t * Applied after the Data Loader determines suitable parser type based on\r\n\t * its data examination.\r\n\t */\r\n\tgetParserByData: {\r\n\t\tparser: DataParser,\r\n\t\tdata?: string,\r\n\t\ttype?: string\r\n\t}\r\n\r\n};\r\n\r\n/**\r\n * Data Loader is responsible for loading and parsing external data.\r\n *\r\n * There is just one instance of DataLoader per system. Unless you have a\r\n * speicific reason, do not instantiate additional instances.\r\n *\r\n * The global instance of Data Loader is accessible via:\r\n *\r\n * ```TypeScript\r\n * am4core.dataLoader;\r\n * ```\r\n * ```JavaScript\r\n * am4core.dataLoader;\r\n * ```\r\n *\r\n * A loading of specific data source is done via [[DataSource]].\r\n *\r\n \t Please refer to [[DataSource]] for information how to use it.\r\n *\r\n * @see {@link IDataLoaderAdapters} for a list of available Adapters\r\n */\r\nexport class DataLoader {\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IDataLoaderAdapters;\r\n\r\n\t/**\r\n\t * Adapter.\r\n\t */\r\n\tpublic adapter: Adapter<DataLoader, IDataLoaderAdapters> = new Adapter<DataLoader, IDataLoaderAdapters>(this);\r\n\r\n\t/**\r\n\t * Loads a supplied [[DataSource]] or an array of data sources, then calls\r\n\t * their respective `parse` methods.\r\n\t *\r\n\t * @param source  A single data source or an array of multiple of data sources\r\n\t */\r\n\tpublic load(source: DataSource | DataSource[]): void {\r\n\t\tlet sources = Array.isArray(source) ? source : [source];\r\n\r\n\t\t// Add each Source to the list to be loaded simultaneously\r\n\t\tlet promises = $array.map(sources, (x) => {\r\n\t\t\t// Dispatch events\r\n\t\t\tx.dispatchImmediately(\"started\");\r\n\t\t\tx.dispatchImmediately(\"loadstarted\");\r\n\r\n\t\t\treturn $net.load(x.url, x, x.requestOptions);\r\n\t\t});\r\n\r\n\t\t// Run all promises in parallel\r\n\t\tPromise.all(promises).then((res) => {\r\n\t\t\t// Process each loaded source\r\n\t\t\t$array.each(res, (result) => {\r\n\t\t\t\t// Get Source\r\n\t\t\t\tlet source = result.target;\r\n\r\n\t\t\t\t// Dispatch events\r\n\t\t\t\tsource.dispatchImmediately(\"loadended\");\r\n\r\n\t\t\t\tif (result.error) {\r\n\t\t\t\t\tif (source.events.isEnabled(\"error\")) {\r\n\t\t\t\t\t\tsource.events.dispatchImmediately(\"error\", {\r\n\t\t\t\t\t\t\ttype: \"error\",\r\n\t\t\t\t\t\t\tcode: result.xhr.status,\r\n\t\t\t\t\t\t\tmessage: source.language.translate(\"Unable to load file: %1\", null, source.url),\r\n\t\t\t\t\t\t\ttarget: source\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\r\n\t\t\t\t\t// Initiate parsing of the loaded data\r\n\t\t\t\t\tsource.processData(result.response, result.type);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsource.dispatchImmediately(\"ended\");\r\n\t\t\t});\r\n\t\t}).catch((res) => {\r\n\r\n\t\t\tif (res.target) {\r\n\r\n\t\t\t\tres.target.dispatchImmediately(\"loadended\");\r\n\r\n\t\t\t\tif (res.target.events.isEnabled(\"error\")) {\r\n\t\t\t\t\tres.target.events.dispatchImmediately(\"error\", {\r\n\t\t\t\t\t\ttype: \"error\",\r\n\t\t\t\t\t\tcode: res.xhr.status,\r\n\t\t\t\t\t\tmessage: res.target.language.translate(\"Unable to load file: %1\", null, res.target.url),\r\n\t\t\t\t\t\ttarget: res.target\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tres.target.dispatchImmediately(\"ended\");\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Instantiates a [[DataParser]] object based on the data type.\r\n\t * Built-in parser types are as follows:\r\n\t *\r\n\t * * \"csv\" or \"text/csv\"\r\n\t * * \"json\" or \"application/json\"\r\n\t *\r\n\t * @param contentType  A format type\r\n\t * @return A parser object\r\n\t */\r\n\tpublic getParserByType(contentType: string): DataParser {\r\n\r\n\t\t// Let some plugin decide\r\n\t\tlet parser = this.adapter.apply(\"getParserByType\", {\r\n\t\t\tparser: null,\r\n\t\t\ttype: contentType\r\n\t\t}).parser;\r\n\r\n\t\tif (parser) {\r\n\t\t\treturn parser;\r\n\t\t}\r\n\r\n\t\tif (contentType == \"csv\" || contentType == \"text/csv\" || contentType == \"application/vnd.ms-excel\") {\r\n\t\t\treturn new CSVParser();\r\n\t\t}\r\n\t\tif (contentType == \"json\" || contentType == \"application/json\") {\r\n\t\t\treturn new JSONParser();\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\r\n\t/**\r\n\t * Tries to determine a parser out of content type and/or actual data.\r\n\t *\r\n\t * @param data         Data\r\n\t * @param contentType  Content-type\r\n\t * @return Parser instance\r\n\t */\r\n\tpublic getParserByData(data: string, contentType?: string): DataParser {\r\n\r\n\t\t// Let some plugin decide\r\n\t\tlet parser = this.adapter.apply(\"getParserByData\", {\r\n\t\t\tparser: null,\r\n\t\t\tdata: data,\r\n\t\t\ttype: contentType\r\n\t\t}).parser;\r\n\r\n\t\t// Check if we have parser from outside code\r\n\t\tif (!parser) {\r\n\t\t\t// No, let's try to figure it out\r\n\t\t\tparser = this.getParserByType(contentType)\r\n\r\n\t\t\tif (parser) {\r\n\t\t\t\t// We're able to figure out parser by content-type\r\n\t\t\t\treturn parser;\r\n\t\t\t}\r\n\t\t\telse if (JSONParser.isJSON(data)) {\r\n\t\t\t\treturn this.getParserByType(\"json\");\r\n\t\t\t}\r\n\t\t\telse if (CSVParser.isCSV(data)) {\r\n\t\t\t\treturn this.getParserByType(\"csv\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn parser;\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Create instance of Data Loader\r\n */\r\nexport let dataLoader: DataLoader = new DataLoader();\r\n","/**\r\n * CSV parser.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { DataParser, IDataParserOptions } from \"./DataParser\";\r\nimport { DateFormatter } from \"../formatters/DateFormatter\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $array from \"../utils/Array\";\r\n\r\n/**\r\n * Defines options for CSV format parser\r\n */\r\nexport interface ICSVOptions extends IDataParserOptions {\r\n\r\n\t/**\r\n\t * A delimiter character for columns.\r\n\t *\r\n\t * @default ','\r\n\t */\r\n\tdelimiter?: string;\r\n\r\n\t/**\r\n\t * The data is in reverse order.\r\n\t *\r\n\t * If iset to `true`, parser will invert the order of the data items before\r\n\t * passing back the data.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\treverse?: boolean;\r\n\r\n\t/**\r\n\t * Skip a number of rows from the beginning of the data.\r\n\t *\r\n\t * Useful if your data contains non-data headers, such as column names or\r\n\t * empty rows.\r\n\t *\r\n\t * @default 0\r\n\t */\r\n\tskipRows?: number;\r\n\r\n\t/**\r\n\t * Skip empty rows.\r\n\t *\r\n\t * If set to `false`, parser will generate empty data points for empty rows\r\n\t * in data.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tskipEmpty?: boolean;\r\n\r\n\t/**\r\n\t * Use the first row in data to generte column names.\r\n\t *\r\n\t * Normally, parser will name each column `col0`, `col1`, etc.\r\n\t *\r\n\t * Setting this to `true` will make the parser look at the first row, for\r\n\t * actual column names.\r\n\t *\r\n\t * Please note that if you use it with `skipRows`, the specified number of\r\n\t * rows will be removed, then the parser will look for column names in the\r\n\t * first row of what's left.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tuseColumnNames?: boolean;\r\n\r\n\t/**\r\n\t * A list of fields that should be treaded as numeric.\r\n\t *\r\n\t * Any information container in such fields will be converted to `number`.\r\n\t */\r\n\tnumberFields?: string[];\r\n\r\n\t/**\r\n\t * A list of fields that hold date/time infromation.\r\n\t *\r\n\t * Parser will try to convert such fields into `Date` objects.\r\n\t */\r\n\tdateFields?: string[];\r\n\r\n\t/**\r\n\t * A date formatted to be used when parsing dates.\r\n\t */\r\n\tdateFormatter?: DateFormatter;\r\n}\r\n\r\n/**\r\n * Define possible separators.\r\n */\r\nlet separators = [\",\", \";\", \"\\t\"];\r\n\r\n/**\r\n * A parser for CSV format.\r\n *\r\n * @important\r\n */\r\nexport class CSVParser extends DataParser {\r\n\r\n\t/**\r\n\t * Tests if the format is CSV.\r\n\t *\r\n\t * @param data  Source data\r\n\t * @return Is it CSV?\r\n\t */\r\n\tstatic isCSV(data: string): boolean {\r\n\t\treturn CSVParser.getDelimiterFromData(data) ? true : false;\r\n\t}\r\n\r\n\t/**\r\n\t * Tries to determine a column separator.\r\n\t *\r\n\t * @param data  Source data\r\n\t * @return Separator\r\n\t */\r\n\tstatic getDelimiterFromData(data: string): string {\r\n\r\n\t\t// We're going to take first few lines of the CSV with different\r\n\t\t// possible separators and check if it results in same number of columns.\r\n\t\t// If it does, we're going to assume it's a CSV\r\n\t\tlet lines = data.split(\"\\n\");\r\n\t\tlet len = lines.length;\r\n\t\tlet separator: string;\r\n\r\n\t\t$array.each(separators, (sep) => {\r\n\t\t\tlet columns = 0,\r\n\t\t\t\tlineColums = 0;\r\n\r\n\t\t\t// TODO replace with iterators\r\n\t\t\tfor (let i = 0; i < len; ++i) {\r\n\r\n\t\t\t\t// Get number of columns in a line\r\n\t\t\t\tcolumns = lines[i].split(sep).length;\r\n\r\n\t\t\t\tif (columns > 1) {\r\n\r\n\t\t\t\t\t// More than one column - possible candidate\r\n\t\t\t\t\tif (lineColums === 0) {\r\n\t\t\t\t\t\t// First line\r\n\t\t\t\t\t\tlineColums = columns;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (columns != lineColums) {\r\n\t\t\t\t\t\t// Incorrect number of columns, give up on this separator\r\n\t\t\t\t\t\tlineColums = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\r\n\t\t\t\t\t// Not this separator\r\n\t\t\t\t\t// Not point in continuing\r\n\t\t\t\t\tlineColums = 0;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Check if we have a winner\r\n\t\t\tif (lineColums) {\r\n\t\t\t\tseparator = sep;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn separator;\r\n\t}\r\n\r\n\t/**\r\n\t * Content-type suitable for CSV format.\r\n\t */\r\n\tpublic contentType: string = \"text/csv\";\r\n\r\n\t/**\r\n\t * Parser options.\r\n\t *\r\n\t * @see {@link ICSVOptions} for description of each option\r\n\t */\r\n\tpublic options: ICSVOptions = {\r\n\t\tdelimiter: \"\",\r\n\t\treverse: false,\r\n\t\tskipRows: 0,\r\n\t\tskipEmpty: true,\r\n\t\tuseColumnNames: false\r\n\t};\r\n\r\n\t/**\r\n\t * Parses and returns data.\r\n\t *\r\n\t * @param data  Unparsed data\r\n\t * @return Parsed data\r\n\t */\r\n\tpublic parse(csv: string): any[] {\r\n\r\n\t\t// Check if we have delimiter set\r\n\t\tif (!this.options.delimiter) {\r\n\t\t\tthis.options.delimiter = CSVParser.getDelimiterFromData(csv);\r\n\t\t}\r\n\r\n\t\t// Get CSV data as array\r\n\t\tlet data = this.CSVToArray(csv, this.options.delimiter);\r\n\r\n\t\t// Do we need to cast some fields to numbers?\r\n\t\tlet empty = $type.hasValue(this.options.emptyAs);\r\n\t\tlet numbers = this.parsableNumbers;\r\n\t\tlet dates = this.parsableDates;\r\n\r\n\t\t// Init resuling array\r\n\t\tlet res: any[] = [],\r\n\t\t\tcols: string[] = [],\r\n\t\t\tcol: string,\r\n\t\t\ti: number;\r\n\r\n\t\t// Skip rows\r\n\t\tfor (i = 0; i < this.options.skipRows; i++) {\r\n\t\t\tdata.shift();\r\n\t\t}\r\n\r\n\t\t// First row holds column names?\r\n\t\tif (this.options.useColumnNames) {\r\n\t\t\tcols = data.shift();\r\n\r\n\t\t\t// Normalize column names\r\n\t\t\tfor (let x = 0; x < cols.length; x++) {\r\n\t\t\t\t// trim\r\n\t\t\t\tcol = $type.hasValue(cols[x]) ? cols[x].replace(/^\\s+|\\s+$/gm, \"\") : \"\";\r\n\r\n\t\t\t\t// Check for empty\r\n\t\t\t\tif (\"\" === col) {\r\n\t\t\t\t\tcol = \"col\" + x;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcols[x] = col;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Iterate through the result set\r\n\t\tlet row;\r\n\t\twhile (true) {\r\n\t\t\trow = this.options.reverse ? data.pop() : data.shift();\r\n\r\n\t\t\tif (!row) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.options.skipEmpty && row.length === 1 && row[0] === \"\") {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet dataPoint: any = {};\r\n\t\t\tfor (i = 0; i < row.length; i++) {\r\n\t\t\t\tcol = undefined === cols[i] ? \"col\" + i : cols[i];\r\n\t\t\t\tdataPoint[col] = row[i] === \"\" ? this.options.emptyAs : row[i];\r\n\r\n\t\t\t\t// Convert\r\n\t\t\t\tif (empty) {\r\n\t\t\t\t\tdataPoint[col] = this.maybeToEmpty(dataPoint[col]);\r\n\t\t\t\t}\r\n\t\t\t\tif (numbers) {\r\n\t\t\t\t\tdataPoint[col] = this.maybeToNumber(col, dataPoint[col]);\r\n\t\t\t\t}\r\n\t\t\t\tif (dates) {\r\n\t\t\t\t\tdataPoint[col] = this.maybeToDate(col, dataPoint[col]);\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t\tres.push(dataPoint);\r\n\t\t}\r\n\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n \t * Converts CSV into array.\r\n \t *\r\n \t * The functionality of this function is taken from here:\r\n \t * http://www.bennadel.com/blog/1504-ask-ben-parsing-csv-strings-with-javascript-exec-regular-expression-command.htm\r\n \t *\r\n \t * @param data       Source data\r\n \t * @param delimiter  Column delimiter\r\n \t * @return Parsed array\r\n \t */\r\n\tpublic CSVToArray(data: string, delimiter: string): any[] {\r\n\r\n\t\t// Check to see if the delimiter is defined. If not,\r\n\t\t// then default to comma.\r\n\t\tdelimiter = (delimiter || ',');\r\n\r\n\t\t// Create a regular expression to parse the CSV values.\r\n\t\tlet objPattern = new RegExp(\r\n\t\t\t(\r\n\t\t\t\t// Delimiters.\r\n\t\t\t\t\"(\\\\\" + delimiter + \"|\\\\r?\\\\n|\\\\r|^)\" +\r\n\r\n\t\t\t\t// Quoted fields.\r\n\t\t\t\t\"(?:\\\"([^\\\"]*(?:\\\"\\\"[^\\\"]*)*)\\\"|\" +\r\n\r\n\t\t\t\t// Standard fields.\r\n\t\t\t\t\"([^\\\"\\\\\" + delimiter + \"\\\\r\\\\n]*))\"\r\n\t\t\t),\r\n\t\t\t\"gi\"\r\n\t\t);\r\n\r\n\r\n\t\t// Create an array to hold our data. Give the array\r\n\t\t// a default empty first row.\r\n\t\tlet arrData: any[] = [\r\n\t\t\t[]\r\n\t\t];\r\n\r\n\t\t// Create an array to hold our individual pattern\r\n\t\t// matching groups.\r\n\t\tlet arrMatches = null;\r\n\r\n\t\t// Keep looping over the regular expression matches\r\n\t\t// until we can no longer find a match.\r\n\t\twhile (true) {\r\n\t\t\tarrMatches = objPattern.exec(data);\r\n\r\n\t\t\tif (!arrMatches) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t// Get the delimiter that was found.\r\n\t\t\tlet strMatchedDelimiter = arrMatches[1];\r\n\r\n\t\t\t// Check to see if the given delimiter has a length\r\n\t\t\t// (is not the start of string) and if it matches\r\n\t\t\t// field delimiter. If id does not, then we know\r\n\t\t\t// that this delimiter is a row delimiter.\r\n\t\t\tif (\r\n\t\t\t\tstrMatchedDelimiter.length &&\r\n\t\t\t\t(strMatchedDelimiter !== delimiter)\r\n\t\t\t) {\r\n\r\n\t\t\t\t// Since we have reached a new row of data,\r\n\t\t\t\t// add an empty row to our data array.\r\n\t\t\t\tarrData.push([]);\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Now that we have our delimiter out of the way,\r\n\t\t\t// let's check to see which kind of value we\r\n\t\t\t// captured (quoted or unquoted).\r\n\t\t\tlet strMatchedValue;\r\n\t\t\tif (arrMatches[2]) {\r\n\r\n\t\t\t\t// We found a quoted value. When we capture\r\n\t\t\t\t// this value, unescape any double quotes.\r\n\t\t\t\tstrMatchedValue = arrMatches[2].replace(\r\n\t\t\t\t\tnew RegExp(\"\\\"\\\"\", \"g\"),\r\n\t\t\t\t\t\"\\\"\"\r\n\t\t\t\t);\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// We found a non-quoted value.\r\n\t\t\t\tstrMatchedValue = arrMatches[3];\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// Now that we have our value string, let's add\r\n\t\t\t// it to the data array.\r\n\t\t\tarrData[arrData.length - 1].push(strMatchedValue);\r\n\t\t}\r\n\r\n\t\t// Return the parsed data.\r\n\t\treturn (arrData);\r\n\t}\r\n\r\n}\r\n","/**\r\n * Data parser module.\r\n */\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { DateFormatter } from \"../formatters/DateFormatter\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines common options for all data parsers.\r\n */\r\nexport interface IDataParserOptions {\r\n\r\n\t/**\r\n\t * Empty values (e.g. empty strings, `null`, etc.) will be replaced with\r\n\t * this.\r\n\t */\r\n\temptyAs?: any;\r\n\r\n\t/**\r\n\t * List of fields in data that hold numeric values. Parser will try to\r\n\t * convert the value in those fields to a `number`.\r\n\t */\r\n\tnumberFields?: string[];\r\n\r\n\t/**\r\n\t * List of fields in data that need to be treated as Dates, i.e. converted\r\n\t * to `Date` objects from whatever source format they are currently in.\r\n\t */\r\n\tdateFields?: string[];\r\n\r\n\t/**\r\n\t * An instance of [[DateFormatter]] to use when parsing string-based dates.\r\n\t * If it's not set, the parser will create it's own instance of\r\n\t * [[DateFormatter]], should any date parsing required. (`dateFields` is set)\r\n\t *\r\n\t * Unless `dateFormat` is set in parser options, the parser will try to look\r\n\t * for `dateFormat` in `dateFormatter`.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-date-time/#Parsing_Dates} Tutorial on date parsing\r\n\t */\r\n\tdateFormatter?: DateFormatter;\r\n\r\n\t/**\r\n\t * Override date format set in `dateFormatter`.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/formatters/formatting-date-time/#Parsing_Dates} Tutorial on date parsing\r\n\t */\r\n\tdateFormat?: string;\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Base class for the data parsers.\r\n */\r\nexport class DataParser {\r\n\r\n\t/**\r\n\t * Content type, relevant to the specific format.\r\n\t */\r\n\tpublic contentType: string;\r\n\r\n\t/**\r\n\t * Parser options.\r\n\t *\r\n\t * @see {@link IDataParserOptions} for description of each option\r\n\t */\r\n\tpublic options: IDataParserOptions;\r\n\r\n\t/**\r\n\t * A \"placeholder\" function for real parsers to override.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param data  Source data\r\n\t * @return Parsed data (empty)\r\n\t */\r\n\tpublic parse(data: string): any {\r\n\t\treturn [];\r\n\t};\r\n\r\n\t/**\r\n\t * Checks if there are any numeric fields that need to be converted to\r\n\t * numbers.\r\n\t *\r\n\t * @return Numeric fields?\r\n\t */\r\n\tprotected get parsableNumbers(): boolean {\r\n\t\treturn this.options.numberFields && (this.options.numberFields.length > 0);\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a value to 'number' if it is in `numberFields`.\r\n\t *\r\n\t * @param field  Field name\r\n\t * @param value  Value\r\n\t * @return Parsed or original value\r\n\t */\r\n\tprotected maybeToNumber(field: string, value: any): any {\r\n\t\tif (this.options.numberFields.indexOf(field) !== -1) {\r\n\t\t\treturn $utils.anyToNumber(value);\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if there are any date fields that need to be converted to `Date`\r\n\t * objects.\r\n\t *\r\n\t * @return Date fields?\r\n\t */\r\n\tprotected get parsableDates(): boolean {\r\n\t\treturn this.options.dateFields && (this.options.dateFields.length > 0);\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a value to `Date` if it is in `dateFields`.\r\n\t *\r\n\t * @param field  Field name\r\n\t * @param value  Value\r\n\t * @return Parsed or original value\r\n\t */\r\n\tprotected maybeToDate(field: string, value: any): any {\r\n\t\tif (this.options.dateFields.indexOf(field) !== -1) {\r\n\t\t\treturn this.options.dateFormatter.parse(value, this.dateFormat);\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Replaces empty value with something else.\r\n\t *\r\n\t * @param value  Source value\r\n\t * @return Source value or replacement\r\n\t */\r\n\tprotected maybeToEmpty(value: any): any {\r\n\t\tif ((!$type.hasValue(value) || value == \"\") && $type.hasValue(this.options.emptyAs)) {\r\n\t\t\treturn this.options.emptyAs;\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * [[DateFormatter]] object for date parsing.\r\n\t *\r\n\t * If there was not [[DateFormatter]] supplied in parser options, a new one\r\n\t * is created.\r\n\t *\r\n\t * @return Date formatter\r\n\t * @see {@link DateFormatter}\r\n\t */\r\n\tprotected get dateFormatter(): DateFormatter {\r\n\t\tif (!this.options.dateFormatter) {\r\n\t\t\tthis.options.dateFormatter = new DateFormatter;\r\n\t\t\tif (this.options.dateFormat) {\r\n\t\t\t\tthis.options.dateFormat = this.options.dateFormat;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.options.dateFormatter;\r\n\t}\r\n\r\n\t/**\r\n\t * A date format to use when parsing dates.\r\n\t *\r\n\t * @return Date format\r\n\t * @see {@link DateFormatter}\r\n\t */\r\n\tprotected get dateFormat(): string {\r\n\t\treturn this.options.dateFormat || this.dateFormatter.inputDateFormat;\r\n\t}\r\n\r\n}\r\n","/**\r\n * JSON parser.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { DataParser, IDataParserOptions } from \"./DataParser\";\r\nimport { DateFormatter } from \"../formatters/DateFormatter\";\r\nimport * as $object from \"../utils/Object\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n\r\n/**\r\n * Defines options for JSON format parser\r\n */\r\nexport interface IJSONOptions extends IDataParserOptions {\r\n\r\n\t/**\r\n\t * A list of fields that should be treaded as numeric.\r\n\t *\r\n\t * Any information container in such fields will be converted to `number`.\r\n\t */\r\n\tnumberFields?: string[];\r\n\r\n\t/**\r\n\t * A list of fields that hold date/time infromation.\r\n\t *\r\n\t * Parser will try to convert such fields into `Date` objects.\r\n\t */\r\n\tdateFields?: string[];\r\n\r\n\t/**\r\n\t * A date formatted to be used when parsing dates.\r\n\t */\r\n\tdateFormatter?: DateFormatter;\r\n\r\n}\r\n\r\n/**\r\n * A parser for JSON.\r\n *\r\n * @important\r\n */\r\nexport class JSONParser extends DataParser {\r\n\r\n\t/**\r\n\t * Tests if the data is valid JSON.\r\n\t *\r\n\t * @param data  Source data\r\n\t * @return Is it JSON?\r\n\t */\r\n\tstatic isJSON(data: string): boolean {\r\n\t\ttry {\r\n\r\n\t\t\t// Try parsing JSON\r\n\t\t\tJSON.parse(data);\r\n\r\n\t\t\t// If we got to this point it means it's a valid JSON\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Content-type suitable for JSON format.\r\n\t */\r\n\tpublic contentType: string = \"application/json\";\r\n\r\n\t/**\r\n\t * Parser options.\r\n\t *\r\n\t * @see {@link IJSONOptions} for description of each option\r\n\t */\r\n\tpublic options: IJSONOptions = {};\r\n\r\n\t/**\r\n\t * Parses and returns data.\r\n\t *\r\n\t * @param data  Unparsed data\r\n\t * @return Parsed data\r\n\t */\r\n\tpublic parse(data: string): any {\r\n\r\n\t\t// Init return\r\n\t\tlet res: any;\r\n\r\n\t\t// Try parsing\r\n\t\ttry {\r\n\t\t\tif ($type.hasValue(JSON)) {\r\n\t\t\t\tres = JSON.parse(data);\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\t// Do we need to cast some fields to numbers or dates?\r\n\t\tlet empty = $type.hasValue(this.options.emptyAs);\r\n\t\tlet numbers = this.parsableNumbers;\r\n\t\tlet dates = this.parsableDates;\r\n\t\tif (Array.isArray(res) && (numbers || dates || empty)) {\r\n\r\n\t\t\t// Iterate through the data and check if it needs to be converted\r\n\t\t\tfor (let i = 0, len = res.length; i < len; i++) {\r\n\t\t\t\tlet row = res[i];\r\n\t\t\t\t$object.each(row, (key, value) => {\r\n\t\t\t\t\tif (empty) {\r\n\t\t\t\t\t\trow[key] = this.maybeToEmpty(row[key]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (numbers) {\r\n\t\t\t\t\t\trow[key] = this.maybeToNumber(key, row[key]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (dates) {\r\n\t\t\t\t\t\trow[key] = this.maybeToDate(key, row[key]);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Convert to array\r\n\t\t//return Array.isArray(res) ? res : [res];\r\n\t\treturn res;\r\n\r\n\t}\r\n\r\n}\r\n","/**\r\n * Polyspline (smoothed line) module.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Polyline, IPolylineProperties, IPolylineAdapters, IPolylineEvents } from \"./Polyline\";\r\nimport { IPoint, IOrientationPoint } from \"../../core/defs/IPoint\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $math from \"../../core/utils/Math\";\r\nimport * as $type from \"../../core/utils/Type\";\r\nimport * as $path from \"../../core/rendering/Path\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[Polyspline]].\r\n */\r\nexport interface IPolysplineProperties extends IPolylineProperties {\r\n\r\n\t/**\r\n\t * Horizontal tension for the spline.\r\n\t *\r\n\t * Used by the line smoothing algorithm.\r\n\t *\r\n\t * @default 0.5\r\n\t */\r\n\ttensionX: number;\r\n\r\n\t/**\r\n\t * Vertical tension for the spline.\r\n\t *\r\n\t * Used by the line smoothing algorithm.\r\n\t *\r\n\t * @default 0.5\r\n\t */\r\n\ttensionY: number;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[Polyspline]].\r\n */\r\nexport interface IPolysplineEvents extends IPolylineEvents { }\r\n\r\n/**\r\n * Defines adapters\r\n * Includes both the [[Adapter]] definitions and properties\r\n * @see {@link Adapter}\r\n */\r\nexport interface IPolysplineAdapters extends IPolylineAdapters, IPolysplineProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Draws a polysline. (smoothed multi-sigment line)\r\n *\r\n * @see {@link IPolysplineEvents} for a list of available events\r\n * @see {@link IPolysplineAdapters} for a list of available Adapters\r\n */\r\nexport class Polyspline extends Polyline {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tpublic _properties!: IPolysplineProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tpublic _adapter!: IPolysplineAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IPolysplineEvents;\r\n\r\n\t/**\r\n\t * Array of points of a spline with 1 px increment. used to get point by position\r\n\t */\r\n\tpublic allPoints: IOrientationPoint[];\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"Polyspline\";\r\n\r\n\t\tthis.tensionX = 0.5;\r\n\t\tthis.tensionY = 0.5;\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Creats and adds an SVG path for the arc.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic makePath(): void {\r\n\t\tthis._distance = 0;\r\n\t\tlet segments = this.segments;\r\n\r\n\t\tlet tensionX: number = this.tensionX;\r\n\t\tlet tensionY: number = this.tensionY;\r\n\r\n\t\tthis.allPoints = [];\r\n\r\n\t\tif (segments && segments.length > 0) {\r\n\t\t\tlet path: string = \"\";\r\n\t\t\tthis._realSegments = [];\r\n\r\n\t\t\tfor (let i = 0, len = segments.length; i < len; i++) {\r\n\t\t\t\tlet points: IPoint[] = segments[i];\r\n\t\t\t\tlet realPoints: IPoint[] = [];\r\n\t\t\t\tthis._realSegments.push(realPoints);\r\n\r\n\t\t\t\tif (points.length > 0) {\r\n\r\n\t\t\t\t\tlet first: IPoint = points[0];\r\n\t\t\t\t\tlet last: IPoint = points[points.length - 1];\r\n\r\n\t\t\t\t\tlet closed: boolean = false;\r\n\r\n\t\t\t\t\tif ($math.round(first.x, 3) == $math.round(last.x) && $math.round(first.y) == $math.round(last.y)) {\r\n\t\t\t\t\t\tclosed = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tpath += $path.moveTo(points[0]);\r\n\r\n\t\t\t\t\tfor (let p = 0; p < points.length - 1; p++) {\r\n\r\n\t\t\t\t\t\tlet p0: IPoint = points[p - 1];\r\n\r\n\t\t\t\t\t\tlet p1: IPoint = points[p];\r\n\r\n\t\t\t\t\t\tlet p2: IPoint = points[p + 1];\r\n\r\n\t\t\t\t\t\tlet p3: IPoint = points[p + 2];\r\n\r\n\t\t\t\t\t\tif (p === 0) {\r\n\t\t\t\t\t\t\tp0 = points[p];\r\n\t\t\t\t\t\t} else if (p == points.length - 2) {\r\n\t\t\t\t\t\t\tp3 = points[p + 1];\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!p3) {\r\n\t\t\t\t\t\t\tp3 = p2;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (p === 0) {\r\n\t\t\t\t\t\t\tif (closed) {\r\n\t\t\t\t\t\t\t\tp0 = points[points.length - 2];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tp0 = points[i];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (p == points.length - 2) {\r\n\t\t\t\t\t\t\tif (closed) {\r\n\t\t\t\t\t\t\t\tp3 = points[1];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tp3 = points[p + 1];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tlet controlPointA: IPoint = $math.getCubicControlPointA(p0, p1, p2, p3, tensionX, tensionY);\r\n\t\t\t\t\t\tlet controlPointB: IPoint = $math.getCubicControlPointB(p0, p1, p2, p3, tensionX, tensionY);\r\n\r\n\t\t\t\t\t\tpath += $path.cubicCurveTo(p2, controlPointA, controlPointB);\r\n\r\n\t\t\t\t\t\t// now split to small segments so that we could have positionToPoint later\r\n\t\t\t\t\t\tlet stepCount: number = Math.ceil($math.getCubicCurveDistance(p1, p2, controlPointA, controlPointB, 20)) * 1.2;\r\n\t\t\t\t\t\tlet prevPoint: IPoint = p1;\r\n\r\n\r\n\t\t\t\t\t\tif (stepCount > 0) {\r\n\r\n\t\t\t\t\t\t\t// not good for curved charts\r\n\t\t\t\t\t\t\t//this.allPoints[0] = { x: points[0].x, y: points[0].y, angle: $math.getAngle(points[0], points[1]) };\r\n\t\t\t\t\t\t\t//realPoints.push(this.allPoints[0]);\r\n\r\n\r\n\t\t\t\t\t\t\tfor (let s = 0; s <= stepCount; s++) {\r\n\r\n\t\t\t\t\t\t\t\tlet point = $math.getPointOnCubicCurve(p1, p2, controlPointA, controlPointB, s / stepCount);\r\n\r\n\t\t\t\t\t\t\t\tif (point.x == prevPoint.x && point.y == prevPoint.y) {\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\trealPoints.push(point);\r\n\r\n\t\t\t\t\t\t\t\tlet angle = $math.round($math.getAngle(prevPoint, point), 5);\r\n\r\n\t\t\t\t\t\t\t\t//this.allPoints.push({ x: point.x, y: point.y, angle: angle });\r\n\t\t\t\t\t\t\t\tthis._distance += $math.getDistance(prevPoint, point);\r\n\r\n\t\t\t\t\t\t\t\tthis.allPoints[Math.floor(this._distance)] = { x: point.x, y: point.y, angle: angle };\r\n\t\t\t\t\t\t\t\tprevPoint = point;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\trealPoints.push(p0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet allPoints = this.allPoints;\r\n\t\t\t\tif (allPoints.length > 1) {\r\n\t\t\t\t\tfor (let i = 0; i < allPoints.length; i++) {\r\n\t\t\t\t\t\tif (!allPoints[i]) {\r\n\t\t\t\t\t\t\tif (i > 1) {\r\n\t\t\t\t\t\t\t\tallPoints[i] = allPoints[i - 1];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tfor (let k = 1; k < allPoints.length; k++) {\r\n\t\t\t\t\t\t\t\t\tif (allPoints[k]) {\r\n\t\t\t\t\t\t\t\t\t\tallPoints[i] = allPoints[k];\r\n\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.path = path;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an index of the point that is closest to specified coordinates.\r\n\t * \r\n\t * @param   point  Reference point\r\n\t * @return         Index\r\n\t */\r\n\tpublic getClosestPointIndex(point: IPoint): number {\r\n\t\tlet points = this.allPoints;\r\n\r\n\t\tlet index: number;\r\n\r\n\t\tlet closest: number = Infinity;\r\n\t\tif (points.length > 1) {\r\n\t\t\tfor (let p = 1; p < points.length; p++) {\r\n\t\t\t\tlet distance = $math.getDistance(point, points[p]);\r\n\t\t\t\tif (distance < closest) {\r\n\t\t\t\t\tindex = p;\r\n\t\t\t\t\tclosest = distance;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn index;\r\n\t}\r\n\r\n\t/**\r\n\t * Horizontal tension for the spline.\r\n\t *\r\n\t * Used by the line smoothing algorithm.\r\n\t *\r\n\t * @default 0.5\r\n\t * @param value  Tension\r\n\t */\r\n\tpublic set tensionX(value: number) {\r\n\t\tthis.setPropertyValue(\"tensionX\", value);\r\n\t\tthis.makePath();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tension\r\n\t */\r\n\tpublic get tensionX(): number {\r\n\t\treturn this.getPropertyValue(\"tensionX\");\r\n\t}\r\n\r\n\t/**\r\n\t * Vertical tension for the spline.\r\n\t *\r\n\t * Used by the line smoothing algorithm.\r\n\t *\r\n\t * @default 0.5\r\n\t * @param value  Tensions\r\n\t */\r\n\tpublic set tensionY(value: number) {\r\n\t\tthis.setPropertyValue(\"tensionY\", value, true);\r\n\t\tthis.makePath();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tension\r\n\t */\r\n\tpublic get tensionY(): number {\r\n\t\treturn this.getPropertyValue(\"tensionY\");\r\n\t}\r\n\r\n\t/**\r\n\t * Converts relative position along the line (0-1) into pixel coordinates.\r\n\t *\r\n\t * @param position  Position (0-1)\r\n\t * @return Coordinates\r\n\t */\r\n\r\n\tpublic positionToPoint(position: number, extend?: boolean): IOrientationPoint {\r\n\r\n\t\tlet deltaAngle: number = 0;\r\n\r\n\t\tlet allPoints = this.allPoints;\r\n\t\tlet len = allPoints.length;\r\n\r\n\t\tif (!$type.isNumber(position)) {\r\n\t\t\tposition = 0;\r\n\t\t}\r\n\r\n\t\tif (len > 1) {\r\n\r\n\t\t\tif (extend && len > 3) {\r\n\t\t\t\tif (position < 0) {\r\n\r\n\t\t\t\t\tif (position < -0.01) {\r\n\t\t\t\t\t\tposition = -0.01;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet f0 = allPoints[0];\r\n\t\t\t\t\tlet f1 = allPoints[1];\r\n\r\n\t\t\t\t\tlet x = f0.x - (f0.x - f1.x) * len * position;\r\n\t\t\t\t\tlet y = f0.y - (f0.y - f1.y) * len * position;\r\n\r\n\t\t\t\t\treturn { x: x, y: y, angle: $math.getAngle(f0, f1) };\r\n\t\t\t\t}\r\n\t\t\t\telse if (position > 1) {\r\n\r\n\t\t\t\t\tif (position > 1.01) {\r\n\t\t\t\t\t\tposition = 1.01;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet f0 = allPoints[allPoints.length - 2];\r\n\t\t\t\t\tlet f1 = allPoints[allPoints.length - 3];\r\n\r\n\t\t\t\t\tlet x = f0.x + (f0.x - f1.x) * len * (position - 1);\r\n\t\t\t\t\tlet y = f0.y + (f0.y - f1.y) * len * (position - 1);\r\n\r\n\t\t\t\t\treturn { x: x, y: y, angle: $math.getAngle(f0, { x: x, y: y }) };\r\n\t\t\t\t}\r\n\t\t\t\telse if (position == 1) {\r\n\t\t\t\t\tlet point = allPoints[allPoints.length - 1]\r\n\t\t\t\t\treturn { x: point.x, y: point.y, angle: point.angle };\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (position < 0) {\r\n\t\t\t\t\tposition = Math.abs(position);\r\n\t\t\t\t\tdeltaAngle = 180;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (position >= 1) {\r\n\t\t\t\t\tposition = 0.9999999999999;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t\tlet point = allPoints[Math.floor(position * len)];\r\n\t\t\treturn { x: point.x, y: point.y, angle: point.angle + deltaAngle };\r\n\t\t}\r\n\t\telse if (len == 1) {\r\n\t\t\tlet point = allPoints[0];\r\n\t\t\treturn { x: point.x, y: point.y, angle: point.angle };\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn { x: 0, y: 0, angle: 0 };\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Polyspline\"] = Polyspline;\r\n","/**\r\n * Provides functionality used to build scrollbars.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\nimport { Container, IContainerProperties, IContainerAdapters, IContainerEvents } from \"../Container\";\r\nimport { IRange } from \"../defs/IRange\";\r\nimport { Sprite, ISpriteEvents, AMEvent } from \"../Sprite\";\r\nimport { Orientation } from \"../defs/Orientation\";\r\nimport { ResizeButton } from \"../elements/ResizeButton\";\r\nimport { Button } from \"../elements/Button\";\r\nimport { getInteraction } from \"../interaction/Interaction\";\r\nimport { MouseCursorStyle } from \"../interaction/Mouse\";\r\nimport { RoundedRectangle } from \"../elements/RoundedRectangle\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { Animation } from \"../utils/Animation\";\r\nimport { IDisposer } from \"../utils/Disposer\";\r\nimport { registry } from \"../Registry\";\r\nimport { keyboard } from \"../utils/Keyboard\";\r\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\r\nimport { percent, Percent } from \"../utils/Percent\";\r\nimport * as $math from \"../utils/Math\";\r\nimport * as $ease from \"../utils/Ease\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $utils from \"../utils/Utils\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[Scrollbar]].\r\n */\r\nexport interface IScrollbarProperties extends IContainerProperties {\r\n\r\n\t/**\r\n\t * Duration in milliseconds of Scrollbar animation.\r\n\t *\r\n\t * This affects how fast Scrollbar elements move/resize. For example when\r\n\t * chart zooms or pans, Scrollbar elements' positions need to be adjusted\r\n\t * as well. This setting will affect whether they will be relocated\r\n\t * instantenously (0), or will animte gradually.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/animations/} for more info about animations\r\n\t */\r\n\tanimationDuration?: number;\r\n\r\n\t/**\r\n\t * An easing function to use when animating (moving/sizing) Scrollbar\r\n\t * elements.\r\n\t */\r\n\tanimationEasing?: (value: number) => number;\r\n\r\n\t/**\r\n\t * Orientation of a scrollbar\r\n\t */\r\n\torientation?: Orientation;\r\n}\r\n\r\n/**\r\n * Defines events for [[Scrollbar]].\r\n */\r\nexport interface IScrollbarEvents extends IContainerEvents {\r\n\r\n\t/**\r\n\t * Invoked when range of scrollbar selection changes.\r\n\t */\r\n\trangechanged: {};\r\n\r\n}\r\n\r\n/**\r\n * Defines adapters for [[Scrollbar]].\r\n */\r\nexport interface IScrollbarAdapters extends IContainerAdapters, IScrollbarProperties {\r\n\r\n\t/**\r\n\t * Applied to a position value when it is retrieved.\r\n\t */\r\n\tpositionValue: {\r\n\t\tvalue: any,\r\n\t\tposition: number\r\n\t}\r\n\r\n};\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Scrollbar is a generic control allowing to select a range of values or pan\r\n * the selection.\r\n *\r\n * @see {@link IScrollbarEvents} for a list of available events\r\n * @see {@link IScrollbarAdapters} for a list of available Adapters\r\n */\r\nexport class Scrollbar extends Container {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IScrollbarProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IScrollbarAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IScrollbarEvents;\r\n\r\n\t/**\r\n\t * Holds a reference to a draggable rectangle that fills the space between\r\n\t * two selection grips. It can be used to pan the selection maintaining the\r\n\t * distance between start and end grips.\r\n\t */\r\n\tprotected _thumb: $type.Optional<Button>;\r\n\r\n\t/**\r\n\t * Orientation of the scrollbar.\r\n\t */\r\n\tprotected _orientation: Orientation;\r\n\r\n\t/**\r\n\t * A button (grip) instance to be used to select lower range value.\r\n\t */\r\n\tprotected _startGrip!: ResizeButton;\r\n\r\n\t/**\r\n\t * A button (grip) instance to be used to select upper range value.\r\n\t */\r\n\tprotected _endGrip!: ResizeButton;\r\n\r\n\t/**\r\n\t * Currently selected lower (start) value.\r\n\t */\r\n\tprotected _start!: number;\r\n\r\n\t/**\r\n\t * Currently selected upper (end) value.\r\n\t */\r\n\tprotected _end!: number;\r\n\r\n\t/**\r\n\t * Previously selected lower (start) value.\r\n\t */\r\n\tprotected _previousStart: $type.Optional<number> = 0;\r\n\r\n\t/**\r\n\t * Previously selected upper (end) value.\r\n\t */\r\n\tprotected _previousEnd: $type.Optional<number> = 1;\r\n\r\n\t/**\r\n\t * An [[Animation]] instance that moves \"thumb\".\r\n\t */\r\n\tprotected _thumbAnimation: $type.Optional<Animation>;\r\n\r\n\t/**\r\n\t * An [[Animation]] instance that moves zoom grip buttons.\r\n\t */\r\n\tprotected _zoomAnimation: $type.Optional<Animation>;\r\n\r\n\t/**\r\n\t * A value of previously selected lower value, used for doubleclick function.\r\n\t */\r\n\tprotected _prevStart: number = 0;\r\n\r\n\t/**\r\n\t * A value of previously selected upper value, used for doubleclick function.\r\n\t */\r\n\tprotected _prevEnd: number = 1;\r\n\r\n\t/**\r\n\t * Indicates if the Scrollbar is currently \"busy\" (animating and or\r\n\t * performing zoom by user interaction).\r\n\t */\r\n\tprotected _isBusy: boolean = false;\r\n\r\n\t/**\r\n\t * [_skipRangeEvents description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _skipRangeEvents: boolean = false;\r\n\r\n\t/**\r\n\t * Holds timeout reference that resets \"busy\" status.\r\n\t */\r\n\tprotected _unbusyTimeout: $type.Optional<IDisposer>;\r\n\r\n\t/**\r\n\t * [undefined description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _usingGrip: \"start\" | \"end\" | undefined;\r\n\r\n\t/**\r\n\t * Sets the type of the element to use as background.\r\n\t */\r\n\tpublic _background: RoundedRectangle;\r\n\r\n\t/**\r\n\t * Hide grips when not hovered over scrollbar?\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tprotected _hideGrips!: boolean;\r\n\r\n\t/**\r\n\t * A disposer for the hover event.\r\n\t */\r\n\tprotected _overDisposer: $type.Optional<IDisposer>;\r\n\r\n\t/**\r\n\t * A disposer for the out event.\r\n\t */\r\n\tprotected _outDisposer: $type.Optional<IDisposer>;\r\n\r\n\t/**\r\n\t * Update the selection when dragging the grips.\r\n\t *\r\n\t * If set to `false` selection will be updated only when the grip is\r\n\t * released.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tpublic updateWhileMoving: boolean = true;\r\n\r\n\t/**\r\n\t * Construtor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.className = \"Scrollbar\";\r\n\r\n\t\tthis.minHeight = 12;\r\n\t\tthis.minWidth = 12;\r\n\r\n\t\tthis.animationDuration = 0;\r\n\t\tthis.animationEasing = $ease.cubicOut;\r\n\r\n\t\tthis.margin(10, 10, 10, 10);\r\n\r\n\t\tlet interfaceColors = new InterfaceColorSet();\r\n\r\n\t\t// background is also container as it might contain graphs, grid, etc\r\n\t\tlet background: RoundedRectangle = this.background;\r\n\t\tbackground.cornerRadius(10, 10, 10, 10);\r\n\t\tbackground.fill = interfaceColors.getFor(\"fill\");\r\n\t\tbackground.fillOpacity = 0.5;\r\n\r\n\t\t// Make system tooltips appear by default\r\n\t\tthis.showSystemTooltip = true;\r\n\r\n\t\tthis.startGrip = new ResizeButton();\r\n\t\tthis.endGrip = new ResizeButton();\r\n\r\n\t\t// Default orientation...\r\n\t\t// ... is set in `applyInternalDefaults()` because it accesses `language`\r\n\t\t// and should only be started to access when parent is set\r\n\r\n\t\t// Set events\r\n\t\tthis.events.on(\"transformed\", this.updateThumb, this, false);\r\n\r\n\t\t// Initial positions\r\n\t\tthis.start = 0;\r\n\t\tthis.end = 1;\r\n\r\n\t\t// Set roles\r\n\t\tthis.role = \"scrollbar\";\r\n\t\tthis.thumb.role = \"slider\";\r\n\t\tthis.thumb.readerLive = \"polite\";\r\n\t\tthis.startGrip.role = \"slider\";\r\n\t\tthis.endGrip.role = \"slider\";\r\n\r\n\t\t// otherwise range changed won't be registered\r\n\t\tthis.events.once(\"inited\", () => {\r\n\t\t\tthis._previousStart = undefined;\r\n\t\t\tthis.dispatchRangeChange();\r\n\t\t}, undefined, false)\r\n\r\n\r\n\t\tthis.hideGrips = false;\r\n\r\n\t\tthis.orientation = \"horizontal\";\r\n\r\n\t\t// Min/max values for accessibility\r\n\t\tthis.setSVGAttribute({ \"aria-valuemin\": \"0\" });\r\n\t\tthis.setSVGAttribute({ \"aria-valuemax\": \"100\" });\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets defaults that instantiate some objects that rely on parent, so they\r\n\t * cannot be set in constructor.\r\n\t */\r\n\tprotected applyInternalDefaults(): void {\r\n\t\tsuper.applyInternalDefaults();\r\n\r\n\t\t// Set screen reader tetxt accordingly\r\n\t\tif (this.orientation === \"horizontal\") {\r\n\t\t\tif (!$type.hasValue(this.readerTitle)) {\r\n\t\t\t\tthis.readerTitle = this.language.translate(\"Use TAB to select grip buttons or left and right arrows to change selection\");\r\n\t\t\t}\r\n\t\t\tif (!$type.hasValue(this.thumb.readerDescription)) {\r\n\t\t\t\tthis.thumb.readerDescription = this.language.translate(\"Use left and right arrows to move selection\");\r\n\t\t\t}\r\n\t\t\tif (!$type.hasValue(this.startGrip.readerDescription)) {\r\n\t\t\t\tthis.startGrip.readerDescription = this.language.translate(\"Use left and right arrows to move left selection\");\r\n\t\t\t}\r\n\t\t\tif (!$type.hasValue(this.endGrip.readerDescription)) {\r\n\t\t\t\tthis.endGrip.readerDescription = this.language.translate(\"Use left and right arrows to move right selection\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.readerOrientation = \"horizontal\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (!$type.hasValue(this.readerTitle)) {\r\n\t\t\t\tthis.readerTitle = this.language.translate(\"Use TAB select grip buttons or up and down arrows to change selection\");\r\n\t\t\t}\r\n\t\t\tif (!$type.hasValue(this.thumb.readerDescription)) {\r\n\t\t\t\tthis.thumb.readerDescription = this.language.translate(\"Use up and down arrows to move selection\");\r\n\t\t\t}\r\n\t\t\tif (!$type.hasValue(this.startGrip.readerDescription)) {\r\n\t\t\t\tthis.startGrip.readerDescription = this.language.translate(\"Use up and down arrows to move upper selection\");\r\n\t\t\t}\r\n\t\t\tif (!$type.hasValue(this.endGrip.readerDescription)) {\r\n\t\t\t\tthis.endGrip.readerDescription = this.language.translate(\"Use up and down arrows to move lower selection\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.readerOrientation = \"vertical\";\r\n\t\t}\r\n\r\n\t\tthis.readerControls = this.baseSprite.uidAttr();\r\n\t}\r\n\r\n\t/**\r\n\t * Validates the layout of the scrollbar's elements.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validateLayout(): void {\r\n\t\tthis.updateSize();\r\n\t\tsuper.validateLayout();\r\n\r\n\t\t// when size changes, need to update extremes\r\n\t\tthis.updateExtremes();\r\n\t}\r\n\r\n\t/**\r\n\t * Update background for the scrollbar.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic processBackground(): void {\r\n\t\tsuper.processBackground();\r\n\t\tlet background = this.background;\r\n\r\n\t\tbackground.clickable = true;\r\n\t\tbackground.events.on(\"hit\", this.handleBgHit, this, undefined);\r\n\t}\r\n\r\n\t/**\r\n\t * Zooms to the particular place when clicked/tapped on the scrollbar\r\n\t * background.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param event  Event\r\n\t */\r\n\tpublic handleBgHit(event: ISpriteEvents[\"hit\"]): void {\r\n\t\tthis.makeBusy();\r\n\t\tlet point: IPoint = event.spritePoint;\r\n\t\tpoint = $utils.spritePointToSprite(point, this.background, this);\r\n\t\tlet thumb: Sprite = this.thumb;\r\n\t\tif (this.orientation == \"horizontal\") {\r\n\t\t\tlet thumbX: number = point.x - thumb.pixelWidth / 2;\r\n\t\t\tthumbX = $math.fitToRange(thumbX, 0, this.innerWidth - thumb.pixelWidth);\r\n\t\t\tthis._thumbAnimation = thumb.animate({ property: \"x\", to: thumbX }, this.animationDuration, this.animationEasing);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet thumbY: number = point.y - thumb.pixelHeight / 2;\r\n\t\t\tthumbY = $math.fitToRange(thumbY, 0, this.innerHeight - thumb.pixelHeight);\r\n\t\t\tthis._thumbAnimation = thumb.animate({ property: \"y\", to: thumbY }, this.animationDuration, this.animationEasing);\r\n\t\t}\r\n\t\tif (this.animationDuration > 0) {\r\n\t\t\tthis._thumbAnimation.events.on(\"animationended\", this.makeUnbusy, this, false);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._thumb.validate();\r\n\t\t\tthis.makeUnbusy();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Set scrollbar as busy. (currently zooming)\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic makeBusy(): void {\r\n\t\tthis._isBusy = true;\r\n\t\tthis._skipRangeEvents = false;\r\n\t\tif (this._unbusyTimeout) {\r\n\t\t\tthis.removeDispose(this._unbusyTimeout);\r\n\t\t}\r\n\t\tthis._unbusyTimeout = undefined;\r\n\t\tthis.stopAnimations();\r\n\t}\r\n\r\n\t/**\r\n\t * Stops all animations, currently playing for the scrollbar.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic stopAnimations(): void {\r\n\t\tif (this._thumbAnimation) {\r\n\t\t\tthis._thumbAnimation.stop(true);\r\n\t\t}\r\n\t\tif (this._zoomAnimation) {\r\n\t\t\tthis._zoomAnimation.stop(true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Cancels \"busy\" status of the Scrollbar.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic makeUnbusy(): void {\r\n\t\t/**\r\n\t\t * We cannot make Scrollbar not busy right after release, because then axes\r\n\t\t * will take over controll and Scrollbar will start to animate.\r\n\t\t * Theorethically, it's not right to set timeout by `animationDuration`,\r\n\t\t * however we can not know all the durations of elements we scroll, so we\r\n\t\t * assume that animation duration will be the same as\r\n\t\t * `interpolationDuration` or `rangeChange` duration.\r\n\t\t */\r\n\t\tthis._unbusyTimeout = this.setTimeout(this.makeUnbusyReal.bind(this), this.animationDuration * 1.1);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * [makeUnbusyReal description]\r\n\t *\r\n\t * @todo Description\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic makeUnbusyReal(): void {\r\n\t\tthis._usingGrip = undefined;\r\n\t\tthis._isBusy = false;\r\n\t\tif (!this.updateWhileMoving) {\r\n\t\t\tthis.dispatchRangeChange();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Disptatches rangechanged event if it really changed\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected dispatchRangeChange() {\r\n\t\tif (this._previousEnd != this.end || this._previousStart != this.start) {\r\n\t\t\tthis._previousStart = this.start;\r\n\t\t\tthis._previousEnd = this.end;\r\n\t\t\tthis.dispatch(\"rangechanged\");\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Updates the \"thumb\" element. A draggable element between the grips.\r\n\t */\r\n\tprotected updateThumb(): void {\r\n\r\n\t\tif (!this.parent) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet thumb: Sprite = this.thumb;\r\n\r\n\t\tlet start: number = this.start;\r\n\t\tlet end: number = this.end;\r\n\r\n\t\tlet startGrip: ResizeButton = this.startGrip;\r\n\t\tlet endGrip: ResizeButton = this.endGrip;\r\n\r\n\t\tif (this.orientation == \"horizontal\") {\r\n\r\n\t\t\tlet innerWidth: number = this.innerWidth;\r\n\r\n\t\t\tthumb.width = innerWidth * (end - start);\r\n\t\t\tthumb.maxX = innerWidth - thumb.pixelWidth;\r\n\t\t\tthumb.x = start * innerWidth;\r\n\r\n\t\t\tstartGrip.moveTo({ x: thumb.pixelX, y: 0 }, undefined, undefined, true); // overrides dragging\r\n\t\t\tendGrip.moveTo({ x: thumb.pixelX + thumb.pixelWidth, y: 0 }, undefined, undefined, true);\r\n\r\n\t\t\tstartGrip.readerTitle = this.language.translate(\r\n\t\t\t\t\"From %1\",\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.adapter.apply(\"positionValue\", {\r\n\t\t\t\t\tvalue: Math.round(start * 100) + \"%\",\r\n\t\t\t\t\tposition: start\r\n\t\t\t\t}).value\r\n\t\t\t);\r\n\t\t\tstartGrip.readerValueNow = \"\" + Math.round(start * 100);\r\n\t\t\tstartGrip.readerValueText = startGrip.readerTitle;\r\n\r\n\t\t\tendGrip.readerTitle = this.language.translate(\r\n\t\t\t\t\"To %1\",\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.adapter.apply(\"positionValue\", {\r\n\t\t\t\t\tvalue: Math.round(end * 100) + \"%\",\r\n\t\t\t\t\tposition: end\r\n\t\t\t\t}).value\r\n\t\t\t);\r\n\t\t\tendGrip.readerValueNow = \"\" + Math.round(end * 100);\r\n\t\t\tendGrip.readerValueText = endGrip.readerTitle;\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet innerHeight: number = this.innerHeight;\r\n\r\n\t\t\tthumb.height = innerHeight * (end - start);\r\n\t\t\tthumb.maxY = innerHeight - thumb.pixelHeight;\r\n\t\t\tthumb.y = (1 - end) * innerHeight;\r\n\r\n\t\t\tstartGrip.moveTo({ x: 0, y: thumb.pixelY + thumb.pixelHeight }, undefined, undefined, true);\r\n\t\t\tendGrip.moveTo({ x: 0, y: thumb.pixelY }, undefined, undefined, true);\r\n\r\n\t\t\tstartGrip.readerTitle = this.language.translate(\r\n\t\t\t\t\"To %1\",\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.adapter.apply(\"positionValue\", {\r\n\t\t\t\t\tvalue: Math.round((1 - start) * 100) + \"%\",\r\n\t\t\t\t\tposition: (1 - start)\r\n\t\t\t\t}).value\r\n\t\t\t);\r\n\t\t\tstartGrip.readerValueNow = \"\" + Math.round(start * 100);\r\n\t\t\tstartGrip.readerValueText = startGrip.readerTitle;\r\n\r\n\t\t\tendGrip.readerTitle = this.language.translate(\r\n\t\t\t\t\"From %1\",\r\n\t\t\t\tundefined,\r\n\t\t\t\tthis.adapter.apply(\"positionValue\", {\r\n\t\t\t\t\tvalue: Math.round((1 - end) * 100) + \"%\",\r\n\t\t\t\t\tposition: (1 - end)\r\n\t\t\t\t}).value\r\n\t\t\t);\r\n\t\t\tendGrip.readerValueNow = \"\" + Math.round(end * 100);\r\n\t\t\tendGrip.readerValueText = endGrip.readerTitle;\r\n\t\t}\r\n\r\n\t\t// Add accessibility\r\n\t\tthumb.readerTitle = this.language.translate(\r\n\t\t\t\"From %1 to %2\",\r\n\t\t\tundefined,\r\n\t\t\tthis.adapter.apply(\"positionValue\", {\r\n\t\t\t\tvalue: Math.round(start * 100) + \"%\",\r\n\t\t\t\tposition: start\r\n\t\t\t}).value,\r\n\t\t\tthis.adapter.apply(\"positionValue\", {\r\n\t\t\t\tvalue: Math.round(end * 100) + \"%\",\r\n\t\t\t\tposition: end\r\n\t\t\t}).value\r\n\t\t);\r\n\r\n\t\tthumb.readerValueNow = \"\" + Math.round(start * 100);\r\n\t\tthumb.readerValueText = thumb.readerTitle;\r\n\r\n\t\tthis.readerValueNow = \"\" + Math.round(start * 100);\r\n\t\tthis.readerValueText = thumb.readerTitle;\r\n\r\n\t\tif (!this._skipRangeEvents && this.updateWhileMoving) {\r\n\t\t\tthis.dispatchRangeChange();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates extremes of the scrollbar.\r\n\t */\r\n\tprotected updateExtremes(): void {\r\n\t\tlet orientation = this.orientation;\r\n\t\tlet minX: number = 0;\r\n\t\tlet minY: number = 0;\r\n\t\tlet maxX: number = 0;\r\n\t\tlet maxY: number = 0;\r\n\r\n\t\tif (orientation == \"horizontal\") {\r\n\t\t\tmaxX = this.innerWidth;\r\n\t\t\tminY = maxY = this.innerHeight / 2;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tmaxY = this.innerHeight;\r\n\t\t\tminX = maxX = this.innerWidth / 2;\r\n\t\t}\r\n\r\n\t\tlet startGrip: ResizeButton = this.startGrip;\r\n\t\tstartGrip.minX = minX;\r\n\t\tstartGrip.maxX = maxX;\r\n\t\tstartGrip.minY = minY;\r\n\t\tstartGrip.maxY = maxY;\r\n\r\n\t\tlet endGrip: ResizeButton = this.endGrip;\r\n\t\tendGrip.minX = minX;\r\n\t\tendGrip.maxX = maxX;\r\n\t\tendGrip.minY = minY;\r\n\t\tendGrip.maxY = maxY;\r\n\r\n\t\tlet thumb = this.thumb;\r\n\t\tthumb.minX = minX;\r\n\t\tthumb.maxX = maxX;\r\n\t\tthumb.minY = minY;\r\n\t\tthumb.maxY = maxY;\r\n\t}\r\n\r\n\t/**\r\n\t * Updates size of the scrollbar.\r\n\t */\r\n\tprotected updateSize(): void {\r\n\t\tlet orientation = this.orientation;\r\n\r\n\t\tlet startGrip = this.startGrip;\r\n\t\tif (startGrip) {\r\n\t\t\tstartGrip.orientation = orientation;\r\n\t\t}\r\n\t\tif (this.endGrip) {\r\n\t\t\tthis.endGrip.orientation = orientation;\r\n\t\t}\r\n\r\n\t\tlet thumb: Sprite = this.thumb;\r\n\t\tif (thumb) {\r\n\t\t\tif (orientation == \"horizontal\") {\r\n\t\t\t\tif (!$type.isNumber(this._pixelWidth)) {\r\n\t\t\t\t\tif (!(this.width instanceof Percent)) {\r\n\t\t\t\t\t\tthis.width = percent(100);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// this teorethically might be wrong, if user indeed sets height of a horizontal scrollbar in percent\r\n\t\t\t\t// however without this height might be equal to 100% if previous orientation was set to horizontal\r\n\t\t\t\t// so this is ok solution, in case user really wants to have scrollbar height set in percent,\r\n\t\t\t\t// he should do this after orientation.\r\n\t\t\t\tif ($type.hasValue(this.percentHeight)) {\r\n\t\t\t\t\tthis.height = this.minHeight;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthumb.height = this.innerHeight;\r\n\r\n\t\t\t\tthumb.verticalCenter = \"middle\";\r\n\t\t\t\tthumb.horizontalCenter = \"left\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (!$type.isNumber(this._pixelHeight)) {\r\n\t\t\t\t\tif (!(this.height instanceof Percent)) {\r\n\t\t\t\t\t\tthis.height = percent(100);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// same as above with percentHeight\r\n\t\t\t\tif ($type.hasValue(this.percentWidth)) {\r\n\t\t\t\t\tthis.width = this.minWidth;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthumb.width = this.innerWidth;\r\n\t\t\t\tthumb.verticalCenter = \"top\";\r\n\t\t\t\tthumb.horizontalCenter = \"middle\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if the Scrollbar is currently \"busy\" (animating and or\r\n\t * performing zoom by user interaction).\r\n\t * @return boolean\r\n\t */\r\n\tpublic get isBusy():boolean{\r\n\t\treturn this._isBusy;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * POSITIONS\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Relative position (0-1) of the start grip.\r\n\t *\r\n\t * @param position  Position (0-1)\r\n\t */\r\n\tpublic set start(position: number) {\r\n\t\tif (!this._isBusy) {\r\n\t\t\tthis.__start = position;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Position (0-1)\r\n\t */\r\n\tpublic get start(): number {\r\n\t\treturn Math.min(this.getPosition(this._start), this.getPosition(this._end));\r\n\t}\r\n\r\n\t/**\r\n\t * [__start description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param position [description]\r\n\t */\r\n\tprotected set __start(position: number) {\r\n\t\tthis._start = this.getPosition(position);\r\n\t\tthis.updateThumb();\r\n\t}\r\n\r\n\t/**\r\n\t * @return [description]\r\n\t */\r\n\tprotected get __start(): number {\r\n\t\treturn this._start;\r\n\t}\r\n\r\n\t/**\r\n\t * Relative position (0-1) of the end grip.\r\n\t *\r\n\t * @param position  Position (0-1)\r\n\t */\r\n\tpublic set end(position: number) {\r\n\t\tif (!this._isBusy) {\r\n\t\t\tthis.__end = position;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Position (0-1)\r\n\t */\r\n\tpublic get end(): number {\r\n\t\treturn Math.max(this.getPosition(this._start), this.getPosition(this._end));\r\n\t}\r\n\r\n\t/**\r\n\t * [__end description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param position [description]\r\n\t */\r\n\tprotected set __end(position: number) {\r\n\t\tthis._end = this.getPosition(position);\r\n\t\tthis.updateThumb();\r\n\t}\r\n\r\n\t/**\r\n\t * @return [description]\r\n\t */\r\n\tprotected get __end(): number {\r\n\t\treturn this._end;\r\n\t}\r\n\r\n\t/**\r\n\t * Current selection range.\r\n\t *\r\n\t * @readonly\r\n\t * @return Range\r\n\t */\r\n\tpublic get range(): IRange {\r\n\t\treturn { start: this.start, end: this.end, priority: this._usingGrip };\r\n\t}\r\n\r\n\t/**\r\n\t * Disables range change events.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic skipRangeEvents(): void {\r\n\t\tif (!this._isBusy) {\r\n\t\t\tthis._skipRangeEvents = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [fixRange description]\r\n\t *\r\n\t * @todo Description\r\n\t * @ignore Exclude from docs\r\n\t * @param range  Range\r\n\t */\r\n\tpublic fixRange(range: IRange): void {\r\n\t\tif (range.start != $math.round(this._start, 2) || range.end != $math.round(this._end, 2)) {\r\n\t\t\tthis._start = range.start;\r\n\t\t\tthis._end = range.end;\r\n\r\n\t\t\tthis._skipRangeEvents = true;\r\n\t\t\tthis.updateThumb();\r\n\t\t\tthis._skipRangeEvents = false;\r\n\t\t\tthis.thumb.validate();\r\n\t\t\tthis.thumb.background.validate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [getPosition description]\r\n\t *\r\n\t * @todo Description\r\n\t * @param position  [description]\r\n\t * @return [description]\r\n\t */\r\n\tprotected getPosition(position: number): number {\r\n\t\treturn $math.fitToRange($math.round(position, 4), 0, 1);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * MISC\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Orientation of the scrollbar.\r\n\t *\r\n\t * Available options: \"horizontal\" (default) and \"vertical\".\r\n\t *\r\n\t * @default \"horizontal\"\r\n\t * @param value  Orientation\r\n\t */\r\n\tpublic set orientation(value: Orientation) {\r\n\r\n\t\tif (this.setPropertyValue(\"orientation\", value)) {\r\n\r\n\t\t\t// Set mouse cursors and screen reader tetxt accordingly\r\n\t\t\tif (value === \"horizontal\") {\r\n\r\n\t\t\t\t// Mouse styles\r\n\t\t\t\tthis.startGrip.cursorOverStyle = MouseCursorStyle.horizontalResize;\r\n\t\t\t\tthis.endGrip.cursorOverStyle = MouseCursorStyle.horizontalResize;\r\n\r\n\t\t\t\t// Reader text\r\n\t\t\t\t/*this.readerTitle = this.language.translate(\"Use TAB to select grip buttons or left and right arrows to change selection\");\r\n\t\t\t\tthis.thumb.readerDescription = this.language.translate(\"Use left and right arrows to move selection\");\r\n\t\t\t\tthis.startGrip.readerDescription = this.language.translate(\"Use left and right arrows to move left selection\");\r\n\t\t\t\tthis.endGrip.readerDescription = this.language.translate(\"Use left and right arrows to move right selection\");*/\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\r\n\t\t\t\t// Mouse styles\r\n\t\t\t\tthis.startGrip.cursorOverStyle = MouseCursorStyle.verticalResize;\r\n\t\t\t\tthis.endGrip.cursorOverStyle = MouseCursorStyle.verticalResize;\r\n\r\n\t\t\t\t// Reader text\r\n\t\t\t\t/*this.readerTitle = this.language.translate(\"Use TAB select grip buttons or up and down arrows to change selection\");\r\n\t\t\t\tthis.thumb.readerDescription = this.language.translate(\"Use up and down arrows to move selection\");\r\n\t\t\t\tthis.startGrip.readerDescription = this.language.translate(\"Use up and down arrows to move upper selection\");\r\n\t\t\t\tthis.endGrip.readerDescription = this.language.translate(\"Use up and down arrows to move lower selection\");*/\r\n\r\n\t\t\t}\r\n\t\t\tthis.updateByOrientation();\r\n\t\t\tthis.invalidate();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected updateByOrientation() {\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @return Orientation\r\n\t */\r\n\tpublic get orientation(): Orientation {\r\n\t\treturn this.getPropertyValue(\"orientation\");\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * GRIPS\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Start grip element. (button)\r\n\t *\r\n\t * @param button  Grip element\r\n\t */\r\n\tpublic set startGrip(button: ResizeButton) {\r\n\t\tif (this._startGrip) {\r\n\t\t\tthis.removeDispose(this._startGrip);\r\n\t\t}\r\n\t\tthis._startGrip = button;\r\n\t\tthis.processGrip(button);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Grip element\r\n\t */\r\n\tpublic get startGrip(): ResizeButton {\r\n\t\treturn this._startGrip;\r\n\t}\r\n\r\n\t/**\r\n\t * End grip element. (button)\r\n\t *\r\n\t * @param button  Grip element\r\n\t */\r\n\tpublic set endGrip(button: ResizeButton) {\r\n\t\tif (this._endGrip) {\r\n\t\t\tthis.removeDispose(this._endGrip);\r\n\t\t}\r\n\t\tthis._endGrip = button;\r\n\t\tthis.processGrip(button);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Grip element\r\n\t */\r\n\tpublic get endGrip(): ResizeButton {\r\n\t\treturn this._endGrip;\r\n\t}\r\n\r\n\t/**\r\n\t * Decorates the grip button with properties and events.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param button Grip button\r\n\t */\r\n\tpublic processGrip(button: ResizeButton) {\r\n\t\tbutton.parent = this;\r\n\t\tbutton.isMeasured = false;\r\n\t\tbutton.focusable = true;\r\n\t\tbutton.shouldClone = false;\r\n\r\n\t\t// Set button defaults\r\n\t\t//button.showSystemTooltip = true; // setting this here is not right because we break inheritance\r\n\t\tbutton.zIndex = 100;\r\n\r\n\t\tbutton.events.on(\"drag\", this.handleGripDrag, this, false);\r\n\t\tbutton.events.on(\"dragstop\", this.makeUnbusy, this, false);\r\n\t\tbutton.events.on(\"down\", this.makeBusy, this, false);\r\n\t\tbutton.events.on(\"up\", this.makeUnbusy, this, false);\r\n\r\n\t\tthis._disposers.push(button);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates positions of related elements after grip element is dragged.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param event  Event\r\n\t */\r\n\tpublic handleGripDrag(event: AMEvent<ResizeButton, ISpriteEvents>[\"drag\"]): void {\r\n\t\tthis.makeBusy();\r\n\r\n\t\tif (event.target === this._startGrip) {\r\n\t\t\tthis._usingGrip = \"start\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._usingGrip = \"end\";\r\n\t\t}\r\n\r\n\t\tif (this.orientation == \"horizontal\") {\r\n\t\t\tthis._start = this.startGrip.pixelX / this.innerWidth;\r\n\t\t\tthis._end = this.endGrip.pixelX / this.innerWidth;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._start = 1 - this.startGrip.pixelY / this.innerHeight;\r\n\t\t\tthis._end = 1 - this.endGrip.pixelY / this.innerHeight;\r\n\t\t}\r\n\r\n\t\tthis.updateThumb();\r\n\t}\r\n\r\n\t/**\r\n\t * A \"thumb\" element.\r\n\t *\r\n\t * It's a draggable square space between the grips, that can be used to\r\n\t * pan the selection.\r\n\t *\r\n\t * @param thumb  Thumb element\r\n\t */\r\n\tpublic set thumb(thumb: Button) {\r\n\t\tif (thumb) {\r\n\r\n\t\t\tif (this._thumb) {\r\n\t\t\t\tthis.removeDispose(this._thumb);\r\n\t\t\t}\r\n\r\n\t\t\tthis._thumb = thumb;\r\n\t\t\tthumb.parent = this;\r\n\t\t\tthumb.isMeasured = false;\r\n\t\t\tthumb.inert = true;\r\n\t\t\tthumb.draggable = true;\r\n\t\t\tthumb.clickable = true;\r\n\t\t\tthumb.hoverable = true;\r\n\t\t\tthumb.focusable = true;\r\n\t\t\tthumb.shouldClone = false;\r\n\t\t\tthumb.zIndex = 0;\r\n\r\n\t\t\t// TODO remove closures ?\r\n\t\t\t// Add events\r\n\r\n\t\t\t// Add cursor styles to thumb\r\n\t\t\tthumb.cursorOverStyle = MouseCursorStyle.grab;\r\n\t\t\tthumb.cursorDownStyle = MouseCursorStyle.grabbing;\r\n\r\n\t\t\tthumb.events.on(\"dragstart\", this.makeBusy, this, false);\r\n\t\t\tthumb.events.on(\"dragstop\", this.makeUnbusy, this, false);\r\n\t\t\tthumb.events.on(\"positionchanged\", this.handleThumbPosition, this, false);\r\n\t\t\tthumb.events.on(\"sizechanged\", this.handleThumbPosition, this, false);\r\n\t\t\tthumb.events.on(\"doublehit\", this.handleDoubleClick, this, false);\r\n\r\n\t\t\t// Add event for space and ENTER to toggle full zoom out and back\r\n\t\t\t// (same as doubleclick)\r\n\t\t\tthis._disposers.push(getInteraction().body.events.on(\"keyup\", (ev) => {\r\n\t\t\t\tif (keyboard.isKey(ev.event, [\"space\", \"enter\"]) && this.thumb.isFocused) {\r\n\t\t\t\t\tev.event.preventDefault();\r\n\t\t\t\t\tthis.handleDoubleClick();\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\r\n\t\t\tthis._disposers.push(this._thumb);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Thumb element\r\n\t */\r\n\tpublic get thumb(): Button {\r\n\t\tif (!this._thumb) {\r\n\t\t\t// Create scrollbar controls (setters will handle adding disposers)\r\n\t\t\tlet thumb = new Button();\r\n\t\t\tthumb.background.cornerRadius(10, 10, 10, 10);\r\n\t\t\tthumb.padding(0, 0, 0, 0);\r\n\t\t\tthis.thumb = thumb;\r\n\t\t}\r\n\t\treturn this._thumb;\r\n\t}\r\n\r\n\t/**\r\n\t * Zooms-in and out the selection on double-click of the thumb.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic handleDoubleClick(): void {\r\n\r\n\t\tthis.makeBusy();\r\n\r\n\t\tlet newStart: number = 0;\r\n\t\tlet newEnd: number = 1;\r\n\r\n\t\tif (this.start != 0 || this.end != 1) {\r\n\t\t\tthis._prevStart = this.start;\r\n\t\t\tthis._prevEnd = this.end;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnewStart = this._prevStart;\r\n\t\t\tnewEnd = this._prevEnd;\r\n\t\t}\r\n\r\n\t\tlet zoomAnimation = this.animate([{ property: \"__start\", to: newStart }, { property: \"__end\", to: newEnd }], this.animationDuration, this.animationEasing);\r\n\r\n\t\tif (zoomAnimation && !zoomAnimation.isFinished()) {\r\n\t\t\tzoomAnimation.events.on(\"animationended\", this.makeUnbusy, this, false);\r\n\t\t\tthis._zoomAnimation = zoomAnimation;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.makeUnbusy();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates positions of other elements when thumb is moved.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic handleThumbPosition(): void {\r\n\t\tlet thumb = this.thumb;\r\n\t\tif (this.orientation == \"horizontal\") {\r\n\t\t\tlet innerWidth = this.innerWidth;\r\n\t\t\tlet w = thumb.innerWidth;\r\n\t\t\tlet x = thumb.pixelX;\r\n\r\n\t\t\tthis._start = x / innerWidth;\r\n\t\t\tthis._end = (x + w) / innerWidth;\r\n\t\t\tthis.updateThumb();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet innerHeight = this.innerHeight;\r\n\t\t\tlet h = thumb.innerHeight;\r\n\t\t\tlet y = thumb.pixelY;\r\n\r\n\t\t\tthis._start = 1 - (y + h) / innerHeight;\r\n\t\t\tthis._end = 1 - y / innerHeight;\r\n\t\t\tthis.updateThumb();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a background element for the scrollbar.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Background\r\n\t */\r\n\tpublic createBackground(): this[\"_background\"] {\r\n\t\treturn new RoundedRectangle();\r\n\t}\r\n\r\n\t/**\r\n\t * Use this property to set whether grips should be always visible (`false`),\r\n\t * or they should just appear on scrollbar hover (`true`).\r\n\t *\r\n\t * @param value  Show only on hover?\r\n\t */\r\n\tpublic set hideGrips(value: boolean) {\r\n\r\n\t\tthis._hideGrips = value;\r\n\r\n\t\tif (this._overDisposer) {\r\n\t\t\tthis.removeDispose(this._overDisposer);\r\n\t\t}\r\n\t\tif (this._outDisposer) {\r\n\t\t\tthis.removeDispose(this._outDisposer);\r\n\t\t}\r\n\r\n\t\tif (value) {\r\n\t\t\tthis._overDisposer = this.events.on(\"over\", () => {\r\n\t\t\t\tthis.startGrip.show();\r\n\t\t\t\tthis.endGrip.show();\r\n\t\t\t}, undefined, false)\r\n\t\t\tthis._outDisposer = this.events.on(\"out\", () => {\r\n\t\t\t\tthis.startGrip.hide();\r\n\t\t\t\tthis.endGrip.hide();\r\n\t\t\t}, undefined, false)\r\n\t\t\tthis.startGrip.hide();\r\n\t\t\tthis.endGrip.hide();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.startGrip.show();\r\n\t\t\tthis.endGrip.show();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Show only on hover?\r\n\t */\r\n\tpublic get hideGrips(): boolean {\r\n\t\treturn this._hideGrips;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Duration in milliseconds of scrollbar animation (happens when user clicks on a background of a scrollbar)\r\n\t * @default 0\r\n\t * @param value number\r\n\t */\r\n\tpublic set animationDuration(value: number) {\r\n\t\tthis.setPropertyValue(\"animationDuration\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Orientation\r\n\t */\r\n\tpublic get animationDuration(): number {\r\n\t\treturn this.getPropertyValue(\"animationDuration\");\r\n\t}\r\n\r\n\t/**\r\n\t * Animation easing function.\r\n\t * @todo: review description and default\r\n\t * @default $ease.cubicOut\r\n\t * @param value (value: number) => number\r\n\t */\r\n\tpublic set animationEasing(value: (value: number) => number) {\r\n\t\tthis.setPropertyValue(\"animationEasing\", value);\r\n\t}\r\n\r\n\t/**\r\n\t * @return {Function}\r\n\t */\r\n\tpublic get animationEasing(): (value: number) => number {\r\n\t\treturn this.getPropertyValue(\"animationEasing\");\r\n\t}\r\n\r\n\t/**\r\n\t * Adds easing functions to \"function\" fields.\r\n\t *\r\n\t * @param field  Field name\r\n\t * @return Assign as function?\r\n\t */\r\n\tprotected asFunction(field: string): boolean {\r\n\t\treturn field == \"animationEasing\" || super.asIs(field);\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Scrollbar\"] = Scrollbar;\r\n","/**\r\n * Functionality for drawing triangles.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite, ISpriteProperties, ISpriteAdapters, ISpriteEvents } from \"../Sprite\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $path from \"../rendering/Path\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[Triangle]].\r\n */\r\nexport interface ITriangleProperties extends ISpriteProperties {\r\n\tdirection: \"left\" | \"right\" | \"top\" | \"bottom\"\r\n}\r\n\r\n/**\r\n * Defines events for [[Triangle]].\r\n */\r\nexport interface ITriangleEvents extends ISpriteEvents { }\r\n\r\n/**\r\n * Defines adapters for [[Triangle]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface ITriangleAdapters extends ISpriteAdapters, ITriangleProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Used to draw a triangle.\r\n *\r\n * @see {@link ITriangleEvents} for a list of available events\r\n * @see {@link ITriangleAdapters} for a list of available Adapters\r\n */\r\nexport class Triangle extends Sprite {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: ITriangleProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: ITriangleAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: ITriangleEvents;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"Triangle\";\r\n\t\tthis.element = this.paper.add(\"path\");\r\n\t\tthis.direction = \"top\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic draw(): void {\r\n\t\tsuper.draw();\r\n\t\tlet w: number = this.pixelWidth;\r\n\t\tlet h: number = this.pixelHeight;\r\n\r\n\t\tlet path: string;\r\n\r\n\r\n\r\n\t\tswitch (this.direction) {\r\n\t\t\tcase \"right\":\r\n\t\t\t\tpath = $path.moveTo({ x: 0, y: 0 })\r\n\t\t\t\t\t+ $path.lineTo({ x: w, y: h / 2 })\r\n\t\t\t\t\t+ $path.lineTo({ x: 0, y: h })\r\n\t\t\t\t\t+ $path.closePath();\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"left\":\r\n\t\t\t\tpath = $path.moveTo({ x: w, y: 0 })\r\n\t\t\t\t\t+ $path.lineTo({ x: 0, y: h / 2 })\r\n\t\t\t\t\t+ $path.lineTo({ x: w, y: h })\r\n\t\t\t\t\t+ $path.closePath();\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"bottom\":\r\n\t\t\t\tpath = $path.moveTo({ x: 0, y: 0 })\r\n\t\t\t\t\t+ $path.lineTo({ x: w, y: 0 })\r\n\t\t\t\t\t+ $path.lineTo({ x: w / 2, y: h })\r\n\t\t\t\t\t+ $path.closePath();\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"top\":\r\n\t\t\t\tpath = $path.moveTo({ x: w / 2, y: 0 })\r\n\t\t\t\t\t+ $path.lineTo({ x: w, y: h })\r\n\t\t\t\t\t+ $path.lineTo({ x: 0, y: h })\r\n\t\t\t\t\t+ $path.closePath();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tthis.path = path;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets direction of a triangle\r\n\t *\r\n\t * @param value\r\n\t */\r\n\tpublic set direction(value: \"left\" | \"right\" | \"top\" | \"bottom\") {\r\n\t\tthis.setPropertyValue(\"direction\", value, true);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Returns direction of a triangle\r\n\t *\r\n\t * @return value\r\n\t */\r\n\tpublic get direction(): \"left\" | \"right\" | \"top\" | \"bottom\" {\r\n\t\treturn this.getPropertyValue(\"direction\");\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Triangle\"] = Triangle;\r\n","/**\r\n * Functionality for drawing rectangles with waved edges.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Rectangle, IRectangleProperties, IRectangleAdapters, IRectangleEvents } from \"./Rectangle\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { IWavedShape } from \"../defs/IWavedShape\";\r\nimport { wavedLine } from \"../rendering/Smoothing\";\r\nimport * as $path from \"../rendering/Path\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines available properties for [[WavedRectangle]].\r\n */\r\nexport interface IWavedRectangleProperties extends IRectangleProperties {\r\n\r\n\t/**\r\n\t * Wave length in pixels.\r\n\t *\r\n\t * @default 16\r\n\t */\r\n\twaveHeight?: number;\r\n\r\n\t/**\r\n\t * Wave height in pixels.\r\n\t *\r\n\t * @default 4\r\n\t */\r\n\twaveLength?: number;\r\n\r\n\t/**\r\n\t * Wave tension.\r\n\t *\r\n\t * @default 0.8\r\n\t */\r\n\ttension?: number;\r\n\r\n\t/**\r\n\t * If right side of a rectangle should be waved.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\twavedRight?: boolean;\r\n\r\n\t/**\r\n\t * If left side of a rectangle should be waved.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\twavedLeft?: boolean;\r\n\r\n\t/**\r\n\t * If top side of a rectangle should be waved.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\twavedTop?: boolean;\r\n\r\n\t/**\r\n\t * If bottom side of a rectangle should be waved.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\twavedBottom?: boolean;\r\n}\r\n\r\n/**\r\n * Defines events for [[WavedRectangle]].\r\n */\r\nexport interface IWavedRectangleEvents extends IRectangleEvents { }\r\n\r\n/**\r\n * Defines adapters for [[WavedRectangle]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IWavedRectangleAdapters extends IRectangleAdapters, IWavedRectangleProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Draws a rectangle with waved edges.\r\n *\r\n * @see {@link IWavedRectangleEvents} for a list of available events\r\n * @see {@link IWavedRectangleAdapters} for a list of available Adapters\r\n */\r\nexport class WavedRectangle extends Rectangle implements IWavedShape {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IWavedRectangleProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IWavedRectangleAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IWavedRectangleEvents;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"WavedRectangle\";\r\n\r\n\t\t// Add path element\r\n\t\tthis.element = this.paper.add(\"path\");\r\n\r\n\t\t// Set defaults\r\n\t\tthis.waveLength = 16;\r\n\t\tthis.waveHeight = 4;\r\n\t\tthis.tension = 0.8;\r\n\r\n\t\tthis.setPropertyValue(\"wavedLeft\", true);\r\n\t\tthis.setPropertyValue(\"wavedRight\", true);\r\n\t\tthis.setPropertyValue(\"wavedTop\", true);\r\n\t\tthis.setPropertyValue(\"wavedBottom\", true);\r\n\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the waved rectangle.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic draw(): void {\r\n\t\tsuper.draw();\r\n\r\n\t\tlet w: number = this.pixelWidth;\r\n\t\tlet h: number = this.pixelHeight;\r\n\r\n\t\tif (w > 0 && h > 0) {\r\n\t\t\tlet p1: IPoint = { x: 0, y: 0 };\r\n\t\t\tlet p2: IPoint = { x: w, y: 0 };\r\n\t\t\tlet p3: IPoint = { x: w, y: h };\r\n\t\t\tlet p4: IPoint = { x: 0, y: h };\r\n\r\n\t\t\tlet waveLengthH: number = Math.min(w, this.waveLength);\r\n\t\t\tlet waveHeightH: number = Math.min(h, this.waveHeight);\r\n\r\n\t\t\tlet waveLengthV: number = Math.min(h, this.waveLength);\r\n\t\t\tlet waveHeightV: number = Math.min(w, this.waveHeight);\t\t\t\r\n\r\n\t\t\tlet td: string = \"\";\r\n\t\t\tlet rd: string = \"\";\r\n\t\t\tlet bd: string = \"\";\r\n\t\t\tlet ld: string = \"\";\r\n\r\n\t\t\tif (this.wavedTop) {\r\n\t\t\t\ttd = wavedLine(p1, p2, waveLengthH, waveHeightH, this.tension, true);\r\n\t\t\t}\r\n\t\t\tif (this.wavedRight) {\r\n\t\t\t\trd = wavedLine(p2, p3, waveLengthV, waveHeightV, this.tension, true);\r\n\t\t\t}\r\n\t\t\tif (this.wavedBottom) {\r\n\t\t\t\tbd = wavedLine(p3, p4, waveLengthH, waveHeightH, this.tension, true);\r\n\t\t\t}\r\n\t\t\tif (this.wavedLeft) {\r\n\t\t\t\tld = wavedLine(p4, p1, waveLengthV, waveHeightV, this.tension, true);\r\n\t\t\t}\r\n\r\n\t\t\tthis.path = $path.moveTo(p1) + td + $path.lineTo(p2) + rd + $path.lineTo(p3) + bd + $path.lineTo(p4) + ld + \"z\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Wave length in pixels.\r\n\t *\r\n\t * @default 16\r\n\t * @param value  Wave length (px)\r\n\t */\r\n\tpublic set waveLength(value: number) {\r\n\t\tthis.setPropertyValue(\"waveLength\", value);\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Wave length (px)\r\n\t */\r\n\tpublic get waveLength(): number {\r\n\t\treturn this.getPropertyValue(\"waveLength\");\r\n\t}\r\n\r\n\t/**\r\n\t * Wave height in pixels.\r\n\t *\r\n\t * @default 4\r\n\t * @param value  Wave height (px)\r\n\t */\r\n\tpublic set waveHeight(value: number) {\r\n\t\tthis.setPropertyValue(\"waveHeight\", value);\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Wave height (px)\r\n\t */\r\n\tpublic get waveHeight(): number {\r\n\t\treturn this.getPropertyValue(\"waveHeight\");\r\n\t}\r\n\r\n\t/**\r\n\t * Sets which side should be waved or not. If particular side is set to\r\n\t * `false`, a straight line will be drawn on that side.\r\n\t *\r\n\t * @param top     Top waved?\r\n\t * @param right   Right side waved?\r\n\t * @param bottom  Bottom Waved?\r\n\t * @param left    Left side waved?\r\n\t */\r\n\tpublic setWavedSides(top: boolean, right: boolean, bottom: boolean, left: boolean): void {\r\n\t\tthis.wavedTop = top;\r\n\t\tthis.wavedRight = right;\r\n\t\tthis.wavedBottom = bottom;\r\n\t\tthis.wavedLeft = left;\r\n\t}\r\n\r\n\t/**\r\n\t * Tension of the wave.\r\n\t *\r\n\t * @default 0.8\r\n\t * @param value  Tension\r\n\t */\r\n\tpublic set tension(value: number) {\r\n\t\tthis.setPropertyValue(\"tension\", value);\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tension\r\n\t */\r\n\tpublic get tension(): number {\r\n\t\treturn this.getPropertyValue(\"tension\");\r\n\t}\r\n\r\n\t/**\r\n\t * Specifies if right side should be waved.\r\n\t *\r\n\t * @default true\r\n\t * @param value Waved?\r\n\t */\r\n\tpublic set wavedRight(value: boolean) {\r\n\t\tthis.setPropertyValue(\"wavedRight\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Wave right side?\r\n\t */\r\n\tpublic get wavedRight(): boolean {\r\n\t\treturn this.getPropertyValue(\"wavedRight\");\r\n\t}\r\n\r\n\t/**\r\n\t * Specifies if left side should be waved.\r\n\t *\r\n\t * @default true\r\n\t * @param value Waved?\r\n\t */\r\n\tpublic set wavedLeft(value: boolean) {\r\n\t\tthis.setPropertyValue(\"wavedLeft\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Wave left side?\r\n\t */\r\n\tpublic get wavedLeft(): boolean {\r\n\t\treturn this.getPropertyValue(\"wavedLeft\");\r\n\t}\r\n\r\n\t/**\r\n\t * Specifies if top side should be waved.\r\n\t *\r\n\t * @default true\r\n\t * @param value Waved?\r\n\t */\r\n\tpublic set wavedTop(value: boolean) {\r\n\t\tthis.setPropertyValue(\"wavedTop\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Wave top side?\r\n\t */\r\n\tpublic get wavedTop(): boolean {\r\n\t\treturn this.getPropertyValue(\"wavedTop\");\r\n\t}\r\n\r\n\t/**\r\n\t * Specifies if bottom side should be waved.\r\n\t *\r\n\t * @default true\r\n\t * @param value Waved?\r\n\t */\r\n\tpublic set wavedBottom(value: boolean) {\r\n\t\tthis.setPropertyValue(\"wavedBottom\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Wave bottom side?\r\n\t */\r\n\tpublic get wavedBottom(): boolean {\r\n\t\treturn this.getPropertyValue(\"wavedBottom\");\r\n\t}\r\n\r\n}\r\n","import * as $array from \"./Array\";\nimport * as $log from \"./Log\";\n\n\ninterface Sensor {\n\taddTarget(target: Element, callback: () => void): void;\n\tremoveTarget(target: Element): void;\n}\n\n\ndeclare const ResizeObserver: any;\n\nclass Native implements Sensor {\n\tprivate _observer: any;\n\tprivate _targets: Array<{ target: Element, callback: () => void }> = [];\n\n\tconstructor() {\n\t\tthis._observer = new ResizeObserver((entries: Array<any>) => {\n\t\t\t$array.each(entries, (entry) => {\n\t\t\t\t$array.each(this._targets, (x) => {\n\t\t\t\t\tif (x.target === entry.target) {\n\t\t\t\t\t\tx.callback();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\taddTarget(target: Element, callback: () => void) {\n\t\tthis._observer.observe(target, { box: \"content-box\" });\n\t\tthis._targets.push({ target, callback });\n\t}\n\n\tremoveTarget(target: Element) {\n\t\tthis._observer.unobserve(target);\n\n\t\t$array.keepIf(this._targets, (x) => {\n\t\t\treturn x.target !== target;\n\t\t});\n\t}\n}\n\n\nclass Raf implements Sensor {\n\tpublic static delay: number = 200;\n\n\tprivate _timer: number | undefined;\n\tprivate _targets: Array<{ target: Element, callback: () => void, size: ClientRect | DOMRect }> = [];\n\n\taddTarget(target: Element, callback: () => void) {\n\t\tif (this._targets.length === 0) {\n\t\t\tlet lastTime: number | null = null;\n\n\t\t\tconst loop = () => {\n\t\t\t\tconst currentTime = Date.now();\n\n\t\t\t\tif (lastTime === null || currentTime > (lastTime + Raf.delay)) {\n\t\t\t\t\tlastTime = currentTime;\n\n\t\t\t\t\t$array.each(this._targets, (x) => {\n\t\t\t\t\t\tlet newSize = x.target.getBoundingClientRect();\n\n\t\t\t\t\t\tif (newSize.width !== x.size.width || newSize.height !== x.size.height) {\n\t\t\t\t\t\t\tx.size = newSize;\n\t\t\t\t\t\t\tx.callback();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis._timer = requestAnimationFrame(loop);\n\t\t\t};\n\n\t\t\tthis._timer = requestAnimationFrame(loop);\n\t\t}\n\n\t\tlet size = target.getBoundingClientRect();\n\t\tthis._targets.push({ target, callback, size });\n\t}\n\n\tremoveTarget(target: Element) {\n\t\t$array.keepIf(this._targets, (x) => {\n\t\t\treturn x.target !== target;\n\t\t});\n\n\t\tif (this._targets.length === 0) {\n\t\t\tcancelAnimationFrame(this._timer);\n\t\t}\n\t}\n}\n\n\nlet observer: Sensor | null = null;\n\nfunction makeSensor(): Sensor {\n\tif (observer === null) {\n\t\tif (typeof ResizeObserver !== \"undefined\") {\n\t\t\tobserver = new Native();\n\n\t\t} else {\n\t\t\tobserver = new Raf();\n\t\t}\n\t}\n\n\treturn observer;\n}\n\nexport class ResizeSensor {\n\tprivate _sensor: Sensor;\n\tprivate _element: Element;\n\tprivate _disposed: boolean = false;\n\n\tconstructor(element: Element, callback: () => void) {\n\t\tthis._sensor = makeSensor();\n\t\tthis._element = element;\n\t\tthis._sensor.addTarget(element, callback);\n\t}\n\n\tpublic isDisposed() {\n\t\treturn this._disposed;\n\t}\n\n\tpublic dispose() {\n\t\tif (!this._disposed) {\n\t\t\tthis._disposed = true;\n\t\t\tthis._sensor.removeTarget(this._element);\n\t\t}\n\t}\n\n\tpublic get sensor(): Sensor {\n\t\treturn this._sensor;\n\t}\n\n\t/**\n\t * Deprecated: do not use.\n\t *\n\t * @ignore Exclude from docs\n\t */\n\tpublic reset() {\n\t\t$log.warn(\"resizeSensor.reset() is no longer needed and can be removed\");\n\t}\n}\n","/**\r\n * This functionality is related to the HTML wrapper that houses `<svg>` tag.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Container } from \"../Container\";\r\nimport { Sprite } from \"../Sprite\";\r\nimport { IDisposer } from \"../utils/Disposer\";\r\nimport { Popup } from \"../elements/Popup\";\r\nimport { Modal } from \"../elements/Modal\";\r\nimport { ListTemplate, ListDisposer } from \"../utils/List\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport * as $dom from \"../utils/DOM\";\r\nimport * as $array from \"../utils/Array\";\r\nimport * as $type from \"../utils/Type\";\r\nimport { ResizeSensor } from \"../utils/ResizeSensor\";\r\n\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n\r\n/**\r\n * A array of all SVG Containers (one SVG container per chart instance).\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport const svgContainers: Array<SVGContainer> = [];\r\n\r\n/**\r\n * A class used to create an HTML wrapper for the SVG contents.\r\n */\r\nexport class SVGContainer implements IDisposer {\r\n\r\n\t/**\r\n\t * Indicates if this object has already been deleted. Any\r\n\t * destruction/disposal code should take this into account when deciding\r\n\t * wheter to run potentially costly disposal operations if they already have\r\n\t * been run.\r\n\t */\r\n\tprotected _disposed: boolean = false;\r\n\r\n\t/**\r\n\t * Width of HTML element.\r\n\t */\r\n\tpublic width: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * Height of HTML element.\r\n\t */\r\n\tpublic height: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * A [[Container]] element which is placed into container.\r\n\t */\r\n\tprotected _container: $type.Optional<Container>;\r\n\r\n\t/**\r\n\t * A parent HTML container that SVG wrapper element is placed in.\r\n\t */\r\n\tpublic htmlElement: HTMLElement;\r\n\r\n\t/**\r\n\t * If this component is in a separate HTML container, `autoResize` means the\r\n\t * module will constantly measure container's size and adopt contents to it.\r\n\t */\r\n\tpublic autoResize: Boolean = true;\r\n\r\n\t/**\r\n\t * A `<div>` element which acts as a wrapper/holder for the SVG element.\r\n\t */\r\n\tpublic SVGContainer: HTMLDivElement;\r\n\r\n\t/**\r\n\t * A `<div>` element which acts as a placeholder for accesibility reader\r\n\t * alert.\r\n\t */\r\n\tprivate _readerAlertElement: HTMLDivElement;\r\n\r\n\t/**\r\n\t * A reference to ResizeSensor object which monitors changes of div size.\r\n\t *\r\n\t * @deprecated\r\n\t * @ignore\r\n\t */\r\n\tpublic resizeSensor: ResizeSensor;\r\n\r\n\t/**\r\n\t * Holds list of references to [[Sprite]] objects that should not be exported\r\n\t * when exporting chart to an image.\r\n\t *\r\n\t * @ignore\r\n\t */\r\n\tpublic nonExportableSprites: Sprite[] = [];\r\n\r\n\t/**\r\n\t * Holds [[Modal]] object.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _modal: $type.Optional<Modal>;\r\n\r\n\t/**\r\n\t * Holds [[Popup]] objects.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _popups: $type.Optional<ListTemplate<Popup>>;\r\n\r\n\t/**\r\n\t * List of objects that need to be disposed when this one is disposed.\r\n\t */\r\n\tprotected _disposers: Array<IDisposer> = [];\r\n\r\n\tpublic cssScale: number = 1;\r\n\r\n\t// This is needed so that it won't resize while printing, so that way printing works correctly.\r\n\tprotected _printing: boolean = false;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t *\r\n\t * * Creates an HTML wrapper for SVG\r\n\t */\r\n\tconstructor(htmlElement: HTMLElement, ghost?: boolean) {\r\n\r\n\t\t// Log parent HTML element\r\n\t\tthis.htmlElement = htmlElement;\r\n\r\n\t\tif (!ghost) {\r\n\t\t\tthis._printing = false;\r\n\r\n\t\t\tthis.initSensor();\r\n\r\n\t\t\tthis._disposers.push($dom.addEventListener(window, \"beforeprint\", () => {\r\n\t\t\t\tthis._printing = true;\r\n\t\t\t}));\r\n\r\n\t\t\tthis._disposers.push($dom.addEventListener(window, \"afterprint\", () => {\r\n\t\t\t\tthis._printing = false;\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\t// Adds to containers array\r\n\t\tsvgContainers.push(this);\r\n\r\n\t\t/**\r\n\t\t * Create child div for the container - it will have svg node\r\n\t\t * It might seem that this container is not necessay, however having it solves\r\n\t\t * a problems with mouse position detection and some other.\r\n\t\t */\r\n\t\tlet svgContainer = document.createElement(\"div\");\r\n\t\tlet style = svgContainer.style;\r\n\t\tstyle.width = \"100%\";\r\n\t\tstyle.height = \"100%\";\r\n\t\tstyle.position = \"relative\";\r\n\t\thtmlElement.appendChild(svgContainer);\r\n\r\n\t\tthis.SVGContainer = svgContainer;\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)Initializes a resize sensor.\r\n\t */\r\n\tpublic initSensor(): void {\r\n\t\tif (this.resizeSensor) {\r\n\t\t\tthis.resizeSensor.dispose();\r\n\t\t}\r\n\t\tconst callback = () => {\r\n\t\t\tif (this.autoResize && !this._printing) {\r\n\t\t\t\tthis.measure();\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis.resizeSensor = new ResizeSensor(this.htmlElement, callback);\r\n\t\tthis._disposers.push(this.resizeSensor);\r\n\t}\r\n\r\n\t/**\r\n\t * Measures size of parent HTML element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic measure(): void {\r\n\t\tlet width: number = $utils.width(this.htmlElement);\r\n\t\tlet height: number = $utils.height(this.htmlElement);\r\n\t\tlet container = this.container;\r\n\t\tif (container) {\r\n\t\t\tif (this.width != width || this.height != height) {\r\n\t\t\t\tthis.width = width;\r\n\t\t\t\tthis.height = height;\r\n\r\n\t\t\t\tif (width > 0) {\r\n\t\t\t\t\tcontainer.maxWidth = width;\r\n\t\t\t\t}\r\n\t\t\t\tif (height > 0) {\r\n\t\t\t\t\tcontainer.maxHeight = height;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$dom.fixPixelPerfect(this.SVGContainer);\r\n\t\t\t}\r\n\r\n\t\t\tif (!container.maxWidth) {\r\n\t\t\t\tcontainer.maxWidth = 0;\r\n\t\t\t}\r\n\t\t\tif (!container.maxHeight) {\r\n\t\t\t\tcontainer.maxHeight = 0;\r\n\t\t\t}\r\n\t\t\tthis.cssScale = 1;\r\n\t\t\tthis.checkTransform(this.htmlElement);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Container]] element which is placed into container.\r\n\t *\r\n\t * @param container  Container\r\n\t */\r\n\tpublic set container(container: $type.Optional<Container>) {\r\n\t\tthis._container = container;\r\n\t\tthis.measure();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Container\r\n\t */\r\n\tpublic get container(): $type.Optional<Container> {\r\n\t\treturn this._container;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns if this object has been already been disposed.\r\n\t *\r\n\t * @return Is disposed?\r\n\t */\r\n\tpublic isDisposed(): boolean {\r\n\t\treturn this._disposed;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes this container from SVG container list in system, which\r\n\t * effectively disables size change monitoring for it.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tif (!this._disposed) {\r\n\t\t\t$array.remove(svgContainers, this);\r\n\t\t}\r\n\r\n\t\t$array.each(this._disposers, (item) => {\r\n\t\t\titem.dispose();\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if chart container should have its style set\r\n\t * to `overflow: hidden`.\r\n\t *\r\n\t * Normally, we don't want that, so that certain elements, such as tooltips,\r\n\t * would be able to go outside chart area.\r\n\t *\r\n\t * There is one issue though. Some browsers ignore SVG masks and would\r\n\t * display scrollbars if chart elements, that go outside chart area extend\r\n\t * outside window.\r\n\t *\r\n\t * This is especially true for [[MapChart]], which can have its elements\r\n\t * extend very widely when zoomed in. Even if those parts are not visible\r\n\t * because of SVG masks, some browsers might still display window scrollbars.\r\n\t *\r\n\t * This is why we set this setting to `true` in [[MapChart]].\r\n\t *\r\n\t * Other charts use default of `false`.\r\n\t */\r\n\tpublic set hideOverflow(value: boolean) {\r\n\t\tif (value) {\r\n\t\t\tthis.SVGContainer.style.overflow = \"hidden\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.SVGContainer.style.overflow = \"\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * MODAL/POPUP RELATED STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * Returns a [[Modal]] instance, associated with this chart.\r\n\t * (elements top parent)\r\n\t *\r\n\t * Accessing modal does not make it appear. To make a modal appear, use\r\n\t * `showModal()` method.\r\n\t *\r\n\t * @see {@link Modal} for more information about using Modal windows\r\n\t * @return Modal instance\r\n\t */\r\n\tpublic get modal(): Modal {\r\n\r\n\t\tif (!$type.hasValue(this._modal)) {\r\n\r\n\t\t\t// Create new modal\r\n\t\t\tthis._modal = new Modal();\r\n\t\t\tthis._modal.container = this.SVGContainer;\r\n\r\n\t\t\t// Add to disposers\r\n\t\t\tthis._disposers.push(this._modal);\r\n\t\t}\r\n\t\treturn this._modal;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Opens a modal window with specific content (`text` parameter) and,\r\n\t * optionally, `title`.\r\n\t *\r\n\t * The `text` parameter can contain HTML content.\r\n\t *\r\n\t * @see {@link Modal} for more information about using Modal windows\r\n\t * @param text   Modal contents\r\n\t * @param title  Title for the modal window\r\n\t */\r\n\tpublic openModal(text: string, title?: string): Modal {\r\n\r\n\t\t// Hide previous modal\r\n\t\tthis.closeModal();\r\n\r\n\t\t// Create modal\r\n\t\tlet modal = this.modal;\r\n\t\tmodal.content = text;\r\n\t\tmodal.readerTitle = title || \"\";\r\n\t\tmodal.title = title || \"\";\r\n\t\tmodal.open();\r\n\r\n\t\treturn modal;\r\n\t}\r\n\r\n\t/**\r\n\t * Hides modal window if there is one currently open.\r\n\t */\r\n\tpublic closeModal(): void {\r\n\t\tif (this._modal) {\r\n\t\t\tthis.modal.close();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A list of popups for this chart.\r\n\t *\r\n\t * @return Popups\r\n\t */\r\n\tpublic get popups(): ListTemplate<Popup> {\r\n\r\n\t\tif (!$type.hasValue(this._popups)) {\r\n\r\n\t\t\t// Create popup template\r\n\t\t\tlet popupTemplate = new Popup();\r\n\t\t\tpopupTemplate.container = this.SVGContainer;\r\n\r\n\t\t\t// Create the list\r\n\t\t\tthis._popups = new ListTemplate(popupTemplate);\r\n\r\n\t\t\t// Add to disposers\r\n\t\t\tthis._disposers.push(new ListDisposer(this._popups));\r\n\t\t\tthis._disposers.push(this._popups.template);\r\n\t\t}\r\n\t\treturn this._popups;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Creates, opens, and returns a new [[Popup]] window.\r\n\t *\r\n\t * `text` can be any valid HTML.\r\n\t *\r\n\t * `title` is currently not supported.\r\n\t *\r\n\t * @param text   Popup contents\r\n\t * @param title  Popup title\r\n\t * @return Popup instance\r\n\t */\r\n\tpublic openPopup(text: string, title?: string): Popup {\r\n\t\tlet popup = this.popups.create();\r\n\t\tpopup.content = text;\r\n\t\tif ($type.hasValue(title)) {\r\n\t\t\tpopup.title = title;\r\n\t\t}\r\n\t\tpopup.open();\r\n\t\treturn popup;\r\n\t}\r\n\r\n\t/**\r\n\t * Closes all currently open popup windows\r\n\t */\r\n\tpublic closeAllPopups(): void {\r\n\t\tthis.popups.each((popup) => {\r\n\t\t\tpopup.close();\r\n\t\t});\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * ACCESSIBILITY STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\t/**\r\n\t * A `<div>` element used as as placeholder to trigger screen alerts.\r\n\t *\r\n\t * @sunce 4.9.2\r\n\t * @return Element\r\n\t */\r\n\tpublic get readerAlertElement(): HTMLDivElement {\r\n\t\tif (!$type.hasValue(this._readerAlertElement)) {\r\n\t\t\t// Create element\r\n\t\t\tconst div = document.createElement(\"div\");\r\n\t\t\tdiv.setAttribute(\"role\", \"alert\");\r\n\t\t\tdiv.style.zIndex = \"-100000\";\r\n\t\t\tdiv.style.opacity = \"0\";\r\n\t\t\tdiv.style.position = \"absolute\";\r\n\t\t\tdiv.style.top = \"0\";\r\n\t\t\tthis.SVGContainer.appendChild(div);\r\n\t\t\tthis._readerAlertElement = div;\r\n\t\t}\r\n\t\treturn this._readerAlertElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Triggers screen reader read out a message.\r\n\t *\r\n\t * @since 4.9.2\r\n\t * @param  text  Alert text\r\n\t */\r\n\tpublic readerAlert(text: string): void {\r\n\t\tthis.readerAlertElement.innerHTML = text;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * ==========================================================================\r\n\t * OTHER STUFF\r\n\t * ==========================================================================\r\n\t * @hidden\r\n\t */\r\n\r\n\tprotected checkTransform(div: HTMLElement) {\r\n\t\tif (window.getComputedStyle) {\r\n\t\t\tif (div && div.style) {\r\n\t\t\t\tlet style = window.getComputedStyle(div, null);\r\n\t\t\t\tif (style) {\r\n\t\t\t\t\tlet matrix = style.getPropertyValue(\"-webkit-transform\") ||\r\n\t\t\t\t\t\tstyle.getPropertyValue(\"-moz-transform\") ||\r\n\t\t\t\t\t\tstyle.getPropertyValue(\"-ms-transform\") ||\r\n\t\t\t\t\t\tstyle.getPropertyValue(\"-o-transform\") ||\r\n\t\t\t\t\t\tstyle.getPropertyValue(\"transform\");\r\n\r\n\t\t\t\t\tif (matrix && matrix !== \"none\") {\r\n\t\t\t\t\t\tlet values = matrix.split('(')[1].split(')')[0].split(',');\r\n\t\t\t\t\t\tlet a = Number(values[0]);\r\n\t\t\t\t\t\tlet b = Number(values[1]);\r\n\r\n\t\t\t\t\t\tlet scale = Math.sqrt(a * a + b * b);\r\n\r\n\t\t\t\t\t\tif (!isNaN(scale)) {\r\n\t\t\t\t\t\t\tthis.cssScale *= scale;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (div.parentNode && div.parentNode instanceof HTMLElement) {\r\n\t\t\t\tthis.checkTransform(div.parentNode);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import { StyleRule } from \"../utils/DOM\";\r\nimport { Dictionary } from \"../utils/Dictionary\";\r\nimport { MultiDisposer, IDisposer, CounterDisposer } from \"../utils/Disposer\";\r\nimport { InterfaceColorSet } from \"../utils/InterfaceColorSet\";\r\n\r\n\r\nconst rules = new Dictionary<string, CounterDisposer>();\r\n\r\n/**\r\n * Default CSS for Popup.\r\n *\r\n * @ignore Exclude from docs\r\n * @param prefix  Prefix for CSS classes\r\n * @return Disposer for the CSS definition\r\n */\r\nexport default function(element: ShadowRoot | null, prefix?: string): IDisposer {\r\n\tif (!prefix) {\r\n\t\tprefix = \"ampopup\";\r\n\t}\r\n\r\n\tconst cs = new InterfaceColorSet();\r\n\tconst fg = cs.getFor(\"text\");\r\n\tconst bg = cs.getFor(\"background\");\r\n\tbg.alpha = 0.8;\r\n\tconst abg = cs.getFor(\"alternativeBackground\");\r\n\tabg.alpha = 0.05;\r\n\r\n\tconst counter = rules.insertKeyIfEmpty(prefix, () => {\r\n\t\tconst disposer = new MultiDisposer([\r\n\t\t\tnew StyleRule(element, `.${prefix}`, {\r\n\t\t\t\t//\"width\": \"100%\",\r\n\t\t\t\t//\"height\": \"100%\",\r\n\t\t\t\t\"overflow\": \"visible\",\r\n\t\t\t\t\"position\": \"absolute\",\r\n\t\t\t\t\"top\": \"0\",\r\n\t\t\t\t\"left\": \"0\",\r\n\t\t\t\t\"z-index\": \"2000\"\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${prefix}-curtain`, {\r\n\t\t\t\t\"width\": \"100%\",\r\n\t\t\t\t\"height\": \"100%\",\r\n\t\t\t\t\"position\": \"absolute\",\r\n\t\t\t\t\"top\": \"0\",\r\n\t\t\t\t\"left\": \"0\",\r\n\t\t\t\t\"z-index\": \"2001\",\r\n\t\t\t\t\"background-color\": bg.hex,\r\n\t\t\t\t\"opacity\": \"0.5\"\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${prefix}-header`, {\r\n\t\t\t\t\"display\": \"block\",\r\n\t\t\t\t\"width\": \"100%\",\r\n\t\t\t\t\"min-height\": \"1.8em\",\r\n\t\t\t\t\"background\": abg.rgba\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${prefix}-title`, {\r\n\t\t\t\t\"font-weight\": \"bold\",\r\n\t\t\t\t\"font-size\": \"110%\",\r\n\t\t\t\t\"padding\": \"0.5em 1.2em 0.5em 1em\"\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${prefix}-content`, {\r\n\t\t\t\t/*\"width\": \"100%\",\r\n\t\t\t\t\"height\": \"100%\",*/\r\n\t\t\t\t// \"padding\": \"2em 1em 1em 1em\",\r\n\t\t\t\t\"background\": bg.hex,\r\n\t\t\t\t\"background-color\": bg.rgba,\r\n\t\t\t\t\"color\": fg.hex,\r\n\t\t\t\t\"display\": \"inline-block\",\r\n\t\t\t\t\"position\": \"absolute\",\r\n\t\t\t\t\"top\": \"0\",\r\n\t\t\t\t\"left\": \"0\",\r\n\t\t\t\t\"max-width\": \"90%\",\r\n\t\t\t\t\"max-height\": \"90%\",\r\n\t\t\t\t\"overflow\": \"auto\",\r\n\t\t\t\t\"z-index\": \"2002\"\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${prefix}-inside`, {\r\n\t\t\t\t\"padding\": \"1em\"\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${prefix}-close`, {\r\n\t\t\t\t\"display\": \"block\",\r\n\t\t\t\t\"position\": \"absolute\",\r\n\t\t\t\t\"top\": \"0.3em\",\r\n\t\t\t\t\"right\": \"0.3em\",\r\n\t\t\t\t\"background-color\": \"rgb(100, 100, 100)\",\r\n\t\t\t\t\"background\": \"rgba(100, 100, 100, 0.1) url(data:image/svg+xml;charset=utf-8;base64,PHN2ZyBoZWlnaHQ9IjUxMiIgdmVyc2lvbj0iMSIgdmlld0JveD0iMCAwIDUxMiA1MTIiIHdpZHRoPSI1MTIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQ0NS4yIDEwOS4ybC00Mi40LTQyLjRMMjU2IDIxMy42IDEwOS4yIDY2LjhsLTQyLjQgNDIuNEwyMTMuNiAyNTYgNjYuOCA0MDIuOGw0Mi40IDQyLjRMMjU2IDI5OC40bDE0Ni44IDE0Ni44IDQyLjQtNDIuNEwyOTguNCAyNTYiLz48L3N2Zz4=) no-repeat center\",\r\n\t\t\t\t\"background-size\": \"80%\",\r\n\t\t\t\t\"width\": \"1.2em\",\r\n\t\t\t\t\"height\": \"1.2em\",\r\n\t\t\t\t\"cursor\": \"pointer\"\r\n\t\t\t}),\r\n\r\n\t\t]);\r\n\r\n\t\treturn new CounterDisposer(() => {\r\n\t\t\trules.removeKey(prefix);\r\n\t\t\tdisposer.dispose();\r\n\t\t});\r\n\t});\r\n\r\n\treturn counter.increment();\r\n}\r\n","/**\r\n * Popup class is used to display information over chart area.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport popupCSS from \"./PopupCSS\";\r\nimport { Adapter } from \"../utils/Adapter\";\r\nimport { BaseObjectEvents } from \"../Base\";\r\nimport { Sprite } from \"../Sprite\";\r\nimport { getInteraction } from \"../interaction/Interaction\";\r\nimport { InteractionObject } from \"../interaction/InteractionObject\";\r\nimport { keyboard } from \"../utils/Keyboard\";\r\nimport { Percent } from \"../utils/Percent\";\r\nimport { MultiDisposer } from \"../utils/Disposer\";\r\nimport { Align } from \"../defs/Align\";\r\nimport { VerticalAlign } from \"../defs/VerticalAlign\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { Optional } from \"../utils/Type\";\r\nimport { getShadowRoot } from \"../utils/DOM\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $object from \"../utils/Object\";\r\n\r\n/**\r\n * Represents a list of available adapters for Export.\r\n */\r\nexport interface IPopupAdapters {\r\n\r\n\t/**\r\n\t * Applied to the class prefixes.\r\n\t */\r\n\tclassPrefix: string,\r\n\r\n\t/**\r\n\t * Applied to popup content before it is shown.\r\n\t */\r\n\tcontent: string,\r\n\r\n\t/**\r\n\t * Applied to popup title before it is shown.\r\n\t */\r\n\ttitle: string,\r\n\r\n\t/**\r\n\t * Applied to the screen reader title.\r\n\t */\r\n\treaderTitle: string,\r\n\r\n\t/**\r\n\t * Applied to default `defaultStyles` property before it is retrieved.\r\n\t */\r\n\tdefaultStyles: boolean,\r\n\r\n\t/**\r\n\t * Applied to default `showCurtain` property before it is retrieved.\r\n\t */\r\n\tshowCurtain: boolean,\r\n\r\n\t/**\r\n\t * Applied to default `draggable` property before it is retrieved.\r\n\t */\r\n\tdraggable: boolean,\r\n\r\n\t/**\r\n\t * Applied to `closable` property before it is retrieved.\r\n\t */\r\n\tclosable: boolean,\r\n\r\n\t/**\r\n\t * Applied to `dynamicResize` property before it is retrieved.\r\n\t */\r\n\tdynamicResize: boolean,\r\n\r\n\t/**\r\n\t * Applied to `fitTo` property before it's retrieved.\r\n\t *\r\n\t * @ignore Feature not yet implemented\r\n\t */\r\n\tfitTo: \"none\" | \"container\" | \"window\",\r\n\r\n\t/**\r\n\t * Applied to horizontal alignment of the popup.\r\n\t */\r\n\talign: Optional<Align>;\r\n\r\n\t/**\r\n\t * Applied to vertical alignment of the popup.\r\n\t */\r\n\tverticalAlign: Optional<VerticalAlign>;\r\n\r\n\t/**\r\n\t * Applied to `left` position value.\r\n\t */\r\n\tleft: number | Percent;\r\n\r\n\t/**\r\n\t * Applied to `right` position value.\r\n\t */\r\n\tright: number | Percent;\r\n\r\n\t/**\r\n\t * Applied to `top` position value.\r\n\t */\r\n\ttop: number | Percent;\r\n\r\n\t/**\r\n\t * Applied to `bottom` position value.\r\n\t */\r\n\tbottom: number | Percent;\r\n\r\n\t/**\r\n\t * Applied to class names list that are added as class for various popup\r\n\t * elements.\r\n\t */\r\n\tclassNames: {\r\n\t\twrapperClass: string,\r\n\t\ttitleClass: string,\r\n\t\theaderClass: string,\r\n\t\tcontentClass: string,\r\n\t\tinsideClass: string,\r\n\t\tcurtainClass: string,\r\n\t\tcloseClass: string\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Defines events for Popup.\r\n */\r\nexport interface IPopupEvents {\r\n\r\n\t/**\r\n\t * Invoked when Popup is opened.\r\n\t */\r\n\topened: {};\r\n\r\n\t/**\r\n\t * Invoked when Popup is closed.\r\n\t */\r\n\tclosed: {};\r\n\r\n}\r\n\r\n/**\r\n * Shows an HTML popup which covers window or a chart area.\r\n *\r\n * @see {@link https://www.amcharts.com/docs/v4/concepts/popups-and-modals/} For examples and docs on Popups and Modals.\r\n * @todo Positioning over whole window\r\n */\r\nexport class Popup extends BaseObjectEvents {\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IPopupEvents;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IPopupAdapters;\r\n\r\n\t/**\r\n\t * Adapter.\r\n\t */\r\n\tpublic adapter: Adapter<Popup, IPopupAdapters> = new Adapter<Popup, IPopupAdapters>(this);\r\n\r\n\t/**\r\n\t * A reference to an HTML element to be used for container. If not set, popup\r\n\t * will cover the whole window.\r\n\t */\r\n\tpublic container: $type.Optional<HTMLElement | Document>;\r\n\r\n\t/**\r\n\t * A parent element this Popup belongs to.\r\n\t */\r\n\tpublic sprite: $type.Optional<Sprite>;\r\n\r\n\t/**\r\n\t * Holds references to various HTML elements, Popup consists of.\r\n\t */\r\n\tprotected _elements: {\r\n\t\twrapper?: HTMLElement;\r\n\t\ttitle?: HTMLElement;\r\n\t\theader?: HTMLElement;\r\n\t\tcontent?: HTMLElement;\r\n\t\tclose?: HTMLElement;\r\n\t\tcurtain?: HTMLElement;\r\n\t} = {};\r\n\r\n\t/**\r\n\t * Holdes Interaction objects for various Popup's elements.\r\n\t */\r\n\tprotected _IOs: {\r\n\t\twrapper?: InteractionObject;\r\n\t\tcontent?: InteractionObject;\r\n\t\theader?: InteractionObject;\r\n\t\tclose?: InteractionObject;\r\n\t\tcurtain?: InteractionObject;\r\n\t} = {};\r\n\r\n\t/**\r\n\t * Contents of popup window.\r\n\t */\r\n\tprotected _content: string = \"\";\r\n\r\n\t/**\r\n\t * Title of the popup window.\r\n\t */\r\n\tprotected _title: string = \"\";\r\n\r\n\t/**\r\n\t * Prefix to apply to class names for popup elements.\r\n\t */\r\n\tprotected _classPrefix: string = \"ampopup\"\r\n\r\n\t/**\r\n\t * If set to `true` [[Popup]] will use default styles.\r\n\t */\r\n\tprotected _defaultStyles: boolean = true;\r\n\r\n\t/**\r\n\t * If set to `true` [[Popup]] will dim out all chart content behind it by\r\n\t * showing a semi-transparent fill. (curtain)\r\n\t */\r\n\tprotected _showCurtain: boolean = false;\r\n\r\n\t/**\r\n\t * Indicates whether popup can be dragged.\r\n\t */\r\n\tprotected _draggable: boolean = true;\r\n\r\n\t/**\r\n\t * Horizontal position of the content window.\r\n\t */\r\n\tprotected _align: Optional<Align> = \"center\";\r\n\r\n\t/**\r\n\t * Resize popup as images are being loaded.\r\n\t */\r\n\tprotected _dynamicResize: boolean = true;\r\n\r\n\t/**\r\n\t * Vertical position of the content window.\r\n\t */\r\n\tprotected _verticalAlign: Optional<VerticalAlign> = \"middle\";\r\n\r\n\t/**\r\n\t * Shift in position of the element. (used for dragging)\r\n\t */\r\n\tprotected _shift: IPoint = {\r\n\t\tx: 0,\r\n\t\ty: 0\r\n\t};\r\n\r\n\t/**\r\n\t * Temporary shift in position of the element. (used for dragging)\r\n\t */\r\n\tprotected _tempShift: IPoint = {\r\n\t\tx: 0,\r\n\t\ty: 0\r\n\t};\r\n\r\n\t/**\r\n\t * \"left\" position of the popup content.\r\n\t */\r\n\tprotected _left: number | Percent;\r\n\r\n\t/**\r\n\t * \"right\" position of the popup content.\r\n\t */\r\n\tprotected _right: number | Percent;\r\n\r\n\t/**\r\n\t * \"top\" position of the popup content.\r\n\t */\r\n\tprotected _top: number | Percent;\r\n\r\n\t/**\r\n\t * \"bottom\" position of the popup content.\r\n\t */\r\n\tprotected _bottom: number | Percent;\r\n\r\n\t/**\r\n\t * A title for screen readers. It is very highly recommended to set that title\r\n\t * so that people using screen reader tools can get an immediate summary of\r\n\t * the information in the popup.\r\n\t */\r\n\tpublic _readerTitle: string = \"\";\r\n\r\n\t/**\r\n\t * Is popup closable?\r\n\t */\r\n\tprivate _closable: boolean = true;\r\n\r\n\t/**\r\n\t * Was CSS already loaded?\r\n\t */\r\n\tprivate _cssLoaded: boolean = false;\r\n\r\n\t/**\r\n\t * If set to other than \"none\" will try to re-adjust the position of the\r\n\t * popop to fit within chart container or browser window.\r\n\t *\r\n\t * @ignore Feature not yet implemented\r\n\t * @todo Implement\r\n\t */\r\n\tprivate _fitTo: \"none\" | \"container\" | \"window\" = \"window\";\r\n\r\n\t/**\r\n\t * Used to log original value of `interactionsEnabled` so that it can be restored\r\n\t * after temporarily disabling it.\r\n\t */\r\n\tprivate _spriteInteractionsEnabled: $type.Optional<boolean>;\r\n\r\n\t/**\r\n\t * Identifies if this object is a \"template\" and should not be treated as\r\n\t * real object that is drawn or actually used in the chart.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic isTemplate: boolean = false;\r\n\r\n\t/**\r\n\t * Indicates if the element was already sized and should not be measured for\r\n\t * size again, saving some precious resources.\r\n\t */\r\n\tprivate _sized: boolean = false;\r\n\r\n\t/**\r\n\t * Cached bounding rectangle info.\r\n\t */\r\n\tprivate _bbox: $type.Optional<DOMRect | ClientRect>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"Popup\";\r\n\t}\r\n\r\n\t/**\r\n\t * Shows popup window.\r\n\t */\r\n\tpublic open(): void {\r\n\t\tif (this.container) {\r\n\t\t\tif (this._elements.wrapper) {\r\n\t\t\t\tthis.container.appendChild(this._elements.wrapper);\r\n\t\t\t}\r\n\t\t\tif (this._elements.curtain) {\r\n\t\t\t\tthis.container.appendChild(this._elements.curtain);\r\n\t\t\t\tthis.showCurtain = this.showCurtain;\r\n\t\t\t}\r\n\t\t\tthis.positionElement();\r\n\t\t\tthis.dispatchImmediately(\"opened\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hides popup window.\r\n\t */\r\n\tpublic close(): void {\r\n\t\tif (this._elements.wrapper) {\r\n\t\t\tif (this._elements.wrapper.parentElement) {\r\n\t\t\t\tthis._elements.wrapper.parentElement.removeChild(this._elements.wrapper);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._elements.curtain) {\r\n\t\t\tif (this._elements.curtain.parentElement) {\r\n\t\t\t\tthis._elements.curtain.parentElement.removeChild(this._elements.curtain);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.dispatchImmediately(\"closed\");\r\n\t\tthis.releasePointers();\r\n\t}\r\n\r\n\t/**\r\n\t * Destroy (dispose) popup.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tthis.close();\r\n\t\tsuper.dispose();\r\n\t}\r\n\r\n\t/**\r\n\t * Positions content element in the center of popup based on its actual size.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic positionElement(forceResize: boolean = true): void {\r\n\r\n\t\tif (!this._elements.wrapper) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (!this._elements.wrapper) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (forceResize || !this._sized) {\r\n\t\t\t\tthis._elements.wrapper.style.opacity = \"0.01\";\r\n\t\t\t\tthis._elements.wrapper.style.left = \"0\";\r\n\t\t\t\tthis._elements.wrapper.style.top = \"0\";\r\n\t\t\t\tthis._elements.wrapper.style.margin = \"0 0 0 0\";\r\n\r\n\t\t\t\tthis._elements.wrapper.style.width = \"\";\r\n\t\t\t\tthis._elements.wrapper.style.height = \"\";\r\n\r\n\t\t\t\tlet bbox = this._elements.wrapper.getBoundingClientRect();\r\n\t\t\t\tthis._elements.wrapper.style.width = bbox.width + \"px\";\r\n\t\t\t\tthis._elements.wrapper.style.height = bbox.height + \"px\";\r\n\r\n\t\t\t\tthis._sized = true;\r\n\t\t\t}\r\n\r\n\t\t\t// Check for any images that are not yet loaded\r\n\t\t\tif (this.dynamicResize) {\r\n\t\t\t\tconst images = this._elements.wrapper.getElementsByTagName(\"img\");\r\n\t\t\t\tfor (let i = 0; i < images.length; i++) {\r\n\t\t\t\t\tconst image = images[i];\r\n\t\t\t\t\tif (!image.complete) {\r\n\t\t\t\t\t\t// Resize popup once again when image is loaded\r\n\t\t\t\t\t\timage.addEventListener(\"load\", () => {\r\n\t\t\t\t\t\t\tthis.positionElement(true);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t// Do this for one image only as it will be checked again next time\r\n\t\t\t\t\t\t// anyway\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tif (!this._elements.wrapper) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet bbox: DOMRect | ClientRect;\r\n\t\t\t\tif ((forceResize || !this._sized) && this._bbox) {\r\n\t\t\t\t\tbbox = this._bbox;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tbbox = this._elements.wrapper.getBoundingClientRect();\r\n\t\t\t\t\tthis._elements.wrapper.style.opacity = \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set horizontal positioning\r\n\t\t\t\tswitch (this.align) {\r\n\t\t\t\t\tcase \"left\":\r\n\t\t\t\t\t\tthis._elements.wrapper.style.left = \"0\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.right = \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginLeft = this.toStyle(this._shift.x + this._tempShift.x);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"center\":\r\n\t\t\t\t\t\tthis._elements.wrapper.style.left = \"50%\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.right = \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginLeft = this.toStyle(Math.round(-bbox.width / 2) + (this._shift.x + this._tempShift.x));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"right\":\r\n\t\t\t\t\t\tthis._elements.wrapper.style.left = \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.right = \"0\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginLeft = this.toStyle(this._shift.x + this._tempShift.x);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthis._elements.wrapper.style.left = this.toStyle(this.left) || \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.right = this.toStyle(this.right) || \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginLeft = this.toStyle(this._shift.x + this._tempShift.x);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set vertical positioning\r\n\t\t\t\tswitch (this.verticalAlign) {\r\n\t\t\t\t\tcase \"top\":\r\n\t\t\t\t\t\tthis._elements.wrapper.style.top = \"0\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.bottom = \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginTop = this.toStyle(this._shift.y + this._tempShift.y);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"middle\":\r\n\t\t\t\t\t\tthis._elements.wrapper.style.top = \"50%\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.bottom = \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginTop = this.toStyle(Math.round(-bbox.height / 2) + (this._shift.y + this._tempShift.y));\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"bottom\":\r\n\t\t\t\t\t\tthis._elements.wrapper.style.top = \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.bottom = \"0\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginTop = this.toStyle(this._shift.y + this._tempShift.y);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthis._elements.wrapper.style.top = this.toStyle(this.top) || \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.bottom = this.toStyle(this.bottom) || \"auto\";\r\n\t\t\t\t\t\tthis._elements.wrapper.style.marginTop = this.toStyle(this._shift.y + this._tempShift.y);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t}, 1);\r\n\t\t}, 1);\r\n\r\n\t}\r\n\r\n\tprotected setupDragging(): void {\r\n\t\tif (this.draggable) {\r\n\t\t\tif (!this._IOs.header.events.has(\"drag\")) {\r\n\t\t\t\tthis._IOs.header.events.on(\"drag\", (ev) => {\r\n\t\t\t\t\tthis._tempShift.x = ev.shift.x;\r\n\t\t\t\t\tthis._tempShift.y = ev.shift.y;\r\n\t\t\t\t\tthis.positionElement(false);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (!this._IOs.header.events.has(\"dragstop\")) {\r\n\t\t\t\tthis._IOs.header.events.on(\"dragstop\", (ev) => {\r\n\t\t\t\t\tthis._shift.x += this._tempShift.x;\r\n\t\t\t\t\tthis._shift.y += this._tempShift.y;\r\n\t\t\t\t\tthis._tempShift.x = 0;\r\n\t\t\t\t\tthis._tempShift.y = 0;\r\n\t\t\t\t\tthis.positionElement(false);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (this._IOs.header) {\r\n\t\t\t\tgetInteraction().unprepElement(this._IOs.header);\r\n\t\t\t\tif (this._IOs.header.events.has(\"drag\")) {\r\n\t\t\t\t\tthis._IOs.header.events.off(\"drag\");\r\n\t\t\t\t}\r\n\t\t\t\tif (this._IOs.header.events.has(\"dragstop\")) {\r\n\t\t\t\t\tthis._IOs.header.events.off(\"dragstop\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected toStyle(value: number | Percent): string | null {\r\n\t\tif (!$type.hasValue(value)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\telse if ($type.isNumber(value)) {\r\n\t\t\treturn \"\" + value + \"px\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn value.toString();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A prefix that is applied to class names of various popup elements.\r\n\t *\r\n\t * @return Class name prefix\r\n\t */\r\n\tpublic get classPrefix(): string {\r\n\t\treturn this.adapter.apply(\"classPrefix\", this._classPrefix);\r\n\t}\r\n\r\n\t/**\r\n\t * @param value Class name prefix\r\n\t */\r\n\tpublic set classPrefix(value: string) {\r\n\t\tthis._classPrefix = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns raw prefix (without adapters applied).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Class name prefix\r\n\t */\r\n\tpublic get classPrefixRaw(): string {\r\n\t\treturn this._classPrefix;\r\n\t}\r\n\r\n\t/**\r\n\t * Popup content.\r\n\t *\r\n\t * Popup content can be any valid HTML, including CSS.\r\n\t *\r\n\t * @param value Popup content\r\n\t */\r\n\tpublic set content(value: string) {\r\n\t\tif (this._content != value) {\r\n\t\t\tthis._content = value;\r\n\t\t\tif (!this._elements.content) {\r\n\t\t\t\tthis.createContentElement();\r\n\t\t\t}\r\n\t\t\tthis._elements.content.innerHTML = value;\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Popup content\r\n\t */\r\n\tpublic get content(): string {\r\n\t\treturn this.adapter.apply(\"content\", this._content);\r\n\t}\r\n\r\n\tprotected getClassNames() {\r\n\t\treturn this.adapter.apply(\"classNames\", {\r\n\t\t\twrapperClass: this.classPrefix + \"\",\r\n\t\t\theaderClass: this.classPrefix + \"-header\",\r\n\t\t\ttitleClass: this.classPrefix + \"-title\",\r\n\t\t\tcontentClass: this.classPrefix + \"-content\",\r\n\t\t\tinsideClass: this.classPrefix + \"-inside\",\r\n\t\t\tcurtainClass: this.classPrefix + \"-curtain\",\r\n\t\t\tcloseClass: this.classPrefix + \"-close\"\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Creates content element.\r\n\t */\r\n\tprotected createContentElement(): void {\r\n\r\n\t\t// Check if it's created already\r\n\t\tif (this._elements.wrapper) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Get class names for popup elements\r\n\t\tlet classNames = this.getClassNames();\r\n\r\n\t\t// Create content element\r\n\t\tlet wrapper = document.createElement(\"div\");\r\n\t\twrapper.className = classNames.contentClass;\r\n\t\twrapper.style.opacity = \"0.01\";\r\n\r\n\t\t// Create close button\r\n\t\tlet close = document.createElement(\"a\");\r\n\t\tclose.className = classNames.closeClass;\r\n\r\n\t\t// header title\r\n\t\tconst header = document.createElement(\"div\");\r\n\t\theader.className = classNames.headerClass;\r\n\r\n\t\t// Content title\r\n\t\tlet title = document.createElement(\"div\");\r\n\t\ttitle.innerHTML = this.title;\r\n\t\ttitle.className = classNames.titleClass;\r\n\t\tif (!this.title) {\r\n\t\t\ttitle.style.display = \"none\";\r\n\t\t}\r\n\r\n\t\t// Content div\r\n\t\tlet content = document.createElement(\"div\");\r\n\t\tcontent.className = classNames.insideClass;\r\n\t\tcontent.innerHTML = this.content;\r\n\r\n\t\t// Set up events for content\r\n\t\tthis._IOs.wrapper = getInteraction().getInteraction(wrapper);\r\n\t\tthis._IOs.header = getInteraction().getInteraction(header);\r\n\t\tthis._disposers.push(this._IOs.wrapper);\r\n\r\n\t\t// Set hover/out events\r\n\t\tthis._IOs.wrapper.events.on(\"over\", this.disablePointers, this);\r\n\t\tthis._IOs.wrapper.events.on(\"out\", this.releasePointers, this);\r\n\r\n\t\t// Create an InteractionObject for close\r\n\t\tthis._IOs.close = getInteraction().getInteraction(close);\r\n\t\tthis._disposers.push(this._IOs.close);\r\n\r\n\t\t// Hide close for now\r\n\t\tclose.style.visibility = \"hidden\";\r\n\r\n\t\t// Add accessible stuff\r\n\t\twrapper.setAttribute(\"role\", \"dialog\");\r\n\r\n\t\t// Add to wrapper\r\n\t\theader.appendChild(close);\r\n\t\theader.appendChild(title);\r\n\t\twrapper.appendChild(header);\r\n\t\twrapper.appendChild(content);\r\n\t\tthis.container.appendChild(wrapper);\r\n\r\n\t\t// Save for later access\r\n\t\tthis._elements.wrapper = wrapper;\r\n\t\tthis._elements.header = header;\r\n\t\tthis._elements.content = content;\r\n\t\tthis._elements.title = title;\r\n\t\tthis._elements.close = close;\r\n\r\n\t\t// Load CSS\r\n\t\tif (this.defaultStyles) {\r\n\t\t\tthis.loadDefaultCSS();\r\n\t\t}\r\n\r\n\t\t// Create curtain as well\r\n\t\tthis.createCurtainElement();\r\n\r\n\t\t// Apply events\r\n\t\tthis.applyEvents();\r\n\r\n\t\tthis.applyReaderSettings();\r\n\r\n\t\t// Draggable?\r\n\t\tthis.setupDragging();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Popup title.\r\n\t *\r\n\t * Popup title can be any valid HTML, including CSS.\r\n\t *\r\n\t * @param value  Popup title\r\n\t */\r\n\tpublic set title(value: string) {\r\n\t\tif (this._title != value) {\r\n\t\t\tthis._title = value;\r\n\t\t\tif (!this._elements.content) {\r\n\t\t\t\tthis.createContentElement();\r\n\t\t\t}\r\n\t\t\tthis._elements.title.innerHTML = value;\r\n\t\t\tthis.positionElement();\r\n\t\t\tthis.applyReaderSettings();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Popup title\r\n\t */\r\n\tpublic get title(): string {\r\n\t\treturn this.adapter.apply(\"title\", this._title);\r\n\t}\r\n\r\n\t/**\r\n\t * A title for screen readers. It is very highly recommended to set that title\r\n\t * so that people using screen reader tools can get an immediate summary of\r\n\t * the information in the popup.\r\n\t *\r\n\t * @param value  Reader title\r\n\t */\r\n\tpublic set readerTitle(value: string) {\r\n\t\tif (this._readerTitle != value) {\r\n\t\t\tthis._readerTitle = value;\r\n\t\t\tthis.applyReaderSettings();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Popup content\r\n\t */\r\n\tpublic get readerTitle(): string {\r\n\t\treturn this.adapter.apply(\r\n\t\t\t\"readerTitle\",\r\n\t\t\tthis._readerTitle != \"\" ? this._readerTitle : this.title\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Is popup closable?\r\n\t *\r\n\t * If it is, it can be closed in a number of ways, e.g. by hitting ESC key,\r\n\t * clicking curtain, or clicking the close button.\r\n\t *\r\n\t * If it is not closable, the only way to close it is via `close()` call.\r\n\t *\r\n\t * @param value Closable?\r\n\t */\r\n\tpublic set closable(value: boolean) {\r\n\t\tif (value !== this._closable) {\r\n\t\t\tthis._closable = value;\r\n\t\t\tthis.applyEvents();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Closable?\r\n\t */\r\n\tpublic get closable(): boolean {\r\n\t\treturn this.adapter.apply(\"closable\", this._closable);\r\n\t}\r\n\r\n\t/**\r\n\t * If set to other than \"none\" will try to re-adjust the position of the\r\n\t * popop to fit within chart container or browser window.\r\n\t *\r\n\t * @ignore\r\n\t * @todo Implement\r\n\t * @default \"window\"\r\n\t * @param value  Fit option\r\n\t */\r\n\tpublic set fitTo(value: \"none\" | \"container\" | \"window\") {\r\n\t\tif (value != this._fitTo) {\r\n\t\t\tthis._fitTo = value;\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * @todo Implement\r\n\t * @return Fit option\r\n\t */\r\n\tpublic get fitTo(): \"none\" | \"container\" | \"window\" {\r\n\t\treturn this.adapter.apply(\"fitTo\", this._fitTo);\r\n\t}\r\n\r\n\t/**\r\n\t * Should popup use default CSS?\r\n\t *\r\n\t * If default CSS is disabled, an external CSS should handle the look of the\r\n\t * popup, since it will look quite out of place otherwise.\r\n\t *\r\n\t * @default true\r\n\t * @param Use default CSS?\r\n\t */\r\n\tpublic set defaultStyles(value: boolean) {\r\n\t\tif (this._defaultStyles != value) {\r\n\t\t\tthis._defaultStyles = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Use default CSS?\r\n\t */\r\n\tpublic get defaultStyles(): boolean {\r\n\t\treturn this.adapter.apply(\"defaultStyles\", this._defaultStyles);\r\n\t}\r\n\r\n\t/**\r\n\t * Should popup use dim out all content behind it?\r\n\t *\r\n\t * @default false\r\n\t * @param Show curtain?\r\n\t */\r\n\tpublic set showCurtain(value: boolean) {\r\n\t\tif (this._showCurtain != value) {\r\n\t\t\tthis._showCurtain = value;\r\n\t\t\tif (this._elements.curtain) {\r\n\t\t\t\tthis._elements.curtain.style.display = value ? \"block\" : \"none\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Show curtain?\r\n\t */\r\n\tpublic get showCurtain(): boolean {\r\n\t\treturn this.adapter.apply(\"showCurtain\", this._showCurtain);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates curtain element.\r\n\t */\r\n\tprotected createCurtainElement(): void {\r\n\r\n\t\t// Get class names for popup elements\r\n\t\tlet classNames = this.getClassNames();\r\n\r\n\t\t// Create the curtain\r\n\t\tlet curtain = document.createElement(\"div\");\r\n\t\tcurtain.className = classNames.curtainClass;\r\n\r\n\t\t// Append curtain to wrapper\r\n\t\tthis.container.appendChild(curtain);\r\n\r\n\t\t// Create an InteractionObject for curtain because we might need to\r\n\t\t// set interactions on it\r\n\t\tthis._IOs.curtain = getInteraction().getInteraction(curtain);\r\n\r\n\t\t// Add Curtain IO to disposers\r\n\t\tthis._disposers.push(this._IOs.curtain);\r\n\r\n\t\t// Set events to disable underlying interactivity\r\n\t\tthis._IOs.curtain.events.on(\"over\", this.disablePointers, this);\r\n\t\tthis._IOs.curtain.events.on(\"out\", this.releasePointers, this);\r\n\r\n\t\t// Hide it?\r\n\t\tcurtain.style.display = this.showCurtain ? \"block\" : \"none\";\r\n\r\n\t\t// Save for later\r\n\t\tthis._elements.curtain = curtain;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Can the popup be dragged with a pointer?\r\n\t *\r\n\t * @default false\r\n\t * @param Show curtain?\r\n\t */\r\n\tpublic set draggable(value: boolean) {\r\n\t\tif (this._draggable != value) {\r\n\t\t\tthis._draggable = value;\r\n\t\t\tthis.setupDragging();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Show curtain?\r\n\t */\r\n\tpublic get draggable(): boolean {\r\n\t\treturn this.adapter.apply(\"draggable\", this._draggable);\r\n\t}\r\n\r\n\t/**\r\n\t * Resize popup as images are being loaded.\r\n\t *\r\n\t * @default true\r\n\t * @since 4.9.17\r\n\t * @param Resize dynamically?\r\n\t */\r\n\tpublic set dynamicResize(value: boolean) {\r\n\t\tif (this._dynamicResize != value) {\r\n\t\t\tthis._dynamicResize = value;\r\n\t\t\tthis.positionElement(true);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Resize dynamically?\r\n\t */\r\n\tpublic get dynamicResize(): boolean {\r\n\t\treturn this.adapter.apply(\"dynamicResize\", this._dynamicResize);\r\n\t}\r\n\r\n\t/**\r\n\t * Horizontal positioning of the content window.\r\n\t *\r\n\t * Available options: \"left\", \"center\" (default), \"right\", and \"none\".\r\n\t *\r\n\t * @default \"center\"\r\n\t * @param Horizontal position\r\n\t */\r\n\tpublic set align(value: Align) {\r\n\t\tif (this._align != value) {\r\n\t\t\tthis._align = value;\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Horizontal position\r\n\t */\r\n\tpublic get align(): Align {\r\n\t\treturn this.adapter.apply(\"align\", this._align);\r\n\t}\r\n\r\n\t/**\r\n\t * Vertical positioning of the content window.\r\n\t *\r\n\t * Available options: \"top\", \"middle\" (default), \"bottom\", and \"none\".\r\n\t *\r\n\t * @default \"middle\"\r\n\t * @param Vertical position\r\n\t */\r\n\tpublic set verticalAlign(value: VerticalAlign) {\r\n\t\tif (this._verticalAlign != value) {\r\n\t\t\tthis._verticalAlign = value;\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Vertical position\r\n\t */\r\n\tpublic get verticalAlign(): VerticalAlign {\r\n\t\treturn this.adapter.apply(\"verticalAlign\", this._verticalAlign);\r\n\t}\r\n\r\n\t/**\r\n\t * \"left\" coordinate of a non-aligned (`align = \"none\"`) popup.\r\n\t *\r\n\t * Can be either absolute pixel value, or relative (`Percent`).\r\n\t *\r\n\t * Setting this property will automatically set `align` to \"none\".\r\n\t *\r\n\t * NOTE: The position is relative to the chart container.\r\n\t *\r\n\t * @param Left\r\n\t */\r\n\tpublic set left(value: number | Percent) {\r\n\t\tif (this.left != value) {\r\n\t\t\tthis._left = value;\r\n\t\t\tthis._align = \"none\";\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Left\r\n\t */\r\n\tpublic get left(): number | Percent {\r\n\t\treturn this.adapter.apply(\"left\", this._left);\r\n\t}\r\n\r\n\t/**\r\n\t * \"right\" coordinate of a non-aligned (`align = \"none\"`) popup.\r\n\t *\r\n\t * Can be either absolute pixel value, or relative (`Percent`).\r\n\t *\r\n\t * Setting this property will automatically set `align` to \"none\".\r\n\t *\r\n\t * NOTE: The position is relative to the chart container.\r\n\t *\r\n\t * @param Right\r\n\t */\r\n\tpublic set right(value: number | Percent) {\r\n\t\tif (this.right != value) {\r\n\t\t\tthis._right = value;\r\n\t\t\tthis._align = \"none\";\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Right\r\n\t */\r\n\tpublic get right(): number | Percent {\r\n\t\treturn this.adapter.apply(\"right\", this._right);\r\n\t}\r\n\r\n\t/**\r\n\t * \"top\" coordinate of a non-aligned (`verticalAlign = \"none\"`) popup.\r\n\t *\r\n\t * Can be either absolute pixel value, or relative (`Percent`).\r\n\t *\r\n\t * Setting this property will automatically set `verticalAlign` to \"none\".\r\n\t *\r\n\t * NOTE: The position is relative to the chart container.\r\n\t *\r\n\t * @param Top\r\n\t */\r\n\tpublic set top(value: number | Percent) {\r\n\t\tif (this.top != value) {\r\n\t\t\tthis._top = value;\r\n\t\t\tthis._verticalAlign = \"none\";\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Top\r\n\t */\r\n\tpublic get top(): number | Percent {\r\n\t\treturn this.adapter.apply(\"top\", this._top);\r\n\t}\r\n\r\n\t/**\r\n\t * \"bottom\" coordinate of a non-aligned (`verticalAlign = \"none\"`) popup.\r\n\t *\r\n\t * Can be either absolute pixel value, or relative (`Percent`).\r\n\t *\r\n\t * Setting this property will automatically set `verticalAlign` to \"none\".\r\n\t *\r\n\t * NOTE: The position is relative to the chart container.\r\n\t *\r\n\t * @param Bottom\r\n\t */\r\n\tpublic set bottom(value: number | Percent) {\r\n\t\tif (this.bottom != value) {\r\n\t\t\tthis._bottom = value;\r\n\t\t\tthis._verticalAlign = \"none\";\r\n\t\t\tthis.positionElement();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Bottom\r\n\t */\r\n\tpublic get bottom(): number | Percent {\r\n\t\treturn this.adapter.apply(\"bottom\", this._bottom);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an object with references to various elements of the Popup.\r\n\t *\r\n\t * * `wrapper`\r\n\t * * `title`\r\n\t * * `content`\r\n\t * * `close`\r\n\t * * `curtain`\r\n\t */\r\n\tpublic get elements(): {\r\n\t\twrapper?: HTMLElement;\r\n\t\ttitle?: HTMLElement;\r\n\t\tcontent?: HTMLElement;\r\n\t\tclose?: HTMLElement;\r\n\t\tcurtain?: HTMLElement;\r\n\t} {\r\n\t\treturn this._elements;\r\n\t}\r\n\r\n\t/**\r\n\t * Loads popup CSS.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic loadDefaultCSS(): void {\r\n\t\tif (!this._cssLoaded) {\r\n\t\t\tthis._disposers.push(popupCSS(getShadowRoot(this.container), this.classPrefix));\r\n\t\t\t$object.each(this._elements, (key, el) => {\r\n\t\t\t\tel.style.display = \"\";\r\n\t\t\t});\r\n\t\t\tthis._cssLoaded = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * If popup is closable, this method adds various events to popup elements.\r\n\t */\r\n\tprotected applyEvents(): void {\r\n\t\tif (this._IOs.close) {\r\n\t\t\tif (this.closable) {\r\n\t\t\t\tthis._IOs.close.element.style.visibility = \"visible\";\r\n\r\n\t\t\t\tlet disposers = [\r\n\t\t\t\t\tgetInteraction().body.events.on(\"keyup\", (ev) => {\r\n\t\t\t\t\t\tif (keyboard.isKey(ev.event, \"esc\") && this.closable) {\r\n\t\t\t\t\t\t\tthis.close()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tthis._IOs.close.events.on(\"hit\", (ev) => {\r\n\t\t\t\t\t\tthis.close();\r\n\t\t\t\t\t})\r\n\t\t\t\t];\r\n\t\t\t\tdisposers.push(this._IOs.curtain.events.on(\"hit\", (ev) => {\r\n\t\t\t\t\tif (this.showCurtain && this.closable) {\r\n\t\t\t\t\t\tthis.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t\tthis._disposers.push(new MultiDisposer(disposers));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._IOs.close.element.style.visibility = \"hidden\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Disables interactivity on parent chart.\r\n\t */\r\n\tprotected disablePointers(): void {\r\n\t\tif (this.sprite) {\r\n\t\t\tthis._spriteInteractionsEnabled = this.sprite.interactionsEnabled;\r\n\t\t\tthis.sprite.interactionsEnabled = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Releases temporarily disabled pointers on parent chart.\r\n\t */\r\n\tprotected releasePointers(): void {\r\n\t\tif ($type.hasValue(this._spriteInteractionsEnabled)) {\r\n\t\t\tthis.sprite.interactionsEnabled = this._spriteInteractionsEnabled;\r\n\t\t\tthis._spriteInteractionsEnabled = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets screen reader related settings.\r\n\t */\r\n\tprotected applyReaderSettings(): void {\r\n\t\tthis.elements.wrapper.setAttribute(\"aria-label\", this.readerTitle);\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all properties and related data from different element.\r\n\t *\r\n\t * @param object Source element\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\tsuper.copyFrom(source);\r\n\t\tthis.container = source.container;\r\n\t\tthis.sprite = source.sprite;\r\n\t\tthis.classPrefix = source.classPrefixRaw;\r\n\t\tthis.content = source.content;\r\n\t\tthis.title = source.title;\r\n\t\tthis.readerTitle = source.readerTitle;\r\n\t\tthis.defaultStyles = source.defaultStyles;\r\n\t\tthis.showCurtain = source.showCurtain;\r\n\t\tthis.align = source.align;\r\n\t\tthis.verticalAlign = source.verticalAlign;\r\n\t\tthis.left = source.left;\r\n\t\tthis.right = source.right;\r\n\t\tthis.top = source.top;\r\n\t\tthis.bottom = source.bottom;\r\n\t\tthis.adapter.copyFrom(source.adapter);\r\n\t}\r\n\r\n}\r\n","/**\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Color, color } from \"../utils/Color\"\r\n\r\n/**\r\n * Defines a class that holds default properties for new SVG elements\r\n */\r\nexport class SVGDefaults {\r\n\tstatic opacity: number = 1;\r\n\tstatic strokeOpacity: number = 1;\r\n\tstatic strokeWidth: number = 1;\r\n\tstatic fillOpacity: number = 1;\r\n\tstatic fill: Color = color(\"#000000\");\r\n\tstatic stroke: Color = color(\"#000000\");\r\n\tstatic focusable: boolean = undefined;\r\n\tstatic tabindex: number = 0;\r\n}\r\n","/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { AMElement } from \"./AMElement\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Creates an SVG `<g>` element.\r\n *\r\n * SVG groups are used for elements that need more elements just one.\r\n *\r\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/SVG/Element/g} About `<g>` element\r\n */\r\nexport class Group extends AMElement {\r\n\r\n\t/**\r\n\t * Constructor.\r\n\t *\r\n\t * @param elementName Element type (should be \"g\")\r\n\t */\r\n\tconstructor(elementName: string) {\r\n\t\tsuper(elementName);\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an element to group.\r\n\t *\r\n\t * This will manipulate DOM. `element` will be physically moved into group.\r\n\t *\r\n\t * @param element  Element\r\n\t */\r\n\tpublic add(element: AMElement): void {\r\n\t\tif (element) {\r\n\t\t\tthis.node.appendChild(element.node);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an element to group.\r\n\t *\r\n\t * This will manipulate DOM. `element` will be physically moved into group.\r\n\t *\r\n\t * @param element  Element\r\n\t */\r\n\tpublic addToBack(element: AMElement): void {\r\n\t\tif (element) {\r\n\t\t\tlet first = this.node.childNodes[0];\r\n\t\t\tif (first) {\r\n\t\t\t\tif (first != element.node) {\r\n\t\t\t\t\tthis.node.insertBefore(element.node, first);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.node.appendChild(element.node);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes the `element` from group.\r\n\t *\r\n\t * Please note that this will not dispose the element itself, it will just\r\n\t * remove it from the group.\r\n\t *\r\n\t * @param element  Element\r\n\t */\r\n\tpublic removeElement(element: AMElement): void {\r\n\t\t// todo: not sure about the speed, need to investigate, maybe it's faster to check if node is a child\r\n\t\tif (element) {\r\n\t\t\ttry {\r\n\t\t\t\tif (element.node && element.node.parentNode == this.node) {\r\n\t\t\t\t\tthis.node.removeChild(element.node);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcatch (err) {\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Checks if this group already has the child element added\r\n\t *\r\n\t * @param element\r\n\t * @return {boolean}\r\n\t */\r\n\tpublic hasChild(element:AMElement):boolean {\r\n\t\tfor(let i = 0; i < this.node.childNodes.length; i++){\r\n\t\t\tif(this.node.childNodes[i] == element.node){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Content of the group element.\r\n\t *\r\n\t * Can be used to add a lot of proprietary SVG markup into group.\r\n\t *\r\n\t * @param value  SVG markup\r\n\t */\r\n\tpublic set content(value: string) {\r\n\t\tthis.node.innerHTML = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return SVG markup\r\n\t */\r\n\tpublic get content(): string {\r\n\t\treturn this.node.innerHTML;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes all children from the group.\r\n\t */\r\n\tpublic removeChildren(): void {\r\n\t\tif (this.node.childNodes) {\r\n\t\t\twhile (this.node.childNodes.length > 0) {\r\n\t\t\t\tlet childNode = this.node.firstChild;\r\n\t\t\t\tif (childNode && childNode.parentNode) {\r\n\t\t\t\t\tchildNode.parentNode.removeChild(childNode);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * Interaction Object module\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { IInteractionObjectEvents, InteractionObjectEventDispatcher } from \"./InteractionObjectEvents\";\r\nimport { BaseObjectEvents } from \"../Base\";\r\nimport { Sprite } from \"../Sprite\";\r\nimport { List } from \"../utils/List\";\r\nimport { Dictionary, DictionaryDisposer } from \"../utils/Dictionary\";\r\nimport { AMEvent } from \"../utils/EventDispatcher\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { IPointer } from \"./Pointer\";\r\nimport { IInertiaOptions, ISwipeOptions, IHitOptions, IHoverOptions, ICursorOptions, IKeyboardOptions, IMouseOptions } from \"./InteractionOptions\";\r\nimport { getInteraction } from \"./Interaction\";\r\nimport { Inertia, InertiaTypes } from \"./Inertia\";\r\nimport { IDisposer } from \"../utils/Disposer\";\r\nimport { Optional } from \"../utils/Type\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n\r\n/**\r\n * Re-exports\r\n */\r\nexport { IInteractionObjectEvents, InteractionObjectEventDispatcher };\r\n\r\n/**\r\n * Interaction object represents an object that is subject for any kind of\r\n * interaction with it with any input devices: mouse, touch or keyboard.\r\n *\r\n * Any DOM element can be wrapped into an Internaction object which in turn\r\n * enables attaching various interaction events to it, such as: hit, drag,\r\n * swipe, etc.\r\n *\r\n * To create an [[InteractionObject]] out of a [[Sprite]], use:\r\n * `interaction.getInteractionFromSprite(sprite: Sprite)`\r\n *\r\n * To create an [[InteractionObject]] out of a a regular element:\r\n * `interaction.getInteraction(element: HTMLElement)`\r\n */\r\nexport class InteractionObject extends BaseObjectEvents {\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IInteractionObjectEvents;\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * An [[EventDispatcher]] instance which holds events for this object\r\n\t */\r\n\tpublic _eventDispatcher: InteractionObjectEventDispatcher<AMEvent<this, this[\"_events\"]>> = new InteractionObjectEventDispatcher(this);;\r\n\r\n\t/**\r\n\t * An [[EventDispatcher]] instance which holds events for this object\r\n\t */\r\n\tpublic get events(): InteractionObjectEventDispatcher<AMEvent<this, this[\"_events\"]>> {\r\n\t\treturn this._eventDispatcher;\r\n\t}\r\n\r\n\t/**\r\n\t * A related [[Sprite]] if any.\r\n\t */\r\n\tpublic sprite!: Sprite;\r\n\r\n\t/**\r\n\t * Collection of Disposers for various events. (so that those get disposed\r\n\t * when the whole InteractionObject is disposed)\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic eventDisposers: Dictionary<string, IDisposer> = new Dictionary<string, IDisposer>();\r\n\r\n\t/**\r\n\t * A [[Dictionary]] that holds temporarily replaced original style values for\r\n\t * HTML element, so that they can be restored when the functionality that\r\n\t * replaced them is done.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic replacedStyles: Dictionary<string, string> = new Dictionary<string, string>();\r\n\r\n\tprotected _clickable: boolean = false;\r\n\tprotected _contextMenuDisabled: boolean = false;\r\n\tprotected _hoverable: boolean = false;\r\n\tprotected _trackable: boolean = false;\r\n\tprotected _draggable: boolean = false;\r\n\tprotected _swipeable: boolean = false;\r\n\tprotected _resizable: boolean = false;\r\n\tprotected _wheelable: boolean = false;\r\n\tprotected _inert: boolean = false;\r\n\tprotected _focusable: $type.Optional<boolean>;\r\n\tprotected _tabindex: Optional<number>;\r\n\r\n\t/**\r\n\t * Element to attach events to.\r\n\t */\r\n\tprivate _element: HTMLElement | SVGSVGElement;\r\n\r\n\t/**\r\n\t * Original coordinates for the [[InteractionObject]]. (before application\r\n\t * of the drag)\r\n\t */\r\n\tpublic _originalPosition: Optional<IPoint>;\r\n\r\n\t/**\r\n\t * Original angle for the [[InteractionObject]]. (before rotation started)\r\n\t */\r\n\tpublic _originalAngle: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * Original scale of the [[InteractionObject]]. (before resizing started)\r\n\t */\r\n\tpublic _originalScale: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * List of pointers current over element.\r\n\t */\r\n\tprotected _overPointers: $type.Optional<List<IPointer>>;\r\n\r\n\t/**\r\n\t * List of pointer currently pressing down on element.\r\n\t */\r\n\tprotected _downPointers: $type.Optional<List<IPointer>>;\r\n\r\n\t/**\r\n\t * Is element currently hovered?\r\n\t */\r\n\tprotected _isHover: boolean = false;\r\n\r\n\t/**\r\n\t * Was this element hovered via pointer or is it just \"pretenting\" to be\r\n\t * hovered.\r\n\t * \r\n\t * @ignore\r\n\t */\r\n\tpublic isRealHover: boolean = false;\r\n\r\n\t/**\r\n\t * Is the element hovered by touch pointer?\r\n\t */\r\n\tprotected _isHoverByTouch: boolean = false;\r\n\r\n\t/**\r\n\t * Has element got any pointers currently pressing down on it?\r\n\t */\r\n\tprotected _isDown: boolean = false;\r\n\r\n\t/**\r\n\t * Does element have focus?\r\n\t */\r\n\tprotected _isFocused: boolean = false;\r\n\r\n\t/**\r\n\t * Is element currently protected from touch interactions?\r\n\t */\r\n\tprotected _isTouchProtected: boolean = false;\r\n\r\n\t/**\r\n\t * A timestamp of the last hit.\r\n\t *\r\n\t * Used to calculate double-hit.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic lastHit: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * A pointer element that was used for the last hit.\r\n\t *\r\n\t * We need to keep this since only the same pointer can generate doublehit.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo still needed?\r\n\t */\r\n\tpublic lastHitPointer: $type.Optional<IPointer>;\r\n\r\n\t/**\r\n\t * Indicates whether object has delayed events initiated by touch.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic hasDelayedOut?: boolean;\r\n\r\n\t/**\r\n\t * Options used for inertia functionality.\r\n\t */\r\n\tprivate _inertiaOptions: Dictionary<InertiaTypes, IInertiaOptions> = new Dictionary<InertiaTypes, IInertiaOptions>();\r\n\r\n\t/**\r\n\t * A collection of different inertia types, currently playing out.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic inertias: Dictionary<InertiaTypes, Inertia> = new Dictionary<InertiaTypes, Inertia>();\r\n\r\n\t/**\r\n\t * Click/tap options.\r\n\t */\r\n\tprivate _hitOptions: IHitOptions = {};\r\n\r\n\t/**\r\n\t * Hover options.\r\n\t */\r\n\tprivate _hoverOptions: IHoverOptions = {};\r\n\r\n\t/**\r\n\t * Swipe gesture options.\r\n\t */\r\n\tprivate _swipeOptions: ISwipeOptions = {};\r\n\r\n\t/**\r\n\t * Keyboard options.\r\n\t */\r\n\tprivate _keyboardOptions: IKeyboardOptions = {};\r\n\r\n\t/**\r\n\t * Mouse options.\r\n\t */\r\n\tprivate _mouseOptions: IMouseOptions = {};\r\n\r\n\t/**\r\n\t * Cursor options.\r\n\t */\r\n\tprivate _cursorOptions: ICursorOptions = {\r\n\t\t\"defaultStyle\": [{\r\n\t\t\t\"property\": \"cursor\",\r\n\t\t\t\"value\": \"default\"\r\n\t\t}]\r\n\t};\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor(element: HTMLElement | SVGSVGElement) {\r\n\t\tsuper();\r\n\t\t\r\n\t\tthis._disposers.push(this._eventDispatcher);\r\n\r\n\t\tthis._element = element;\r\n\t\tthis.className = \"InteractionObject\";\r\n\t\tthis._disposers.push(new DictionaryDisposer(this.inertias));\r\n\t\tthis._disposers.push(new DictionaryDisposer(this.eventDisposers));\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if this element is currently hovered.\r\n\t *\r\n\t * @param value Hovered?\r\n\t */\r\n\tpublic set isHover(value: boolean) {\r\n\t\tif (this.isHover != value) {\r\n\t\t\tthis._isHover = value;\r\n\t\t\tif (value) {\r\n\t\t\t\tgetInteraction().overObjects.moveValue(this);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.isRealHover = false;\r\n\t\t\t\tgetInteraction().overObjects.removeValue(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Hovered?\r\n\t */\r\n\tpublic get isHover(): boolean {\r\n\t\treturn this._isHover;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if this element is currently hovered.\r\n\t *\r\n\t * @param value Hovered?\r\n\t */\r\n\tpublic set isHoverByTouch(value: boolean) {\r\n\t\tif (this.isHoverByTouch != value) {\r\n\t\t\tthis._isHoverByTouch = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Hovered?\r\n\t */\r\n\tpublic get isHoverByTouch(): boolean {\r\n\t\treturn this._isHoverByTouch;\r\n\t}\r\n\r\n\t/**\r\n\t * A list of pointers currently over the element.\r\n\t *\r\n\t * @see {@link Pointer}\r\n\t * @return List if pointers currently hovering the element\r\n\t */\r\n\tpublic get overPointers(): List<IPointer> {\r\n\t\tif (!this._overPointers) {\r\n\t\t\tthis._overPointers = new List<IPointer>();\r\n\t\t}\r\n\t\treturn this._overPointers;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if this element has currently any pointers pressing on it.\r\n\t *\r\n\t * @param value Has down pointers?\r\n\t */\r\n\tpublic set isDown(value: boolean) {\r\n\t\tif (this.isDown != value) {\r\n\t\t\tthis._isDown = value;\r\n\t\t\tif (value) {\r\n\t\t\t\tgetInteraction().downObjects.moveValue(this);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tgetInteraction().downObjects.removeValue(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Has down pointers?\r\n\t */\r\n\tpublic get isDown(): boolean {\r\n\t\treturn this._isDown;\r\n\t}\r\n\r\n\t/**\r\n\t * A list of pointers currently pressing down on this element.\r\n\t *\r\n\t * @see {@link Pointer}\r\n\t * @return List of down pointers\r\n\t */\r\n\tpublic get downPointers(): List<IPointer> {\r\n\t\tif (!this._downPointers) {\r\n\t\t\tthis._downPointers = new List<IPointer>();\r\n\t\t}\r\n\t\treturn this._downPointers;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if this element is currently focused.\r\n\t *\r\n\t * @param value Focused?\r\n\t */\r\n\tpublic set isFocused(value: boolean) {\r\n\t\tif (this.isFocused != value) {\r\n\t\t\tthis._isFocused = value;\r\n\t\t\tif (value) {\r\n\t\t\t\tgetInteraction().focusedObject = this;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tgetInteraction().focusedObject = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Focused?\r\n\t */\r\n\tpublic get isFocused(): boolean {\r\n\t\treturn this._isFocused;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if this element is currently being protected from touch actions.\r\n\t *\r\n\t * @ignore\r\n\t * @param value Touch protected?\r\n\t */\r\n\tpublic set isTouchProtected(value: boolean) {\r\n\t\tif (this._isTouchProtected != value) {\r\n\t\t\tthis._isTouchProtected = value;\r\n\t\t\tif (value) {\r\n\t\t\t\tgetInteraction().unprepElement(this);\r\n\t\t\t}\r\n\t\t\telse if (this.draggable || this.swipeable || this.trackable || this.resizable) {\r\n\t\t\t\tgetInteraction().prepElement(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t * @return Touch protected?\r\n\t */\r\n\tpublic get isTouchProtected(): boolean {\r\n\t\treturn this._isTouchProtected;\r\n\t}\r\n\r\n\t/**\r\n\t * Is element clickable? Clickable elements will generate \"hit\" events when\r\n\t * clicked or tapped.\r\n\t *\r\n\t * @param value Clickable?\r\n\t */\r\n\tpublic set clickable(value: boolean) {\r\n\t\tif (this._clickable !== value) {\r\n\t\t\tthis._clickable = value;\r\n\t\t\tgetInteraction().processClickable(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Clickable?\r\n\t */\r\n\tpublic get clickable(): boolean {\r\n\t\treturn this._clickable;\r\n\t}\r\n\r\n\t/**\r\n\t * Should element prevent context menu to be displayed, e.g. when\r\n\t * right-clicked?\r\n\t *\r\n\t * @default false\r\n\t * @param value Context menu disabled?\r\n\t */\r\n\tpublic set contextMenuDisabled(value: boolean) {\r\n\t\tif (this._contextMenuDisabled !== value) {\r\n\t\t\tthis._contextMenuDisabled = value;\r\n\t\t\tgetInteraction().processContextMenu(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Context menu disabled?\r\n\t */\r\n\tpublic get contextMenuDisabled(): boolean {\r\n\t\treturn this._contextMenuDisabled;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if element should generate hover events.\r\n\t *\r\n\t * @param value Hoverable?\r\n\t */\r\n\tpublic set hoverable(value: boolean) {\r\n\t\tif (this._hoverable !== value) {\r\n\t\t\tthis._hoverable = value;\r\n\t\t\tgetInteraction().processHoverable(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Hoverable?\r\n\t */\r\n\tpublic get hoverable(): boolean {\r\n\t\treturn this._hoverable;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if pointer movement over element should be tracked.\r\n\t *\r\n\t * @param value Track pointer?\r\n\t */\r\n\tpublic set trackable(value: boolean) {\r\n\t\tif (this._trackable !== value) {\r\n\t\t\tthis._trackable = value;\r\n\t\t\tgetInteraction().processTrackable(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Track pointer?\r\n\t */\r\n\tpublic get trackable(): boolean {\r\n\t\treturn this._trackable;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if element can be dragged. (moved)\r\n\t *\r\n\t * @param value Draggable?\r\n\t */\r\n\tpublic set draggable(value: boolean) {\r\n\t\tif (this._draggable !== value) {\r\n\t\t\tthis._draggable = value;\r\n\t\t\tgetInteraction().processDraggable(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Draggable?\r\n\t */\r\n\tpublic get draggable(): boolean {\r\n\t\treturn this._draggable;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether element should react to swipe gesture.\r\n\t *\r\n\t * @param value Track swipe?\r\n\t */\r\n\tpublic set swipeable(value: boolean) {\r\n\t\tif (this._swipeable !== value) {\r\n\t\t\tthis._swipeable = value;\r\n\t\t\tgetInteraction().processSwipeable(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Track swipe?\r\n\t */\r\n\tpublic get swipeable(): boolean {\r\n\t\treturn this._swipeable;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if element can be resized.\r\n\t *\r\n\t * @param value Resizeable?\r\n\t */\r\n\tpublic set resizable(value: boolean) {\r\n\t\tif (this._resizable !== value) {\r\n\t\t\tthis._resizable = value;\r\n\t\t\tgetInteraction().processResizable(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Resizeble?\r\n\t */\r\n\tpublic get resizable(): boolean {\r\n\t\treturn this._resizable;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether track moouse wheel rotation over element.\r\n\t *\r\n\t * @param value Track wheel?\r\n\t */\r\n\tpublic set wheelable(value: boolean) {\r\n\t\tif (this._wheelable !== value) {\r\n\t\t\tthis._wheelable = value;\r\n\t\t\tgetInteraction().processWheelable(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Track wheel?\r\n\t */\r\n\tpublic get wheelable(): boolean {\r\n\t\treturn this._wheelable;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if element is inert, i.e. if it should carry movement momentum\r\n\t * after it is dragged and released.\r\n\t *\r\n\t * @param value Inert?\r\n\t */\r\n\tpublic set inert(value: boolean) {\r\n\t\tif (this._inert !== value) {\r\n\t\t\tthis._inert = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Inert?\r\n\t */\r\n\tpublic get inert(): boolean {\r\n\t\treturn this._inert;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates if element can gain focus.\r\n\t *\r\n\t * @param value Focusable?\r\n\t */\r\n\tpublic set focusable(value: $type.Optional<boolean>) {\r\n\t\tif (this._focusable !== value) {\r\n\t\t\tthis._focusable = value;\r\n\t\t\tif (this._focusable && this.tabindex == -1) {\r\n\t\t\t\tthis._tabindex = 1;\r\n\t\t\t}\r\n\t\t\tgetInteraction().processFocusable(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Focusable?\r\n\t */\r\n\tpublic get focusable(): $type.Optional<boolean> {\r\n\t\treturn this._focusable;\r\n\t}\r\n\r\n\t/**\r\n\t * Element's tab index.\r\n\t *\r\n\t * @param value Tab index\r\n\t */\r\n\tpublic set tabindex(value: number) {\r\n\t\tif (this._tabindex !== value) {\r\n\t\t\tthis._tabindex = value;\r\n\t\t\tif (value > -1) {\r\n\t\t\t\tthis.focusable = true;\r\n\t\t\t}\r\n\t\t\tgetInteraction().processFocusable(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tab index\r\n\t */\r\n\tpublic get tabindex(): number {\r\n\t\treturn $type.getValueDefault(this._tabindex, -1 as number);\r\n\t}\r\n\r\n\t/**\r\n\t * A DOM element associated with this element.\r\n\t *\r\n\t * @param element Element\r\n\t */\r\n\tpublic set element(element: HTMLElement | SVGSVGElement) {\r\n\t\tthis._element = element;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Element\r\n\t */\r\n\tpublic get element(): HTMLElement | SVGSVGElement {\r\n\t\treturn this._element;\r\n\t}\r\n\r\n\t/**\r\n\t * Element's original position.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value Position\r\n\t */\r\n\tpublic set originalPosition(value: Optional<IPoint>) {\r\n\t\tthis._originalPosition = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t * @return Position.\r\n\t */\r\n\tpublic get originalPosition(): Optional<IPoint> {\r\n\t\treturn this._originalPosition || { x: 0, y: 0 };\r\n\t}\r\n\r\n\t/**\r\n\t * Element's original scale.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value Scale\r\n\t */\r\n\tpublic set originalScale(value: number) {\r\n\t\tif (this._originalScale !== value) {\r\n\t\t\tthis._originalScale = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Scale\r\n\t */\r\n\tpublic get originalScale(): number {\r\n\t\treturn $type.getValueDefault(this._originalScale, 1 as number);\r\n\t}\r\n\r\n\t/**\r\n\t * Element's original angle.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param value Angle\r\n\t */\r\n\tpublic set originalAngle(value: number) {\r\n\t\tif (this._originalAngle !== value) {\r\n\t\t\tthis._originalAngle = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Angle\r\n\t */\r\n\tpublic get originalAngle(): number {\r\n\t\treturn $type.getValueDefault(this._originalAngle, 0 as number);\r\n\t}\r\n\r\n\t/**\r\n\t * Inertia options.\r\n\t *\r\n\t * @param value  Options\r\n\t */\r\n\tpublic set inertiaOptions(value: Dictionary<InertiaTypes, IInertiaOptions>) {\r\n\t\tthis._inertiaOptions = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Options\r\n\t */\r\n\tpublic get inertiaOptions(): Dictionary<InertiaTypes, IInertiaOptions> {\r\n\t\tif (this.sprite && this.sprite._adapterO) {\r\n\t\t\treturn this.sprite._adapterO.apply(\"inertiaOptions\", this._inertiaOptions);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._inertiaOptions;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hit options.\r\n\t *\r\n\t * @param value  Options\r\n\t */\r\n\tpublic set hitOptions(value: IHitOptions) {\r\n\t\tthis._hitOptions = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Options\r\n\t */\r\n\tpublic get hitOptions(): IHitOptions {\r\n\t\tif (this.sprite && this.sprite._adapterO) {\r\n\t\t\treturn this.sprite._adapterO.apply(\"hitOptions\", this._hitOptions);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._hitOptions;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hover options.\r\n\t *\r\n\t * @param value  Options\r\n\t */\r\n\tpublic set hoverOptions(value: IHoverOptions) {\r\n\t\tthis._hoverOptions = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Options\r\n\t */\r\n\tpublic get hoverOptions(): IHoverOptions {\r\n\t\tif (this.sprite && this.sprite._adapterO) {\r\n\t\t\treturn this.sprite._adapterO.apply(\"hoverOptions\", this._hoverOptions);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._hoverOptions;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Swipe options.\r\n\t *\r\n\t * @param value  Options\r\n\t */\r\n\tpublic set swipeOptions(value: ISwipeOptions) {\r\n\t\tthis._swipeOptions = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Options\r\n\t */\r\n\tpublic get swipeOptions(): ISwipeOptions {\r\n\t\tif (this.sprite && this.sprite._adapterO) {\r\n\t\t\treturn this.sprite._adapterO.apply(\"swipeOptions\", this._swipeOptions);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._swipeOptions;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Keyboard options.\r\n\t *\r\n\t * @param value  Options\r\n\t */\r\n\tpublic set keyboardOptions(value: IKeyboardOptions) {\r\n\t\tthis._keyboardOptions = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Options\r\n\t */\r\n\tpublic get keyboardOptions(): IKeyboardOptions {\r\n\t\tif (this.sprite && this.sprite._adapterO) {\r\n\t\t\treturn this.sprite._adapterO.apply(\"keyboardOptions\", this._keyboardOptions);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._keyboardOptions;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Mouse options.\r\n\t *\r\n\t * Enables controlling options related to the mouse, for example sensitivity\r\n\t * of its mouse wheel.\r\n\t *\r\n\t * E.g. the below will reduce chart's wheel-zoom speed to half its default\r\n\t * speed:\r\n\t *\r\n\t * ```TypeScript\r\n\t * chart.plotContainer.mouseOptions.sensitivity = 0.5;\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * chart.plotContainer.mouseOptions.sensitivity = 0.5;\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"plotContainer\": {\r\n\t *     \"mouseOptions\": {\r\n\t *       \"sensitivity\": 0.5\r\n\t *     }\r\n\t *   }\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @since 4.5.14\r\n\t * @param value  Options\r\n\t */\r\n\tpublic set mouseOptions(value: IMouseOptions) {\r\n\t\tthis._mouseOptions = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Options\r\n\t */\r\n\tpublic get mouseOptions(): IMouseOptions {\r\n\t\tif (this.sprite && this.sprite._adapterO) {\r\n\t\t\treturn this.sprite._adapterO.apply(\"mouseOptions\", this._mouseOptions);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._mouseOptions;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Cursor options.\r\n\t *\r\n\t * @param value  Options\r\n\t */\r\n\tpublic set cursorOptions(value: ICursorOptions) {\r\n\t\tthis._cursorOptions = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Options\r\n\t */\r\n\tpublic get cursorOptions(): ICursorOptions {\r\n\t\tif (this.sprite && this.sprite._adapterO) {\r\n\t\t\treturn this.sprite._adapterO.apply(\"cursorOptions\", this._cursorOptions);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._cursorOptions;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Copies all properties and related assets from another object of the same\r\n\t * type.\r\n\t *\r\n\t * @param source Source object\r\n\t */\r\n\tpublic copyFrom(source: this): void {\r\n\t\tsuper.copyFrom(source);\r\n\t\tthis.inertiaOptions = source.inertiaOptions;\r\n\t\tthis.hitOptions = source.hitOptions;\r\n\t\tthis.hoverOptions = source.hoverOptions;\r\n\t\tthis.swipeOptions = source.swipeOptions;\r\n\t\tthis.keyboardOptions = source.keyboardOptions;\r\n\t\tthis.cursorOptions = source.cursorOptions;\r\n\t\tthis.contextMenuDisabled = source.contextMenuDisabled;\r\n\t\tgetInteraction().applyCursorOverStyle(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic setEventDisposer(key: string, value: boolean, f: () => IDisposer): void {\r\n\t\tconst disposer = this.eventDisposers.getKey(key);\r\n\r\n\t\tif (value) {\r\n\t\t\tif (disposer == null) {\r\n\t\t\t\tthis.eventDisposers.setKey(key, f());\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tif (disposer != null) {\r\n\t\t\t\tdisposer.dispose();\r\n\t\t\t\tthis.eventDisposers.removeKey(key);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes object.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tsuper.dispose();\r\n\r\n\t\t// Remove from all interaction registries\r\n\t\tconst interaction = getInteraction();\r\n\t\tinteraction.overObjects.removeValue(this);\r\n\t\tinteraction.downObjects.removeValue(this);\r\n\t\tinteraction.trackedObjects.removeValue(this);\r\n\t\tinteraction.transformedObjects.removeValue(this);\r\n\r\n\t\t// Unlock document wheel\r\n\t\tif (this.isHover && this.wheelable) {\r\n\t\t\tinteraction.unlockWheel();\r\n\t\t}\r\n\r\n\t\tif (interaction.focusedObject === this) {\r\n\t\t\tinteraction.focusedObject = undefined;\r\n\t\t}\r\n\t}\r\n}\r\n","/**\r\n * Functionality related simulating of dragging of elements using keyboard.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { getInteraction } from \"./Interaction\";\r\nimport { InteractionObject } from \"./InteractionObject\";\r\nimport { IAnimationObject } from \"../utils/Animation\";\r\nimport { system } from \"../System\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { IDisposer } from \"../utils/Disposer\";\r\nimport * as $array from \"../utils/Array\";\r\n\r\n/**\r\n * [[InteractionKeyboardObject]] is used to simulate dragging of the `draggable`\r\n * element using keyboard arrows.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport class InteractionKeyboardObject implements IAnimationObject, IDisposer {\r\n\r\n\t/**\r\n\t * A [[InteractionObject]] representation of an element we're performing\r\n\t * animation on.\r\n\t */\r\n\tpublic interaction: InteractionObject;\r\n\r\n\t/**\r\n\t * Indicates if this object has already been deleted. Any\r\n\t * destruction/disposal code should take this into account when deciding\r\n\t * wheter to run potentially costly disposal operations if they already have\r\n\t * been run.\r\n\t */\r\n\tprotected _disposed: boolean = false;\r\n\r\n\t/**\r\n\t * Timestamp on when animation started.\r\n\t */\r\n\tprivate _startedOn: number;\r\n\r\n\t/**\r\n\t * Indicates direction of current horizontal movement.\r\n\t *\r\n\t * 0 - not moving horizontally\r\n\t * 1 - moving right\r\n\t * -1 - moving left\r\n\t */\r\n\tpublic directionX: 0 | 1 | -1 = 0;\r\n\r\n\t/**\r\n\t * Indicates direction of current vertical movement.\r\n\t *\r\n\t * 0 - not moving vertically\r\n\t * 1 - moving down\r\n\t * -1 - moving up\r\n\t */\r\n\tpublic directionY: 0 | 1 | -1 = 0;\r\n\r\n\t/**\r\n\t * Holds reference to original keyboard event.\r\n\t */\r\n\tpublic keyboardEvent: KeyboardEvent;\r\n\r\n\t/**\r\n\t * Constructor.\r\n\t *\r\n\t * @param io An InteractionObject\r\n\t */\r\n\tconstructor(io: InteractionObject, ev: KeyboardEvent) {\r\n\t\tthis.interaction = io;\r\n\t\tthis.keyboardEvent = ev;\r\n\t\tthis._startedOn = new Date().getTime();\r\n\t\tgetInteraction().processDragStart(io);\r\n\t\tsystem.animations.push(this);\r\n\t\tthis.update();\r\n\t}\r\n\r\n\t/**\r\n\t * It's an update method which is called by the system if\r\n\t * [[InteractionObject]] is used as animation.\r\n\t *\r\n\t * This will update coordinates of the element based on the movement\r\n\t * directions.\r\n\t */\r\n\tpublic update(): void {\r\n\r\n\t\t// Init and get settings\r\n\t\tlet io = this.interaction;\r\n\t\tlet speed = getInteraction().getKeyboardOption(io, \"speed\"),\r\n\t\t\taccelleration = getInteraction().getKeyboardOption(io, \"accelleration\"),\r\n\t\t\taccellerationDelay = getInteraction().getKeyboardOption(io, \"accellerationDelay\"),\r\n\t\t\tshift: IPoint = {\r\n\t\t\t\tx: 0,\r\n\t\t\t\ty: 0\r\n\t\t\t};\r\n\r\n\t\t// If SHIFT key is pressed we slash speed by half and disable accelleration\r\n\t\tif (this.keyboardEvent.shiftKey) {\r\n\t\t\tspeed *= 0.5;\r\n\t\t\taccelleration = 1;\r\n\t\t}\r\n\t\t// If CTRL is pressed we increase speed by x2\r\n\t\telse if (this.keyboardEvent.ctrlKey) {\r\n\t\t\tspeed *= 2;\r\n\t\t}\r\n\r\n\t\t// Get elapsed time\r\n\t\tlet ms = new Date().getTime() - this._startedOn;\r\n\t\tlet accelleratedMs = ms - accellerationDelay;\r\n\r\n\t\t// Add accellerated movement\r\n\t\tif ((accelleration > 0) && (accelleratedMs > 0)) {\r\n\t\t\tlet accellerationFactor = ms / accellerationDelay;\r\n\t\t\tms = accellerationDelay;\r\n\t\t\tshift.x += this.directionX * (speed * accelleration * accellerationFactor * accelleratedMs);\r\n\t\t\tshift.y += this.directionY * (speed * accelleration * accellerationFactor * accelleratedMs);\r\n\t\t}\r\n\r\n\t\t// Calculate position\r\n\t\tshift.x += this.directionX * (speed * ms);\r\n\t\tshift.y += this.directionY * (speed * ms);\r\n\r\n\t\t// Simulate move on Interaction\r\n\t\tgetInteraction().handleTransformMove(io, shift, { x: 0, y: 0 }, this.keyboardEvent, true, false);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns if this object has been already been disposed.\r\n\t *\r\n\t * @return Is disposed?\r\n\t */\r\n\tpublic isDisposed(): boolean {\r\n\t\treturn this._disposed;\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes this object. Removes from system animations.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tif (!this._disposed) {\r\n\t\t\tgetInteraction().processDragStop(this.interaction);\r\n\t\t\t$array.remove(system.animations, this);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","/**\r\n * Functionality related to inertia\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObject } from \"../Base\";\r\nimport { getInteraction } from \"./Interaction\";\r\nimport { InteractionObject, IInteractionObjectEvents } from \"./InteractionObject\";\r\nimport { Animation, IAnimatable, AnimationDisposer } from \"../utils/Animation\";\r\nimport { AMEvent } from \"../utils/EventDispatcher\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n/**\r\n * Defines a list of available inertia types.\r\n */\r\nexport type InertiaTypes = \"move\" | \"resize\";\r\n\r\n/**\r\n * A point of inertia is to simulate gradually drecreasing motion even after\r\n * actual interaction by user, that caused it, has already ended.\r\n *\r\n * [[Inertia]] object will continue triggering the same [[Sprite]] handlers\r\n * as if the interaction was still happening, gradually reducing\r\n * shift/angle/scale values until full stop.\r\n *\r\n * Basically, from the target element's point of view, while inertia is\r\n * playing, it is still being interacted with by user, albeit with a\r\n * decreasing speed.\r\n */\r\nexport class Inertia extends BaseObject implements IAnimatable {\r\n\r\n\t/**\r\n\t * Holds what type of inertia it is.\r\n\t */\r\n\tpublic type: InertiaTypes;\r\n\r\n\t/**\r\n\t * An element we're performing animation on.\r\n\t */\r\n\tpublic interaction: InteractionObject;\r\n\r\n\t/**\r\n\t * Starting pointer position. The position of pointer when we \"released\"\r\n\t * the element.\r\n\t */\r\n\tpublic startPoint: IPoint;\r\n\r\n\t/**\r\n\t * Current (simulated) pointer position.\r\n\t */\r\n\tpublic point: IPoint;\r\n\r\n\t/**\r\n\t * List of animations currently playing.\r\n\t */\r\n\tpublic animations: Array<Animation> = [];\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor(interaction: InteractionObject, type: InertiaTypes, point: IPoint, startPoint: IPoint) {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"Inertia\";\r\n\r\n\t\tthis.interaction = interaction;\r\n\t\tthis.type = type;\r\n\t\tthis.point = point;\r\n\t\tthis.startPoint = startPoint;\r\n\r\n\t\t// Make animations disposable\r\n\t\tthis._disposers.push(new AnimationDisposer(this.animations));\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Sets current X coordinate.\r\n\t *\r\n\t * Will trigger \"drag\" event for the target element.\r\n\t *\r\n\t * @param value X\r\n\t */\r\n\tpublic set x(value: number) {\r\n\t\tif ($type.isNumber(value)) {\r\n\t\t\tthis.point.x = value;\r\n\t\t\tthis.handleMove();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current X coordinate.\r\n\t *\r\n\t * @return X\r\n\t */\r\n\tpublic get x(): number {\r\n\t\treturn this.point.x;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets current Y coordinate.\r\n\t *\r\n\t * Will trigger \"drag\" event for the target element.\r\n\t *\r\n\t * @param value Y\r\n\t */\r\n\tpublic set y(value: number) {\r\n\t\tif ($type.isNumber(value)) {\r\n\t\t\tthis.point.y = value;\r\n\t\t\tthis.handleMove();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current Y coordinate.\r\n\t *\r\n\t * @return Y\r\n\t */\r\n\tpublic get y(): number {\r\n\t\treturn this.point.y;\r\n\t}\r\n\r\n\t/**\r\n\t * Simulates dragging of element.\r\n\t */\r\n\tpublic handleMove() {\r\n\r\n\t\t// Prepare {InteractionEvent} object\r\n\t\tif (this.interaction.events.isEnabled(\"drag\")) {\r\n\t\t\tlet imev: AMEvent<InteractionObject, IInteractionObjectEvents>[\"drag\"] = {\r\n\t\t\t\ttype: \"drag\",\r\n\t\t\t\ttarget: this.interaction,\r\n\t\t\t\tshift: {\r\n\t\t\t\t\tx: this.x - this.startPoint.x,\r\n\t\t\t\t\ty: this.y - this.startPoint.y\r\n\t\t\t\t},\r\n\t\t\t\tstartPoint: this.startPoint,\r\n\t\t\t\tpoint: {\r\n\t\t\t\t\tx: this.x,\r\n\t\t\t\t\ty: this.y\r\n\t\t\t\t},\r\n\t\t\t\ttouch: false\r\n\t\t\t};\r\n\r\n\t\t\t// Call handler\r\n\t\t\tthis.interaction.events.dispatchImmediately(\"drag\", imev);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Finishes up the inertia animation. (removes reference to this animation\r\n\t * object)\r\n\t */\r\n\tpublic done() {\r\n\r\n\t\t// Remove inertia animation from the object\r\n\t\tthis.interaction.inertias.removeKey(this.type);\r\n\r\n\t\t// Move ended\r\n\t\tif (this.type === \"move\") {\r\n\t\t\tgetInteraction().processDragStop(this.interaction);\r\n\t\t}\r\n\r\n\t\t// Destroy\r\n\t\tthis.dispose();\r\n\r\n\t}\r\n\r\n}\r\n","/**\r\n * Export module.\r\n *\r\n * Parts of Export functionality rely on the following third party libraries:\r\n *\r\n * [canvg.js](https://github.com/canvg/canvg)\r\n * Copyright (c) Gabe Lerner\r\n * Licensed under [MIT](https://github.com/canvg/canvg/blob/master/LICENSE)\r\n *\r\n * [pdfmake](http://pdfmake.org/)\r\n * Copyright (c) 2014 bpampuch\r\n * Licensed under [MIT](https://github.com/bpampuch/pdfmake/blob/master/LICENSE)\r\n *\r\n * [SheetJS Community Edition](https://github.com/sheetjs/js-xlsx)\r\n * Licensed under [Apache License 2.0](https://github.com/SheetJS/js-xlsx/blob/master/LICENSE)\r\n *\r\n * [JSZip](http://stuartk.com/jszip)\r\n * Copyright (c) Stuart Knightley\r\n * Dual licenced under the [MIT license or GPLv3](https://raw.githubusercontent.com/Stuk/jszip/master/LICENSE.markdown).\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { ExportMenu } from \"./ExportMenu\";\r\nimport { Adapter } from \"../utils/Adapter\";\r\nimport { AMEvent } from \"../utils/EventDispatcher\";\r\nimport { Sprite } from \"../Sprite\";\r\nimport { Preloader } from \"../elements/Preloader\";\r\nimport { Modal } from \"../elements/Modal\";\r\nimport { List } from \"../utils/List\";\r\nimport { Dictionary } from \"../utils/Dictionary\";\r\nimport { IDisposer } from \"../utils/Disposer\";\r\nimport { DateFormatter } from \"../formatters/DateFormatter\";\r\nimport { DurationFormatter } from \"../formatters/DurationFormatter\";\r\nimport { NumberFormatter } from \"../formatters/NumberFormatter\";\r\nimport { Language } from \"../utils/Language\";\r\nimport { Validatable } from \"../utils/Validatable\";\r\nimport { Color, color } from \"../utils/Color\";\r\nimport { registry } from \"../Registry\";\r\nimport { options } from \"../Options\";\r\nimport { StyleRule, getComputedStyle } from \"../utils/DOM\";\r\nimport { Align } from \"../defs/Align\";\r\nimport * as $browser from \"../utils/Browser\";\r\nimport * as $object from \"../utils/Object\";\r\nimport * as $net from \"../utils/Net\";\r\nimport * as $dom from \"../utils/DOM\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $log from \"../utils/Log\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport * as $array from \"../utils/Array\";\r\nimport * as $math from \"../utils/Math\";\r\nimport * as $strings from \"../utils/Strings\";\r\n\r\n\r\nexport interface IFile {\r\n\tpath: string;\r\n\tbytes: string;\r\n}\r\n\r\nexport interface IFont {\r\n\tname: string;\r\n\tnormal: IFile;\r\n\tbold?: IFile;\r\n\titalics?: IFile;\r\n\tbolditalics?: IFile;\r\n}\r\n\r\n\r\n// This is used to cache the pdfmake loading\r\nlet pdfmakePromise: Promise<any>;\r\n\r\n/**\r\n * Loads pdfmake dynamic module\r\n *\r\n * This is an asynchronous function. Check the description of `getImage()`\r\n * for description and example usage.\r\n *\r\n * @ignore Exclude from docs\r\n * @return Instance of pdfmake\r\n * @async\r\n */\r\nasync function _pdfmake(): Promise<any> {\r\n\tlet a = await Promise.all([\r\n\t\timport(/* webpackChunkName: \"pdfmake\" */ \"pdfmake/build/pdfmake.js\"),\r\n\t\timport(/* webpackChunkName: \"pdfmake\" */ \"../../pdfmake/vfs_fonts\")\r\n\t]);\r\n\tlet pdfmake = a[0];\r\n\tlet vfs_fonts = a[1];\r\n\tconst global = <any>window;\r\n\tglobal.pdfMake = global.pdfMake || {};\r\n\tglobal.pdfMake.vfs = vfs_fonts.default;\r\n\tpdfmake.vfs = vfs_fonts.default;\r\n\treturn pdfmake;\r\n}\r\n\r\n\r\n// TODO better parsing\r\nconst fontFamilySrcRegexp = /src: ([^;]+);/;\r\n\r\n// TODO better checks\r\nfunction supportsBlobUri(): boolean {\r\n\treturn window.navigator.msSaveOrOpenBlob != null;\r\n}\r\n\r\n// TODO move into utils or something ?\r\nfunction blobToDataUri(blob: Blob): Promise<string> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\t// TODO handle abort ?\r\n\t\tconst f = new FileReader();\r\n\t\tf.onload = (e) => { resolve(<string>f.result); };\r\n\t\tf.onerror = (e) => { reject(e); };\r\n\t\tf.readAsDataURL(blob);\r\n\t});\r\n}\r\n\r\nasync function getCssRules(s: HTMLStyleElement): Promise<CSSRuleList> {\r\n\tconst sheet = <CSSStyleSheet>s.sheet;\r\n\r\n\ttry {\r\n\t\treturn sheet.cssRules;\r\n\r\n\t} catch (e) {\r\n\t\t// Needed because of https://bugzilla.mozilla.org/show_bug.cgi?id=625013\r\n\t\treturn await new Promise<CSSRuleList>((success, error) => {\r\n\t\t\ts.addEventListener(\"load\", () => {\r\n\t\t\t\tsuccess(sheet.cssRules);\r\n\t\t\t}, true);\r\n\r\n\t\t\ts.addEventListener(\"error\", (e) => {\r\n\t\t\t\terror(e);\r\n\t\t\t}, true);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\terror(new Error(\"Timeout while waiting for <style> to load\"));\r\n\t\t\t}, 10000);\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// This loads a stylesheet by URL and then calls the function with it\r\n// TODO this should be moved into utils or something\r\nasync function loadStylesheet(doc: Document, url: string, f: (topUrl: string, rule: CSSRule) => void): Promise<void> {\r\n\tlet response;\r\n\r\n\ttry {\r\n\t\tresponse = await $net.load(url);\r\n\r\n\t} catch (e) {\r\n\t\tconsole.error(\"Failed to load stylesheet\", url, e);\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst s = doc.createElement(\"style\");\r\n\ts.textContent = response.response;\r\n\tif (options.nonce != \"\") {\r\n\t\ts.setAttribute(\"nonce\", options.nonce)\r\n\t}\r\n\tdoc.head.appendChild(s);\r\n\r\n\ttry {\r\n\t\tconst rules = await getCssRules(s);\r\n\t\tawait eachStylesheet(doc, url, rules, f);\r\n\r\n\t} finally {\r\n\t\tdoc.head.removeChild(s);\r\n\t}\r\n}\r\n\r\n// This calls a function for each CSSRule inside of a CSSStyleSheet.\r\n// If the CSSStyleSheet has any @import, then it will recursively call the function for those CSSRules too.\r\n// TODO this should be moved into utils or something\r\nasync function eachStylesheet(doc: Document, topUrl: string, rules: CSSRuleList, f: (topUrl: string, rule: CSSRule) => void): Promise<void> {\r\n\tconst promises: Array<Promise<void>> = [];\r\n\r\n\tconst length = rules.length;\r\n\r\n\tfor (let i = 0; i < length; i++) {\r\n\t\tconst rule = rules[i];\r\n\r\n\t\tif (rule.type === CSSRule.IMPORT_RULE) {\r\n\t\t\tlet url = (<CSSImportRule>rule).href;\r\n\r\n\t\t\tif (url) {\r\n\t\t\t\turl = $utils.joinUrl(topUrl, url);\r\n\t\t\t\tpromises.push(loadStylesheet(doc, url, f));\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tf(topUrl, rule);\r\n\t\t}\r\n\t}\r\n\r\n\tif (promises.length) {\r\n\t\tawait Promise.all(promises);\r\n\t}\r\n}\r\n\r\n// This calls a function for each CSSRule for all of the stylesheets in the page.\r\n// If the CSSStyleSheet has any @import, then it will recursively call the function for those CSSRules too.\r\n// TODO this should be moved into utils or something\r\nasync function eachStylesheets(f: (topUrl: string, rule: CSSRule) => void): Promise<void> {\r\n\t// This uses an <iframe> so it doesn't screw up the site's styles\r\n\tconst iframe = document.createElement(\"iframe\");\r\n\r\n\t// This causes it to use the same origin policy as the parent page\r\n\tiframe.src = \"about:blank\";\r\n\t// This tries to make it more accessible for screen readers\r\n\tiframe.setAttribute(\"title\", \"\");\r\n\r\n\tdocument.head.appendChild(iframe);\r\n\r\n\ttry {\r\n\t\tconst doc = iframe.contentDocument;\r\n\r\n\t\t// TODO use $dom.getRoot instead of document ?\r\n\t\tawait Promise.all($array.map(document.styleSheets, (sheet) => {\r\n\t\t\tlet url = sheet.href;\r\n\r\n\t\t\tif (url == null) {\r\n\t\t\t\treturn eachStylesheet(doc, location.href, (<CSSStyleSheet>sheet).cssRules, f);\r\n\r\n\t\t\t} else {\r\n\t\t\t\turl = $utils.joinUrl(location.href, url);\r\n\t\t\t\treturn loadStylesheet(doc, url, f);\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t} finally {\r\n\t\tdocument.head.removeChild(iframe);\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Represents an Event object that comes from [[Export]].\r\n */\r\nexport type ExportOperation = {\r\n\tformat?: string;\r\n\toptions?: any;\r\n}\r\n\r\n/**\r\n * Defines image formats available for export.\r\n */\r\nexport type imageFormats = \"png\" | \"gif\" | \"jpg\";\r\n\r\n/**\r\n * An interface describing extra elements to include in export.\r\n *\r\n * @since 4.2.0\r\n */\r\nexport interface IExportCanvas {\r\n\r\n\t/**\r\n\t * Top margin in pixels.\r\n\t */\r\n\tmarginTop?: number;\r\n\r\n\t/**\r\n\t * Right margin in pixels.\r\n\t */\r\n\tmarginRight?: number;\r\n\r\n\t/**\r\n\t * Bottom margin in pixels.\r\n\t */\r\n\tmarginBottom?: number;\r\n\r\n\t/**\r\n\t * Left margin in pixels.\r\n\t */\r\n\tmarginLeft?: number;\r\n\r\n\t/**\r\n\t * Position to put extra element in relation to main chart.\r\n\t */\r\n\tposition?: \"left\" | \"right\" | \"top\" | \"bottom\";\r\n\r\n\t/**\r\n\t * Reference to element.\r\n\t */\r\n\tsprite?: Sprite;\r\n\r\n\t/**\r\n\t * If this is set to `true` and extra element is higher/wider than main\r\n\t * chart element, the extra element will be cropped.\r\n\t *\r\n\t * @default false\r\n\t * @since 4.6.1\r\n\t */\r\n\tcrop?: boolean;\r\n}\r\n\r\n/**\r\n * Represents options for image export.\r\n */\r\nexport interface IExportImageOptions {\r\n\r\n\t/**\r\n\t * Quality of the exported image. (0-1)\r\n\t */\r\n\tquality?: number;\r\n\r\n\t/**\r\n\t * Rescale image.\r\n\t *\r\n\t * Number less than 1 will shrink the image.\r\n\t *\r\n\t * Number bigger than 1 will scale up the image.\r\n\t *\r\n\t * @default 1\r\n\t */\r\n\tscale?: number;\r\n\r\n\t/**\r\n\t * Minimum width in pixels of the exported image. If source chart is smaller\r\n\t * thank this, it will be scaled up.\r\n\t *\r\n\t * @since 4.9.24\r\n\t */\r\n\tminWidth?: number;\r\n\r\n\t/**\r\n\t * Minimum height in pixels of the exported image. If source chart is smaller\r\n\t * thank this, it will be scaled up.\r\n\t *\r\n\t * @since 4.9.24\r\n\t */\r\n\tminHeight?: number;\r\n\r\n\t/**\r\n\t * Maximum width in pixels of the exported image. If source chart is bigger\r\n\t * thank this, it will be scaled down.\r\n\t *\r\n\t * NOTE: this setting might be overidden by `minWidth`.\r\n\t *\r\n\t * @since 4.9.24\r\n\t */\r\n\tmaxWidth?: number;\r\n\r\n\t/**\r\n\t * Maximum height in pixels of the exported image. If source chart is bigger\r\n\t * thank this, it will be scaled down.\r\n\t *\r\n\t * NOTE: this setting might be overidden by `minHeight`.\r\n\t *\r\n\t * @since 4.9.24\r\n\t */\r\n\tmaxHeight?: number;\r\n\r\n\t/**\r\n\t * Normally, Export removes \"tainted\" images (images that are loaded from\r\n\t * other host than the chart itself) before export.\r\n\t *\r\n\t * Set this to `true` to disable it.\r\n\t *\r\n\t * Please note that removal of tainted images might trigger cross-origin\r\n\t * security restrictions in browser and prevent the whole export operation,\r\n\t * so use with caution.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tkeepTainted?: boolean;\r\n\r\n\t/**\r\n\t * Set this option to `disabled` for a format to not show up in [[ExportMenu]].\r\n\t *\r\n\t * @since 4.9.11\r\n\t */\r\n\tdisabled?: boolean;\r\n\r\n}\r\n\r\n/**\r\n * Represents options for SVG export.\r\n */\r\nexport interface IExportSVGOptions {\r\n\r\n\t/**\r\n\t * Set this option to `disabled` for a format to not show up in [[ExportMenu]].\r\n\t *\r\n\t * @since 4.9.11\r\n\t */\r\n\tdisabled?: boolean;\r\n\r\n\t/**\r\n\t * Rescale image.\r\n\t *\r\n\t * Number less than 1 will shrink the image.\r\n\t *\r\n\t * Number bigger than 1 will scale up the image.\r\n\t *\r\n\t * @default 1\r\n\t * @since 4.10.06\r\n\t */\r\n\tscale?: number;\r\n\r\n\t/**\r\n\t * Minimum width in pixels of the exported image. If source chart is smaller\r\n\t * thank this, it will be scaled up.\r\n\t *\r\n\t * @since 4.10.06\r\n\t */\r\n\tminWidth?: number;\r\n\r\n\t/**\r\n\t * Minimum height in pixels of the exported image. If source chart is smaller\r\n\t * thank this, it will be scaled up.\r\n\t *\r\n\t * @since 4.10.06\r\n\t */\r\n\tminHeight?: number;\r\n\r\n\t/**\r\n\t * Maximum width in pixels of the exported image. If source chart is bigger\r\n\t * thank this, it will be scaled down.\r\n\t *\r\n\t * NOTE: this setting might be overidden by `minWidth`.\r\n\t *\r\n\t * @since 4.10.06\r\n\t */\r\n\tmaxWidth?: number;\r\n\r\n\t/**\r\n\t * Maximum height in pixels of the exported image. If source chart is bigger\r\n\t * thank this, it will be scaled down.\r\n\t *\r\n\t * NOTE: this setting might be overidden by `minHeight`.\r\n\t *\r\n\t * @since 4.10.06\r\n\t */\r\n\tmaxHeight?: number;\r\n\r\n}\r\n\r\n/**\r\n * Available PDF page sizes.\r\n */\r\nexport type pageSizes = \"4A0\" | \"2A0\" | \"A0\" | \"A1\" | \"A2\" | \"A3\" | \"A4\" | \"A5\" | \"A6\" | \"A7\" | \"A8\" | \"A9\" | \"A10\" |\r\n\t\"B0\" | \"B1\" | \"B2\" | \"B3\" | \"B4\" | \"B5\" | \"B6\" | \"B7\" | \"B8\" | \"B9\" | \"B10\" |\r\n\t\"C0\" | \"C1\" | \"C2\" | \"C3\" | \"C4\" | \"C5\" | \"C6\" | \"C7\" | \"C8\" | \"C9\" | \"C10\" |\r\n\t\"RA0\" | \"RA1\" | \"RA2\" | \"RA3\" | \"RA4\" |\r\n\t\"SRA0\" | \"SRA1\" | \"SRA2\" | \"SRA3\" | \"SRA4\" |\r\n\t\"EXECUTIVE\" | \"FOLIO\" | \"LEGAL\" | \"LETTER\" | \"TABLOID\";\r\n\r\n/**\r\n * Represents options for PDF export.\r\n */\r\nexport interface IExportPDFOptions extends IExportImageOptions {\r\n\r\n\t/**\r\n\t * Font size to use for all texts.\r\n\t */\r\n\tfontSize?: number;\r\n\r\n\t/**\r\n\t * An image format to use for embedded images in PDF.\r\n\t *\r\n\t * See `imageFormats` in [[Export_module]].\r\n\t */\r\n\timageFormat?: imageFormats;\r\n\r\n\t/**\r\n\t * Whether to add a URL of the web page the chart has been exported from.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\taddURL?: boolean;\r\n\r\n\t/**\r\n\t * Page size of the exported PDF.\r\n\t */\r\n\tpageSize?: pageSizes;\r\n\r\n\t/**\r\n\t * Page orientation.\r\n\t */\r\n\tpageOrientation?: \"landscape\" | \"portrait\";\r\n\r\n\t/**\r\n\t * Alignment of the chart image in PDF.\r\n\t *\r\n\t * Supported options: `\"left\"` (default), `\"center\"`, `\"right\"`.\r\n\t *\r\n\t * @since 4.9.14\r\n\t * @default left\r\n\t */\r\n\talign?: Align;\r\n\r\n\t/**\r\n\t * Page margins.\r\n\t *\r\n\t * Can be one of the following:\r\n\t *\r\n\t * A single number, in which case it will act as margin setting\r\n\t * for all four edges of the page.\r\n\t *\r\n\t * An array of two numbers `[ horizontal, vertical ]`.\r\n\t *\r\n\t * An array of four numbers `[ left, top, right, bottom ]`.\r\n\t */\r\n\tpageMargins?: number | number[];\r\n\r\n\t/**\r\n\t * Should data table be included together with the image?\r\n\t *\r\n\t * Use \"pdfdata\" options to configure table output.\r\n\t *\r\n\t * @default false\r\n\t * @since 4.7.0\r\n\t */\r\n\taddData?: boolean;\r\n\r\n\t/**\r\n\t * Add column names in first row?\r\n\t *\r\n\t * Export will try to use user-friendly column names where possible, either\r\n\t * from Export's `dataFields` or deduced from chart's series' names that are\r\n\t * bound to specific data fields.\r\n\t *\r\n\t * @default true\r\n\t * @since 4.7.0\r\n\t */\r\n\taddColumnNames?: boolean;\r\n\r\n\t/**\r\n\t * Use timestamps instead of formatted date/time values.\r\n\t *\r\n\t * @default false\r\n\t * @since 4.7.0\r\n\t */\r\n\tuseTimestamps?: boolean;\r\n\r\n\t/**\r\n\t * Will try to format numbers and date/time according to user's locale\r\n\t * settings.\r\n\t *\r\n\t * @default true\r\n\t * @since 4.7.0\r\n\t */\r\n\tuseLocale?: boolean;\r\n\r\n\t/**\r\n\t * Replace missing values with this.\r\n\t *\r\n\t * @default \"\" (empty string)\r\n\t * @since 4.7.0\r\n\t */\r\n\temptyAs?: any;\r\n\r\n\t/**\r\n\t * If set to `true` will export data as pivoted (column names in first column;\r\n\t * values in rows).\r\n\t *\r\n\t * @default false\r\n\t * @since 4.7.0\r\n\t */\r\n\tpivot?: boolean;\r\n\r\n\t/**\r\n\t * Set this option to `disabled` for a format to not show up in [[ExportMenu]].\r\n\t *\r\n\t * @since 4.9.11\r\n\t */\r\n\tdisabled?: boolean;\r\n\r\n\t/**\r\n\t * Font which should be used for the export.\r\n\t *\r\n\t * Default font used for PDF includes only Latin-based and Cyrilic\r\n\t * characters. If you are exporting text in other languages, you might need\r\n\t * to use some other export font.\r\n\t *\r\n\t * @since 4.9.19\r\n\t * @see {@link https://www.amcharts.com/docs/v4/tutorials/using-pdf-export-fonts/}\r\n\t */\r\n\tfont?: IFont;\r\n\r\n\t/**\r\n\t * Additional optional fonts which can be used on individual elements.\r\n\t *\r\n\t * @since 4.9.19\r\n\t * @see {@link https://www.amcharts.com/docs/v4/tutorials/using-pdf-export-fonts/}\r\n\t */\r\n\textraFonts?: Array<IFont>;\r\n\r\n\t/**\r\n\t * Rescale image.\r\n\t *\r\n\t * Number less than 1 will shrink the image.\r\n\t *\r\n\t * Number bigger than 1 will scale up the image.\r\n\t *\r\n\t * @default 1\r\n\t * @since 4.10.13\r\n\t */\r\n\tscale?: number;\r\n\r\n\t/**\r\n\t * Minimum width in pixels of the exported image. If source chart is smaller\r\n\t * thank this, it will be scaled up.\r\n\t *\r\n\t * @since 4.10.13\r\n\t */\r\n\tminWidth?: number;\r\n\r\n\t/**\r\n\t * Minimum height in pixels of the exported image. If source chart is smaller\r\n\t * thank this, it will be scaled up.\r\n\t *\r\n\t * @since 4.10.13\r\n\t */\r\n\tminHeight?: number;\r\n\r\n\t/**\r\n\t * Maximum width in pixels of the exported image. If source chart is bigger\r\n\t * thank this, it will be scaled down.\r\n\t *\r\n\t * NOTE: this setting might be overidden by `minWidth`.\r\n\t *\r\n\t * @since 4.10.13\r\n\t */\r\n\tmaxWidth?: number;\r\n\r\n\t/**\r\n\t * Maximum height in pixels of the exported image. If source chart is bigger\r\n\t * thank this, it will be scaled down.\r\n\t *\r\n\t * NOTE: this setting might be overidden by `minHeight`.\r\n\t *\r\n\t * @since 4.10.13\r\n\t */\r\n\tmaxHeight?: number;\r\n\r\n}\r\n\r\n/**\r\n * Represents options for CSV export.\r\n */\r\nexport interface IExportCSVOptions {\r\n\r\n\t/**\r\n\t * Separator string to separate columns with.\r\n\t *\r\n\t * @default \",\"\r\n\t */\r\n\tseparator?: string;\r\n\r\n\t/**\r\n\t * CSV format does not require enclosing values in quotes, unless it\r\n\t * contains strings.\r\n\t *\r\n\t * This setting can be used to enforce enclosing of all values in CSV with\r\n\t * quotes.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tforceQuotes?: boolean;\r\n\r\n\t/**\r\n\t * Add column names in first row?\r\n\t *\r\n\t * Export will try to use user-friendly column names where possible, either\r\n\t * from Export's `dataFields` or deduced from chart's series' names that are\r\n\t * bound to specific data fields.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\taddColumnNames?: boolean;\r\n\r\n\t/**\r\n\t * Add rows in reverse order.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\treverse?: boolean;\r\n\r\n\t/**\r\n\t * Use timestamps instead of formatted date/time values.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tuseTimestamps?: boolean;\r\n\r\n\t/**\r\n\t * Will try to format numbers and date/time according to user's locale\r\n\t * settings.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tuseLocale?: boolean;\r\n\r\n\t/**\r\n\t * Replace missing values with this.\r\n\t *\r\n\t * @default \"\" (empty string)\r\n\t */\r\n\temptyAs?: any;\r\n\r\n\t/**\r\n\t * If set to `true` will export data as pivoted (column names in first column;\r\n\t * values in rows).\r\n\t *\r\n\t * @default false\r\n\t * @since 4.6.8\r\n\t */\r\n\tpivot?: boolean;\r\n\r\n\t/**\r\n\t * Set this option to `disabled` for a format to not show up in [[ExportMenu]].\r\n\t *\r\n\t * @since 4.9.11\r\n\t */\r\n\tdisabled?: boolean;\r\n\r\n\r\n\t/**\r\n\t * Add BOM character to output file, so that it can be used with UTF-8\r\n\t * characters properly in Excel.\r\n\t *\r\n\t * @default false\r\n\t * @since 4.10.21\r\n\t */\r\n\taddBOM?: boolean;\r\n\r\n}\r\n\r\n/**\r\n * Represents options for JSON export\r\n */\r\nexport interface IExportJSONOptions {\r\n\r\n\t/**\r\n\t * Use timestamps instead of formatted date/time values.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tuseTimestamps?: boolean;\r\n\r\n\t/**\r\n\t * Will try to format numbers and date/time according to user's locale\r\n\t * settings.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tuseLocale?: boolean;\r\n\r\n\t/**\r\n\t * Sets indent size for each hierarchical elements.\r\n\t *\r\n\t * @default \"  \"\r\n\t */\r\n\tindent?: number;\r\n\r\n\t/**\r\n\t * Set this option to `disabled` for a format to not show up in [[ExportMenu]].\r\n\t *\r\n\t * @since 4.9.11\r\n\t */\r\n\tdisabled?: boolean;\r\n\r\n}\r\n\r\n/**\r\n * Represents options for XLSX export.\r\n */\r\nexport interface IExportExcelOptions {\r\n\r\n\t/**\r\n\t * Add column names in first row?\r\n\t *\r\n\t * Export will try to use user-friendly column names where possible, either\r\n\t * from Export's `dataFields` or deduced from chart's series' names that are\r\n\t * bound to specific data fields.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\taddColumnNames?: boolean;\r\n\r\n\t/**\r\n\t * Use timestamps instead of formatted date/time values.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tuseTimestamps?: boolean;\r\n\r\n\t/**\r\n\t * Will try to format numbers and date/time according to user's locale\r\n\t * settings.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tuseLocale?: boolean;\r\n\r\n\t/**\r\n\t * Replace missing values with this.\r\n\t *\r\n\t * @default \"\" (empty string)\r\n\t */\r\n\temptyAs?: any;\r\n\r\n\t/**\r\n\t * If set to `true` will export data as pivoted (column names in first column;\r\n\t * values in rows).\r\n\t *\r\n\t * @default false\r\n\t * @since 4.6.8\r\n\t */\r\n\tpivot?: boolean;\r\n\r\n\t/**\r\n\t * Set this option to `disabled` for a format to not show up in [[ExportMenu]].\r\n\t *\r\n\t * @since 4.9.11\r\n\t */\r\n\tdisabled?: boolean;\r\n\r\n}\r\n\r\n/**\r\n * Represents options for HTML export.\r\n * @since 4.7.0\r\n */\r\nexport interface IExportHTMLOptions {\r\n\r\n\t/**\r\n\t * Add column names in first row?\r\n\t *\r\n\t * Export will try to use user-friendly column names where possible, either\r\n\t * from Export's `dataFields` or deduced from chart's series' names that are\r\n\t * bound to specific data fields.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\taddColumnNames?: boolean;\r\n\r\n\t/**\r\n\t * Use timestamps instead of formatted date/time values.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tuseTimestamps?: boolean;\r\n\r\n\t/**\r\n\t * Will try to format numbers and date/time according to user's locale\r\n\t * settings.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tuseLocale?: boolean;\r\n\r\n\t/**\r\n\t * Replace missing values with this.\r\n\t *\r\n\t * @default \"\" (empty string)\r\n\t */\r\n\temptyAs?: any;\r\n\r\n\t/**\r\n\t * If set to `true` will export data as pivoted (column names in first column;\r\n\t * values in rows).\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tpivot?: boolean;\r\n\r\n\t/**\r\n\t * A class name to add to table.\r\n\t */\r\n\ttableClass?: string;\r\n\r\n\t/**\r\n\t * A class name to add to table headers.\r\n\t */\r\n\trowClass?: string;\r\n\r\n\t/**\r\n\t * A class name to add to table headers.\r\n\t */\r\n\theaderClass?: string;\r\n\r\n\t/**\r\n\t * A class name to add to table cells.\r\n\t */\r\n\tcellClass?: string;\r\n\r\n\t/**\r\n\t * Set this option to `disabled` for a format to not show up in [[ExportMenu]].\r\n\t *\r\n\t * @since 4.9.11\r\n\t */\r\n\tdisabled?: boolean;\r\n\r\n}\r\n\r\n/**\r\n * Represents options for print.\r\n */\r\nexport interface IExportPrintOptions extends IExportImageOptions {\r\n\r\n\t/**\r\n\t * A delay in milliseconds to wait before initiating print.\r\n\t *\r\n\t * This delay is necessary to ensure DOM is prepared and repainted before\r\n\t * print dialog kicks in.\r\n\t *\r\n\t * @default 500\r\n\t */\r\n\tdelay?: number;\r\n\r\n\t/**\r\n\t * Method to use for printing.\r\n\t *\r\n\t * If one fails for your particular setup, try the other.\r\n\t *\r\n\t * \"css\" - inserts dynamic CSS that hides everything, except the image being printed.\r\n\t * \"iframe\" - creates a dynamic `<iframe>` with the image, then prints it.\r\n\t *\r\n\t * @default \"iframe\"\r\n\t */\r\n\tprintMethod?: \"css\" | \"iframe\";\r\n\r\n\t/**\r\n\t * Set this option to `disabled` for a format to not show up in [[ExportMenu]].\r\n\t *\r\n\t * @since 4.9.11\r\n\t */\r\n\tdisabled?: boolean;\r\n\r\n}\r\n\r\n/**\r\n * Represents options for custom menu items.\r\n */\r\nexport interface IExportCustomOptions {\r\n\r\n\t/**\r\n\t * A callback function reference that will be called when this custom item\r\n\t * is clicked.\r\n\t */\r\n\tcallback?: (branch?: any) => any;\r\n\r\n\t/**\r\n\t * A target which will be `this` context for callback calls.\r\n\t */\r\n\tcallbackTarget?: any;\r\n\r\n\t/**\r\n\t * Set this option to `disabled` for a format to not show up in [[ExportMenu]].\r\n\t *\r\n\t * @since 4.9.11\r\n\t */\r\n\tdisabled?: boolean;\r\n\r\n}\r\n\r\n/**\r\n * Represents interface for a temporarily removed image.\r\n */\r\nexport interface IExportRemovedObject {\r\n\r\n\t/**\r\n\t * Element that was removed out of DOM.\r\n\t */\r\n\telement: Node;\r\n\r\n\t/**\r\n\t * A placeholder element that was placed instead of removed element so that\r\n\t * we know where to put removed element back in.\r\n\t */\r\n\tplaceholder: Node;\r\n\r\n}\r\n\r\n/**\r\n * Represents all available options for all export operations.\r\n */\r\nexport interface IExportOptions {\r\n\tpng: IExportImageOptions;\r\n\tgif: IExportImageOptions;\r\n\tjpg: IExportImageOptions;\r\n\tsvg: IExportSVGOptions;\r\n\tpdf: IExportPDFOptions;\r\n\txlsx: IExportExcelOptions;\r\n\tcsv: IExportCSVOptions;\r\n\tjson: IExportJSONOptions;\r\n\tpdfdata: IExportPDFOptions;\r\n\thtml: IExportHTMLOptions;\r\n\tprint: IExportPrintOptions;\r\n\tcustom: IExportCustomOptions;\r\n}\r\n\r\n/**\r\n * All export options as a type.\r\n *\r\n * @ignore Exclude from docs\r\n */\r\nexport type ExportOptions = IExportImageOptions | IExportSVGOptions | IExportPDFOptions | IExportExcelOptions | IExportCSVOptions | IExportJSONOptions | IExportHTMLOptions | IExportPrintOptions;\r\n\r\n/**\r\n * Defines events for export operations.\r\n */\r\nexport interface IExportEvents {\r\n\r\n\t/**\r\n\t * Invoked when Export initializes.\r\n\t */\r\n\tinited: {};\r\n\r\n\t/**\r\n\t * Invoked when Export menu is created.\r\n\t */\r\n\tmenucreated: {};\r\n\r\n\t/**\r\n\t * Invoked when the Export starts export procedure.\r\n\t *\r\n\t * You can use event handlers here to modify config before actual export\r\n\t * starts.\r\n\t */\r\n\texportstarted: ExportOperation;\r\n\r\n\t/**\r\n\t * Invoked when export operation finishes.\r\n\t */\r\n\texportfinished: ExportOperation;\r\n\r\n\t/**\r\n\t * Invoked when export operation encounters error.\r\n\t */\r\n\terror: ExportOperation;\r\n\r\n\t/**\r\n\t * Invoked when export operation times out.\r\n\t *\r\n\t * Use Export's `timeoutDelay` setting to set timeout. (default: 2000ms)\r\n\t */\r\n\texporttimedout: ExportOperation;\r\n\r\n}\r\n\r\n/**\r\n * @ignore Exclude from docs\r\n */\r\nexport type Keys = keyof IExportOptions;\r\n\r\n/**\r\n * Represents a list of available adapters for [[Export]].\r\n */\r\nexport interface IExportAdapters {\r\n\r\n\tsupported: {\r\n\t\tsupported: boolean,\r\n\t\ttype: Keys,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t},\r\n\r\n\texportFunction: {\r\n\t\tfunc: <Key extends keyof IExportOptions>(type: Key, options?: IExportOptions[Key]) => Promise<any>,\r\n\t\ttype: Keys,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t},\r\n\r\n\toptions: {\r\n\t\toptions: IExportOptions[Keys],\r\n\t\ttype?: Keys\r\n\t},\r\n\r\n\ttitle: {\r\n\t\ttitle: $type.Optional<string>,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t},\r\n\r\n\tcharset: {\r\n\t\tcharset: string,\r\n\t\ttype?: Keys,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t}\r\n\r\n\tsvgToDataURI: {\r\n\t\tdata: string,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t},\r\n\r\n\tgetSVG: {\r\n\t\tdata: string,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t},\r\n\r\n\tnormalizeSVG: {\r\n\t\tdata: string,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t},\r\n\r\n\tgetCSV: {\r\n\t\tdata: string,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t},\r\n\r\n\tgetJSON: {\r\n\t\tdata: string,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t},\r\n\r\n\tgetExcel: {\r\n\t\tdata: string,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t},\r\n\r\n\tgetHTML: {\r\n\t\tdata: string,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t},\r\n\r\n\tpdfmakeDocument: {\r\n\t\tdoc: any,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t},\r\n\r\n\tpdfmakeTable: {\r\n\t\ttable: any,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t},\r\n\r\n\tcontainer: {\r\n\t\tcontainer: HTMLElement\r\n\t},\r\n\r\n\tsprite: {\r\n\t\tsprite: Sprite\r\n\t},\r\n\r\n\textraSprites: {\r\n\t\textraSprites: Array<Sprite | IExportCanvas>\r\n\t},\r\n\r\n\tvalidateSprites: {\r\n\t\tvalidateSprites: Array<Sprite>\r\n\t},\r\n\r\n\tdata: {\r\n\t\tdata: Array<any>\r\n\t},\r\n\r\n\tdataFields: {\r\n\t\tdataFields: any\r\n\t},\r\n\r\n\tformatDataFields: {\r\n\t\tdataFields: any,\r\n\t\tformat: string\r\n\t},\r\n\r\n\tdataFieldsOrder: {\r\n\t\tdataFieldsOrder: string[],\r\n\t\tformat: string\r\n\t},\r\n\r\n\tdateFormatter: {\r\n\t\tdateFormatter: DateFormatter\r\n\t},\r\n\r\n\tdateFormat: {\r\n\t\tdateFormat: $type.Optional<string | Intl.DateTimeFormatOptions>\r\n\t},\r\n\r\n\tdateFields: {\r\n\t\tdateFields: any\r\n\t},\r\n\r\n\tnumberFormatter: {\r\n\t\tnumberFormatter: NumberFormatter\r\n\t},\r\n\r\n\tnumberFormat: {\r\n\t\tnumberFormat: $type.Optional<string>\r\n\t},\r\n\r\n\tnumberFields: {\r\n\t\tnumberFields: any\r\n\t},\r\n\r\n\tdurationFormatter: {\r\n\t\tdurationFormatter: DurationFormatter\r\n\t},\r\n\r\n\tdurationFormat: {\r\n\t\tdurationFormat: $type.Optional<string>\r\n\t},\r\n\r\n\tdurationFields: {\r\n\t\tdurationFields: any\r\n\t},\r\n\r\n\tdataFieldName: {\r\n\t\tname: string,\r\n\t\tfield: string\r\n\t},\r\n\r\n\tisDateField: {\r\n\t\tisDateField: boolean,\r\n\t\tfield: string\r\n\t},\r\n\r\n\tisNumberField: {\r\n\t\tisNumberField: boolean,\r\n\t\tfield: string\r\n\t},\r\n\r\n\tisDurationField: {\r\n\t\tisDurationField: boolean,\r\n\t\tfield: string\r\n\t},\r\n\r\n\tcontentType: {\r\n\t\tcontentType: string,\r\n\t\ttype: Keys\r\n\t},\r\n\r\n\tfilePrefix: {\r\n\t\tfilePrefix: string\r\n\t},\r\n\r\n\tbackgroundColor: {\r\n\t\tbackgroundColor: $type.Optional<Color>\r\n\t},\r\n\r\n\ttimeoutMessage: {\r\n\t\tmessage: string\r\n\t},\r\n\r\n\txlsxWorkbookOptions: {\r\n\t\toptions: any,\r\n\t\txlsx: any\r\n\t},\r\n\r\n\txlsxSheetName: {\r\n\t\tname: string,\r\n\t\txlsx: any\r\n\t},\r\n\r\n\t/**\r\n\t * @since 4.9.28\r\n\t */\r\n\txlsxWorkbook: {\r\n\t\tworkbook: any,\r\n\t\txlsx: any,\r\n\t\toptions?: IExportOptions[Keys]\r\n\t},\r\n\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * [[Export]] allows downloading of current snapshot of the chart as an\r\n * image, PDF, or its data in various formats.\r\n *\r\n * The export functionality is enabled by default in charts and is accessible\r\n * via API or optional export menu.\r\n *\r\n * To enable menu, simply access export's `menu` property. E.g.:\r\n *\r\n * ```TypeScript\r\n * chart.exporting.menu = new am4core.ExportMenu();\r\n * ```\r\n * ```JavaScript\r\n * chart.exporting.menu = new am4core.ExportMenu();\r\n * ```\r\n * ```JSON\r\n * {\r\n *   // ...\r\n *   \"exporting\": {\r\n *     \"menu\": {}\r\n *   }\r\n * }\r\n * ```\r\n *\r\n * To export via API, use `export()` method:\r\n *\r\n * ```TypeScript\r\n * chart.exporting.export(type, [options]);\r\n * ```\r\n * ```JavaScript\r\n * chart.exporting.export(type, [options]);\r\n * ```\r\n *\r\n * E.g.:\r\n *\r\n * ```TypeScript\r\n * chart.exporting.export(\"png\");\r\n * ```\r\n * ```JavaScript\r\n * chart.exporting.export(\"png\");\r\n * ```\r\n *\r\n * @todo Better loading indicator?\r\n * @todo Implement multiplier option\r\n * @todo Handling of hanged exports\r\n * @important\r\n */\r\nexport class Export extends Validatable {\r\n\r\n\t/**\r\n\t * XLINK namespace definition.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tstatic XLINK: string = \"http://www.w3.org/1999/xlink\";\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IExportEvents;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IExportAdapters;\r\n\r\n\t/**\r\n\t * Adapter.\r\n\t */\r\n\tpublic adapter = new Adapter<Export, IExportAdapters>(this);\r\n\r\n\t/**\r\n\t * Holds options for each format.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprivate _formatOptions: Dictionary<string, ExportOptions> = new Dictionary<string, ExportOptions>();\r\n\r\n\t/**\r\n\t * An instance of [[Language]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _language: $type.Optional<Language>;\r\n\r\n\t/**\r\n\t * An instance of [[ExportMenu]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _menu: $type.Optional<ExportMenu>;\r\n\r\n\t/**\r\n\t * Reference to main container to place menu in.\r\n\t */\r\n\tprotected _container: HTMLElement;\r\n\r\n\t/**\r\n\t * [[Sprite]] instance to be used when converting to image.\r\n\t */\r\n\tprotected _sprite: $type.Optional<Sprite>;\r\n\r\n\t/**\r\n\t * Extra [[Sprite]] elements to include in exports.\r\n\t */\r\n\tprotected _extraSprites: Array<Sprite | IExportCanvas> = [];\r\n\r\n\t/**\r\n\t * A list of [[Sprite]] elements that need to be valid before export\r\n\t * commences.\r\n\t */\r\n\tprotected _validateSprites: Array<Sprite> = [];\r\n\r\n\t/**\r\n\t * Data storage to be used when exporting to data formats.\r\n\t */\r\n\tprotected _data: any;\r\n\r\n\t/**\r\n\t * Holds an object of field key / field name used to name columns when\r\n\t * exporting to data formats.\r\n\t */\r\n\tprotected _dataFields: any;\r\n\r\n\t/**\r\n\t * Holds an array of data field names. If set, exported data fields will try\r\n\t * to maintain this order.\r\n\t *\r\n\t * If not set (default), the export will try to maintain the same order as\r\n\t * in source data, or as in `dataFields` (if set).\r\n\t *\r\n\t * @since 4.9.7\r\n\t */\r\n\tpublic dataFieldsOrder: string[] = [];\r\n\r\n\t/**\r\n\t * Indicates whether data fields were generated dynamically (`true`) or\r\n\t * if they were pre-set by the user (`false`).\r\n\t */\r\n\tprotected _dynamicDataFields: boolean = true;\r\n\r\n\t/**\r\n\t * A reference to [[DateFormatter]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _dateFormatter: $type.Optional<DateFormatter>;\r\n\r\n\t/**\r\n\t * A Date format to be used when formatting dates in string-based data\r\n\t * formats.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _dateFormat: $type.Optional<string | Intl.DateTimeFormatOptions>;\r\n\r\n\t/**\r\n\t * A list of column keys that hold date values.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _dateFields: $type.Optional<List<string>>;\r\n\r\n\t/**\r\n\t * A reference to [[DurationFormatter]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _durationFormatter: $type.Optional<DurationFormatter>;\r\n\r\n\t/**\r\n\t * A duration format to be used when formatting numeric values.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _durationFormat: $type.Optional<string>;\r\n\r\n\t/**\r\n\t * A list of column keys that hold duration values.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _durationFields: $type.Optional<List<string>>;\r\n\r\n\t/**\r\n\t * A reference to [[NumberFormatter]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _numberFormatter: $type.Optional<NumberFormatter>;\r\n\r\n\t/**\r\n\t * A number format to be used when formatting numbers in string-based data\r\n\t * formats.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _numberFormat: $type.Optional<string>;\r\n\r\n\t/**\r\n\t * A list of column keys that hold number values.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _numberFields: $type.Optional<List<string>>;\r\n\r\n\t/**\r\n\t * Holds a list of objects that were temporarily removed from the DOM while\r\n\t * exporting. Those most probably are tainted images, or foreign objects that\r\n\t * would otherwise prevent SVG to be converted to canvas.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _removedObjects: List<IExportRemovedObject> = new List<IExportRemovedObject>();\r\n\r\n\t/**\r\n\t * Holds references to the objects that were temporarily hidden when export\r\n\t * started, so that we can reveal them back when export ends.\r\n\t */\r\n\tprotected _hiddenObjects: Sprite[] = [];\r\n\r\n\t/**\r\n\t * Indicates if non-exportable objects are now hidden;\r\n\t */\r\n\tprotected _objectsAlreadyHidden: boolean = false;\r\n\r\n\t/**\r\n\t * Exported files will be prefixed with whatever it is set here.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _filePrefix: string = \"amCharts\";\r\n\r\n\t/**\r\n\t * Export will try to determine proper background color itself. If you want to\r\n\t * override it and use some other color, set this property.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _backgroundColor: $type.Optional<Color>;\r\n\r\n\t/**\r\n\t * A title to use for some document exports, mainly for print.\r\n\t * A document.title will be used if not set.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _title: $type.Optional<string>;\r\n\r\n\t/**\r\n\t * If you are using web fonts (such as Google Fonts), your chart might be\r\n\t * using them as well.\r\n\t *\r\n\t * Normally, exporting to image will require to download these fonts so the\r\n\t * are carried over to exported image.\r\n\t *\r\n\t * This setting can be used to disable or enable this functionality.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tpublic useWebFonts: boolean = true;\r\n\r\n\t/**\r\n\t * A regular expression that will be matched against each URL of an external\r\n\t * font being loaded. Font will only be loaded of regular expression matches.\r\n\t *\r\n\t * Has no effect of `useWebFonts` is set to `false`.\r\n\t *\r\n\t * ```TypeScript\r\n\t * chart.exporting.webFontFilter = /pacifico|roboto/;\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * chart.exporting.webFontFilter = /pacifico|roboto/;\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"exporting\": {\r\n\t *     // ...\r\n\t *     \"webFontFilter\": /pacifico|roboto/\r\n\t *   }\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @since 4.10.17\r\n\t */\r\n\tpublic webFontFilter: RegExp;\r\n\r\n\t/**\r\n\t * Many modern displays have use more actual pixels per displayed pixel. This\r\n\t * results in sharper images on screen. Unfortunately, when exported to a\r\n\t * bitmap image of the sam width/height size it will lose those extra pixels,\r\n\t * resulting in somewhat blurry image.\r\n\t *\r\n\t * This is why we are going to export images larger than they are, so that we\r\n\t * don't lose any details.\r\n\t *\r\n\t * If you'd rather export images without change in size, set this to `false`.\r\n\t *\r\n\t * @default true\r\n\t */\r\n\tpublic useRetina: boolean = true;\r\n\r\n\t/**\r\n\t * By default Export will try to use built-in method for transforming chart\r\n\t * into an image for download, then fallback to external library (canvg) for\r\n\t * conversion if failed.\r\n\t *\r\n\t * Setting this to `false` will force use of external library for all export\r\n\t * operations.\r\n\t *\r\n\t * It might be useful to turn off simplified export if you are using strict\r\n\t * content security policies, that disallow images with blobs as their\r\n\t * source.\r\n\t *\r\n\t * @default true\r\n\t * @since 4.2.5\r\n\t */\r\n\tpublic useSimplifiedExport: boolean = true;\r\n\r\n\t/**\r\n\t * If export operation takes longer than milliseconds in this second, we will\r\n\t * show a modal saying export operation took longer than expected.\r\n\t */\r\n\tpublic timeoutDelay: number = 2000;\r\n\r\n\t/**\r\n\t * A reference to export timeout.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _timeoutTimeout: $type.Optional<IDisposer>;\r\n\r\n\t/**\r\n\t * Holds reference to [[Modal]] instance.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprotected _modal: $type.Optional<Modal>;\r\n\r\n\t/**\r\n\t * Used to log original value of `interactionsEnabled` so that it can be restored\r\n\t * after temporarily disabling it.\r\n\t */\r\n\tprivate _spriteInteractionsEnabled: $type.Optional<boolean>;\r\n\r\n\tprivate _exportRunning: boolean = false;\r\n\r\n\t/**\r\n\t * Indicator used by [[Component]].\r\n\t *\r\n\t * @ignore\r\n\t */\r\n\tprivate _prevHasData: boolean = false;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor(container: HTMLElement) {\r\n\t\tsuper();\r\n\r\n\t\tthis._container = container;\r\n\r\n\t\tthis.className = \"Export\";\r\n\r\n\t\t// Set default options\r\n\t\tthis._formatOptions.setKey(\"png\", {});\r\n\r\n\t\tthis._formatOptions.setKey(\"jpg\", {\r\n\t\t\tquality: 0.8\r\n\t\t});\r\n\r\n\t\tthis._formatOptions.setKey(\"gif\", {});\r\n\r\n\t\tthis._formatOptions.setKey(\"svg\", {});\r\n\r\n\t\tthis._formatOptions.setKey(\"pdf\", {\r\n\t\t\tfontSize: 14,\r\n\t\t\timageFormat: \"png\",\r\n\t\t\talign: \"left\",\r\n\t\t\taddURL: true,\r\n\t\t\taddColumnNames: true\r\n\t\t});\r\n\r\n\t\tthis._formatOptions.setKey(\"json\", {\r\n\t\t\tindent: 2,\r\n\t\t\tuseLocale: true\r\n\t\t});\r\n\r\n\t\tthis._formatOptions.setKey(\"csv\", {\r\n\t\t\taddColumnNames: true,\r\n\t\t\temptyAs: \"\",\r\n\t\t\taddBOM: true\r\n\t\t});\r\n\r\n\t\tthis._formatOptions.setKey(\"xlsx\", {\r\n\t\t\taddColumnNames: true,\r\n\t\t\tuseLocale: true,\r\n\t\t\temptyAs: \"\"\r\n\t\t});\r\n\r\n\t\tthis._formatOptions.setKey(\"html\", {\r\n\t\t\taddColumnNames: true,\r\n\t\t\temptyAs: \"\"\r\n\t\t});\r\n\r\n\t\tthis._formatOptions.setKey(\"pdfdata\", {\r\n\t\t\tfontSize: 14,\r\n\t\t\timageFormat: \"png\",\r\n\t\t\taddURL: true,\r\n\t\t\taddColumnNames: true,\r\n\t\t\temptyAs: \"\"\r\n\t\t});\r\n\r\n\t\tthis._formatOptions.setKey(\"print\", {\r\n\t\t\tdelay: 500,\r\n\t\t\tprintMethod: \"iframe\"\r\n\t\t});\r\n\r\n\t\t// Add options adapter\r\n\t\tthis.adapter.add(\"options\", (arg) => {\r\n\t\t\tlet formatOptions = this._formatOptions.getKey(arg.type);\r\n\t\t\tif (arg.options) {\r\n\t\t\t\targ.options = $object.merge(formatOptions, arg.options);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\targ.options = formatOptions;\r\n\t\t\t}\r\n\t\t\treturn arg;\r\n\t\t});\r\n\r\n\t\tthis.applyTheme();\r\n\r\n\t\tthis.dispatchImmediately(\"inited\");\r\n\t}\r\n\r\n\t/**\r\n\t * An instance of [[ExportMenu]].\r\n\t *\r\n\t * To add an export menu to a chart, set this to a new instance of\r\n\t * [[ExportMenu]].\r\n\t *\r\n\t * ```TypeScript\r\n\t * chart.exporting.menu = new am4core.ExportMenu();\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * chart.exporting.menu = new am4core.ExportMenu();\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"exporting\": {\r\n\t *     \"menu\": {}\r\n\t *   }\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @param menu  ExportMenu instance\r\n\t */\r\n\tpublic set menu(menu: $type.Optional<ExportMenu>) {\r\n\t\tif (this._menu) {\r\n\t\t\tthis.removeDispose(this._menu);\r\n\t\t}\r\n\t\tthis._menu = menu;\r\n\r\n\t\t// Set container and language\r\n\t\tthis._menu.container = this.container;\r\n\t\tthis._menu.language = this._language;\r\n\r\n\t\t// Add adapter to check for browser support\r\n\t\tthis._menu.adapter.add(\"branch\", (arg) => {\r\n\t\t\targ.branch.unsupported = !this.typeSupported(arg.branch.type);\r\n\t\t\treturn arg;\r\n\t\t});\r\n\r\n\t\t// Add click events\r\n\t\tthis._menu.events.on(\"hit\", (ev) => {\r\n\t\t\tthis.export(ev.branch.type, ev.branch.options);\r\n\t\t\tthis.menu.close();\r\n\t\t});\r\n\r\n\t\tthis._menu.events.on(\"enter\", (ev) => {\r\n\t\t\tthis.export(ev.branch.type, ev.branch.options);\r\n\t\t\tthis.menu.close();\r\n\t\t});\r\n\r\n\t\tthis._menu.events.on(\"over\", (ev) => {\r\n\t\t\tthis._disablePointers();\r\n\t\t});\r\n\r\n\t\tthis._menu.events.on(\"out\", (ev) => {\r\n\t\t\tsetTimeout(() => { this._releasePointers(); }, 10);\r\n\t\t});\r\n\r\n\t\t// Dispatch event\r\n\t\tthis.dispatchImmediately(\"menucreated\");\r\n\r\n\t\t// Prefix with Sprite's class name\r\n\t\tthis._menu.adapter.add(\"classPrefix\", (obj) => {\r\n\t\t\tobj.classPrefix = options.classNamePrefix + obj.classPrefix;\r\n\t\t\treturn obj;\r\n\t\t});\r\n\r\n\t\t// Add menu to disposers so that it's destroyed when Export is disposed\r\n\t\tthis._disposers.push(this._menu);\r\n\t}\r\n\r\n\t/**\r\n\t * @return ExportMenu instance\r\n\t */\r\n\tpublic get menu(): $type.Optional<ExportMenu> {\r\n\t\treturn this._menu;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if this specific menu item type is supported by current system.\r\n\t *\r\n\t * @param type  Menu item type\r\n\t * @return `false` if not supported\r\n\t */\r\n\tpublic typeSupported<Key extends keyof IExportOptions>(type: Key): boolean {\r\n\t\tlet supported = true;\r\n\t\tconst options = this.getFormatOptions(type);\r\n\t\tif ($type.hasValue(options) && options.disabled) {\r\n\t\t\tsupported = false;\r\n\t\t}\r\n\t\telse if (type === \"pdf\") {\r\n\t\t\t//supported = this.downloadSupport();\r\n\t\t}\r\n\t\telse if (type === \"xlsx\") {\r\n\t\t\t//supported = (this.downloadSupport() && this._hasData()) ? true : false;\r\n\t\t\tsupported = this._hasData() ? true : false;\r\n\t\t}\r\n\t\telse if (type == \"print\" && !(<any>window).print) {\r\n\t\t\tsupported = false;\r\n\t\t}\r\n\t\telse if ([\"json\", \"csv\", \"html\", \"pdfdata\"].indexOf(type) !== -1 && !this._hasData()) {\r\n\t\t\tsupported = false;\r\n\t\t}\r\n\t\treturn this.adapter.apply(\"supported\", {\r\n\t\t\tsupported: supported,\r\n\t\t\ttype: type\r\n\t\t}).supported;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if data is available.\r\n\t *\r\n\t * @return Has data?\r\n\t */\r\n\tprivate _hasData(): boolean {\r\n\t\treturn this.data && this.data.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Get function to handle export for particular format.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tprivate _getFunction<Key extends keyof IExportOptions>(type: Key): (this: this, type: Key, options?: IExportOptions[Key]) => Promise<any> {\r\n\t\tswitch (type) {\r\n\t\t\tcase \"png\":\r\n\t\t\tcase \"gif\":\r\n\t\t\tcase \"jpg\":\r\n\t\t\t\treturn <any>this.getImage;\r\n\t\t\tcase \"svg\":\r\n\t\t\t\treturn <any>this.getSVG;\r\n\t\t\tcase \"pdf\":\r\n\t\t\tcase \"pdfdata\":\r\n\t\t\t\treturn <any>this.getPDF;\r\n\t\t\tcase \"xlsx\":\r\n\t\t\t\treturn <any>this.getExcel;\r\n\t\t\tcase \"csv\":\r\n\t\t\t\treturn <any>this.getCSV;\r\n\t\t\tcase \"json\":\r\n\t\t\t\treturn <any>this.getJSON;\r\n\t\t\tcase \"html\":\r\n\t\t\t\treturn <any>this.getHTML;\r\n\t\t\tcase \"print\":\r\n\t\t\t\treturn <any>this.getPrint;\r\n\t\t\tdefault:\r\n\t\t\t\treturn this.unsupported;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Initiates export procedure.\r\n\t *\r\n\t * @param type     Export type\r\n\t * @param options  Options\r\n\t * @return `true` if export was successful\r\n\t * @async\r\n\t */\r\n\tpublic async export<Key extends keyof IExportOptions>(type: Key, options?: IExportOptions[Key]): Promise<boolean> {\r\n\r\n\t\t// Check if it's a custom item, and do nothing or execute custom callback\r\n\t\tif (type == \"custom\") {\r\n\t\t\tthis.handleCustom(<IExportCustomOptions>options);\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Set export running flag\r\n\t\tthis._exportRunning = true;\r\n\r\n\t\t// Dispatch event\r\n\t\tif (this.events.isEnabled(\"exportstarted\")) {\r\n\t\t\tconst event: AMEvent<this, IExportEvents>[\"exportstarted\"] = {\r\n\t\t\t\t\"type\": \"exportstarted\",\r\n\t\t\t\t\"target\": this,\r\n\t\t\t\t\"format\": type,\r\n\t\t\t\t\"options\": options\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"exportstarted\", event);\r\n\t\t}\r\n\r\n\t\t// Schedule a preloader\r\n\t\tthis.showPreloader()\r\n\r\n\t\t// Schedule a timeout\r\n\t\tif (this.timeoutDelay) {\r\n\t\t\tthis.hideTimeout();\r\n\t\t\tthis._timeoutTimeout = this.setTimeout((): void => {\r\n\r\n\t\t\t\t// Dispatch event\r\n\t\t\t\tif (this.events.isEnabled(\"exporttimedout\")) {\r\n\t\t\t\t\tconst event: AMEvent<this, IExportEvents>[\"exporttimedout\"] = {\r\n\t\t\t\t\t\t\"type\": \"exporttimedout\",\r\n\t\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\t\"format\": type,\r\n\t\t\t\t\t\t\"options\": options\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.events.dispatchImmediately(\"exporttimedout\", event);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Show modal\r\n\t\t\t\tthis.showTimeout()\r\n\r\n\t\t\t}, this.timeoutDelay);\r\n\t\t}\r\n\r\n\t\t// Hide items that should not be exported\r\n\t\tthis.hideNonExportableSprites();\r\n\r\n\t\t// Get the actual export function\r\n\t\tlet func: (this: this, type: Key, options?: IExportOptions[Key]) => Promise<any> = this._getFunction(type);\r\n\r\n\t\t// Give chance for plugins to override both function and options\r\n\t\toptions = this.adapter.apply(\"options\", {\r\n\t\t\toptions: options,\r\n\t\t\ttype: type\r\n\t\t}).options;\r\n\r\n\t\tfunc = this.adapter.apply(\"exportFunction\", {\r\n\t\t\tfunc: func as any,\r\n\t\t\ttype: type,\r\n\t\t\toptions: options\r\n\t\t}).func;\r\n\r\n\t\t// Get exported stuff\r\n\t\tlet data = await func.call(this, type, options);\r\n\r\n\t\t// Release pointers\r\n\t\tthis._exportRunning = false;\r\n\t\tthis._releasePointers();\r\n\r\n\t\t// Restore temporarily hidden elements\r\n\t\tthis.restoreNonExportableSprites();\r\n\r\n\t\tif (data) {\r\n\r\n\t\t\t// Dispatch event\r\n\t\t\tif (this.events.isEnabled(\"exportfinished\")) {\r\n\t\t\t\tconst event: AMEvent<this, IExportEvents>[\"exportfinished\"] = {\r\n\t\t\t\t\t\"type\": \"exportfinished\",\r\n\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\"format\": type,\r\n\t\t\t\t\t\"options\": options\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"exportfinished\", event);\r\n\t\t\t}\r\n\r\n\t\t\t// Hide preloader and timeout modals\r\n\t\t\tthis.hidePreloader();\r\n\t\t\tthis.hideTimeout();\r\n\t\t\tif (this.menu) {\r\n\t\t\t\tthis.menu.close();\r\n\t\t\t}\r\n\r\n\t\t\t// Download or print\r\n\t\t\tif (type === \"print\") {\r\n\t\t\t\treturn this.print(data, <IExportOptions[\"print\"]>options, this.adapter.apply(\"title\", {\r\n\t\t\t\t\ttitle: this.title,\r\n\t\t\t\t\toptions: options\r\n\t\t\t\t}).title);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (type == \"pdfdata\") {\r\n\t\t\t\t\treturn this.download(data, this.filePrefix + \".pdf\");\r\n\t\t\t\t}\r\n\t\t\t\treturn this.download(data, this.filePrefix + \".\" + type, (options && (<IExportCSVOptions>options).addBOM));\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Throw exception?\r\n\t\t\t// @todo\r\n\r\n\t\t\t// Dispatch event\r\n\t\t\tif (this.events.isEnabled(\"error\")) {\r\n\t\t\t\tconst event: AMEvent<this, IExportEvents>[\"error\"] = {\r\n\t\t\t\t\t\"type\": \"error\",\r\n\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\"format\": type,\r\n\t\t\t\t\t\"options\": options\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"error\", event);\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * A function that should handle unsupported export types.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param type     Export type\r\n\t * @param options  Options\r\n\t * @return Promise\r\n\t * @async\r\n\t */\r\n\tpublic async unsupported<Key extends keyof IExportOptions>(type: Key, options?: IExportOptions[Key]): Promise<string> {\r\n\t\t// TODO should this return `undefined`?\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Handles click on a \"custom\" menu item.\r\n\t *\r\n\t * Basically, if it has \"callback\" enabled, it will be called. Nothing else.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param options  Options\r\n\t */\r\n\tpublic handleCustom(options: IExportCustomOptions): void {\r\n\t\tif ($type.hasValue(options) && $type.hasValue(options.callback)) {\r\n\t\t\toptions.callback.call(options.callbackTarget || this, options);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Requests a Print of the chart.\r\n\t *\r\n\t * @param type     Export type\r\n\t * @param options  Options\r\n\t * @return Promise\r\n\t * @async\r\n\t */\r\n\tpublic async getPrint(type: string, options?: IExportPrintOptions): Promise<string> {\r\n\t\treturn this.getImage(\"png\", options);\r\n\t}\r\n\r\n\t/**\r\n\t * A function that returns data: URI encoded @font-family, so that way it can be embedded into SVG.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return String which can be embedded directly into a <style> element.\r\n\t * @async\r\n\t */\r\n\tpublic async getFontFamilies(): Promise<{ blobs: Array<string>, cssText: string }> {\r\n\t\tconst DOMURL = this.getDOMURL();\r\n\r\n\t\tconst blobs: Array<string> = [];\r\n\t\tconst promises: Array<Promise<string>> = [];\r\n\r\n\t\tawait eachStylesheets((topUrl, rule) => {\r\n\t\t\tif (rule.type === CSSRule.FONT_FACE_RULE) {\r\n\t\t\t\tconst cssText = rule.cssText;\r\n\r\n\t\t\t\t// TODO this is necessary because Edge doesn't let you access the src using getPropertyValue\r\n\t\t\t\tconst src = fontFamilySrcRegexp.exec(cssText);\r\n\r\n\t\t\t\tif (src !== null) {\r\n\t\t\t\t\t// TODO make this faster (don't create Promises for non-url stuff)\r\n\t\t\t\t\tconst urls: Array<Promise<string | null>> = src[1].split(/ *, */).map(async (url) => {\r\n\t\t\t\t\t\t// TODO better parsing for this\r\n\t\t\t\t\t\t// TODO is it necessary to handle ' ?\r\n\t\t\t\t\t\tconst a = /^url\\([\"']?([^\"'\\)]+)[\"']?\\)([^,]*)$/.exec(url);\r\n\r\n\t\t\t\t\t\tif (a === null) {\r\n\t\t\t\t\t\t\treturn url;\r\n\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconst after = a[2];\r\n\r\n\t\t\t\t\t\t\tconst fullUrl = $utils.joinUrl(topUrl, a[1]);\r\n\r\n\t\t\t\t\t\t\tif (this.webFontFilter && !fullUrl.match(this.webFontFilter)) {\r\n\t\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t// Fetch the actual font-file (.woff)\r\n\t\t\t\t\t\t\t\tconst response = await $net.load(fullUrl, undefined, { responseType: \"blob\" });\r\n\r\n\t\t\t\t\t\t\t\tlet url;\r\n\r\n\t\t\t\t\t\t\t\t// We need blob for IE and Edge\r\n\t\t\t\t\t\t\t\tif (supportsBlobUri()) {\r\n\t\t\t\t\t\t\t\t\turl = DOMURL.createObjectURL(response.blob);\r\n\t\t\t\t\t\t\t\t\tblobs.push(url);\r\n\r\n\t\t\t\t\t\t\t\t\t// We need a data URI for Firefox and Chrome\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\turl = await blobToDataUri(response.blob);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// TODO should it should escape the URI ?\r\n\t\t\t\t\t\t\t\treturn \"url(\\\"\" + url + \"\\\")\" + after;\r\n\r\n\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\tconsole.error(\"Failed to load font\", fullUrl, e);\r\n\t\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tpromises.push(Promise.all(urls).then((a) => {\r\n\t\t\t\t\t\ta = a.filter((x) => x != null);\r\n\r\n\t\t\t\t\t\tif (a.length === 0) {\r\n\t\t\t\t\t\t\treturn \"\";\r\n\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn cssText.replace(fontFamilySrcRegexp, \"src: \" + a.join(\", \") + \";\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst a = await Promise.all(promises);\r\n\r\n\t\treturn {\r\n\t\t\tblobs: blobs,\r\n\t\t\tcssText: a.filter((x) => !!x).join(\"\\n\")\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Produces image output from the element.\r\n\t *\r\n\t * Converts to a `Canvas` first, then produces an image to download.\r\n\t *\r\n\t * This is an asynchronous function. Rather than returning a result, it\r\n\t * returns a Promise.\r\n\t *\r\n\t * You can use `await` notion from other async functions, or `then()`\r\n\t * anywhere else.\r\n\t *\r\n\t * ```TypeScript\r\n\t * let img;\r\n\t *\r\n\t * // Async\r\n\t * img = await chart.exporting.getImage( \"png\" );\r\n\t *\r\n\t * // Sync\r\n\t * chart.exporting.getImage( \"png\" ).then( ( data ) => {\r\n\t *   img = data;\r\n\t * } );\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * var img;\r\n\t * chart.exporting.getImage( \"png\" ).then( ( data ) => {\r\n\t *   img = data;\r\n\t * } );\r\n\t * ```\r\n\t *\r\n\t * @param  type           Image format\r\n\t * @param  options        Options\r\n\t * @param  includeExtras  Should extra sprites be included if set?\r\n\t * @return Promise\r\n\t */\r\n\tpublic async getImage<Key extends imageFormats>(type: Key, options?: IExportImageOptions, includeExtras?: boolean): Promise<string> {\r\n\r\n\t\tlet prehidden = this._objectsAlreadyHidden;\r\n\t\tif (!prehidden) {\r\n\t\t\tthis.hideNonExportableSprites();\r\n\t\t}\r\n\r\n\t\tif (!$type.hasValue(options)) {\r\n\t\t\toptions = this.getFormatOptions(type);\r\n\t\t}\r\n\r\n\t\t// Wait for required elements to be ready before proceeding\r\n\t\tawait this.awaitValidSprites();\r\n\r\n\t\t// Are we using simplified export option?\r\n\t\tif (await this.simplifiedImageExport()) {\r\n\r\n\t\t\tlet canvas;\r\n\t\t\ttry {\r\n\t\t\t\tcanvas = await this.getCanvas(options);\r\n\r\n\t\t\t\t// Add extra sprites\r\n\t\t\t\tif (includeExtras !== false) {\r\n\t\t\t\t\tcanvas = await this.addExtras(canvas, options);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Convert to data uri\r\n\t\t\t\tlet uri = canvas.toDataURL(this.getContentType(type), options.quality);\r\n\r\n\t\t\t\t// Get rid of the canvas\r\n\t\t\t\tthis.disposeCanvas(canvas);\r\n\r\n\t\t\t\tif (!prehidden) {\r\n\t\t\t\t\tthis.restoreNonExportableSprites();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn uri;\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\tconsole.error(e.message + \"\\n\" + e.stack);\r\n\t\t\t\t$log.warn(\"Simple export failed, falling back to advanced export\");\r\n\r\n\t\t\t\tif (canvas) {\r\n\t\t\t\t\tthis.disposeCanvas(canvas);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// An error occurred, let's try advanced method\r\n\t\t\t\tconst data = await this.getImageAdvanced(type, options, includeExtras);\r\n\r\n\t\t\t\tif (!prehidden) {\r\n\t\t\t\t\tthis.restoreNonExportableSprites();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn data;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\t/**\r\n\t\t\t * Going the hard way. Converting to canvas from each node\r\n\t\t\t */\r\n\t\t\tconst data = await this.getImageAdvanced(type, options, includeExtras);\r\n\r\n\t\t\tif (!prehidden) {\r\n\t\t\t\tthis.restoreNonExportableSprites();\r\n\t\t\t}\r\n\r\n\t\t\treturn data;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Adds extra elements to the canvas.\r\n\t *\r\n\t * @param  canvas   Original canvas\r\n\t * @param  options  Options\r\n\t */\r\n\tprivate async addExtras(canvas: HTMLCanvasElement, options?: IExportImageOptions, advanced?: boolean): Promise<HTMLCanvasElement> {\r\n\t\tif (this.extraSprites.length) {\r\n\t\t\tlet middleLeft = 0;\r\n\t\t\tlet middleTop = 0;\r\n\t\t\tlet middleWidth = canvas.width;\r\n\t\t\tlet middleHeight = canvas.height;\r\n\t\t\tlet extraRight = 0;\r\n\t\t\tlet extraBottom = 0;\r\n\r\n\t\t\tconst extras = await Promise.all($array.map(this.extraSprites, async (extraSprite) => {\r\n\t\t\t\t// Get that extra\r\n\t\t\t\tlet extra: IExportCanvas;\r\n\r\n\t\t\t\tif (extraSprite instanceof Sprite) {\r\n\t\t\t\t\textra = {\r\n\t\t\t\t\t\tsprite: extraSprite,\r\n\t\t\t\t\t\tposition: \"bottom\"\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\textra = extraSprite;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Set defaults\r\n\t\t\t\textra.position = extra.position || \"bottom\";\r\n\t\t\t\textra.marginTop = extra.marginTop || 0;\r\n\t\t\t\textra.marginRight = extra.marginRight || 0;\r\n\t\t\t\textra.marginBottom = extra.marginBottom || 0;\r\n\t\t\t\textra.marginLeft = extra.marginLeft || 0;\r\n\r\n\t\t\t\tlet extraCanvas;\r\n\r\n\t\t\t\tif (advanced) {\r\n\t\t\t\t\textraCanvas = await extra.sprite.exporting.getCanvasAdvanced(options);\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\textraCanvas = await extra.sprite.exporting.getCanvas(options);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst extraWidth = extraCanvas.width + extra.marginLeft + extra.marginRight;\r\n\t\t\t\tconst extraHeight = extraCanvas.height + extra.marginTop + extra.marginBottom;\r\n\r\n\t\t\t\tif (extra.position == \"top\") {\r\n\t\t\t\t\tmiddleWidth = extra.crop ? middleHeight : $math.max(middleWidth, extraWidth);\r\n\t\t\t\t\tmiddleTop += extraHeight;\r\n\r\n\t\t\t\t} else if (extra.position == \"right\") {\r\n\t\t\t\t\tmiddleHeight = extra.crop ? middleHeight : $math.max(middleHeight, extraHeight);\r\n\t\t\t\t\textraRight += extraWidth;\r\n\r\n\t\t\t\t} else if (extra.position == \"left\") {\r\n\t\t\t\t\tmiddleHeight = extra.crop ? middleHeight : $math.max(middleHeight, extraHeight);\r\n\t\t\t\t\tmiddleLeft += extraWidth;\r\n\r\n\t\t\t\t} else if (extra.position === \"bottom\") {\r\n\t\t\t\t\tmiddleWidth = extra.crop ? middleHeight : $math.max(middleWidth, extraWidth);\r\n\t\t\t\t\textraBottom += extraHeight;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tcanvas: extraCanvas,\r\n\t\t\t\t\tposition: extra.position,\r\n\t\t\t\t\tleft: extra.marginLeft,\r\n\t\t\t\t\ttop: extra.marginTop,\r\n\t\t\t\t\twidth: extraWidth,\r\n\t\t\t\t\theight: extraHeight\r\n\t\t\t\t};\r\n\t\t\t}));\r\n\r\n\t\t\tconst newCanvas = this.getDisposableCanvas();\r\n\r\n\t\t\tnewCanvas.width = middleLeft + middleWidth + extraRight;\r\n\t\t\tnewCanvas.height = middleTop + middleHeight + extraBottom;\r\n\r\n\t\t\tconst ctx = newCanvas.getContext(\"2d\");\r\n\r\n\t\t\t// Get background\r\n\t\t\tconst background = this.backgroundColor || this.findBackgroundColor(this.sprite.dom);\r\n\r\n\t\t\tif (background) {\r\n\t\t\t\tctx.fillStyle = background.toString();\r\n\t\t\t\tctx.fillRect(0, 0, newCanvas.width, newCanvas.height);\r\n\t\t\t}\r\n\r\n\t\t\tlet left = middleLeft;\r\n\t\t\tlet top = middleTop;\r\n\t\t\tlet right = left + middleWidth;\r\n\t\t\tlet bottom = top + middleHeight;\r\n\r\n\t\t\t// Radiates outwards from center\r\n\t\t\t$array.each(extras, (extra) => {\r\n\t\t\t\tif (extra.position == \"top\") {\r\n\t\t\t\t\ttop -= extra.height;\r\n\t\t\t\t\tctx.drawImage(extra.canvas, middleLeft + extra.left, top + extra.top);\r\n\r\n\t\t\t\t} else if (extra.position == \"right\") {\r\n\t\t\t\t\tctx.drawImage(extra.canvas, right + extra.left, middleTop + extra.top);\r\n\t\t\t\t\tright += extra.width;\r\n\r\n\t\t\t\t} else if (extra.position == \"left\") {\r\n\t\t\t\t\tleft -= extra.width;\r\n\t\t\t\t\tctx.drawImage(extra.canvas, left + extra.left, middleTop + extra.top);\r\n\r\n\t\t\t\t} else if (extra.position === \"bottom\") {\r\n\t\t\t\t\tctx.drawImage(extra.canvas, middleLeft + extra.left, bottom + extra.top);\r\n\t\t\t\t\tbottom += extra.height;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.disposeCanvas(extra.canvas);\r\n\t\t\t});\r\n\r\n\t\t\tctx.drawImage(canvas, middleLeft, middleTop);\r\n\r\n\t\t\treturn newCanvas;\r\n\r\n\t\t} else {\r\n\t\t\treturn canvas;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns canvas representation of the [[Sprite]].\r\n\t *\r\n\t * @param   options  Options\r\n\t * @return           Canvas\r\n\t */\r\n\tpublic async getCanvas(options?: IExportImageOptions): Promise<HTMLCanvasElement> {\r\n\r\n\t\t// Options are set?\r\n\t\tif (!$type.hasValue(options)) {\r\n\t\t\toptions = {};\r\n\t\t}\r\n\r\n\t\t// Get background\r\n\t\tlet background = this.backgroundColor || this.findBackgroundColor(this.sprite.dom);\r\n\r\n\t\t// Get DOM URL\r\n\t\tlet DOMURL = this.getDOMURL();\r\n\t\tlet url: string | null = null;\r\n\t\tlet blobs: Array<string> | null = null;\r\n\t\tlet canvas;\r\n\r\n\t\t// Create temporary image element\r\n\t\ttry {\r\n\t\t\t/**\r\n\t\t\t * Simplified version using `createObjectURL`\r\n\t\t\t * Not supported in older browsers\r\n\t\t\t */\r\n\r\n\t\t\t// Get dimensions\r\n\t\t\tlet width = this.sprite.pixelWidth;\r\n\t\t\tlet height = this.sprite.pixelHeight;\r\n\t\t\tlet font = $dom.findFont(this.sprite.dom);\r\n\t\t\tlet fontSize = $dom.findFontSize(this.sprite.dom);\r\n\t\t\tlet scale = options.scale || 1;\r\n\t\t\tlet pixelRatio = this.getPixelRatio(options);\r\n\r\n\t\t\t// Check if scale needs to be updated as per min/max dimensions\r\n\t\t\tscale = this.getAdjustedScale(width * pixelRatio, height * pixelRatio, scale, options);\r\n\r\n\t\t\t// Create canvas and its 2D context\r\n\t\t\tcanvas = this.getDisposableCanvas();\r\n\r\n\t\t\t// Set canvas width/height\r\n\t\t\tcanvas.style.width = width * scale + 'px';\r\n\t\t\tcanvas.style.height = height * scale + 'px';\r\n\t\t\tcanvas.width = width * scale;\r\n\t\t\tcanvas.height = height * scale;\r\n\r\n\t\t\tlet ctx = canvas.getContext(\"2d\");\r\n\r\n\t\t\t// if (pixelRatio != 1) {\r\n\t\t\t// \tctx.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\r\n\t\t\t// }\r\n\r\n\t\t\t// Add background if necessary\r\n\t\t\tif (background) {\r\n\t\t\t\tctx.fillStyle = background.toString();\r\n\t\t\t\tctx.fillRect(0, 0, width * scale, height * scale);\r\n\t\t\t}\r\n\r\n\t\t\tlet promises: Promise<any>[] = [];\r\n\r\n\t\t\tif (this.useWebFonts) {\r\n\t\t\t\t// TODO what if one of the other things errors before it's been able to set `blobs` ?\r\n\t\t\t\tpromises.push(this.getFontFamilies().then((fonts) => {\r\n\t\t\t\t\tblobs = fonts.blobs;\r\n\t\t\t\t\treturn fonts.cssText;\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\r\n\t\t\tpromises.push(this.imagesToDataURI(this.sprite.dom, options));\r\n\t\t\tpromises.push(this.prepForeignObjects(this.sprite.dom, options));\r\n\r\n\t\t\t// Do prepareations on a document\r\n\t\t\tlet a = await Promise.all(promises);\r\n\r\n\t\t\t// Get SVG representation of the Sprite\r\n\t\t\tlet data = this.normalizeSVG(\r\n\t\t\t\t\"<style>\" + a[0] + \"</style>\" + this.serializeElement(this.sprite.paper.defs) + this.serializeElement(this.sprite.dom),\r\n\t\t\t\toptions,\r\n\t\t\t\twidth,\r\n\t\t\t\theight,\r\n\t\t\t\tscale,\r\n\t\t\t\tfont,\r\n\t\t\t\tfontSize\r\n\t\t\t);\r\n\r\n\t\t\t// Get Blob representation of SVG and create object URL\r\n\t\t\tlet svg = new Blob([data], { type: \"image/svg+xml\" });\r\n\t\t\turl = DOMURL.createObjectURL(svg);\r\n\t\t\tlet img = await this.loadNewImage(url, width * scale * pixelRatio, height * scale * pixelRatio, \"anonymous\");\r\n\r\n\t\t\t// Draw image on canvas\r\n\t\t\tctx.drawImage(img, 0, 0);\r\n\r\n\t\t} finally {\r\n\t\t\tif (url !== null) {\r\n\t\t\t\tDOMURL.revokeObjectURL(url);\r\n\t\t\t}\r\n\r\n\t\t\tif (blobs !== null) {\r\n\t\t\t\t$array.each(blobs, (url) => {\r\n\t\t\t\t\tDOMURL.revokeObjectURL(url);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Restore replaced tainted images in DOM\r\n\t\t\tthis.restoreRemovedObjects();\r\n\t\t}\r\n\r\n\t\treturn canvas;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns canvas representation of the [[Sprite]] using canvg.\r\n\t *\r\n\t * @param   options  Options\r\n\t * @return           Canvas\r\n\t */\r\n\tpublic async getCanvasAdvanced(options?: IExportImageOptions): Promise<HTMLCanvasElement> {\r\n\r\n\t\t// Options are set?\r\n\t\tif (!$type.hasValue(options)) {\r\n\t\t\toptions = {};\r\n\t\t}\r\n\t\t// Convert external images to data uris\r\n\t\tawait this.imagesToDataURI(this.sprite.dom, options);\r\n\r\n\t\t// Get background\r\n\t\tlet background = this.backgroundColor || this.findBackgroundColor(this.sprite.dom);\r\n\r\n\t\t// Get canvg\r\n\t\tlet canvg = await this.canvg;\r\n\r\n\t\t// Get dimensions\r\n\t\tlet width = this.sprite.pixelWidth;\r\n\t\tlet height = this.sprite.pixelHeight;\r\n\t\tlet font = $dom.findFont(this.sprite.dom);\r\n\t\tlet fontSize = $dom.findFontSize(this.sprite.dom);\r\n\t\tlet scale = options.scale || 1;\r\n\t\tlet pixelRatio = this.getPixelRatio(options);\r\n\r\n\t\t// Check if scale needs to be updated as per min/max dimensions\r\n\t\tscale = this.getAdjustedScale(width * pixelRatio, height * pixelRatio, scale, options);\r\n\r\n\t\t// Get SVG representation of the Sprite\r\n\t\tlet data = this.normalizeSVG(\r\n\t\t\tthis.serializeElement(this.sprite.paper.defs) + this.serializeElement(this.sprite.dom),\r\n\t\t\toptions,\r\n\t\t\twidth,\r\n\t\t\theight,\r\n\t\t\tscale,\r\n\t\t\tfont,\r\n\t\t\tfontSize,\r\n\t\t\tbackground\r\n\t\t);\r\n\r\n\t\t// Create canvas and its 2D context\r\n\t\tlet canvas = this.getDisposableCanvas();\r\n\r\n\t\t// Set canvas width/height\r\n\t\tcanvas.style.width = (width * pixelRatio * scale) + 'px';\r\n\t\tcanvas.style.height = (height * pixelRatio * scale) + 'px';\r\n\t\tcanvas.width = width * pixelRatio * scale;\r\n\t\tcanvas.height = height * pixelRatio * scale;\r\n\r\n\t\tlet config: any = {\r\n\t\t\t//ignoreDimensions: true,\r\n\t\t\tuseCORS: true\r\n\t\t};\r\n\r\n\t\tif (pixelRatio != 1) {\r\n\t\t\tconfig.ignoreDimensions = true;\r\n\t\t\tconfig.scaleWidth = width * pixelRatio * scale;\r\n\t\t\tconfig.scaleHeight = height * pixelRatio * scale;\r\n\t\t}\r\n\r\n\t\tawait canvg.fromString(canvas.getContext(\"2d\"), data, config).render();\r\n\r\n\t\treturn canvas;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Tries to dynamically load [canvg.js](https://github.com/canvg/canvg) and\r\n\t * export an image using its functions.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @param type     Image format\r\n\t * @param options  Options\r\n\t * @return Data uri\r\n\t */\r\n\tpublic async getImageAdvanced(type: imageFormats, options?: IExportImageOptions, includeExtras?: boolean): Promise<string> {\r\n\r\n\t\tlet prehidden = this._objectsAlreadyHidden;\r\n\t\tif (!prehidden) {\r\n\t\t\tthis.hideNonExportableSprites();\r\n\t\t}\r\n\r\n\t\tif (!$type.hasValue(options)) {\r\n\t\t\toptions = this.getFormatOptions(type);\r\n\t\t}\r\n\t\t// Get canvas\r\n\t\tlet canvas = await this.getCanvasAdvanced(options);\r\n\r\n\t\t// Add extra sprites\r\n\t\tif (includeExtras !== false) {\r\n\t\t\tcanvas = await this.addExtras(canvas, options, true);\r\n\t\t}\r\n\r\n\t\t// Convert canvas to data url\r\n\t\tlet uri = canvas.toDataURL(this.getContentType(type), options.quality);\r\n\r\n\t\t// Get rid of the canvas\r\n\t\tthis.disposeCanvas(canvas);\r\n\r\n\t\tif (!prehidden) {\r\n\t\t\tthis.restoreNonExportableSprites();\r\n\t\t}\r\n\r\n\t\treturn uri;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a `<canvas>` element and returns it.\r\n\t *\r\n\t * @return Canvas element\r\n\t */\r\n\tprotected getDisposableCanvas(): HTMLCanvasElement {\r\n\t\tlet canvas = document.createElement(\"canvas\");\r\n\t\tcanvas.style.position = \"fixed\";\r\n\t\tcanvas.style.top = \"-10000px\";\r\n\t\tdocument.body.appendChild(canvas);\r\n\t\treturn canvas;\r\n\t}\r\n\r\n\t/**\r\n\t * Removes canvas.\r\n\t *\r\n\t * @param canvas  Canvas element\r\n\t */\r\n\tprotected disposeCanvas(canvas: HTMLCanvasElement): void {\r\n\t\tdocument.body.removeChild(canvas);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns pixel ratio for retina displays.\r\n\t *\r\n\t * @return Pixel ratio\r\n\t */\r\n\tprotected getPixelRatio(options?: IExportImageOptions): number {\r\n\t\t// const scale = options && options.scale ? options.scale : 1;\r\n\t\t// return (this.useRetina ? $utils.getPixelRatio() : 1) * scale;\r\n\t\treturn this.useRetina ? $utils.getPixelRatio() : 1;\r\n\t}\r\n\r\n\t/**\r\n\t * Calculates adjusted scale if image does not fit or is larger than min/max\r\n\t * settings.\r\n\t *\r\n\t * @param   width    Width of the source image\r\n\t * @param   height   Height of the source image\r\n\t * @param   scale    Current scale\r\n\t * @param   options  Options\r\n\t * @return           Adjusted scale\r\n\t */\r\n\tprotected getAdjustedScale(width: number, height: number, scale: number, options?: IExportImageOptions): number {\r\n\r\n\t\tif (!options) {\r\n\t\t\treturn scale;\r\n\t\t}\r\n\r\n\t\tlet adjWidth = width * scale;\r\n\t\tlet adjHeight = width * scale;\r\n\r\n\t\t// Check max restrictions\r\n\t\tlet widthScale;\r\n\t\tlet heightScale;\r\n\t\tif (options.maxWidth && (adjWidth > options.maxWidth)) {\r\n\t\t\twidthScale = options.maxWidth / width;\r\n\t\t}\r\n\t\tif (options.maxHeight && (adjHeight > options.maxHeight)) {\r\n\t\t\theightScale = options.maxHeight / height;\r\n\t\t}\r\n\t\tif (widthScale || heightScale) {\r\n\t\t\treturn $math.min(widthScale, heightScale)\r\n\t\t}\r\n\r\n\t\t// Check min restrictions\r\n\t\tif (options.minWidth && (adjWidth < options.minWidth)) {\r\n\t\t\twidthScale = options.minWidth / width;\r\n\t\t}\r\n\t\tif (options.minHeight && (adjHeight < options.minHeight)) {\r\n\t\t\theightScale = options.minHeight / height;\r\n\t\t}\r\n\t\tif (widthScale || heightScale) {\r\n\t\t\treturn $math.max(widthScale, heightScale)\r\n\t\t}\r\n\r\n\t\treturn scale;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts all `<image>` tags in SVG to use data uris instead of external\r\n\t * URLs\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param el       SVG node\r\n\t * @param options  Options\r\n\t * @return Promise\r\n\t */\r\n\tpublic async imagesToDataURI(el: SVGSVGElement, options?: IExportImageOptions): Promise<void> {\r\n\r\n\t\t// Get and process all images\r\n\t\tlet images = el.querySelectorAll(\"image\");\r\n\t\tif (images.length) {\r\n\r\n\t\t\t// Init promises\r\n\t\t\tlet promises = [];\r\n\r\n\t\t\t// There are images, process each of them\r\n\t\t\tfor (let count = images.length, i = 0; i < count; i++) {\r\n\r\n\t\t\t\t// Get image and its href\r\n\t\t\t\tlet image = images[i];\r\n\t\t\t\tlet href = image.getAttributeNS(Export.XLINK, \"href\");\r\n\r\n\t\t\t\t// no href?\r\n\t\t\t\tif (!href) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (href.indexOf(\"data:image\") !== -1) {\r\n\t\t\t\t\t// Ignore image if it's already in Data URI format\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\r\n\t\t\t\t\t// SVG or bitmap image?\r\n\t\t\t\t\tif (href.indexOf(\".svg\") !== -1) {\r\n\t\t\t\t\t\tpromises.push(this.svgToDataURI(image, options));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tpromises.push(this.imageToDataURI(image, options));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tawait Promise.all(promises);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * `foreignObject` elements cannot be exported. This function hides them\r\n\t * temprarily. In the future it might try to convert them to SVG to make them\r\n\t * exportable.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param el       SVG node\r\n\t * @param options  Options\r\n\t * @return Promise\r\n\t */\r\n\tpublic async prepForeignObjects(el: SVGSVGElement, options?: IExportImageOptions): Promise<void> {\r\n\r\n\t\t// Get and process all foreign objects\r\n\t\tlet objects = el.querySelectorAll(\"foreignObject\");\r\n\t\tif (objects.length) {\r\n\r\n\t\t\t// There are foreign objects, process each of them\r\n\t\t\tfor (let count = objects.length, i = 0; i < count; i++) {\r\n\t\t\t\tthis.temporarilyRemoveObject(objects[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts an SVG `<image>` to use its data uri for `href` instead of\r\n\t * external file.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param el       SVG element\r\n\t * @param options  Options\r\n\t */\r\n\tpublic async imageToDataURI(el: SVGImageElement, options?: IExportImageOptions): Promise<string> {\r\n\r\n\t\t// Create a new image and set its `crossOrigin`. This might not work on some\r\n\t\t// browsers. We'll deal with it if error occurs\r\n\t\tlet img: HTMLImageElement;\r\n\t\ttry {\r\n\r\n\t\t\t// Create image\r\n\t\t\timg = await this.loadNewImage(el.getAttributeNS(Export.XLINK, \"href\"), null, null, \"anonymous\");\r\n\r\n\t\t\t// Create new canvas\r\n\t\t\tlet canvas = document.createElement(\"canvas\");\r\n\t\t\tcanvas.width = img.width;\r\n\t\t\tcanvas.height = img.height;\r\n\r\n\t\t\t// Draw new image on it via `toDataURL`\r\n\t\t\tcanvas.getContext(\"2d\").drawImage(img, 0, 0);\r\n\r\n\t\t\t// Replace image `href` with data uri\r\n\t\t\t// If we got to this point it means image has loaded, however we might\r\n\t\t\t// still get an error with `toDataURL()`\r\n\t\t\ttry {\r\n\t\t\t\tlet uri = canvas.toDataURL();\r\n\t\t\t\tel.setAttribute(\"href\", uri);\r\n\t\t\t\treturn uri;\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\t// Give up and temporarily remove the element href temporarily\r\n\t\t\t\tif (options.keepTainted !== false) {\r\n\t\t\t\t\t/*this._removedObjects.push({\r\n\t\t\t\t\t\t\"element\": el,\r\n\t\t\t\t\t\t\"originalHref\": el.getAttributeNS(Export.XLINK, \"href\")\r\n\t\t\t\t\t});\r\n\t\t\t\t\tel.setAttributeNS(Export.XLINK, \"href\", \"\");*/\r\n\t\t\t\t\tthis.temporarilyRemoveObject(el);\r\n\t\t\t\t}\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tcatch (e) {\r\n\r\n\t\t\t// Give up and temporarily remove the element's href\r\n\t\t\tif (!options || options.keepTainted !== false) {\r\n\t\t\t\t/*this._removedObjects.push({\r\n\t\t\t\t\t\"element\": el,\r\n\t\t\t\t\t\"originalHref\": el.getAttributeNS(Export.XLINK, \"href\")\r\n\t\t\t\t});\r\n\t\t\t\tel.setAttributeNS(Export.XLINK, \"href\", \"\");*/\r\n\t\t\t\tthis.temporarilyRemoveObject(el);\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Converts `<image>` with external SVG source to data uri. Loads external SVG\r\n\t * file, then converts it to data uri and replaces the `xlink:href` parameter.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param el        An SVG element\r\n\t * @param options   Options\r\n\t */\r\n\tpublic async svgToDataURI(el: SVGImageElement, options?: IExportImageOptions): Promise<string> {\r\n\t\tlet href = el.getAttributeNS(Export.XLINK, \"href\");\r\n\t\ttry {\r\n\t\t\tlet data = await $net.load(href);\r\n\t\t\tlet charset = this.adapter.apply(\"charset\", {\r\n\t\t\t\tcharset: \"base64\",\r\n\t\t\t\ttype: \"svg\",\r\n\t\t\t\toptions: options\r\n\t\t\t}).charset;\r\n\r\n\t\t\tlet uri = this.adapter.apply(\"svgToDataURI\", {\r\n\t\t\t\tdata: \"data:\" + this.getContentType(\"svg\") + \";\" + charset + \",\" + btoa(data.response),\r\n\t\t\t\toptions: options\r\n\t\t\t}).data;\r\n\r\n\t\t\tel.setAttributeNS(Export.XLINK, \"href\", uri);\r\n\t\t\treturn uri;\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\t// Disable temporarily\r\n\t\t\tif (!options || options.keepTainted !== false) {\r\n\t\t\t\t/*this._removedObjects.push({\r\n\t\t\t\t\t\"element\": el,\r\n\t\t\t\t\t\"originalHref\": href\r\n\t\t\t\t});\r\n\t\t\t\tel.setAttributeNS(Export.XLINK, \"href\", \"\");*/\r\n\t\t\t\tthis.temporarilyRemoveObject(el);\r\n\t\t\t}\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Temporarily removes element from DOM, and replaces it with a dummy\r\n\t * placeholder, as well as stores it for later restoration.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param el Node\r\n\t */\r\n\tpublic temporarilyRemoveObject(el: Node, placeholder?: SVGSVGElement): void {\r\n\r\n\t\t// Get parent\r\n\t\tlet parent = el.parentElement || el.parentNode;\r\n\r\n\t\t// Create a placeholder group element if it has not been passed in\r\n\t\tif (!placeholder) {\r\n\t\t\tplaceholder = this.sprite.paper.add(\"g\").node;\r\n\t\t}\r\n\t\tparent.insertBefore(placeholder, el);\r\n\r\n\t\t// Check if we have a textContents we can replace with\r\n\t\t// @todo Perhaps we should explore alternatives to creating text nodes\r\n\t\t// i.e. creating a text version of the HTML-based Text, just for export\r\n\t\t// purposes. Converting HTML into SVG is very complicated\r\n\t\tif (el.textContent) {\r\n\t\t\t/*let text = this.sprite.paper.add(\"text\").node;\r\n\t\t\ttext.textContent = el.textContent;\r\n\t\t\tplaceholder.appendChild(text);\r\n\r\n\t\t\t// Copy properties from the removing element to the placeholder\r\n\t\t\t$dom.copyAttributes(el, placeholder);*/\r\n\t\t}\r\n\r\n\t\t// Remove the old element\r\n\t\tparent.removeChild(el);\r\n\r\n\t\t// Log removed item\r\n\t\tthis._removedObjects.push({\r\n\t\t\t\"element\": el,\r\n\t\t\t\"placeholder\": placeholder\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Restores all (possibly tainted or unsupported) objects that were\r\n\t * temporarily removed when exporting.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic restoreRemovedObjects(): void {\r\n\t\tlet obj: IExportRemovedObject;\r\n\r\n\t\twhile (true) {\r\n\t\t\tobj = this._removedObjects.pop()\r\n\r\n\t\t\tif (!obj) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t//obj.element.setAttribute(\"href\", obj.originalHref);\r\n\t\t\tlet parent = obj.placeholder.parentElement || obj.placeholder.parentNode;\r\n\t\t\tparent.insertBefore(obj.element, obj.placeholder);\r\n\t\t\t//parent.removeChild(obj.placeholder);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checkes if simplified export can be used using `createObjectURL` and SVG\r\n\t * document does not contain any external images.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return `true` if simplified export can be used\r\n\t */\r\n\tpublic async simplifiedImageExport(): Promise<boolean> {\r\n\r\n\t\tif (this.useSimplifiedExport === false) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// Do we have this cached?\r\n\t\tlet cache = registry.getCache(\"simplifiedImageExport\");\r\n\t\tif (cache === false || cache === true) {\r\n\t\t\treturn cache;\r\n\t\t}\r\n\r\n\t\t// Try generating a small SVG-embedded canvas\r\n\t\t// If exception occurs, simplified method is not supported\r\n\t\ttry {\r\n\t\t\tlet canvas = document.createElement(\"canvas\");\r\n\t\t\tcanvas.width = 1;\r\n\t\t\tcanvas.height = 1;\r\n\t\t\tlet ctx = canvas.getContext(\"2d\");\r\n\t\t\tlet DOMURL = this.getDOMURL();\r\n\t\t\tlet svg = new Blob([this.normalizeSVG(\"<g></g>\", {}, 1, 1)], { type: \"image/svg+xml\" });\r\n\t\t\tlet url = DOMURL.createObjectURL(svg);\r\n\t\t\tlet img;\r\n\t\t\ttry {\r\n\t\t\t\timg = await this.loadNewImage(url, 1, 1);\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tctx.drawImage(img, 0, 0);\r\n\t\t\tDOMURL.revokeObjectURL(url);\r\n\t\t\ttry {\r\n\t\t\t\t//let uri = canvas.toDataURL(\"image/png\");\r\n\t\t\t\tregistry.setCache(\"simplifiedImageExport\", true);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\tregistry.setCache(\"simplifiedImageExport\", false);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t} catch (e) {\r\n\t\t\tregistry.setCache(\"simplifiedImageExport\", false);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a new `<image>` element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param url          URL of the image\r\n\t * @param width        Width (px)\r\n\t * @param height       Height (px)\r\n\t * @param crossOrigin  Cross-Origin setting\r\n\t * @return Promise\r\n\t */\r\n\tpublic loadNewImage(url: string, width?: number, height?: number, crossOrigin?: string): Promise<HTMLImageElement> {\r\n\t\treturn new Promise((success, error) => {\r\n\r\n\t\t\t// New image\r\n\t\t\tlet image: HTMLImageElement;\r\n\t\t\tif (width && height) {\r\n\t\t\t\timage = new Image(width, height);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\timage = new Image();\r\n\t\t\t}\r\n\r\n\t\t\t// Set crossorigin\r\n\t\t\tif (crossOrigin) {\r\n\t\t\t\timage.setAttribute(\"crossOrigin\", crossOrigin);\r\n\t\t\t}\r\n\r\n\t\t\t// Report success on load\r\n\t\t\timage.onload = () => {\r\n\t\t\t\tsuccess(image);\r\n\t\t\t};\r\n\r\n\t\t\tfunction onerror() {\r\n\t\t\t\t// Error occurred. Just in case it's the crossOrigin issue, let's try\r\n\t\t\t\t// stripping off this attribute and trying again\r\n\t\t\t\tif (crossOrigin) {\r\n\r\n\t\t\t\t\t// Retain old uri\r\n\t\t\t\t\tlet currentHref = image.src;\r\n\r\n\t\t\t\t\t// Set up another `onerror` to handle situations where image is not\r\n\t\t\t\t\t// loadable at all (i.e. protected by CORS)\r\n\t\t\t\t\timage.onerror = () => {\r\n\t\t\t\t\t\t// Nope, no luck\r\n\t\t\t\t\t\terror(new Error(\"Loading image \\\"\" + url + \"\\\" failed\"));\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t// remove the `crossOrigin` attribute\r\n\t\t\t\t\timage.removeAttribute(\"crossorigin\");\r\n\r\n\t\t\t\t\t// retry\r\n\t\t\t\t\timage.src = \"\";\r\n\t\t\t\t\timage.src = currentHref;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\terror(new Error(\"Loading image \\\"\" + url + \"\\\" failed\"));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Set image error handlers\r\n\t\t\timage.onabort = onerror;\r\n\t\t\timage.onerror = onerror;\r\n\r\n\t\t\t// Trigger load\r\n\t\t\timage.src = url;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current DOM URL.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return URL\r\n\t */\r\n\tpublic getDOMURL(): any {\r\n\t\treturn self.URL || (<any>self).webkitURL || self;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an SVG representation of the chart.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @param type       Type of the export\r\n\t * @param options    Options\r\n\t * @param encodeURI  If true, will return result will be data URI\r\n\t * @return Promise\r\n\t */\r\n\tpublic async getSVG(type: \"svg\", options?: IExportSVGOptions, encodeURI: boolean = true): Promise<string> {\r\n\r\n\t\tlet prehidden = this._objectsAlreadyHidden;\r\n\t\tif (!prehidden) {\r\n\t\t\tthis.hideNonExportableSprites();\r\n\t\t}\r\n\r\n\t\tif (!$type.hasValue(options)) {\r\n\t\t\toptions = this.getFormatOptions(\"svg\");\r\n\t\t}\r\n\r\n\t\t// Wait for required elements to be ready before proceeding\r\n\t\tawait this.awaitValidSprites();\r\n\r\n\t\t// Get dimensions\r\n\t\tlet width = this.sprite.pixelWidth;\r\n\t\tlet height = this.sprite.pixelHeight;\r\n\t\tlet font = $dom.findFont(this.sprite.dom);\r\n\t\tlet fontSize = $dom.findFontSize(this.sprite.dom);\r\n\t\tlet scale = options.scale || 1;\r\n\t\tlet pixelRatio = this.getPixelRatio(options);\r\n\r\n\t\t// Check if scale needs to be updated as per min/max dimensions\r\n\t\tscale = this.getAdjustedScale(width * pixelRatio, height * pixelRatio, scale, options);\r\n\r\n\t\t// Get SVG\r\n\t\tlet svg = this.normalizeSVG(\r\n\t\t\tthis.serializeElement(this.sprite.paper.defs) + this.serializeElement(this.sprite.dom),\r\n\t\t\toptions,\r\n\t\t\twidth,\r\n\t\t\theight,\r\n\t\t\tscale,\r\n\t\t\tfont,\r\n\t\t\tfontSize\r\n\t\t);\r\n\r\n\t\t// Prep data URI\r\n\t\tlet charset = this.adapter.apply(\"charset\", {\r\n\t\t\tcharset: \"charset=utf-8\",\r\n\t\t\ttype: \"svg\",\r\n\t\t\toptions: options\r\n\t\t}).charset;\r\n\r\n\t\tlet uri = this.adapter.apply(\"getSVG\", {\r\n\t\t\tdata: encodeURI ? \"data:\" + this.getContentType(type) + \";\" + charset + \",\" + encodeURIComponent(svg) : svg,\r\n\t\t\toptions: options\r\n\t\t}).data;\r\n\r\n\t\tif (!prehidden) {\r\n\t\t\tthis.restoreNonExportableSprites();\r\n\t\t}\r\n\r\n\t\treturn uri;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if SVG is fully formatted. Encloses in `<svg>...</svg>` if\r\n\t * necessary.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param svg       Input SVG\r\n\t * @param options   Options\r\n\t * @param width     Width of the SVG viewport\r\n\t * @param height    Height of the SVG viewport\r\n\t * @param font      Font family to use as a base\r\n\t * @param fontSize  Font size to use as a base\r\n\t * @return Output SVG\r\n\t * @todo Add style params to existing <svg>\r\n\t */\r\n\tpublic normalizeSVG(svg: string, options?: IExportSVGOptions, width?: number, height?: number, scale?: number, font?: string, fontSize?: string, background?: Color): string {\r\n\r\n\t\t// Construct width/height params\r\n\t\tlet dimParams = \"\";\r\n\t\tif (width) {\r\n\t\t\tdimParams += \"width=\\\"\" + Math.round(width * (scale || 1)) + \"px\\\" \";\r\n\t\t}\r\n\t\tif (height) {\r\n\t\t\tdimParams += \"height=\\\"\" + Math.round(height * (scale || 1)) + \"px\\\" \";\r\n\t\t}\r\n\r\n\t\t// Apply font settings\r\n\t\tlet styleParams = \"\";\r\n\t\tif (font) {\r\n\t\t\tstyleParams += \"font-family: \" + font.replace(/\"/g, \"\") + \";\";\r\n\t\t}\r\n\t\tif (fontSize) {\r\n\t\t\tstyleParams += \"font-size: \" + fontSize + \";\";\r\n\t\t}\r\n\r\n\t\t// Scale\r\n\t\tif (scale) {\r\n\t\t\tdimParams += \"viewBox=\\\"0 0 \" + (width) + \" \" + (height) + \"\\\" \";\r\n\t\t}\r\n\r\n\t\t// Remove foreign objects temporarily\r\n\t\tlet fos: string[] = [];\r\n\t\tlet ms = svg.match(/<foreignObject[\\s\\S]*<\\/foreignObject>/gi);\r\n\t\tif (ms) {\r\n\t\t\tfor (let i = 0; i < ms.length; i++) {\r\n\t\t\t\tsvg = svg.replace(ms[i], $strings.PLACEHOLDER);\r\n\t\t\t\tfos.push(ms[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Add missing <svg> enclosure\r\n\t\tif (!svg.match(/<svg/)) {\r\n\t\t\tsvg = \"<?xml version=\\\"1.0\\\" encoding=\\\"utf-8\\\"?><svg \" + dimParams + \" style=\\\"\" + styleParams + \"\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\">\" + svg + \"</svg>\";\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\tif (dimParams !== \"\") {\r\n\t\t\t\t// Clear current params\r\n\t\t\t\tsvg = svg.replace(/(<svg[^>]*)width=\"[^\"]*\"/, \"$1\");\r\n\t\t\t\tsvg = svg.replace(/(<svg[^>]*)height=\"[^\"]*\"/, \"$1\");\r\n\r\n\t\t\t\t// Add new params\r\n\t\t\t\tsvg = svg.replace(/(<svg)/, \"$1\" + dimParams);\r\n\t\t\t}\r\n\r\n\t\t\t/*if (styleParams !== \"\") {\r\n\t\t\t\t// Clear current params\r\n\t\t\t\tsvg = svg.replace(/(<svg[^>]*)stylewidth=\"[^\"]*\"/, \"$1\");\r\n\t\t\t\tsvg = svg.replace(/(<svg[^>]*)height=\"[^\"]*\"/, \"$1\");\r\n\r\n\t\t\t\t// Add new params\r\n\t\t\t\tsvg = svg.replace(/(<svg)/, \"$1\" + dimParams);\r\n\t\t\t}*/\r\n\t\t}\r\n\r\n\r\n\t\tif (background) {\r\n\t\t\tsvg = svg.replace(/(<svg[^>]*>)/, \"$1<rect width=\\\"100%\\\" height=\\\"100%\\\" fill=\\\"\" + background.rgba + \"\\\"/>\");\r\n\t\t\t//svg = svg.replace(/<\\/svg>/, \"<rect width=\\\"100%\\\" height=\\\"100%\\\" fill=\\\"\" + background.rgba + \"\\\"/></svg>\");\r\n\t\t}\r\n\r\n\t\tif ($browser.isInternetExplorer()) {\r\n\t\t\t// IE can't handle exporting <feColorMatrix> for some reason\r\n\t\t\tsvg = svg.replace(/<feColorMatrix [^\\/>]*\\/>/gi, \"\");\r\n\t\t}\r\n\r\n\t\t// Remove base uri-related stuff\r\n\t\tlet reg = new RegExp(\"url\\\\(\" + $utils.escapeForRgex($utils.getBaseURI()), \"g\");\r\n\t\tsvg = svg.replace(reg, \"url(#\");\r\n\r\n\t\t// Remove escaped quotes in url() parameters\r\n\t\tsvg = svg.replace(/url\\(&quot;([^)]*)&quot;\\)/gm, \"url($1)\");\r\n\r\n\t\t// Put foreignObjects back in\r\n\t\tif (fos.length) {\r\n\t\t\tfor (let i = 0; i < fos.length; i++) {\r\n\t\t\t\tsvg = svg.replace($strings.PLACEHOLDER, fos[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsvg = this.adapter.apply(\"normalizeSVG\", {\r\n\t\t\tdata: svg,\r\n\t\t\toptions: options\r\n\t\t}).data;\r\n\r\n\t\treturn svg;\r\n\t}\r\n\r\n\t/**\r\n\t * Serializes an element and returns its contents.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param element  An element to serialize\r\n\t * @return A serialized XML\r\n\t */\r\n\tpublic serializeElement(element: HTMLElement | SVGSVGElement | SVGDefsElement): string {\r\n\t\treturn new XMLSerializer().serializeToString(element);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a PDF containing chart image.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @param type     Type of the export\r\n\t * @param options  Options\r\n\t * @return Promise\r\n\t * @async\r\n\t * @todo Account for header when calculating vertical fit\r\n\t */\r\n\tpublic async getPDF(type: \"pdf\" | \"pdfdata\", options?: IExportPDFOptions): Promise<string> {\r\n\r\n\t\t// Get image\r\n\t\tlet image = await this.getImage(options.imageFormat || \"png\", options);\r\n\r\n\t\t// Load pdfmake\r\n\t\tlet pdfmake = await this.pdfmake;\r\n\r\n\t\t// Defaults\r\n\t\tlet defaultMargins = [30, 30, 30, 30];\r\n\r\n\t\t// Init content for PDF\r\n\t\tlet doc = {\r\n\t\t\tpageSize: options.pageSize || \"A4\",\r\n\t\t\tpageOrientation: options.pageOrientation || \"portrait\",\r\n\t\t\tpageMargins: options.pageMargins || defaultMargins,\r\n\t\t\tdefaultStyle: {\r\n\t\t\t\tfont: options.font ? options.font.name : undefined\r\n\t\t\t},\r\n\t\t\t//header: <any>[],\r\n\t\t\tcontent: <any>[]\r\n\t\t};\r\n\r\n\t\t// Should we add title?\r\n\t\tlet title = this.adapter.apply(\"title\", {\r\n\t\t\ttitle: this.title,\r\n\t\t\toptions: options\r\n\t\t}).title;\r\n\r\n\t\tlet extraMargin = 0;\r\n\r\n\t\tif (title) {\r\n\t\t\tdoc.content.push({\r\n\t\t\t\ttext: title,\r\n\t\t\t\tfontSize: options.fontSize || 14,\r\n\t\t\t\tbold: true,\r\n\t\t\t\tmargin: [0, 0, 0, 15]\r\n\t\t\t});\r\n\r\n\t\t\t// Add some leftover margin for title\r\n\t\t\textraMargin += 50;\r\n\t\t}\r\n\r\n\t\t// Add page URL?\r\n\t\tif (options.addURL) {\r\n\t\t\tdoc.content.push({\r\n\t\t\t\ttext: this.language.translate(\"Saved from\") + \": \" + document.location.href,\r\n\t\t\t\tfontSize: options.fontSize,\r\n\t\t\t\tmargin: [0, 0, 0, 15]\r\n\t\t\t});\r\n\r\n\t\t\t// Add some leftover margin for URL\r\n\t\t\textraMargin += 50;\r\n\t\t}\r\n\r\n\t\t// Add image\r\n\t\tif (type != \"pdfdata\") {\r\n\t\t\tdoc.content.push({\r\n\t\t\t\timage: image,\r\n\t\t\t\talignment: options.align || \"left\",\r\n\t\t\t\tfit: this.getPageSizeFit(doc.pageSize, doc.pageMargins, extraMargin)\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Add data\r\n\t\tif (type == \"pdfdata\" || options.addData) {\r\n\t\t\tdoc.content.push({\r\n\t\t\t\ttable: await this.getPDFData(\"pdf\", options),\r\n\t\t\t\tfontSize: options.fontSize || 14\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Apply adapters\r\n\t\tdoc = this.adapter.apply(\"pdfmakeDocument\", {\r\n\t\t\tdoc: doc,\r\n\t\t\toptions: options\r\n\t\t}).doc;\r\n\r\n\t\tlet fonts: { [name: string]: { [types: string]: string } } | null = null;\r\n\t\tlet vfs: { [path: string]: string } | null = null;\r\n\r\n\t\tfunction addFont(font: IFont) {\r\n\t\t\tconst paths: { [path: string]: string } = {};\r\n\r\n\t\t\tpaths.normal = font.normal.path;\r\n\t\t\tvfs[font.normal.path] = font.normal.bytes;\r\n\r\n\t\t\tif (font.bold) {\r\n\t\t\t\tpaths.bold = font.bold.path;\r\n\t\t\t\tvfs[font.bold.path] = font.bold.bytes;\r\n\r\n\t\t\t} else {\r\n\t\t\t\tpaths.bold = font.normal.path;\r\n\t\t\t}\r\n\r\n\t\t\tif (font.italics) {\r\n\t\t\t\tpaths.italics = font.italics.path;\r\n\t\t\t\tvfs[font.italics.path] = font.italics.bytes;\r\n\r\n\t\t\t} else {\r\n\t\t\t\tpaths.italics = font.normal.path;\r\n\t\t\t}\r\n\r\n\t\t\tif (font.bolditalics) {\r\n\t\t\t\tpaths.bolditalics = font.bolditalics.path;\r\n\t\t\t\tvfs[font.bolditalics.path] = font.bolditalics.bytes;\r\n\r\n\t\t\t} else {\r\n\t\t\t\tpaths.bolditalics = font.normal.path;\r\n\t\t\t}\r\n\r\n\t\t\tfonts[font.name] = paths;\r\n\t\t}\r\n\r\n\t\tif (options.font) {\r\n\t\t\tfonts = {};\r\n\t\t\tvfs = {};\r\n\t\t\taddFont(options.font);\r\n\r\n\t\t\tif (options.extraFonts) {\r\n\t\t\t\t$array.each(options.extraFonts, addFont);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Create PDF\r\n\t\treturn await new Promise<string>((success, error) => {\r\n\t\t\tpdfmake.createPdf(doc, null, fonts, vfs).getDataUrl((uri: string) => {\r\n\t\t\t\tsuccess(uri);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns chart's data formatted suitable for PDF export (pdfmake).\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @since 4.7.0\r\n\t * @param type     Type of the export\r\n\t * @param options  Options\r\n\t * @return Promise\r\n\t * @async\r\n\t */\r\n\tpublic async getPDFData(type: \"pdf\", options?: IExportPDFOptions): Promise<any> {\r\n\r\n\t\t// Init output\r\n\t\tlet content = <any>{\r\n\t\t\t\"body\": <any>[]\r\n\t\t};\r\n\r\n\t\t// Data fields\r\n\t\tconst dataFields = this.adapter.apply(\"formatDataFields\", {\r\n\t\t\tdataFields: this.dataFields,\r\n\t\t\tformat: \"pdf\"\r\n\t\t}).dataFields;\r\n\r\n\t\t// Add rows\r\n\t\tconst data = this.data;\r\n\r\n\t\t// Vertical or horizontal (default) layout\r\n\t\tif (options.pivot) {\r\n\r\n\t\t\t// Data fields order\r\n\t\t\tconst dataFieldsOrder = this.adapter.apply(\"dataFieldsOrder\", {\r\n\t\t\t\tdataFieldsOrder: this.dataFieldsOrder,\r\n\t\t\t\tformat: \"pdfdata\"\r\n\t\t\t}).dataFieldsOrder;\r\n\r\n\t\t\t$object.eachOrdered(dataFields, (key, val) => {\r\n\t\t\t\tlet dataRow = [];\r\n\t\t\t\tif (options.addColumnNames) {\r\n\t\t\t\t\tdataRow.push(val);\r\n\t\t\t\t}\r\n\t\t\t\tfor (let len = data.length, i = 0; i < len; i++) {\r\n\t\t\t\t\tlet dataValue = data[i][key];\r\n\t\t\t\t\tdataRow.push(this.convertToSpecialFormat<\"pdf\">(key, dataValue, options, true));\r\n\t\t\t\t}\r\n\t\t\t\tcontent.body.push(this.getPDFDataRow(dataRow, options, undefined, true));\r\n\t\t\t}, (a, b) => {\r\n\t\t\t\t//console.log(a, b)\r\n\t\t\t\tlet ai = dataFieldsOrder.indexOf(a);\r\n\t\t\t\tlet bi = dataFieldsOrder.indexOf(b);\r\n\t\t\t\tif (ai > bi) {\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t}\r\n\t\t\t\telse if (ai < bi) {\r\n\t\t\t\t\treturn -1\r\n\t\t\t\t}\r\n\t\t\t\treturn 0;\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\telse {\r\n\r\n\t\t\t// Add column names?\r\n\t\t\tif (options.addColumnNames) {\r\n\t\t\t\tcontent.body.push(this.getPDFDataRow(dataFields, options, undefined, true));\r\n\t\t\t\tcontent.headerRows = 1;\r\n\t\t\t}\r\n\r\n\t\t\tfor (let len = data.length, i = 0; i < len; i++) {\r\n\t\t\t\tcontent.body.push(this.getPDFDataRow(data[i], options, dataFields));\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this.adapter.apply(\"pdfmakeTable\", {\r\n\t\t\ttable: content,\r\n\t\t\toptions: options\r\n\t\t}).table;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Formats a row of data for use in PDF data table (pdfmake).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @since 4.7.0\r\n\t * @param  row         An object holding data for the row\r\n\t * @param  options     Options\r\n\t * @param  dataFields  Data fields\r\n\t * @param  asIs        Do not try to convert to dates\r\n\t * @return Formated Data line\r\n\t */\r\n\tpublic getPDFDataRow(row: any, options?: IExportPDFOptions, dataFields?: any, asIs: boolean = false): Array<string> {\r\n\r\n\t\t// Init\r\n\t\tlet items: any[] = [];\r\n\r\n\t\t// Data fields\r\n\t\tif (!dataFields) {\r\n\t\t\tdataFields = row;\r\n\t\t}\r\n\r\n\t\t// Data fields order\r\n\t\tconst dataFieldsOrder = this.adapter.apply(\"dataFieldsOrder\", {\r\n\t\t\tdataFieldsOrder: this.dataFieldsOrder,\r\n\t\t\tformat: \"pdfdata\"\r\n\t\t}).dataFieldsOrder;\r\n\r\n\t\t// Process each row item\r\n\t\t$object.eachOrdered(dataFields, (key, name) => {\r\n\r\n\t\t\t// Get value\r\n\t\t\tlet value = this.convertEmptyValue(key, row[key], options);\r\n\r\n\t\t\t// Convert dates\r\n\t\t\tlet item = asIs ? value : this.convertToSpecialFormat<\"csv\">(key, value, options);\r\n\t\t\titem = \"\" + item;\r\n\r\n\t\t\t// Add to item\r\n\t\t\titems.push(item);\r\n\t\t}, (a, b) => {\r\n\t\t\t//console.log(a, b)\r\n\t\t\tlet ai = dataFieldsOrder.indexOf(a);\r\n\t\t\tlet bi = dataFieldsOrder.indexOf(b);\r\n\t\t\tif (ai > bi) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t\telse if (ai < bi) {\r\n\t\t\t\treturn -1\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t});\r\n\r\n\t\treturn items;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns fit dimensions for available page sizes.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param pageSize Page size\r\n\t * @return `[width, height]` in pixels\r\n\t */\r\n\tpublic getPageSizeFit(pageSize: pageSizes, margins?: number | number[], extraMargin: number = 0): number[] {\r\n\r\n\t\t// Check margins\r\n\t\tlet newMargins = [0, 0, 0, 0];\r\n\t\tif (typeof margins == \"number\") {\r\n\t\t\tnewMargins = [margins, margins, margins, margins];\r\n\t\t}\r\n\t\telse if (margins.length == 2) {\r\n\t\t\tnewMargins = [margins[0], margins[1], margins[0], margins[1]];\r\n\t\t}\r\n\t\telse if (margins.length == 4) {\r\n\t\t\tnewMargins = margins;\r\n\t\t}\r\n\r\n\t\t// Define available page sizes\r\n\t\tlet sizes = {\r\n\t\t\t\"4A0\": [4767.87, 6740.79],\r\n\t\t\t\"2A0\": [3370.39, 4767.87],\r\n\t\t\tA0: [2383.94, 3370.39],\r\n\t\t\tA1: [1683.78, 2383.94],\r\n\t\t\tA2: [1190.55, 1683.78],\r\n\t\t\tA3: [841.89, 1190.55],\r\n\t\t\tA4: [595.28, 841.89],\r\n\t\t\tA5: [419.53, 595.28],\r\n\t\t\tA6: [297.64, 419.53],\r\n\t\t\tA7: [209.76, 297.64],\r\n\t\t\tA8: [147.40, 209.76],\r\n\t\t\tA9: [104.88, 147.40],\r\n\t\t\tA10: [73.70, 104.88],\r\n\t\t\tB0: [2834.65, 4008.19],\r\n\t\t\tB1: [2004.09, 2834.65],\r\n\t\t\tB2: [1417.32, 2004.09],\r\n\t\t\tB3: [1000.63, 1417.32],\r\n\t\t\tB4: [708.66, 1000.63],\r\n\t\t\tB5: [498.90, 708.66],\r\n\t\t\tB6: [354.33, 498.90],\r\n\t\t\tB7: [249.45, 354.33],\r\n\t\t\tB8: [175.75, 249.45],\r\n\t\t\tB9: [124.72, 175.75],\r\n\t\t\tB10: [87.87, 124.72],\r\n\t\t\tC0: [2599.37, 3676.54],\r\n\t\t\tC1: [1836.85, 2599.37],\r\n\t\t\tC2: [1298.27, 1836.85],\r\n\t\t\tC3: [918.43, 1298.27],\r\n\t\t\tC4: [649.13, 918.43],\r\n\t\t\tC5: [459.21, 649.13],\r\n\t\t\tC6: [323.15, 459.21],\r\n\t\t\tC7: [229.61, 323.15],\r\n\t\t\tC8: [161.57, 229.61],\r\n\t\t\tC9: [113.39, 161.57],\r\n\t\t\tC10: [79.37, 113.39],\r\n\t\t\tRA0: [2437.80, 3458.27],\r\n\t\t\tRA1: [1729.13, 2437.80],\r\n\t\t\tRA2: [1218.90, 1729.13],\r\n\t\t\tRA3: [864.57, 1218.90],\r\n\t\t\tRA4: [609.45, 864.57],\r\n\t\t\tSRA0: [2551.18, 3628.35],\r\n\t\t\tSRA1: [1814.17, 2551.18],\r\n\t\t\tSRA2: [1275.59, 1814.17],\r\n\t\t\tSRA3: [907.09, 1275.59],\r\n\t\t\tSRA4: [637.80, 907.09],\r\n\t\t\tEXECUTIVE: [521.86, 756.00],\r\n\t\t\tFOLIO: [612.00, 936.00],\r\n\t\t\tLEGAL: [612.00, 1008.00],\r\n\t\t\tLETTER: [612.00, 792.00],\r\n\t\t\tTABLOID: [792.00, 1224.00]\r\n\t\t};\r\n\r\n\t\t// Calculate size\r\n\t\tlet fitSize = sizes[pageSize]\r\n\t\tfitSize[0] -= newMargins[0] + newMargins[2];\r\n\t\tfitSize[1] -= newMargins[1] + newMargins[3] + extraMargin;\r\n\t\treturn fitSize;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an Excel file of chart's data.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @param type     Type of the export\r\n\t * @param options  Options\r\n\t * @return Promise\r\n\t * @async\r\n\t * @todo Handle dates\r\n\t * @todo Support for multi-sheet\r\n\t */\r\n\tpublic async getExcel(type: \"xlsx\", options?: IExportExcelOptions): Promise<string> {\r\n\r\n\t\tif (!$type.hasValue(options)) {\r\n\t\t\toptions = this.getFormatOptions(\"xlsx\");\r\n\t\t}\r\n\r\n\t\t// Load xlsx\r\n\t\tlet XLSX = await this.xlsx;\r\n\r\n\t\t// Create workbook options\r\n\t\tlet wbOptions = this.adapter.apply(\"xlsxWorkbookOptions\", {\r\n\t\t\txlsx: XLSX,\r\n\t\t\toptions: {\r\n\t\t\t\tbookType: \"xlsx\",\r\n\t\t\t\tbookSST: false,\r\n\t\t\t\ttype: \"base64\",\r\n\t\t\t\t//dateNF: 'yyyy-mm-dd'\r\n\t\t\t}\r\n\t\t}).options;\r\n\r\n\t\t// Get sheet name\r\n\t\tlet sheetName = this.normalizeExcelSheetName(this.adapter.apply(\"xlsxSheetName\", {\r\n\t\t\txlsx: XLSX,\r\n\t\t\tname: this.title || this.language.translate(\"Data\")\r\n\t\t}).name);\r\n\r\n\t\t// Create a workbook\r\n\t\tlet wb = {\r\n\t\t\tSheetNames: <any>[sheetName],\r\n\t\t\tSheets: <any>{}\r\n\t\t};\r\n\r\n\t\t// Init worksheet data\r\n\t\tlet data: Array<any> = [];\r\n\r\n\t\t// Data fields\r\n\t\tconst dataFields = this.adapter.apply(\"formatDataFields\", {\r\n\t\t\tdataFields: this.dataFields,\r\n\t\t\tformat: \"xslx\"\r\n\t\t}).dataFields;\r\n\r\n\t\t// Vertical or horizontal (default) layout\r\n\t\tif (options.pivot) {\r\n\r\n\t\t\t// Data fields order\r\n\t\t\tconst dataFieldsOrder = this.adapter.apply(\"dataFieldsOrder\", {\r\n\t\t\t\tdataFieldsOrder: this.dataFieldsOrder,\r\n\t\t\t\tformat: \"xlsx\"\r\n\t\t\t}).dataFieldsOrder;\r\n\r\n\t\t\t$object.eachOrdered(dataFields, (key, val) => {\r\n\t\t\t\tlet dataRow = [];\r\n\t\t\t\tif (options.addColumnNames) {\r\n\t\t\t\t\tdataRow.push(val);\r\n\t\t\t\t}\r\n\t\t\t\tfor (let len = this.data.length, i = 0; i < len; i++) {\r\n\t\t\t\t\tlet dataValue = this.data[i][key];\r\n\t\t\t\t\tdataRow.push(this.convertToSpecialFormat<\"xlsx\">(key, dataValue, options, true));\r\n\t\t\t\t}\r\n\t\t\t\tdata.push(this.getExcelRow(dataRow, options, undefined, true));\r\n\t\t\t}, (a, b) => {\r\n\t\t\t\t//console.log(a, b)\r\n\t\t\t\tlet ai = dataFieldsOrder.indexOf(a);\r\n\t\t\t\tlet bi = dataFieldsOrder.indexOf(b);\r\n\t\t\t\tif (ai > bi) {\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t}\r\n\t\t\t\telse if (ai < bi) {\r\n\t\t\t\t\treturn -1\r\n\t\t\t\t}\r\n\t\t\t\treturn 0;\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\telse {\r\n\t\t\t// Add column names?\r\n\t\t\tif (options.addColumnNames) {\r\n\t\t\t\tdata.push(this.getExcelRow(dataFields, options, undefined, true));\r\n\t\t\t}\r\n\r\n\t\t\t// Add lines\r\n\t\t\tfor (let len = this.data.length, i = 0; i < len; i++) {\r\n\t\t\t\tdata.push(this.getExcelRow(this.data[i], options, dataFields));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Create sheet and add data\r\n\t\twb.Sheets[sheetName] = XLSX.utils.aoa_to_sheet(data);\r\n\r\n\t\t// Apply adapters\r\n\t\twb = this.adapter.apply(\"xlsxWorkbook\", {\r\n\t\t\txlsx: XLSX,\r\n\t\t\tworkbook: wb,\r\n\t\t\toptions: options\r\n\t\t}).workbook;\r\n\r\n\t\t// Generate data uri\r\n\t\tlet uri = this.adapter.apply(\"getExcel\", {\r\n\t\t\tdata: \"data:\" + this.getContentType(type) + \";base64,\" + XLSX.write(wb, wbOptions),\r\n\t\t\toptions: options\r\n\t\t}).data;\r\n\r\n\t\treturn uri;\r\n\t}\r\n\r\n\t/**\r\n\t * This is needed to work around Excel limitations.\r\n\t *\r\n\t * @param name  Source name\r\n\t * @return Normalized name\r\n\t */\r\n\tprivate normalizeExcelSheetName(name: string): string {\r\n\t\tname = name.replace(/([:\\\\\\/?*\\[\\]]+)/g, \" \");\r\n\t\treturn $utils.truncateWithEllipsis(name, 31, \"...\", true);\r\n\t}\r\n\r\n\t/**\r\n\t * Rertuns an array of values to be used as Excel row.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param  row         Row data\r\n\t * @param  options     Options\r\n\t * @param  dataFields  Data fields\r\n\t * @param  asIs        Do not try to convert to dates\r\n\t * @return Array of values\r\n\t */\r\n\tpublic getExcelRow(row: any, options?: IExportExcelOptions, dataFields?: any, asIs: boolean = false): any[] {\r\n\r\n\t\t// Init\r\n\t\tlet items: any[] = [];\r\n\r\n\t\t// Data fields\r\n\t\tif (!dataFields) {\r\n\t\t\tdataFields = row;\r\n\t\t}\r\n\r\n\t\t// Data fields order\r\n\t\tconst dataFieldsOrder = this.adapter.apply(\"dataFieldsOrder\", {\r\n\t\t\tdataFieldsOrder: this.dataFieldsOrder,\r\n\t\t\tformat: \"xlsx\"\r\n\t\t}).dataFieldsOrder;\r\n\r\n\t\t// Process each row item\r\n\t\t$object.eachOrdered(dataFields, (key, name) => {\r\n\r\n\t\t\t// Get value\r\n\t\t\tlet value = this.convertEmptyValue(key, row[key], options);\r\n\r\n\t\t\t// Convert dates\r\n\t\t\tlet item = asIs ? value : this.convertToSpecialFormat<\"xlsx\">(key, value, options, true);\r\n\r\n\t\t\titems.push(item);\r\n\t\t}, (a, b) => {\r\n\t\t\t//console.log(a, b)\r\n\t\t\tlet ai = dataFieldsOrder.indexOf(a);\r\n\t\t\tlet bi = dataFieldsOrder.indexOf(b);\r\n\t\t\tif (ai > bi) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t\telse if (ai < bi) {\r\n\t\t\t\treturn -1\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t});\r\n\r\n\t\treturn items;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns chart's data formatted as CSV.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @param type       Type of the export\r\n\t * @param options    Options\r\n\t * @param encodeURI  If true, will return result will be data URI\r\n\t * @return Promise\r\n\t * @async\r\n\t */\r\n\tpublic async getCSV(type: \"csv\", options?: IExportCSVOptions, encodeURI: boolean = true): Promise<string> {\r\n\r\n\t\tif (!$type.hasValue(options)) {\r\n\t\t\toptions = this.getFormatOptions(\"csv\");\r\n\t\t}\r\n\r\n\t\t// Init output\r\n\t\tlet csv = \"\";\r\n\r\n\t\t// Data fields\r\n\t\tconst dataFields = this.adapter.apply(\"formatDataFields\", {\r\n\t\t\tdataFields: this.dataFields,\r\n\t\t\tformat: \"csv\"\r\n\t\t}).dataFields;\r\n\r\n\t\t// Add rows\r\n\t\tlet br = \"\";\r\n\t\tconst data = this.data;\r\n\r\n\t\t// Vertical or horizontal (default) layout\r\n\t\tif (options.pivot) {\r\n\r\n\t\t\t// Data fields order\r\n\t\t\tconst dataFieldsOrder = this.adapter.apply(\"dataFieldsOrder\", {\r\n\t\t\t\tdataFieldsOrder: this.dataFieldsOrder,\r\n\t\t\t\tformat: \"csv\"\r\n\t\t\t}).dataFieldsOrder;\r\n\r\n\t\t\t$object.eachOrdered(dataFields, (key, val) => {\r\n\t\t\t\tlet dataRow = [];\r\n\t\t\t\tif (options.addColumnNames) {\r\n\t\t\t\t\tdataRow.push(val);\r\n\t\t\t\t}\r\n\t\t\t\tfor (let len = data.length, i = 0; i < len; i++) {\r\n\t\t\t\t\tlet dataValue = data[i][key];\r\n\t\t\t\t\tdataRow.push(this.convertToSpecialFormat<\"csv\">(key, dataValue, options, true));\r\n\t\t\t\t}\r\n\t\t\t\tcsv += br + this.getCSVRow(dataRow, options, undefined, true);\r\n\t\t\t\tbr = \"\\n\";\r\n\t\t\t}, (a, b) => {\r\n\t\t\t\tlet ai = dataFieldsOrder.indexOf(a);\r\n\t\t\t\tlet bi = dataFieldsOrder.indexOf(b);\r\n\t\t\t\tif (ai > bi) {\r\n\t\t\t\t\treturn -1;\r\n\t\t\t\t}\r\n\t\t\t\telse if (ai < bi) {\r\n\t\t\t\t\treturn 1\r\n\t\t\t\t}\r\n\t\t\t\treturn 0;\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\telse {\r\n\t\t\tfor (let len = data.length, i = 0; i < len; i++) {\r\n\t\t\t\tlet row = this.getCSVRow(data[i], options, dataFields);\r\n\t\t\t\tif (options.reverse) {\r\n\t\t\t\t\tcsv = row + br + csv;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tcsv += br + row;\r\n\t\t\t\t}\r\n\t\t\t\tbr = \"\\n\";\r\n\t\t\t}\r\n\r\n\t\t\t// Add column names?\r\n\t\t\tif (options.addColumnNames) {\r\n\t\t\t\tcsv = this.getCSVRow(dataFields, options, undefined, true) + br + csv;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Add content type\r\n\t\tlet charset = this.adapter.apply(\"charset\", {\r\n\t\t\tcharset: \"charset=utf-8\",\r\n\t\t\ttype: type,\r\n\t\t\toptions: options\r\n\t\t}).charset;\r\n\r\n\t\tlet uri = this.adapter.apply(\"getCSV\", {\r\n\t\t\tdata: encodeURI ? \"data:\" + this.getContentType(type) + \";\" + charset + \",\" + encodeURIComponent(csv) : csv,\r\n\t\t\toptions: options\r\n\t\t}).data;\r\n\r\n\t\treturn uri;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Formats a row of CSV data.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param  row         An object holding data for the row\r\n\t * @param  options     Options\r\n\t * @param  dataFields  Data fields\r\n\t * @param  asIs        Do not try to convert to dates\r\n\t * @return Formated CSV line\r\n\t */\r\n\tpublic getCSVRow(row: any, options?: IExportCSVOptions, dataFields?: any, asIs: boolean = false): string {\r\n\r\n\t\t// Init\r\n\t\tlet separator = options.separator || \",\";\r\n\t\tlet items: any[] = [];\r\n\r\n\t\t// Data fields\r\n\t\tif (!dataFields) {\r\n\t\t\tdataFields = row;\r\n\t\t}\r\n\r\n\t\t// Data fields order\r\n\t\tconst dataFieldsOrder = this.adapter.apply(\"dataFieldsOrder\", {\r\n\t\t\tdataFieldsOrder: this.dataFieldsOrder,\r\n\t\t\tformat: \"csv\"\r\n\t\t}).dataFieldsOrder;\r\n\r\n\t\t// Process each row item\r\n\t\t$object.eachOrdered(dataFields, (key, name) => {\r\n\r\n\t\t\t// Get value\r\n\t\t\tlet value = this.convertEmptyValue(key, row[key], options);\r\n\r\n\t\t\t// Check if we need to skip\r\n\t\t\t// This is no longer required because we are iterating via dataFields anyway\r\n\t\t\t/*if ($type.hasValue(this.dataFields) && !$type.hasValue(this.dataFields[key])) {\r\n\t\t\t\treturn;\r\n\t\t\t}*/\r\n\r\n\t\t\t// Convert dates\r\n\t\t\tlet item = asIs ? value : this.convertToSpecialFormat<\"csv\">(key, value, options);\r\n\r\n\t\t\t// Cast and escape doublequotes\r\n\t\t\titem = \"\" + item;\r\n\t\t\titem = item.replace(/\"/g, '\"\"');\r\n\r\n\t\t\t// Enclose into double quotes\r\n\t\t\tif (options.forceQuotes || (item.search(new RegExp(\"\\\"|\\n|\" + separator, \"g\")) >= 0)) {\r\n\t\t\t\titem = \"\\\"\" + item + \"\\\"\";\r\n\t\t\t}\r\n\r\n\t\t\t// Add to item\r\n\t\t\titems.push(item);\r\n\t\t}, (a, b) => {\r\n\t\t\t//console.log(a, b)\r\n\t\t\tlet ai = dataFieldsOrder.indexOf(a);\r\n\t\t\tlet bi = dataFieldsOrder.indexOf(b);\r\n\t\t\tif (ai > bi) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t\telse if (ai < bi) {\r\n\t\t\t\treturn -1\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t});\r\n\r\n\t\treturn items.join(separator);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns chart's data formatted as HTML table.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @since 4.7.0\r\n\t * @param type       Type of the export\r\n\t * @param options    Options\r\n\t * @param encodeURI  If true, will return result will be data URI\r\n\t * @return Promise\r\n\t * @async\r\n\t */\r\n\tpublic async getHTML(type: \"html\", options?: IExportHTMLOptions, encodeURI: boolean = true): Promise<string> {\r\n\r\n\t\tif (!$type.hasValue(options)) {\r\n\t\t\toptions = this.getFormatOptions(\"html\");\r\n\t\t}\r\n\r\n\t\t// Init output\r\n\t\tlet html = \"<table>\";\r\n\t\tif (options.tableClass) {\r\n\t\t\thtml = \"<table class=\\\"\" + options.tableClass + \"\\\">\";\r\n\t\t}\r\n\r\n\t\t// Data fields\r\n\t\tconst dataFields = this.adapter.apply(\"formatDataFields\", {\r\n\t\t\tdataFields: this.dataFields,\r\n\t\t\tformat: \"html\"\r\n\t\t}).dataFields;\r\n\r\n\t\t// Add rows\r\n\t\tconst data = this.data;\r\n\r\n\t\t// Vertical or horizontal (default) layout\r\n\t\tif (options.pivot) {\r\n\r\n\t\t\t// Data fields order\r\n\t\t\tconst dataFieldsOrder = this.adapter.apply(\"dataFieldsOrder\", {\r\n\t\t\t\tdataFieldsOrder: this.dataFieldsOrder,\r\n\t\t\t\tformat: \"html\"\r\n\t\t\t}).dataFieldsOrder;\r\n\r\n\t\t\thtml += \"\\n<tbody>\";\r\n\r\n\t\t\t$object.eachOrdered(dataFields, (key, val) => {\r\n\t\t\t\tlet dataRow = [];\r\n\t\t\t\tif (options.addColumnNames) {\r\n\t\t\t\t\tdataRow.push(val);\r\n\t\t\t\t}\r\n\t\t\t\tfor (let len = data.length, i = 0; i < len; i++) {\r\n\t\t\t\t\tlet dataValue = data[i][key];\r\n\t\t\t\t\tdataRow.push(this.convertToSpecialFormat<\"html\">(key, dataValue, options, true));\r\n\t\t\t\t}\r\n\t\t\t\thtml += \"\\n\" + this.getHTMLRow(dataRow, options, undefined, true);\r\n\t\t\t}, (a, b) => {\r\n\t\t\t\tlet ai = dataFieldsOrder.indexOf(a);\r\n\t\t\t\tlet bi = dataFieldsOrder.indexOf(b);\r\n\t\t\t\tif (ai > bi) {\r\n\t\t\t\t\treturn -1;\r\n\t\t\t\t}\r\n\t\t\t\telse if (ai < bi) {\r\n\t\t\t\t\treturn 1\r\n\t\t\t\t}\r\n\t\t\t\treturn 0;\r\n\t\t\t});\r\n\r\n\t\t\thtml += \"\\n</tbody>\";\r\n\r\n\t\t}\r\n\r\n\t\telse {\r\n\t\t\t// Add column names?\r\n\t\t\tif (options.addColumnNames) {\r\n\t\t\t\thtml += \"\\n<thead>\\n\" + this.getHTMLRow(dataFields, options, undefined, true, true) + \"\\n</thead>\";\r\n\t\t\t}\r\n\r\n\t\t\thtml += \"\\n<tbody>\";\r\n\r\n\t\t\tfor (let len = data.length, i = 0; i < len; i++) {\r\n\t\t\t\thtml += \"\\n\" + this.getHTMLRow(data[i], options, dataFields);\r\n\t\t\t}\r\n\r\n\t\t\thtml += \"\\n</tbody>\";\r\n\t\t}\r\n\r\n\t\thtml += \"\\n</table>\";\r\n\r\n\t\t// Add content type\r\n\t\tlet charset = this.adapter.apply(\"charset\", {\r\n\t\t\tcharset: \"charset=utf-8\",\r\n\t\t\ttype: type,\r\n\t\t\toptions: options\r\n\t\t}).charset;\r\n\r\n\t\tlet uri = this.adapter.apply(\"getHTML\", {\r\n\t\t\tdata: encodeURI ? \"data:\" + this.getContentType(type) + \";\" + charset + \",\" + encodeURIComponent(html) : html,\r\n\t\t\toptions: options\r\n\t\t}).data;\r\n\r\n\t\treturn uri;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Formats a row of HTML data.\r\n\t *\r\n\t * @since 4.7.0\r\n\t * @ignore Exclude from docs\r\n\t * @param  row         An object holding data for the row\r\n\t * @param  options     Options\r\n\t * @param  dataFields  Data fields\r\n\t * @param  asIs        Do not try to convert to dates\r\n\t * @return Formated HTML row\r\n\t */\r\n\tpublic getHTMLRow(row: any, options?: IExportHTMLOptions, dataFields?: any, asIs: boolean = false, headerRow: boolean = false): string {\r\n\r\n\t\t// Init output\r\n\t\tlet html = \"\\t<tr>\";\r\n\t\tif (options.rowClass) {\r\n\t\t\thtml = \"\\t<tr class=\\\"\" + options.rowClass + \"\\\">\";\r\n\t\t}\r\n\r\n\t\t// Data fields\r\n\t\tif (!dataFields) {\r\n\t\t\tdataFields = row;\r\n\t\t}\r\n\r\n\t\t// Data fields order\r\n\t\tconst dataFieldsOrder = this.adapter.apply(\"dataFieldsOrder\", {\r\n\t\t\tdataFieldsOrder: this.dataFieldsOrder,\r\n\t\t\tformat: \"html\"\r\n\t\t}).dataFieldsOrder;\r\n\r\n\t\t// th or dh?\r\n\t\tconst tag = headerRow ? \"th\" : \"td\";\r\n\r\n\t\t// Process each row item\r\n\t\tlet first = true;\r\n\t\t$object.eachOrdered(dataFields, (key, name) => {\r\n\r\n\t\t\t// Get value\r\n\t\t\tlet value = this.convertEmptyValue(key, row[key], options);\r\n\r\n\t\t\t// Convert dates\r\n\t\t\tlet item = asIs ? value : this.convertToSpecialFormat<\"html\">(key, value, options);\r\n\r\n\t\t\t// Escape HTML entities\r\n\t\t\titem = \"\" + item;\r\n\t\t\titem = item.replace(/[\\u00A0-\\u9999<>\\&]/gim, function(i: string) {\r\n\t\t\t\treturn \"&#\" + i.charCodeAt(0) + \";\";\r\n\t\t\t});\r\n\r\n\t\t\t// Which tag to use\r\n\t\t\tlet useTag = tag;\r\n\t\t\tif (options.pivot && first) {\r\n\t\t\t\tuseTag = \"th\";\r\n\t\t\t}\r\n\r\n\t\t\t// Add cell\r\n\t\t\tif (options.cellClass) {\r\n\t\t\t\thtml += \"\\n\\t\\t<\" + useTag + \" class=\\\"\" + options.cellClass + \"\\\">\" + item + \"</\" + useTag + \">\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\thtml += \"\\n\\t\\t<\" + useTag + \">\" + item + \"</\" + useTag + \">\";\r\n\t\t\t}\r\n\r\n\t\t\tfirst = false;\r\n\t\t}, (a, b) => {\r\n\t\t\tlet ai = dataFieldsOrder.indexOf(a);\r\n\t\t\tlet bi = dataFieldsOrder.indexOf(b);\r\n\t\t\tif (ai > bi) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t\telse if (ai < bi) {\r\n\t\t\t\treturn -1\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t});\r\n\r\n\t\thtml += \"\\n\\t</tr>\";\r\n\r\n\t\treturn html;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns chart's data in JSON format.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @param type       Type of the export\r\n\t * @param options    Options\r\n\t * @param encodeURI  If true, will return result will be data URI\r\n\t * @return Promise\r\n\t * @async\r\n\t */\r\n\tpublic async getJSON(type: \"json\", options?: IExportJSONOptions, encodeURI: boolean = true): Promise<string> {\r\n\r\n\t\tif (!$type.hasValue(options)) {\r\n\t\t\toptions = this.getFormatOptions(\"json\");\r\n\t\t}\r\n\r\n\t\t// Check if we need to regenerate data based on `dataFields`\r\n\t\tlet data: any[];\r\n\t\tconst dataFields = this.adapter.apply(\"formatDataFields\", {\r\n\t\t\tdataFields: this.dataFields,\r\n\t\t\tformat: \"json\"\r\n\t\t}).dataFields;\r\n\t\tif (!this._dynamicDataFields) {\r\n\t\t\tdata = [];\r\n\t\t\tconst sourceData = this.data;\r\n\t\t\tfor (let len = sourceData.length, i = 0; i < len; i++) {\r\n\t\t\t\tlet value = sourceData[i];\r\n\t\t\t\tif (typeof value == \"object\") {\r\n\t\t\t\t\tlet newValue: any = {};\r\n\t\t\t\t\t$object.each(value, (field, item) => {\r\n\t\t\t\t\t\tif ($type.hasValue(dataFields[field])) {\r\n\t\t\t\t\t\t\tnewValue[dataFields[field]] = this.convertToSpecialFormat<\"json\">(field, item, options);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tdata.push(newValue);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdata = this.data;\r\n\t\t}\r\n\r\n\t\t// Stringify JSON\r\n\t\tlet json = JSON.stringify(data, (key, value) => {\r\n\t\t\tif (typeof value == \"object\") {\r\n\t\t\t\t$object.each(value, (field, item) => {\r\n\t\t\t\t\tvalue[field] = this.convertToSpecialFormat<\"json\">(field, item, options);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t}, options.indent);\r\n\r\n\t\t// Add content type\r\n\t\tlet charset = this.adapter.apply(\"charset\", {\r\n\t\t\tcharset: \"charset=utf-8\",\r\n\t\t\ttype: type,\r\n\t\t\toptions: options\r\n\t\t}).charset;\r\n\r\n\t\tlet uri = this.adapter.apply(\"getJSON\", {\r\n\t\t\tdata: encodeURI ? \"data:\" + this.getContentType(type) + \";\" + charset + \",\" + encodeURIComponent(json) : json,\r\n\t\t\toptions: options\r\n\t\t}).data;\r\n\r\n\t\treturn uri;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the value to proper date format.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param  field         Field name\r\n\t * @param  value         Value\r\n\t * @param  options       Options\r\n\t * @param  keepOriginal  Will ignore formatting and will keep value as it is in data\r\n\t * @return Formatted date value or unmodified value\r\n\t */\r\n\tpublic convertToSpecialFormat<Key extends \"json\" | \"csv\" | \"xlsx\" | \"html\" | \"pdf\">(field: string, value: any, options?: IExportOptions[Key], keepOriginal?: boolean): any {\r\n\r\n\t\t// Is this a timestamp or duration?\r\n\t\tif (typeof value == \"number\") {\r\n\t\t\tif (this.isDateField(field)) {\r\n\t\t\t\tvalue = new Date(value);\r\n\t\t\t}\r\n\t\t\telse if (this.isDurationField(field)) {\r\n\t\t\t\treturn this.durationFormatter.format(value, this.durationFormat);\r\n\t\t\t}\r\n\t\t\telse if (this.isNumberField(field) && this.numberFormat) {\r\n\t\t\t\treturn this.numberFormatter.format(value, this.numberFormat);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (value instanceof Date) {\r\n\t\t\tif (options.useTimestamps) {\r\n\t\t\t\tvalue = value.getTime();\r\n\t\t\t}\r\n\t\t\telse if (options.useLocale) {\r\n\t\t\t\tif (!keepOriginal) {\r\n\t\t\t\t\tvalue = value.toLocaleString();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvalue = this.dateFormatter.format(value, this.dateFormat);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ($type.isString(value) && this.isDateField(field) && this.dateFormat) {\r\n\t\t\tvalue = this.dateFormatter.format(this.dateFormatter.parse(value), this.dateFormat);\r\n\t\t}\r\n\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts empty value based on `emptyAs` option.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic convertEmptyValue<Key extends \"csv\" | \"xlsx\">(field: string, value: any, options?: IExportOptions[Key]): any {\r\n\t\treturn $type.hasValue(value) ? value : options.emptyAs;\r\n\t}\r\n\r\n\t/**\r\n\t * Triggers download of the file.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @param uri       Data URI with file content\r\n\t * @param fileName  File name\r\n\t * @return Promise\r\n\t * @async\r\n\t */\r\n\tpublic async download(uri: string, fileName: string, addBOM: boolean = false): Promise<boolean> {\r\n\r\n\t\tif (this.msBlobDownloadSupport()) {\r\n\r\n\t\t\t/**\r\n\t\t\t * For all IEs 10 and up we use native method `msSaveBlob`\r\n\t\t\t */\r\n\r\n\t\t\t// Extract content type and get pure data without headers\r\n\t\t\tlet parts = uri.split(\";\");\r\n\t\t\tlet contentType = parts.shift().replace(/data:/, \"\");\r\n\t\t\turi = decodeURIComponent(parts.join(\";\").replace(/^[^,]*,/, \"\"));\r\n\r\n\r\n\t\t\t// Check if we need to Base64-decode\r\n\t\t\tif ([\"image/svg+xml\", \"application/json\", \"text/csv\"].indexOf(contentType) == -1) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet decoded = atob(uri);\r\n\t\t\t\t\turi = decoded;\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t// Error occurred, meaning string was not Base64-encoded. Do nothing.\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet blob = new Blob([uri], { type: contentType });\r\n\t\t\t\twindow.navigator.msSaveBlob(blob, fileName);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Dissect uri into array\r\n\t\t\tlet chars = new Array(uri.length);\r\n\t\t\tfor (let i = 0; i < uri.length; ++i) {\r\n\t\t\t\tlet charCode = uri.charCodeAt(i);\r\n\t\t\t\tchars[i] = charCode;\r\n\t\t\t}\r\n\r\n\t\t\t// Prep Blob and force the download\r\n\t\t\tlet blob = new Blob([new Uint8Array(chars)], { type: contentType });\r\n\t\t\twindow.navigator.msSaveBlob(blob, fileName);\r\n\r\n\t\t}\r\n\r\n\t\telse if (this.blobDownloadSupport()) {\r\n\r\n\t\t\t/**\r\n\t\t\t * Supports Blob object.\r\n\t\t\t * Use it.\r\n\t\t\t */\r\n\t\t\tlet link = document.createElement(\"a\");\r\n\t\t\tlink.download = fileName;\r\n\t\t\tdocument.body.appendChild(link);\r\n\r\n\t\t\t// Extract content type and get pure data without headers\r\n\t\t\tlet parts = uri.split(\";\");\r\n\t\t\tlet contentType = parts.shift().replace(/data:/, \"\");\r\n\r\n\t\t\turi = decodeURIComponent(parts.join(\";\").replace(/^[^,]*,/, \"\"));\r\n\r\n\t\t\tif ([\"image/svg+xml\", \"application/json\", \"text/csv\", \"text/html\"].indexOf(contentType) == -1) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet decoded = atob(uri);\r\n\t\t\t\t\turi = decoded;\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t// Error occurred, meaning string was not Base64-encoded. Do nothing.\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (addBOM) {\r\n\t\t\t\t\turi = \"\\ufeff\" + uri;\r\n\t\t\t\t}\r\n\t\t\t\tlet blob = new Blob([uri], { type: contentType });\r\n\t\t\t\tlet url = window.URL.createObjectURL(blob);\r\n\t\t\t\tlink.href = url;\r\n\t\t\t\tlink.download = fileName;\r\n\t\t\t\tlink.click();\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tdocument.body.removeChild(link);\r\n\t\t\t\t\twindow.URL.revokeObjectURL(url);\r\n\t\t\t\t}, 100);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\t// Dissect uri into array\r\n\t\t\tlet chars = new Array(uri.length);\r\n\t\t\tfor (let i = 0; i < uri.length; ++i) {\r\n\t\t\t\tlet charCode = uri.charCodeAt(i);\r\n\t\t\t\tchars[i] = charCode;\r\n\t\t\t}\r\n\r\n\t\t\tif (addBOM) {\r\n\t\t\t\tchars = [0xEF, 0xBB, 0xBF].concat(chars);\r\n\t\t\t}\r\n\t\t\tlet blob = new Blob([new Uint8Array(chars)], { type: contentType });\r\n\t\t\tlet url = window.URL.createObjectURL(blob);\r\n\t\t\tlink.href = url;\r\n\t\t\tlink.download = fileName;\r\n\t\t\tdocument.body.appendChild(link);\r\n\t\t\tlink.click();\r\n\t\t\tdocument.body.removeChild(link);\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\twindow.URL.revokeObjectURL(url);\r\n\t\t\t}, 100);\r\n\r\n\t\t}\r\n\r\n\t\telse if (this.linkDownloadSupport()) {\r\n\r\n\t\t\t/**\r\n\t\t\t * For regular browsers, we create a link then simulate a click on it\r\n\t\t\t */\r\n\r\n\t\t\tlet link = document.createElement(\"a\");\r\n\t\t\tlink.download = fileName;\r\n\t\t\tlink.href = uri;\r\n\t\t\tdocument.body.appendChild(link);\r\n\t\t\tlink.click();\r\n\t\t\tdocument.body.removeChild(link);\r\n\r\n\t\t}\r\n\t\telse if (this.legacyIE()) {\r\n\r\n\t\t\t/**\r\n\t\t\t * Old IEs (9 and down) we will use an <iframe> trick\r\n\t\t\t */\r\n\r\n\t\t\tlet parts = uri.match(/^data:(.*);[ ]*([^,]*),(.*)$/);\r\n\r\n\t\t\tif (parts.length === 4) {\r\n\t\t\t\t// Base64-encoded or text-based stuff?\r\n\t\t\t\tif (parts[2] == \"base64\") {\r\n\r\n\t\t\t\t\t// Base64-encoded - probably an image\r\n\t\t\t\t\tif (parts[1].match(/^image\\//)) {\r\n\r\n\t\t\t\t\t\t// Yep, an image. Let's create a temporary image placeholder,\r\n\t\t\t\t\t\t// so that user can use do Save As.\r\n\t\t\t\t\t\tthis.showModal(\r\n\t\t\t\t\t\t\t\"<img src=\\\"\" + uri + \"\\\" style=\\\"float: left; max-width: 50%; max-height: 80%; margin: 0 1em 0.5em 0; border: 1px solid #eee;\\\" />\" +\r\n\t\t\t\t\t\t\t\"<p>\" + this.language.translate(\r\n\t\t\t\t\t\t\t\t\"To save the image, right-click thumbnail on the left and choose \\\"Save picture as...\\\"\"\r\n\t\t\t\t\t\t\t) +\r\n\t\t\t\t\t\t\t\"</p>\" +\r\n\t\t\t\t\t\t\t\"<p style=\\\"text-align: center;\\\"><small>\" + this.language.translate(\r\n\t\t\t\t\t\t\t\t\"(Press ESC to close this message)\"\r\n\t\t\t\t\t\t\t) + \"</small></p>\",\r\n\t\t\t\t\t\t\tthis.language.translate(\"Image Export Complete\")\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\r\n\t\t\t\t\t// Text-based\r\n\r\n\t\t\t\t\t// IE9 is trippy about saving files with filenames of the extensions it\r\n\t\t\t\t\t// does not know. Let's use .txt extension for all text-based export\r\n\t\t\t\t\t// formats, except SVG.\r\n\t\t\t\t\tlet contentType;\r\n\t\t\t\t\tif (fileName.match(/\\.svg$/)) {\r\n\t\t\t\t\t\tcontentType = \"image/svg+xml\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tcontentType = \"text/plain\";\r\n\t\t\t\t\t\tfileName += \".txt\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Create temporary iframe\r\n\t\t\t\t\tlet iframe = document.createElement(\"iframe\");\r\n\t\t\t\t\tiframe.width = \"1px\";\r\n\t\t\t\t\tiframe.height = \"1px\"\r\n\t\t\t\t\tiframe.style.display = \"none\";\r\n\t\t\t\t\tdocument.body.appendChild(iframe);\r\n\r\n\t\t\t\t\t// Add our stuff to the document of the iframe and trigger save as\r\n\t\t\t\t\tlet idoc = iframe.contentDocument;\r\n\t\t\t\t\tidoc.open(contentType, \"replace\");\r\n\t\t\t\t\t// TODO test this with various encodings (e.g. UTF)\r\n\t\t\t\t\t//idoc.charset = parts[2].replace(/charset=/, \"\");\r\n\t\t\t\t\tidoc.write(decodeURIComponent(parts[3]));\r\n\t\t\t\t\tidoc.close();\r\n\t\t\t\t\tidoc.execCommand(\"SaveAs\", true, fileName);\r\n\r\n\t\t\t\t\t// Destroy the iframe\r\n\t\t\t\t\tdocument.body.removeChild(iframe);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\t/**\r\n\t\t\t * Something else - perhaps a mobile.\r\n\t\t\t * Let's just display it in the same page.\r\n\t\t\t * (hey we don't like it either)\r\n\t\t\t */\r\n\t\t\twindow.location.href = uri;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns `true` if browser has any supported methods to trigger download\r\n\t * of a binary file.\r\n\t *\r\n\t * @return Supports downloads?\r\n\t */\r\n\tpublic downloadSupport(): boolean {\r\n\t\t//return !this.legacyIE();\r\n\t\treturn this.linkDownloadSupport() || this.msBlobDownloadSupport();\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the browser supports \"download\" attribute on links.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Browser supports triggering downloads?\r\n\t */\r\n\tpublic linkDownloadSupport(): boolean {\r\n\t\t// Do we have this cached?\r\n\t\tlet cache = registry.getCache(\"linkDownloadSupport\");\r\n\t\tif (cache === false || cache === true) {\r\n\t\t\treturn cache;\r\n\t\t}\r\n\t\tlet a = document.createElement(\"a\");\r\n\t\tlet res = typeof a.download !== \"undefined\";\r\n\t\tregistry.setCache(\"linkDownloadSupport\", res);\r\n\t\treturn res;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the browser supports download via `msBlob`.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Browser supports triggering downloads?\r\n\t */\r\n\tpublic blobDownloadSupport(): boolean {\r\n\t\treturn $type.hasValue(window.Blob);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the browser supports download via `msBlob`.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Browser supports triggering downloads?\r\n\t */\r\n\tpublic msBlobDownloadSupport(): boolean {\r\n\t\treturn $type.hasValue(window.navigator.msSaveOrOpenBlob);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if this is a legacy version of IE.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return IE9 or less?\r\n\t */\r\n\tpublic legacyIE(): boolean {\r\n\t\t// Create a temporary <div> with conditional tags in it an an <i> tag.\r\n\t\t// Count <i>s. If there are some, we have IE9 or late on our hands.\r\n\t\tlet div = document.createElement(\"div\");\r\n\t\tdiv.innerHTML = \"<!--[if lt IE 10]><i></i><![endif]-->\";\r\n\t\treturn div.getElementsByTagName(\"i\").length == 1;\r\n\t}\r\n\r\n\t/**\r\n\t * Initiates print of the chart.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @param data     Data URI for the image\r\n\t * @param options  Options\r\n\t * @param title    Optional title to use (uses window's title by default)\r\n\t * @return Promise\r\n\t * @async\r\n\t */\r\n\tpublic async print(data: string, options?: IExportPrintOptions, title?: string): Promise<boolean> {\r\n\r\n\t\tif (options.printMethod == \"css\") {\r\n\t\t\treturn this.printViaCSS(data, options, title);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this.printViaIframe(data, options, title);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprotected async printViaCSS(data: string, options?: IExportPrintOptions, title?: string): Promise<boolean> {\r\n\t\t// Save current scroll position\r\n\t\tlet scroll = document.documentElement.scrollTop || document.body.scrollTop;\r\n\r\n\t\t// Hide all current nodes of the document and save their current states\r\n\t\t// of `display` style\r\n\t\t/*let states: Array<string> = [];\r\n\t\tlet items = document.body.childNodes;\r\n\t\tfor (let len = items.length, i = 0; i < len; i++) {\r\n\t\t\tlet item = <HTMLElement>items[i];\r\n\t\t\tif ($dom.isElement(item)) {\r\n\t\t\t\tstates[i] = item.style.display;\r\n\t\t\t\titem.style.display = \"none\";\r\n\t\t\t}\r\n\t\t}*/\r\n\r\n\t\t// Hide all document nodes by applyin custom CSS\r\n\t\tlet rule = new StyleRule($dom.getShadowRoot(this.container), \"body > *\", {\r\n\t\t\t\"display\": \"none\",\r\n\t\t\t\"position\": \"fixed\",\r\n\t\t\t\"visibility\": \"hidden\",\r\n\t\t\t\"opacity\": \"0\",\r\n\t\t\t\"clipPath\": \"polygon(0px 0px,0px 0px,0px 0px,0px 0px);\"\r\n\t\t});\r\n\r\n\t\t// Replace title?\r\n\t\tlet originalTitle: string;\r\n\t\tif (title && document && document.title) {\r\n\t\t\toriginalTitle = document.title;\r\n\t\t\tdocument.title = title;\r\n\t\t}\r\n\r\n\t\t// Create and add exported image\r\n\t\tlet img = new Image();\r\n\t\timg.src = data;\r\n\t\timg.style.maxWidth = \"100%\";\r\n\t\timg.style.display = \"block\";\r\n\t\timg.style.position = \"relative\";\r\n\t\timg.style.visibility = \"visible\";\r\n\t\timg.style.opacity = \"1\";\r\n\t\timg.style.clipPath = \"none\";\r\n\t\tdocument.body.appendChild(img);\r\n\r\n\t\t// Print\r\n\t\tthis.setTimeout(() => {\r\n\t\t\t(<any>window).print();\r\n\t\t}, 50);\r\n\r\n\t\t// Delay needs to be at least a second for iOS devices\r\n\t\tlet isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !(<any>window).MSStream;\r\n\t\tif (isIOS && (options.delay < 1000)) {\r\n\t\t\toptions.delay = 1000;\r\n\t\t}\r\n\t\telse if (options.delay < 100) {\r\n\t\t\toptions.delay = 100;\r\n\t\t}\r\n\r\n\t\t// Delay function that resets back the document the way ot was before\r\n\t\tthis.setTimeout(() => {\r\n\r\n\t\t\t// Remove image\r\n\t\t\tdocument.body.removeChild(img);\r\n\r\n\t\t\t// Reset back all elements\r\n\t\t\t/*for (let len = items.length, i = 0; i < len; i++) {\r\n\t\t\t\tlet item = <HTMLElement>items[i];\r\n\t\t\t\tif ($dom.isElement(item)) {\r\n\t\t\t\t\titem.style.display = states[i];\r\n\t\t\t\t}\r\n\t\t\t}*/\r\n\t\t\trule.dispose();\r\n\r\n\t\t\t// Restore title\r\n\t\t\tif (originalTitle) {\r\n\t\t\t\tdocument.title = document.title;\r\n\t\t\t}\r\n\r\n\t\t\t// Scroll back the document the way it was before\r\n\t\t\tdocument.documentElement.scrollTop = document.body.scrollTop = scroll;\r\n\r\n\t\t}, options.delay || 500);\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprotected async printViaIframe(data: string, options?: IExportPrintOptions, title?: string): Promise<boolean> {\r\n\r\n\t\t// Create an iframe\r\n\t\tlet iframe = document.createElement(\"iframe\");\r\n\t\tiframe.style.visibility = \"hidden\";\r\n\t\tdocument.body.appendChild(iframe);\r\n\r\n\t\t// This is needed for FireFox\r\n\t\tiframe.contentWindow.document.open();\r\n\t\tiframe.contentWindow.document.close();\r\n\r\n\t\t// Create and add exported image\r\n\t\tlet img = new Image();\r\n\t\timg.src = data;\r\n\t\timg.style.maxWidth = \"100%\";\r\n\t\timg.style.height = \"auto\";\r\n\t\tif (title) {\r\n\t\t\tiframe.contentWindow.document.title = title;\r\n\t\t}\r\n\t\tiframe.contentWindow.document.body.appendChild(img);\r\n\r\n\t\t(<any>iframe).load = function() {\r\n\t\t\tiframe.contentWindow.document.body.appendChild(img);\r\n\t\t};\r\n\r\n\t\t// Print\r\n\t\tthis.setTimeout(() => {\r\n\t\t\ttry {\r\n\t\t\t\tif (!(<any>iframe).contentWindow.document.execCommand(\"print\", false, null)) {\r\n\t\t\t\t\t(<any>iframe).contentWindow.print();\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\t(<any>iframe).contentWindow.print();\r\n\t\t\t}\r\n\t\t}, options.delay || 50);\r\n\r\n\t\t// Delay needs to be at least a second for iOS devices\r\n\t\tlet isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !(<any>window).MSStream;\r\n\t\tif (isIOS && (options.delay < 1000)) {\r\n\t\t\toptions.delay = 1000;\r\n\t\t}\r\n\t\telse if (options.delay < 100) {\r\n\t\t\toptions.delay = 100;\r\n\t\t}\r\n\r\n\t\t// Delay function that resets back the document the way ot was before\r\n\t\tthis.setTimeout(() => {\r\n\r\n\t\t\t// Remove image\r\n\t\t\tdocument.body.removeChild(iframe);\r\n\r\n\t\t}, options.delay + 50 || 100);\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Finds a background color for the element. If element is transparent it goes\r\n\t * up the DOM hierarchy to find a parent element that does.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param element Element\r\n\t * @return Color code\r\n\t */\r\n\tpublic findBackgroundColor(element: Element): Color {\r\n\r\n\t\t// Check if element has styles set\r\n\t\tlet opacity = 1,\r\n\t\t\tcurrentColor = (<string>getComputedStyle(element, \"background-color\"));\r\n\r\n\t\t// Check opacity\r\n\t\tif (currentColor.match(/[^,]*,[^,]*,[^,]*,[ ]?0/) || currentColor == \"transparent\") {\r\n\t\t\topacity = 0;\r\n\t\t}\r\n\r\n\t\tif (opacity == 0) {\r\n\t\t\tlet parent = element.parentElement;// || <Element>element.parentNode;\r\n\r\n\t\t\t// Completely transparent. Look for a parent\r\n\t\t\tif (parent) {\r\n\t\t\t\treturn this.findBackgroundColor(parent);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn color(\"#fff\");\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn color(currentColor, opacity);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * A reference to a container to be used to place [[ExportMenu]] in.\r\n\t *\r\n\t * @param value Reference\r\n\t */\r\n\tpublic set container(value: HTMLElement) {\r\n\t\tthis._container = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Reference\r\n\t */\r\n\tpublic get container(): HTMLElement {\r\n\t\treturn this.adapter.apply(\"container\", {\r\n\t\t\tcontainer: this._container\r\n\t\t}).container;\r\n\t}\r\n\r\n\t/**\r\n\t * A reference to [[Sprite]] to export. Can be any Sprite, including some\r\n\t * internal elements.\r\n\t *\r\n\t * @param value Sprite\r\n\t */\r\n\tpublic set sprite(value: Sprite) {\r\n\t\tthis._sprite = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Sprite\r\n\t */\r\n\tpublic get sprite(): Sprite {\r\n\t\treturn this.adapter.apply(\"sprite\", {\r\n\t\t\tsprite: this._sprite\r\n\t\t}).sprite;\r\n\t}\r\n\r\n\t/**\r\n\t * An array of extra [[Sprite]] elements to include in export.\r\n\t *\r\n\t * It can be used to export any external elements, or even other charts.\r\n\t *\r\n\t * E.g.:\r\n\t *\r\n\t * ```TypeScript\r\n\t * chart.exporting.extraSprites.push(chart2);\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * chart.exporting.extraSprites.push(chart2);\r\n\t * ```\r\n\t *\r\n\t * IMPORTANT: This setting is ignored when exporting to SVG format.\r\n\t *\r\n\t * @since 4.2.0\r\n\t * @param value Sprite\r\n\t */\r\n\tpublic set extraSprites(value: Array<Sprite | IExportCanvas>) {\r\n\t\tthis._extraSprites = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Sprite\r\n\t */\r\n\tpublic get extraSprites(): Array<Sprite | IExportCanvas> {\r\n\t\treturn this.adapter.apply(\"extraSprites\", {\r\n\t\t\textraSprites: this._extraSprites\r\n\t\t}).extraSprites;\r\n\t}\r\n\r\n\t/**\r\n\t * An array of [[Sprite]] elements that need to be valid before export\r\n\t * commences.\r\n\t *\r\n\t * If any of those elements is not completely ready when export is triggered,\r\n\t * the export will wait until they are (their `validated` event triggers)\r\n\t * before going through with the export opertaion.\r\n\t *\r\n\t * This is useful if you need to modify chart appearance for the export.\r\n\t *\r\n\t * E.g.:\r\n\t *\r\n\t * ```TypeScript\r\n\t * // Add watermark\r\n\t * let watermark = chart.createChild(am4core.Label);\r\n\t * watermark.text = \"Copyright (C) 2019\";\r\n\t * watermark.disabled = true;\r\n\t *\r\n\t * // Add watermark to validated sprites\r\n\t * chart.exporting.validateSprites.push(watermark);\r\n\t *\r\n\t * // Enable watermark on export\r\n\t * chart.exporting.events.on(\"exportstarted\", function(ev) {\r\n\t *   watermark.disabled = false;\r\n\t * });\r\n\t *\r\n\t * // Disable watermark when export finishes\r\n\t * chart.exporting.events.on(\"exportfinished\", function(ev) {\r\n\t *   watermark.disabled = true;\r\n\t * });\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * // Add watermark\r\n\t * var watermark = chart.createChild(am4core.Label);\r\n\t * watermark.text = \"Copyright (C) 2019\";\r\n\t * watermark.disabled = true;\r\n\t *\r\n\t * // Add watermark to validated sprites\r\n\t * chart.exporting.validateSprites.push(watermark);\r\n\t *\r\n\t * // Enable watermark on export\r\n\t * chart.exporting.events.on(\"exportstarted\", function(ev) {\r\n\t *   watermark.disabled = false;\r\n\t * });\r\n\t *\r\n\t * // Disable watermark when export finishes\r\n\t * chart.exporting.events.on(\"exportfinished\", function(ev) {\r\n\t *   watermark.disabled = true;\r\n\t * });\r\n\t * ```\r\n\t *\r\n\t * @since 4.6.8\r\n\t * @param value Sprite\r\n\t */\r\n\tpublic set validateSprites(value: Array<Sprite>) {\r\n\t\tthis._validateSprites = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Sprite\r\n\t */\r\n\tpublic get validateSprites(): Array<Sprite> {\r\n\t\treturn this.adapter.apply(\"validateSprites\", {\r\n\t\t\tvalidateSprites: this._validateSprites\r\n\t\t}).validateSprites;\r\n\t}\r\n\r\n\t/**\r\n\t * Data to export.\r\n\t *\r\n\t * @param value Data\r\n\t */\r\n\tpublic set data(value: any) {\r\n\t\tthis._data = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Data\r\n\t */\r\n\tpublic get data(): any {\r\n\t\treturn this.adapter.apply(\"data\", {\r\n\t\t\tdata: this._data\r\n\t\t}).data;\r\n\t}\r\n\r\n\t/**\r\n\t * Data fields in `{ field: fieldName }` format. Those are used for\r\n\t * exporting in data formats to name the columns.\r\n\t *\r\n\t * @see {@link https://www.amcharts.com/docs/v4/concepts/exporting/#Changing_order_and_names_of_columns} for examples and details\r\n\t * @param value Field names\r\n\t */\r\n\tpublic set dataFields(value: any) {\r\n\t\tthis._dataFields = value;\r\n\t\tthis._dynamicDataFields = false;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Field names `{ field: fieldName }`\r\n\t */\r\n\tpublic get dataFields(): any {\r\n\t\tif (!this._dataFields) {\r\n\t\t\tthis.generateDataFields();\r\n\t\t}\r\n\t\treturn this.adapter.apply(\"dataFields\", {\r\n\t\t\tdataFields: this._dataFields\r\n\t\t}).dataFields;\r\n\t}\r\n\r\n\t/**\r\n\t * Called after target chart's data updates.\r\n\t *\r\n\t * @ignore\r\n\t */\r\n\tpublic handleDataUpdated(): void {\r\n\t\tif (this._dynamicDataFields) {\r\n\t\t\tthis._dataFields = undefined;\r\n\t\t}\r\n\t\tconst hasData = this.data.length > 0;\r\n\t\tif (this._prevHasData != hasData) {\r\n\t\t\tthis._prevHasData = hasData;\r\n\t\t\tif (this.menu) {\r\n\t\t\t\tthis.menu.invalidate();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A [[DateFormatter]] to use when formatting dates when exporting data.\r\n\t *\r\n\t * @param value DateFormatter instance\r\n\t */\r\n\tpublic set dateFormatter(value: DateFormatter) {\r\n\t\tthis._dateFormatter = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return A DateFormatter instance\r\n\t */\r\n\tpublic get dateFormatter(): DateFormatter {\r\n\t\tif (!this._dateFormatter) {\r\n\t\t\tthis._dateFormatter = new DateFormatter();\r\n\t\t\tthis._dateFormatter.language = this.language;\r\n\t\t}\r\n\t\treturn this.adapter.apply(\"dateFormatter\", {\r\n\t\t\tdateFormatter: this._dateFormatter\r\n\t\t}).dateFormatter;\r\n\t}\r\n\r\n\t/**\r\n\t * A date format to use for exporting dates. Will use [[DateFormatter]]\r\n\t * format if not set.\r\n\t *\r\n\t * @param value Date format\r\n\t */\r\n\tpublic set dateFormat(value: $type.Optional<string | Intl.DateTimeFormatOptions>) {\r\n\t\tthis._dateFormat = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Date format\r\n\t */\r\n\tpublic get dateFormat(): $type.Optional<string | Intl.DateTimeFormatOptions> {\r\n\t\treturn this.adapter.apply(\"dateFormat\", {\r\n\t\t\tdateFormat: this._dateFormat\r\n\t\t}).dateFormat;\r\n\t}\r\n\r\n\t/**\r\n\t * A list of fields that hold date values.\r\n\t *\r\n\t * @param value Date field list\r\n\t */\r\n\tpublic set dateFields(value: List<string>) {\r\n\t\tthis._dateFields = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Date field list\r\n\t */\r\n\tpublic get dateFields(): List<string> {\r\n\t\tif (!this._dateFields) {\r\n\t\t\tthis._dateFields = new List<string>();\r\n\t\t}\r\n\t\treturn this.adapter.apply(\"dateFields\", {\r\n\t\t\tdateFields: this._dateFields\r\n\t\t}).dateFields;\r\n\t}\r\n\r\n\t/**\r\n\t * A [[NumberFormatter]] to use when formatting dates when exporting data.\r\n\t *\r\n\t * @since 4.5.15\r\n\t * @param value NumberFormatter instance\r\n\t */\r\n\tpublic set numberFormatter(value: NumberFormatter) {\r\n\t\tthis._numberFormatter = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return A NumberFormatter instance\r\n\t */\r\n\tpublic get numberFormatter(): NumberFormatter {\r\n\t\tif (!this._numberFormatter) {\r\n\t\t\tthis._numberFormatter = new NumberFormatter();\r\n\t\t\tthis._numberFormatter.language = this.language;\r\n\t\t}\r\n\t\treturn this.adapter.apply(\"numberFormatter\", {\r\n\t\t\tnumberFormatter: this._numberFormatter\r\n\t\t}).numberFormatter;\r\n\t}\r\n\r\n\t/**\r\n\t * A number format to use for exporting dates. Will use [[NumberFormatter]]\r\n\t * format if not set.\r\n\t *\r\n\t * @since 4.5.15\r\n\t * @param value Number format\r\n\t */\r\n\tpublic set numberFormat(value: $type.Optional<string>) {\r\n\t\tthis._numberFormat = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Number format\r\n\t */\r\n\tpublic get numberFormat(): $type.Optional<string> {\r\n\t\treturn this.adapter.apply(\"numberFormat\", {\r\n\t\t\tnumberFormat: this._numberFormat\r\n\t\t}).numberFormat;\r\n\t}\r\n\r\n\t/**\r\n\t * A list of fields that hold number values.\r\n\t *\r\n\t * @since 4.5.15\r\n\t * @param value Number field list\r\n\t */\r\n\tpublic set numberFields(value: List<string>) {\r\n\t\tthis._numberFields = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Number field list\r\n\t */\r\n\tpublic get numberFields(): List<string> {\r\n\t\tif (!this._numberFields) {\r\n\t\t\tthis._numberFields = new List<string>();\r\n\t\t}\r\n\t\treturn this.adapter.apply(\"numberFields\", {\r\n\t\t\tnumberFields: this._numberFields\r\n\t\t}).numberFields;\r\n\t}\r\n\r\n\t/**\r\n\t * A [[DurationFormatter]] to use when formatting duration values when\r\n\t * exporting data.\r\n\t *\r\n\t * @param value  DurationFormatter instance\r\n\t */\r\n\tpublic set durationFormatter(value: DurationFormatter) {\r\n\t\tthis._durationFormatter = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return A DurationFormatter instance\r\n\t */\r\n\tpublic get durationFormatter(): DurationFormatter {\r\n\t\tif (!this._durationFormatter) {\r\n\t\t\tthis._durationFormatter = new DurationFormatter();\r\n\t\t\tthis._durationFormatter.language = this.language;\r\n\t\t}\r\n\t\treturn this.adapter.apply(\"durationFormatter\", {\r\n\t\t\tdurationFormatter: this._durationFormatter\r\n\t\t}).durationFormatter;\r\n\t}\r\n\r\n\t/**\r\n\t * A format to use when formatting values from `durationFields`.\r\n\t * Will use [[DurationFormatter]] format if not set.\r\n\t *\r\n\t * @param value Duration format\r\n\t */\r\n\tpublic set durationFormat(value: $type.Optional<string>) {\r\n\t\tthis._durationFormat = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Duration format\r\n\t */\r\n\tpublic get durationFormat(): $type.Optional<string> {\r\n\t\treturn this.adapter.apply(\"durationFormat\", {\r\n\t\t\tdurationFormat: this._durationFormat\r\n\t\t}).durationFormat;\r\n\t}\r\n\r\n\t/**\r\n\t * A list of fields that hold duration values.\r\n\t *\r\n\t * @param value Duration field list\r\n\t */\r\n\tpublic set durationFields(value: List<string>) {\r\n\t\tthis._durationFields = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Duration field list\r\n\t */\r\n\tpublic get durationFields(): List<string> {\r\n\t\tif (!this._durationFields) {\r\n\t\t\tthis._durationFields = new List<string>();\r\n\t\t}\r\n\t\treturn this.adapter.apply(\"durationFields\", {\r\n\t\t\tdurationFields: this._durationFields\r\n\t\t}).durationFields;\r\n\t}\r\n\r\n\t/**\r\n\t * Generates data fields out of the first row of data.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic generateDataFields(): void {\r\n\t\tthis._dataFields = {};\r\n\t\tif (this.data.length) {\r\n\t\t\t$array.each(this.data, (row) => {\r\n\t\t\t\t$object.each(row, (key, value) => {\r\n\t\t\t\t\tif (!$type.hasValue(this._dataFields[key])) {\r\n\t\t\t\t\t\tthis._dataFields[key] = this.adapter.apply(\"dataFieldName\", {\r\n\t\t\t\t\t\t\tname: key,\r\n\t\t\t\t\t\t\tfield: key\r\n\t\t\t\t\t\t}).name;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Cheks against `dateFields` property to determine if this field holds\r\n\t * dates.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param field   Field name\r\n\t * @param options Options\r\n\t * @return `true` if it's a date field\r\n\t */\r\n\tpublic isDateField(field: string): boolean {\r\n\t\treturn this.adapter.apply(\"isDateField\", {\r\n\t\t\tisDateField: this.dateFields.contains(field),\r\n\t\t\tfield: field\r\n\t\t}).isDateField;\r\n\t}\r\n\r\n\t/**\r\n\t * Cheks against `numberFields` property to determine if this field holds\r\n\t * numbers.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param field   Field name\r\n\t * @param options Options\r\n\t * @return `true` if it's a number field\r\n\t */\r\n\tpublic isNumberField(field: string): boolean {\r\n\t\treturn this.adapter.apply(\"isNumberField\", {\r\n\t\t\tisNumberField: this.numberFields.contains(field),\r\n\t\t\tfield: field\r\n\t\t}).isNumberField;\r\n\t}\r\n\r\n\t/**\r\n\t * Cheks against `durationFields` property to determine if this field holds\r\n\t * durations.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param field   Field name\r\n\t * @param options Options\r\n\t * @return `true` if it's a date field\r\n\t */\r\n\tpublic isDurationField(field: string): boolean {\r\n\t\treturn this.adapter.apply(\"isDurationField\", {\r\n\t\t\tisDurationField: this.durationFields.contains(field),\r\n\t\t\tfield: field\r\n\t\t}).isDurationField;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns proper content type for the export type.\r\n\t *\r\n\t * @param type  Export format/type\r\n\t * @return Proper content type, i.e. \"image/jpeg\"\r\n\t */\r\n\tpublic getContentType<Key extends keyof IExportOptions>(type: Key): string {\r\n\r\n\t\tlet contentType = \"\";\r\n\t\tswitch (type) {\r\n\t\t\tcase \"png\":\r\n\t\t\tcase \"gif\":\r\n\t\t\t\tcontentType = \"image/\" + type;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"jpg\":\r\n\t\t\t\tcontentType = \"image/jpeg\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"svg\":\r\n\t\t\t\tcontentType = \"image/svg+xml\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"csv\":\r\n\t\t\t\tcontentType = \"text/csv\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"json\":\r\n\t\t\t\tcontentType = \"application/json\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"html\":\r\n\t\t\t\tcontentType = \"text/html\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"pdf\":\r\n\t\t\tcase \"pdfdata\":\r\n\t\t\t\tcontentType = \"application/pdf\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"xlsx\":\r\n\t\t\t\tcontentType = \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\";\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn this.adapter.apply(\"contentType\", {\r\n\t\t\tcontentType: contentType,\r\n\t\t\ttype: type\r\n\t\t}).contentType;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * A file prefix to be used for all exported formats.\r\n\t *\r\n\t * Export will apply format-related extension to it. E.g. if this is set to\r\n\t * \"myExport\", the file name of the PNG exported image will be \"myExport.png\".\r\n\t *\r\n\t * @param value File prefix\r\n\t */\r\n\tpublic set filePrefix(value: string) {\r\n\t\tthis._filePrefix = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return File prefix\r\n\t */\r\n\tpublic get filePrefix(): string {\r\n\t\treturn this.adapter.apply(\"filePrefix\", {\r\n\t\t\tfilePrefix: this._filePrefix\r\n\t\t}).filePrefix;\r\n\t}\r\n\r\n\t/**\r\n\t * A background color to be used for exported images. If set, this will\r\n\t * override the automatically acquired background color.\r\n\t *\r\n\t * @param value Color\r\n\t */\r\n\tpublic set backgroundColor(value: $type.Optional<Color>) {\r\n\t\tthis._backgroundColor = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Background color\r\n\t */\r\n\tpublic get backgroundColor(): $type.Optional<Color> {\r\n\t\treturn this.adapter.apply(\"backgroundColor\", {\r\n\t\t\tbackgroundColor: this._backgroundColor\r\n\t\t}).backgroundColor;\r\n\t}\r\n\r\n\t/**\r\n\t * A title to be used when printing.\r\n\t *\r\n\t * @param value Title\r\n\t */\r\n\tpublic set title(value: $type.Optional<string>) {\r\n\t\tthis._title = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Title\r\n\t */\r\n\tpublic get title(): $type.Optional<string> {\r\n\t\treturn this.adapter.apply(\"title\", {\r\n\t\t\ttitle: this._title\r\n\t\t}).title;\r\n\t}\r\n\r\n\t/**\r\n\t * Displays a preloader/exporting indicator.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Add ability to change text\r\n\t */\r\n\tpublic showPreloader(): void {\r\n\t\tlet preloader = this.preloader;\r\n\t\tif (preloader) {\r\n\t\t\tpreloader.progress = 0.5;\r\n\t\t\tpreloader.label.text = \"...\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hides preloader/exporting indicator\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic hidePreloader(): void {\r\n\t\tlet preloader = this.preloader;\r\n\t\tif (preloader) {\r\n\t\t\tpreloader.progress = 1;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a an instance of [[Preloader]] associated with the Sprite being\r\n\t * exported.\r\n\t *\r\n\t * @return Preloader\r\n\t */\r\n\tpublic get preloader(): Preloader {\r\n\t\treturn this._sprite && this._sprite.parent && this._sprite.parent.preloader ?\r\n\t\t\tthis._sprite.parent.preloader :\r\n\t\t\tundefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Displays a modal saying export is taking longer than expected.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic showTimeout(): void {\r\n\t\tthis.showModal(\r\n\t\t\tthis.adapter.apply(\"timeoutMessage\", {\r\n\t\t\t\tmessage: this.language.translate(\"Export operation took longer than expected. Something might have gone wrong.\")\r\n\t\t\t}).message\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Hides preloader/exporting indicator.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic hideTimeout(): void {\r\n\t\tif (this._timeoutTimeout) {\r\n\t\t\tthis.removeDispose(this._timeoutTimeout);\r\n\t\t\tthis._timeoutTimeout = null;\r\n\t\t}\r\n\t\tthis.hideModal();\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Language]] instance to be used for translations.\r\n\t *\r\n\t * @param value An instance of [[Language]]\r\n\t */\r\n\tpublic set language(value: Language) {\r\n\t\tthis._language = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return A [[Language]] instance to be used\r\n\t */\r\n\tpublic get language(): Language {\r\n\t\tif (!this._language) {\r\n\t\t\tthis._language = new Language();\r\n\t\t}\r\n\r\n\t\treturn this._language;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns (and creates) [[Modal]].\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Modal instance\r\n\t */\r\n\tpublic get modal(): Modal {\r\n\t\tif (!this._modal) {\r\n\t\t\tthis._modal = new Modal();\r\n\r\n\t\t\t// Prefix with Sprite's class name\r\n\t\t\tthis._modal.adapter.add(\"classPrefix\", (value) => {\r\n\t\t\t\tvalue = options.classNamePrefix + value;\r\n\t\t\t\treturn value;\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this._modal;\r\n\t}\r\n\r\n\t/**\r\n\t * Shows [[Modal]] with specific text.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param text Modal contents\r\n\t */\r\n\tpublic showModal(text: string, title?: string): void {\r\n\r\n\t\t// Hide previous modal and preloader\r\n\t\tthis.hideModal();\r\n\t\tthis.hidePreloader();\r\n\r\n\t\t// Create modal\r\n\t\tlet modal = this.modal;\r\n\t\tmodal.container = this.sprite.svgContainer.SVGContainer;\r\n\t\tmodal.content = text;\r\n\t\tmodal.readerTitle = title;\r\n\t\tmodal.open();\r\n\t}\r\n\r\n\t/**\r\n\t * Hides modal window if one's currently open.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic hideModal(): void {\r\n\t\tif (this._modal) {\r\n\t\t\tthis.modal.close();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Loads canvg dynamic module.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Instance of canvg\r\n\t * @async\r\n\t */\r\n\tprivate async _canvg(): Promise<typeof import(\"../../canvg/index.js\")[\"default\"]> {\r\n\t\tconst canvg = (await import(/* webpackChunkName: \"canvg\" */ \"../../canvg/index.js\")) as any;\r\n\r\n\t\tif (canvg.default != null) {\r\n\t\t\treturn canvg.default;\r\n\r\n\t\t} else {\r\n\t\t\treturn canvg;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns canvg instance.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Instance of canvg\r\n\t */\r\n\tpublic get canvg(): Promise<typeof import(\"../../canvg/index.js\")[\"default\"]> {\r\n\t\treturn this._canvg();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns pdfmake instance.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Instance of pdfmake\r\n\t */\r\n\tpublic get pdfmake(): Promise<any> {\r\n\t\tif (pdfmakePromise == null) {\r\n\t\t\tpdfmakePromise = _pdfmake();\r\n\t\t}\r\n\r\n\t\treturn pdfmakePromise;\r\n\t}\r\n\r\n\t/**\r\n\t * Loads xlsx dynamic module.\r\n\t *\r\n\t * This is an asynchronous function. Check the description of `getImage()`\r\n\t * for description and example usage.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Instance of pdfmake\r\n\t * @async\r\n\t */\r\n\tprivate async _xlsx(): Promise<any> {\r\n\t\treturn await import(/* webpackChunkName: \"xlsx\" */ \"xlsx\");\r\n\t}\r\n\r\n\t/**\r\n\t * Returns xlsx instance.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Instance of pdfmake\r\n\t */\r\n\tpublic get xlsx(): Promise<any> {\r\n\t\treturn this._xlsx();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets options for a format.\r\n\t */\r\n\tpublic setFormatOptions<Key extends keyof IExportOptions>(type: Key, options: IExportOptions[Key]): void {\r\n\t\tthis._formatOptions.setKey(type, options);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current options for a format.\r\n\t */\r\n\tpublic getFormatOptions<Key extends keyof IExportOptions>(type: Key): IExportOptions[Key] {\r\n\t\treturn this._formatOptions.getKey(type);\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Dictionary]] object containing format-specific options.\r\n\t *\r\n\t * May be used to change specific option for the format:\r\n\t *\r\n\t * ```TypeScript\r\n\t * chart.exporting.formatOptions.getKey(\"csv\").disabled = true;\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * chart.exporting.formatOptions.getKey(\"csv\").disabled = true;\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"exporting\": {\r\n\t *     // ...\r\n\t *     \"formatOptions\": {\r\n\t *       \"csv\": {\r\n\t *         \"disabled\": true\r\n\t *       }\r\n\t *     }\r\n\t *   }\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @since 4.9.12\r\n\t * @return  Options\r\n\t */\r\n\tpublic get formatOptions(): Dictionary<string, ExportOptions> {\r\n\t\treturn this._formatOptions;\r\n\t}\r\n\r\n\t/**\r\n\t * Disables interactivity on parent chart.\r\n\t */\r\n\tprotected _disablePointers(): void {\r\n\t\tif (!$type.hasValue(this._spriteInteractionsEnabled)) {\r\n\t\t\tthis._spriteInteractionsEnabled = this.sprite.interactionsEnabled;\r\n\t\t}\r\n\t\tthis.sprite.interactionsEnabled = false;\r\n\t}\r\n\r\n\t/**\r\n\t * Releases temporarily disabled pointers on parent chart.\r\n\t */\r\n\tprotected _releasePointers(): void {\r\n\t\tif ($type.hasValue(this._spriteInteractionsEnabled) && !this._exportRunning) {\r\n\t\t\tthis.sprite.interactionsEnabled = this._spriteInteractionsEnabled;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hides all elements that should not be included in the exported image.\r\n\t */\r\n\tprivate hideNonExportableSprites(): void {\r\n\t\tif (this._objectsAlreadyHidden) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst svgContainer = this.sprite.svgContainer;\r\n\t\tif (svgContainer) {\r\n\t\t\t$array.each(svgContainer.nonExportableSprites, (item) => {\r\n\t\t\t\tif (!item.isHidden && !item.isHiding && item.visible) {\r\n\t\t\t\t\tthis._hiddenObjects.push(item);\r\n\t\t\t\t}\r\n\t\t\t\titem.hide(0);\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis._objectsAlreadyHidden = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Respores elements that were hidden before export.\r\n\t */\r\n\tprivate restoreNonExportableSprites(): void {\r\n\t\tif (!this._objectsAlreadyHidden) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t$array.each(this._hiddenObjects, (item) => {\r\n\t\t\titem.show(0);\r\n\t\t});\r\n\t\tthis._hiddenObjects = [];\r\n\t\tthis._objectsAlreadyHidden = false;\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if there are elements that absolutely need to be validated before\r\n\t * export.\r\n\t *\r\n\t * If there are invalid elements, it will await for them to be validated.\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tprivate async awaitValidSprites(): Promise<void> {\r\n\t\tlet promises: Promise<any>[] = [];\r\n\r\n\t\tif (this.validateSprites.length) {\r\n\t\t\t$array.each(this.validateSprites, (sprite, index) => {\r\n\t\t\t\tif (sprite.invalid) {\r\n\t\t\t\t\tpromises.push(new Promise((resolve, reject) => {\r\n\t\t\t\t\t\tsprite.events.once(\"validated\", (ev) => {\r\n\t\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (promises.length) {\r\n\t\t\tawait Promise.all(promises);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Processes JSON-based config before it is applied to the object.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param config  Config\r\n\t */\r\n\tpublic processConfig(config?: { [index: string]: any }): void {\r\n\r\n\t\tregistry.registeredClasses[\"ExportMenu\"] = ExportMenu;\r\n\r\n\t\tif (config) {\r\n\r\n\t\t\t// Set up menu\r\n\t\t\tif ($type.hasValue(config.menu) && !$type.hasValue(config.menu.type)) {\r\n\t\t\t\tconfig.menu.type = \"ExportMenu\";\r\n\t\t\t}\r\n\r\n\t\t\tif ($type.hasValue(config.dataFields) && $type.isObject(config.dataFields)) {\r\n\t\t\t\tthis.dataFields = config.dataFields;\r\n\t\t\t\tdelete config.dataFields;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsuper.processConfig(config);\r\n\t}\r\n\r\n}\r\n","/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { dataLoader } from \"./DataLoader\";\r\nimport { DataParser } from \"./DataParser\";\r\nimport { JSONParser } from \"./JSONParser\";\r\nimport { CSVParser } from \"./CSVParser\";\r\nimport { BaseObjectEvents, IBaseObjectEvents } from \"../Base\";\r\nimport { Component } from \"../Component\";\r\nimport { Adapter } from \"../utils/Adapter\";\r\nimport { AMEvent } from \"../utils/EventDispatcher\";\r\nimport { Language } from \"../utils/Language\";\r\nimport { DateFormatter } from \"../formatters/DateFormatter\";\r\nimport { INetRequestOptions } from \"../utils/Net\";\r\nimport { IDisposer } from \"../utils/Disposer\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $object from \"../utils/Object\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines events for [[DataSource]].\r\n */\r\nexport interface IDataSourceEvents extends IBaseObjectEvents {\r\n\r\n\t/**\r\n\t * Invoked when loading of the data starts.\r\n\t */\r\n\tstarted: {};\r\n\r\n\t/**\r\n\t * Invoked when loading of the data starts.\r\n\t */\r\n\tloadstarted: {};\r\n\r\n\t/**\r\n\t * Invoked when the loading of the data finishes.\r\n\t */\r\n\tloadended: {};\r\n\r\n\t/**\r\n\t * Invoked when parsing of the loaded data starts.\r\n\t */\r\n\tparsestarted: {};\r\n\r\n\t/**\r\n\t * Invoked when parsing of the loaded data finishes.\r\n\t */\r\n\tparseended: {};\r\n\r\n\t/**\r\n\t * Invoked when loading and parsing finishes.\r\n\t */\r\n\tended: {};\r\n\r\n\t/**\r\n\t * Invoked when data source was successfully loaded and parsed.\r\n\t */\r\n\tdone: {\r\n\t\tdata: any\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when data source encounters a loading error.\r\n\t */\r\n\terror: {\r\n\t\tcode: number,\r\n\t\tmessage: string\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when data source encounters a parsing error.\r\n\t */\r\n\tparseerror: {\r\n\t\tmessage: string\r\n\t};\r\n\r\n};\r\n\r\n/**\r\n * Defines adapters for [[DataSource]].\r\n */\r\nexport interface IDataSourceAdapters {\r\n\r\n\t/**\r\n\t * Applied to a data source URL before it is loaded.\r\n\t */\r\n\turl: string;\r\n\r\n\t/**\r\n\t * Applied to a parser type, before parsing starts.\r\n\t *\r\n\t * Can be used to supply different parser than the one set/determined by\r\n\t * Data Loader.\r\n\t */\r\n\tparser: DataParser;\r\n\r\n\t/**\r\n\t * Applied to the timeout setting.\r\n\t */\r\n\treloadTimeout: number;\r\n\r\n\t/**\r\n\t * Applied to the loaded data **before** it is passed to parser.\r\n\t */\r\n\tunparsedData: string;\r\n\r\n\t/**\r\n\t * Applied to the loaded data **after** it was parsed by a parser.\r\n\t */\r\n\tparsedData: any;\r\n\r\n\t/**\r\n\t * Applied to `incremental` setting.\r\n\t */\r\n\tincremental: boolean;\r\n\r\n\t/**\r\n\t * Applied to `incrementalParams` setting.\r\n\t */\r\n\tincrementalParams: { [index: string]: string };\r\n\r\n\t/**\r\n\t * Applied to `updateCurrentData` setting.\r\n\t */\r\n\tupdateCurrentData: boolean;\r\n\r\n\t/**\r\n\t * Applied to `keepCount` setting.\r\n\t */\r\n\tkeepCount: boolean;\r\n\r\n\t/**\r\n\t * Applied to parser options.\r\n\t */\r\n\tparserOptions: any;\r\n\r\n\t/**\r\n\t * Applied to the array that lists fields in data that hold date-based values.\r\n\t */\r\n\tdateFields: string[];\r\n\r\n\t/**\r\n\t * Applied to the array that lists fields in data that hold numeric values.\r\n\t */\r\n\tnumberFields: string[];\r\n\r\n\t/**\r\n\t * Applied to the custom request options object.\r\n\t */\r\n\trequestOptions: INetRequestOptions;\r\n\r\n};\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Represents a single data source - external file with all of its settings,\r\n * such as format, data parsing, etc.\r\n *\r\n * ```TypeScript\r\n * chart.dataSource.url = \"http://www.myweb.com/data.json\";\r\n * chart.dataSource.parser = am4core.JSONParser;\r\n * ```\r\n * ```JavaScript\r\n * chart.dataSource.url = \"http://www.myweb.com/data.json\";\r\n * chart.dataSource.parser = am4core.JSONParser;\r\n * ```\r\n * ```JSON\r\n * {\r\n *   // ...\r\n *   \"dataSource\": {\r\n *     \"url\": \"http://www.myweb.com/data.json\",\r\n *     \"parser\": \"JSONParser\"\r\n *   },\r\n *   // ...\r\n * }\r\n * ```\r\n *\r\n * @see {@link IDataSourceEvents} for a list of available events\r\n * @see {@link IDataSourceAdapters} for a list of available Adapters\r\n */\r\nexport class DataSource extends BaseObjectEvents {\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IDataSourceEvents;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IDataSourceAdapters;\r\n\r\n\t/**\r\n\t * Adapter.\r\n\t */\r\n\tpublic adapter: Adapter<DataSource, IDataSourceAdapters> = new Adapter<DataSource, IDataSourceAdapters>(this);\r\n\r\n\t/**\r\n\t * A [[Component]] recipient of the data.\r\n\t */\r\n\tpublic component: Component;\r\n\r\n\t/**\r\n\t * An instance of [[Language]].\r\n\t */\r\n\tprotected _language: Language;\r\n\r\n\t/**\r\n\t * An instance of [[DateFormatter]].\r\n\t */\r\n\tprotected _dateFormatter: DateFormatter;\r\n\r\n\t/**\r\n\t * An instance of parser class that can understand and parse data from the\r\n\t * source URL.\r\n\t */\r\n\tprotected _parser: DataParser;\r\n\r\n\t/**\r\n\t * An URL of the data source.\r\n\t */\r\n\tprotected _url: string;\r\n\r\n\t/**\r\n\t * Custom options for HTTP(S) request.\r\n\t */\r\n\tprotected _requestOptions: INetRequestOptions = {};\r\n\r\n\t/**\r\n\t * Reload full data source every X ms.\r\n\t */\r\n\tprotected _reloadFrequency: number;\r\n\r\n\t/**\r\n\t * Holds timeout reference for next reload.\r\n\t */\r\n\tprotected _reloadTimeout: any;\r\n\r\n\t/**\r\n\t * Holds disposer for the reload event handler.\r\n\t */\r\n\tprivate _reloadDisposer: IDisposer;\r\n\r\n\t/**\r\n\t * If set to `true`, any subsequent data loads will be considered incremental\r\n\t * (containing only new data points that are supposed to be added to existing\r\n\t * data).\r\n\t *\r\n\t * NOTE: this setting works only with element's `data` property. It won't\r\n\t * work with any other externally-loadable data property.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tprotected _incremental: boolean = false;\r\n\r\n\t/**\r\n\t * A collection of key/value pairs to attach to a data source URL when making\r\n\t * an incremental request.\r\n\t */\r\n\tprotected _incrementalParams: { [index: string]: string } = {};\r\n\r\n\t/**\r\n\t * This setting is used only when `incremental = true`. If set to `true`,\r\n\t * it will try to retain the same number of data items across each load.\r\n\t *\r\n\t * E.g. if incremental load yeilded 5 new records, then 5 items from the\r\n\t * beginning of data will be removed so that we end up with the same number\r\n\t * of data items.\r\n\t *\r\n\t * @default false\r\n\t */\r\n\tprotected _keepCount: boolean = false;\r\n\r\n\t/**\r\n\t * If set to `true`, each subsequent load will be treated as an update to\r\n\t * currently loaded data, meaning that it will try to update values on\r\n\t * existing data items, not overwrite the whole data.\r\n\t *\r\n\t * This will work faster than complete update, and also will animate the\r\n\t * values to their new positions.\r\n\t *\r\n\t * Data sources across loads must contain the same number of data items.\r\n\t *\r\n\t * Loader will not truncate the data set if loaded data has fewer data items,\r\n\t * and if it is longer, the excess data items will be ignored.\r\n\t *\r\n\t * @default false\r\n\t * @since 4.5.5\r\n\t */\r\n\tprotected _updateCurrentData: boolean = false;\r\n\r\n\t/**\r\n\t * Holds the date of the last load.\r\n\t */\r\n\tpublic lastLoad: Date;\r\n\r\n\t/**\r\n\t * If set to `true` it will timestamp all requested URLs to work around\r\n\t * browser cache.\r\n\t */\r\n\tpublic disableCache: boolean;\r\n\r\n\t/**\r\n\t * Will show loading indicator when loading files.\r\n\t */\r\n\tpublic showPreloader: boolean = true;\r\n\r\n\t/**\r\n\t * Loaded and parsed data.\r\n\t */\r\n\tpublic data: any;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor(url?: string, parser?: string | DataParser) {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"DataSource\";\r\n\r\n\t\t// Set defaults\r\n\t\tif (url) {\r\n\t\t\tthis.url = url;\r\n\t\t}\r\n\r\n\t\t// Set parser\r\n\t\tif (parser) {\r\n\t\t\tif (typeof parser == \"string\") {\r\n\t\t\t\tthis.parser = dataLoader.getParserByType(parser);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.parser = parser;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Processes the loaded data.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param data         Raw (unparsed) data\r\n\t * @param contentType  Content type of the loaded data (optional)\r\n\t */\r\n\tpublic processData(data: string, contentType?: string): void {\r\n\t\t// Parsing started\r\n\t\tthis.dispatchImmediately(\"parsestarted\");\r\n\r\n\t\t// Check if parser is set\r\n\t\tif (!this.parser) {\r\n\r\n\t\t\t// Try to resolve from data\r\n\t\t\tthis.parser = dataLoader.getParserByData(data, contentType);\r\n\r\n\t\t\tif (!this.parser) {\r\n\t\t\t\t// We have a problem - nobody knows what to do with the data\r\n\t\t\t\t// Raise error\r\n\t\t\t\tif (this.events.isEnabled(\"parseerror\")) {\r\n\t\t\t\t\tconst event: AMEvent<this, IDataSourceEvents>[\"parseerror\"] = {\r\n\t\t\t\t\t\ttype: \"parseerror\",\r\n\t\t\t\t\t\tmessage: this.language.translate(\"No parser available for file: %1\", null, this.url),\r\n\t\t\t\t\t\ttarget: this\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.events.dispatchImmediately(\"parseerror\", event);\r\n\t\t\t\t}\r\n\t\t\t\tthis.dispatchImmediately(\"parseended\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Apply options adapters\r\n\t\tthis.parser.options = this.adapter.apply(\"parserOptions\", this.parser.options);\r\n\t\tthis.parser.options.dateFields = this.adapter.apply(\"dateFields\", this.parser.options.dateFields || []);\r\n\t\tthis.parser.options.numberFields = this.adapter.apply(\"numberFields\", this.parser.options.numberFields || []);\r\n\r\n\t\t// Check if we need to pass in date formatter\r\n\t\tif (this.parser.options.dateFields && !this.parser.options.dateFormatter) {\r\n\t\t\tthis.parser.options.dateFormatter = this.dateFormatter;\r\n\t\t}\r\n\r\n\t\t// Parse\r\n\t\tthis.data = this.adapter.apply(\r\n\t\t\t\"parsedData\",\r\n\t\t\tthis.parser.parse(\r\n\t\t\t\tthis.adapter.apply(\"unparsedData\", data)\r\n\t\t\t)\r\n\t\t);\r\n\r\n\t\t// Check for parsing errors\r\n\t\tif (!$type.hasValue(this.data) && this.events.isEnabled(\"parseerror\")) {\r\n\t\t\tconst event: AMEvent<this, IDataSourceEvents>[\"parseerror\"] = {\r\n\t\t\t\ttype: \"parseerror\",\r\n\t\t\t\tmessage: this.language.translate(\"Error parsing file: %1\", null, this.url),\r\n\t\t\t\ttarget: this\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"parseerror\", event);\r\n\t\t}\r\n\r\n\t\t// Wrap up\r\n\t\tthis.dispatchImmediately(\"parseended\");\r\n\r\n\t\tif ($type.hasValue(this.data)) {\r\n\t\t\tthis.dispatchImmediately(\"done\", {\r\n\t\t\t\t\"data\": this.data\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// The component is responsible for updating its own data vtriggered via\r\n\t\t// events.\r\n\r\n\t\t// Update last data load\r\n\t\tthis.lastLoad = new Date();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * URL of the data source.\r\n\t *\r\n\t * @param value  URL\r\n\t */\r\n\tpublic set url(value: string) {\r\n\t\tthis._url = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return URL\r\n\t */\r\n\tpublic get url(): string {\r\n\r\n\t\t// Get URL\r\n\t\tlet url = this.disableCache\r\n\t\t\t? this.timestampUrl(this._url)\r\n\t\t\t: this._url;\r\n\r\n\t\t// Add incremental params\r\n\t\tif (this.incremental && this.component.data.length) {\r\n\t\t\turl = this.addUrlParams(url, this.incrementalParams);\r\n\t\t}\r\n\r\n\t\treturn this.adapter.apply(\"url\", url);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Custom options for HTTP(S) request.\r\n\t *\r\n\t * At this moment the only option supported is: `requestHeaders`, which holds\r\n\t * an array of objects for custom request headers, e.g.:\r\n\t *\r\n\t * ```TypeScript\r\n\t * chart.dataSource.requestOptions.requestHeaders = [{\r\n\t *   \"key\": \"x-access-token\",\r\n\t *   \"value\": \"123456789\"\r\n\t * }];\r\n\t * ``````JavaScript\r\n\t * chart.dataSource.requestOptions.requestHeaders = [{\r\n\t *   \"key\": \"x-access-token\",\r\n\t *   \"value\": \"123456789\"\r\n\t * }];\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"dataSource\": {\r\n\t *     // ...\r\n\t *     \"requestOptions\": {\r\n\t *       \"requestHeaders\": [{\r\n\t *         \"key\": \"x-access-token\",\r\n\t *         \"value\": \"123456789\"\r\n\t *       }]\r\n\t *     }\r\n\t *   }\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * NOTE: setting this options on an-already loaded DataSource will not\r\n\t * trigger a reload.\r\n\t *\r\n\t * @param value  Options\r\n\t */\r\n\tpublic set requestOptions(value: INetRequestOptions) {\r\n\t\tthis._requestOptions = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Options\r\n\t */\r\n\tpublic get requestOptions(): INetRequestOptions {\r\n\t\treturn this.adapter.apply(\"requestOptions\", this._requestOptions);\r\n\t}\r\n\r\n\t/**\r\n\t * A parser to be used to parse data.\r\n\t *\r\n\t * ```TypeScript\r\n\t * chart.dataSource.url = \"http://www.myweb.com/data.json\";\r\n\t * chart.dataSource.parser = am4core.JSONParser;\r\n\t * ```\r\n\t * ```JavaScript\r\n\t * chart.dataSource.url = \"http://www.myweb.com/data.json\";\r\n\t * chart.dataSource.parser = am4core.JSONParser;\r\n\t * ```\r\n\t * ```JSON\r\n\t * {\r\n\t *   // ...\r\n\t *   \"dataSource\": {\r\n\t *     \"url\": \"http://www.myweb.com/data.json\",\r\n\t *     \"parser\": {\r\n\t *       \"type\": \"JSONParser\"\r\n\t *     }\r\n\t *   },\r\n\t *   // ...\r\n\t * }\r\n\t * ```\r\n\t *\r\n\t * @default JSONParser\r\n\t * @param value  Data parser\r\n\t */\r\n\tpublic set parser(value: DataParser) {\r\n\t\tthis._parser = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Data parser\r\n\t */\r\n\tpublic get parser(): DataParser {\r\n\t\tif (!this._parser) {\r\n\t\t\tthis._parser = new JSONParser();\r\n\t\t}\r\n\t\treturn this.adapter.apply(\"parser\", this._parser);\r\n\t}\r\n\r\n\t/**\r\n\t * Data source reload frequency.\r\n\t *\r\n\t * If set, it will reload the same URL every X milliseconds.\r\n\t *\r\n\t * @param value Reload frequency (ms)\r\n\t */\r\n\tpublic set reloadFrequency(value: number) {\r\n\t\tif (this._reloadFrequency != value) {\r\n\t\t\tthis._reloadFrequency = value;\r\n\r\n\t\t\t// Should we schedule a reload?\r\n\t\t\tif (value) {\r\n\t\t\t\tif (!$type.hasValue(this._reloadDisposer)) {\r\n\t\t\t\t\tthis._reloadDisposer = this.events.on(\"ended\", (ev) => {\r\n\t\t\t\t\t\tthis._reloadTimeout = setTimeout(() => {\r\n\t\t\t\t\t\t\tthis.load();\r\n\t\t\t\t\t\t}, this.reloadFrequency);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if ($type.hasValue(this._reloadDisposer)) {\r\n\t\t\t\tthis._reloadDisposer.dispose();\r\n\t\t\t\tthis._reloadDisposer = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Reload frequency (ms)\r\n\t */\r\n\tpublic get reloadFrequency(): number {\r\n\t\treturn this.adapter.apply(\"reloadTimeout\", this._reloadFrequency);\r\n\t}\r\n\r\n\t/**\r\n\t * Should subsequent reloads be treated as incremental?\r\n\t *\r\n\t * Incremental loads will assume that they contain only new data items\r\n\t * since the last load.\r\n\t *\r\n\t * If `incremental = false` the loader will replace all of the target's\r\n\t * data with each load.\r\n\t *\r\n\t * This setting does not have any effect trhe first time data is loaded.\r\n\t *\r\n\t * NOTE: this setting works only with element's `data` property. It won't\r\n\t * work with any other externally-loadable data property.\r\n\t *\r\n\t * @default false\r\n\t * @param Incremental load?\r\n\t */\r\n\tpublic set incremental(value: boolean) {\r\n\t\tthis._incremental = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Incremental load?\r\n\t */\r\n\tpublic get incremental(): boolean {\r\n\t\treturn this.adapter.apply(\"incremental\", this._incremental);\r\n\t}\r\n\r\n\t/**\r\n\t * An object consisting of key/value pairs to apply to an URL when data\r\n\t * source is making an incremental request.\r\n\t *\r\n\t * @param value  Incremental request parameters\r\n\t */\r\n\tpublic set incrementalParams(value: { [index: string]: string }) {\r\n\t\tthis._incrementalParams = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Incremental request parameters\r\n\t */\r\n\tpublic get incrementalParams(): { [index: string]: string } {\r\n\t\treturn this.adapter.apply(\"incrementalParams\", this._incrementalParams);\r\n\t}\r\n\r\n\t/**\r\n\t * This setting is used only when `incremental = true`. If set to `true`,\r\n\t * it will try to retain the same number of data items across each load.\r\n\t *\r\n\t * E.g. if incremental load yeilded 5 new records, then 5 items from the\r\n\t * beginning of data will be removed so that we end up with the same number\r\n\t * of data items.\r\n\t *\r\n\t * @default false\r\n\t * @param Keep record count?\r\n\t */\r\n\tpublic set keepCount(value: boolean) {\r\n\t\tthis._keepCount = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return keepCount load?\r\n\t */\r\n\tpublic get keepCount(): boolean {\r\n\t\treturn this.adapter.apply(\"keepCount\", this._keepCount);\r\n\t}\r\n\r\n\t/**\r\n\t * If set to `true`, each subsequent load will be treated as an update to\r\n\t * currently loaded data, meaning that it will try to update values on\r\n\t * existing data items, not overwrite the whole data.\r\n\t *\r\n\t * This will work faster than complete update, and also will animate the\r\n\t * values to their new positions.\r\n\t *\r\n\t * Data sources across loads must contain the same number of data items.\r\n\t *\r\n\t * Loader will not truncate the data set if loaded data has fewer data items,\r\n\t * and if it is longer, the excess data items will be ignored.\r\n\t *\r\n\t * NOTE: this setting is ignored if `incremental = true`.\r\n\t *\r\n\t * @default false\r\n\t * @since 2.5.5\r\n\t * @param Update current data?\r\n\t */\r\n\tpublic set updateCurrentData(value: boolean) {\r\n\t\tthis._updateCurrentData = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Update current data?\r\n\t */\r\n\tpublic get updateCurrentData(): boolean {\r\n\t\treturn this.adapter.apply(\"updateCurrentData\", this._updateCurrentData);\r\n\t}\r\n\r\n\t/**\r\n\t * Language instance to use.\r\n\t *\r\n\t * Will inherit and use chart's language, if not set.\r\n\t *\r\n\t * @param value An instance of Language\r\n\t */\r\n\tpublic set language(value: Language) {\r\n\t\tthis._language = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return A [[Language]] instance to be used\r\n\t */\r\n\tpublic get language(): Language {\r\n\t\tif (this._language) {\r\n\t\t\treturn this._language;\r\n\t\t}\r\n\t\telse if (this.component) {\r\n\t\t\tthis._language = this.component.language;\r\n\t\t\treturn this._language;\r\n\t\t}\r\n\t\tthis.language = new Language();\r\n\t\treturn this.language;\r\n\t}\r\n\r\n\t/**\r\n\t * A [[DateFormatter]] to use when parsing dates from string formats.\r\n\t *\r\n\t * Will inherit and use chart's DateFormatter if not ser.\r\n\t *\r\n\t * @param value An instance of [[DateFormatter]]\r\n\t */\r\n\tpublic set dateFormatter(value: DateFormatter) {\r\n\t\tthis._dateFormatter = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return A [[DateFormatter]] instance to be used\r\n\t */\r\n\tpublic get dateFormatter(): DateFormatter {\r\n\t\tif (this._dateFormatter) {\r\n\t\t\treturn this._dateFormatter;\r\n\t\t}\r\n\t\telse if (this.component) {\r\n\t\t\tthis._dateFormatter = this.component.dateFormatter;\r\n\t\t\treturn this._dateFormatter;\r\n\t\t}\r\n\t\tthis.dateFormatter = new DateFormatter();\r\n\t\treturn this.dateFormatter;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds current timestamp to the URL.\r\n\t *\r\n\t * @param url  Source URL\r\n\t * @return Timestamped URL\r\n\t */\r\n\tpublic timestampUrl(url: string): string {\r\n\t\tlet tstamp = new Date().getTime().toString();\r\n\t\tlet params: { [index: string]: string } = {};\r\n\t\tparams[tstamp] = \"\";\r\n\t\treturn this.addUrlParams(url, params);\r\n\t}\r\n\r\n\t/**\r\n\t * Disposes of this object.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tsuper.dispose();\r\n\t\tif (this._reloadTimeout) {\r\n\t\t\tclearTimeout(this._reloadTimeout);\r\n\t\t}\r\n\t\tif ($type.hasValue(this._reloadDisposer)) {\r\n\t\t\tthis._reloadDisposer.dispose();\r\n\t\t\tthis._reloadDisposer = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Initiate the load.\r\n\t *\r\n\t * All loading in JavaScript is asynchronous. This function will trigger the\r\n\t * load and will exit immediately.\r\n\t *\r\n\t * Use DataSource's events to watch for loaded data and errors.\r\n\t */\r\n\tpublic load(): void {\r\n\t\tif (this.url) {\r\n\t\t\tif (this._reloadTimeout) {\r\n\t\t\t\tclearTimeout(this._reloadTimeout);\r\n\t\t\t}\r\n\t\t\tdataLoader.load(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adds parameters to `url` as query strings. Will take care of proper\r\n\t * separators.\r\n\t *\r\n\t * @param url     Source URL\r\n\t * @param params  Parameters\r\n\t * @return New URL\r\n\t */\r\n\tpublic addUrlParams(url: string, params: { [index: string]: string }): string {\r\n\t\tlet join = url.match(/\\?/) ? \"&\" : \"?\";\r\n\t\tlet add: string[] = [];\r\n\t\t$object.each(params, (key, value) => {\r\n\t\t\tif (value != \"\") {\r\n\t\t\t\tadd.push(key + \"=\" + encodeURIComponent(value));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tadd.push(key);\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (add.length) {\r\n\t\t\treturn url + join + add.join(\"&\");\r\n\t\t}\r\n\t\treturn url;\r\n\t}\r\n\r\n\t/**\r\n\t * Processes JSON-based config before it is applied to the object.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param config  Config\r\n\t */\r\n\tpublic processConfig(config?: { [index: string]: any }): void {\r\n\r\n\t\tregistry.registeredClasses[\"json\"] = JSONParser;\r\n\t\tregistry.registeredClasses[\"JSONParser\"] = JSONParser;\r\n\t\tregistry.registeredClasses[\"csv\"] = CSVParser;\r\n\t\tregistry.registeredClasses[\"CSVParser\"] = CSVParser;\r\n\r\n\t\tsuper.processConfig(config);\r\n\r\n\t}\r\n\r\n}\r\n","/**\r\n * Line drawing functionality.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite, ISpriteProperties, ISpriteAdapters, ISpriteEvents } from \"../Sprite\";\r\nimport { color } from \"../utils/Color\";\r\nimport { LinearGradient } from \"../rendering/fills/LinearGradient\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $type from \"../utils/Type\";\r\nimport * as $math from \"../utils/Math\";\r\nimport { IOrientationPoint } from \"../defs/IPoint\";\r\n\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[Line]].\r\n */\r\nexport interface ILineProperties extends ISpriteProperties {\r\n\r\n\t/**\r\n\t * X coordinate of first end.\r\n\t */\r\n\tx1?: number;\r\n\r\n\t/**\r\n\t * Y coordinate of first end.\r\n\t */\r\n\ty1?: number;\r\n\r\n\t/**\r\n\t * X coordinate of second end.\r\n\t */\r\n\tx2?: number;\r\n\r\n\t/**\r\n\t * Y coordinate of second end.\r\n\t */\r\n\ty2?: number;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[Line]].\r\n */\r\nexport interface ILineEvents extends ISpriteEvents { }\r\n\r\n/**\r\n * Defines adapters for [[Line]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface ILineAdapters extends ISpriteAdapters, ILineProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Draws a line.\r\n *\r\n * @see {@link ILineEvents} for a list of available events\r\n * @see {@link ILineAdapters} for a list of available Adapters\r\n */\r\nexport class Line extends Sprite {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: ILineProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: ILineAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: ILineEvents;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"Line\";\r\n\t\tthis.element = this.paper.add(\"line\");\r\n\t\tthis.fill = color(); //\"none\";\r\n\r\n\t\tthis.x1 = 0;\r\n\t\tthis.y1 = 0;\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the line.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic draw(): void {\r\n\t\tsuper.draw();\r\n\t\tif (this.x1 == this.x2 || this.y1 == this.y2) {\r\n\t\t\tthis.pixelPerfect = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.pixelPerfect = false;\r\n\t\t}\r\n\r\n\t\tthis.x1 = this.x1;\r\n\t\tthis.x2 = this.x2;\r\n\r\n\t\tthis.y1 = this.y1;\r\n\t\tthis.y2 = this.y2;\r\n\t}\r\n\r\n\t/**\r\n\t * X coordinate of first end.\r\n\t *\r\n\t * @param value X\r\n\t */\r\n\tpublic set x1(value: number) {\r\n\t\tif (!$type.isNumber(value)) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tlet delta = 0;\r\n\t\tif (this.pixelPerfect && this.stroke instanceof LinearGradient) {\r\n\t\t\tdelta = 0.00001;\r\n\t\t}\r\n\r\n\t\tthis.setPropertyValue(\"x1\", value, true);\r\n\t\tthis.element.attr({ \"x1\": value + delta });\r\n\t}\r\n\r\n\t/**\r\n\t * @return X\r\n\t */\r\n\tpublic get x1(): number {\r\n\t\treturn this.getPropertyValue(\"x1\");\r\n\t}\r\n\r\n\t/**\r\n\t * X coordinate of second end.\r\n\t *\r\n\t * @param value X\r\n\t */\r\n\tpublic set x2(value: number) {\r\n\t\tif (!$type.isNumber(value)) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tthis.setPropertyValue(\"x2\", value, true);\r\n\t\tthis.element.attr({ \"x2\": value });\r\n\t}\r\n\r\n\t/**\r\n\t * @return X\r\n\t */\r\n\tpublic get x2(): number {\r\n\t\tlet value = this.getPropertyValue(\"x2\");\r\n\t\tif (!$type.isNumber(value)) {\r\n\t\t\tvalue = this.pixelWidth;\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Y coordinate of first end.\r\n\t *\r\n\t * @param value Y\r\n\t */\r\n\tpublic set y1(value: number) {\r\n\t\tif (!$type.isNumber(value)) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\r\n\t\tlet delta = 0;\r\n\t\tif (this.pixelPerfect && this.stroke instanceof LinearGradient) {\r\n\t\t\tdelta = 0.00001;\r\n\t\t}\r\n\r\n\t\tthis.setPropertyValue(\"y1\", value, true);\r\n\t\tthis.element.attr({ \"y1\": value + delta });\r\n\t}\r\n\r\n\t/**\r\n\t * @return Y\r\n\t */\r\n\tpublic get y1(): number {\r\n\t\treturn this.getPropertyValue(\"y1\");\r\n\t}\r\n\r\n\t/**\r\n\t * Y coordinate of second end.\r\n\t *\r\n\t * @param value Y\r\n\t */\r\n\tpublic set y2(value: number) {\r\n\t\tif (!$type.isNumber(value)) {\r\n\t\t\tvalue = 0;\r\n\t\t}\r\n\t\tthis.setPropertyValue(\"y2\", value, true);\r\n\t\tthis.element.attr({ \"y2\": value });\r\n\t}\r\n\r\n\t/**\r\n\t * @return Y\r\n\t */\r\n\tpublic get y2(): number {\r\n\t\tlet value = this.getPropertyValue(\"y2\");\r\n\t\tif (!$type.isNumber(value)) {\r\n\t\t\tvalue = this.pixelHeight;\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts relative position along the line (0-1) into pixel coordinates.\r\n\t *\r\n\t * @param position  Position (0-1)\r\n\t * @return Coordinates\r\n\t */\r\n\tpublic positionToPoint(position: number): IOrientationPoint {\r\n\t\tlet point1 = { x: this.x1, y: this.y1 };\r\n\t\tlet point2 = { x: this.x2, y: this.y2 };\r\n\t\tlet point = $math.getMidPoint(point1, point2, position);\r\n\t\tlet angle = $math.getAngle(point1, point2);\r\n\r\n\t\treturn {x:point.x, y:point.y, angle:angle};\r\n\t}\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Line\"] = Line;\r\n","/**\r\n * Pointed rectangle module.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { PointedShape, IPointedShapeProperties, IPointedShapeAdapters, IPointedShapeEvents } from \"./PointedShape\";\r\nimport * as $math from \"../utils/Math\";\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[PointedRectangle]].\r\n */\r\nexport interface IPointedRectangleProperties extends IPointedShapeProperties {\r\n\r\n\t/**\r\n\t * Radius of rectangle's border in pixels.\r\n\t *\r\n\t * @default 0\r\n\t */\r\n\tcornerRadius?: number;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[PointedRectangle]].\r\n */\r\nexport interface IPointedRectangleEvents extends IPointedShapeEvents { }\r\n\r\n/**\r\n * Defines adapters for [[PointedRectangle]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IPointedRectangleAdapters extends IPointedShapeAdapters, IPointedRectangleProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Draws a rectangle with a pointer.\r\n *\r\n * @see {@link IPointedRectangleEvents} for a list of available events\r\n * @see {@link IPointedRectangleAdapters} for a list of available Adapters\r\n */\r\nexport class PointedRectangle extends PointedShape {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IPointedRectangleProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IPointedRectangleAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IPointedRectangleEvents;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"PointedRectangle\";\r\n\t\tthis.element = this.paper.add(\"path\");\r\n\t\tthis.cornerRadius = 6;\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic draw(): void {\r\n\t\tsuper.draw();\r\n\t\tlet cr = this.cornerRadius;\r\n\t\tlet w = this.innerWidth;\r\n\t\tlet h = this.innerHeight;\r\n\t\tif (w > 0 && h > 0) {\r\n\t\t\tlet x = this.pointerX;\r\n\t\t\tlet y = this.pointerY;\r\n\t\t\tlet bwh = this.pointerBaseWidth / 2;\r\n\r\n\t\t\tlet maxcr: number = $math.min(w / 2, h / 2);\r\n\t\t\tlet crtl: number = $math.fitToRange(cr, 0, maxcr);\r\n\t\t\tlet crtr: number = $math.fitToRange(cr, 0, maxcr);\r\n\t\t\tlet crbr: number = $math.fitToRange(cr, 0, maxcr);\r\n\t\t\tlet crbl: number = $math.fitToRange(cr, 0, maxcr);\r\n\r\n\t\t\t// corner coordinates\r\n\t\t\t// top left\r\n\t\t\tlet xtl = 0;\r\n\t\t\tlet ytl = 0;\r\n\t\t\t// top right\r\n\t\t\tlet xtr = w;\r\n\t\t\tlet ytr = 0;\r\n\t\t\t// bottom right\r\n\t\t\tlet xbr = w;\r\n\t\t\tlet ybr = h;\r\n\t\t\t// bottom left\r\n\t\t\tlet xbl = 0;\r\n\t\t\tlet ybl = h;\r\n\r\n\t\t\tlet lineT;\r\n\t\t\tlet lineR;\r\n\t\t\tlet lineB;\r\n\t\t\tlet lineL;\r\n\r\n\t\t\t// find stem base side: http://$math.stackexchange.com/questions/274712/calculate-on-which-side-of-straign-line-is-dot-located\r\n\t\t\t// d=(x−x1)(y2−y1)−(y−y1)(x2−x1)\r\n\t\t\tlet d1 = (x - xtl) * (ybr - ytl) - (y - ytl) * (xbr - xtl);\r\n\t\t\tlet d2 = (x - xbl) * (ytr - ybl) - (y - ybl) * (xtr - xbl);\r\n\r\n\t\t\t// top\r\n\t\t\tif (d1 > 0 && d2 > 0) {\r\n\t\t\t\tlet stemX = $math.fitToRange(x, crtl + bwh, w - bwh - crtr);\r\n\t\t\t\ty = $math.fitToRange(y, -Infinity, 0);\r\n\t\t\t\tlineT = \"M\" + crtl + \",0 L\" + (stemX - bwh) + \",0 L\" + x + \",\" + y + \" L\" + (stemX + bwh) + \",0 L\" + (w - crtr) + \",0\";\r\n\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlineT = \"M\" + crtl + \",0 L\" + (w - crtr) + \",0\";\r\n\t\t\t}\r\n\t\t\t// bottom\r\n\t\t\tif (d1 < 0 && d2 < 0) {\r\n\t\t\t\tlet stemX = $math.fitToRange(x, crbl + bwh, w - bwh - crbr);\r\n\t\t\t\ty = $math.fitToRange(y, h, Infinity);\r\n\t\t\t\tlineB = \" L\" + (w - crbr) + \",\" + h + \" L\" + (stemX + bwh) + \",\" + h + \" L\" + x + \",\" + y + \" L\" + (stemX - bwh) + \",\" + h + \" L\" + crbl + \",\" + h;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlineB = \" L\" + crbl + \",\" + h;\r\n\t\t\t}\r\n\t\t\t// left\r\n\t\t\tif (d1 < 0 && d2 > 0) {\r\n\t\t\t\tlet stemY = $math.fitToRange(y, crtl + bwh, h - crbl - bwh);\r\n\t\t\t\tx = $math.fitToRange(x, -Infinity, 0);\r\n\t\t\t\tlineL = \" L0,\" + (h - crbl) + \" L0,\" + (stemY + bwh) + \" L\" + x + \",\" + y + \" L0,\" + (stemY - bwh) + \" L0,\" + crtl;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlineL = \" L0,\" + crtl;\r\n\t\t\t}\r\n\t\t\t// right\r\n\t\t\tif (d1 > 0 && d2 < 0) {\r\n\t\t\t\tlet stemY = $math.fitToRange(y, crtr + bwh, h - bwh - crbr);\r\n\t\t\t\tx = $math.fitToRange(x, w, Infinity);\r\n\t\t\t\tlineR = \" L\" + w + \",\" + crtr + \" L\" + w + \",\" + (stemY - bwh) + \" L\" + x + \",\" + y + \" L\" + w + \",\" + (stemY + bwh) + \" L\" + w + \",\" + (h - crbr);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlineR = \" L\" + w + \",\" + (h - crbr);\r\n\t\t\t}\r\n\r\n\t\t\tlet arcTR = \" a\" + crtr + \",\" + crtr + \" 0 0 1 \" + crtr + \",\" + crtr;\r\n\t\t\tlet arcBR = \" a\" + crbr + \",\" + crbr + \" 0 0 1 -\" + crbr + \",\" + crbr;\r\n\t\t\tlet arcBL = \" a\" + crbl + \",\" + crbl + \" 0 0 1 -\" + crbl + \",-\" + crbl;\r\n\t\t\tlet arcTL = \" a\" + crtl + \",\" + crtl + \" 0 0 1 \" + crtl + \",-\" + crtl;\r\n\r\n\t\t\tthis.path = lineT + arcTR + lineR + arcBR + lineB + arcBL + lineL + arcTL;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Radius of rectangle's border in pixels.\r\n\t *\r\n\t * @default 0\r\n\t * @param value  Corner radius (px)\r\n\t */\r\n\tpublic set cornerRadius(value: number) {\r\n\t\tthis.setPropertyValue(\"cornerRadius\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Corner radius (px)\r\n\t */\r\n\tpublic get cornerRadius(): number {\r\n\t\treturn this.getPropertyValue(\"cornerRadius\");\r\n\t}\r\n\r\n}\r\n","/**\r\n * Pointed shape module.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite, ISpriteProperties, ISpriteAdapters, ISpriteEvents } from \"../Sprite\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[PointedShape]].\r\n */\r\nexport interface IPointedShapeProperties extends ISpriteProperties {\r\n\r\n\t/**\r\n\t * A width of the pinter's (stem's) thick end (base) in pixels.\r\n\t *\r\n\t * @default 15\r\n\t */\r\n\tpointerBaseWidth?: number;\r\n\r\n\t/**\r\n\t * A length of the pinter (stem) in pixels.\r\n\t *\r\n\t * @default 10\r\n\t */\r\n\tpointerLength?: number;\r\n\r\n\t/**\r\n\t * X coordinate the shape is pointing to.\r\n\t */\r\n\tpointerX?: number;\r\n\r\n\t/**\r\n\t * Y coordinate the shape is pointing to.\r\n\t */\r\n\tpointerY?: number;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[PointedShape]].\r\n */\r\nexport interface IPointedShapeEvents extends ISpriteEvents { }\r\n\r\n/**\r\n * Defines adapters for [[PointedShape]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IPointedShapeAdapters extends ISpriteAdapters, IPointedShapeProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Draws a shape with a pointer.\r\n *\r\n * @see {@link IPointedShapeEvents} for a list of available events\r\n * @see {@link IPointedShapeAdapters} for a list of available Adapters\r\n */\r\nexport class PointedShape extends Sprite {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IPointedShapeProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IPointedShapeAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IPointedShapeEvents;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"PointedShape\";\r\n\t\tthis.pointerBaseWidth = 15;\r\n\t\tthis.pointerLength = 10;\r\n\t\tthis.pointerY = 0;\r\n\t\tthis.pointerX = 0;\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic draw(): void {\r\n\t\tsuper.draw();\r\n\t\tif (!$type.isNumber(this.pointerX)) {\r\n\t\t\tthis.pointerX = this.pixelWidth / 2;\r\n\t\t}\r\n\t\tif (!$type.isNumber(this.pointerY)) {\r\n\t\t\tthis.pointerY = this.pixelHeight + 10;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A width of the pinter's (stem's) thick end (base) in pixels.\r\n\t *\r\n\t * @default 15\r\n\t * @param value  Width (px)\r\n\t */\r\n\tpublic set pointerBaseWidth(value: number) {\r\n\t\tthis.setPropertyValue(\"pointerBaseWidth\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * A length of the pinter (stem) in pixels.\r\n\t *\r\n\t * @default 10\r\n\t * @param value  Length (px)\r\n\t */\r\n\tpublic set pointerLength(value: number) {\r\n\t\tthis.setPropertyValue(\"pointerLength\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Length (px)\r\n\t */\r\n\tpublic get pointerLength(): number {\r\n\t\treturn this.getPropertyValue(\"pointerLength\");\r\n\t}\r\n\r\n\t/**\r\n\t * @return Width (px)\r\n\t */\r\n\tpublic get pointerBaseWidth(): number {\r\n\t\treturn this.getPropertyValue(\"pointerBaseWidth\");\r\n\t}\r\n\r\n\t/**\r\n\t * X coordinate the shape is pointing to.\r\n\t *\r\n\t * @param value  X\r\n\t */\r\n\tpublic set pointerX(value: number) {\r\n\t\tthis.setPropertyValue(\"pointerX\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return X\r\n\t */\r\n\tpublic get pointerX(): number {\r\n\t\treturn this.getPropertyValue(\"pointerX\");\r\n\t}\r\n\r\n\t/**\r\n\t * Y coordinate the shape is pointing to.\r\n\t *\r\n\t * @param value  Y\r\n\t */\r\n\tpublic set pointerY(value: number) {\r\n\t\tthis.setPropertyValue(\"pointerY\", value, true);\r\n\t}\r\n\r\n\t/**\r\n\t * @return Y\r\n\t */\r\n\tpublic get pointerY(): number {\r\n\t\treturn this.getPropertyValue(\"pointerY\");\r\n\t}\r\n\r\n}\r\n","/**\r\n * Module for a multi-part arched line.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Polyline, IPolylineProperties, IPolylineAdapters, IPolylineEvents } from \"./Polyline\";\r\nimport { IPoint } from \"../../core/defs/IPoint\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $math from \"../../core/utils/Math\";\r\nimport * as $path from \"../../core/rendering/Path\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[Polyarc]].\r\n */\r\nexport interface IPolyarcProperties extends IPolylineProperties {\r\n\r\n\t/**\r\n\t * Relative position along the line the control point is. (0-1)\r\n\t *\r\n\t * @default 0.5\r\n\t */\r\n\tcontrolPointPosition: number;\r\n\r\n\t/**\r\n\t * Relative distance of the control point. (0-1)\r\n\t *\r\n\t * Default is half the length of the line. (0.5)\r\n\t *\r\n\t * @default 0.5\r\n\t */\r\n\tcontrolPointDistance: number;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[Polyarc]].\r\n */\r\nexport interface IPolyarcEvents extends IPolylineEvents { }\r\n\r\n/**\r\n * Defines adapters for [[Polyarc]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IPolyarcAdapters extends IPolylineAdapters, IPolyarcProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Draws a multi-part arched line.\r\n *\r\n * @see {@link IPolyarcEvents} for a list of available events\r\n * @see {@link IPolyarcAdapters} for a list of available Adapters\r\n */\r\nexport class Polyarc extends Polyline {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IPolyarcProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IPolyarcAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IPolyarcEvents;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"Polyarc\";\r\n\r\n\t\tthis.controlPointDistance = 0.5;\r\n\t\tthis.controlPointPosition = 0.5;\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Creats and adds an SVG path for the arc.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic makePath(): void {\r\n\t\tthis._distance = 0;\r\n\t\tlet segments = this.segments;\r\n\r\n\t\tif (segments && segments.length > 0) {\r\n\t\t\tlet path: string = \"\";\r\n\t\t\tthis._realSegments = [];\r\n\r\n\t\t\tfor (let i = 0, len = segments.length; i < len; i++) {\r\n\t\t\t\tlet points: IPoint[] = segments[i];\r\n\t\t\t\tlet realPoints: IPoint[] = [];\r\n\t\t\t\tthis._realSegments.push(realPoints);\r\n\t\t\t\tif (points.length > 0) {\r\n\t\t\t\t\tpath += $path.moveTo(points[0]);\r\n\r\n\t\t\t\t\tfor (let p = 1; p < points.length; p++) {\r\n\t\t\t\t\t\tlet pointA: IPoint = points[p - 1];\r\n\t\t\t\t\t\tlet pointB: IPoint = points[p];\r\n\r\n\t\t\t\t\t\tlet distanceAB: number = $math.getDistance(pointB, pointA);\r\n\t\t\t\t\t\tlet cpDistance: number = distanceAB * this.controlPointDistance;\r\n\t\t\t\t\t\tlet controlPointPosition: number = this.controlPointPosition;\r\n\t\t\t\t\t\tlet angle: number = -$math.getAngle(pointA, pointB);\r\n\r\n\t\t\t\t\t\tlet cpx: number = pointA.x + (pointB.x - pointA.x) * controlPointPosition * 0.5 - cpDistance * $math.sin(angle);\r\n\t\t\t\t\t\tlet cpy: number = pointA.y + (pointB.y - pointA.y) * controlPointPosition * 0.5 - cpDistance * $math.cos(angle);\r\n\t\t\t\t\t\tlet controlPoint1: IPoint = { x: cpx, y: cpy };\r\n\r\n\t\t\t\t\t\tlet cpx2: number = pointA.x + (pointB.x - pointA.x) * controlPointPosition * 1.5 - cpDistance * $math.sin(angle);\r\n\t\t\t\t\t\tlet cpy2: number = pointA.y + (pointB.y - pointA.y) * controlPointPosition * 1.5 - cpDistance * $math.cos(angle);\r\n\t\t\t\t\t\tlet controlPoint2: IPoint = { x: cpx2, y: cpy2 };\r\n\r\n\t\t\t\t\t\tpath += $path.cubicCurveTo(pointB, controlPoint1, controlPoint2);\r\n\r\n\t\t\t\t\t\t// we add a lot of points in order to get the position/angle later\r\n\t\t\t\t\t\tlet stepCount: number = Math.ceil(distanceAB);\r\n\t\t\t\t\t\tlet prevPoint: IPoint = pointA;\r\n\t\t\t\t\t\tif (stepCount > 0) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i <= stepCount; i++) {\r\n\t\t\t\t\t\t\t\tlet point: IPoint = $math.getPointOnCubicCurve(pointA, pointB, controlPoint1, controlPoint2, i / stepCount);\r\n\t\t\t\t\t\t\t\trealPoints.push(point);\r\n\t\t\t\t\t\t\t\tthis._distance += $math.getDistance(prevPoint, point);\r\n\t\t\t\t\t\t\t\tprevPoint = point;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\trealPoints.push(pointA);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.path = path;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Relative position along the line the control point is. (0-1)\r\n\t *\r\n\t * @default 0.5\r\n\t * @param value  Position (0-1)\r\n\t */\r\n\tpublic set controlPointPosition(value: number) {\r\n\t\tthis.setPropertyValue(\"controlPointPosition\", value);\r\n\t\tthis.makePath();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Position (0-1)\r\n\t */\r\n\tpublic get controlPointPosition(): number {\r\n\t\treturn this.getPropertyValue(\"controlPointPosition\");\r\n\t}\r\n\r\n\t/**\r\n\t * Relative distance of the control point. (0-1)\r\n\t *\r\n\t * Default is half the length of the line. (0.5)\r\n\t *\r\n\t * @default 0.5\r\n\t * @param value  Distance (0-1)\r\n\t */\r\n\tpublic set controlPointDistance(value: number) {\r\n\t\tthis.setPropertyValue(\"controlPointDistance\", value);\r\n\t\tthis.makePath();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Distance (0-1)\r\n\t */\r\n\tpublic get controlPointDistance(): number {\r\n\t\treturn this.getPropertyValue(\"controlPointDistance\");\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Polyarc\"] = Polyarc;\r\n","/**\r\n * Polygon module.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Sprite, ISpriteProperties, ISpriteAdapters, ISpriteEvents } from \"../Sprite\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { Morpher } from \"../utils/Morpher\";\r\nimport { IMorphable } from \"../defs/IMorphable\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $path from \"../rendering/Path\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[Polygon]].\r\n */\r\nexport interface IPolygonProperties extends ISpriteProperties {\r\n\r\n\t/**\r\n\t * An array of X/Y coordinates for each elbow of the polygon.\r\n\t */\r\n\tpoints?: Array<Array<Array<IPoint>>>;\r\n\r\n}\r\n\r\n/**\r\n * Defines events for [[Polygon]].\r\n */\r\nexport interface IPolygonEvents extends ISpriteEvents { }\r\n\r\n/**\r\n * Defines adapters for [[Polygon]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IPolygonAdapters extends ISpriteAdapters, IPolygonProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Draws a polygon.\r\n *\r\n * @see {@link IPolygonEvents} for a list of available events\r\n * @see {@link IPolygonAdapters} for a list of available Adapters\r\n */\r\nexport class Polygon extends Sprite implements IMorphable {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IPolygonProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IPolygonAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IPolygonEvents;\r\n\r\n\t/**\r\n\t * A morpher instance that is used to morph polygon into some other shape.\r\n\t */\r\n\tprotected _morpher: $type.Optional<Morpher>;\r\n\r\n\t/**\r\n\t * Current points that morpher uses. This is needed so that we don't\r\n\t * overwrite polygons original points.\r\n\t */\r\n\tprotected _currentPoints: Array<Array<Array<IPoint>>>;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"Polygon\";\r\n\t\tthis.element = this.paper.add(\"path\");\r\n\t\tthis.shapeRendering = \"auto\";\r\n\t\tthis._currentPoints = [];\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * An array of X/Y coordinates for each elbow of the polygon.\r\n\t *\r\n\t * @todo Example\r\n\t * @param points  Polygon points\r\n\t */\r\n\tpublic set points(points: Array<Array<Array<IPoint>>>) {\r\n\t\tthis.setPropertyValue(\"points\", points, true);\r\n\t\tthis._currentPoints = points;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Polygon points\r\n\t */\r\n\tpublic get points(): Array<Array<Array<IPoint>>> {\r\n\t\tlet points = this.getPropertyValue(\"points\");\r\n\t\tlet path = this.path;\r\n\r\n\t\tif (path && (!points || points.length == 0)) {\r\n\r\n\t\t\tlet valueStr = path.slice(1, path.length - 1);\r\n\r\n\t\t\tlet segments: string[] = valueStr.split(\"ZM\");\r\n\r\n\t\t\tfor (let s = 0; s < segments.length; s++) {\r\n\t\t\t\tlet segment = segments[s];\r\n\t\t\t\tif (segment.length > 0) {\r\n\t\t\t\t\tlet areaHole = segment.split(\"M\");\r\n\r\n\t\t\t\t\tlet areaArr = areaHole[0];\r\n\t\t\t\t\tlet holeArr = areaHole[1];\r\n\r\n\t\t\t\t\tif (areaArr && areaArr.length > 0) {\r\n\r\n\t\t\t\t\t\tlet pointsArr = areaArr.split(\"L\");\r\n\t\t\t\t\t\tif (pointsArr.length > 0) {\r\n\r\n\t\t\t\t\t\t\tlet area: IPoint[] = [];\r\n\r\n\t\t\t\t\t\t\tlet areaAndHole: Array<Array<IPoint>> = [area];\r\n\t\t\t\t\t\t\tpoints.push(areaAndHole);\r\n\r\n\t\t\t\t\t\t\tfor (let p = 0; p < pointsArr.length; p++) {\r\n\t\t\t\t\t\t\t\tlet coords = pointsArr[p].split(\",\");\r\n\t\t\t\t\t\t\t\tarea.push({ x: +coords[0], y: +coords[1] });\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (holeArr && holeArr.length > 0) {\r\n\t\t\t\t\t\t\t\tlet pointsArr = holeArr.split(\"L\");\r\n\t\t\t\t\t\t\t\tif (pointsArr.length > 0) {\r\n\t\t\t\t\t\t\t\t\tlet hole: IPoint[] = [];\r\n\t\t\t\t\t\t\t\t\tareaAndHole.push(hole);\r\n\t\t\t\t\t\t\t\t\tfor (let p = pointsArr.length - 1; p >= 0; p--) {\r\n\t\t\t\t\t\t\t\t\t\tlet coords = pointsArr[p].split(\",\");\r\n\t\t\t\t\t\t\t\t\t\thole.push({ x: +coords[0], y: +coords[1] });\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.setPropertyValue(\"points\", points);\r\n\t\t\tthis._currentPoints = points;\r\n\t\t}\r\n\t\treturn points;\r\n\t}\r\n\r\n\t/**\r\n\t * Current points. Used when morphing the element, so that original `points`\r\n\t * are not overwritten.\r\n\t *\r\n\t * @param points  Polygon points\r\n\t */\r\n\tpublic set currentPoints(points: Array<Array<Array<IPoint>>>) {\r\n\t\tif (this._currentPoints != points) {\r\n\t\t\tthis._currentPoints = points;\r\n\t\t\tthis.draw();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Polygon points\r\n\t */\r\n\tpublic get currentPoints(): Array<Array<Array<IPoint>>> {\r\n\t\tif((!this._currentPoints || this._currentPoints.length == 0) && this.path){\r\n\t\t\tthis._currentPoints = this.points;\r\n\t\t}\r\n\t\treturn this._currentPoints;\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic draw(): void {\r\n\t\tlet path: string = \"\";\r\n\t\tlet points: Array<Array<Array<IPoint>>> = this._currentPoints;\r\n\r\n\t\tlet left: $type.Optional<number>;\r\n\t\tlet right: $type.Optional<number>;\r\n\t\tlet top: $type.Optional<number>;\r\n\t\tlet bottom: $type.Optional<number>;\r\n\r\n\t\tif (points.length > 0) {\r\n\t\t\t// separate areas\r\n\t\t\tfor (let i = 0, len = points.length; i < len; i++) {\r\n\t\t\t\t// surface\r\n\t\t\t\tlet surface: IPoint[] = points[i][0];\r\n\t\t\t\tlet hole: IPoint[] = points[i][1];\r\n\r\n\t\t\t\tif (surface && surface.length > 0) {\r\n\t\t\t\t\tlet point: IPoint = surface[0];\r\n\r\n\t\t\t\t\tpath += $path.moveTo(point);\r\n\r\n\t\t\t\t\tfor (let s: number = 0; s < surface.length; s++) {\r\n\t\t\t\t\t\tpoint = surface[s];\r\n\t\t\t\t\t\tpath += $path.lineTo(point);\r\n\r\n\t\t\t\t\t\tif (!$type.isNumber(right) || (right < point.x)) {\r\n\t\t\t\t\t\t\tright = point.x;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!$type.isNumber(left) || (left > point.x)) {\r\n\t\t\t\t\t\t\tleft = point.x;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (!$type.isNumber(top) || (top > point.y)) {\r\n\t\t\t\t\t\t\ttop = point.y;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!$type.isNumber(bottom) || (bottom < point.y)) {\r\n\t\t\t\t\t\t\tbottom = point.y;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// hole\r\n\t\t\t\tif (hole && hole.length > 0) {\r\n\t\t\t\t\tlet point: IPoint = hole[0];\r\n\t\t\t\t\tpath += $path.moveTo(point);\r\n\r\n\t\t\t\t\tfor (let h = 0, hlen = hole.length; h < hlen; h++) {\r\n\t\t\t\t\t\tpoint = hole[h];\r\n\t\t\t\t\t\tpath += $path.lineTo(point);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (path) {\r\n\t\t\t\tpath += $path.closePath();\r\n\t\t\t}\r\n\r\n\t\t\tthis.bbox.x = left;\r\n\t\t\tthis.bbox.y = top;\r\n\t\t\tthis.bbox.width = right - left;\r\n\t\t\tthis.bbox.height = bottom - top;\r\n\r\n\t\t\tsuper.setPath(path);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tprotected setPath(value: string): boolean {\r\n\t\tif (super.setPath(value)) {\r\n\t\t\tthis.points = [];\r\n\t\t\tthis._bbox = this.group.getBBox();\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Measures element\r\n\t */\r\n\tprotected measureElement(): void {\r\n\r\n\t\t// Overriding to avoid extra measurement.\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * A calculated center point for the shape.\r\n\t *\r\n\t * @readonly\r\n\t * @return Center\r\n\t */\r\n\tpublic get centerPoint(): IPoint {\r\n\t\treturn { x: this.bbox.x + this.bbox.width / 2, y: this.bbox.y + this.bbox.height / 2 };\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Morpher]] instance that is used to morph polygon into some other\r\n\t * shape.\r\n\t *\r\n\t * @readonly\r\n\t * @return Morpher instance\r\n\t */\r\n\tpublic get morpher(): Morpher {\r\n\t\tif (!this._morpher) {\r\n\t\t\tthis._morpher = new Morpher(this);\r\n\t\t\tthis._disposers.push(this._morpher);\r\n\t\t}\r\n\t\treturn this._morpher;\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"Polygon\"] = Polygon;\r\n","/**\r\n * Morpher module contains functionality that allows morphing one polygon to\r\n * another.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObject } from \"../Base\";\r\nimport { IPoint } from \"../defs/IPoint\";\r\nimport { IRectangle } from \"../defs/IRectangle\";\r\nimport { IMorphable } from \"../defs/IMorphable\";\r\nimport { IAnimatable, Animation, AnimationDisposer } from \"../utils/Animation\";\r\nimport * as $math from \"../utils/Math\";\r\nimport * as $ease from \"../utils/Ease\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n\r\n/**\r\n * Morpher can be used to morph one polygon to some other polygon.\r\n */\r\nexport class Morpher extends BaseObject implements IAnimatable {\r\n\r\n\t/**\r\n\t * An element that will be a subject for morphing.\r\n\t */\r\n\tpublic morphable: IMorphable;\r\n\r\n\t/**\r\n\t * [_morphFromPointsReal description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _morphFromPointsReal: $type.Optional<Array<Array<Array<IPoint>>>>;\r\n\r\n\t/**\r\n\t * [_morphToPointsReal description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _morphToPointsReal: $type.Optional<Array<Array<Array<IPoint>>>>;\r\n\r\n\t/**\r\n\t * [_morphToPoints description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected _morphToPoints: $type.Optional<Array<Array<Array<IPoint>>>>;\r\n\r\n\t/**\r\n\t * Morph progress (0-1)\r\n\t */\r\n\tprotected _morphProgress: $type.Optional<number>;\r\n\r\n\t/**\r\n\t * List of animations currently running.\r\n\t */\r\n\tprotected _animations: $type.Optional<Array<Animation>>;\r\n\r\n\t/**\r\n\t * A storage for measurements.\r\n\t */\r\n\tprotected _bboxes: IRectangle[] = [];\r\n\r\n\t/**\r\n\t * Duration of the morphing animation in milliseconds.\r\n\t */\r\n\tpublic morphDuration: number = 800;\r\n\r\n\t/**\r\n\t * An easing function to use for morphing animation.\r\n\t *\r\n\t * @see {@link Ease}\r\n\t */\r\n\tpublic morphEasing: (value: number) => number = $ease.cubicOut;\r\n\r\n\t/**\r\n\t * If set to `true`, all separate parts of the multi-part polygon will\r\n\t * morph into a single circle or polygon when using built-in methods\r\n\t * `morphToCircle()` or `morphToPolygon()`.\r\n\t *\r\n\t * Otherwise each separate part of polygon will morph to individual target\r\n\t * circle or polgyon.\r\n\t */\r\n\tpublic morphToSingle: boolean = true;\r\n\r\n\t/**\r\n\t * A ratio to scale morphed object in relation to the source object.\r\n\t */\r\n\tpublic scaleRatio: number = 1;\r\n\r\n\t/**\r\n\t * Constructor.\r\n\t *\r\n\t * @param morphable An object to morph\r\n\t */\r\n\tconstructor(morphable: IMorphable) {\r\n\t\tsuper();\r\n\t\tthis.className = \"Morpher\";\r\n\t\tthis.morphable = morphable;\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Morphs a polygon to another polygon.\r\n\t *\r\n\t * @param toPoints  Corner points of the target shape\r\n\t * @param duration  Duration in milliseconds\r\n\t * @param easing    Easing function\r\n\t * @return Animation\r\n\t */\r\n\tpublic morphToPolygon(toPoints: Array<Array<Array<IPoint>>>, duration?: number, easing?: (value: number) => number): Animation {\r\n\t\tlet points: Array<Array<Array<IPoint>>> = this.morphable.currentPoints;\r\n\t\tif(points && toPoints){\r\n\t\t\tthis.sortPoints(points);\r\n\t\t\tthis.sortPoints(toPoints);\r\n\r\n\t\t\tthis._morphFromPointsReal = [];\r\n\t\t\tthis._morphToPointsReal = [];\r\n\r\n\t\t\tif (!$type.hasValue(duration)) {\r\n\t\t\t\tduration = this.morphDuration;\r\n\t\t\t}\r\n\r\n\t\t\tif (!$type.hasValue(easing)) {\r\n\t\t\t\teasing = this.morphEasing;\r\n\t\t\t}\r\n\r\n\t\t\tthis._morphFromPointsReal = this.normalizePoints(toPoints, points);\r\n\t\t\tthis._morphToPointsReal = this.normalizePoints(points, toPoints);\r\n\r\n\t\t\tthis.morphable.currentPoints = this._morphFromPointsReal;\r\n\r\n\t\t\tlet animation = new Animation(this, { property: \"morphProgress\", from: 0, to: 1 }, duration, easing);\r\n\t\t\tthis._disposers.push(animation);\r\n\t\t\tanimation.start()\r\n\t\t\treturn animation;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [normalizePoints description]\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @todo Description\r\n\t * @param pointsA  Point A\r\n\t * @param pointsB  Point B\r\n\t * @return Normalized points\r\n\t */\r\n\tpublic normalizePoints(pointsA: Array<Array<Array<IPoint>>>, pointsB: Array<Array<Array<IPoint>>>): Array<Array<Array<IPoint>>> {\r\n\t\tfor (let i = 0, len = pointsA.length; i < len; i++) {\r\n\t\t\tlet surfaceA: Array<IPoint> = pointsA[i][0];\r\n\r\n\t\t\tlet holeA: Array<IPoint> = pointsA[i][1];\r\n\t\t\tlet bboxA: IRectangle = $type.getValue($math.getBBox(surfaceA));\r\n\r\n\t\t\tlet middleX = bboxA.x + bboxA.width;\r\n\t\t\tlet middleY = bboxA.y + bboxA.height;\r\n\r\n\t\t\t// check if we have the same in PointsB\r\n\t\t\tif (!pointsB[i]) {\r\n\t\t\t\tpointsB[i] = [];\r\n\t\t\t}\r\n\r\n\t\t\t// check if we have surface in pointsB\r\n\t\t\tif (surfaceA && !pointsB[i][0]) {\r\n\t\t\t\tpointsB[i][0] = [{ x: middleX, y: middleY }, { x: middleX, y: middleY }];\r\n\t\t\t}\r\n\r\n\t\t\tif (pointsB[i][0]) {\r\n\t\t\t\tpointsB[i][0] = this.addPoints(pointsB[i][0], surfaceA.length);\r\n\r\n\t\t\t\tlet distance = Infinity;\r\n\t\t\t\tlet splitAt = 0;\r\n\r\n\t\t\t\tfor (let a = 0; a < pointsB[i][0].length; a++) {\r\n\t\t\t\t\tlet newDistance = $math.getDistance(pointsB[i][0][a], surfaceA[0]);\r\n\t\t\t\t\tif (newDistance < distance) {\r\n\t\t\t\t\t\tsplitAt = a;\r\n\t\t\t\t\t\tdistance = newDistance;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet partA = pointsB[i][0].slice(0, splitAt);\r\n\t\t\t\tlet partB = pointsB[i][0].slice(splitAt);\r\n\t\t\t\tpointsB[i][0] = partB.concat(partA);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (holeA) {\r\n\t\t\t\tif (!pointsB[i][1]) {\r\n\t\t\t\t\tpointsB[i][1] = [{ x: middleX, y: middleY }, { x: middleX, y: middleY }];\r\n\t\t\t\t}\r\n\t\t\t\tpointsB[i][1] = this.addPoints(pointsB[i][1], holeA.length);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn pointsB;\r\n\t}\r\n\r\n\t/**\r\n\t * [sortPoints description]\r\n\t *\r\n\t * @ignore Exclude from doc\r\n\t * @todo Description\r\n\t * @param points  [description]\r\n\t * @return                        common bbox of points\r\n\t */\r\n\tpublic sortPoints(points: Array<Array<Array<IPoint>>>): $type.Optional<IRectangle> {\r\n\t\tpoints.sort(function(a, b) {\r\n\t\t\tlet bbox1: IRectangle = $type.getValue($math.getBBox(a[0]));\r\n\t\t\tlet bbox2: IRectangle = $type.getValue($math.getBBox(b[0]));\r\n\r\n\t\t\tif (bbox1.width * bbox1.height > bbox2.width * bbox2.height) {\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tlet bboxes: IRectangle[] = [];\r\n\t\tfor (let i = 0, len = points.length; i < len; i++) {\r\n\t\t\tlet surface: IPoint[] = points[i][0];\r\n\t\t\tif (surface) {\r\n\t\t\t\tbboxes.push($type.getValue($math.getBBox(surface)));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn $math.getCommonRectangle(bboxes);\r\n\t}\r\n\r\n\t/**\r\n\t * Morphs polygon to a circle (it is actually a polygon which makes a circle).\r\n\t *\r\n\t * @param radius    Target circle radius (px)\r\n\t * @param duration  Duration (ms)\r\n\t * @param easing    Easing function\r\n\t * @return Animation\r\n\t */\r\n\tpublic morphToCircle(radius?: number, duration?: number, easing?: (value: number) => number): Animation {\r\n\t\tlet points: Array<Array<Array<IPoint>>> = this.morphable.points;\r\n\r\n\t\tlet commonBBox = this.sortPoints(points);\r\n\r\n\t\tthis._morphFromPointsReal = [];\r\n\t\tthis._morphToPointsReal = [];\r\n\r\n\t\tif (!$type.hasValue(duration)) {\r\n\t\t\tduration = this.morphDuration;\r\n\t\t}\r\n\r\n\t\tif (!$type.hasValue(easing)) {\r\n\t\t\teasing = this.morphEasing;\r\n\t\t}\r\n\r\n\t\t// surface\r\n\t\tfor (let i = 0, len = points.length; i < len; i++) {\r\n\t\t\tlet surface: IPoint[] = points[i][0];\r\n\t\t\tlet hole: IPoint[] = points[i][1];\r\n\r\n\t\t\tthis._morphFromPointsReal[i] = [];\r\n\t\t\tthis._morphToPointsReal[i] = [];\r\n\r\n\t\t\tif (surface) {\r\n\r\n\t\t\t\tlet toPoints: IPoint[] = surface;\r\n\t\t\t\tlet fromPoints: IPoint[] = surface;\r\n\t\t\t\tlet bbox: IRectangle = $type.getValue($math.getBBox(fromPoints)) // this._bboxes[i];\r\n\r\n\t\t\t\tif (this.morphToSingle) {\r\n\t\t\t\t\tbbox = $type.getValue(commonBBox);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet middleX: number = bbox.x + bbox.width / 2;\r\n\t\t\t\tlet middleY: number = bbox.y + bbox.height / 2;\r\n\t\t\t\tlet realRadius: $type.Optional<number> = radius;\r\n\t\t\t\tif (!$type.isNumber(realRadius)) {\r\n\t\t\t\t\trealRadius = Math.min(bbox.width / 2, bbox.height / 2);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttoPoints = [];\r\n\r\n\t\t\t\t// find angle for the first point\r\n\t\t\t\tlet startAngle: number = $math.getAngle({ x: middleX, y: middleY }, surface[0]);\r\n\t\t\t\tlet count: number = 100;\r\n\r\n\t\t\t\tif (surface.length > count) {\r\n\t\t\t\t\tcount = surface.length;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfromPoints = this.addPoints(surface, count);\r\n\t\t\t\tcount = fromPoints.length; // add Points might increase number a bit\r\n\r\n\t\t\t\tlet angle: number = 360 / (count - 1);\r\n\r\n\t\t\t\tfor (let a: number = 0; a < count; a++) {\r\n\t\t\t\t\tlet realAngle: number = angle * a + startAngle;\r\n\t\t\t\t\tlet pointOnCircle: IPoint = { x: middleX + realRadius * $math.cos(realAngle), y: middleY + realRadius * $math.sin(realAngle) };\r\n\t\t\t\t\ttoPoints[a] = pointOnCircle;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (hole && hole.length > 0) {\r\n\t\t\t\t\tfor (let i = 0, hlen = hole.length; i < hlen; i++) {\r\n\t\t\t\t\t\ttoPoints.push({ x: middleX, y: middleY });\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._morphFromPointsReal[i][0] = fromPoints;\r\n\t\t\t\tthis._morphToPointsReal[i][0] = toPoints;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.morphable.currentPoints = this._morphFromPointsReal;\r\n\r\n\t\tlet animation = new Animation(this, { property: \"morphProgress\", from: 0, to: 1 }, duration, easing);\r\n\t\tthis._disposers.push(animation);\r\n\t\tanimation.start()\r\n\t\treturn animation;\r\n\t}\r\n\r\n\t/**\r\n\t * [addPoints description]\r\n\t *\r\n\t * @ignore Exclude from doc\r\n\t * @todo Description\r\n\t * @param points         [description]\r\n\t * @param mustHaveCount  [description]\r\n\t * @return [description]\r\n\t */\r\n\tpublic addPoints(points: IPoint[], mustHaveCount: number): IPoint[] {\r\n\t\tlet addToSegmentCount: number = Math.round(mustHaveCount / points.length);\r\n\t\tlet newPoints: IPoint[] = [];\r\n\t\tfor (let i = 0, len = points.length; i < len; i++) {\r\n\t\t\tlet point0: IPoint = points[i];\r\n\t\t\tlet point1: IPoint;\r\n\t\t\tif (i == points.length - 1) {\r\n\t\t\t\tpoint1 = points[0];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tpoint1 = points[i + 1];\r\n\t\t\t}\r\n\r\n\t\t\tnewPoints.push(point0);\r\n\r\n\t\t\tfor (let p: number = 1; p < addToSegmentCount; p++) {\r\n\t\t\t\tlet percent: number = p / addToSegmentCount;\r\n\t\t\t\tlet extraPoint: IPoint = { x: point0.x + (point1.x - point0.x) * percent, y: point0.y + (point1.y - point0.y) * percent }\r\n\t\t\t\tnewPoints.push(extraPoint);\r\n\t\t\t}\r\n\r\n\t\t\t// stop adding in case we already added more than left in original\r\n\t\t\tif (newPoints.length + points.length - i == mustHaveCount) {\r\n\t\t\t\taddToSegmentCount = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (newPoints.length < mustHaveCount && points.length > 0) {\r\n\t\t\tlet lastPoint: IPoint = points[points.length - 1];\r\n\t\t\tfor (let p: number = newPoints.length; p < mustHaveCount; p++) {\r\n\t\t\t\t// add same as last\r\n\t\t\t\tnewPoints.push({ x: lastPoint.x, y: lastPoint.y });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn newPoints;\r\n\t}\r\n\r\n\t/**\r\n\t * Morphs polygon into a rectangular polygon.\r\n\t *\r\n\t * @param width     Width of the target rectangle (px)\r\n\t * @param height    Height of the target rectangle (px)\r\n\t * @param duration  Duration (ms)\r\n\t * @param easing    Easing function\r\n\t * @return Animation\r\n\t */\r\n\tpublic morphToRectangle(width?: number, height?: number, duration?: number, easing?: (value: number) => number): Animation {\r\n\t\tlet points: Array<Array<Array<IPoint>>> = this.morphable.points;\r\n\r\n\t\tthis.sortPoints(points);\r\n\r\n\t\tthis._morphFromPointsReal = [];\r\n\t\tthis._morphToPointsReal = [];\r\n\r\n\t\tif (!$type.hasValue(duration)) {\r\n\t\t\tduration = this.morphDuration;\r\n\t\t}\r\n\r\n\t\tif (!$type.hasValue(easing)) {\r\n\t\t\teasing = this.morphEasing;\r\n\t\t}\r\n\r\n\t\t//\t\tlet biggestBBox: IRectangle = this._bboxes[this._biggestIndex];\r\n\r\n\t\t// surface\r\n\t\tfor (let i = 0, len = points.length; i < len; i++) {\r\n\t\t\tlet surface: IPoint[] = points[i][0];\r\n\t\t\tlet hole: IPoint[] = points[i][1];\r\n\r\n\t\t\tthis._morphFromPointsReal[i] = [];\r\n\t\t\tthis._morphToPointsReal[i] = [];\r\n\r\n\t\t\tif (surface) {\r\n\r\n\t\t\t\tlet toPoints: IPoint[] = surface;\r\n\t\t\t\tlet fromPoints: IPoint[] = surface;\r\n\t\t\t\tlet bbox: IRectangle = this._bboxes[i];\r\n\r\n\r\n\t\t\t\t// we only work with first area. TODO: maybe we should find the biggest one?\r\n\t\t\t\tif (this.morphToSingle) {\r\n\t\t\t\t\t//if (i != this._biggestIndex) {\r\n\t\t\t\t\t//\tbbox = { x: biggestBBox.x + biggestBBox.width / 2, y: biggestBBox.y + biggestBBox.height / 2, width: 0, height: 0 };\r\n\t\t\t\t\t//}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet x: number = bbox.x;\r\n\t\t\t\tlet y: number = bbox.y;\r\n\r\n\t\t\t\tlet realWidth: $type.Optional<number> = width;\r\n\t\t\t\tlet realHeight: $type.Optional<number> = height;\r\n\r\n\t\t\t\tif (!$type.isNumber(realWidth)) {\r\n\t\t\t\t\trealWidth = bbox.width;\r\n\t\t\t\t}\r\n\t\t\t\tif (!$type.isNumber(realHeight)) {\r\n\t\t\t\t\trealHeight = bbox.height;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttoPoints = [{ x: x, y: y }, { x: x + realWidth, y: y }, { x: x + realWidth, y: y + realHeight }, { x: x, y: y + realHeight }];\r\n\t\t\t\ttoPoints = this.addPoints(toPoints, surface.length);\r\n\r\n\t\t\t\t// if polygon has less points then count, add\r\n\t\t\t\tif (surface.length < 4) {\r\n\t\t\t\t\tfor (let i = surface.length; i < 4; i++) {\r\n\t\t\t\t\t\ttoPoints.push({ x: surface[i].x, y: surface[i].y });\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (hole && hole.length > 0) {\r\n\t\t\t\t\tlet middleX: number = bbox.x + bbox.width / 2;\r\n\t\t\t\t\tlet middleY: number = bbox.y + bbox.height / 2;\r\n\r\n\t\t\t\t\tfor (let i = 0, hlen = hole.length; i < hlen; i++) {\r\n\t\t\t\t\t\ttoPoints.push({ x: middleX, y: middleY });\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._morphFromPointsReal[i][0] = fromPoints;\r\n\t\t\t\tthis._morphToPointsReal[i][0] = toPoints;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.morphable.currentPoints = this._morphFromPointsReal;\r\n\r\n\t\tlet animation = new Animation(this, { property: \"morphProgress\", from: 0, to: 1 }, duration, easing);\r\n\t\tthis._disposers.push(animation);\r\n\t\tanimation.start()\r\n\t\treturn animation;\r\n\t}\r\n\r\n\t/**\r\n\t * Progress of the morph transition.\r\n\t *\r\n\t * Setting this will also trigger actual transformation.\r\n\t *\r\n\t * @param value  Progress (0-1)\r\n\t */\r\n\tpublic set morphProgress(value: $type.Optional<number>) {\r\n\t\tthis._morphProgress = value;\r\n\r\n\t\tlet currentPoints: Array<Array<Array<IPoint>>> = [];\r\n\r\n\t\tif (value != null) {\r\n\t\t\tlet fromPoints: $type.Optional<Array<Array<Array<IPoint>>>> = this._morphFromPointsReal;\r\n\t\t\tlet toPoints: $type.Optional<Array<Array<Array<IPoint>>>> = this._morphToPointsReal;\r\n\r\n\t\t\tif (fromPoints != null && toPoints != null) {\r\n\r\n\t\t\t\tfor (let i = 0, len = fromPoints.length; i < len; i++) {\r\n\r\n\t\t\t\t\tlet currentArea: Array<Array<IPoint>> = [];\r\n\t\t\t\t\tcurrentPoints.push(currentArea);\r\n\r\n\t\t\t\t\tlet surfaceFrom: IPoint[] = fromPoints[i][0];\r\n\t\t\t\t\tlet holeFrom: IPoint[] = fromPoints[i][1];\r\n\r\n\t\t\t\t\tlet surfaceTo: IPoint[] = toPoints[i][0];\r\n\t\t\t\t\tlet holeTo: IPoint[] = toPoints[i][1];\r\n\r\n\t\t\t\t\tif (surfaceFrom && surfaceFrom.length > 0 && surfaceTo && surfaceTo.length > 0) {\r\n\r\n\t\t\t\t\t\tlet currentSurface: IPoint[] = [];\r\n\r\n\t\t\t\t\t\tfor (let i = 0, slen = surfaceFrom.length; i < slen; i++) {\r\n\t\t\t\t\t\t\tlet point0: IPoint = surfaceFrom[i];\r\n\t\t\t\t\t\t\tlet point1: IPoint = surfaceTo[i];\r\n\r\n\t\t\t\t\t\t\tlet currentPoint: IPoint = { x: point0.x + (point1.x * this.scaleRatio - point0.x) * value, y: point0.y + (point1.y * this.scaleRatio - point0.y) * value }\r\n\r\n\t\t\t\t\t\t\tcurrentSurface.push(currentPoint);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcurrentArea[0] = currentSurface;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (holeFrom && holeFrom.length > 0 && holeTo && holeTo.length > 0) {\r\n\t\t\t\t\t\tlet currentHole: IPoint[] = [];\r\n\t\t\t\t\t\tfor (let i = 0, hlen = holeFrom.length; i < hlen; i++) {\r\n\t\t\t\t\t\t\tlet point0: IPoint = holeFrom[i];\r\n\t\t\t\t\t\t\tlet point1: IPoint = holeTo[i];\r\n\r\n\t\t\t\t\t\t\tlet currentPoint: IPoint = { x: point0.x + (point1.x * this.scaleRatio - point0.x) * value, y: point0.y + (point1.y * this.scaleRatio - point0.y) * value }\r\n\r\n\t\t\t\t\t\t\tcurrentHole.push(currentPoint);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcurrentArea[1] = currentHole;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.morphable.currentPoints = currentPoints;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the progress of morph transition.\r\n\t *\r\n\t * @return Progress (0-1)\r\n\t */\r\n\tpublic get morphProgress(): $type.Optional<number> {\r\n\t\treturn this._morphProgress;\r\n\t}\r\n\r\n\t/**\r\n\t * Restores the polygon to its original appearance.\r\n\t *\r\n\t * @param duration  Duration (ms)\r\n\t * @param easing    Easing function\r\n\t * @return Animation\r\n\t */\r\n\tpublic morphBack(duration?: number, easing?: (value: number) => number): Animation {\r\n\t\tthis._morphToPointsReal = this._morphFromPointsReal;\r\n\t\tthis._morphFromPointsReal = this.morphable.currentPoints;\r\n\r\n\t\tif (!$type.hasValue(duration)) {\r\n\t\t\tduration = this.morphDuration;\r\n\t\t}\r\n\r\n\t\tif (!$type.hasValue(easing)) {\r\n\t\t\teasing = this.morphEasing;\r\n\t\t}\r\n\r\n\t\tlet animation = new Animation(this, { property: \"morphProgress\", from: 0, to: 1 }, duration, easing);\r\n\t\tthis._disposers.push(animation);\r\n\t\tanimation.start()\r\n\t\treturn animation;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a list of morph animations currently being played.\r\n\t *\r\n\t * @return List of animations\r\n\t */\r\n\tpublic get animations(): Array<Animation> {\r\n\t\tif (!this._animations) {\r\n\t\t\tthis._animations = [];\r\n\t\t\tthis._disposers.push(new AnimationDisposer(this._animations));\r\n\t\t}\r\n\t\treturn this._animations;\r\n\t}\r\n\r\n}\r\n","/**\r\n * Resize button module.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Button, IButtonProperties, IButtonAdapters, IButtonEvents } from \"./Button\";\r\nimport { Sprite } from \"../Sprite\";\r\nimport { Orientation } from \"../defs/Orientation\";\r\nimport { InterfaceColorSet } from \"../../core/utils/InterfaceColorSet\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $path from \"../rendering/Path\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines properties for [[ResizeButton]].\r\n */\r\nexport interface IResizeButtonProperties extends IButtonProperties { }\r\n\r\n/**\r\n * Defines events for [[ResizeButton]] for [[ResizeButton]].\r\n */\r\nexport interface IResizeButtonEvents extends IButtonEvents { }\r\n\r\n/**\r\n * Defines adapters for [[ResizeButton]].\r\n *\r\n * @see {@link Adapter}\r\n */\r\nexport interface IResizeButtonAdapters extends IButtonAdapters, IResizeButtonProperties { }\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Creates a draggable resize/grip button.\r\n *\r\n * @see {@link IResizeButtonEvents} for a list of available events\r\n * @see {@link IResizeButtonAdapters} for a list of available Adapters\r\n */\r\nexport class ResizeButton extends Button {\r\n\r\n\t/**\r\n\t * Defines available properties.\r\n\t */\r\n\tpublic _properties!: IResizeButtonProperties;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IResizeButtonAdapters;\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IResizeButtonEvents;\r\n\r\n\t/**\r\n\t * Orientation of the resize direction.\r\n\t *\r\n\t * @deprecated Not used\r\n\t */\r\n\tprotected _orientation: Orientation;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\r\n\t\t// Init\r\n\t\tsuper();\r\n\t\tthis.className = \"ResizeButton\";\r\n\r\n\t\t// Set defaults\r\n\t\tthis.orientation = \"horizontal\";\r\n\t\tthis.layout = \"absolute\";\r\n\t\tthis.horizontalCenter = \"middle\";\r\n\t\tthis.verticalCenter = \"middle\";\r\n\r\n\t\tthis.draggable = true;\r\n\t\tthis.padding(8, 8, 8, 8);\r\n\r\n\t\tthis.background.cornerRadius(20, 20, 20, 20);\r\n\r\n\t\t// Create an icon\r\n\t\tlet icon: Sprite = new Sprite();\r\n\t\ticon.element = this.paper.add(\"path\");\r\n\r\n\t\tlet path = $path.moveTo({ x: -2, y: -6 });\r\n\t\tpath += $path.lineTo({ x: -2, y: 6 });\r\n\t\tpath += $path.moveTo({ x: 2, y: -6 });\r\n\t\tpath += $path.lineTo({ x: 2, y: 6 });\r\n\t\ticon.path = path;\r\n\r\n\t\ticon.pixelPerfect = true;\r\n\t\ticon.padding(0, 4, 0, 4);\r\n\t\ticon.stroke = new InterfaceColorSet().getFor(\"alternativeText\");\r\n\t\ticon.strokeOpacity = 0.7;\r\n\t\t//icon.align = \"center\";\r\n\t\t//icon.valign = \"middle\";\r\n\t\tthis.icon = icon;\r\n\r\n\t\tthis.label.dispose();\r\n\t\tthis.label = undefined;\r\n\r\n\t\t// Apply theme\r\n\t\tthis.applyTheme();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Use for setting of direction (orientation) of the resize button.\r\n\t *\r\n\t * Available options: \"horizontal\", \"vertical\".\r\n\t *\r\n\t * @param value Orientation\r\n\t */\r\n\tpublic set orientation(value: Orientation) {\r\n\t\tlet icon = this.icon;\r\n\t\tif (icon) {\r\n\t\t\tif (value == \"horizontal\") {\r\n\t\t\t\ticon.rotation = 0;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ticon.rotation = -90;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"ResizeButton\"] = ResizeButton;\r\n","/**\r\n * Module for \"Drop Shadow\" filter.\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { Filter, FilterProperties } from \"./Filter\";\r\nimport { AMElement } from \"../AMElement\";\r\nimport { Group } from \"../Group\";\r\nimport { Color, color } from \"../../utils/Color\";\r\nimport { registry } from \"../../Registry\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines additional properties relative to the \"Drop Shadow\" filter\r\n */\r\nexport interface DropShadowFilterProperties extends FilterProperties {\r\n\r\n\t/**\r\n\t * Horizontal offset in pixels.\r\n\t */\r\n\tdx: number;\r\n\r\n\t/**\r\n\t * Vertical offset in pixels.\r\n\t */\r\n\tdy: number;\r\n\r\n\t/**\r\n\t * Blur.\r\n\t */\r\n\tblur: number;\r\n\r\n\t/**\r\n\t * Shadow opacity. (0-1)\r\n\t */\r\n\topacity: number;\r\n\r\n\t/**\r\n\t * Shadow color.\r\n\t */\r\n\tcolor: Color;\r\n\r\n};\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Creats a \"Drop Shadow\" filter.\r\n */\r\nexport class DropShadowFilter extends Filter {\r\n\r\n\t/**\r\n\t * Defines property types.\r\n\t */\r\n\tpublic _properties!: DropShadowFilterProperties;\r\n\r\n\t/**\r\n\t * A storage for Filter property/value pairs.\r\n\t *\r\n\t * @see [@link DropShadowFilterProperties]\r\n\t */\r\n\t//public propertyValues: Dictionary<DropShadowFilterProperties, any>;\r\n\r\n\r\n\t/**\r\n\t * Reference to the `<feGaussianBlur>` element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic feGaussianBlur: AMElement;\r\n\r\n\t/**\r\n\t * Reference to the `<feOffset>` element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic feOffset: AMElement;\r\n\r\n\t/**\r\n\t * Reference to the `<feFlood>` element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic feFlood: AMElement;\r\n\r\n\t/**\r\n\t * Reference to the `<feFlood>` element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic feComposite: AMElement;\r\n\r\n\t/**\r\n\t * Reference to the `<feMerge>` element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic feMerge: Group;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.className = \"DropShadowFilter\";\r\n\r\n\t\t// Create elements\r\n\t\t// NOTE: we do not need to add each individual element to `_disposers`\r\n\t\t// because `filterPrimitives` has an event handler which automatically adds\r\n\t\t// anything added to it to `_disposers`\r\n\r\n\t\tthis.color = color(\"#000\");\r\n\r\n\t\tthis.feGaussianBlur = this.paper.add(\"feGaussianBlur\");\r\n\t\tthis.feGaussianBlur.attr({ \"result\": \"blurOut\", \"in\": \"SourceGraphic\" });\r\n\t\tthis.filterPrimitives.push(this.feGaussianBlur);\r\n\r\n\t\tthis.feOffset = this.paper.add(\"feOffset\");\r\n\t\tthis.feOffset.attr({ \"result\": \"offsetBlur\" });\r\n\t\tthis.filterPrimitives.push(this.feOffset);\r\n\r\n\t\tthis.feFlood = this.paper.add(\"feFlood\");\r\n\t\tthis.feFlood.attr({ \"flood-color\": this.color });\r\n\t\tthis.filterPrimitives.push(this.feFlood);\r\n\r\n\t\tthis.feComposite = this.paper.add(\"feComposite\");\r\n\t\tthis.feComposite.attr({ \"in2\": \"offsetBlur\", operator: \"in\" });\r\n\t\tthis.filterPrimitives.push(this.feComposite);\r\n\r\n\t\tthis.feMerge = this.paper.addGroup(\"feMerge\");\r\n\t\tthis.feMerge.add(this.paper.add(\"feMergeNode\"));\r\n\t\tthis.feMerge.add(this.paper.add(\"feMergeNode\").attr({ \"in\": \"SourceGraphic\" }));\r\n\t\tthis.filterPrimitives.push(this.feMerge);\r\n\r\n\t\t// Set default properties\r\n\t\tthis.width = 200;\r\n\t\tthis.height = 200;\r\n\t\tthis.blur = 1.5;\r\n\t\tthis.dx = 3;\r\n\t\tthis.dy = 3;\r\n\t\tthis.opacity = 0.5;\r\n\r\n\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Shadow color.\r\n\t *\r\n\t * @param value  Color\r\n\t */\r\n\tpublic set color(value: Color) {\r\n\t\tthis.properties.color = value;\r\n\t\tif(this.feFlood){\r\n\t\t\tthis.feFlood.attr({ \"flood-color\": value });\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @return Color\r\n\t */\r\n\tpublic get color(): Color {\r\n\t\treturn this.properties.color;\r\n\t}\r\n\r\n\t/**\r\n\t * Opacity of the shadow. (0-1)\r\n\t *\r\n\t * @param value  Opacity (0-1)\r\n\t */\r\n\tpublic set opacity(value: number) {\r\n\t\tthis.properties.opacity = value;\r\n\t\tthis.feFlood.attr({ \"flood-opacity\": value });\r\n\t}\r\n\r\n\t/**\r\n\t * @return Opacity (0-1)\r\n\t */\r\n\tpublic get opacity(): number {\r\n\t\treturn this.properties.opacity;\r\n\t}\r\n\r\n\t/**\r\n\t * Horizontal offset in pixels.\r\n\t *\r\n\t * @param value  Horizontal offset (px)\r\n\t */\r\n\tpublic set dx(value: number) {\r\n\t\tthis.properties.dx = value;\r\n\t\tthis.feOffset.attr({ \"dx\": value / this.scale });\r\n\t}\r\n\r\n\t/**\r\n\t * @return Horizontal offset (px)\r\n\t */\r\n\tpublic get dx(): number {\r\n\t\treturn this.properties.dx;\r\n\t}\r\n\r\n\t/**\r\n\t * Vertical offset in pixels.\r\n\t *\r\n\t * @param value Vertical offset (px)\r\n\t */\r\n\tpublic set dy(value: number) {\r\n\t\tthis.properties.dy = value;\r\n\t\tthis.feOffset.attr({ \"dy\": value / this.scale });\r\n\t}\r\n\r\n\t/**\r\n\t * @return Vertical offset (px)\r\n\t */\r\n\tpublic get dy(): number {\r\n\t\treturn this.properties.dy;\r\n\t}\r\n\r\n\t/**\r\n\t * Blur.\r\n\t *\r\n\t * @param value  Blur\r\n\t */\r\n\tpublic set blur(value: number) {\r\n\t\tthis.properties.blur = value;\r\n\t\tthis.feGaussianBlur.attr({ \"stdDeviation\": value / this.scale });\r\n\t}\r\n\r\n\t/**\r\n\t * @return Blur\r\n\t */\r\n\tpublic get blur(): number {\r\n\t\treturn this.properties.blur;\r\n\t}\r\n\r\n\t/**\r\n\t * [updateScale description]\r\n\t *\r\n\t * @todo Description\r\n\t */\r\n\tprotected updateScale() {\r\n\t\tthis.dx = this.dx;\r\n\t\tthis.dy = this.dy;\r\n\t\tthis.blur = this.blur;\r\n\t}\r\n\r\n}\r\n\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"DropShadowFilter\"] = DropShadowFilter;\r\n","/**\r\n * This module contains ColorSet object definition\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport { BaseObject } from \"../Base\";\r\nimport { Color, color, iHSL } from \"./Color\";\r\nimport { registry } from \"../Registry\";\r\nimport * as $colors from \"./Colors\";\r\nimport * as $type from \"./Type\";\r\nimport * as $utils from \"./Utils\";\r\nimport * as $math from \"./Math\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Defines an interface for objects identifying a color step.\r\n *\r\n * A \"color step\" object is used when [[ColorSet]] is generating colors, when\r\n * it has ran out of pre-set colors.\r\n *\r\n * It takes the last available color, then applies one or several of the\r\n * properties, like hue, or saturation with each subsequent generated color.\r\n */\r\nexport interface IColorSetStepOptions {\r\n\thue: number;\r\n\tbrighten: number;\r\n\tlighten: number;\r\n\tlightness: number;\r\n\r\n\t/**\r\n\t * @ignore\r\n\t */\r\n\tsaturation: number;\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Represents a set of colors. Can also generate colors according to set rules.\r\n *\r\n * @important\r\n * @see {@link https://www.amcharts.com/docs/v4/concepts/colors/} for color-related info\r\n */\r\nexport class ColorSet extends BaseObject {\r\n\r\n\t/**\r\n\t * Holds the list of the colors in this set. (preset or auto-generated)\r\n\t */\r\n\tprotected _list: Color[] = [];\r\n\r\n\t/**\r\n\t * Current step in a color generator's cycle.\r\n\t */\r\n\tprotected _currentStep: number = 0;\r\n\r\n\t/**\r\n\t * If set to non-zero value, the ColorSet will start iterating colors from\r\n\t * that particular index, not the first color in the list.\r\n\t */\r\n\tprotected _startIndex: number = 0;\r\n\r\n\t/**\r\n\t * Current pass in the color generator's cycle. Normally a generator would\r\n\t * cycle through all available hue range, then repeat it, alternating other\r\n\t * color properties, to generate distinctive colors.\r\n\t */\r\n\tprotected _currentPass: number = 0;\r\n\r\n\t/**\r\n\t * A base color. If there are no colors pre-set in the color list, ColorSet\r\n\t * will use this color as a base when generating new ones, applying\r\n\t * `stepOptions` and `passOptions` to this base color.\r\n\t */\r\n\tpublic baseColor: Color = new Color({\r\n\t\tr: 103,\r\n\t\tg: 183,\r\n\t\tb: 220\r\n\t});\r\n\r\n\t/**\r\n\t * Modifications to apply with each new generated color.\r\n\t */\r\n\tpublic stepOptions: Partial<IColorSetStepOptions> = {};\r\n\r\n\t/**\r\n\t * Modifications to apply on top of `stepOptions` for each \"pass\" of the\r\n\t * color generation.\r\n\t *\r\n\t * A \"pass\" is when ColorSet generates `minColors` number of colors.\r\n\t */\r\n\tpublic passOptions: Partial<IColorSetStepOptions> = {\r\n\t\tbrighten: -0.2\r\n\t};\r\n\r\n\t/**\r\n\t * An index increment to use when iterating through color list.\r\n\t *\r\n\t * Default is 1, which means returning each and every color.\r\n\t *\r\n\t * Setting it to a bigger number will make ColorSet `next()` iterator skip\r\n\t * some colors.\r\n\t *\r\n\t * E.g. setting to 2, will return every second color in the list.\r\n\t *\r\n\t * This is useful, when the color list has colors that are too close each\r\n\t * other for contrast.\r\n\t *\r\n\t * However, having bigger number will mean that `next()` iterator will go\r\n\t * through the list quicker, and the generator will kick sooner.\r\n\t */\r\n\tpublic step: number = 1;\r\n\r\n\t/**\r\n\t * A number of colors to generate in one \"pass\".\r\n\t *\r\n\t * This setting can be automatically overridden, if ColorSet has a list of\r\n\t * pre-set colors. In such case ColorSet will generate exactly the same\r\n\t * number of colors with each pass as there were colors in original set.\r\n\t */\r\n\tpublic minColors: number = 20;\r\n\r\n\t/**\r\n\t * Do not let the \"lightness\" of generated color to fall below this\r\n\t * threshold.\r\n\t */\r\n\tpublic minLightness: number = 0.2;\r\n\r\n\t/**\r\n\t * Do not let the \"lightness\" of generated color to get above this threshold.\r\n\t */\r\n\tpublic maxLightness: number = 0.9;\r\n\r\n\t/**\r\n\t * Randomly shuffle generated colors.\r\n\t */\r\n\tpublic shuffle: boolean = false;\r\n\r\n\t/**\r\n\t * When colors are generated, based on `stepOptions`, each generated color\r\n\t * gets either lighter or darker.\r\n\t *\r\n\t * If this is set to `true`, color generator will switch to opposing spectrum\r\n\t * when reaching `minLightness` or `maxLightness`.\r\n\t *\r\n\t * E.g. if we start off with a red color, then gradually generate lighter\r\n\t * colors through rose shades, then switch back to dark red and gradually\r\n\t * increase the lightness of it until it reaches the starting red.\r\n\t *\r\n\t * If set to `false` it will stop there and cap lightness at whatever level\r\n\t * we hit `minLightness` or `maxLightness`, which may result in a number of\r\n\t * the same colors.\r\n\t */\r\n\tpublic wrap: boolean = true;\r\n\r\n\t/**\r\n\t * Re-use same colors in the pre-set list, when ColorSet runs out of colors,\r\n\t * rather than start generating new ones.\r\n\t */\r\n\tpublic reuse: boolean = false;\r\n\r\n\t/**\r\n\t * Saturation of colors. This will change saturation of all colors of color\r\n\t * set.\r\n\t *\r\n\t * It is recommended to set this in theme, as changing it at run time won't\r\n\t * make the items to redraw and change color.\r\n\t */\r\n\tpublic saturation: number = 1;\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"ColorSet\";\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a list of pre-defined colors to use for the iterator.\r\n\t *\r\n\t * @param value Color list\r\n\t */\r\n\tpublic set list(value: Color[]) {\r\n\t\tthis._list = value;\r\n\t\tthis.reset();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current list of colors.\r\n\t *\r\n\t * If there are none, a new list of colors is generated, based on various\r\n\t * ColorSet settings.\r\n\t *\r\n\t * @return Color list\r\n\t */\r\n\tpublic get list(): Color[] {\r\n\t\tif (!this._list) {\r\n\t\t\tthis.generate(this.minColors);\r\n\t\t}\r\n\t\treturn this._list;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets reusable color.\r\n\t * \r\n\t * @param   index  Index of color\r\n\t * @return         Color\r\n\t */\r\n\tprotected getReusableColor(index: number): Color {\r\n\t\tif (this._list.length == 0) {\r\n\t\t\tthis.generate(1);\r\n\t\t\treturn this.list[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet tmpstep = index - (Math.floor(index / this._list.length) * this.list.length);\r\n\t\t\treturn this.list[tmpstep];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns next color in the list using internal iterator counter.\r\n\t *\r\n\t * If `step` is set to something other than 1, it may return other color than\r\n\t * exact next one in the list.\r\n\t *\r\n\t * @return Color\r\n\t */\r\n\tpublic next(): Color {\r\n\t\tlet color;\r\n\t\tif (this.list.length <= this._currentStep) {\r\n\t\t\tif (this.reuse) {\r\n\t\t\t\tcolor = this.getReusableColor(this._currentStep);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.generate($math.max(this.minColors, this._currentStep + 1));\r\n\t\t\t\tcolor = this.list[this._currentStep];\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcolor = this.list[this._currentStep];\r\n\t\t}\r\n\t\tthis._currentStep += this.step;\r\n\t\treturn color.saturate(this.saturation);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a color at specific index in the list.\r\n\t *\r\n\t * @param i  Index\r\n\t * @return Color\r\n\t */\r\n\tpublic getIndex(i: number): Color {\r\n\t\tlet color;\r\n\t\tif (this.list.length <= i) {\r\n\t\t\tif (this.reuse) {\r\n\t\t\t\tcolor = this.getReusableColor(i);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.generate(this.minColors);\r\n\t\t\t\tcolor = this.getIndex(i);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcolor = this.list[i];\r\n\t\t}\r\n\t\treturn color.saturate(this.saturation);\r\n\t}\r\n\r\n\t/**\r\n\t * Resets internal iterator.\r\n\t *\r\n\t * Calling `next()` after this will return the very first color in the color\r\n\t * list, even if it was already returned before.\r\n\t */\r\n\tpublic reset(): void {\r\n\t\tthis._currentStep = this._startIndex;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets current color iteration. You can use this property to skip some\r\n\t * colors from iteration. E.g. setting it to `10` will skip first ten\r\n\t * colors.\r\n\t *\r\n\t * Please note that the number is zero-based.\r\n\t *\r\n\t * @param value  Step\r\n\t */\r\n\tpublic set currentStep(value: number) {\r\n\t\tthis._currentStep = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @return Step\r\n\t */\r\n\tpublic get currentStep(): number {\r\n\t\treturn this._currentStep;\r\n\t}\r\n\r\n\t/**\r\n\t * If set to non-zero value, the ColorSet will start iterating colors from\r\n\t * that particular index, not the first color in the list.\r\n\t *\r\n\t * @default 0\r\n\t * @since 4.4.9\r\n\t * @param  value  Index\r\n\t */\r\n\tpublic set startIndex(value: number) {\r\n\t\tthis._startIndex = value;\r\n\t\tthis.reset();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Index\r\n\t */\r\n\tpublic get startIndex(): number {\r\n\t\treturn this._startIndex;\r\n\t}\r\n\r\n\t/**\r\n\t * Generates colors based on the various ColorSet settings.\r\n\t *\r\n\t * @param count Number of colors to generate\r\n\t */\r\n\tpublic generate(count: number): void {\r\n\r\n\t\t// Init\r\n\t\tlet curColor = this.currentColor;\r\n\t\tlet hsl = $colors.rgbToHsl($type.getValue(curColor.rgb));\r\n\t\tlet hueStep = $type.hasValue(this.stepOptions.hue) ? this.stepOptions.hue : 1 / count;\r\n\t\tlet mods: IColorSetStepOptions = {\r\n\t\t\tbrighten: 0,\r\n\t\t\tlighten: 0,\r\n\t\t\thue: hsl.h,\r\n\t\t\tlightness: hsl.l,\r\n\t\t\tsaturation: hsl.s\r\n\t\t};\r\n\r\n\t\t// Generate list of hues, and shuffle them\r\n\t\tlet hues: number[] = [];\r\n\t\tconst startIndex = this.list.length == 0 ? 0 : 1;\r\n\t\tif (this.reuse) {\r\n\t\t\tfor (let i = startIndex; i <= count; i++) {\r\n\t\t\t\thues.push($colors.rgbToHsl($type.getValue(this._list[i].rgb)).h);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfor (let i = startIndex; i <= count; i++) {\r\n\t\t\t\tlet h = hsl.h + hueStep * i;\r\n\t\t\t\tif (this.wrap && (h > 1)) {\r\n\t\t\t\t\th -= 1;\r\n\t\t\t\t}\r\n\t\t\t\thues.push(h);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Shuffle colors randomly\r\n\t\tif (this.shuffle) {\r\n\t\t\thues.sort((a: number, b: number) => {\r\n\t\t\t\treturn Math.random() - 0.5;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\r\n\t\t// Generate colors by rotating hue\r\n\t\tfor (let i = 0; i < count; i++) {\r\n\r\n\t\t\t// Update hue\r\n\t\t\tif (this.reuse) {\r\n\t\t\t\thsl = $colors.rgbToHsl($type.getValue(this._list[i].rgb));\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\thsl.h = <number>hues.shift();\r\n\t\t\t}\r\n\r\n\t\t\t// Apply HSL mods\r\n\t\t\tthis.applyStepOptions(hsl, mods, i, this._currentPass);\r\n\r\n\t\t\t// Convert back to Color\r\n\t\t\tlet c = color($colors.hslToRgb(hsl));\r\n\r\n\t\t\t// Apply regular color mods\r\n\t\t\tlet brighten = (this.stepOptions.brighten || 0) * i + (this.passOptions.brighten || 0) * this._currentPass;\r\n\t\t\tif (brighten != 0) {\r\n\t\t\t\tif (this.wrap) {\r\n\t\t\t\t\tbrighten = $utils.fitNumberRelative(brighten, this.minLightness, this.maxLightness);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tbrighten = $utils.fitNumber(brighten, this.minLightness, this.maxLightness);\r\n\t\t\t\t}\r\n\t\t\t\tc = c.brighten(brighten);\r\n\t\t\t}\r\n\r\n\t\t\tlet lighten = (this.stepOptions.lighten || 0) * i + (this.passOptions.lighten || 0) * this._currentPass;\r\n\t\t\tif (lighten != 0) {\r\n\t\t\t\tif (this.wrap) {\r\n\t\t\t\t\tlighten = $utils.fitNumberRelative(lighten, this.minLightness, this.maxLightness);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlighten = $utils.fitNumber(lighten, this.minLightness, this.maxLightness);\r\n\t\t\t\t}\r\n\t\t\t\tc = c.lighten(lighten);\r\n\t\t\t}\r\n\r\n\t\t\tthis._list.push(c);\r\n\t\t}\r\n\r\n\t\tthis._currentPass++;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current last color. It's either the last color in the list of\r\n\t * colors, or `baseColor` if list is empty.\r\n\t *\r\n\t * @return Color\r\n\t */\r\n\tprotected get currentColor(): Color {\r\n\t\tif (this._list.length == 0) {\r\n\t\t\treturn this.baseColor.saturate(this.saturation);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._list[this._list.length - 1].saturate(this.saturation);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Generates modifiers for color, based on what step and pass.\r\n\t *\r\n\t * @param hsl   Curren HSL value of the color to modify\r\n\t * @param base  The modifiers that were before modification to use as a base\r\n\t * @param step  Current step\r\n\t * @param pass  Current pass\r\n\t */\r\n\tprotected applyStepOptions(hsl: iHSL, base: IColorSetStepOptions, step: number, pass: number): void {\r\n\r\n\t\t// Process lightness\r\n\t\thsl.l = base.lightness + (this.stepOptions.lightness || 0) * step + (this.passOptions.lightness || 0) * pass;\r\n\r\n\t\tif (this.wrap) {\r\n\t\t\tif (hsl.l > 1) {\r\n\t\t\t\thsl.l = hsl.l - Math.floor(hsl.l);\r\n\t\t\t}\r\n\t\t\telse if (hsl.l < 0) {\r\n\t\t\t\thsl.l = -(hsl.l - Math.floor(hsl.l));\r\n\t\t\t}\r\n\t\t\thsl.l = $utils.fitNumberRelative(hsl.l, this.minLightness, this.maxLightness);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (hsl.l > 1) {\r\n\t\t\t\thsl.l = 1\r\n\t\t\t}\r\n\t\t\telse if (hsl.l < 0) {\r\n\t\t\t\thsl.l = 0;\r\n\t\t\t}\r\n\t\t\thsl.l = $utils.fitNumber(hsl.l, this.minLightness, this.maxLightness);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Processes JSON-based config before it is applied to the object.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param config  Config\r\n\t */\r\n\tpublic processConfig(config?: { [index: string]: any }): void {\r\n\r\n\t\tif (config) {\r\n\r\n\t\t\t// Cast colors\r\n\t\t\tif ($type.hasValue(config.list) && $type.isArray(config.list)) {\r\n\t\t\t\tfor (let i = 0, len = config.list.length; i < len; i++) {\r\n\t\t\t\t\tif (!(config.list[i] instanceof Color)) {\r\n\t\t\t\t\t\tconfig.list[i] = color(config.list[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif ($type.hasValue(config.baseColor) && !(config.baseColor instanceof Color)) {\r\n\t\t\t\tconfig.baseColor = color(config.baseColor);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tsuper.processConfig(config);\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Register class in system, so that it can be instantiated using its name from\r\n * anywhere.\r\n *\r\n * @ignore\r\n */\r\nregistry.registeredClasses[\"ColorSet\"] = ColorSet;","import { StyleRule } from \"../utils/DOM\";\r\nimport { InterfaceColorSet } from \"../utils/InterfaceColorSet\";\r\nimport { Dictionary } from \"../utils/Dictionary\";\r\nimport { MultiDisposer, IDisposer, CounterDisposer } from \"../utils/Disposer\";\r\n\r\nconst rules = new Dictionary<string, CounterDisposer>();\r\n\r\n/**\r\n * A dynamically-loadable CSS module for Export menu.\r\n *\r\n * @ignore Exclude from docs\r\n * @param prefix  Prefix to addtach to class names\r\n * @return A MultiDisposer with style rules\r\n */\r\nexport default function (element: ShadowRoot | null, prefix?: string): IDisposer {\r\n\tconst newPrefix = (prefix ? prefix : \"amexport\");\r\n\r\n\tlet colorSet = new InterfaceColorSet();\r\n\r\n\tconst counter = rules.insertKeyIfEmpty(newPrefix, () => {\r\n\t\tconst disposer = new MultiDisposer([\r\n\r\n\t\t\t/*new StyleRule(`.${newPrefix}-menu`, {\r\n\t\t\t\t\"opacity\": \"0.3\",\r\n\t\t\t\t\"transition\": \"all 100ms ease-in-out\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(`div:hover .${newPrefix}-menu, .${newPrefix}-menu.active`, {\r\n\t\t\t\t\"opacity\": \"0.9\",\r\n\t\t\t}),*/\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-menu *`, {\r\n\t\t\t\t\"box-sizing\": \"border-box\"\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-menu-level-0`, {\r\n\t\t\t\t\"position\": \"absolute\",\r\n\t\t\t\t\"top\": \"5px\",\r\n\t\t\t\t\"right\": \"5px\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-menu-level-0.${newPrefix}-left`, {\r\n\t\t\t\t\"right\": \"auto\",\r\n\t\t\t\t\"left\": \"5px\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-menu-level-0.${newPrefix}-right`, {\r\n\t\t\t\t\"right\": \"5px\",\r\n\t\t\t\t\"left\": \"auto\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-menu-level-0.${newPrefix}-top`, {\r\n\t\t\t\t\"top\": \"5px\",\r\n\t\t\t\t\"bottom\": \"auto\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-menu-level-0.${newPrefix}-bottom`, {\r\n\t\t\t\t\"top\": \"auto\",\r\n\t\t\t\t\"bottom\": \"5px\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-item.${newPrefix}-item-level-0`, {\r\n\t\t\t\t\"opacity\": \"0.3\",\r\n\t\t\t\t\"width\": \"30px\",\r\n\t\t\t\t\"min-height\": \"30px\",\r\n\t\t\t\t\"transition\": \"all 100ms ease-in-out\",\r\n\t\t\t\t//\"text-indent\": \"-9999px\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `div:hover .${newPrefix}-item.${newPrefix}-item-level-0, .${newPrefix}-item.${newPrefix}-item-level-0.active`, {\r\n\t\t\t\t\"opacity\": \"0.9\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-item.${newPrefix}-item-level-0 > a`, {\r\n\t\t\t\t\"padding\": \"0\",\r\n\t\t\t\t\"text-align\": \"center\",\r\n\t\t\t\t\"overflow\": \"hidden\"\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-item.${newPrefix}-item-level-0:before`, {\r\n\t\t\t\t\"display\": \"block\"\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-item`, {\r\n\t\t\t\t\"position\": \"relative\",\r\n\t\t\t\t\"display\": \"block\",\r\n\t\t\t\t\"opacity\": \"0\",\r\n\t\t\t\t\"z-index\": \"1\",\r\n\t\t\t\t\"border-radius\": \"3px\",\r\n\t\t\t\t\"background-color\": colorSet.getFor(\"secondaryButton\").hex,\r\n\t\t\t\t\"padding\": \"0\",\r\n\t\t\t\t\"margin\": \"1px 1px 0 0\",\r\n\t\t\t\t\"color\": colorSet.getFor(\"secondaryButton\").alternative.hex,\r\n\t\t\t\t\"transition\": \"all 100ms ease-in-out, opacity 0.5s ease 0.5s\",\r\n\t\t\t\t//\"width\": \"initial\",\r\n\t\t\t\t//\"height\": \"initial\",\r\n\t\t\t\t//\"text-indent\": \"initial\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-left .${newPrefix}-item`, {\r\n\t\t\t\t\"margin\": \"1px 0 0 1px\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-item:hover, .${newPrefix}-item.active`, {\r\n\t\t\t\t\"background\": colorSet.getFor(\"secondaryButtonHover\").hex,\r\n\t\t\t\t\"color\": colorSet.getFor(\"secondaryButtonText\").hex,\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-item > .${newPrefix}-menu`, {\r\n\t\t\t\t\"position\": \"absolute\",\r\n\t\t\t\t\"top\": \"-1px\",\r\n\t\t\t\t\"right\": \"0\",\r\n\t\t\t\t\"margin-right\": \"100%\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-left .${newPrefix}-item > .${newPrefix}-menu`, {\r\n\t\t\t\t\"left\": \"0\",\r\n\t\t\t\t\"right\": \"auto\",\r\n\t\t\t\t\"margin-left\": \"100%\",\r\n\t\t\t\t\"margin-right\": \"auto\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-right .${newPrefix}-item > .${newPrefix}-menu`, {\r\n\t\t\t\t\"left\": \"auto\",\r\n\t\t\t\t\"right\": \"0\",\r\n\t\t\t\t\"margin-left\": \"auto\",\r\n\t\t\t\t\"margin-right\": \"100%\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-top .${newPrefix}-item > .${newPrefix}-menu`, {\r\n\t\t\t\t\"top\": \"-1px\",\r\n\t\t\t\t\"bottom\": \"auto\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-bottom .${newPrefix}-item > .${newPrefix}-menu`, {\r\n\t\t\t\t\"top\": \"auto\",\r\n\t\t\t\t\"bottom\": \"0\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-item > .${newPrefix}-menu`, {\r\n\t\t\t\t\"display\": \"none\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-item:hover > .${newPrefix}-menu, .${newPrefix}-item.active > .${newPrefix}-menu`, {\r\n\t\t\t\t\"display\": \"block\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-item:hover > .${newPrefix}-menu > .${newPrefix}-item, .${newPrefix}-item.active > .${newPrefix}-menu > .${newPrefix}-item`, {\r\n\t\t\t\t\"opacity\": \"1\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-menu`, {\r\n\t\t\t\t\"display\": \"block\",\r\n\t\t\t\t\"list-style\": \"none\",\r\n\t\t\t\t\"margin\": \"0\",\r\n\t\t\t\t\"padding\": \"0\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-label`, {\r\n\t\t\t\t\"display\": \"block\",\r\n\t\t\t\t\"cursor\": \"default\",\r\n\t\t\t\t\"padding\": \"0.5em 1em\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-icon`, {\r\n\t\t\t\t\"display\": \"block\",\r\n\t\t\t\t\"cursor\": \"default\",\r\n\t\t\t\t\"padding\": \"0.2em 0.4em\",\r\n\t\t\t\t\"width\": \"1.2em\",\r\n\t\t\t\t\"height\": \"1.2em\",\r\n\t\t\t\t\"min-width\": \"32px\",\r\n\t\t\t\t\"min-height\": \"32px\",\r\n\t\t\t\t\"margin\": \"auto auto\",\r\n\t\t\t\t\"border-radius\": \"3px\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-item-level-0 > .${newPrefix}-icon`, {\r\n\t\t\t\t\"padding\": \"0.1em 0.2em\",\r\n\t\t\t}),\r\n\r\n\t\t\tnew StyleRule(element, `.${newPrefix}-clickable`, {\r\n\t\t\t\t\"cursor\": \"pointer\",\r\n\t\t\t}),\r\n\t\t]);\r\n\r\n\t\treturn new CounterDisposer(() => {\r\n\t\t\trules.removeKey(newPrefix);\r\n\t\t\tdisposer.dispose();\r\n\t\t});\r\n\t});\r\n\r\n\treturn counter.increment();\r\n}\r\n","/**\r\n * ExportMenu provides functionality for building Export menu\r\n */\r\n\r\n/**\r\n * ============================================================================\r\n * IMPORTS\r\n * ============================================================================\r\n * @hidden\r\n */\r\nimport exportCSS from \"./ExportCSS\";\r\nimport { IExportOptions } from \"./Export\";\r\nimport { Adapter } from \"../utils/Adapter\";\r\nimport { List } from \"../utils/List\";\r\nimport { Align } from \"../defs/Align\";\r\nimport { VerticalAlign } from \"../defs/VerticalAlign\";\r\nimport { getInteraction } from \"../interaction/Interaction\";\r\nimport { InteractionObject } from \"../interaction/InteractionObject\";\r\nimport { AMEvent } from \"../utils/EventDispatcher\";\r\nimport { IDisposer, MutableValueDisposer } from \"../utils/Disposer\";\r\nimport { Language, ILocaleProperties } from \"../utils/Language\";\r\nimport { Validatable } from \"../utils/Validatable\";\r\nimport { keyboard, KeyboardKeys } from \"../utils/Keyboard\";\r\nimport { Color } from \"../utils/Color\";\r\nimport * as $utils from \"../utils/Utils\";\r\nimport * as $iter from \"../utils/Iterator\";\r\nimport * as $dom from \"../utils/DOM\";\r\nimport * as $type from \"../utils/Type\";\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * REQUISITES\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Export menu item interface.\r\n */\r\nexport interface IExportMenuItem {\r\n\r\n\t/**\r\n\t * Item type, usually an export format.\r\n\t */\r\n\ttype?: keyof IExportOptions;\r\n\r\n\t/**\r\n\t * Label to display in the menu.\r\n\t */\r\n\tlabel?: string;\r\n\r\n\t/**\r\n\t * Alternative title to be displayed on hover.\r\n\t *\r\n\t * @since 4.9.27\r\n\t */\r\n\ttitle?: string;\r\n\r\n\t/**\r\n\t * A `href` of the image to show instead of a label.\r\n\t */\r\n\ticon?: string;\r\n\r\n\t/**\r\n\t * Raw SVG content to add to instead of regular label.\r\n\t */\r\n\tsvg?: string;\r\n\r\n\t/**\r\n\t * Export format. (optional)\r\n\t */\r\n\tformat?: string;\r\n\r\n\t/**\r\n\t * Menu item options.\r\n\t *\r\n\t * @see {@link IExportOptions}\r\n\t */\r\n\toptions?: IExportOptions[keyof IExportOptions];\r\n\r\n\t/**\r\n\t * Priority.\r\n\t *\r\n\t * The items in Export menu will be sorted by their priority in ascending\r\n\t * order.\r\n\t *\r\n\t * @ignore Exclude from docs (this feature is not yet implemented)\r\n\t */\r\n\tpriority?: number;\r\n\r\n\t/**\r\n\t * An array of [[IExportMenuItem]] items, to construct a sub-menu out of.\r\n\t *\r\n\t * An Export menu can have any number of nesting levels.\r\n\t */\r\n\tmenu?: Array<IExportMenuItem>;\r\n\r\n\t/**\r\n\t * If this is set to true, it means that this specific menu item is not\r\n\t * supported by the current client system.\r\n\t *\r\n\t * This is usually populated by [[Export]]'s `supported` Adapter.\r\n\t *\r\n\t * @see {@link IExportAdapters}\r\n\t */\r\n\tunsupported?: boolean\r\n\r\n\t/**\r\n\t * An [[InteractionObject]] representation of the menu item label.\r\n\t */\r\n\tinteractions?: InteractionObject;\r\n\r\n\t/**\r\n\t * Actual HTML element of the menu item.\r\n\t */\r\n\telement?: HTMLElement;\r\n\r\n\t/**\r\n\t * An element that holds the sub-menu.\r\n\t *\r\n\t * @since 4.10.12\r\n\t */\r\n\tsubmenuElement?: HTMLElement;\r\n\r\n\t/**\r\n\t * Holds list of parent menu items to this item.\r\n\t */\r\n\tascendants?: List<IExportMenuItem>;\r\n\r\n\t/**\r\n\t * Holds timeout reference.\r\n\t *\r\n\t * Used to delay auto-closing of the menu when it is no longer hovered.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tcloseTimeout?: IDisposer;\r\n\r\n\t/**\r\n\t * Should this item be hidden?\r\n\t */\r\n\thidden?: boolean;\r\n\r\n\t/**\r\n\t * A unique id to attach to the menu item.\r\n\t */\r\n\tid?: string;\r\n\r\n\t/**\r\n\t * Color to use as a background.\r\n\t */\r\n\tcolor?: Color;\r\n\r\n}\r\n\r\n/**\r\n * Defines [[ExportMenu]] events.\r\n */\r\nexport interface IExportMenuEvents {\r\n\r\n\t/**\r\n\t * Invoked when menu item is clicked/tapped.\r\n\t */\r\n\thit: {\r\n\t\tbranch: IExportMenuItem;\r\n\t\tevent: MouseEvent | TouchEvent;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when menu item is hovered.\r\n\t */\r\n\tover: {\r\n\t\tbranch: IExportMenuItem;\r\n\t\tevent: MouseEvent | TouchEvent;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when menu item is no longer hovered.\r\n\t */\r\n\tout: {\r\n\t\tbranch: IExportMenuItem;\r\n\t\tevent: MouseEvent | TouchEvent;\r\n\t};\r\n\r\n\t/**\r\n\t * Invoked when ENTER key is pressed when certain menu item is in focus.\r\n\t */\r\n\tenter: {\r\n\t\tbranch: IExportMenuItem;\r\n\t\tevent: KeyboardEvent;\r\n\t}\r\n\r\n\t/**\r\n\t * Invoked when menu branch is selected. (either by hover or keyboard)\r\n\t */\r\n\tbranchselected: {\r\n\t\tbranch: IExportMenuItem;\r\n\t}\r\n\r\n\t/**\r\n\t * Invoked when menu branch is unselected.\r\n\t */\r\n\tbranchunselected: {\r\n\t\tbranch: IExportMenuItem;\r\n\t}\r\n\r\n\t/**\r\n\t * Invoked when menu is closed.\r\n\t */\r\n\tclosed: {};\r\n\r\n}\r\n\r\n/**\r\n * Represents a list of available adapters for Export\r\n */\r\nexport interface IExportMenuAdapters {\r\n\r\n\titems: {\r\n\t\titems: Array<IExportMenuItem>\r\n\t},\r\n\r\n\tmenuElement: {\r\n\t\tmenuElement: HTMLElement\r\n\t},\r\n\r\n\tbranch: {\r\n\t\tbranch: IExportMenuItem,\r\n\t\tlevel: number\r\n\t},\r\n\r\n\trederLabel: {\r\n\t\tlabel: string,\r\n\t\tbranch: IExportMenuItem\r\n\t},\r\n\r\n\tmenuClass: {\r\n\t\tclassName: string,\r\n\t\tlevel: number\r\n\t},\r\n\r\n\titemClass: {\r\n\t\tclassName: string,\r\n\t\tlevel: number,\r\n\t\ttype?: keyof IExportOptions\r\n\t},\r\n\r\n\tlabelClass: {\r\n\t\tclassName: string,\r\n\t\tlevel: number,\r\n\t\ttype?: keyof IExportOptions\r\n\t},\r\n\r\n\tmenuTag: {\r\n\t\ttag: string\r\n\t},\r\n\r\n\titemTag: {\r\n\t\ttag: string\r\n\t},\r\n\r\n\tlabelTag: {\r\n\t\ttag: string\r\n\t},\r\n\r\n\ticonTag: {\r\n\t\ttag: string\r\n\t},\r\n\r\n\talign: {\r\n\t\talign: Align\r\n\t},\r\n\r\n\tverticalAlign: {\r\n\t\tverticalAlign: VerticalAlign\r\n\t},\r\n\r\n\tclassPrefix: {\r\n\t\tclassPrefix: string\r\n\t},\r\n\r\n\tdefaultStyles: {\r\n\t\tdefaultStyles: boolean\r\n\t},\r\n\r\n\ttabindex: {\r\n\t\ttabindex: number\r\n\t},\r\n\r\n\tcloseOnClick: boolean\r\n\r\n}\r\n\r\n\r\n/**\r\n * ============================================================================\r\n * MAIN CLASS\r\n * ============================================================================\r\n * @hidden\r\n */\r\n\r\n/**\r\n * Creates a menu for Export operations.\r\n *\r\n * To add an export menu to a chart, set this to a new instance of\r\n * [[ExportMenu]].\r\n *\r\n * ```TypeScript\r\n * chart.exporting.menu = new am4core.ExportMenu();\r\n * ```\r\n * ```JavaScript\r\n * chart.exporting.menu = new am4core.ExportMenu();\r\n * ```\r\n * ```JSON\r\n * {\r\n *   // ...\r\n *   \"exporting\": {\r\n *     \"menu\": {}\r\n *   }\r\n * }\r\n * ```\r\n * @important\r\n */\r\nexport class ExportMenu extends Validatable {\r\n\r\n\t/**\r\n\t * Defines available events.\r\n\t */\r\n\tpublic _events!: IExportMenuEvents;\r\n\r\n\t/**\r\n\t * Defines available adapters.\r\n\t */\r\n\tpublic _adapter!: IExportMenuAdapters;\r\n\r\n\t/**\r\n\t * An [[Adapter]].\r\n\t */\r\n\tpublic adapter: Adapter<ExportMenu, IExportMenuAdapters> = new Adapter<ExportMenu, IExportMenuAdapters>(this);\r\n\r\n\t/**\r\n\t * How many milliseconds to hold menu/sub-menu open after it loses focus or\r\n\t * hover, before auto-closing it.\r\n\t *\r\n\t * @default 1000\r\n\t */\r\n\tpublic closeDelay: number = 1000;\r\n\r\n\t/**\r\n\t * Close the menu automatically when some export operation is triggered.\r\n\t *\r\n\t * @default true\r\n\t * @since 4.2.2\r\n\t */\r\n\tpublic closeOnClick: boolean = true;\r\n\r\n\t/**\r\n\t * An instance of [[Language]].\r\n\t */\r\n\tprotected _language = new MutableValueDisposer<Language>();\r\n\r\n\t/**\r\n\t * Reference to DOM element that holds Export menu.\r\n\t */\r\n\tprotected _container: $type.Optional<HTMLElement>;\r\n\r\n\t/**\r\n\t * Menu element.\r\n\t */\r\n\tprotected _element: $type.Optional<HTMLElement>;\r\n\r\n\t/**\r\n\t * Currently selected menu item.\r\n\t */\r\n\tprotected _currentSelection: $type.Optional<IExportMenuItem>;\r\n\r\n\t/**\r\n\t * What HTML tags to use to build menu.\r\n\t */\r\n\tprotected _menuTag: \"ul\" | \"div\" = \"ul\";\r\n\r\n\t/**\r\n\t * Which tag to use to enclose individual menu items.\r\n\t */\r\n\tprotected _itemTag: \"li\" | \"div\" = \"li\";\r\n\r\n\t/**\r\n\t * Tag to wrap menu item labels in.\r\n\t */\r\n\tprotected _labelTag: \"a\" = \"a\";\r\n\r\n\t/**\r\n\t * Tag to use for icons\r\n\t */\r\n\tprotected _iconTag: \"img\" = \"img\";\r\n\r\n\t/**\r\n\t * Prefix for class names applied to menu elements.\r\n\t */\r\n\tprotected _classPrefix: string = \"amexport\";\r\n\r\n\t/**\r\n\t * If set to `true` [[ExportMenu]] will load it's own external CSS when\r\n\t * instantiated.\r\n\t */\r\n\tprotected _defaultStyles: boolean = true;\r\n\r\n\t/**\r\n\t * Horizontal positioning.\r\n\t */\r\n\tprotected _align: Align = \"right\";\r\n\r\n\t/**\r\n\t * Vertical positioning.\r\n\t */\r\n\tprotected _verticalAlign: VerticalAlign = \"top\";\r\n\r\n\t/**\r\n\t * A tabindex to apply to Export Menu.\r\n\t */\r\n\tprotected _tabindex: number = 0;\r\n\r\n\t/**\r\n\t * Whether next menu close event should be ignored.\r\n\t */\r\n\tprotected _ignoreNextClose: boolean = false;\r\n\r\n\t/**\r\n\t * Default menu items.\r\n\t */\r\n\tprotected _items: Array<IExportMenuItem> = [\r\n\t\t{\r\n\t\t\t\"label\": \"...\",\r\n\t\t\t\"menu\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"label\": \"Image\",\r\n\t\t\t\t\t\"menu\": [\r\n\t\t\t\t\t\t{ \"type\": \"png\", \"label\": \"PNG\" },\r\n\t\t\t\t\t\t{ \"type\": \"jpg\", \"label\": \"JPG\" },\r\n\t\t\t\t\t\t{ \"type\": \"svg\", \"label\": \"SVG\" },\r\n\t\t\t\t\t\t{ \"type\": \"pdf\", \"label\": \"PDF\" }\r\n\t\t\t\t\t]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"label\": \"Data\",\r\n\t\t\t\t\t\"menu\": [\r\n\t\t\t\t\t\t{ \"type\": \"json\", \"label\": \"JSON\" },\r\n\t\t\t\t\t\t{ \"type\": \"csv\", \"label\": \"CSV\" },\r\n\t\t\t\t\t\t{ \"type\": \"xlsx\", \"label\": \"XLSX\" },\r\n\t\t\t\t\t\t{ \"type\": \"html\", \"label\": \"HTML\" },\r\n\t\t\t\t\t\t{ \"type\": \"pdfdata\", \"label\": \"PDF\" }\r\n\t\t\t\t\t]\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"label\": \"Print\", \"type\": \"print\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t];\r\n\r\n\t/**\r\n\t * Constructor\r\n\t */\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.className = \"ExportMenu\";\r\n\t\tthis._disposers.push(this._language);\r\n\t\tthis.invalidate();\r\n\t\tthis.applyTheme();\r\n\t}\r\n\r\n\t/**\r\n\t * (Re)draws the Export menu.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic validate(): void {\r\n\t\tthis.draw();\r\n\t\tsuper.validate();\r\n\t}\r\n\r\n\t/**\r\n\t * Draws the menu based on current items.\r\n\t *\r\n\t * Normally, there's no need to call this explicitly. The chart, if it has\r\n\t * export menu enabled, will automatically draw the menu.\r\n\t */\r\n\tpublic draw(): void {\r\n\r\n\t\t// Create top-level menu item, or clear it\r\n\t\tif (!this._element) {\r\n\t\t\tthis._element = this.createMenuElement(0);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._element.innerHTML = \"\";\r\n\t\t\tthis._element.className = this.getMenuItemClass(0);\r\n\t\t}\r\n\r\n\t\t// See if we're loading external CSS\r\n\t\t// Hide it until CSS is loaded\r\n\t\tif (this.defaultStyles) {\r\n\t\t\tthis._element.style.display = \"none\";\r\n\t\t}\r\n\r\n\t\t// Append to container\r\n\t\t$type.getValue(this._container).appendChild(this._element);\r\n\r\n\t\t// Apply adapter to menu items before processing\r\n\t\tlet items = this.adapter.apply(\"items\", {\r\n\t\t\titems: this._items\r\n\t\t}).items;\r\n\r\n\t\tfor (let len = items.length, i = 0; i < len; i++) {\r\n\t\t\tthis.drawBranch(this._element, items[i], 0);\r\n\t\t}\r\n\r\n\t\t// Apply adapter to finalized menu element\r\n\t\tthis._element = this.adapter.apply(\"menuElement\", {\r\n\t\t\tmenuElement: this._element\r\n\t\t}).menuElement;\r\n\r\n\t\t// Set up global \"down\" event\r\n\t\tthis._disposers.push(getInteraction().body.events.on(\"down\", (ev) => {\r\n\t\t\tif (!ev.pointer.touch) {\r\n\t\t\t\tthis._ignoreNextClose = false;\r\n\t\t\t}\r\n\t\t\tthis.close();\r\n\t\t}));\r\n\r\n\t\t// Set up global event on ESC press to close the menu\r\n\t\tthis._disposers.push(getInteraction().body.events.on(\"keydown\", (ev) => {\r\n\t\t\tlet key = keyboard.getEventKey(ev.event);\r\n\t\t\tswitch (key) {\r\n\t\t\t\tcase \"esc\":\r\n\t\t\t\t\tthis.close();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"up\":\r\n\t\t\t\tcase \"down\":\r\n\t\t\t\tcase \"left\":\r\n\t\t\t\tcase \"right\":\r\n\t\t\t\t\tif (this._currentSelection) {\r\n\t\t\t\t\t\tev.event.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.moveSelection(key);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tif (this.defaultStyles) {\r\n\t\t\tthis.loadDefaultCSS();\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new branch in export menu. This function is recursive for\r\n\t * building multi-level menus.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param container Container to put branch elements in\r\n\t * @param branch    Menu item\r\n\t * @param level     Current nesting level\r\n\t */\r\n\tprotected drawBranch(container: HTMLElement, branch: IExportMenuItem, level: number): void {\r\n\r\n\t\t// Apply adapter\r\n\t\tbranch = this.adapter.apply(\"branch\", {\r\n\t\t\tbranch: branch,\r\n\t\t\tlevel: level\r\n\t\t}).branch;\r\n\r\n\t\t// Unsupported?\r\n\t\t// ExportMenu does not check or know for specific browser/system\r\n\t\t// capabilities. It must happen in some other code and applied via Adapter.\r\n\t\t// Export itself will check compatibility, but there might be other plugins\r\n\t\t// that influence it or even add any specific export functionality.\r\n\t\tif (branch.unsupported === true) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Init ascendants\r\n\t\tif (!branch.ascendants) {\r\n\t\t\tbranch.ascendants = new List<IExportMenuItem>();\r\n\t\t}\r\n\r\n\t\t// Get type\r\n\t\tlet type: keyof IExportOptions | undefined | null = branch.type;\r\n\r\n\t\t// Create an item\r\n\t\tlet element = this.createItemElement(level, type);\r\n\r\n\t\t// Create label\r\n\t\tlet label;\r\n\r\n\t\t// Create icon\r\n\t\tif (branch.icon) {\r\n\t\t\tlabel = this.createIconElement(level, type);\r\n\t\t\t(<HTMLImageElement>label).src = branch.icon;\r\n\t\t\tif (branch.label || branch.title) {\r\n\t\t\t\t(<HTMLImageElement>label).title = branch.title || branch.label;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (branch.svg) {\r\n\t\t\tlabel = this.createSvgElement(level, type, branch.svg);\r\n\t\t\tif (branch.label || branch.title) {\r\n\t\t\t\t(<HTMLElement>label).title = branch.title || branch.label;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlabel = this.createLabelElement(level, type);\r\n\t\t\tlabel.innerHTML = (branch.label ? this.language.translate(<keyof ILocaleProperties>branch.label) : \"\");\r\n\t\t\tif (branch.title) {\r\n\t\t\t\t(<HTMLElement>label).title = branch.title;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Apply reader text to label\r\n\t\tlet readerLabel = this.getReaderLabel(branch, label.innerHTML);\r\n\t\tlabel.setAttribute(\"aria-label\", readerLabel);\r\n\r\n\t\t// Add Label\r\n\t\telement.appendChild(label);\r\n\r\n\t\t// Create interaction object\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions = getInteraction().getInteraction(element);\r\n\t\tbranch.element = element;\r\n\r\n\t\t// Create interaction manager we can set event listeners to\r\n\t\tif (this.typeClickable(type)) {\r\n\t\t\t//branch.interactions.clickable = true;\r\n\t\t\t// TODO clean this up when it's disposed\r\n\t\t\tbranch.interactions.events.on(\"hit\", (ev) => {\r\n\t\t\t\tif (this.events.isEnabled(\"hit\") && !this.isDisposed()) {\r\n\t\t\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"hit\"] = {\r\n\t\t\t\t\t\t\"type\": \"hit\",\r\n\t\t\t\t\t\t\"event\": ev.event,\r\n\t\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\t\"branch\": branch\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.events.dispatchImmediately(\"hit\", event);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// TODO clean this up when it's disposed\r\n\t\t\tbranch.interactions.events.on(\"keyup\", (ev) => {\r\n\t\t\t\tif (keyboard.isKey(ev.event, \"enter\")) {\r\n\t\t\t\t\tif (this.events.isEnabled(\"enter\")) {\r\n\t\t\t\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"enter\"] = {\r\n\t\t\t\t\t\t\t\"type\": \"enter\",\r\n\t\t\t\t\t\t\t\"event\": ev.event,\r\n\t\t\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\t\t\"branch\": branch\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.events.dispatchImmediately(\"enter\", event);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t{\r\n\t\t\tconst submenu = this.getSubMenu(branch);\r\n\r\n\t\t\t// Add ENTER event to open sub-menus\r\n\t\t\tif (submenu != null) {\r\n\t\t\t\t// TODO clean this up when it's disposed\r\n\t\t\t\tbranch.interactions.events.on(\"keyup\", (ev) => {\r\n\t\t\t\t\tif (keyboard.isKey(ev.event, \"enter\")) {\r\n\t\t\t\t\t\t// This is item has sub-menu, activate the first child on ENTER\r\n\t\t\t\t\t\tthis.selectBranch(submenu[0]);\r\n\r\n\t\t\t\t\t\t// Attempt to set focus\r\n\t\t\t\t\t\tthis.setFocus(submenu[0]);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbranch.interactions.events.on(\"hit\", (ev) => {\r\n\t\t\t\t\tthis.selectBranch(branch);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Add events\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions.events.on(\"over\", (ev) => {\r\n\r\n\t\t\tif (ev.pointer.touch) {\r\n\t\t\t\t// Cancel pending menu closure\r\n\t\t\t\tthis._ignoreNextClose = true;\r\n\t\t\t}\r\n\r\n\t\t\tthis.selectBranch(branch);\r\n\r\n\t\t\tif (this.events.isEnabled(\"over\")) {\r\n\t\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"over\"] = {\r\n\t\t\t\t\t\"type\": \"over\",\r\n\t\t\t\t\t\"event\": ev.event,\r\n\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\"branch\": branch\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"over\", event);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions.events.on(\"out\", (ev) => {\r\n\t\t\tif (this.isDisposed()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!ev.pointer.touch) {\r\n\t\t\t\tthis.delayUnselectBranch(branch);\r\n\t\t\t}\r\n\t\t\tif (this.events.isEnabled(\"out\")) {\r\n\t\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"out\"] = {\r\n\t\t\t\t\t\"type\": \"out\",\r\n\t\t\t\t\t\"event\": ev.event,\r\n\t\t\t\t\t\"target\": this,\r\n\t\t\t\t\t\"branch\": branch\r\n\t\t\t\t};\r\n\t\t\t\tthis.events.dispatchImmediately(\"out\", event);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions.events.on(\"focus\", (ev) => {\r\n\t\t\tthis.selectBranch(branch);\r\n\t\t});\r\n\r\n\t\t// TODO clean this up when it's disposed\r\n\t\tbranch.interactions.events.on(\"blur\", (ev) => {\r\n\t\t\tthis.delayUnselectBranch(branch);\r\n\t\t});\r\n\r\n\t\t// Increment level\r\n\t\tlet local_level = level + 1;\r\n\r\n\t\t// Has sub-menu?\r\n\t\tif (branch.menu) {\r\n\t\t\tlet submenu = this.createMenuElement(local_level);\r\n\t\t\tbranch.submenuElement = submenu;\r\n\t\t\tfor (let len = branch.menu.length, i = 0; i < len; i++) {\r\n\t\t\t\tlet ascendants = new List<IExportMenuItem>();\r\n\t\t\t\tbranch.menu[i].ascendants = ascendants;\r\n\t\t\t\tif (branch.ascendants.length) {\r\n\t\t\t\t\tascendants.copyFrom(branch.ascendants);\r\n\t\t\t\t}\r\n\t\t\t\tascendants.push(branch);\r\n\t\t\t\tthis.drawBranch(submenu, branch.menu[i], local_level);\r\n\t\t\t}\r\n\r\n\t\t\t// Sub-menu is empty (all items are not supported)\r\n\t\t\t// Do not draw this menu item at all\r\n\t\t\tif (submenu.innerHTML == \"\") {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telement.appendChild(submenu);\r\n\t\t}\r\n\r\n\t\t// Should this item be hidden?\r\n\t\tif (branch.hidden) {\r\n\t\t\tthis.hideBranch(branch);\r\n\t\t}\r\n\r\n\t\t// Add id?\r\n\t\tif (branch.id) {\r\n\t\t\telement.setAttribute(\"id\", branch.id);\r\n\t\t}\r\n\r\n\t\t// Background color?\r\n\t\tif (branch.color) {\r\n\t\t\telement.style.backgroundColor = branch.color.hex;\r\n\t\t}\r\n\r\n\t\t// Append to container\r\n\t\tcontainer.appendChild(element);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a menu element to hold its elements in. Usually it's an `<ul>`\r\n\t * tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @return HTML element reference\r\n\t */\r\n\tpublic createMenuElement(level: number): HTMLElement {\r\n\t\tlet element: HTMLElement = document.createElement(this.menuTag);\r\n\t\telement.className = this.getMenuItemClass(level);\r\n\r\n\t\t// Accessibility\r\n\t\tif (level === 0) {\r\n\t\t\telement.setAttribute(\"role\", \"menubar\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\telement.setAttribute(\"role\", \"menu\");\r\n\t\t}\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Generates a class name for the menu element based on its nesting level.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @return Class name(s)\r\n\t */\r\n\tpublic getMenuItemClass(level: number): string {\r\n\t\tlet className = this.classPrefix + \"-menu \" + this.classPrefix + \"-menu-level-\" + level;\r\n\t\tif (level === 0) {\r\n\t\t\tclassName += \" \" + this.classPrefix + \"-menu-root \" +\r\n\t\t\t\tthis.classPrefix + \"-\" + this.align + \" \" +\r\n\t\t\t\tthis.classPrefix + \"-\" + this.verticalAlign;\r\n\t\t}\r\n\t\treturn this.adapter.apply(\"menuClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level\r\n\t\t}).className;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates menu item. Usually `<li>` tag. Its label and sub-elements will go\r\n\t * into this element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @param type   Type of the menu item\r\n\t * @return HTML element reference\r\n\t */\r\n\tpublic createItemElement(level: number, type?: keyof IExportOptions): HTMLElement {\r\n\t\tlet element: HTMLElement = document.createElement(this.itemTag);\r\n\t\tlet className = this.classPrefix + \"-item \" + this.classPrefix\r\n\t\t\t+ \"-item-level-\" + level\r\n\t\t\t+ \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\r\n\t\telement.className = this.adapter.apply(\"itemClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level,\r\n\t\t\ttype: type\r\n\t\t}).className;\r\n\t\telement.setAttribute(\"role\", \"menuitem\");\r\n\t\telement.setAttribute(\"tabindex\", this.tabindex.toString());\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a \"label\" part of the menu item. It could be text or any HTML\r\n\t * content.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @param type   Type of the menu item\r\n\t * @return An HTML Element\r\n\t */\r\n\tpublic createLabelElement(level: number, type?: keyof IExportOptions): HTMLElement {\r\n\t\tlet element: HTMLElement = document.createElement(this.labelTag);\r\n\t\tlet className = this.classPrefix + \"-label \" + this.classPrefix\r\n\t\t\t+ \"-label-level-\" + level\r\n\t\t\t+ \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\r\n\t\tif (this.typeClickable(type)) {\r\n\t\t\tclassName += \" \" + this.classPrefix + \"-clickable\";\r\n\t\t}\r\n\t\telement.className = this.adapter.apply(\"labelClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level,\r\n\t\t\ttype: type\r\n\t\t}).className;\r\n\r\n\t\t// Accessible navigation\r\n\t\t//element.setAttribute(\"tabindex\", this.tabindex.toString());\r\n\t\t//element.setAttribute(\"role\", \"menuitem\");\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a \"icon\" part of the menu item.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @param type   Type of the menu item\r\n\t * @return An HTML Element\r\n\t */\r\n\tpublic createIconElement(level: number, type?: keyof IExportOptions): HTMLElement {\r\n\t\tlet element: HTMLElement = document.createElement(this.iconTag);\r\n\t\tlet className = this.classPrefix + \"-icon \" + this.classPrefix\r\n\t\t\t+ \"-icon-level-\" + level\r\n\t\t\t+ \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\r\n\t\tif (this.typeClickable(type)) {\r\n\t\t\tclassName += \" \" + this.classPrefix + \"-clickable\";\r\n\t\t}\r\n\t\telement.className = this.adapter.apply(\"labelClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level,\r\n\t\t\ttype: type\r\n\t\t}).className;\r\n\r\n\t\t// Accessible navigation\r\n\t\telement.setAttribute(\"tabindex\", this.tabindex.toString());\r\n\t\telement.setAttribute(\"role\", \"menuitem\");\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a a custom element out of raw HTML.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param level  Current nesting level\r\n\t * @param type   Type of the menu item\r\n\t * @return An HTML Element\r\n\t */\r\n\tpublic createSvgElement(level: number, type?: keyof IExportOptions, svg?: string): HTMLElement {\r\n\t\tlet parser = new DOMParser();\r\n\t\tlet element = parser.parseFromString(svg, \"image/svg+xml\").documentElement;\r\n\t\tlet className = this.classPrefix + \"-icon \" + this.classPrefix\r\n\t\t\t+ \"-icon-level-\" + level\r\n\t\t\t+ \" \" + this.classPrefix + \"-item-\" + (type || \"blank\");\r\n\t\tif (this.typeClickable(type)) {\r\n\t\t\tclassName += \" \" + this.classPrefix + \"-clickable\";\r\n\t\t}\r\n\t\telement.setAttribute(\"class\", this.adapter.apply(\"labelClass\", {\r\n\t\t\tclassName: className,\r\n\t\t\tlevel: level,\r\n\t\t\ttype: type\r\n\t\t}).className);\r\n\r\n\t\t// Accessible navigation\r\n\t\telement.setAttribute(\"tabindex\", this.tabindex.toString());\r\n\t\telement.setAttribute(\"role\", \"menuitem\");\r\n\t\treturn element;\r\n\t}\r\n\r\n\t/**\r\n\t * Destroys the menu and all its elements.\r\n\t */\r\n\tpublic dispose(): void {\r\n\t\tif (!this._disposed) {\r\n\t\t\tsuper.dispose();\r\n\r\n\t\t\tif (this._element && this._element.parentNode) {\r\n\t\t\t\tthis._element.parentNode.removeChild(this._element);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether menu item type is supposed to be clickable.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param type  Menu item type\r\n\t * @return Is clickable?\r\n\t */\r\n\tpublic typeClickable(type: keyof IExportOptions | undefined | null): type is keyof IExportOptions {\r\n\t\treturn $type.hasValue(type);\r\n\t}\r\n\r\n\t/**\r\n\t * Checks whether menu item has any sub-items.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  A menu item\r\n\t * @return Has sub-items?\r\n\t */\r\n\tpublic hasSubMenu(branch: IExportMenuItem): boolean {\r\n\t\treturn (branch.menu && branch.menu.length) ? true : false;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns sub-items (if they exist).\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  A menu item\r\n\t * @return Submenus\r\n\t */\r\n\tpublic getSubMenu(branch: IExportMenuItem): $type.Optional<Array<IExportMenuItem>> {\r\n\t\tif (branch.menu && branch.menu.length) {\r\n\t\t\treturn branch.menu;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Generates and returns an applicable label to be used for screen readers.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param item   A menu item instance\r\n\t * @param label  Current label\r\n\t * @return Reader text\r\n\t */\r\n\tpublic getReaderLabel(branch: IExportMenuItem, label: string): string {\r\n\r\n\t\t// Strip any HTML from the label\r\n\t\tlabel = $utils.stripTags(label);\r\n\r\n\t\t// Add textual note if the branch is clickable\r\n\t\tif (branch.ascendants.length == 0) {\r\n\t\t\tlabel = label == \"...\" ? this.language.translate(\"Export\") : label;\r\n\t\t\tlabel += \" [\" + this.language.translate(\"Press ENTER or use arrow keys to navigate\") + \"]\";\r\n\t\t}\r\n\t\telse if (this.hasSubMenu(branch)) {\r\n\t\t\tlabel += \" [\" + this.language.translate(\"Click, tap or press ENTER to open\") + \"]\";\r\n\t\t}\r\n\t\telse if (branch.type == \"print\") {\r\n\t\t\tlabel = this.language.translate(\"Click, tap or press ENTER to print.\");\r\n\t\t}\r\n\t\telse if (this.typeClickable(branch.type)) {\r\n\t\t\tlabel = this.language.translate(\"Click, tap or press ENTER to export as %1.\", undefined, label);\r\n\t\t}\r\n\r\n\t\treturn this.adapter.apply(\"rederLabel\", {\r\n\t\t\tlabel: label,\r\n\t\t\tbranch: branch\r\n\t\t}).label;\r\n\t}\r\n\r\n\t/**\r\n\t * Getters and setters\r\n\t */\r\n\r\n\t/**\r\n\t * An HTML container to place the Menu in.\r\n\t *\r\n\t * A container must be an HTML element, because menu itself is HTML, and\r\n\t * cannot be placed into SVG.\r\n\t *\r\n\t * @param container Reference to container element\r\n\t * @todo Check if menu is already build. If it is, just move it to a new container\r\n\t */\r\n\tpublic set container(container: $type.Optional<HTMLElement>) {\r\n\t\tthis._container = container;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Container\r\n\t */\r\n\tpublic get container(): $type.Optional<HTMLElement> {\r\n\t\treturn this._container;\r\n\t}\r\n\r\n\t/**\r\n\t * A list of menu items. Can be nested.\r\n\t *\r\n\t * @param items  Menu items\r\n\t */\r\n\tpublic set items(items: Array<IExportMenuItem>) {\r\n\t\tthis._items = items;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Menu items\r\n\t */\r\n\tpublic get items(): Array<IExportMenuItem> {\r\n\t\treturn this._items;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets main menu tag to place menu in.\r\n\t *\r\n\t * This also sets up how menu items are built.\r\n\t *\r\n\t * If you set this to \"ul\", menu items will be wrapped into `<li>` tags.\r\n\t *\r\n\t * If set to \"div\", menu items will be wrapped in `<div>` tags.\r\n\t *\r\n\t * @default \"ul\"\r\n\t * @param tag Tag to use for menu\r\n\t */\r\n\tpublic set tag(tag: \"ul\" | \"div\") {\r\n\t\tthis._menuTag = tag;\r\n\t\tthis._itemTag = tag == \"ul\" ? \"li\" : \"div\";\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns current menu tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Menu tag (item that contains sub-items)\r\n\t */\r\n\tpublic get menuTag(): string {\r\n\t\treturn this.adapter.apply(\"menuTag\", {\r\n\t\t\ttag: this._menuTag\r\n\t\t}).tag;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns tag to wrap items into.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Item tag\r\n\t */\r\n\tpublic get itemTag(): string {\r\n\t\treturn this.adapter.apply(\"itemTag\", {\r\n\t\t\ttag: this._itemTag\r\n\t\t}).tag;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns menu label tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Label tag\r\n\t */\r\n\tpublic get labelTag(): string {\r\n\t\treturn this.adapter.apply(\"labelTag\", {\r\n\t\t\ttag: this._labelTag\r\n\t\t}).tag;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns icon tag.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @return Icon tag\r\n\t */\r\n\tpublic get iconTag(): string {\r\n\t\treturn this.adapter.apply(\"iconTag\", {\r\n\t\t\ttag: this._iconTag\r\n\t\t}).tag;\r\n\t}\r\n\r\n\t/**\r\n\t * A horizontal alignment for the menu placement.\r\n\t *\r\n\t * @param value Horizontal alignment\r\n\t */\r\n\tpublic set align(value: Align) {\r\n\t\tthis._align = value;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Horizontal alignment\r\n\t */\r\n\tpublic get align(): Align {\r\n\t\treturn this.adapter.apply(\"align\", {\r\n\t\t\talign: this._align\r\n\t\t}).align;\r\n\t}\r\n\r\n\t/**\r\n\t * A vertical alignment for the menu placement.\r\n\t *\r\n\t * @param value Vertical alignment\r\n\t */\r\n\tpublic set verticalAlign(value: VerticalAlign) {\r\n\t\tthis._verticalAlign = value;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Vertical alignment\r\n\t */\r\n\tpublic get verticalAlign(): VerticalAlign {\r\n\t\treturn this.adapter.apply(\"verticalAlign\", {\r\n\t\t\tverticalAlign: this._verticalAlign\r\n\t\t}).verticalAlign;\r\n\t}\r\n\r\n\t/**\r\n\t * Class name prefix.\r\n\t *\r\n\t * @default \"amexport\"\r\n\t * @param value Class name prefix\r\n\t */\r\n\tpublic set classPrefix(value: string) {\r\n\t\tthis._classPrefix = value;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Class name prefix\r\n\t */\r\n\tpublic get classPrefix(): string {\r\n\t\treturn this.adapter.apply(\"classPrefix\", {\r\n\t\t\tclassPrefix: this._classPrefix\r\n\t\t}).classPrefix;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether [[ExportMenu]] should load external CSS to style itself.\r\n\t *\r\n\t * If set to `false`, the menu will not be styled, and will rely on some\r\n\t * external CSS.\r\n\t *\r\n\t * @default true\r\n\t * @param Should ExportMenu load its own CSS?\r\n\t */\r\n\tpublic set defaultStyles(value: boolean) {\r\n\t\tif (this._defaultStyles != value) {\r\n\t\t\tthis._defaultStyles = value;\r\n\t\t\tif (value) {\r\n\t\t\t\tthis.loadDefaultCSS();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Should ExportMenu load its own CSS?\r\n\t */\r\n\tpublic get defaultStyles(): boolean {\r\n\t\treturn this.adapter.apply(\"defaultStyles\", {\r\n\t\t\tdefaultStyles: this._defaultStyles\r\n\t\t}).defaultStyles;\r\n\t}\r\n\r\n\t/**\r\n\t * Loads the default CSS.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic loadDefaultCSS(): void {\r\n\t\tthis._disposers.push(exportCSS($dom.getShadowRoot(this.container), this.classPrefix));\r\n\r\n\t\tif (this._element) {\r\n\t\t\tthis._element.style.display = \"\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A tab index for the menu.\r\n\t *\r\n\t * Tab index will influence the order in which elements on the chart and\r\n\t * the whole page are selected when pressing TAB key.\r\n\t *\r\n\t * @param value Tab index\r\n\t */\r\n\tpublic set tabindex(value: number) {\r\n\t\tthis._tabindex = value;\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return Tab index\r\n\t */\r\n\tpublic get tabindex(): number {\r\n\t\treturn this.adapter.apply(\"tabindex\", {\r\n\t\t\ttabindex: this._tabindex\r\n\t\t}).tabindex;\r\n\t}\r\n\r\n\t/**\r\n\t * A [[Language]] instance.\r\n\t *\r\n\t * @param value An instance of [[Language]]\r\n\t */\r\n\tpublic set language(value: Language) {\r\n\t\tthis._language.set(value, value.events.on(\"localechanged\", (ev) => {\r\n\t\t\tthis.invalidate();\r\n\t\t}));\r\n\t\tthis.invalidate();\r\n\t}\r\n\r\n\t/**\r\n\t * @return A [[Language]] instance to be used\r\n\t */\r\n\tpublic get language(): Language {\r\n\t\tlet language = this._language.get();\r\n\r\n\t\tif (language == null) {\r\n\t\t\tlanguage = new Language();\r\n\r\n\t\t\t// TODO code duplication with `set language()`\r\n\t\t\tthis._language.set(language, language.events.on(\"localechanged\", (ev) => {\r\n\t\t\t\tthis.invalidate();\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\treturn language;\r\n\t}\r\n\r\n\t/**\r\n\t * Controlling the menu\r\n\t */\r\n\r\n\t/**\r\n\t * Removes all active classes from menu items. Useful on touch devices and\r\n\t * keyboard navigation where open menu can be closed instantly by clicking or\r\n\t * tapping outside it.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t */\r\n\tpublic close(): void {\r\n\r\n\t\tif (this.isDisposed()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this._ignoreNextClose) {\r\n\t\t\tthis._ignoreNextClose = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.closeOnClick) {\r\n\t\t\tthis._element.style.pointerEvents = \"none\";\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis._element.style.pointerEvents = \"auto\";\r\n\t\t\t}, 100);\r\n\t\t}\r\n\r\n\t\tif (this._currentSelection) {\r\n\t\t\tthis.setBlur(this._currentSelection);\r\n\t\t\tthis._currentSelection = undefined;\r\n\t\t}\r\n\r\n\t\tif (this._element) {\r\n\t\t\tlet items = this._element.getElementsByClassName(\"active\");\r\n\t\t\tfor (let len = items.length, i = len - 1; i >= 0; i--) {\r\n\t\t\t\tif (items[i]) {\r\n\t\t\t\t\t$dom.removeClass(<HTMLElement>items[i], \"active\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.events.dispatchImmediately(\"closed\", {\r\n\t\t\ttype: \"closed\",\r\n\t\t\ttarget: this\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Selects a branch in the menu.\r\n\t *\r\n\t * Handles closing of currently open branch.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Branch to select\r\n\t */\r\n\tpublic selectBranch(branch: IExportMenuItem): void {\r\n\r\n\t\tif (this.isDisposed()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Cancel previous closure\r\n\t\tif (branch.closeTimeout) {\r\n\t\t\tthis.removeDispose(branch.closeTimeout);\r\n\t\t\tbranch.closeTimeout = undefined;\r\n\t\t}\r\n\r\n\t\t// Add active class\r\n\t\t$dom.addClass(branch.element, \"active\");\r\n\r\n\t\t// Set expanded\r\n\t\tif (branch.submenuElement) {\r\n\t\t\tbranch.submenuElement.setAttribute(\"aria-expanded\", \"true\");\r\n\t\t}\r\n\r\n\t\t// Remove current selection\r\n\t\tif (this._currentSelection && this._currentSelection !== branch && this._currentSelection.ascendants) {\r\n\t\t\t$iter.each($iter.concat($iter.fromArray([this._currentSelection]), this._currentSelection.ascendants.iterator()), (ascendant) => {\r\n\t\t\t\tif (!branch.ascendants.contains(ascendant) && branch !== ascendant) {\r\n\t\t\t\t\tthis.unselectBranch(ascendant, true);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Select and/or cancel timeout for current ascendants\r\n\t\t$iter.each(branch.ascendants.iterator(), (ascendant) => {\r\n\t\t\tif (ascendant.closeTimeout) {\r\n\t\t\t\tthis.removeDispose(ascendant.closeTimeout);\r\n\t\t\t\tascendant.closeTimeout = undefined;\r\n\t\t\t}\r\n\t\t\t$dom.addClass(ascendant.element, \"active\");\r\n\t\t});\r\n\r\n\t\t// Log current selection\r\n\t\tthis._currentSelection = branch;\r\n\r\n\t\t// Invoke event\r\n\t\tif (this.events.isEnabled(\"branchselected\")) {\r\n\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"branchselected\"] = {\r\n\t\t\t\ttype: \"branchselected\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tbranch: branch\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"branchselected\", event);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Unselects a branch. Also selects a branch one level up if necessary.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Branch to unselect\r\n\t * @param simple If `true`, only the branch will be unselected without selecting parent branch\r\n\t */\r\n\tpublic unselectBranch(branch: IExportMenuItem, simple?: boolean): void {\r\n\r\n\t\tif (this.isDisposed()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Remove active class\r\n\t\t$dom.removeClass(branch.element, \"active\");\r\n\r\n\t\t// Set expanded\r\n\t\tif (branch.submenuElement) {\r\n\t\t\tbranch.submenuElement.removeAttribute(\"aria-expanded\");\r\n\t\t}\r\n\r\n\t\t// Remove current selection\r\n\t\tif (this._currentSelection == branch) {\r\n\t\t\tthis._currentSelection = undefined;\r\n\t\t}\r\n\r\n\t\t// Invoke event\r\n\t\tif (this.events.isEnabled(\"branchunselected\")) {\r\n\t\t\tconst event: AMEvent<this, IExportMenuEvents>[\"branchunselected\"] = {\r\n\t\t\t\ttype: \"branchunselected\",\r\n\t\t\t\ttarget: this,\r\n\t\t\t\tbranch: branch\r\n\t\t\t};\r\n\t\t\tthis.events.dispatchImmediately(\"branchunselected\", event);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Delay unselection of a branch. This can still be cancelled in some other\r\n\t * place if the branch or its children regain focus.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Branch to unselect\r\n\t * @param simple If `true`, only the branch will be unselected without selecting parent branch\r\n\t */\r\n\tpublic delayUnselectBranch(branch: IExportMenuItem, simple?: boolean): void {\r\n\r\n\t\tif (this.isDisposed()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Schedule branch unselection\r\n\t\tif (branch.closeTimeout) {\r\n\t\t\tthis.removeDispose(branch.closeTimeout);\r\n\t\t\tbranch.closeTimeout = undefined;\r\n\t\t}\r\n\t\tbranch.closeTimeout = this.setTimeout(() => {\r\n\t\t\tthis.unselectBranch(branch, simple);\r\n\t\t}, this.closeDelay);\r\n\r\n\t\t// Schedule unselection of all ascendants\r\n\t\t// In case focus went away from the export menu altogether, this will ensure\r\n\t\t// that all items will be closed.\r\n\t\t// In case we're jumping to other menu item, those delayed unselections will\r\n\t\t// be cancelled by `selectBranch`\r\n\t\tif (simple !== true && branch.ascendants) {\r\n\t\t\t$iter.each(branch.ascendants.iterator(), (ascendant) => {\r\n\t\t\t\tthis.delayUnselectBranch(ascendant, true);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Navigates the menu based on which direction kayboard key was pressed.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param key A key that was pressed\r\n\t */\r\n\tpublic moveSelection(key: KeyboardKeys): void {\r\n\r\n\t\tif (this.isDisposed()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Check if there's a current selection\r\n\t\tif (!this._currentSelection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet newSelection: $type.Optional<IExportMenuItem>;\r\n\r\n\t\tif (key == \"up\") {\r\n\t\t\t// Try moving up in current menu list, or to the last item if already\r\n\t\t\t// at the top\r\n\t\t\tnewSelection = this.getPrevSibling(this._currentSelection);\r\n\t\t}\r\n\t\telse if (key == \"down\") {\r\n\t\t\t// Try moving down in current menu list, or to the top item if already\r\n\t\t\t// at the bottom\r\n\t\t\tnewSelection = this.getNextSibling(this._currentSelection);\r\n\t\t}\r\n\t\telse if ((key == \"left\" && this.align == \"right\") || (key == \"right\" && this.align == \"left\")) {\r\n\t\t\tlet menu = this.getSubMenu(this._currentSelection);\r\n\r\n\t\t\t// Go one level-deeper\r\n\t\t\tif (menu != null) {\r\n\t\t\t\tnewSelection = menu[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ((key == \"right\" && this.align == \"right\") || (key == \"left\" && this.align == \"left\")) {\r\n\t\t\t// Go one level-deeper\r\n\t\t\tnewSelection = this.getParentItem(this._currentSelection);\r\n\t\t}\r\n\r\n\t\tif (newSelection && newSelection !== this._currentSelection) {\r\n\t\t\tthis.selectBranch(newSelection);\r\n\t\t\tthis.setFocus(newSelection);\r\n\t\t\tthis._currentSelection = newSelection;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Returns all siblings of a menu item, including this same menu item.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  Menu item\r\n\t * @return List of sibling menu items\r\n\t */\r\n\tpublic getSiblings(branch: IExportMenuItem): Array<IExportMenuItem> {\r\n\t\tlet parent = this.getParentItem(branch);\r\n\r\n\t\tif (parent && parent.menu) {\r\n\t\t\treturn parent.menu;\r\n\r\n\t\t} else {\r\n\t\t\treturn [];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns menu items parent item.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  Menu item\r\n\t * @return Parent menu item\r\n\t */\r\n\tpublic getParentItem(branch: IExportMenuItem): $type.Optional<IExportMenuItem> {\r\n\t\tif (branch.ascendants && branch.ascendants.length) {\r\n\t\t\treturn branch.ascendants.getIndex(branch.ascendants.length - 1);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns next sibling in the same menu branch. If there is no next sibling,\r\n\t * the first one is returned. If there is just one item, that item is\r\n\t * returned. Unsupported menu items are skipped.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  Menu item to search siblings for\r\n\t * @return Menu item\r\n\t */\r\n\tpublic getNextSibling(branch: IExportMenuItem): IExportMenuItem {\r\n\t\tlet siblings = this.getSiblings(branch);\r\n\t\tif (siblings.length > 1) {\r\n\t\t\tlet next = siblings.indexOf(branch) + 1;\r\n\t\t\tnext = siblings.length == next ? 0 : next;\r\n\t\t\treturn siblings[next].unsupported ? this.getNextSibling(siblings[next]) : siblings[next];\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn branch;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns previous sibling in the same menu branch. If there is no next\r\n\t * sibling, the first one is returned. If there is just one item, that item is\r\n\t * returned. Unsupported menu items are skipped.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch  Menu item to search siblings for\r\n\t * @return Menu item\r\n\t */\r\n\tpublic getPrevSibling(branch: IExportMenuItem): IExportMenuItem {\r\n\t\tlet siblings = this.getSiblings(branch);\r\n\t\tif (siblings.length > 1) {\r\n\t\t\tlet prev = siblings.indexOf(branch) - 1;\r\n\t\t\tprev = prev == -1 ? siblings.length - 1 : prev;\r\n\t\t\treturn siblings[prev].unsupported ? this.getPrevSibling(siblings[prev]) : siblings[prev];\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn branch;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempts to set focus on particular menu element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Menu item\r\n\t */\r\n\tpublic setFocus(branch: IExportMenuItem): void {\r\n\t\tif (branch.interactions) {\r\n\t\t\ttry {\r\n\t\t\t\t(<HTMLElement>branch.interactions.element).focus();\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\t// nothing\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempts to remove focus from the menu element.\r\n\t *\r\n\t * @ignore Exclude from docs\r\n\t * @param branch Menu item\r\n\t */\r\n\tpublic setBlur(branch: IExportMenuItem): void {\r\n\t\tif (branch.interactions) {\r\n\t\t\ttry {\r\n\t\t\t\t(<HTMLElement>branch.interactions.element).blur();\r\n\t\t\t}\r\n\t\t\tcatch (e) {\r\n\t\t\t\t// nothing\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hides the whole branch of menu.\r\n\t *\r\n\t * @param  branch  branch\r\n\t */\r\n\tpublic hideBranch(branch: IExportMenuItem): void {\r\n\t\tbranch.element.style.display = \"none\";\r\n\t}\r\n\r\n\t/**\r\n\t * Show the branch of menu.\r\n\t *\r\n\t * @param  branch  branch\r\n\t */\r\n\tpublic showBranch(branch: IExportMenuItem): void {\r\n\t\tbranch.element.style.display = \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * The main element o fthe menu - usually `<ul>`.\r\n\t *\r\n\t * @since 4.10.6\r\n\t * @return Menu element\r\n\t */\r\n\tpublic get element(): $type.Optional<HTMLElement> {\r\n\t\treturn this._element;\r\n\t}\r\n\r\n}\r\n","// Also detects iOS\nexport function isSafari(): boolean {\n\treturn /apple/i.test(navigator.vendor);\n}\n\nexport function isInternetExplorer(): boolean {\n\treturn /MSIE |Trident\\//.test(navigator.userAgent);\n}\n"],"sourceRoot":""}